<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[[Swift5.1] 8-å±æ€§]]></title>
    <url>%2F2020%2F06%2F02%2FSwift5-1-8-%E5%B1%9E%E6%80%A7%2F</url>
    <content type="text"><![CDATA[å±æ€§Swiftä¸­è·Ÿå®ä¾‹ç›¸å…³çš„å±æ€§å¯ä»¥åˆ†ä¸º2å¤§ç±» å­˜å‚¨å±æ€§ï¼ˆStored Propertyï¼‰ ç±»ä¼¼äºæˆå‘˜å˜é‡è¿™ä¸ªæ¦‚å¿µ å­˜å‚¨åœ¨å®ä¾‹çš„å†…å­˜ä¸­ ç»“æ„ä½“ã€ç±»å¯ä»¥å®šä¹‰å­˜å‚¨å±æ€§ æšä¸¾ä¸å¯ä»¥å®šä¹‰å­˜å‚¨å±æ€§ è®¡ç®—å±æ€§ï¼ˆComputed Propertyï¼‰ æœ¬è´¨å°±æ˜¯æ–¹æ³•ï¼ˆå‡½æ•°ï¼‰ ä¸å ç”¨å®ä¾‹çš„å†…å­˜ æšä¸¾ã€ç»“æ„ä½“ã€ç±»éƒ½å¯ä»¥å®šä¹‰è®¡ç®—å±æ€§ struct Circle { // å­˜å‚¨å±æ€§ var radius: Double // è®¡ç®—å±æ€§ var diameter: Double { set { radius = newValue / 2 } get { radius * 2 } } } var circle = Circle(radius: 5) print(circle.radius) // 5.0 print(circle.diameter) // 10.0 circle.diameter = 12 print(circle.radius) // 6.0 print(circle.diameter) // 12.0 print(MemoryLayout&lt;Circle>.stride) // 8 å­˜å‚¨å±æ€§å…³äºå­˜å‚¨å±æ€§ï¼ŒSwiftæœ‰ä¸ªæ˜ç¡®çš„è§„å®š: åœ¨åˆ›å»ºç±» æˆ– ç»“æ„ä½“çš„å®ä¾‹æ—¶ï¼Œå¿…é¡»ä¸ºæ‰€æœ‰çš„å­˜å‚¨å±æ€§è®¾ç½®ä¸€ä¸ªåˆé€‚çš„åˆå§‹å€¼ å¯ä»¥åœ¨åˆå§‹åŒ–å™¨é‡Œä¸ºå­˜å‚¨å±æ€§è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ å¯ä»¥åˆ†é…ä¸€ä¸ªé»˜è®¤çš„å±æ€§å€¼ä½œä¸ºå±æ€§å®šä¹‰çš„ä¸€éƒ¨åˆ† è®¡ç®—å±æ€§ setä¼ å…¥çš„æ–°å€¼é»˜è®¤å«åšnewValueï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ struct Circle { var radius: Double var diameter: Double { set(newDiameter) { radius = newDiameter / 2 } get { radius * 2 } } } åªè¯»è®¡ç®—å±æ€§ï¼šåªæœ‰getï¼Œæ²¡æœ‰set struct Circle { var radius: Double var diameter: Double { get { radius * 2 } } } struct Circle { var radius: Double var diameter: Double { radius * 2 } } å®šä¹‰è®¡ç®—å±æ€§åªèƒ½ç”¨varï¼Œä¸èƒ½ç”¨let letä»£è¡¨å¸¸é‡ï¼šå€¼æ˜¯ä¸€æˆä¸å˜çš„ è®¡ç®—å±æ€§çš„å€¼æ˜¯å¯èƒ½å‘ç”Ÿå˜åŒ–çš„ï¼ˆå³ä½¿æ˜¯åªè¯»è®¡ç®—å±æ€§ï¼‰ æšä¸¾rawValueåŸç†æšä¸¾åŸå§‹å€¼rawValueçš„æœ¬è´¨æ˜¯ï¼šåªè¯»è®¡ç®—å±æ€§ enum TestEnum : Int { case test1 = 1, test2 = 2, test3 = 3 var rawValue: Int { switch self { case .test1: return 10 case .test2: return 11 case .test3: return 12 } } } print(TestEnum.test3.rawValue) // 12 å»¶è¿Ÿå­˜å‚¨å±æ€§ï¼ˆLazy Stored Propertyï¼‰ä½¿ç”¨lazyå¯ä»¥å®šä¹‰ä¸€ä¸ªå»¶è¿Ÿå­˜å‚¨å±æ€§ï¼Œåœ¨ç¬¬ä¸€æ¬¡ç”¨åˆ°å±æ€§çš„æ—¶å€™æ‰ä¼šè¿›è¡Œåˆå§‹åŒ– class Car{ init() { print("Car init!") } func run() { print("Car is running!") } } class Person{ lazy var car = Car() init() { print("Person init!") } func goOut() { car.run() } } let p = Person() print("------") p.goOut() è¾“å‡º: Person init! ------ Car init! Car is running! class PhotoView { lazy var image: Image = { let url = "https://www.baidu.com/xx.png" let data = Data(url: url) return Image(data: data) }() } lazyå±æ€§å¿…é¡»æ˜¯varï¼Œä¸èƒ½æ˜¯let letå¿…é¡»åœ¨å®ä¾‹çš„åˆå§‹åŒ–æ–¹æ³•å®Œæˆä¹‹å‰å°±æ‹¥æœ‰å€¼ å¦‚æœå¤šæ¡çº¿ç¨‹åŒæ—¶ç¬¬ä¸€æ¬¡è®¿é—®lazyå±æ€§ æ— æ³•ä¿è¯å±æ€§åªè¢«åˆå§‹åŒ–1æ¬¡, ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„. å»¶è¿Ÿå­˜å‚¨å±æ€§æ³¨æ„ç‚¹: å½“ç»“æ„ä½“åŒ…å«ä¸€ä¸ªå»¶è¿Ÿå­˜å‚¨å±æ€§æ—¶ï¼Œåªæœ‰varæ‰èƒ½è®¿é—®å»¶è¿Ÿå­˜å‚¨å±æ€§ å› ä¸ºå»¶è¿Ÿå±æ€§åˆå§‹åŒ–æ—¶éœ€è¦æ”¹å˜ç»“æ„ä½“çš„å†…å­˜ å±æ€§è§‚å¯Ÿå™¨ï¼ˆProperty Observerï¼‰å¯ä»¥ä¸ºélazyçš„varå­˜å‚¨å±æ€§è®¾ç½®å±æ€§è§‚å¯Ÿå™¨ struct Circle { var radius: Double { willSet { print("willSet", newValue) } didSet { print("didSet", oldValue, radius) } } init() { self.radius = 1.0 print("Circle init!") } } // Circle init! var circle = Circle() // willSet 10.5 // didSet 1.0 10.5 circle.radius = 10.5 // 10.5 print(circle.radius) willSetä¼šä¼ é€’æ–°å€¼ï¼Œé»˜è®¤å«newValue didSetä¼šä¼ é€’æ—§å€¼ï¼Œé»˜è®¤å«oldValue åœ¨åˆå§‹åŒ–å™¨ä¸­è®¾ç½®å±æ€§å€¼ä¸ä¼šè§¦å‘willSetå’ŒdidSet åœ¨å±æ€§å®šä¹‰æ—¶è®¾ç½®åˆå§‹å€¼ä¹Ÿä¸ä¼šè§¦å‘willSetå’ŒdidSet å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡å±æ€§è§‚å¯Ÿå™¨ã€è®¡ç®—å±æ€§çš„åŠŸèƒ½ï¼ŒåŒæ ·å¯ä»¥åº”ç”¨åœ¨å…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡èº«ä¸Š var num: Int { get { return 10 } set { print("setNum", newValue) } } num = 11 // setNum 11 print(num) // 10 func test() { var age = 10 { willSet { print("willSet", newValue) } didSet { print("didSet", oldValue, age) } } age = 11 // willSet 11 // didSet 10 11 } test() inoutçš„å†æ¬¡ç ”ç©¶struct Shape { var width: Int var side: Int { willSet { print("willSetSide", newValue) } didSet { print("didSetSide", oldValue, side) } } var girth: Int { set { width = newValue / side print("setGirth", newValue) } get { print("getGirth") return width * side } } func show() { print("width=\(width), side=\(side), girth=\(girth)") } } func test(_ num: inout Int) { num = 20 } var s = Shape(width: 10, side: 4) test(&amp;s.width) s.show() print("----------") test(&amp;s.side) s.show() print("----------") test(&amp;s.girth) s.show() æ‰“å°: getGirth width=20, side=4, girth=80 ---------- willSetSide 20 didSetSide 4 20 getGirth width=20, side=20, girth=400 ---------- getGirth setGirth 20 getGirth width=1, side=20, girth=20 inoutçš„æœ¬è´¨æ€»ç»“1)å¦‚æœå®å‚æœ‰ç‰©ç†å†…å­˜åœ°å€ï¼Œä¸”æ²¡æœ‰è®¾ç½®å±æ€§è§‚å¯Ÿå™¨ç›´æ¥å°†å®å‚çš„å†…å­˜åœ°å€ä¼ å…¥å‡½æ•°ï¼ˆå®å‚è¿›è¡Œå¼•ç”¨ä¼ é€’ï¼‰ 2)å¦‚æœå®å‚æ˜¯è®¡ç®—å±æ€§ æˆ–è€… è®¾ç½®äº†å±æ€§è§‚å¯Ÿå™¨é‡‡å–äº†Copy In Copy Outçš„åšæ³• è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå…ˆå¤åˆ¶å®å‚çš„å€¼ï¼Œäº§ç”Ÿå‰¯æœ¬ã€getã€‘ å°†å‰¯æœ¬çš„å†…å­˜åœ°å€ä¼ å…¥å‡½æ•°ï¼ˆå‰¯æœ¬è¿›è¡Œå¼•ç”¨ä¼ é€’ï¼‰ï¼Œåœ¨å‡½æ•°å†…éƒ¨å¯ä»¥ä¿®æ”¹å‰¯æœ¬çš„å€¼ å‡½æ•°è¿”å›åï¼Œå†å°†å‰¯æœ¬çš„å€¼è¦†ç›–å®å‚çš„å€¼ã€setã€‘ æ€»ç»“ï¼š inoutçš„æœ¬è´¨å°±æ˜¯å¼•ç”¨ä¼ é€’ï¼ˆåœ°å€ä¼ é€’ï¼‰ ç±»å‹å±æ€§ï¼ˆType Propertyï¼‰ä¸¥æ ¼æ¥è¯´ï¼Œå±æ€§å¯ä»¥åˆ†ä¸º:1)å®ä¾‹å±æ€§ï¼ˆInstance Propertyï¼‰ï¼šåªèƒ½é€šè¿‡å®ä¾‹å»è®¿é—® å­˜å‚¨å®ä¾‹å±æ€§ï¼ˆStored Instance Propertyï¼‰ï¼šå­˜å‚¨åœ¨å®ä¾‹çš„å†…å­˜ä¸­ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰1ä»½ è®¡ç®—å®ä¾‹å±æ€§ï¼ˆComputed Instance Propertyï¼‰ 2)ç±»å‹å±æ€§ï¼ˆType Propertyï¼‰ï¼šåªèƒ½é€šè¿‡ç±»å‹å»è®¿é—® å­˜å‚¨ç±»å‹å±æ€§ï¼ˆStored Type Propertyï¼‰ï¼šæ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°±åªæœ‰1ä»½å†…å­˜ï¼ˆç±»ä¼¼äºå…¨å±€å˜é‡ï¼‰ è®¡ç®—ç±»å‹å±æ€§ï¼ˆComputed Type Propertyï¼‰ å¯ä»¥é€šè¿‡staticå®šä¹‰ç±»å‹å±æ€§ å¦‚æœæ˜¯ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨å…³é”®å­— class struct Car { static var count: Int = 0 init() { Car.count += 1 } } let c1 = Car() let c2 = Car() let c3 = Car() print(Car.count) // 3 ç±»å‹å±æ€§ç»†èŠ‚ ä¸åŒäºå­˜å‚¨å®ä¾‹å±æ€§ï¼Œä½ å¿…é¡»ç»™å­˜å‚¨ç±»å‹å±æ€§è®¾å®šåˆå§‹å€¼ å› ä¸ºç±»å‹æ²¡æœ‰åƒå®ä¾‹é‚£æ ·çš„initåˆå§‹åŒ–å™¨æ¥åˆå§‹åŒ–å­˜å‚¨å±æ€§ å­˜å‚¨ç±»å‹å±æ€§é»˜è®¤å°±æ˜¯lazyï¼Œä¼šåœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™æ‰åˆå§‹åŒ–å°±ç®—è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä¿è¯åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ å­˜å‚¨ç±»å‹å±æ€§å¯ä»¥æ˜¯let æšä¸¾ç±»å‹ä¹Ÿå¯ä»¥å®šä¹‰ç±»å‹å±æ€§ï¼ˆå­˜å‚¨ç±»å‹å±æ€§ã€è®¡ç®—ç±»å‹å±æ€§ï¼‰ å•ä¾‹æ¨¡å¼public class FileManager { public static let shared = FileManager() private init() { } } public class FileManager { public static let shared = { // .... // .... return FileManager() }() private init() { } }]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 7-é—­åŒ…]]></title>
    <url>%2F2020%2F06%2F02%2FSwift5-1-7-%E9%97%AD%E5%8C%85%2F</url>
    <content type="text"><![CDATA[é—­åŒ…è¡¨è¾¾å¼ï¼ˆClosure Expressionï¼‰åœ¨Swiftä¸­ï¼Œå¯ä»¥é€šè¿‡funcå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é—­åŒ…è¡¨è¾¾å¼å®šä¹‰ä¸€ä¸ªå‡½æ•° func sum(_ v1: Int, _ v2: Int) -> Int { v1 + v2 } var fn = { (v1: Int, v2: Int) -> Int in return v1 + v2 } fn(10, 20) { (v1: Int, v2: Int) -> Int in return v1 + v2 }(10, 20) é—­åŒ…æ ¼å¼: { (å‚æ•°åˆ—è¡¨) -> è¿”å›å€¼ç±»å‹ in å‡½æ•°ä½“ä»£ç  } æ³¨æ„:é—­åŒ…è°ƒç”¨ä¼ å€¼,ä¸ç”¨å†™æ ‡ç­¾. æ¯”å¦‚ä¸Šé¢çš„v1, v2 é—­åŒ…è¡¨è¾¾å¼çš„ç®€å†™func exec(v1: Int, v2: Int, fn: (Int, Int) -> Int) { print(fn(v1, v2)) } é—­åŒ…è°ƒç”¨: exec(v1: 10, v2: 20, fn: { (v1: Int, v2: Int) -> Int in return v1 + v2 }) 1)é—­åŒ…å¯ä»¥çœç•¥å‚æ•°ç±»å‹ exec(v1: 10, v2: 20, fn: { v1, v2 in return v1 + v2 }) 2)é—­åŒ…è¿˜å¯ä»¥çœç•¥return exec(v1: 10, v2: 20, fn: { v1, v2 in v1 + v2 }) 3)é—­åŒ…è¿˜å¯ä»¥çœç•¥in$0ä»£è¡¨æœ€å‰è¾¹çš„å‚æ•°, $1ä»£è¡¨ç¬¬äºŒä¸ªå‚æ•° exec(v1: 10, v2: 20, fn: { $0 + $1 }) 4)é—­åŒ…è¿˜å¯ä»¥ç›´æ¥ç”¨åŠ å·,ä»£è¡¨ä¸¤ä¸ªå‚æ•°ç›¸åŠ  exec(v1: 10, v2: 20, fn: +) å°¾éšé—­åŒ… å¦‚æœå°†ä¸€ä¸ªå¾ˆé•¿çš„é—­åŒ…è¡¨è¾¾å¼ä½œä¸ºå‡½æ•°çš„æœ€åä¸€ä¸ªå®å‚ï¼Œä½¿ç”¨å°¾éšé—­åŒ…å¯ä»¥å¢å¼ºå‡½æ•°çš„å¯è¯»æ€§. å°¾éšé—­åŒ…æ˜¯ä¸€ä¸ªè¢«ä¹¦å†™åœ¨å‡½æ•°è°ƒç”¨æ‹¬å·å¤–é¢ï¼ˆåé¢ï¼‰çš„é—­åŒ…è¡¨è¾¾å¼ func exec(v1: Int, v2: Int, fn: (Int, Int) -> Int) { print(fn(v1, v2)) } exec(v1: 10, v2: 20) { $0 + $1 } å¦‚æœé—­åŒ…è¡¨è¾¾å¼æ˜¯å‡½æ•°çš„å”¯ä¸€å®å‚ï¼Œè€Œä¸”ä½¿ç”¨äº†å°¾éšé—­åŒ…çš„è¯­æ³•ï¼Œé‚£å°±ä¸éœ€è¦åœ¨å‡½æ•°ååè¾¹å†™åœ†æ‹¬å· func exec(fn: (Int, Int) -> Int) { print(fn(1, 2)) } exec(fn: { $0 + $1 }) exec() { $0 + $1 } exec { $0 + $1 } ç¤ºä¾‹ â€“ æ•°ç»„çš„æ’åºfunc sort(by areInIncreasingOrder: (Element, Element) -> Bool) /// è¿”å›true: i1æ’åœ¨i2å‰é¢ /// è¿”å›false: i1æ’åœ¨i2åé¢ func cmp(i1: Int, i2: Int) -> Bool { // å¤§çš„æ’åœ¨å‰é¢ return i1 > i2 } var nums = [11, 2, 18, 6, 5, 68, 45] nums.sort(by: cmp) // [68, 45, 18, 11, 6, 5, 2] nums.sort(by: { (i1: Int, i2: Int) -> Bool in return i1 &lt; i2 }) nums.sort(by: { i1, i2 in return i1 &lt; i2 }) nums.sort(by: { i1, i2 in i1 &lt; i2 }) nums.sort(by: { $0 &lt; $1 }) nums.sort(by: &lt;) nums.sort() { $0 &lt; $1 } nums.sort { $0 &lt; $1 } // [2, 5, 6, 11, 18, 45, 68] å¿½ç•¥å‚æ•°func exec(fn: (Int, Int) -> Int) { print(fn(1, 2)) } exec { _,_ in 10 } // 10 é—­åŒ…ï¼ˆClosureï¼‰ç½‘ä¸Šæœ‰å„ç§å…³äºé—­åŒ…çš„å®šä¹‰ï¼Œä¸ªäººè§‰å¾—æ¯”è¾ƒä¸¥è°¨çš„å®šä¹‰æ˜¯: ä¸€ä¸ªå‡½æ•°å’Œå®ƒæ‰€æ•è·çš„å˜é‡\å¸¸é‡ç¯å¢ƒç»„åˆèµ·æ¥ï¼Œç§°ä¸º é—­åŒ… ä¸€èˆ¬æŒ‡å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å‡½æ•° ä¸€èˆ¬å®ƒæ•è·çš„æ˜¯å¤–å±‚å‡½æ•°çš„å±€éƒ¨å˜é‡\å¸¸é‡ typealias Fn = (Int) -&gt; Int func getFn() -&gt; Fn { var num = 0 func plus(_ i: Int) -&gt; Int { num += i return num } return plus } // è¿”å›çš„pluså’Œnumå½¢æˆäº†é—­åŒ… func getFn() -&gt; Fn { var num = 0 return { num += $0 return num } } var fn1 = getFn() var fn2 = getFn() fn1(1) // 1 fn2(2) // 2 fn1(3) // 4 fn2(4) // 6 fn1(5) // 9 fn2(6) // 12 æ€è€ƒï¼šå¦‚æœnumæ˜¯å…¨å±€å˜é‡å‘¢ï¼Ÿ å¯ä»¥æŠŠé—­åŒ…æƒ³è±¡æˆæ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡ å†…å­˜åœ¨å †ç©ºé—´ æ•è·çš„å±€éƒ¨å˜é‡\å¸¸é‡å°±æ˜¯å¯¹è±¡çš„æˆå‘˜ï¼ˆå­˜å‚¨å±æ€§ï¼‰ ç»„æˆé—­åŒ…çš„å‡½æ•°å°±æ˜¯ç±»å†…éƒ¨å®šä¹‰çš„æ–¹æ³• class Closure { var num = 0 func plus(_ i: Int) -> Int { num += i return num } } var cs1 = Closure() var cs2 = Closure() cs1.plus(1) // 1 cs2.plus(2) // 2 cs1.plus(3) // 4 cs2.plus(4) // 6 cs1.plus(5) // 9 cs2.plus(6) // 12 ç»ƒä¹  é—­åŒ…æ•è·å˜é‡num1 num2, å…±äº«å †å†…å­˜ç©ºé—´ typealias Fn = (Int) -> (Int, Int) func getFns() -> (Fn, Fn) { var num1 = 0 var num2 = 0 func plus(_ i: Int) -> (Int, Int) { num1 += i num2 += i &lt;&lt; 1 return (num1, num2) } func minus(_ i: Int) -> (Int, Int) { num1 -= i num2 -= i &lt;&lt; 1 return (num1, num2) } return (plus, minus) } let (p, m) = getFns() p(5) // (5, 10) m(4) // (1, 2) p(3) // (4, 8) m(2) // (2, 4) class Closure { var num1 = 0 var num2 = 0 func plus(_ i: Int) -> (Int, Int) { num1 += i num2 += i &lt;&lt; 1 return (num1, num2) } func minus(_ i: Int) -> (Int, Int) { num1 -= i num2 -= i &lt;&lt; 1 return (num1, num2) } } var cs = Closure() cs.plus(5) // (5, 10) cs.minus(4) // (1, 2) cs.plus(3) // (4, 8) cs.minus(2) // (2, 4) ç»ƒä¹ 2var functions: [() -> Int] = [] for i in 1...3 { functions.append { i } } for f in functions { print(f()) } // 1 // 2 // 3 class Closure { var i: Int init(_ i: Int) { self.i = i } func get() -> Int { return i } } var clses: [Closure] = [] for i in 1...3 { clses.append(Closure(i)) } for cls in clses { print(cls.get()) } æ³¨æ„å¦‚æœè¿”å›å€¼æ˜¯å‡½æ•°ç±»å‹ï¼Œé‚£ä¹ˆå‚æ•°çš„ä¿®é¥°è¦ä¿æŒç»Ÿä¸€ func add(_ num: Int) -> (inout Int) -> Void { func plus(v: inout Int) { v += num } return plus } var num = 5 add(20)(&amp;num) print(num) è‡ªåŠ¨é—­åŒ…// å¦‚æœç¬¬1ä¸ªæ•°å¤§äº0ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ•°ã€‚å¦åˆ™è¿”å›ç¬¬2ä¸ªæ•° func getFirstPositive(_ v1: Int, _ v2: Int) -> Int { return v1 > 0 ? v1 : v2 } getFirstPositive(10, 20) // 10 getFirstPositive(-2, 20) // 20 getFirstPositive(0, -4) // -4 // æ”¹æˆå‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå¯ä»¥è®©v2å»¶è¿ŸåŠ è½½ func getFirstPositive(_ v1: Int, _ v2: () -> Int) -> Int? { return v1 > 0 ? v1 : v2() } getFirstPositive(-4) { 20 } func getFirstPositive(_ v1: Int, _ v2: @autoclosure () -> Int) -> Int? { return v1 > 0 ? v1 : v2() } getFirstPositive(-4, 20) @autoclosure ä¼šè‡ªåŠ¨å°† 20 å°è£…æˆé—­åŒ… { 20 } @autoclosure åªæ”¯æŒ () -&gt; T æ ¼å¼çš„å‚æ•° @autoclosure å¹¶éåªæ”¯æŒæœ€å1ä¸ªå‚æ•° ç©ºåˆå¹¶è¿ç®—ç¬¦ ?? ä½¿ç”¨äº† @autoclosure æŠ€æœ¯ æœ‰@autoclosureã€æ— @autoclosureï¼Œæ„æˆäº†å‡½æ•°é‡è½½ ä¸ºäº†é¿å…ä¸æœŸæœ›å†²çªï¼Œä½¿ç”¨äº†@autoclosureçš„åœ°æ–¹æœ€å¥½æ˜ç¡®æ³¨é‡Šæ¸…æ¥šï¼šè¿™ä¸ªå€¼ä¼šè¢«æ¨è¿Ÿæ‰§è¡Œ]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 6-ç»“æ„ä½“å’Œç±»]]></title>
    <url>%2F2020%2F06%2F01%2FSwift5-1-6-%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[ç»“æ„ä½“åœ¨ Swift æ ‡å‡†åº“ä¸­ï¼Œç»å¤§å¤šæ•°çš„å…¬å¼€ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ï¼Œè€Œæšä¸¾å’Œç±»åªå å¾ˆå°ä¸€éƒ¨åˆ†æ¯”å¦‚Boolã€Intã€Doubleã€ Stringã€Arrayã€Dictionaryç­‰å¸¸è§ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ struct Date { var year: Int var month: Int var day: Int } var date = Date(year: 2019, month: 6, day: 23) æ‰€æœ‰çš„ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„åˆå§‹åŒ–å™¨ï¼ˆinitializerï¼Œåˆå§‹åŒ–æ–¹æ³•ã€æ„é€ å™¨ã€æ„é€ æ–¹æ³•ï¼‰ æœ€åä¸€è¡Œè°ƒç”¨çš„ï¼Œå¯ä»¥ä¼ å…¥æ‰€æœ‰æˆå‘˜å€¼ï¼Œç”¨ä»¥åˆå§‹åŒ–æ‰€æœ‰æˆå‘˜ï¼ˆå­˜å‚¨å±æ€§ï¼ŒStored Propertyï¼‰ ç»“æ„ä½“çš„åˆå§‹åŒ–å™¨ç¼–è¯‘å™¨ä¼šæ ¹æ®æƒ…å†µï¼Œå¯èƒ½ä¼šä¸ºç»“æ„ä½“ç”Ÿæˆå¤šä¸ªåˆå§‹åŒ–å™¨ï¼Œå®—æ—¨æ˜¯ï¼šä¿è¯æ‰€æœ‰æˆå‘˜éƒ½æœ‰åˆå§‹å€¼ æ€è€ƒï¼šä¸‹é¢ä»£ç èƒ½ç¼–è¯‘é€šè¿‡ä¹ˆï¼Ÿ struct Point { var x: Int? var y: Int? } var p1 = Point(x:10, y:10) var p2 = Point(y:10) var p3 = Point(x:10) var p4 = Point() å¯é€‰é¡¹éƒ½æœ‰ä¸ªé»˜è®¤å€¼nil, å› æ­¤å¯ä»¥ç¼–è¯‘é€šè¿‡ è‡ªå®šä¹‰åˆå§‹åŒ–å™¨ä¸€æ—¦åœ¨å®šä¹‰ç»“æ„ä½“æ—¶è‡ªå®šä¹‰äº†åˆå§‹åŒ–å™¨ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šå†å¸®å®ƒè‡ªåŠ¨ç”Ÿæˆå…¶ä»–åˆå§‹åŒ–å™¨ çª¥æ¢åˆå§‹åŒ–å™¨çš„æœ¬è´¨struct Point { var x: Int = 0 var y: Int = 0 } var p = Point() ç­‰æ•ˆäº: struct Point { var x: Int var y: Int init() { x = 0 y = 0 } } var p = Point() ç»“æ„ä½“å†…å­˜ç»“æ„struct Point { var x: Int = 0 var y: Int = 0 var origin: Bool = false } print(MemoryLayout&lt;Point>.size) // 17 print(MemoryLayout&lt;Point>.stride) // 24 print(MemoryLayout&lt;Point>.alignment) // 8 ç±»ç±»çš„å®šä¹‰å’Œç»“æ„ä½“ç±»ä¼¼ï¼Œä½†ç¼–è¯‘å™¨å¹¶æ²¡æœ‰ä¸ºç±»è‡ªåŠ¨ç”Ÿæˆå¯ä»¥ä¼ å…¥æˆå‘˜å€¼çš„åˆå§‹åŒ–å™¨. å’Œç»“æ„ä½“æ¯”è¾ƒ: struct Point { var x: Int = 0 var y: Int = 0 } let p1 = Point() let p2 = Point(x:10, y: 20) let p3 = Point(x:10) let p4 = Point(y:20) å¦‚æœå®šä¹‰ç±»æ²¡æœ‰ç»™æˆå‘˜åˆå§‹åŒ–å€¼, ç¼–è¯‘å™¨ä¸ä¼šç”Ÿæˆæ— å‚çš„åˆå§‹åŒ–å™¨. ç±»çš„åˆå§‹åŒ–å™¨ å¦‚æœç±»çš„æ‰€æœ‰æˆå‘˜éƒ½åœ¨å®šä¹‰çš„æ—¶å€™æŒ‡å®šäº†åˆå§‹å€¼ï¼Œç¼–è¯‘å™¨ä¼šä¸ºç±»ç”Ÿæˆæ— å‚çš„åˆå§‹åŒ–å™¨ æˆå‘˜çš„åˆå§‹åŒ–æ˜¯åœ¨è¿™ä¸ªåˆå§‹åŒ–å™¨ä¸­å®Œæˆçš„ class Point { var x : Int = 10 var y : Int = 20 } let p1 = Point() ä¸Šé¢ä»£ç ç­‰ä»·äºä¸‹é¢: class Point { var x : Int var y : Int init() { x = 10 y = 10 } } let p1 = Point() ç»“æ„ä½“ä¸ç±»çš„æœ¬è´¨åŒºåˆ« ç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼ˆæšä¸¾ä¹Ÿæ˜¯å€¼ç±»å‹ï¼‰ï¼Œç±»æ˜¯å¼•ç”¨ç±»å‹ï¼ˆæŒ‡é’ˆç±»å‹ï¼‰ class Size { var width = 1 var height = 2 } struct Point { var x = 3 var y = 4 } func test() { var size = Size() var point = Point() } å€¼ç±»å‹ å€¼ç±»å‹èµ‹å€¼ç»™varã€letæˆ–è€…ç»™å‡½æ•°ä¼ å‚ï¼Œæ˜¯ç›´æ¥å°†æ‰€æœ‰å†…å®¹æ‹·è´ä¸€ä»½ ç±»ä¼¼äºå¯¹æ–‡ä»¶è¿›è¡Œcopyã€pasteæ“ä½œï¼Œäº§ç”Ÿäº†å…¨æ–°çš„æ–‡ä»¶å‰¯æœ¬ã€‚å±äºæ·±æ‹·è´ï¼ˆdeep copyï¼‰ struct Point { var x: Int var y: Int } func test() { var p1 = Point(x: 10, y: 20) var p2 = p1 } p2.x = 11 p2.y = 22 è¯·é—®p1.xå’Œp1.yæ˜¯å¤šå°‘ï¼Ÿ 10 20 å€¼ç±»å‹çš„èµ‹å€¼æ“ä½œvar s1 = "Jack" var s2 = s1 s2.append("_Rose") print(s1) // Jack print(s2) // Jack_Rose var a1 = [1, 2, 3] var a2 = a1 a2.append(4) a1[0] = 2 print(a1) //[2,2,3] print(a2) //[1,2,3,4] var d1 = ["max" : 10, "min" : 2] var d2 = d1 d1["other"] = 7 d2["max"] = 12 print(d1) // ["other": 7, "max": 10, "min": 2] print(d2) // ["max": 12, "min": 2] åœ¨Swiftæ ‡å‡†åº“ä¸­ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼ŒStringã€Arrayã€Dictionaryã€Seté‡‡å–äº†Copy On Writeçš„æŠ€æœ¯ æ¯”å¦‚ä»…å½“æœ‰â€œå†™â€æ“ä½œæ—¶ï¼Œæ‰ä¼šçœŸæ­£æ‰§è¡Œæ‹·è´æ“ä½œ å¯¹äºæ ‡å‡†åº“å€¼ç±»å‹çš„èµ‹å€¼æ“ä½œï¼ŒSwift èƒ½ç¡®ä¿æœ€ä½³æ€§èƒ½ï¼Œæ‰€æœ‰æ²¡å¿…è¦ä¸ºäº†ä¿è¯æœ€ä½³æ€§èƒ½æ¥é¿å…èµ‹å€¼ å»ºè®®ï¼šä¸éœ€è¦ä¿®æ”¹çš„ï¼Œå°½é‡å®šä¹‰æˆlet struct Point { var x: Int var y: Int } var p1 = Point(x: 10, y: 20) p1 = Point(x: 11, y: 22) å¼•ç”¨ç±»å‹ å¼•ç”¨èµ‹å€¼ç»™varã€letæˆ–è€…ç»™å‡½æ•°ä¼ å‚ï¼Œæ˜¯å°†å†…å­˜åœ°å€æ‹·è´ä¸€ä»½ ç±»ä¼¼äºåˆ¶ä½œä¸€ä¸ªæ–‡ä»¶çš„æ›¿èº«ï¼ˆå¿«æ·æ–¹å¼ã€é“¾æ¥ï¼‰ï¼ŒæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ–‡ä»¶ã€‚å±äºæµ…æ‹·è´ï¼ˆshallow copyï¼‰ class Size { var width: Int var height: Int init(width: Int, height: Int) { self.width = width self.height = height } } func test() { var s1 = Size(width: 10, height: 20) var s2 = s1 } s2.width = 11 s2.height = 22 è¯·é—®s1.widthå’Œs1.heightæ˜¯å¤šå°‘ï¼Ÿ å¯¹è±¡çš„å †ç©ºé—´ç”³è¯·è¿‡ç¨‹åœ¨Swiftä¸­ï¼Œåˆ›å»ºç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¦å‘å †ç©ºé—´ç”³è¯·å†…å­˜ï¼Œå¤§æ¦‚æµç¨‹å¦‚ä¸‹: Class.allocating_init() libswiftCore.dylibï¼š_swift_allocObject_ libswiftCore.dylibï¼šswift_slowAlloc libsystem_malloc.dylibï¼šmalloc åœ¨Macã€iOSä¸­çš„mallocå‡½æ•°åˆ†é…çš„å†…å­˜å¤§å°æ€»æ˜¯16çš„å€æ•° é€šè¿‡class_getInstanceSizeå¯ä»¥å¾—çŸ¥ï¼šç±»çš„å¯¹è±¡è‡³å°‘éœ€è¦å ç”¨å¤šå°‘å†…å­˜ class Point { var x = 11 var test = true var y = 22 } var p = Point() class_getInstanceSize(type(of: p)) // 40 class_getInstanceSize(Point.self) // 40 å¼•ç”¨ç±»å‹çš„èµ‹å€¼æ“ä½œclass Size { var width: Int var height: Int init(width: Int, height: Int) { self.width = width self.height = height } } var s1 = Size(width: 10, height: 20) s1 = Size(width: 11, height: 22) å€¼ç±»å‹ã€å¼•ç”¨ç±»å‹çš„letstruct Point { var x: Int var y: Int } class Size { var width: Int var height: Int init(width: Int, height: Int) { self.width = width self.height = height } } ç†è§£: letä¿®é¥°çš„p, på†…å­˜16ä¸ªå­—èŠ‚ä¸èƒ½ä¿®æ”¹ letä¿®é¥°çš„s, så†…å­˜8ä¸ªå­—èŠ‚ä¸èƒ½ä¿®æ”¹,æŒ‡å‘å†…å­˜åœ°å€ä¸å˜. s.widthå’Œs.heightä¿®æ”¹çš„æ˜¯å †é‡Œè¾¹å†…å­˜ æ€»ç»“:å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¸ºå¸¸é‡æ—¶, å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹å†…å­˜åœ°å€ä¸èƒ½ä¿®æ”¹,ä¸èƒ½æŒ‡å‘å…¶ä»–å†…å­˜.ä½†å¼•ç”¨ç±»å‹å¯ä»¥ä¿®æ”¹å…¶å †å†…å­˜å­˜å‚¨çš„æˆå‘˜å˜é‡å€¼. ç†è§£:letå£°æ˜å€¼ç±»å‹çš„å­—ç¬¦ä¸²str, è¯´æ˜å¸¸é‡strçš„å†…å­˜æ˜¯ä¸èƒ½ä¿®æ”¹çš„,æ‰€ä»¥åè¾¹ä¸èƒ½æ‹¼æ¥å­—ç¬¦ä¸².letå£°æ˜å€¼æ•°ç»„arr, è¯´æ˜å¸¸é‡arrçš„å†…å­˜æ˜¯ä¸èƒ½ä¿®æ”¹çš„,æ‰€ä»¥åè¾¹ä¸èƒ½æ‹¼æ¥,ä¹Ÿä¸èƒ½ä¿®æ”¹æŸä¸ªå…ƒç´ çš„å€¼. åµŒå¥—ç±»å‹struct Poker { enum Suit : Character { case spades = "â™ ", hearts = "â™¥", diamonds = "â™¦", clubs = "â™£" } enum Rank : Int { case two = 2, three, four, five, six, seven, eight, nine, ten case jack, queen, king, ace } } print(Poker.Suit.hearts.rawValue) var suit = Poker.Suit.spades suit = .diamonds var rank = Poker.Rank.five rank = .king æšä¸¾ã€ç»“æ„ä½“ã€ç±»éƒ½å¯ä»¥å®šä¹‰æ–¹æ³•ä¸€èˆ¬æŠŠå®šä¹‰åœ¨æšä¸¾ã€ç»“æ„ä½“ã€ç±»å†…éƒ¨çš„å‡½æ•°ï¼Œå«åšæ–¹æ³• class Size { var width = 10 var height = 10 func show() { print("width=\(width), height=\(height)") } } let s = Size() s.show() // width=10, height=10 struct Point { var x = 10 var y = 10 func show() { print("x=\(x), y=\(y)") } } let p = Point() p.show() // x=10, y=10 enum PokerFace : Character { case spades = "â™ ", hearts = "â™¥", diamonds = "â™¦", clubs = "â™£" func show() { print("face is \(rawValue)") } } let pf = PokerFace.hearts pf.show() // face is â™¥ æ–¹æ³•å ç”¨å¯¹è±¡çš„å†…å­˜ä¹ˆï¼Ÿ ä¸å ç”¨ æ–¹æ³•çš„æœ¬è´¨å°±æ˜¯å‡½æ•° æ–¹æ³•ã€å‡½æ•°éƒ½å­˜æ”¾åœ¨ä»£ç æ®µ ä½œä¸šæ€è€ƒä»¥ä¸‹ç»“æ„ä½“ã€ç±»å¯¹è±¡çš„å†…å­˜ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ struct Point { var x: Int var b1: Bool var b2: Bool var y: Int } var p = Point(x: 10, b1: true, b2: true, y: 20) class Size { var width: Int var b1: Bool var b2: Bool var height: Int init(width: Int, b1: Bool, b2: Bool, height: Int) { self.width = width self.b1 = b1 self.b2 = b2 self.height = height } } var s = Size(width: 10, b1: true, b2: true, height: 20)]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 5-å¯é€‰é¡¹]]></title>
    <url>%2F2020%2F06%2F01%2FSwift5-1-5-%E5%8F%AF%E9%80%89%E9%A1%B9%2F</url>
    <content type="text"><![CDATA[å¯é€‰é¡¹ï¼ˆOptionalï¼‰ å¯é€‰é¡¹ï¼Œä¸€èˆ¬ä¹Ÿå«å¯é€‰ç±»å‹ï¼Œå®ƒå…è®¸å°†å€¼è®¾ç½®ä¸ºnil åœ¨ç±»å‹åç§°åé¢åŠ ä¸ªé—®å· ? æ¥å®šä¹‰ä¸€ä¸ªå¯é€‰é¡¹ var name: String? = "Jack" name = nil var age: Int? //é»˜è®¤å°±æ˜¯nil age = 10 age = nil var array = [1, 15, 40, 29] func get(_ index: Int) -> Int? { if index &lt; 0 || index >= array.count { return nil } return array[index] } print(get(1)) // Optional(15) print(get(-1)) // nil print(get(4)) // nil å¼ºåˆ¶è§£åŒ…ï¼ˆForced Unwrappingï¼‰å¯é€‰é¡¹æœ¬è´¨: å¯é€‰é¡¹æ˜¯å¯¹å…¶ä»–ç±»å‹çš„ä¸€å±‚åŒ…è£…ï¼Œå¯ä»¥å°†å®ƒç†è§£ä¸ºä¸€ä¸ªç›’å­ å¦‚æœä¸ºnilï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸ªç©ºç›’å­ å¦‚æœä¸ä¸ºnilï¼Œé‚£ä¹ˆç›’å­é‡Œè£…çš„æ˜¯ï¼šè¢«åŒ…è£…ç±»å‹çš„æ•°æ® var age: Int? // é»˜è®¤å°±æ˜¯nil age = 10 age = nil å¦‚æœè¦ä»å¯é€‰é¡¹ä¸­å–å‡ºè¢«åŒ…è£…çš„æ•°æ®ï¼ˆå°†ç›’å­é‡Œè£…çš„ä¸œè¥¿å–å‡ºæ¥ï¼‰ï¼Œéœ€è¦ä½¿ç”¨æ„Ÿå¹å· ! è¿›è¡Œå¼ºåˆ¶è§£åŒ… var age: Int? = 10 let ageInt: Int = age! ageInt += 10 å¦‚æœå¯¹å€¼ä¸ºnilçš„å¯é€‰é¡¹ï¼ˆç©ºç›’å­ï¼‰è¿›è¡Œå¼ºåˆ¶è§£åŒ…ï¼Œå°†ä¼šäº§ç”Ÿè¿è¡Œæ—¶é”™è¯¯ var age: Int? age! //Fatal error: Unexpectedly found nil while unwrapping an Optional value åˆ¤æ–­å¯é€‰é¡¹æ˜¯å¦åŒ…å«å€¼let number = Int("123") if number != nil { print("å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°æˆåŠŸï¼š\(number!)") } else { print("å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°å¤±è´¥") } // å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°æˆåŠŸï¼š123 å¯é€‰é¡¹ç»‘å®šï¼ˆOptional Bindingï¼‰ å¯ä»¥ä½¿ç”¨å¯é€‰é¡¹ç»‘å®šæ¥åˆ¤æ–­å¯é€‰é¡¹æ˜¯å¦åŒ…å«å€¼ å¦‚æœåŒ…å«å°±è‡ªåŠ¨è§£åŒ…ï¼ŒæŠŠå€¼èµ‹ç»™ä¸€ä¸ªä¸´æ—¶çš„å¸¸é‡(let)æˆ–è€…å˜é‡(var)ï¼Œå¹¶è¿”å›trueï¼Œå¦åˆ™è¿”å›false if let number = Int("123") { print("å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°æˆåŠŸï¼š\(number)") // numberæ˜¯å¼ºåˆ¶è§£åŒ…ä¹‹åçš„Intå€¼ // numberä½œç”¨åŸŸä»…é™äºè¿™ä¸ªå¤§æ‹¬å· } else { print("å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°å¤±è´¥") } // å­—ç¬¦ä¸²è½¬æ¢æ•´æ•°æˆåŠŸï¼š123 enum Season : Int { case spring = 1, summer, autumn, winter } if let season = Season(rawValue: 6) { switch season { case .spring: print("the season is spring") default: print("the season is other") } } else { print("no such season") } // no such season ç­‰ä»·å†™æ³•if let first = Int("4") { if let second = Int("42") { if first &lt; second &amp;&amp; second &lt; 100 { print("\(first) &lt; \(second) &lt; 100") } } } // 4 &lt; 42 &lt; 100 æ³¨æ„: åŒä¸€ä¸ªifä¸­, å¯é€‰é¡¹ç»‘å®šè¦å’Œå…¶ä»–è¯­å¥ä»¥é€—å·éš”å¼€ if let first = Int("4"), let second = Int("42"), first &lt; second &amp;&amp; second &lt; 100 { print("\(second) &lt; \(second) &lt; 100") } // 4 &lt; 42 &lt; 100 whileå¾ªç¯ä¸­ä½¿ç”¨å¯é€‰é¡¹ç»‘å®š éå†æ•°ç»„ï¼Œå°†é‡åˆ°çš„æ­£æ•°éƒ½åŠ èµ·æ¥ï¼Œå¦‚æœé‡åˆ°è´Ÿæ•°æˆ–è€…éæ•°å­—ï¼Œåœæ­¢éå† var strs = ["10", "20", "abc", "-20", "30"] var index = 0 var sum = 0 while let num = Int(strs[index]), num > 0 { sum += num index += 1 } print(sum) ç©ºåˆå¹¶è¿ç®—ç¬¦ ??ï¼ˆNil-Coalescing Operatorï¼‰public func ?? &lt;T&gt;(optional: T?, defaultValue: @autoclosure () throws -&gt; T?) rethrows -&gt; T? public func ?? &lt;T&gt;(optional: T?, defaultValue: @autoclosure () throws -&gt; T) rethrows -&gt; T a ?? b a æ˜¯å¯é€‰é¡¹ b æ˜¯å¯é€‰é¡¹ æˆ–è€… ä¸æ˜¯å¯é€‰é¡¹ b è·Ÿ a çš„å­˜å‚¨ç±»å‹å¿…é¡»ç›¸åŒ å¦‚æœ a ä¸ä¸ºnilï¼Œå°±è¿”å› a å¦‚æœ a ä¸ºnilï¼Œå°±è¿”å› b å¦‚æœ b ä¸æ˜¯å¯é€‰é¡¹ï¼Œè¿”å› a æ—¶ä¼šè‡ªåŠ¨è§£åŒ… let a: Int? = 1 let b: Int? = 2 let c = a ?? b //cæ˜¯Int? , Optional(1) let a: Int? = nil let b: Int? = 2 let c = a ?? b //cæ˜¯Int? , Optional(2) let a: Int? = nil let b: Int? = nil let c = a ?? b //cæ˜¯Int? , nil let a: Int? = 1 let b: Int = 2 let c = a ?? b //cæ˜¯Int , 1 let a: Int? = nil let b: Int = 2 let c = a ?? b //cæ˜¯Int , 2 ä¸Šæ®µä»£ç ç­‰ä»·äºä¸‹é¢ä»£ç : let a: Int? = nil let b: Int = 2 //å¦‚æœä¸ä½¿ç”¨??è¿ç®—ç¬¦ let c : Int if let tmp = a { c = tmp } else{ c = b } å¤šä¸ª ?? ä¸€èµ·ä½¿ç”¨let a: Int? = 1 let b: Int? = 2 let c = a ?? b ?? 3 //cæ˜¯Int , 1 let a: Int? = nil let b: Int? = 2 let c = a ?? b ?? 3 //cæ˜¯Int , 2 let a: Int? = nil let b: Int? = nil let c = a ?? b ?? 3 //cæ˜¯Int , 3 ??è·Ÿif leté…åˆä½¿ç”¨ ä¸‹é¢ç±»ä¼¼äºif a != nil || b != nil let a: Int? = nil let b: Int? = 2 if let c = a ?? b { print(c) } ä¸‹é¢ç±»ä¼¼äºif a != nil &amp;&amp; b != nil if let c = a, let d = b { print(c) print(d) } ifè¯­å¥å®ç°ç™»é™†func login(_ info: [String : String]) { let username: String if let tmp = info["username"] { username = tmp } else { print("è¯·è¾“å…¥ç”¨æˆ·å") return } let password: String if let tmp = info["password"] { password = tmp } else { print("è¯·è¾“å…¥å¯†ç ") return } // if username .... // if password .... print("ç”¨æˆ·åï¼š\(username)", "å¯†ç ï¼š\(password)", "ç™»é™†ing") } login(["username" : "jack", "password" : "123456"]) // ç”¨æˆ·åï¼šjack å¯†ç ï¼š123456 ç™»é™†ing login(["password" : "123456"]) // è¯·è¾“å…¥å¯†ç  login(["username" : "jack"]) // è¯·è¾“å…¥ç”¨æˆ·å guardè¯­å¥guard æ¡ ä»¶ else { // do something.... é€€å‡ºå½“å‰ä½œç”¨åŸŸ // returnã€breakã€continueã€throw error } guardè¯­å¥ç”¨æ³•:1)å½“guardè¯­å¥çš„æ¡ä»¶ä¸ºfalseæ—¶ï¼Œå°±ä¼šæ‰§è¡Œå¤§æ‹¬å·é‡Œé¢çš„ä»£ç 2)å½“guardè¯­å¥çš„æ¡ä»¶ä¸ºtrueæ—¶ï¼Œå°±ä¼šè·³è¿‡guardè¯­å¥3)guardè¯­å¥ç‰¹åˆ«é€‚åˆç”¨æ¥â€œæå‰é€€å‡ºâ€ å½“ä½¿ç”¨guardè¯­å¥è¿›è¡Œå¯é€‰é¡¹ç»‘å®šæ—¶ï¼Œç»‘å®šçš„å¸¸é‡(let)ã€å˜é‡(var)ä¹Ÿèƒ½åœ¨å¤–å±‚ä½œç”¨åŸŸä¸­ä½¿ç”¨ func login(_ info: [String : String]) { guard let username = info["username"] else { print("è¯·è¾“å…¥ç”¨æˆ·å") return } guard let password = info["password"] else { print("è¯·è¾“å…¥å¯†ç ") return } // if username .... // if password .... print("ç”¨æˆ·åï¼š\(username)", "å¯†ç ï¼š\(password)", "ç™»é™†ing") } éšå¼è§£åŒ…ï¼ˆImplicitly Unwrapped Optionalï¼‰ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯é€‰é¡¹ä¸€æ—¦è¢«è®¾å®šå€¼ä¹‹åï¼Œå°±ä¼šä¸€ç›´æ‹¥æœ‰å€¼ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å»æ‰æ£€æŸ¥ï¼Œä¹Ÿä¸å¿…æ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½è¿›è¡Œè§£åŒ…ï¼Œå› ä¸ºå®ƒèƒ½ç¡®å®šæ¯æ¬¡è®¿é—®çš„æ—¶å€™éƒ½æœ‰å€¼ å¯ä»¥åœ¨ç±»å‹åé¢åŠ ä¸ªæ„Ÿå¹å· ! å®šä¹‰ä¸€ä¸ªéšå¼è§£åŒ…çš„å¯é€‰é¡¹ let num1: Int! = 10 let num2: Int = num1 if num1 != nil { print(num1 + 6) // 16 } if let num3 = num1 { print(num3) } æ³¨æ„:å¦‚æœå¯é€‰é¡¹ç©ºå€¼, éšå¼è§£åŒ…ä¼šæŠ¥é”™! let num1: Int! = nil // Fatal error: Unexpectedly found nil while implicitly unwrapping an Optional value let num2: Int = num1 éšå¼ç»‘å®šåœºæ™¯: å¸Œæœ›ç»™å½“å‰å˜é‡ä¼ å…¥å…·ä½“å€¼,å¼€å‘ä¸­å°½é‡ä¸è¦ç”¨! å­—ç¬¦ä¸²æ’å€¼å¯é€‰é¡¹åœ¨å­—ç¬¦ä¸²æ’å€¼æˆ–è€…ç›´æ¥æ‰“å°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Š var age: Int? = 10 print("My age is \(age)") // My age is Optional(10) è‡³å°‘æœ‰3ç§æ–¹æ³•æ¶ˆé™¤è­¦å‘Š print("My age is \(age!)") // My age is 10 print("My age is \(String(describing: age))") // My age is Optional(10) print("My age is \(age ?? 0)") // My age is 10 å¤šé‡å¯é€‰é¡¹å®ä¾‹1:var num1: Int? = 10 //åŒ…è£…Intç±»å‹çš„å¯é€‰ç±»å‹ var num2: Int?? = num1 // åŒ…è£…ä¸€ä¸ªå¯é€‰ç±»å‹çš„å¯é€‰ç±»å‹ var num3: Int?? = 10 print(num2 == num3) // true å¯ä»¥ä½¿ç”¨lldbæŒ‡ä»¤ frame variable â€“R æˆ–è€… fr v â€“R æŸ¥çœ‹åŒºåˆ« å®ä¾‹2:var num1: Int? = nil var num2: Int?? = num1 var num3: Int?? = nil print(num2 == num3) // false //num2 å’Œnum3ç±»å‹ç›¸åŒ, å€¼ä¸åŒ print(num1 == num3) // false // num1å’Œnum3ç±»å‹ä¸åŒ (num2 ?? 1) ?? 2 // 2 (num3 ?? 1) ?? 2 // 1]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 4-æšä¸¾]]></title>
    <url>%2F2020%2F05%2F31%2FSwift5-1-4-%E6%9E%9A%E4%B8%BE%2F</url>
    <content type="text"><![CDATA[æšä¸¾çš„åŸºæœ¬ç”¨æ³•enum Direction { case north case south case east case west } ç­‰ä»·äºä¸Šè¾¹ä»£ç  enum Direction { case north, south, east, west } var dir = Direction.west dir = Direction.east dir = .north print(dir) // north switch dir { case .north: print("north") case .south: print("south") case .east: print("east") case .west: print("west") } å…³è”å€¼ï¼ˆAssociated Valuesï¼‰ æœ‰æ—¶å°†æšä¸¾çš„æˆå‘˜å€¼è·Ÿå…¶ä»–ç±»å‹çš„å€¼å…³è”å­˜å‚¨åœ¨ä¸€èµ·ï¼Œä¼šéå¸¸æœ‰ç”¨ enum Score { case points(Int) case grade(Character) } var score = Score.points(96) score = .grade("A") switch score { case let .points(i): print(i, "points") case let .grade(i): print("grade", i) } // grade A å¿…è¦æ—¶letä¹Ÿå¯ä»¥æ”¹ä¸ºvar enum Date { case digit(year: Int, month: Int, day: Int) case string(String) } var date = Date.digit(year: 2011, month: 9, day: 10) date = .string("2011-09-10") switch date { case .digit(let year, let month, let day): print(year, month, day) case let .string(value): print(value) } // 2011-09-10 å…³è”å€¼ä¸¾ä¾‹ enum Password { case number(Int, Int, Int, Int) case gesture(String) } var pwd = Password.number(3, 5, 7, 8) pwd = .gesture("12369") switch pwd { case let .number(n1, n2, n3, n4): print("number is ", n1, n2, n3, n4) case let .gesture(str): print("gesture is", str) } // gesture is 12369 åŸå§‹å€¼ï¼ˆRaw Valuesï¼‰ æšä¸¾æˆå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒç±»å‹çš„é»˜è®¤å€¼é¢„å…ˆå¯¹åº”ï¼Œè¿™ä¸ªé»˜è®¤å€¼å«åšï¼šåŸå§‹å€¼ enum PokerSuit : Character { case spade = "â™ " case heart = "â™¥" case diamond = "â™¦" case club = "â™£" } var suit = PokerSuit.spade print(suit) // spade print(suit.rawValue) // â™  print(PokerSuit.club.rawValue) // â™£ enum Grade : String { case perfect = "A" case great = "B" case good = "C" case bad = "D" } print(Grade.perfect.rawValue) // A print(Grade.great.rawValue) // B print(Grade.good.rawValue) // C print(Grade.bad.rawValue) // D æ³¨æ„ï¼šåŸå§‹å€¼ä¸å ç”¨æšä¸¾å˜é‡çš„å†…å­˜ å…³è”å€¼ä¸åŸå§‹å€¼åŒºåˆ«:å¦‚æœæšä¸¾å˜é‡æ˜¯å…³è”å€¼,å¯ä»¥ä¼ å…¥å…·ä½“å€¼è¿›è¡Œå…³è”, ä¼ å…¥çš„å€¼ä¼šæ”¾åœ¨æšä¸¾å˜é‡å†…å­˜é‡Œé¢ . å¦‚æœæšä¸¾ç±»å‹åæœ‰å†’å·è¿™ç§å«åŸå§‹å€¼, åŸå§‹å€¼æ¯ä¸ªæˆå‘˜ä¸€å¼€å§‹å°±ç»‘å®šæ­»å…³è”å¥½çš„, åŸå§‹å€¼ä¸å ç”¨æšä¸¾å˜é‡çš„å†…å­˜. éšå¼åŸå§‹å€¼ï¼ˆImplicitly Assigned Raw Valuesï¼‰ å¦‚æœæšä¸¾çš„åŸå§‹å€¼ç±»å‹æ˜¯Intã€Stringï¼ŒSwiftä¼šè‡ªåŠ¨åˆ†é…åŸå§‹å€¼ enum Direction : String { case north = "north" case south = "south" case east = "east" case west = "west" } ç­‰ä»·äº enum Direction : String { case north, south, east, west } print(Direction.north) // north print(Direction.north.rawValue) // north enum Season : Int { case spring, summer, autumn, winter } print(Season.spring.rawValue) //0 print(Season.summer.rawValue) //1 print(Season.autumn.rawValue) //2 print(Season.winter.rawValue) //3 enum Season : Int { case spring = 1, summer, autumn = 4, winter } print(Season.spring.rawValue) // 1 print(Season.summer.rawValue) // 2 print(Season.autumn.rawValue) // 4 print(Season.winter.rawValue) // 5 é€’å½’æšä¸¾ï¼ˆRecursive Enumerationï¼‰é€’å½’æšä¸¾å‰éœ€è¦åŠ å…³é”®å­—indirect indirect enum ArithExpr { case number(Int) case sum(ArithExpr, ArithExpr) case difference(ArithExpr, ArithExpr) } enum ArithExpr { case number(Int) indirect case sum(ArithExpr, ArithExpr) indirect case difference(ArithExpr, ArithExpr) } let five = ArithExpr.number(5) let four = ArithExpr.number(4) let two = ArithExpr.number(2) let sum = ArithExpr.sum(five, four) let difference = ArithExpr.difference(sum, two) func calculate(_ expr: ArithExpr) -> Int { switch expr { case let .number(value): return value case let .sum(left, right): return calculate(left) + calculate(right) case let .difference(left, right): return calculate(left) - calculate(right) } } calculate(difference) //7 MemoryLayoutå¯ä»¥ä½¿ç”¨MemoryLayoutè·å–æ•°æ®ç±»å‹å ç”¨çš„å†…å­˜å¤§å° enum Password { case number(Int, Int, Int, Int) case other } MemoryLayout&lt;Password>.stride // 40, åˆ†é…å ç”¨çš„ç©ºé—´å¤§å° MemoryLayout&lt;Password>.size // 33, å®é™…ç”¨åˆ°çš„ç©ºé—´å¤§å° MemoryLayout&lt;Password>.alignment // 8, å¯¹é½å‚æ•° var pwd = Password.number(9, 8, 6, 4) pwd = .other MemoryLayout.stride(ofValue: pwd) // 40 MemoryLayout.size(ofValue: pwd) // 33 MemoryLayout.alignment(ofValue: pwd) // 8 æ€è€ƒä¸‹é¢æšä¸¾å˜é‡çš„å†…å­˜å¸ƒå±€?enum TestEnum { case test1, test2, test3 } var t = TestEnum.test1 t = .test2 t = .test3 enum TestEnum : Int { case test1 = 1, test2 = 2, test3 = 3 } var t = TestEnum.test1 t = .test2 t = .test3 enum TestEnum { case test } var t = TestEnum.test enum TestEnum { case test(Int) } var t = TestEnum.test(10) enum TestEnum { case test1(Int, Int, Int) case test2(Int, Int) case test3(Int) case test4(Bool) case test5 } var e = TestEnum.test1(1, 2, 3) e = .test2(4, 5) e = .test3(6) e = .test4(true) e = .test5 å®ƒä»¬çš„switchè¯­å¥åº•å±‚åˆæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ è¿›ä¸€æ­¥è§‚å¯Ÿä¸‹é¢æšä¸¾çš„å†…å­˜å¸ƒå±€enum TestEnum { case test0 case test1 case test2 case test4(Int) case test5(Int, Int) case test6(Int, Int, Int, Bool) } enum TestEnum { case test0 case test1 case test2 case test4(Int) case test5(Int, Int) case test6(Int, Bool, Int) } enum TestEnum { case test0 case test1 case test2 case test4(Int) case test5(Int, Int) case test6(Int, Int, Bool, Int) }]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 3-å‡½æ•°]]></title>
    <url>%2F2020%2F05%2F31%2FSwift5-1-3-%E5%87%BD%E6%95%B0%2F</url>
    <content type="text"><![CDATA[å‡½æ•°å®šä¹‰ å½¢å‚é»˜è®¤æ˜¯letï¼Œä¹Ÿåªèƒ½æ˜¯let func pi() -> Double { return 3.14 } func sum(v1: Int, v2: Int) -> Int { return v1 + v2 } sum(v1: 10, v2: 20) æ— è¿”å›å€¼ func sayHello() -> Void { print("Hello") } func sayHello() -> () { print("Hello") } func sayHello() { print("Hello") } è¿”å›å€¼ï¼ˆï¼‰å®è´¨æ˜¯ç©ºå…ƒç»„ éšå¼è¿”å›ï¼ˆImplicit Returnï¼‰ å¦‚æœæ•´ä¸ªå‡½æ•°ä½“æ˜¯ä¸€ä¸ªå•ä¸€è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆå‡½æ•°ä¼šéšå¼è¿”å›è¿™ä¸ªè¡¨è¾¾å¼ï¼Œå¯ä»¥çœç•¥return func sum(v1: Int, v2: Int) -> Int { v1 + v2 } sum(v1: 10, v2: 20) // 30 è¿”å›å…ƒç»„ï¼šå®ç°å¤šè¿”å›å€¼func calculate(v1:Int, v2: Int) -> (sum: Int, difference: Int, average: Int) { let sum = v1 + v2 return (sum, v1 - v2, sum >> 1) } let result = calculate(v1: 20, v2: 10) result.sum // 30 result.difference // 10 result.average // 15 å‡½æ•°çš„æ–‡æ¡£æ³¨é‡Š//å‡½æ•°çš„æ–‡æ¡£æ³¨é‡Š /// æ±‚å’Œã€æ¦‚è¿°ã€‘ /// /// å°†2ä¸ªæ•´æ•°ç›¸åŠ ã€æ›´è¯¦ç»†çš„æè¿°ã€‘ /// /// - Parameter v1: ç¬¬1ä¸ªæ•´æ•° /// - Parameter v2: ç¬¬2ä¸ªæ•´æ•° /// - Returns: 2ä¸ªæ•´æ•°çš„å’Œ /// /// - Note:ä¼ å…¥2ä¸ªæ•´æ•°å³å¯ã€æ‰¹æ³¨ã€‘ /// func sum(v1: Int, v2: Int) -> Int { v1 + v2 } å‚è€ƒ: https://swift.org/documentation/api-design-guidelines/ å‚æ•°æ ‡ç­¾ï¼ˆArgument Labelï¼‰ å¯ä»¥ä¿®æ”¹å‚æ•°æ ‡ç­¾ //time ç”¨åœ¨å‡½æ•°ä½“ä¸­ï¼Œ atç”¨åœ¨å‡½æ•°è°ƒç”¨ func goToWork(at time: String) { print("this time is \(time)") } goToWork(at: "08:00") // this time is 08:00 å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿ _ çœç•¥å‚æ•°æ ‡ç­¾ func sum(_ v1:Int, _ v2:Int) -> Int { v1 + v2 } sum(10, 20) é»˜è®¤å‚æ•°å€¼ï¼ˆDefault Parameter Valueï¼‰ å‚æ•°å¯ä»¥æœ‰é»˜è®¤å€¼ func check(name: String = "nobody", age: Int, job: String = "none") { print("name=\(name), age=\(age), job=\(job)") } check(name: "Jack", age: 20, job: "Doctor") // name=Jack, age=20, job=Doctor check(name: "Rose", age: 18) // name=Rose, age=18, job=none check(age: 10, job: "Batman") // name=nobody, age=10, job=Batman check(age: 15) // name=nobody, age=15, job=none C++çš„é»˜è®¤å‚æ•°å€¼æœ‰ä¸ªé™åˆ¶ï¼šå¿…é¡»ä»å³å¾€å·¦è®¾ç½®ã€‚ç”±äºSwiftæ‹¥æœ‰å‚æ•°æ ‡ç­¾ï¼Œå› æ­¤å¹¶æ²¡æœ‰æ­¤ç±»é™åˆ¶ ä½†æ˜¯åœ¨çœç•¥å‚æ•°æ ‡ç­¾æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œé¿å…å‡ºé”™ è¿™é‡Œçš„middleä¸å¯ä»¥çœç•¥å‚æ•°æ ‡ç­¾ func test(_ first: Int = 10, middle: Int, _ last: Int = 30) { } test(middle: 20) å¯å˜å‚æ•°ï¼ˆVariadic Parameterï¼‰func sum(_ numbers: Int...) -> Int { var total = 0 for number in numbers { total += number } return total } sum(10, 20, 30, 40) // 100 ä¸€ä¸ªå‡½æ•°æœ€å¤šåªèƒ½æœ‰1ä¸ªå¯å˜å‚æ•° ç´§è·Ÿåœ¨å¯å˜å‚æ•°åé¢çš„å‚æ•°ä¸èƒ½çœç•¥å‚æ•°æ ‡ç­¾ // å‚æ•°stringä¸èƒ½çœç•¥æ ‡ç­¾ func test(_ numbers: Int..., string: String, _ other: String) { } test(10, 20, 30, string: "Jack", "Rose") Swiftè‡ªå¸¦çš„printå‡½æ•°/// - Parameters: /// - items: Zero or more items to print. /// - separator: A string to print between each item. The default is a single /// space (`" "`). /// - terminator: The string to print after all items have been printed. The /// default is a newline (`"\n"`). public func print(_ items: Any..., separator: String = " ", terminator: String = "\n") print(1, 2, 3, 4, 5) //1 2 3 4 5 print(1, 2, 3, 4, 5, separator: "_") //1_2_3_4_5 print("My name is Jake.", terminator: "") print("My age is 18.") // My name is Jake.My age is 18. è¾“å…¥è¾“å‡ºå‚æ•°ï¼ˆIn-Out Parameterï¼‰ å¯ä»¥ç”¨inoutå®šä¹‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºå‚æ•°ï¼šå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å¤–éƒ¨å®å‚çš„å€¼ func swapValues(_ v1: inout Int, _ v2: inout Int) { let tmp = v1 v1 = v2 v2 = tmp } var num1 = 10 var num2 = 20 swapValues(&amp;num1, &amp;num2) func swapValues(_ v1: inout Int, _ v2 : inout Int) { (v1, v2) = (v2, v1) } å¯å˜å‚æ•°ä¸èƒ½æ ‡è®°ä¸ºinout inoutå‚æ•°ä¸èƒ½æœ‰é»˜è®¤å€¼ inoutå‚æ•°åªèƒ½ä¼ å…¥å¯ä»¥è¢«å¤šæ¬¡èµ‹å€¼çš„ ä¸Šè¾¹æ‰€ç¤ºä»£ç ä¸­inoutå‚æ•°çš„æœ¬è´¨æ˜¯åœ°å€ä¼ é€’ï¼ˆå¼•ç”¨ä¼ é€’ï¼‰ å¦‚æœä¼ é€’ç»™inoutå‚æ•°æ˜¯è®¡ç®—å±æ€§, æœ‰ç›‘å¬å™¨çš„å±æ€§ç­‰å†…å®¹, å…¶æœ¬è´¨å¹¶éå¼•ç”¨ä¼ é€’,åœ¨[å±æ€§]ç« èŠ‚åœ¨åšè¯¦ç»†è®²è§£ å‡½æ•°é‡è½½ï¼ˆFunction Overloadï¼‰è§„åˆ™: å‡½æ•°åç›¸åŒ å‚æ•°ä¸ªæ•°ä¸åŒ || å‚æ•°ç±»å‹ä¸åŒ || å‚æ•°æ ‡ç­¾ä¸åŒ func sum(v1: Int, v2: Int) -> Int { v1 + v2 } func sum(v1: Int, v2: Int, v3: Int) -> Int { v1 + v2 + v3 } // å‚æ•°ä¸ªæ•°ä¸åŒ func sum(v1: Int, v2: Double) -> Double { Double(v1) + v2 } // å‚æ•°ç±»å‹ä¸åŒ func sum(v1: Double, v2: Int) -> Double { v1 + Double(v2) } // å‚æ•°ç±»å‹ä¸åŒ func sum(_ v1: Int, _ v2: Int) -> Int { v1 + v2 } // å‚æ•°æ ‡ç­¾ä¸åŒ func sum(a: Int, b: Int) -> Int { a + b } // å‚æ•°æ ‡ç­¾ä¸åŒ sum(v1: 10, v2: 20) // 30 sum(v1: 10, v2: 20, v3: 30) // 60 sum(v1: 10, v2: 20.0) // 30.0 sum(v1: 10.0, v2: 20) // 30.0 sum(10, 20) // 30 sum(a: 10, b: 20) // 30 å‡½æ•°é‡è½½æ³¨æ„ç‚¹ è¿”å›å€¼ç±»å‹ä¸å‡½æ•°é‡è½½æ— å…³ é»˜è®¤å‚æ•°å€¼å’Œå‡½æ•°é‡è½½ä¸€èµ·ä½¿ç”¨äº§ç”ŸäºŒä¹‰æ€§æ—¶ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šæŠ¥é”™ï¼ˆåœ¨C++ä¸­ä¼šæŠ¥é”™ï¼‰ func sum(v1: Int, v2: Int) -> Int { v1 + v2 } func sum(v1: Int, v2: Int, v3: Int = 10) -> Int { v1 + v2 + v3 } // ä¼šè°ƒç”¨sum(v1: Int, v2: Int) sum(v1: 10, v2: 20) å¯å˜å‚æ•°ã€çœç•¥å‚æ•°æ ‡ç­¾ã€å‡½æ•°é‡è½½ä¸€èµ·ä½¿ç”¨äº§ç”ŸäºŒä¹‰æ€§æ—¶ï¼Œç¼–è¯‘å™¨æœ‰å¯èƒ½ä¼šæŠ¥é”™ func sum(v1: Int, v2: Int) -> Int { v1 + v2 } func sum(_ v1: Int, _ v2: Int) -> Int { v1 + v2 } func sum(_ numbers: Int...) -> Int { var total = 0 for number in numbers { total += number } return total } // error: ambiguous use of 'sum' sum(10, 20) å†…è”å‡½æ•°ï¼ˆInline Functionï¼‰å¦‚æœå¼€å¯äº†ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆReleaseæ¨¡å¼é»˜è®¤ä¼šå¼€å¯ä¼˜åŒ–ï¼‰ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†æŸäº›å‡½æ•°å˜æˆå†…è”å‡½æ•° å°†å‡½æ•°è°ƒç”¨å±•å¼€æˆå‡½æ•°ä½“ å“ªäº›å‡½æ•°ä¸ä¼šè¢«è‡ªåŠ¨å†…è”ï¼Ÿ å‡½æ•°ä½“æ¯”è¾ƒé•¿ åŒ…å«é€’å½’è°ƒç”¨ åŒ…å«åŠ¨æ€æ´¾å‘ @inline æ°¸è¿œä¸ä¼šè¢«å†…è”ï¼ˆå³ä½¿å¼€å¯äº†ç¼–è¯‘å™¨ä¼˜åŒ–ï¼‰ @inline(never) func test() { print("test") } å¼€å¯ç¼–è¯‘å™¨ä¼˜åŒ–åï¼Œå³ä½¿ä»£ç å¾ˆé•¿ï¼Œä¹Ÿä¼šè¢«å†…è”ï¼ˆé€’å½’è°ƒç”¨å‡½æ•°ã€åŠ¨æ€æ´¾å‘çš„å‡½æ•°é™¤å¤–ï¼‰ @inline( always) func test() { print("test") } åœ¨Releaseæ¨¡å¼ä¸‹ï¼Œç¼–è¯‘å™¨å·²ç»å¼€å¯ä¼˜åŒ–ï¼Œä¼šè‡ªåŠ¨å†³å®šå“ªäº›å‡½æ•°éœ€è¦å†…è”ï¼Œå› æ­¤æ²¡å¿…è¦ä½¿ç”¨@inline å‡½æ•°ç±»å‹ï¼ˆFunction Typeï¼‰æ¯ä¸€ä¸ªå‡½æ•°éƒ½æ˜¯æœ‰ç±»å‹çš„ï¼Œå‡½æ•°ç±»å‹ç”±å½¢å¼å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ç»„æˆ func test() { } // () -> Void æˆ–è€… () -> () func sum(a:Int, b:Int) -> Int{ a + b } //(Int, Int) -> Int // å®šä¹‰å˜é‡ var fn: (Int, Int) -> Int = sum fn(2, 3) // 5ï¼Œè°ƒç”¨æ—¶ä¸éœ€è¦å‚æ•°æ ‡ç­¾ å‡½æ•°ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°func sum(v1: Int, v2: Int) -> Int { v1 + v2 } func difference(v1: Int, v2: Int) -> Int { v1 - v2 } func printResult(_ mathFn: (Int, Int) -> Int, _ a: Int, _ b: Int) { print("Result: \(mathFn(a, b))") } printResult(sum, 5, 2) // Result: 7 printResult(difference, 5, 2) // Result: 3 å‡½æ•°ç±»å‹ä½œä¸ºå‡½æ•°è¿”å›å€¼ è¿”å›å€¼æ˜¯å‡½æ•°ç±»å‹çš„å‡½æ•°ï¼Œå«åšé«˜é˜¶å‡½æ•°ï¼ˆHigher-Order Functionï¼‰ func next(_ input: Int) -> Int { input + 1 } func previous(_ input: Int) -> Int { input - 1 } func forward(_ forward: Bool) -> (Int) -> Int { forward ? next : previous } forward(true)(3) // 4 forward(false)(3) // 2 typealias typealiasç”¨æ¥ç»™ç±»å‹èµ·åˆ«å typealias Byte = Int8 typealias Short = Int16 typealias Long = Int64 ç»™å…ƒç»„èµ·åˆ«å typealias Date = (year: Int, month: Int, day: Int) func test(_ date: Date) { print(date.0) print(date.year) } test((2011, 9, 10)) ç»™å‡½æ•°ç±»å‹èµ·åˆ«å typealias IntFn = (Int, Int) -> Int func difference(v1: Int, v2: Int) -> Int { v1 - v2 } let fn: IntFn = difference fn(20, 10) // 10 func setFn(_ fn: IntFn) {} setFn(difference) func getFn() -> IntFn { difference } æŒ‰ç…§Swiftæ ‡å‡†åº“çš„å®šä¹‰ï¼ŒVoidå°±æ˜¯ç©ºå…ƒç»„() public typealias Void = () åµŒå¥—å‡½æ•°ï¼ˆNested Functionï¼‰ å°†å‡½æ•°å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨ func forward(_ forward: Bool) -> (Int) -> Int { func next(_ input: Int) -> Int { input + 1 } func previous(_ input: Int) -> Int { input - 1 } return forward ? next : previous } forward(true)(3) // 4 forward(false)(3) // 2]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 2-æµç¨‹æ§åˆ¶]]></title>
    <url>%2F2020%2F05%2F30%2FSwift5-1-2-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%2F</url>
    <content type="text"><![CDATA[ä¸€ã€if-else è¯­å¥let age = 4 if age >= 22 { print("Get married") } else if age >= 18 { print("Being a adult") } else if age >= 7 { print("Go to school") } else { print("Just a child") } ifåé¢çš„æ¡ä»¶å¯ä»¥çœç•¥å°æ‹¬å· æ¡ä»¶åé¢çš„å¤§æ‹¬å·ä¸å¯ä»¥çœç•¥ ifåé¢çš„æ¡ä»¶åªèƒ½æ˜¯Boolç±»å‹ äºŒã€whileå¾ªç¯è¯­å¥var num = 5 while num > 0 { print("num is \(num)") num -= 1 } // æ‰“å°5æ¬¡ var num = -1 repeat { print("num is \(num)") }while num > 0 //æ‰“å°1æ¬¡ // num is -1 repeat-while ç›¸å½“äºCè¯­è¨€ä¸­çš„do-while è¿™é‡Œä¸ç”¨numâ€“ ,å› ä¸ºä»swift3å¼€å§‹,å»é™¤è‡ªå¢(++) ã€ è‡ªå‡(â€“) è¿ç®—ç¬¦ ä¸‰ã€forå¾ªç¯è¯­å¥1)åŒºé—´è¿ç®—ç¬¦: aâ€¦b ä»£è¡¨ a &lt;= å–å€¼ &lt;= blet name = ["Anna", "Alex", "Brian", "Jack"] for i in 0...3 { print(names[i]) } //Anna Alex Brian Jack å¸¸é‡å­˜å‚¨éå†èŒƒå›´ let name = ["Anna", "Alex", "Brian", "Jack"] let range = 1...3 //CloseRang&lt;Int> for i in range { print(names[i]) } //Alex Brian Jack å¸¸é‡å’Œå˜é‡å®šä¹‰å–å€¼èŒƒå›´ let a = 1 var b = 2 for i in a...b { print(names[i]) } // Alex Brian for i in a...3 { print(names[i]) } // Alex Brian Jack i é»˜è®¤å°±æ˜¯let , æœ‰éœ€è¦æ—¶å¯ä»¥å£°æ˜ä¸ºvar for var i in 1...3 { i += 5 print(i) } // 6 7 8 å¾ªç¯ä¸­ç”¨ä¸åˆ° i å¯ä»¥ç”¨_çœç•¥ for _ in 1...3 { print("for") } //æ‰“å°3æ¬¡ 2)åŠå¼€åŒºé—´è¿ç®—ç¬¦: aâ€¦b , a &lt;= å–å€¼ &lt; bfor i in 1..&lt;5 { print(i) } // 1 2 3 4 3) for -åŒºé—´è¿ç®—ç¬¦ç”¨åœ¨æ•°ç»„ä¸Šlet names = ["Anna", "Alex", "Brian", "Jack"] for name in names[0...3] { print(name) } //Anna Alex Brian Jack å•ä¾§åŒºé—´: è®©åŒºé—´æœåŒä¸€ä¸ªæ–¹å‘å°½å¯èƒ½çš„è¿œ for name in names[2...] { print(name) } // Brian Jack for name in names[2...] { print(name) } // Brian Jack for name in names[...2] { print(name) } // Anna Alex Brian for name in names[..&lt;2] { print(name) } // Anna Alex let range = ...5 range.contains(7) //false range.contains(4) //ture range.contains(-2) //ture 4) åŒºé—´ç±»å‹ é—­åŒºé—´ç±»å‹ ClosedRange&lt;Int&gt; åŠå¼€åŠé—­åŒºé—´ç±»å‹ Range&lt;Int&gt; å•ä¾§åŒºé—´ç±»å‹ PartialRangeThrough&lt;Int&gt; let range1 : ClosedRange&lt;Int> = 1...3 let range2 : Range&lt;Int> = 1..&lt;3 let range3 : PartialRangeThrough&lt;Int> = ...5 å­—ç¬¦ã€å­—ç¬¦ä¸²ä¹Ÿèƒ½ä½¿ç”¨åŒºé—´è¿ç®—ç¬¦, ä½†é»˜è®¤ä¸èƒ½ç”¨åœ¨for-inä¸­ let stringRange1 = "cc"..."ff" // ClosedRange&lt;String> stringRange1.contains("cb") //false stringRange1.contains("dz") //true stringRange1.contains("fg") //false let stringRange2 = "a"..."f" stringRange2.contains("d") //true stringRange2.contains("h") //false \0åˆ°~å›Šè¿‡äº†æ‰€æœ‰å¯èƒ½è¦ç”¨åˆ°çš„ASCIIå­—ç¬¦ let characterRange:ClosedRange&lt;Character> = "\0"..."~" characterRange.contains("G") //true 5) å¸¦é—´éš”çš„åŒºé—´å€¼let hours = 11 let hourInterval = 2 //tickMark çš„å–å€¼: ä»4å¼€å§‹, ç´¯åŠ 2, ä¸è¶…è¿‡11 for tickMark in stride(from: 4, to: hours, by: hourInterval) { print(tickMark) } // 4 6 8 10 å››ã€Switchè¯­å¥1)å¸¸è§„ç”¨æ³• caseã€defaultåé¢ä¸èƒ½å†™å¤§æ‹¬å· var number = 1 switch number { case 1: print(" ") break case 2: print("number is 2") break default: print("number is other") break } // number is 1 é»˜è®¤å¯ä»¥ä¸å†™break,å¹¶ä¸ä¼šè´¯ç©¿åˆ°åé¢çš„æ¡ä»¶ switch number { case 1: print(" ") case 2: print("number is 2") default: print("number is other") } // number is 1 2) fallthrough ä½¿ç”¨fallthroughå¯ä»¥å®ç°è´¯ç©¿æ•ˆæœ var number = 1 switch number { case 1: print("number is 1") fallthrough case 2: print("number is 2") default: print("number is other") } // number is 1 // number is 2 3) switchæ³¨æ„ç‚¹ switch å¿…é¡»è¦ä¿è¯èƒ½å¤„ç†æ‰€æœ‰æƒ…å†µ case ã€defaultè¦åé¢è‡³å°‘è¦æœ‰ä¸€æ¡è¯­å¥ å¦‚æœä¸æƒ³åšä»»ä½•äº‹, åŠ ä¸ªbreakå³å¯ var number = 1 switch number { case 1: print("number is 1") fallthrough case 2: print("number is 2") default: break } å¦‚æœèƒ½ä¿è¯å·²å¤„ç†æ‰€æœ‰æƒ…å†µ, ä¹Ÿå¯ä»¥ä¸å¿…ä½¿ç”¨default enum Answer {case right, wrong} let answer = Answer.right switch answer { case Answer.right: print("right") default: print("wrong") } ç”±äºå·²ç¡®å®šansweræ˜¯Answerç±»å‹, å› æ­¤å¯ä»¥çœç•¥Answer enum Answer {case right, wrong} let answer = Answer.right switch answer { case .right: print("right") case .wrong: print("wrong") } 4)å¤åˆæ¡ä»¶switchä¹Ÿæ”¯æŒCharacter String ç±»å‹ let string = "Jack" switch string { case "Jack": fallthrough case "Rose": print("Right person") default: break } //Right person switch string { case "Jack", "Rose": print("Right person") default: break } //Right person let character : Character = "a" switch character { case "a", "A": print("The letter A") default: print("Not the letter a") } //The letter A 5) åŒºé—´åŒ¹é… å…ƒç»„åŒ¹é…let count = 62 switch count { case 0: print("none") case 1..&lt;5: print("a few") case 5..&lt;12: print("several") case 12..&lt;100: print("dozens of") case 100..&lt;1000: print("hundreds of") default: print("many") } // dozens of å¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–ç•¥æŸä¸ªå€¼ å…³äºcaseåŒ¹é…é—®é¢˜, å±äºæ¨¡å¼åŒ¹é…(Pattern Matching)çš„èŒƒç•´, ä»¥åä¼šå†æ¬¡è¯¦ç»†å±•å¼€è®²è§£ let point = (1, 1) switch point { case (0, 0): print("the origin") case (_, 0): print("on the x-axis") case (0, _): print("on the y-axis") case (-2...2 , -2...2): print("inside the box") default: print("outside of the box") } //inside the box 6) å€¼ç»‘å®š å¿…è¦æ—¶let ä¹Ÿå¯ä»¥æ”¹ä¸ºvar let point = (2, 0) switch point { case (let x , 0): print("on the x-axis with an x value of \(x)") case (0 , let y): print("on the y-axis with an y value of \(y)") case let(x , y): print("somewhere else at (\(x), \(y))") } // on the x-axis with an x value of 2 äº”ã€whereè¯­å¥let point = (1, -1) switch point { case let (x, y) where x == y: print("on the line x == y") case let (x, y) where x == -y: print("on the line x == -y") case let (x, y): print("(\(x), \(y)) is just some arbitrary point") } // on the line x == -y å°†æ‰€æœ‰æ­£æ•°åŠ èµ·æ¥ var numbers = [10, 20, -10, -20, 30, -30] var sum = 0 for num in numbers where num > 0 { //ä½¿ç”¨whereè¿‡æ»¤num sum += num } print(sum) //60 å…­ã€æ ‡ç­¾è¯­å¥outer: for i in 1...4 { for k in 1...4 { if k == 3 { continue outer } if i == 3 { break outer } print("i == \(i), k == \(k)") } }]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[Swift5.1] 1-åŸºæœ¬æ•°æ®ç±»å‹]]></title>
    <url>%2F2020%2F05%2F30%2FSwift5-1-1-%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%2F</url>
    <content type="text"><![CDATA[Swiftå¼€æºåº“ print å‡½æ•° ä¸ç”¨ç¼–å†™mainå‡½æ•°, Swiftå°†å…¨å±€èŒƒå›´å†…çš„é¦–å¥å¯æ‰§è¡Œä»£ç ä½œä¸ºç¨‹åºå…¥å£. ä¸€å¥ä»£ç å°¾éƒ¨å¯ä»¥çœç•¥åˆ†å· , å¤šå¥ä»£ç å†™åˆ°åŒä¸€è¡Œæ—¶å¿…é¡»ç”¨åˆ†å·( ; )éš”å¼€ ç”¨varå®šä¹‰å˜é‡, letå®šä¹‰å¸¸é‡, ç¼–è¯‘å™¨èƒ½è‡ªåŠ¨æ¨æ–­å‡ºå˜é‡\å¸¸é‡çš„ç±»å‹ let a = 1 let b = 2 let c = a + b c + = 3 æ‹¼æ¥æ‰“å° var a = 10 print("Hello World! - \(a)") //æ‰“å° Hello World! - 10 Playground å¿«æ·é”® Playgroundå¯ä»¥å¿«é€Ÿé¢„è§ˆä»£ç æ•ˆæœ, æ˜¯å­¦ä¹ è¯­æ³•çš„å¥½å¸®æ‰‹ Command + Shift + Enter: è¿è¡Œæ•´ä¸ªPlayground Shift + Enter è¿è¡Œæˆªæ­¢åˆ°æŸä¸€è¡Œä»£ç  æ³¨é‡Š// å•è¡Œæ³¨é‡Š /* å¤šè¡Œæ³¨é‡Š */ /* a /* å¤šè¡Œæ³¨é‡ŠåµŒå¥— */ b */ æ³¨é‡Šæ”¯æŒmarkupè¯­æ³•, ç±»ä¼¼markload å¼€å¯markupæ¸²æŸ“æ•ˆæœ: Editor -&gt; Show Rendered Markup æ³¨æ„: Markup åªåœ¨Playground å¸¸é‡ å¸¸é‡åªèƒ½èµ‹å€¼ä¸€æ¬¡ å¸¸é‡çš„å€¼ä¸è¦æ±‚åœ¨ç¼–è¯‘æ—¶æœŸç¡®å®š, ä½†ä½¿ç”¨ä¹‹å‰å¿…é¡»èµ‹å€¼1æ¬¡ let age = 10 let age2 : Int age2 = 20 func getAge() -> Int{ return 30; } let age3 = getAge() å¸¸é‡, å˜é‡åœ¨åˆå§‹åŒ–å‰, éƒ½ä¸èƒ½ä½¿ç”¨ let age : Int var height : Int print(age) //é”™è¯¯æç¤º: Constant 'age' used before being initialized print(height) //é”™è¯¯æç¤º: Variable 'height' used before being initialized å®šä¹‰å¸¸é‡æ—¶ï¼Œéœ€è¦æ˜ç¡®ç±»å‹ let age age = 18 //é”™è¯¯æç¤º Found an unexpected second identifier in constant declaration; is there an accidental break? æ ‡è¯†ç¬¦ æ ‡è¯†ç¬¦(æ¯”å¦‚å¸¸é‡åã€å˜é‡åã€ å‡½æ•°å)å‡ ä¹å¯ä»¥ä½¿ç”¨ä»»ä½•å­—ç¬¦ æ ‡è¯†ç¬¦ä¸èƒ½ä»¥æ•°å­—å¼€å¤´, ä¸èƒ½åŒ…å«ç©ºç™½å­—ç¬¦ã€ åˆ¶è¡¨ç¬¦ã€ ç®­å¤´ç¯ç‰¹æ®Šå­—ç¬¦ func ğŸ±ğŸ‰() { print("888") } ğŸ±ğŸ‰() let ğŸ¥› = "milk" var ğŸº = "bear" æ•°æ®ç±»å‹ æ•´æ•°ç±»å‹: Int8ã€Int16ã€Int32ã€Int64ã€UInt8ã€UInt16ã€UInt32ã€UInt64 åœ¨32bitå¹³å°ï¼ŒIntç­‰ä»·äºInt32; åœ¨64bitå¹³å°ï¼ŒIntç­‰ä»·äºInt64 æ•´æ•°çš„æœ€å€¼ï¼šUInt8.maxã€Int16.min ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç›´æ¥ä½¿ç”¨Intå³å¯ æµ®ç‚¹ç±»å‹ï¼šFloat, 32ä½ï¼Œç²¾åº¦åªæœ‰6ä½ï¼› Double, 64ä½ï¼Œç²¾åº¦è‡³å°‘15ä½ å­—é¢é‡ å¸ƒå°” let bool = true //å–åæ˜¯false å­—ç¬¦ä¸² let string = "ä½ å¥½" å­—ç¬¦(å¯å­˜å‚¨ASCIIå­—ç¬¦ã€Unicodeå­—ç¬¦) let character: Character = "ğŸ" æ•´æ•° let intDecimal = 18 //åè¿›åˆ¶ let intBinary = 0b10001 //äºŒè¿›åˆ¶ let intOctal = 0o33 //å…«è¿›åˆ¶ let intHexadecimal = 0x13 //åå…­è¿›åˆ¶ æ•´æ•°å’Œæµ®ç‚¹æ•°å¯ä»¥æ·»åŠ é¢å¤–çš„é›¶æˆ–è€…æ·»åŠ ä¸‹åˆ’çº¿æ¥å¢å¼ºå¯è¯»æ€§ 100_1000ã€1_000_000.000_000_1ã€000123.456 æµ®ç‚¹æ•° let doubleDecimal = 123.0 //åè¿›åˆ¶ï¼Œç­‰ä»·äº1.23e2, 0.0123ç­‰ä»·äº1.23e-2 let doubleHexadecimal1 = 0xFp2 //åå…­è¿›åˆ¶ï¼Œæ„å‘³ç€15*2^2, ç›¸å½“äºåè¿›åˆ¶60.0 let doubleHexadecimal2 = 0xFp-2 //åå…­è¿›åˆ¶ï¼Œæ„å‘³ç€15*2^-2, ç›¸å½“äºåè¿›åˆ¶3.75 ä»¥ä¸‹è¡¨ç¤º12.3456åè¿›åˆ¶ï¼š12.3456 1.23456e1åå…­è¿›åˆ¶ï¼š0xC.3p0 æ•°ç»„ let array = [1, 3, 5, 7, 9] å­—å…¸ let dictionary = ["age" : 18, "height" : 177, "weight": 130] ç±»å‹è½¬æ¢ æ•´æ•°è½¬æ¢ let int1: UInt16 = 2_000 let int2: UInt8 = 1 let int3 = int1 + UInt16(int2) //2001 æ•´æ•° æµ®ç‚¹æ•°è½¬æ¢ let int = 3 let double = 0.14157 let pi = Double(int) + double //3.14157 let intPi = Int(pi) //3 å­—é¢é‡å¯ä»¥ç›´æ¥ç›¸åŠ , ä»¥ä¸ºæ•°å­—å­—é¢é‡æœ¬èº«æ²¡æœ‰æ˜ç¡®çš„ç±»å‹ let result = 3 + 0.14159 //3.14159 å…ƒç»„//é€šè¿‡ä¸‹æ ‡è®¿é—®å…ƒç»„å…ƒç´  let http404Error = (404, "Not Found") print("The status code is \(http40Error.0)") //The status code is 404 //å°†http404Errorä¸­å…ƒç´ , ä¸€ä¸€å¯¹åº”ç»™æ–°å…ƒç»„å…ƒç´  let (statusCode, statusMessage) = http404Error print("The status code is \(statusCode)") // The status code is 404 // _ä»£è¡¨ç¬¬äºŒä¸ªå‚æ•°ä¸æ¥æ”¶ let (justTheStatusCode, _) = http404Error //ä»¥æ ‡ç­¾å½¢å¼åˆå§‹åŒ–å…ƒç»„, å¯ä»¥é€šè¿‡æ ‡ç­¾è®¿é—®å…ƒç´  let http200Status = (statusCode:200, description:"OK") print("The status code is \(http200Status.statusCode)") //The status code is 200]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>Swift5.1</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬12ç«  ç¬¬ä¸‰æ–¹æ¡†æ¶ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F29%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC12%E7%AB%A0-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ³¨æ„ï¼šæœ¬æ–‡ä¸»è®²ç¬¬ä¸‰æ–¹æ¡†æ¶ç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬AFNetworkingã€SDWebImageViewã€Reactive Cocoaã€AsyncDisplayKitã€‚ ä¸€ã€AFNetworking1ã€AFNæ¡†æ¶å›¾é—®é¢˜:AFNetworkingæ•´ä½“æ¡†æ¶æ˜¯æ€æ ·çš„? ä¼šè¯å±‚:NSURLSession ç½‘ç»œç›‘å¬æ¨¡å—:ç›‘å¬ç½‘ç»œå˜åŒ– è¿›è¡Œé€»è¾‘å¤„ç† ç½‘ç»œå®‰å…¨æ¨¡å—: è¯·æ±‚åºåˆ—åŒ– å“åº”åºåˆ—åŒ– UIKité›†æˆæ¨¡å— 2ã€AFNä¸»è¦ç±»å…³ç³»å›¾ AFURLSessionManager åŠŸèƒ½ åˆ›å»ºå’Œç®¡ç†NSURLSessionã€NSURLSessionTask å®ç°NSURLSessionDelegateç­‰åè®®çš„ä»£ç†æ–¹æ³• .ç”¨æ¥å¤„ç†ç½‘ç»œè¯·æ±‚è¿‡ç¨‹ä¸­é‡å®šå‘, æ ¸å¿ƒçš„ç½‘ç»œå“åº”æ•°æ®å¤„ç†. å¼•å…¥AFSecurityPolicyä¿è¯è¯·æ±‚å®‰å…¨.æ¯”å¦‚å‘é€httpsè¯·æ±‚æ—¶, ä¼šæ¶‰åŠè¯ä¹¦æ ¡éªŒ, å…¬é’¥éªŒè¯ç­‰ å¼•å…¥AFNetworkReachabilityManagerç›‘æ§ç½‘ç»œçŠ¶æ€ å‘é€ä¸€ä¸ªGETæ–¹å¼çš„HTTPè¯·æ±‚ äºŒã€SDWebImageView å¼‚æ­¥ä¸‹è½½å›¾ç‰‡å¹¶ä¸”æ”¯æŒç¼“å­˜çš„æ¡†æ¶ æ¡†æ¶ç®€å›¾ UIImageView+ WebCache : SDWebImageManager : æ ¸å¿ƒå·¥ä½œç±» SDImageCache : å›¾ç‰‡ç¼“å­˜: ç£ç›˜ç¼“å­˜å¤„ç† + å†…å­˜ç¼“å­˜å¤„ç† SDWebImageDownloader: å›¾ç‰‡ä¸‹è½½å™¨ åŠ è½½å›¾ç‰‡æµç¨‹1.é¦–å…ˆæ ¹æ®ç›¸åº”å›¾ç‰‡è¯·æ±‚URLæ‰€å¯¹åº”çš„key, æŸ¥æ‰¾å†…å­˜ç¼“å­˜, å¦‚æœæ‰¾åˆ°è¿”å›ç»™è°ƒç”¨æ–¹2.å¦‚æœæ²¡æœ‰æŸ¥æ‰¾åˆ°,æŸ¥æ‰¾ç£ç›˜ç¼“å­˜,å¦‚æœæ‰¾åˆ°è¿”å›ç»™è°ƒç”¨æ–¹3.å¦‚æœç£ç›˜ç¼“å­˜æ²¡æœ‰æŸ¥æ‰¾åˆ°,å°±è¿›è¡Œç›¸åº”çš„ç½‘ç»œä¸‹è½½ ä¸‰ã€Reactive Cocoaå‡½æ•°å“åº”å¼ç¼–ç¨‹æ¡†æ¶ æ¦‚å¿µRACé¦–å…ˆæ˜¯ä¸€ä¸ªå‡½æ•°å“åº”å¼ç¼–ç¨‹çš„ç¬¬ä¸‰æ–¹åº“ 1)ä¿¡å·RACä¸­çš„æ ¸å¿ƒç±»RACSignal ,RACSignalç»§æ‰¿è‡ªRACStreamRACSignalä¸»è¦æœ‰4ä¸ªå­ç±»: RACDynamicSignal: RACReturnSignal: RACEmptySignal RACErrorSignal ä¿¡å·ä»£è¡¨ä¸€è¿ä¸²çš„çŠ¶æ€,è¿™ä¹ˆä¸€ä¸ªç±»çš„å°è£…. åœ¨çŠ¶æ€æ”¹å˜æ˜¯,å¯¹åº”çš„è®¢é˜…è€…RACSubScriberå°±ä¼šæ”¶åˆ°é€šçŸ¥æ‰§è¡Œç›¸åº”çš„å‘½ä»¤ RACä½¿ç”¨ç±»ç°‡æ¨¡å¼, æŠ½è±¡å·¥å‚æ¨¡å¼. è¿”å›çš„å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡, å®é™…ä¸Šé€šè¿‡ä¸åŒæ–¹æ³•åˆ›å»ºå‡ºæ¥çš„å…·ä½“å¯¹è±¡ä¹Ÿä¸åŒ. 2)è®¢é˜…RACSubScriberé—®é¢˜:æ€æ ·å®ç°è®¢é˜…? é—®é¢˜:è®¢é˜…å†…éƒ¨æ‰§è¡ŒåŸç†? äº§ç”ŸRACSubScriberç±»å, å†…éƒ¨æŒæœ‰ä¸€ä¸ªblockç±»å‹çš„æˆå‘˜å˜é‡didSubscribe, è°ƒç”¨RACSubScriber çš„sendNextæ–¹æ³•æ—¶å®é™…è°ƒç”¨å†…éƒ¨ä¿å­˜çš„block { [RACSignal return:@3]; [RACSignal subScribedNext:^(id x){ NSLog(@&quot;%@&quot;, x); }] } å››ã€AsyncDisplayKit æå‡iOSç•Œé¢æ¸²æŸ“æ€§èƒ½çš„ä¸€ä¸ªæ¡†æ¶ 1ã€ASDKå¤„ç†é—®é¢˜é—®é¢˜: AsyncDisplayKitä¸»è¦å¤„ç†ä»€ä¹ˆé—®é¢˜? ä¸»è¦é€šè¿‡å‡è½»ä¸»çº¿ç¨‹å‹åŠ›, å°†æ›´å¤šçš„äº‹æƒ…å°½é‡æŒªåˆ°å­çº¿ç¨‹å»åš.ä¸»è¦åˆ†3æ–¹é¢:1&gt; Layout è§£å†³å¸ƒå±€çš„è€—æ—¶è¿ç®—: æ–‡æœ¬å®½é«˜è®¡ç®—å’Œè§†å›¾å¸ƒå±€è®¡ç®—.å®é™…ä¸Šå°†æ–‡æœ¬è®¡ç®—å’Œå¸ƒå±€è®¡ç®—ç”±ä¸»çº¿ç¨‹è¿ç§»åˆ°å­çº¿ç¨‹,æ¥å‡å°‘ä¸»çº¿ç¨‹çš„å·¥ä½œæ¶ˆè€—, è…¾æŒªå‡ºæ›´å¤šæ—¶é—´å“åº”ç”¨æˆ·äº¤äº’.2&gt; Rendering æ¸²æŸ“: æ–‡æœ¬æ¸²æŸ“ , å›¾ç‰‡è§£ç å’Œå›¾å½¢ç»˜åˆ¶.3&gt; UIKit Objects: å¯¹è±¡åˆ›å»º å¯¹è±¡è°ƒæ•´ å¯¹è±¡é”€æ¯ 2ã€ASDKåŸºæœ¬åŸç† åŸºæœ¬åŸç†: é’ˆå¯¹ASNodeçš„ä¿®æ”¹å’Œæäº¤, ä¼šå¯¹å…¶è¿›è¡Œå°è£…å¹¶æäº¤åˆ°ä¸€ä¸ªå…¨å±€å®¹å™¨ä¸­ ASDKä¹Ÿåœ¨RunLoopä¸­æ³¨å†Œä¸€ä¸ªObserver å½“RunLoopè¿›å…¥ä¼‘çœ å‰, ASDKæ‰§è¡Œè¯¥loopå†…æäº¤çš„æ‰€æœ‰ä»»åŠ¡ ç¬¬ä¸‰æ–¹æ¡†æ¶é¢è¯•æ€»ç»“:é—®é¢˜:AFNetworkingçš„æ•´ä½“ç»“æ„æ˜¯æ€æ ·çš„? é—®é¢˜:SDWebImageæ˜¯æ€æ ·åŠ è½½å›¾ç‰‡çš„?(å›¾ç‰‡åŠ è½½æµç¨‹) é—®é¢˜:RACçš„ä¿¡å·è®¢é˜…æ˜¯ä»€ä¹ˆæ„æ€?ç­”:ä¿¡å·ä¸€è¿ä¸²çŠ¶æ€çš„æŠ½è±¡, è®¢é˜…ä¿¡å·é€šè¿‡RACSubScriberå®ç°, RACSubScriberå†…éƒ¨æŒæœ‰ä¸€ä¸ªblockç±»å‹çš„æˆå‘˜å˜é‡didSubscribe, è°ƒç”¨RACSubScriber çš„sendNextæ–¹æ³•æ—¶å®é™…è°ƒç”¨å†…éƒ¨ä¿å­˜çš„block, é—®é¢˜:ASDKå®ç°åŸç†æ˜¯æ€æ ·çš„?ç­”: å°è£…ASNodeèŠ‚ç‚¹, å¯¹äºè§†å›¾å±æ€§è®¾ç½®éƒ½è½¬åŒ–ä¸ºASNodeçš„è®¾ç½®,è¿™éƒ¨åˆ†å¯ä»¥æ”¾åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œ,RunLoopå°†è¦ä¼‘çœ å‰,æ¥æ”¶ä¸€ä¸ªé€šçŸ¥æå‰å…¨å±€å®¹å™¨å¯¹åº”çš„ASNode,ä¸€æ¬¡æ€§è®¾ç½®ç»™UIView. è¯¾ç¨‹æ€»ç»“1.ç³»ç»Ÿçš„UIäº‹ä»¶ä¼ é€’æœºåˆ¶æ˜¯æ€æ ·çš„? 2.KVOçš„å®ç°åŸç†æ˜¯æ€æ ·çš„? 3.ç®€ç­”è¯´è¯´æ¶ˆæ¯ä¼ é€’æœºåˆ¶çš„æ¶ˆæ¯è½¬å‘æµå‡º 4.å½“ä¸€ä¸ªobjåºŸå¼ƒçš„æ—¶å€™, æŒ‡å‘å®ƒçš„weakæŒ‡é’ˆä¸ºä½•ä¼šè‡ªåŠ¨ç½®ä¸ºnil? 5.è¯·ä½ ç®€å•è®²ä¸‹iOSæ˜¯æ€æ ·è¿›è¡Œå†…å­˜ç®¡ç†çš„? 6.Blockå®è´¨æ˜¯æ€æ ·çš„?ä½¿ç”¨Blockä¸ºä½•å®¹æ˜“äº§ç”Ÿå¾ªç¯å¼•ç”¨? 7.ç®€å•è¯´è¯´æ€æ ·åˆ©ç”¨GCDå®ç°é«˜æ•ˆçš„å¤šè¯»å•å†™é€»è¾‘? 8.RunLoopä¸ºä½•èƒ½å·¦å³æœ‰äº‹åšäº‹,æ²¡äº‹ä¼‘æ¯? 9.æ€æ ·è§£å†³DNSåŠ«æŒ? 10.åˆ†åˆ«è¯´è¯´ä»€ä¹ˆæ˜¯æ¡¥æ¥æ¨¡å¼, è´£ä»»é“¾æ¨¡å¼? 11.æ€æ ·è®¾è®¡ä¸€ä¸ªå›¾ç‰‡ç¼“å­˜æ¡†æ¶?ç½‘ç»œæ¡†æ¶? 12.è¯·ç¼–å†™æŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­, ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦çš„ç®—æ³• 13.AFNetworkingå¤§è‡´æ˜¯æ€æ ·å®ç°çš„?]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬11ç«  ç®—æ³•ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F29%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC11%E7%AB%A0-%E7%AE%97%E6%B3%95%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ³¨æ„ï¼šæœ¬æ–‡ä¸»è®²ç®—æ³•ç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²åè½¬ã€é“¾è¡¨åè½¬ã€æœ‰åºæ•°ç»„åˆå¹¶ã€Hashç®—æ³•ã€æŸ¥æ‰¾ä¸¤ä¸ªå­è§†å›¾çš„å…±åŒçˆ¶è§†å›¾ã€æ±‚æ— åºæ•°ç»„å½“ä¸­çš„ä¸­ä½æ•°ã€‚ ä¸€ã€å­—ç¬¦ä¸²åè½¬é—®é¢˜:ç»™å®šå­—ç¬¦ä¸²â€hello, worldâ€, å®ç°å°†å…¶åè½¬.è¾“å‡ºç»“æœ: dlrow,oleh ç­”: void char_reverse(char* cha) { // æŒ‡å‘ç¬¬ä¸€ä¸ªå­—ç¬¦ char* begin = cha; // æŒ‡å‘æœ€åä¸€ä¸ªå­—ç¬¦ char* end = cha + strlen(cha) - 1; while (begin &lt; end) { // äº¤æ¢å‰åä¸¤ä¸ªå­—ç¬¦,åŒæ—¶ç§»åŠ¨æŒ‡é’ˆ char temp = *begin; *(begin++) = *end; *(end--) = temp; } } //1.å­—ç¬¦ä¸²åè½¬ char ch[] = &quot;hello,world&quot;; char_reverse(ch); printf(&quot;reverse result is %s \n&quot;, ch); //æ‰“å° reverse result is dlrow,olleh äºŒã€é“¾è¡¨åè½¬é“¾è¡¨å¤´æ’æ³•æ€æƒ³ ReverseList.h //ReverseList.h // å®šä¹‰ä¸€ä¸ªé“¾è¡¨ struct Node { int data; struct Node *next; }; @interface ReverseList : NSObject // é“¾è¡¨åè½¬ struct Node* reverseList(struct Node *head); // æ„é€ ä¸€ä¸ªé“¾è¡¨ struct Node* constructList(void); // æ‰“å°é“¾è¡¨ä¸­çš„æ•°æ® void printList(struct Node *head); @end ReverseList.m //ReverseList.m @implementation ReverseList struct Node* reverseList(struct Node *head) { // å®šä¹‰éå†æŒ‡é’ˆï¼Œåˆå§‹åŒ–ä¸ºå¤´ç»“ç‚¹ struct Node *p = head; // åè½¬åçš„é“¾è¡¨å¤´éƒ¨ struct Node *newH = NULL; // éå†é“¾è¡¨ while (p != NULL) { // è®°å½•ä¸‹ä¸€ä¸ªç»“ç‚¹ struct Node *temp = p-&gt;next; // å½“å‰ç»“ç‚¹çš„nextæŒ‡å‘æ–°é“¾è¡¨å¤´éƒ¨ p-&gt;next = newH; // æ›´æ”¹æ–°é“¾è¡¨å¤´éƒ¨ä¸ºå½“å‰ç»“ç‚¹ newH = p; // ç§»åŠ¨pæŒ‡é’ˆ p = temp; } // è¿”å›åè½¬åçš„é“¾è¡¨å¤´ç»“ç‚¹ return newH; } struct Node* constructList(void) { // å¤´ç»“ç‚¹å®šä¹‰ struct Node *head = NULL; // è®°å½•å½“å‰å°¾ç»“ç‚¹ struct Node *cur = NULL; for (int i = 1; i &lt; 5; i++) { struct Node *node = malloc(sizeof(struct Node)); node-&gt;data = i; // å¤´ç»“ç‚¹ä¸ºç©ºï¼Œæ–°ç»“ç‚¹å³ä¸ºå¤´ç»“ç‚¹ if (head == NULL) { head = node; } // å½“å‰ç»“ç‚¹çš„nextä¸ºæ–°ç»“ç‚¹ else{ cur-&gt;next = node; } // è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºæ–°ç»“ç‚¹ cur = node; } return head; } void printList(struct Node *head){ struct Node* temp = head; while (temp != NULL) { printf(&quot;node is %d \n&quot;, temp-&gt;data); temp = temp-&gt;next; } } @end æ‰§è¡Œè°ƒç”¨ //å•é“¾è¡¨åè½¬ struct Node* head = constructList(); printList(head); printf(&quot;-----------\n&quot;); struct Node* newHead = reverseList(head); printList(newHead); ä¸‰ã€æœ‰åºæ•°ç»„åˆå¹¶ // å°†æœ‰åºæ•°ç»„aå’Œbçš„å€¼åˆå¹¶åˆ°ä¸€ä¸ªæ•°ç»„resultå½“ä¸­ï¼Œä¸”ä»ç„¶ä¿æŒæœ‰åº void mergeList(int a[], int aLen, int b[], int bLen, int result[]) { int p = 0; // éå†æ•°ç»„açš„æŒ‡é’ˆ int q = 0; // éå†æ•°ç»„bçš„æŒ‡é’ˆ int i = 0; // è®°å½•å½“å‰å­˜å‚¨ä½ç½® // ä»»ä¸€æ•°ç»„æ²¡æœ‰åˆ°è¾¾è¾¹ç•Œåˆ™è¿›è¡Œéå† while (p &lt; aLen &amp;&amp; q &lt; bLen) { // å¦‚æœaæ•°ç»„å¯¹åº”ä½ç½®çš„å€¼å°äºbæ•°ç»„å¯¹åº”ä½ç½®çš„å€¼ if (a[p] &lt;= b[q]) { // å­˜å‚¨aæ•°ç»„çš„å€¼ result[i] = a[p]; // ç§»åŠ¨aæ•°ç»„çš„éå†æŒ‡é’ˆ p++; }else{ // å­˜å‚¨bæ•°ç»„çš„å€¼ result[i] = b[q]; // ç§»åŠ¨bæ•°ç»„çš„éå†æŒ‡é’ˆ q++; } // æŒ‡å‘åˆå¹¶ç»“æœçš„ä¸‹ä¸€ä¸ªå­˜å‚¨ä½ç½® i++; } // å¦‚æœaæ•°ç»„æœ‰å‰©ä½™ while (p &lt; aLen) { // å°†aæ•°ç»„å‰©ä½™éƒ¨åˆ†æ‹¼æ¥åˆ°åˆå¹¶ç»“æœçš„åé¢ result[i] = a[p++]; i++; } // å¦‚æœbæ•°ç»„æœ‰å‰©ä½™ while (q &lt; bLen) { // å°†bæ•°ç»„å‰©ä½™éƒ¨åˆ†æ‹¼æ¥åˆ°åˆå¹¶ç»“æœçš„åé¢ result[i] = b[q++]; i++; } } æ‰§è¡Œè°ƒç”¨ int a[5] = {1,4,6,7,9}; int b[8] = {2,3,5,6,8,10,11,12}; //ç”¨äºå­˜å‚¨å½’å¹¶ç»“æœ int result[13]; //å½’å¹¶æ“ä½œ mergeList(a, 5, b, 8, result); //æ‰“å°å½’å¹¶ç»“æœ printf(&quot;merge result is &quot;); for (int i = 0; i &lt; 13; i++) { printf(&quot;%d &quot;, result[i]); } //è¾“å‡º merge result is 1 2 3 4 5 6 6 7 8 9 10 11 12 å››ã€Hashç®—æ³•é—®é¢˜:åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦å¦‚:è¾“å…¥â€abaccdeffâ€ , åˆ™è¾“å‡ºb ç®—æ³•æ€æƒ³: å­—ç¬¦(char)æ˜¯ä¸€ä¸ªé•¿åº¦ä¸º8çš„æ•°æ®ç±»å‹,å› æ­¤æ€»å…±æœ‰å¯èƒ½256ä¸­å¯èƒ½. æ¯ä¸ªå­—æ¯æ ¹æ®å…¶ASCIIç å€¼ä½œä¸ºæ•°ç»„çš„ä¸‹æ ‡å¯¹åº”æ•°ç»„çš„ä¸€ä¸ªæ•°å­—. æ•°ç»„ä¸­å­˜å‚¨çš„æ˜¯æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°. å“ˆå¸Œè¡¨ä¾‹: ç»™å®šå€¼æ˜¯å­—æ¯a, å¯¹åº”ASCIIå€¼æ˜¯97, æ•°ç»„ç´¢å¼•ä¸‹æ ‡ä¸º97.å“ˆå¸Œå‡½æ•°: å»ºç«‹å­—æ¯æˆ–å­—ç¬¦åˆ°å®ƒæ‰€å­˜å‚¨ä½ç½®indexçš„ä¸€ä¸ªæ˜ å°„å…³ç³». f(key)å­˜å‚¨å’ŒæŸ¥æ‰¾éƒ½é€šè¿‡è¯¥å‡½æ•°, æœ‰æ•ˆæé«˜æŸ¥æ‰¾æ•ˆç‡.f(char) =&gt; index //æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦ char findFirstChar(char* cha) { char result = &#39;\0&#39;; // å®šä¹‰ä¸€ä¸ªæ•°ç»„ ç”¨æ¥å­˜å‚¨å„ä¸ªå­—æ¯å‡ºç°æ¬¡æ•° int array[256]; // å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–æ“ä½œ for (int i=0; i&lt;256; i++) { array[i] =0; } // å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆ æŒ‡å‘å½“å‰å­—ç¬¦ä¸²å¤´éƒ¨ char* p = cha; // éå†æ¯ä¸ªå­—ç¬¦ while (*p != &#39;\0&#39;) { // åœ¨å­—æ¯å¯¹åº”å­˜å‚¨ä½ç½® è¿›è¡Œå‡ºç°æ¬¡æ•°+1æ“ä½œ array[*(p++)]++; } // å°†PæŒ‡é’ˆé‡æ–°æŒ‡å‘å­—ç¬¦ä¸²å¤´éƒ¨ p = cha; // éå†æ¯ä¸ªå­—æ¯çš„å‡ºç°æ¬¡æ•° while (*p != &#39;\0&#39;) { // é‡åˆ°ç¬¬ä¸€ä¸ªå‡ºç°æ¬¡æ•°ä¸º1çš„å­—ç¬¦ï¼Œæ‰“å°ç»“æœ if (array[*p] == 1) { result = *p; break; } // åä¹‹ç»§ç»­å‘åéå† p++; } return result; } æ‰§è¡Œç»“æœ char cha[] = &quot;abaccdeff&quot;; char fc = findFirstChar(cha); printf(&quot;this char is %c \n&quot;, fc); //è¾“å‡ºthis char is b äº”ã€æŸ¥æ‰¾ä¸¤ä¸ªå­è§†å›¾çš„å…±åŒçˆ¶è§†å›¾å€’åºæ¯”è¾ƒæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ä¸€æ ·çš„ - (NSArray &lt;UIView *&gt; *)findCommonSuperView:(UIView *)viewOne other:(UIView *)viewOther { NSMutableArray *result = [NSMutableArray array]; // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªè§†å›¾çš„æ‰€æœ‰çˆ¶è§†å›¾ NSArray *arrayOne = [self findSuperViews:viewOne]; // æŸ¥æ‰¾ç¬¬äºŒä¸ªè§†å›¾çš„æ‰€æœ‰çˆ¶è§†å›¾ NSArray *arrayOther = [self findSuperViews:viewOther]; int i = 0; // è¶Šç•Œé™åˆ¶æ¡ä»¶ while (i &lt; MIN((int)arrayOne.count, (int)arrayOther.count)) { // å€’åºæ–¹å¼è·å–å„ä¸ªè§†å›¾çš„çˆ¶è§†å›¾ UIView *superOne = [arrayOne objectAtIndex:arrayOne.count - i - 1]; UIView *superOther = [arrayOther objectAtIndex:arrayOther.count - i - 1]; // æ¯”è¾ƒå¦‚æœç›¸ç­‰ åˆ™ä¸ºå…±åŒçˆ¶è§†å›¾ if (superOne == superOther) { [result addObject:superOne]; i++; } // å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ç»“æŸéå† else{ break; } } return result; } - (NSArray &lt;UIView *&gt; *)findSuperViews:(UIView *)view { // åˆå§‹åŒ–ä¸ºç¬¬ä¸€çˆ¶è§†å›¾ UIView *temp = view.superview; // ä¿å­˜ç»“æœçš„æ•°ç»„ NSMutableArray *result = [NSMutableArray array]; while (temp) { [result addObject:temp]; // é¡ºç€superviewæŒ‡é’ˆä¸€ç›´å‘ä¸ŠæŸ¥æ‰¾ temp = temp.superview; } return result; } å…­ã€æ±‚æ— åºæ•°ç»„å½“ä¸­çš„ä¸­ä½æ•°æ–¹æ¡ˆ: 1&gt;æ’åºç®—æ³•+ä¸­ä½æ•° 2&gt;åˆ©ç”¨å¿«æ’æ€æƒ³(åˆ†æ²»æ€æƒ³) æ’åºç®—æ³•+ä¸­ä½æ•° æ’åºç®—æ³•: å†’æ³¡æ’åº, å¿«é€Ÿæ’åº, å †æ’åºâ€¦ ä¸­ä½æ•°:å½“nä¸ºå¥‡æ•°æ—¶, (n+1)/2 ;å½“nä¸ºå¶æ•°æ—¶, (n/2 + (n/2 + 1)) / 2 ; å¿«æ’æ€æƒ³ å¿«æ’æ€æƒ³: é€‰å–å…³é”®å­—, é«˜ä½äº¤æ›¿æ‰«æ ä»»æ„æŒ‘ä¸€ä¸ªå…ƒç´ , ä»¥è¯¥å…ƒç´ ä¸ºæ”¯ç‚¹, åˆ’åˆ†é›†åˆä¸ºä¸¤éƒ¨åˆ†.å¦‚æœå·¦ä¾§é›†åˆé•¿åº¦æ°ä¸º (n- 1)/2, é‚£ä¹ˆæ”¯ç‚¹æ°ä¸ºä¸­ä½æ•°.å¦‚æœå·¦ä¾§é•¿åº¦æ° &lt; (n- 1)/2, é‚£ä¹ˆä¸­ä½ç‚¹åœ¨å³ä¾§; åä¹‹, ä¸­ä½æ•°åœ¨å·¦ä¾§.è¿›å…¥ç›¸åº”çš„ä¸€ä¾§ç»§ç»­å¯»æ‰¾ä¸­ä½ç‚¹ int findMedian(int a[], int aLen) { int low = 0; int high = aLen - 1; int mid = (aLen - 1) / 2; int div = PartSort(a, low, high); while (div != mid){ if (mid &lt; div){ //å·¦åŠåŒºé—´æ‰¾ div = PartSort(a, low, div - 1); } else{ //å³åŠåŒºé—´æ‰¾ div = PartSort(a, div + 1, high); } } //æ‰¾åˆ°äº† return a[mid]; } int PartSort(int a[], int start, int end) { int low = start; int high = end; //é€‰å–å…³é”®å­— int key = a[end]; while (low &lt; high) { //å·¦è¾¹æ‰¾æ¯”keyå¤§çš„å€¼ while (low &lt; high &amp;&amp; a[low] &lt;= key){ ++low; } //å³è¾¹æ‰¾æ¯”keyå°çš„å€¼ while (low &lt; high &amp;&amp; a[high] &gt;= key){ --high; } if (low &lt; high){ //æ‰¾åˆ°ä¹‹åäº¤æ¢å·¦å³çš„å€¼ int temp = a[low]; a[low] = a[high]; a[high] = temp; } } int temp = a[high]; a[high] = a[end]; a[end] = temp; return low; } æ‰§è¡Œè°ƒç”¨ int list[9] = {12,3,10,8,6,7,11,13,9}; // 3 6 7 8 9 10 11 12 13 // ^ int median = findMedian(list, 9); printf(&quot;the median is %d \n&quot;, median); // the median is 9]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬10ç«  æ¶æ„æ¡†æ¶ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F26%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC10%E7%AB%A0-%E6%9E%B6%E6%9E%84%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ³¨æ„ï¼šæœ¬æ–‡ä¸»è®²æ¶æ„æ¡†æ¶ç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬å›¾ç‰‡ç¼“å­˜ã€é˜…è¯»æ—¶é•¿ç»Ÿè®¡ã€å¤æ‚é¡µé¢ç»“æ„ã€å®¢æˆ·ç«¯æ•´ä½“æ¶æ„ã€‚ é—®é¢˜: æ¶æ„æ¡†æ¶è§£å†³ä»€ä¹ˆé—®é¢˜?ç­”: å¼•å…¥æ¶æ„æ¡†æ¶ä¸ºäº†å®ç°æ¨¡å—åŒ–, å°†å„åŠŸèƒ½æŒ‰æ¨¡å—è¿›è¡Œåˆ’åˆ† åˆ†å±‚ è§£è€¦ é™ä½ä»£ç é‡åˆåº¦ ä¸€ã€å›¾ç‰‡ç¼“å­˜1ã€å›¾ç‰‡ç¼“å­˜é—®é¢˜:æ€æ ·è®¾è®¡ä¸€ä¸ªå›¾ç‰‡ç¼“å­˜æ¡†æ¶? é¦–å…ˆæœ‰Manageræ¨¡å—, ç”¨ä»¥åè°ƒå’Œè°ƒåº¦æ¡†æ¶å†…éƒ¨å„ä¸ªæ¨¡å— å†…å­˜ç®¡ç†æ¨¡å—. æ¯”å¦‚: æ¶‰åŠå›¾ç‰‡ç¼“å­˜ å°±éœ€è¦æ¨¡æ‹Ÿè®¡ç®—æœºç»„æˆåŸç†æ¶‰åŠåˆ°çš„å¤šçº§ç¼“å­˜æ€æƒ³è¿ç”¨ å›¾ç‰‡ç£ç›˜ç¼“å­˜å¤„ç†æ¨¡å—. ç½‘ç»œæ¨¡å—. æœ¬åœ°æ²¡æœ‰å›¾ç‰‡æ”¯æŒé€šè¿‡ç½‘ç»œä¸‹è½½å›¾ç‰‡ä»¥ä¸Šæ„æˆåŸºæœ¬å›¾ç‰‡æ¡†æ¶,å¦‚æœå›¾ç‰‡å‹ç¼©, ä¿å­˜å›¾ç‰‡éœ€è¦è§£å‹ç¼©çš„è¯,éœ€è¦ä»¥ä¸‹æ¨¡å— codeManager è§£ç ç›¸å…³ç®¡ç†è€…. å›¾ç‰‡è§£ç æ¨¡å—. å›¾ç‰‡å‹ç¼©/è§£å‹ç¼©æ¨¡å—. 2ã€å›¾ç‰‡è¯»å†™é—®é¢˜:å›¾ç‰‡é€šè¿‡ä»€ä¹ˆæ–¹å¼è¿›è¡Œè¯»å†™,è¿‡ç¨‹æ˜¯æ€æ ·çš„?ç­”: ä»¥å›¾ç‰‡URLçš„å•å‘Hashå€¼ä½œä¸ºKey, å­˜å‚¨åˆ°å›¾ç‰‡å¯¹åº”æ¡†æ¶ä¸­ å›¾ç‰‡è¯»å–æŒ‰ç…§å¤šçº§ç¼“å­˜è¯»å–å›¾ç‰‡,æäº¤æŸ¥æ‰¾æ•ˆç‡ 3ã€å†…å­˜è®¾è®¡é—®é¢˜:å†…å­˜çš„è®¾è®¡ä¸Šéœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜?ç­”: å­˜å‚¨çš„Size. (å†…å­˜å­˜å‚¨ç©ºé—´å¤§å°) æ·˜æ±°ç­–ç•¥. (æœ‰sizeé™åˆ¶, åè¾¹å†æœ‰æ–°å›¾ç‰‡,éœ€è¦æœ‰æ·˜æ±°ç­–ç•¥) å­˜å‚¨Sizeéœ€è¦è€ƒè™‘å›¾ç‰‡å¤§å°æœ¬èº«,ä»¥åŠä¸åŒå›¾ç‰‡å¤§å°çš„ä½¿ç”¨é¢‘ç‡é«˜ä½é—®é¢˜.é€šè¿‡é˜Ÿåˆ—æ–¹å¼å­˜å–å›¾ç‰‡. æ·˜æ±°ç­–ç•¥:è€ƒè™‘ä¸¤ç§æ–¹æ¡ˆ ä»¥é˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼æ·˜æ±° æ¨¡æ‹Ÿè®¡ç®—æœºä¸­LRU(Least Recently Used æœ€è¿‘æœ€å°‘ä½¿ç”¨)ç®—æ³•. (å¦‚30åˆ†é’Ÿä¹‹å†…æ˜¯å¦ä½¿ç”¨è¿‡) å…·ä½“æ·˜æ±°ç­–ç•¥:1&gt;å®šæ—¶æ£€æŸ¥.2&gt;æé«˜æ£€æŸ¥è§¦å‘é¢‘ç‡: æ¯æ¬¡è¿›è¡Œè¯»å†™æ—¶ å‰åå°åˆ‡æ¢æ—¶.æ³¨æ„å¼€é”€é—®é¢˜ è¡¥å……: LRUç®—æ³•æ˜¯æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¦‚æœä¸€ä¸ªæ•°æ®åœ¨æœ€è¿‘ä¸€æ®µæ—¶é—´éƒ½æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œé‚£ä¹ˆå®ƒåœ¨å°†æ¥è¢«ä½¿ç”¨åˆ°çš„å¯èƒ½æ€§ä¹Ÿå¾ˆå°ã€‚æ•…å½“ç¼“å­˜ç©ºé—´å·²æ»¡çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ·˜æ±°æ‰æœ€ä¹…æ²¡æœ‰è¢«è®¿é—®åˆ°çš„æ•°æ®ã€‚ç†æƒ³çš„LRUç®—æ³•è¯»å†™æ˜¯æ—¶é—´å¤æ‚åº¦åº”è¯¥éƒ½ä¸ºO(1)ã€‚ 4ã€ç£ç›˜è®¾è®¡é—®é¢˜:ç£ç›˜è®¾è®¡éœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜? å­˜å‚¨æ–¹å¼ å¤§å°é™åˆ¶(å¦‚100MB) æ·˜æ±°ç­–ç•¥(å¦‚æŸä¸€å›¾ç‰‡å­˜å‚¨æ—¶é—´è·ä»Šå·²è¶…è¿‡7å¤©) 5ã€ç½‘ç»œè®¾è®¡é—®é¢˜:ç½‘ç»œéƒ¨åˆ†çš„è®¾è®¡éœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜? å›¾ç‰‡è¯·æ±‚æœ€å¤§å¹¶å‘é‡ (æ¯”å¦‚åŒä¸€æ—¶é—´æœ€å¤§è¯·æ±‚æ•°é‡,é™å®šåœ¨10å¼ æˆ–è€…20å¼ ) è¯·æ±‚è¶…æ—¶ç­–ç•¥ (æ¯”å¦‚è¶…æ—¶,å¯ä»¥é‡‡å–é‡è¯•æœºåˆ¶å†å»è¯·æ±‚å›¾ç‰‡, 2æ¬¡å†å¤±è´¥å…ˆä¸è¯·æ±‚è¿™å¼ å›¾ç‰‡) è¯·æ±‚ä¼˜å…ˆçº§ (æ¯”å¦‚ä¸‹è½½æˆ–è€…ç¼“å­˜çš„å›¾ç‰‡æ˜¯å¦å½“å‰ç”¨æˆ·æœ€ç´§æ€¥ä½¿ç”¨, å¦‚æœæ˜¯è¯·æ±‚ä¼˜å…ˆçº§é«˜äº›) 6ã€å›¾ç‰‡è§£ç é—®é¢˜:å¯¹äºä¸åŒæ ¼å¼å›¾ç‰‡,è§£ç é‡‡ç”¨ä»€ä¹ˆæ–¹å¼æ¥åš? åº”ç”¨ç­–ç•¥æ¨¡å¼å¯¹ä¸åŒå›¾ç‰‡æ ¼å¼è¿›è¡Œè§£ç  é—®é¢˜:åœ¨å“ªä¸ªé˜¶æ®µåšå›¾ç‰‡è§£ç å¤„ç†? ç£ç›˜è¯»å–å (ä»ç£ç›˜è¯»å–æ˜¯æœªè§£ç ,æ”¾åˆ°å†…å­˜ä¸­æœ€å¥½è§£ç å®Œæˆ, å› ä¸ºç³»ç»Ÿåœ¨æ˜¾ç¤ºå›¾ç‰‡å‰ä¼šåœ¨ä¸»çº¿ç¨‹è¿›è¡Œå›¾ç‰‡è§£ç æ“ä½œ,å‡å°‘ä¸»çº¿ç¨‹å‹åŠ›) ç½‘ç»œè¯·æ±‚è¿”å›å 7ã€çº¿ç¨‹å¤„ç† äºŒã€é˜…è¯»æ—¶é•¿ç»Ÿè®¡1ã€æ¡†æ¶è®¾è®¡é—®é¢˜:æ€æ ·è®¾è®¡ä¸€ä¸ªæ—¶é•¿ç»Ÿè®¡æ¡†æ¶? 1)è®°å½•å™¨: å¯¹æ¯ä¸€æ¡æ—¶é•¿ç»Ÿè®¡æ•°æ®è¿›è¡Œè®°å½• é¡µé¢å¼è®°å½•å™¨ :å¸¸è§åœºæ™¯:è®°å½•ç”¨æˆ·è¯»å–æˆ–è€…è®¿é—®é¡µé¢æ—¶é•¿,ä¸€èˆ¬ä»é¡µé¢pushå¼€å§‹ä½œä¸ºé˜…è¯»æ—¶é•¿å¼€å§‹èŠ‚ç‚¹, popåä»£è¡¨è®°å½•ç»“æŸ) æµå¼é¡µé¢è®°å½•å™¨ :æ¯”å¦‚æµè§ˆå¾®åšflowæµä»¥åŠè…¾è®¯æ–°é—», å¤´æ¡æ–°é—»,è¿™ç§æ–°é—»çš„é˜…è¯»è®°å½•, æ¯æ¡å®šä¹‰ä¸ºæµå¼è®°å½•å™¨ è‡ªå®šä¹‰å¼è®°å½•å™¨ :æ¯”å¦‚å®é™…ä¸šåŠ¡å¼€å‘,æœ‰ä¸åŒä¸šåŠ¡åœºæ™¯,å¾®åš, è…¾è®¯æ–°é—»æ¨ªæ»‘å¼æ–°é—»æ¡ç›®çš„æ’­æ”¾,ç”±ä¸šåŠ¡æ–¹æ§åˆ¶å…·ä½“æ§åˆ¶å¼€å§‹ç»“æŸçš„é€»è¾‘ 2)è®°å½•ç®¡ç†è€…: ç®¡ç†é€šè¿‡è®°å½•å™¨è®°å½•çš„æ—¶é•¿ç»Ÿè®¡æ•°æ® è®°å½•ç¼“å­˜ : ç£ç›˜å­˜å‚¨ : ç”¨æ¥ç»´æŠ¤å’Œå¤„ç†å¼‚å¸¸åœºæ™¯,å¯èƒ½åˆ°æ—¶å†…å­˜ç¼“å­˜ä¸¢å¤±é—®é¢˜ ä¸Šä¼ å™¨ : ç”¨æ¥å°†æœ¬åœ°æ‰€è®°å½•ä¸‹æ¥çš„æ—¶é•¿æ•°æ®ä¸Šä¼ ç»™serverç«¯ 2ã€è®°å½•çš„ç¼“å­˜&amp;å­˜å‚¨1)é—®é¢˜: ä¸ºä½•è¦æœ‰ä¸åŒç±»å‹è®°å½•å™¨,ä½ çš„è€ƒè™‘æ˜¯ä»€ä¹ˆ?ç­”: åŸºäºä¸åŒåˆ†ç±»åœºæ™¯æä¾›çš„å…³äºè®°å½•çš„å°è£…, é€‚é… 2)é—®é¢˜:è®°å½•çš„æ•°æ®ä¼šç”±äºæŸç§åŸå› ä¸¢å¤±, ä½ æ˜¯æ€æ ·å¤„ç†çš„?(è€ƒå¯Ÿé™ä½ä¸¢å¤±ç‡, ä¸æ˜¯æ¯æ¡éƒ½ä¸ä¸¢å¤±) å®šæ—¶å†™ç£ç›˜æ¯”å¦‚æ¯æ»¡50æ¡,è¿›è¡Œç£ç›˜å†™å…¥ é™å®šå†…å­˜ç¼“å­˜æ¡æ•°(å¦‚10æ¡), è¶…è¿‡è¯¥æ¡æ•°, å³å†™ç£ç›˜ 3ã€è®°å½•ä¸Šä¼ å™¨é—®é¢˜: å…³äºå»¶æ—¶ä¸Šä¼ çš„å…·ä½“åœºæ™¯æœ‰å“ªäº›? å‰åå°åˆ‡æ¢ ä»æ— ç½‘åˆ°æœ‰ç½‘çš„å˜åŒ– é€šç”¨çš„è½»é‡æ¥å£æå¸¦å¦‚æœä»¥ä¼ä¸šçº§å®è·µæ–¹å¼è½åœ°, å»ºè®®ä½¿ç”¨å‰ä¸¤ç§æ˜¯æœ€ä¼˜çš„, æœ€åæœ‰è€¦åˆåœ¨é‡Œè¾¹. é—®é¢˜: é•¿ä¼ æ—¶æœºæ˜¯æ€æ ·æŠŠæ§çš„?ç­”: ç«‹åˆ»ä¸Šä¼  å»¶æ—¶ä¸Šä¼  å®šæ—¶ä¸Šä¼  ä¸‰ã€å¤æ‚é¡µé¢ç»“æ„ MVVMæ¡†æ¶æ€æƒ³ ReactNativeçš„æ•°æ®æµæ€æƒ³ ç³»ç»ŸUIViewæ›´æ–°æœºåˆ¶çš„æ€æƒ³ FaceBookçš„å¼€æºæ¡†æ¶AsyncDisplayKitå…³äºé¢„æ’ç‰ˆçš„è®¾è®¡æ€æƒ³ 1ã€MVVM 2ã€ReactNativeçš„æ•°æ®æµæ€æƒ³ ä»»ä½•ä¸€ä¸ªå­å­™èŠ‚ç‚¹æ˜¯æ²¡æœ‰æƒåˆ©åšè‡ªå·±çš„å˜åŒ–æ›´æ–°çš„, å®ƒå¿…é¡»è¦æŠŠè‡ªå·±å˜åŒ–æ›´æ–°çš„æ¶ˆæ¯ä¼ é€’ç»™æ ¹èŠ‚ç‚¹, ç”±æ ¹èŠ‚ç‚¹è‡ªé¡¶å‘ä¸‹æ–¹å¼è¯¢é—®å“ªäº›éœ€è¦æ›´æ–°.ç”±ä¸»åŠ¨è¡Œä¸ºå˜ä¸ºè¢«åŠ¨è¡Œä¸º. å››ã€å®¢æˆ·ç«¯æ•´ä½“æ¶æ„é—®é¢˜:ä½ æ‰€åœ¨å…¬å¸å®¢æˆ·ç«¯æ•´ä½“æ¶æ„æ˜¯æ€æ ·çš„?å¦‚æœè®©ä½ è®¾è®¡,æ€æ ·è®¾è®¡å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„? ç‹¬ç«‹Appçš„é€šç”¨å±‚æ¯”å¦‚é€šç”¨å±‚ä¸­å¯ä»¥æœ‰æ—¶é•¿ç»Ÿè®¡æ¡†æ¶, å´©æºƒç»Ÿè®¡, ç½‘ç»œçš„ç¬¬ä¸‰æ–¹åº“. è¿™ä¸€å±‚æ¶æ„æ”¾åˆ°ä»»ä½•ä¸€ä¸ªAppä¸­éƒ½å¯ä»¥èµ·åˆ°åº•å±‚æ”¯æ’‘ä½œç”¨, ç‹¬ç«‹äºAPP é€šç”¨ä¸šåŠ¡å±‚:é’ˆå¯¹å½“å‰å…¬å¸æœ‰æŸäº›é€šç”¨çš„åŸºç¡€ç»„ä»¶, æ¯”å¦‚è‡ªå®šä¹‰å¸ƒæ™¯æ§ä»¶, ç‰¹æ®ŠUIImageViewçš„å°è£…. è¿™äº›æ˜¯å’Œå½“å‰å…¬å¸ä¸šåŠ¡æœ‰å…³çš„, å¯¹äºæ•´ä½“Appæ¥è¯´å„ä¸ªä¸šåŠ¡çº¿å¯¹äºé€šç”¨æ§ä»¶éƒ½æœ‰éœ€æ±‚,æŠŠè¿™äº›å†…å®¹æ²‰é™åˆ°é€šç”¨ä¸šåŠ¡å±‚. ä¸­é—´å±‚: åè°ƒè§£è€¦ä½œç”¨ä¸ºäº†å®ç°ä¸šåŠ¡A ä¸šåŠ¡B ä¸šåŠ¡C ä¸šåŠ¡Dçš„è§£è€¦ å„ä¸ªä¸šåŠ¡ä»£ç  é—®é¢˜:ä¸šåŠ¡ä¹‹é—´çš„è§£è€¦é€šä¿¡æ–¹å¼ OpenURL ä¾èµ–æ³¨å…¥ ä¸­é—´å±‚åšä¸šåŠ¡Aå’Œä¸šåŠ¡Cè§£è€¦, ä¸šåŠ¡Cé€šè¿‡æ³¨å…¥æ–¹å¼å°†è‡ªå·±æ³¨å…¥åˆ°ä¸­é—´å±‚, ä¸šåŠ¡Aå»ä¸­é—´å±‚è·å–æ‰€ä¾èµ–çš„æ–¹æ³•æˆ–è€…æˆå‘˜å˜é‡.ä¾‹å¦‚: ä¸­é—´å±‚å®ç°ç­–ç•¥: æŸä¸€ä¸ªä¸šåŠ¡æ–¹é€šè¿‡ä¸€ä¸ªprotocalæ³¨å†Œåˆ°å¯¹åº”ä¸­é—´å±‚ä¸­, åŒæ—¶å®ç°ä¸­é—´å±‚ä»£ç†æ–¹æ³•è¿”å›ç»™ä¸­é—´å±‚ä¸€ä¸ªå…·ä½“å®ä¾‹å¯¹è±¡. ä¸šåŠ¡Aä½¿ç”¨æ—¶, å¯ä»¥é€šè¿‡äº‹å…ˆå’Œä¸šåŠ¡Cå•†é‡çš„åè®®,ä»ä¸­é—´å±‚ä¸­æ ¹æ®æŸä¸€æ–¹æ³•è·å–éµä»æŸä¸€åè®®çš„å®ä¾‹, ç„¶ååœ¨ä¸šåŠ¡Aä¸­æŠŠå®ä¾‹å½“åšå®Œå…¨éµä»åè®®é€æ˜å¯¹è±¡æ¥ä½¿ç”¨. äº”ã€æ¶æ„æ¡†æ¶é¢è¯•æ€»ç»“]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬9ç«  è®¾è®¡æ¨¡å¼ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F26%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC9%E7%AB%A0-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ³¨æ„ï¼šæœ¬æ–‡ä¸»è®²è®¾è®¡æ¨¡å¼ç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬ å¸¸ç”¨å…­å¤§è®¾è®¡åŸåˆ™ã€è´£ä»»é“¾ã€æ¡¥æ¥ã€é€‚é…å™¨ã€å•ä¾‹ã€å‘½ä»¤ã€‚ ä¸€ã€å…­å¤§è®¾è®¡åŸåˆ™ å•ä¸€èŒè´£åŸåˆ™ ä¾èµ–å€’ç½®åŸåˆ™ å¼€é—­åŸåˆ™ é‡Œæ°æ›¿æ¢åŸåˆ™ æ¥å£éš”ç¦»åŸåˆ™ è¿ªç±³ç‰¹æ³•åˆ™ 1)å•ä¸€èŒè´£åŸåˆ™ ä¸€ä¸ªç±»åªåšä¸€ä»¶äº‹ æ¯”å¦‚: UIView å’Œ CALayerå…³ç³», UIViewåªè´Ÿè´£äº‹ä»¶ä¼ é€’å’Œäº‹ä»¶å“åº”,CALayerä¸“é—¨è´Ÿè´£åŠ¨ç”»ä»¥åŠè§†å›¾çš„å±•ç¤º 2)ä¾èµ–å€’ç½®åŸåˆ™ æŠ½è±¡æ¥å£ä¸ä¾èµ–äºå…·ä½“å®ç°, å…·ä½“å®ç°å¯ä»¥ä¾èµ–äºæŠ½è±¡æ¥å£ æ¯”å¦‚å®šä¹‰ä¸€äº›å¤„ç†æ•°æ®è®¿é—®,å¢åˆ æ”¹æŸ¥æ¥å£æ–¹æ³•æ—¶,æ‰€æœ‰ä¸Šå±‚çš„ä¸šåŠ¡è°ƒç”¨éƒ½åº”è¯¥ä¾èµ–äºå®šä¹‰çš„æŠ½è±¡æ¥å£. è‡³äºæ¥å£å†…éƒ¨å…·ä½“å®ç°æ˜¯ç”¨æ•°æ®åº“,è¿˜æ˜¯ç”¨æ–‡ä»¶,ä»¥åŠç”¨plist, userdefault, å¯¹ä¸Šå±‚ä¸šåŠ¡æ¥è¯´æ˜¯æ„ŸçŸ¥ä¸åˆ°çš„, è¿™å°±ä½“ç°äº†é€šè¿‡æŠ½è±¡æ¥å£åè½¬ä¾èµ–.å¯¹äºä¸Šå±‚ä¸šåŠ¡åªä¾èµ–äºæ¥å£å®šä¹‰,æ¯”å¦‚å¢åˆ æ”¹æŸ¥,å¯¹äºå†…éƒ¨é‡‡ç”¨å“ªç§å­˜å‚¨æ–¹æ¡ˆ,ä¸Šå±‚ä¸šåŠ¡æ˜¯ä¸å…³æ³¨çš„.ä¹Ÿæ²¡å¿…è¦æŠŠå…·ä½“å­˜å‚¨æ–¹æ¡ˆæš´éœ²ç»™ä½¿ç”¨æ–¹. 3)å¼€é—­åŸåˆ™ å¯¹ä¿®æ”¹å…³é—­, å¯¹æ‰©å±•å¼€æ”¾ æ¯”å¦‚:å®šä¹‰ä¸€ä¸ªç±»è€ƒè™‘åæœŸæ‰©å±•æ€§å’Œçµæ´»æ€§. å‰æœŸé’ˆå¯¹ä¸€ä¸ªéœ€æ±‚,è¦è€ƒè™‘å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£éœ€æ±‚. å¯¹ç±»çš„æˆå‘˜å˜é‡å®šä¹‰å°½é‡è°¨æ…,é¿å…åé¢é¢‘ç¹ä¿®æ”¹è¿™ä¸ªç±».ç±»çš„æ•°æ®ç»“æ„å®šä¹‰å,åé¢å°±æ˜¯æ ¹æ®éœ€æ±‚æä¾›æ¥å£é—®é¢˜, åŒ…æ‹¬å­ç±»ç»§æ‰¿. 4)é‡Œæ°æ›¿æ¢åŸåˆ™ çˆ¶ç±»å¯ä»¥è¢«å­ç±»æ— ç¼æ›¿æ¢, ä¸”åŸæœ‰åŠŸèƒ½ä¸å—ä»»ä½•å½±å“ æ¯”å¦‚: KVOæœºåˆ¶ 5)æ¥å£éš”ç¦»åŸåˆ™ ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„åè®®,è€Œä¸æ˜¯ä¸€ä¸ªåºå¤§è‡ƒè‚¿çš„åè®® åè®®ä¸­æ–¹æ³•åº”å½“å°½é‡å°‘ æ¯”å¦‚: UITableViewDelegateä¸“é—¨å¤„ç†TableViewå›è°ƒä»£ç†äº‹ä»¶UITableViewDateSourceä¸“é—¨ç”¨äºè·å–TableViewæ•°æ®æº 6)è¿ªç±³ç‰¹æ³•åˆ™ ä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£ é«˜å†…èš,ä½è€¦åˆ å› ä¸ºæ¨¡å—å’Œæ¨¡å—ä¹‹é—´, è¦æƒ³è§£é™¤è€¦åˆ,ä½“ç°å‡ºç¼–ç è§„èŒƒè®©å¯¹è±¡å°½é‡å°‘çš„çŸ¥é“å…¶ä»–å¯¹è±¡éƒ½æœ‰ä»€ä¹ˆ,åŒ…æ‹¬æˆå‘˜å˜é‡,å±æ€§ä»¥åŠå®ƒçš„æ–¹æ³•. äºŒã€è´£ä»»é“¾è´£ä»»é“¾æ¨¡å¼å¯ä»¥è§£å†³ä»»åŠ¡çš„ä¾èµ–å…³ç³»é—®é¢˜. ä¸¾ä¾‹:ä¸€ä¸ªå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªå±æ€§å«nextResponder, è¯¥å±æ€§ä¸å½“å‰å¯¹è±¡å±äºåŒä¸€ä¸ªç±», å½“å½“å‰å¯¹è±¡ä¸èƒ½æ‰§è¡ŒæŸä¸ªæ–¹æ³•æ—¶, å°±è°ƒç”¨ä»–çš„nextResponderæ¥æ‰§è¡ŒåŒæ ·çš„æ–¹æ³•, å°†ä»»åŠ¡ä¼ é€’ä¸‹å».ä½¿ç”¨è¿™ç§æ–¹å¼æ—¶, å½“ä»»åŠ¡çš„ä¾èµ–é¡ºåºå‘ç”Ÿæ”¹å˜æ—¶, åªéœ€è¦è°ƒæ•´å…¶nextResponderçš„æŒ‡å‘å³å¯è°ƒæ•´ä»–çš„å“åº”é“¾é¡ºåº.æˆ‘ä»¬è¿˜å¯ä»¥æ ¹æ®åç«¯ç»™å‡ºçš„å“åº”æ¥åŠ¨æ€è°ƒæ•´å“åº”é“¾é¡ºåº, ç³»ç»Ÿä¸­ä½¿ç”¨è´£ä»»é“¾çš„è®¾è®¡æ¨¡å¼å¤„ç†äº†UIäº‹ä»¶çš„ä¼ é€’æœºåˆ¶ ä¸‰ã€æ¡¥æ¥ ä½¿ç”¨è€…æŒæœ‰æŠ½è±¡çš„åŸºç±»ClassA, ClassAæŒæœ‰æŠ½è±¡çš„åŸºç±»B, è°ƒç”¨æ—¶, æ ¹æ®éœ€è¦å°†A1/A2/A3èµ‹å€¼ç»™è°ƒç”¨è€…åŸå…ˆæŒæœ‰çš„å±æ€§, åœ¨å°†B1/B2/B3æ ¹æ®éœ€æ±‚èµ‹å€¼ç»™ClassA, è¿™æ ·æˆ‘ä»¬å¯ä»¥è‡ªç”±ç»„åˆè°ƒç”¨è€…å’Œå…¶å†…éƒ¨çš„å®é™…è°ƒç”¨, è€Œä½œä¸ºæ¡¥æ¢çš„ClassAä¸ClassBæœ¬èº«ä¸å…³å¿ƒä»–ä»¬çš„å®é™…è°ƒç”¨. é—®é¢˜:æ€æ ·ç†è§£æ¡¥æ¥è®¾è®¡æ¨¡å¼?(ç®€å•è¯­è¨€æè¿°æ¡¥æ¥æ¨¡å¼æ˜¯ä»€ä¹ˆ?)æ¡¥æ¥æ¨¡å¼å¯ä»¥è§£å†³ åˆ—è¡¨å’Œå¤šå¥—æ•°æ®è€¦åˆçš„é—®é¢˜. å››ã€é€‚é…å™¨ä¸€ä¸ªç°æœ‰ç±»éœ€è¦é€‚åº”å˜åŒ–çš„é—®é¢˜é€‚é…å™¨åˆ†ä¸º: å¯¹è±¡é€‚é…å™¨ ç±»é€‚é…å™¨. å½“æˆ‘ä»¬æœ‰ä¸ªä¸€ä¸ªå¹´ä»£ä¹…è¿œçš„åŸºç±», æˆ‘ä»¬ä¸ä¾¿å¯¹å…¶æ·»åŠ å¯¹è±¡å’Œæ–¹æ³•æ—¶, æˆ‘ä»¬å°±å¯ä»¥ä¸ºå…¶æ·»åŠ é€‚é…å™¨, ä½¿ä¸€ä¸ªç±»æŒæœ‰è¯¥åŸºç±», åœ¨è°ƒç”¨è¿™ä¸ªåŸºç±»çš„å‰åæˆ‘ä»¬å¯ä»¥æ’å…¥è‡ªå·±çš„ä»£ç , æ¥é€‚é…æ–°çš„éœ€æ±‚. è¿™ä¹Ÿå°±æ˜¯åšäº†ä¸€æ¬¡ç®€å•çš„å°è£…. - (void)request{ //é€‚é…é€»è¾‘ [è¢«é€‚é…å¯¹è±¡ æŸæ–¹æ³•] //é€‚é…é€»è¾‘ } äº”ã€å•ä¾‹æ¨¡å¼ åœ¨å•ä¾‹æ–¹æ³•ä¸­åˆ›å»ºå®ä¾‹ä½¿ç”¨ [[super allocWithZone:Null] init]; é‡å†™è‡ªèº«çš„allocWithZoneæ–¹æ³•åœ¨å…¶å†…éƒ¨è°ƒç”¨å•ä¾‹æ–¹æ³•ä¿è¯åˆ›å»ºæ°¸è¿œæ˜¯ä¸€ä¸ªå•ä¾‹ éµå®ˆCopyåè®®, é‡å†™copyWithZoneæ–¹æ³•, è¿”å›self, ä»¤å…¶ä¸èƒ½è¢«copy å…­ã€å‘½ä»¤æ¨¡å¼é—®é¢˜:å‘½ä»¤æ¨¡å¼ä¸»è¦è¡¨è¾¾çš„æ˜¯ä»€ä¹ˆ?æˆ‘ä»¬ä¸€èˆ¬ç”¨å‘½ä»¤æ¨¡å¼å¹²ä»€ä¹ˆ? å‘½ä»¤æ¨¡å¼ç”¨æ¥åš è¡Œä¸ºå‚æ•°åŒ– å‘½ä»¤æ¨¡å¼ç”¨æ¥ å‡ä½ä»£ç é‡åˆåº¦ æˆ‘ä»¬å¯ä»¥å°†ä¸€äº›äº‹ä»¶æ‹†åˆ†å¼€æ¥, äº‹ä»¶çš„æ‰§è¡ŒåŠå…¶å›è°ƒä¸Šä¸‹æ–‡ç­‰å°è£…æˆcommendå¯¹è±¡, è°ƒç”¨commendçš„ç®¡ç†è€…å°è£…ä¸ºManagerå•ä¾‹å¯¹è±¡, ä»¥æ­¤æ¥å‡å°‘ä»£ç çš„åˆ†æ•£, è°ƒç”¨æ—¶è¢«è½¬æ¢æˆ, ç”Ÿæˆå‘½ä»¤, ä¸­å¤®ç®¡ç†å™¨æ‰§è¡Œå‘½ä»¤çš„å‘½ä»¤æ¨¡å¼. è¿™å’ŒNSUrlSessionä½¿ç”¨çš„taskæ¨¡å¼ç±»ä¼¼, åˆ›å»ºtask, æ‰§è¡Œtaskçš„æ„Ÿè§‰ è®¾è®¡æ¨¡å¼é¢è¯•æ€»ç»“ï¼š ä½ éƒ½çŸ¥é“å“ªäº›è®¾è®¡åŸåˆ™, è¯·è°ˆè°ˆä½ çš„ç†è§£?ç­”: å•ä¸€èŒè´£åŸåˆ™, ä¾èµ–å€’ç½®åŸåˆ™, å¼€é—­åŸåˆ™, é‡Œæ°æ›¿æ¢åŸåˆ™, æ¥å£éš”ç¦»åŸåˆ™, è¿ªç±³ç‰¹æ³•åˆ™. èƒ½å¦ç”¨ä¸€å¹…å›¾ç®€å•çš„è¡¨ç¤ºæ¡¥æ¥æ¨¡å¼çš„ä¸»ä½“ç»“æ„? UIäº‹ä»¶çš„ä¼ é€’æœºåˆ¶æ˜¯æ€æ ·å®ç°çš„?ä½ å¯¹å…¶ä¸­è¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼æ˜¯æ€æ ·ç†è§£çš„?ç­”:UIè§†å›¾è§’åº¦å›ç­”è®¾è®¡æ¨¡å¼è§’åº¦å›ç­” -&gt; è´£ä»»é“¾æ¨¡å¼. æ‰‹å†™å•ä¾‹å®ç°é‡å†™allcoWithZone/copyWithZoneæ–¹æ³•, ä½¿ç”¨[super allocWithZone:]åˆ›å»ºå•ä¾‹ + (id)sharedInstance { // é™æ€å±€éƒ¨å˜é‡ static Mooc *instance = nil; // é€šè¿‡dispatch_onceæ–¹å¼ ç¡®ä¿instanceåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åªè¢«åˆ›å»ºä¸€æ¬¡ static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ // åˆ›å»ºå®ä¾‹ instance = [[super allocWithZone:NULL] init]; }); return instance; } // é‡å†™æ–¹æ³•ã€å¿…ä¸å¯å°‘ã€‘ + (id)allocWithZone:(struct _NSZone *)zone{ return [self sharedInstance]; } // é‡å†™æ–¹æ³•ã€å¿…ä¸å¯å°‘ã€‘ - (id)copyWithZone:(nullable NSZone *)zone{ return self; }]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬8ç«  ç½‘ç»œç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F25%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC8%E7%AB%A0-%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æ³¨æ„ï¼šæœ¬æ–‡ä¸»è®²ç½‘ç»œç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬HTTPåè®®ã€HTTPSåè®®ä¸ç½‘ç»œå®‰å…¨ã€TCP/UDPåŒºåˆ«ã€DNSè§£æã€‚ ä¸€ã€HTTPåè®®ï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰HTTPåè®®ä¸»è¦åŒ…å«å†…å®¹:è¯·æ±‚/å“åº”æŠ¥æ–‡ã€è¿æ¥å»ºç«‹æµç¨‹ã€HTTPç‰¹ç‚¹ã€‚ 1ã€è¯·æ±‚/å“åº”æŠ¥æ–‡ è¯·æ±‚æŠ¥æ–‡æ ¼å¼:è¯·æ±‚æ–¹æ³• +è¯·æ±‚URL +åè®®ç‰ˆæœ¬+è¯·æ±‚é¦–å­æ®µé”®å€¼å¯¹ +æŠ¥æ–‡ä¸»ä½“ï¼ˆä¸€èˆ¬åœ¨è¯·æ±‚ä¸­æ˜¯æ²¡æœ‰æŠ¥æ–‡ä¸»ä½“çš„ï¼‰ å“åº”æŠ¥æ–‡æ ¼å¼:åè®®ç‰ˆæœ¬ +çŠ¶æ€å— +å“åº”é¦–å­—æ®µ +å“åº”æŠ¥æ–‡ä¸»ä½“ 1)ã€httpçš„è¯·æ±‚æ–¹å¼éƒ½æœ‰å“ªäº›ï¼ŸGETã€POSTã€HEADã€PUTã€DELETEã€OPTIONS (2)ã€GETå’ŒPOSTæ–¹å¼çš„åŒºåˆ«?åˆçº§å·¥ç¨‹å¸ˆå›ç­”1&gt;ã€GETè¯·æ±‚å‚æ•°ä»¥ï¼Ÿåˆ†å‰²æ‹¼æ¥åˆ°URLåé¢ï¼ŒPOSTè¯·æ±‚å‚æ•°åœ¨Bodyé‡Œé¢ã€‚2&gt;ã€GETå‚æ•°é•¿åº¦é™åˆ¶2048ä¸ªå­—ç¬¦ï¼ŒPOSTä¸€èˆ¬æ²¡æœ‰è¯¥é™åˆ¶ã€‚3&gt;ã€GETè¯·æ±‚ä¸å®‰å…¨ï¼ŒPOSTè¯·æ±‚æ¯”è¾ƒå®‰å…¨ã€‚ é«˜çº§å·¥ç¨‹å¸ˆå›ç­”ï¼Œä»è¯­ä¹‰çš„è§’åº¦å›ç­”ï¼ˆæ ‡å‡†ç­”æ¡ˆï¼‰(è¯­ä¹‰:æŒ‡çš„åè®®çš„å®šä¹‰è§„èŒƒ. è¯­æ³•:å…·ä½“å®ç°æ‰‹æ®µæˆ–è€…è·¯å¾„) GETï¼šè·å–èµ„æºã€‚å®‰å…¨çš„ã€å¹‚ç­‰çš„ã€å¯ç¼“å­˜çš„ã€‚ POSTï¼šå¤„ç†èµ„æºã€‚éå®‰å…¨çš„ã€éå¹‚ç­‰çš„ã€ä¸å¯ç¼“å­˜çš„ã€‚ å®‰å…¨æ€§ï¼šä¸åº”è¯¥å¼•èµ·Serverç«¯çš„ä»»ä½•çŠ¶æ€å˜åŒ–ã€‚å¸¸è§å®‰å…¨æ€§çš„è¯·æ±‚æ–¹å¼ ï¼šgetã€headã€options å¹‚ç­‰æ€§ï¼šåŒä¸€ä¸ªè¯·æ±‚æ–¹æ³•æ‰§è¡Œå¤šæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœå®Œå…¨ç›¸åŒã€‚å¸¸è§å¹‚ç­‰æ€§çš„è¯·æ±‚æ–¹å¼ ï¼šgetã€putã€delete å¯ç¼“å­˜æ€§ï¼šè¯·æ±‚æ˜¯å¦å¯ä»¥è¢«ç¼“å­˜ã€‚ï¼ˆä»£ç†æœåŠ¡å™¨å¯ä»¥åšç¼“å­˜ï¼Œå¤šæ¬¡è¯·æ±‚æ—¶å¯èƒ½æ˜¯è·å–çš„ç¼“å­˜ï¼‰ã€‚å¸¸è§å¯ç¼“å­˜æ€§çš„è¯·æ±‚æ–¹å¼ï¼šgetã€head (3)ã€ä½ éƒ½äº†è§£å“ªäº›çŠ¶æ€ç ï¼Œä»–ä»¬çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ1xxï¼š2xxï¼šå“åº”æˆåŠŸï¼ˆ200ï¼‰3xxï¼šç½‘ç»œé‡å®šå‘ï¼ˆ301ã€302ï¼‰4xxï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚å‡ºé”™ï¼ŒæœåŠ¡å™¨æ²¡æœ‰ç›¸åº”ï¼ˆ401ã€404ï¼‰5xxï¼šæœåŠ¡å™¨å‡ºé”™(502 503) 2ã€è¿æ¥å»ºç«‹æµç¨‹ ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡æŒ¥æ‰‹ 3ã€HTTPçš„ç‰¹ç‚¹ï¼šæ— è¿æ¥ã€æ— çŠ¶æ€ã€‚(1)ã€æ— è¿æ¥: æŒ‡çš„æ˜¯httpçš„è¿æ¥æœ‰å»ºç«‹å’Œé‡Šæ”¾è¿æ¥çš„è¿‡ç¨‹ã€‚è§£å†³æ–¹æ¡ˆï¼šHTTPçš„æŒä¹…è¿æ¥ã€‚ 1&gt;ã€æŒä¹…è¿æ¥å¤´éƒ¨å­—æ®µï¼šConnectionï¼škeep-alive (å…è®¸æŒä¹…è¿æ¥)timeï¼š20 ï¼ˆæŒä¹…è¿æ¥è¿æ¥æ—¶é•¿ï¼‰max:10 ï¼ˆè¯¥httpè¿æ¥æœ€å¤šå¯ä»¥å‘ç”Ÿå¤šå°‘æ¬¡è¯·æ±‚ï¼‰ 2&gt;ã€æ€æ ·åˆ¤æ–­ä¸€ä¸ªè¯·æ±‚æ˜¯å¦ç»“æŸï¼ŸContent-length ï¼š1024 ï¼ˆå“åº”å¤´ï¼‰chunkedï¼Œæœ€åä¼šæœ‰ä¸€ä¸ªç©ºçš„chunkedï¼Œserverä¼šç»™å®¢æˆ·ç«¯è¿”å›å¤šæ¬¡å“åº”ï¼Œæ ¹æ®åˆ¤æ–­å“åº”æŠ¥æ–‡çš„å¤´éƒ¨å­—æ®µchunkedæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¡¨ç¤ºæ²¡æœ‰åç»­äº†ã€‚ (2)ã€æ— çŠ¶æ€: å¤šæ¬¡å‘é€httpè¯·æ±‚,å¦‚æœæ˜¯åŒä¸€ä¸ªç”¨æˆ·å¯¹äºserverç«¯æ˜¯ä¸çŸ¥é“æ˜¯åŒä¸€ä¸ªç”¨æˆ·çš„ã€‚è§£å†³æ–¹æ¡ˆï¼šcookieã€sessionã€‚ é—®é¢˜: CharlesæŠ“åŒ…åŸç†æ˜¯å’‹æ ·çš„ï¼Ÿåˆ©ç”¨HTTPä¸­é—´äººæ”»å‡»æ¼æ´å®ç°çš„ã€‚ äºŒã€HTTPSåè®®ä¸ç½‘ç»œå®‰å…¨1ã€HTTPSå’ŒHTTPæœ‰æ€æ ·çš„åŒºåˆ«ï¼ŸHTTPS = HTTP+SSL/TLSã€‚HTTPSæ˜¯å®‰å…¨ç‰ˆçš„HTTPï¼Œ æ˜¯ç”±ä¸€ä¸ªSSL/TLSï¼Œæ’åœ¨ä¼ è¾“å±‚ä¹‹ä¸Šï¼Œåº”ç”¨å±‚ä¹‹ä¸‹çš„åè®®æ¥ä¿è¯çš„ã€‚ 2ã€HTTPSè¿æ¥å»ºç«‹æµç¨‹ï¼š HTTPSè¿æ¥è¿‡ç¨‹å¤§è‡´å¯åˆ†ä¸ºå…«æ­¥: 1ã€å®¢æˆ·ç«¯è®¿é—®HTTPSè¿æ¥ã€‚ å®¢æˆ·ç«¯ä¼šæŠŠå®‰å…¨åè®®ç‰ˆæœ¬å·ã€å®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†ç®—æ³•åˆ—è¡¨ã€éšæœºæ•°Cå‘ç»™æœåŠ¡ç«¯ã€‚ 2ã€æœåŠ¡ç«¯å‘é€è¯ä¹¦ç»™å®¢æˆ·ç«¯ æœåŠ¡ç«¯æ¥æ”¶å¯†é’¥ç®—æ³•é…ä»¶åï¼Œä¼šå’Œè‡ªå·±æ”¯æŒçš„åŠ å¯†ç®—æ³•åˆ—è¡¨è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œåˆ™æ–­å¼€è¿æ¥ã€‚å¦åˆ™ï¼ŒæœåŠ¡ç«¯ä¼šåœ¨è¯¥ç®—æ³•åˆ—è¡¨ä¸­ï¼Œé€‰æ‹©ä¸€ç§å¯¹ç§°ç®—æ³•ï¼ˆå¦‚AESï¼‰ã€ä¸€ç§å…¬é’¥ç®—æ³•ï¼ˆå¦‚å…·æœ‰ç‰¹å®šç§˜é’¥é•¿åº¦çš„RSAï¼‰å’Œä¸€ç§MACç®—æ³•å‘ç»™å®¢æˆ·ç«¯ã€‚ æœåŠ¡å™¨ç«¯æœ‰ä¸€ä¸ªå¯†é’¥å¯¹ï¼Œå³å…¬é’¥å’Œç§é’¥ï¼Œæ˜¯ç”¨æ¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ä½¿ç”¨çš„ï¼ŒæœåŠ¡å™¨ç«¯ä¿å­˜ç€ç§é’¥ï¼Œä¸èƒ½å°†å…¶æ³„éœ²ï¼Œå…¬é’¥å¯ä»¥å‘é€ç»™ä»»ä½•äººã€‚åœ¨å‘é€åŠ å¯†ç®—æ³•çš„åŒæ—¶è¿˜ä¼šæŠŠæ•°å­—è¯ä¹¦å’Œéšæœºæ•°Så‘é€ç»™å®¢æˆ·ç«¯ 3ã€å®¢æˆ·ç«¯éªŒè¯serverè¯ä¹¦ ä¼šå¯¹serverå…¬é’¥è¿›è¡Œæ£€æŸ¥ï¼ŒéªŒè¯å…¶åˆæ³•æ€§ï¼Œå¦‚æœå‘ç°å‘ç°å…¬é’¥æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆHTTPSä¼ è¾“å°±æ— æ³•ç»§ç»­ã€‚ 4ã€å®¢æˆ·ç«¯ç»„è£…ä¼šè¯ç§˜é’¥ å¦‚æœå…¬é’¥åˆæ ¼ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯ä¼šç”¨æœåŠ¡å™¨å…¬é’¥æ¥ç”Ÿæˆä¸€ä¸ªå‰ä¸»ç§˜é’¥(Pre-Master Secretï¼ŒPMS)ï¼Œå¹¶é€šè¿‡è¯¥å‰ä¸»ç§˜é’¥å’Œéšæœºæ•°Cã€Sæ¥ç»„è£…æˆä¼šè¯ç§˜é’¥ 5ã€å®¢æˆ·ç«¯å°†å‰ä¸»ç§˜é’¥åŠ å¯†å‘é€ç»™æœåŠ¡ç«¯ æ˜¯é€šè¿‡æœåŠ¡ç«¯çš„å…¬é’¥æ¥å¯¹å‰ä¸»ç§˜é’¥è¿›è¡Œéå¯¹ç§°åŠ å¯†ï¼Œå‘é€ç»™æœåŠ¡ç«¯ 6ã€æœåŠ¡ç«¯é€šè¿‡ç§é’¥è§£å¯†å¾—åˆ°å‰ä¸»ç§˜é’¥ æœåŠ¡ç«¯æ¥æ”¶åˆ°åŠ å¯†ä¿¡æ¯åï¼Œç”¨ç§é’¥è§£å¯†å¾—åˆ°ä¸»ç§˜é’¥ã€‚ 7ã€æœåŠ¡ç«¯ç»„è£…ä¼šè¯ç§˜é’¥ æœåŠ¡ç«¯é€šè¿‡å‰ä¸»ç§˜é’¥å’Œéšæœºæ•°Cã€Sæ¥ç»„è£…ä¼šè¯ç§˜é’¥ã€‚è‡³æ­¤ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å·²ç»çŸ¥é“äº†ç”¨äºæ­¤æ¬¡ä¼šè¯çš„ä¸»ç§˜é’¥ã€‚ 8ã€æ•°æ®ä¼ è¾“ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘é€æ¥çš„å¯†æ–‡ï¼Œç”¨å®¢æˆ·ç«¯å¯†é’¥å¯¹å…¶è¿›è¡Œå¯¹ç§°è§£å¯†ï¼Œå¾—åˆ°æœåŠ¡å™¨å‘é€çš„æ•°æ®ã€‚ åŒç†ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€æ¥çš„å¯†æ–‡ï¼Œç”¨æœåŠ¡ç«¯å¯†é’¥å¯¹å…¶è¿›è¡Œå¯¹ç§°è§£å¯†ï¼Œå¾—åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ã€‚ (1)ã€ä¼šè¯ç§˜é’¥ï¼šä¼šè¯ç§˜é’¥ = random S + random C + é¢„ä¸»ç§˜é’¥ (2)ã€httpséƒ½ä½¿ç”¨äº†å“ªäº›åŠ å¯†æ‰‹æ®µï¼Ÿä¸ºä»€ä¹ˆ?1&gt;ã€è¿æ¥å»ºç«‹è¿‡ç¨‹ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†å¾ˆè€—æ—¶çš„ã€‚2&gt;ã€åç»­é€šè®¯è¿‡ç¨‹ä½¿ç”¨å¯¹ç§°åŠ å¯†ã€‚ (3)ã€å¯¹ç§°åŠ å¯†(AES)ï¼š (4)ã€éå¯¹ç§°åŠ å¯†(RSA)ï¼š ä¸‰ã€TCP/UDPåŒºåˆ«1ã€UDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)ç‰¹ç‚¹ï¼šæ— è¿æ¥ï¼›å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼ˆä¸ä¿è¯å¯é ä¼ è¾“ï¼‰ï¼›é¢å‘æŠ¥æ–‡ï¼ˆæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼‰ã€‚ åŠŸèƒ½ï¼šå¤ç”¨ã€åˆ†ç”¨ï¼›å·®é”™æ£€æµ‹ã€‚ 2ã€TCP(ä¼ è¾“æ§åˆ¶åè®®)ç‰¹ç‚¹ï¼šé¢å‘è¿æ¥ï¼›å¯é ä¼ è¾“ï¼›é¢å‘å­—èŠ‚æµï¼›æµé‡æ§åˆ¶ï¼›æ‹¥å¡æ§åˆ¶ã€‚ (1)ã€é¢å‘è¿æ¥æ•°æ®ä¼ è¾“å¼€å§‹ä¹‹å‰, éœ€è¦å»ºç«‹è¿æ¥ã€‚ä¸‰æ¬¡æ¡æ‰‹æ•°æ®ä¼ è¾“ç»“æŸä¹‹å, éœ€è¦é‡Šæ”¾è¿æ¥ã€‚å››æ¬¡æŒ¥æ‰‹ é—®é¢˜:TCPä¸‰æ¬¡æ¡æ‰‹ä¸ºä»€ä¹ˆä¸æ˜¯ä¸¤æ¬¡?ä¸ºä»€ä¹ˆè¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ç­”:ä¸‰æ¬¡æ¡æ‰‹åŸå› ï¼ˆä¸æ˜¯ä¸¤æ¬¡æ¡æ‰‹åŸå› ï¼‰ï¼šå½“å®¢æˆ·ç«¯å‘é€è¿æ¥æŠ¥æ–‡æ—¶ï¼Œå½“å‡ºç°ç½‘ç»œè¶…æ—¶æ—¶ï¼Œä¼šå¯åŠ¨è¶…æ—¶é‡å‘ç­–ç•¥ï¼ŒæœåŠ¡ç«¯åŒæ—¶ä¹Ÿä¼šè¿”å›è¶…æ—¶é‡å‘çš„æŠ¥æ–‡ï¼Œå½“å®¢æˆ·ç«¯æ”¶åˆ°çš„æŠ¥æ–‡æ˜¯è¶…æ—¶é‡å‘çš„ï¼Œä¼šå–æ¶ˆå’ŒæœåŠ¡ç«¯åˆ›å»ºè¿æ¥ï¼Œåªä¿è¯ä¼šåˆ›å»ºä¸€ä¸ªTCPè¿æ¥ã€‚ (2)ã€å¯é ä¼ è¾“å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼šä¿è¯æˆ‘ä»¬çš„æŠ¥æ–‡ -&gt;æ— å·®é”™ã€ä¸ä¸¢å¤±ã€ä¸é‡å¤ã€æŒ‰åºåˆ°è¾¾å¦‚ä½•å®ç°å¯é ä¼ è¾“ï¼šé€šè¿‡åœæ­¢ç­‰å¾…åè®®å®ç°ã€‚åœæ­¢ç­‰å¾…åè®®å››æ–¹é¢: æ— å·®é”™æƒ…å†µã€è¶…æ—¶é‡å‘ã€ç¡®è®¤ä¸¢å¤±ã€ç¡®è®¤è¿Ÿåˆ°ã€‚ (3)ã€é¢å‘å­—èŠ‚æµ æ¯æ¬¡å‘é€å¤šå°‘ä¸ªå­—èŠ‚æ˜¯ç”±TCPæ§åˆ¶çš„ ä¸ç®¡å‘é€æ–¹ä¸€æ¬¡æ€§æäº¤ç»™TCPçš„ç¼“å†²æ˜¯å¤šå¤§çš„æ•°æ®, å¯¹äºTCPæœ¬èº«æ¥è¯´å®ƒä¼šæ ¹æ®å®é™…æƒ…å†µæ¥åˆ’åˆ†, å¹¶ä¸æ˜¯å‘é€æ–¹å‘é€äº†10ä¸ªå­—èŠ‚,å°±æŠŠ10ä¸ªå­—èŠ‚ä¸€æ¬¡æ€§å‘ç»™æ¥æ”¶æ–¹,å¯èƒ½ä¼šæŠŠ10å­—èŠ‚æ‹†åˆ†æˆ3ä¸ªå­—èŠ‚å’Œ7ä¸ªå­—èŠ‚åˆ†ä¸¤æ¬¡å‘é€ç»™æ¥æ”¶æ–¹,è¿™ä¸ªå°±æ˜¯é¢å‘å­—èŠ‚æµæ¦‚å¿µ. å¯ä»¥å’ŒUDPé¢å‘æŠ¥æ–‡ç‰¹ç‚¹æ¯”è¾ƒ (4)ã€æµé‡æ§åˆ¶ æ»‘åŠ¨çª—å£åè®®: å‘é€æ–¹å®šä¹‰ä¸ºå®¢æˆ·ç«¯, æ¥æ”¶æ–¹ä¸ºserverç«¯. å½“å‘é€æ•°æ®, å¦‚æœæ¥æ”¶æ–¹æ¥æ”¶ç¼“å­˜æ²¡é‚£ä¹ˆå¤§,æ¥æ”¶çª—å£å¾ˆå°,æ­¤æ—¶å‘é€æ–¹çª—å£å¾ˆå¤§,ä¼šä»¥æ›´å¿«é€Ÿç‡å¾€æ¥æ”¶æ–¹å‘é€æ•°æ®,éœ€è¦ç”±æ¥æ”¶çª—å£é€šè¿‡TCPæŠ¥æ–‡é¦–éƒ¨å­—æ®µä¸­æ›´æ”¹çª—å£å€¼,è°ƒæ•´å‘é€æ–¹å‘é€é€Ÿç‡. (5)ã€æ‹¥å¡æ§åˆ¶æ…¢å¼€å§‹ã€æ‹¥å¡é¿å…(ç­–ç•¥)ï¼›å¿«æ¢å¤ã€å¿«é‡ä¼ (ç­–ç•¥)ã€‚ æ¨ªè½´:äº¤äº’æ¬¡æ•°æˆ–è€…è½®è¯¢æ¬¡æ•° çºµè½´:çª—å£å€¼å¤§å° é—®é¢˜:è¯·ç®€å•æè¿°TCPæ…¢å¯åŠ¨ç‰¹ç‚¹?ç­”:è€ƒå¯ŸTCPæ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ç­–ç•¥ é—®é¢˜:ä»€ä¹ˆæ˜¯TCP? TCPçš„ç†è§£æ˜¯æ€æ ·?ç­”:æ ¹æ®TCPäº”å¤§ç‰¹ç‚¹å›ç­”. å››ã€DNSè§£æ1ã€äº†è§£DNSè§£æé—®é¢˜:æ˜¯å¦äº†è§£DNDè§£æ?DNSè§£ææ˜¯æ€æ ·çš„è¿‡ç¨‹? DNSè§£æ: åŸŸååˆ°IPåœ°å€çš„æ˜ å°„ï¼ŒDNSè§£æè¯·æ±‚é‡‡ç”¨UDPæ•°æ®æŠ¥ï¼Œä¸”æ˜æ–‡è§£æã€‚ 2ã€DNSè§£ææŸ¥è¯¢æ–¹å¼(1)ã€é€’å½’æŸ¥è¯¢ (2)ã€è¿­ä»£æŸ¥è¯¢ 3ã€DNSè§£æå­˜åœ¨å“ªäº›å¸¸è§çš„é—®é¢˜ï¼Ÿ DNSåŠ«æŒé—®é¢˜ DNSè§£æè½¬å‘é—®é¢˜ (1)ã€DNSåŠ«æŒé—®é¢˜ é—®é¢˜: DNSåŠ«æŒä¸HTTPçš„å…³ç³»æ˜¯å’‹æ ·çš„ï¼Ÿç­”: æ²¡æœ‰å…³ç³»ã€‚(1)ã€DNSè§£æå‘ç”Ÿåœ¨HTTPå»ºç«‹è¿æ¥ä¹‹å‰ï¼›(2)ã€DNSè§£æè¯·æ±‚ä½¿ç”¨UDPæ•°æ®æŠ¥ï¼Œç«¯å£å·53ã€‚ (2)ã€DNSè§£æè½¬å‘é—®é¢˜ é—®é¢˜: æ€æ ·è§£å†³DNSåŠ«æŒï¼Ÿç­”: ä¸¤ç§è§£å†³æ–¹æ¡ˆ: httpDNS å’Œé•¿è¿æ¥ 1&gt;ã€httpDNSDNSè§£æå®è´¨ä¸Š ,ä½¿ç”¨DNSåè®®å‘DNSæœåŠ¡å™¨53ç«¯å£è¿›è¡Œè¯·æ±‚ â€“&gt;ä½¿ç”¨httpDNS ,å®è´¨ä¸Šä½¿ç”¨HTTPåè®®å‘DNSæœåŠ¡å™¨80ç«¯å£è¿›è¡Œè¯·æ±‚,ä¸äº§ç”Ÿæ­£å¸¸çš„DNSè§£æäº†,ä¹Ÿå°±ä¸æ¶‰åŠåˆ°DNSåŠ«æŒé—®é¢˜. 2&gt;ã€é•¿è¿æ¥ é•¿è¿serverç†è§£ä¸ºä»£ç†æœåŠ¡å™¨. å®¢æˆ·ç«¯å’Œé•¿è¿serverå¯ä»¥å»ºç«‹TCPçš„é•¿è¿é€šé“.(å®¢æˆ·ç«¯å‘é€httpè¯·æ±‚,å¯ä»¥é€šè¿‡é•¿è¿é€šé“æŠŠhttpè¯·æ±‚ä¼ ç»™é•¿è¿server.) é•¿è¿serveré€šè¿‡å†…ç½‘ä¸“çº¿è¿›è¡Œå†…ç½‘çš„DNSçš„è§£æ,è¿™æ ·å°±è§„é¿äº†å…¬ç½‘DNSè§£æé—®é¢˜. äº”ã€Session/Cookie Session/Cookie æ˜¯å¯¹HTTPåè®®æ— çŠ¶æ€ç‰¹ç‚¹çš„è¡¥å¿. 1&gt;ã€Cookieé—®é¢˜:ä»€ä¹ˆæ˜¯Cookie?Cookieä¸»è¦ç”¨æ¥è®°å½•ç”¨æˆ·çŠ¶æ€, åŒºåˆ†ç”¨æˆ·; çŠ¶æ€ä¿å­˜åœ¨å®¢æˆ·ç«¯. 1ã€æ€æ ·è®¾ç½®Cookieï¼Ÿ(1)ã€ å®¢æˆ·ç«¯å‘é€çš„Cookieåœ¨httpè¯·æ±‚æŠ¥æ–‡çš„Cookieé¦–éƒ¨å­—æ®µä¸­ï¼›(2)ã€ æœåŠ¡å™¨ç«¯è®¾ç½®httpå“åº”æŠ¥æ–‡çš„Set-Cookieé¦–éƒ¨å­—æ®µ, å‘å®¢æˆ·ç«¯ä¼ é€’Cookieå†…å®¹ã€‚ 2ã€æ€æ ·ä¿®æ”¹Cookieï¼Ÿ(1)ã€æ–°Cookieè¦†ç›–æ—§Cookieã€‚(2)ã€è¦†ç›–è§„åˆ™ï¼šè¯·æ±‚å¤´éƒ¨å­—æ®µ nameã€pathã€domainç­‰éœ€è¦ä¸åŸCookieä¸€è‡´ã€‚ 3ã€æ€æ ·åˆ é™¤Cookieï¼Ÿ(1)ã€æ–°Cookieè¦†ç›–æ—§Cookieã€‚(2)ã€è¦†ç›–è§„åˆ™ï¼šnameã€pathã€domainç­‰éœ€è¦ä¸åŸCookieä¸€è‡´ã€‚(3)ã€è®¾ç½®Cookieçš„expires=è¿‡å»çš„ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œæˆ–è€…maxAge=0ã€‚ 4ã€æ€æ ·ä¿è¯Cookieçš„å®‰å…¨ï¼Ÿ(1)ã€å¯¹Cookieè¿›è¡ŒåŠ å¯†å¤„ç†ã€‚(ä¼šæœ‰è„šæœ¬æ”»å‡»è·å–Cookie)(2)ã€åªåœ¨HTTPSä¸Šæºå¸¦Cookieã€‚(3)ã€è®¾ç½®Cookieä¸ºhttpOnlyï¼Œé˜²æ­¢è·¨ç«™è„šæœ¬æ”»å‡»ã€‚ 2&gt;ã€SessionSessionä¹Ÿæ˜¯ç”¨æ¥è®°å½•ç”¨æˆ·çŠ¶æ€ï¼ŒåŒºåˆ†ç”¨æˆ·çš„ï¼›çŠ¶æ€å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯ã€‚Sessionå’ŒCookieçš„å…³ç³»æ˜¯æ€æ ·çš„ï¼ŸSessionéœ€è¦ä¾èµ–äºCookieæœºåˆ¶ã€‚ å…­ã€ç½‘ç»œç›¸å…³é¢è¯•é—®é¢˜æ€»ç»“ï¼š1ã€HTTPä¸­çš„getå’Œpostæ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç­”: è§ä¸Šæ–‡ 2ã€HTTPSè¿æ¥å»ºç«‹çš„æµç¨‹æ˜¯å’‹æ ·çš„ï¼Ÿç­”: 3ã€TCPå’ŒUDPæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç­”:(å¯ä»¥ä»ç‰¹ç‚¹å’ŒåŠŸèƒ½å›ç­”)TCPï¼šé¢å‘è¿æ¥ï¼›å¯é ä¼ è¾“ï¼›é¢å‘å­—èŠ‚æµï¼›æµé‡æ§åˆ¶ï¼›æ‹¥å¡æ§åˆ¶ã€‚UDPï¼šå¤ç”¨ã€åˆ†ç”¨ï¼›å·®é”™æ£€æµ‹ åŸºæœ¬çš„ä¼ è¾“åŠŸèƒ½ã€‚ æ— è¿æ¥ï¼›å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ï¼ˆä¸ä¿è¯å¯é ä¼ è¾“ï¼‰ï¼›é¢å‘æŠ¥æ–‡ï¼ˆæ—¢ä¸åˆå¹¶ï¼Œä¹Ÿä¸æ‹†åˆ†ï¼‰ã€‚ 4ã€è¯·ç®€è¿°TCPçš„æ…¢å¼€å§‹è¿‡ç¨‹ï¼Ÿç­”: TCPæ…¢å¼€å§‹ã€æ‹¥å¡é¿å…ç­–ç•¥å›ç­” 5ã€å®¢æˆ·ç«¯æ€æ ·é¿å…DNSåŠ«æŒï¼Ÿç­”: ä¸¤ç§è§£å†³æ–¹æ¡ˆ: httpDNS å’Œé•¿è¿æ¥]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬7ç«  RunLoopç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F25%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC7%E7%AB%A0-RunLoop%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²RunLoopç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬RunLoopæ¦‚å¿µã€æ•°æ®ç»“æ„ã€äº‹ä»¶å¾ªç¯æœºåˆ¶ã€RunLoopä¸NSTimerã€RunLoopä¸å¤šçº¿ç¨‹ã€‚ ä¸€ã€RunLoopæ¦‚å¿µ1ã€ é—®é¢˜:ä»€ä¹ˆæ˜¯RunLoop?ç­”:RunLoopæ˜¯é€šè¿‡å†…éƒ¨ç»´æŠ¤çš„äº‹ä»¶å¾ªç¯æ¥å¯¹äº‹ä»¶/æ¶ˆæ¯è¿›è¡Œç®¡ç†çš„ä¸€ä¸ªå¯¹è±¡ã€‚1ã€æ²¡æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶ï¼Œä¼‘çœ ä»¥é¿å…èµ„æºå æœ‰ã€‚2ã€æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶ï¼Œç«‹åˆ»è¢«å”¤é†’ã€‚ 2ã€EventLoopæ²¡æœ‰æ¶ˆæ¯éœ€è¦è¢«å¤„ç†æ—¶, ç³»ç»Ÿä¼šå°†å½“å‰çº¿ç¨‹æ‰€æœ‰æƒè½¬åŒ–ä¸ºå†…æ ¸æ€, å½“æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶, ç³»ç»Ÿä¼šå°†å½“å‰çº¿ç¨‹çš„çŠ¶æ€åˆ‡æ¢å›ç”¨æˆ·æ€.æ‰€ä»¥RunLoopçš„å¾ªç¯å¹¶ä¸æ˜¯ä¸€ä¸ªå•çº¯çš„æ­»å¾ªç¯, è€Œæ˜¯é€šè¿‡çŠ¶æ€åˆ‡æ¢, è¾¾åˆ°æ²¡æœ‰æ¶ˆæ¯æ—¶ä¼‘çœ , æœ‰æ¶ˆæ¯æ—¶å”¤é†’çš„è¿™æ ·ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶. åœ¨æ²¡æœ‰æ¶ˆæ¯å¤„ç†æ—¶ï¼Œä¼‘çœ ä»¥é¿å…èµ„æºå ç”¨ï¼Œå®ƒçš„çŠ¶æ€åˆ‡æ¢æ˜¯æ€ä¹ˆæ ·çš„? æ²¡æœ‰æ¶ˆæ¯å¤„ç† æ˜¯ä»ç”¨æˆ·æ€é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸æ€.ä¹Ÿå°±æ˜¯å½“æ²¡æœ‰æ¶ˆæ¯è¦å¤„ç†æ—¶ï¼Œè¿›ç¨‹æˆ–è€…è¯´çº¿ç¨‹ä¼šè¿›å…¥ä¸€ä¸ªä¼‘çœ çŠ¶æ€ï¼Œè€Œä¼‘çœ çŠ¶æ€çš„ä¸€ä¸ªè¿‡æ¸¡ç›¸å½“äºæ˜¯æŠŠå½“å‰çº¿ç¨‹çš„æ§åˆ¶æƒè½¬ç§»ç»™äº†å†…æ ¸æ€ å½“æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶å°±ä¼šè¢«ç«‹åˆ»å”¤é†’å®é™…ä¸Šå°±æ˜¯ç”±å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„ä¸€ä¸ªçŠ¶æ€åˆ‡æ¢ ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ä»‹ç»ï¼š åº”ç”¨ç¨‹åºä¸€èˆ¬éƒ½æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€ä¸Šé¢ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è¿›ç¨‹åŒ…æ‹¬å¼€å‘æ‰€ä½¿ç”¨çš„ç»å¤§å¤šæ•°çš„ API éƒ½æ˜¯é’ˆå¯¹äºç”¨æˆ·å±‚é¢çš„. è€Œå½“å‘ç”Ÿäº†ç³»ç»Ÿè°ƒç”¨ï¼Œéœ€è¦ä½¿ç”¨ä¸€äº›å…³äºæ“ä½œç³»ç»Ÿï¼Œä»¥åŠä¸€äº›åº•å±‚å†…æ ¸ç›¸å…³çš„ä¸€äº›æŒ‡ä»¤æˆ–è€… API çš„è¯ï¼Œå°±è§¦å‘äº†ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œæœ‰äº›ç³»ç»Ÿè°ƒç”¨å°±ä¼šå‘ç”ŸçŠ¶æ€ç©ºé—´çš„åˆ‡æ¢ï¼Œè¿™ç§åˆ‡æ¢ç©ºé—´æˆ–è€…è¯´ä¹‹æ‰€ä»¥åŒºåˆ†ç”¨æˆ·æ€å’Œå†…æ ¸æ€å®é™…ä¸Šæ˜¯å¯¹Â·è®¡ç®—æœºçš„ä¸€äº›èµ„æºè°ƒåº¦Â·ï¼ŒåŒ…æ‹¬èµ„æºç®¡ç†è¿›è¡Œä¸€ä¸ªç»Ÿä¸€æˆ–è€…è¯´ä¸€è‡´æ€§çš„æ“ä½œï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥åˆç†çš„å®‰æ’èµ„æºè°ƒåº¦ï¼ŒåŒ…æ‹¬å¯ä»¥é¿å…ä¸€äº›ç‰¹æ®Šçš„å¼‚å¸¸ æ¯”å¦‚è¯´åœ¨å†…æ ¸æ€å¾€å¾€æœ‰ä¸€äº›çº¿æ€§æŒ‡ä»¤ï¼Œä¸­æ–­ï¼ŒåŒ…æ‹¬ä¸€äº›å¼€æœºå…³æœºçš„ä¸€äº›æ“ä½œï¼Œå¦‚æœè¯´æ¯ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å¯ä»¥å‡æƒ³æ˜¯ä¸€ä¸ª appï¼Œæ¯ä¸€ä¸ª app éƒ½å¯ä»¥ä¿ƒä½¿å½“å‰ç”¨æˆ·æ‰‹æœºå…³æœºæˆ–è€…è¯´ä¸­æ–­ï¼Œè¿™ç§åœºæ™¯æ˜¯æ— æ³•æƒ³è±¡çš„ï¼Œæ‰€ä»¥è¦æœ‰ä¸€ä¸ªç”¨æˆ·æ€åˆ°å†…æ ¸æ€ä¸Šé¢çš„ä¸€ä¸ªåŒºåˆ†ï¼ŒåŒæ—¶å†…æ ¸æ€é‡Œé¢çš„ä¸€äº›å†…å®¹å¯ä»¥å¯¹ç”¨æˆ·æ€å½“ä¸­çš„ä¸€äº›çº¿ç¨‹è¿›è¡Œè°ƒåº¦å’Œç®¡ç†åŒ…æ‹¬è¿›ç¨‹é—´çš„ä¸€äº›é€šä¿¡ é—®é¢˜:mainå‡½æ•°ä¸ºä»€ä¹ˆèƒ½ä¿è¯ä¸€ç›´è¿è¡ŒçŠ¶æ€ä¸é€€å‡º?ç­”: åœ¨mainå‡½æ•°ä¸­è°ƒç”¨UIApplicationMain()å‡½æ•°, è¿™ä¸ªå‡½æ•°å†…éƒ¨ä¼šå¯åŠ¨ä¸€ä¸ªä¸»çº¿ç¨‹çš„RunLoop RunLoopæ˜¯å¯¹äº‹ä»¶å¾ªç¯çš„ç»´æŠ¤æœºåˆ¶, å¯ä»¥ä¸æ–­çš„æ¥æ”¶æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯´ç‚¹å‡»å±å¹•çš„äº‹ä»¶ï¼Œæ»‘åŠ¨åˆ—è¡¨ï¼ŒåŠå¤„ç†ç½‘ç»œè¯·æ±‚çš„è¿”å›ï¼Œé‚£ä¹ˆæ¥æ”¶æ¶ˆæ¯ä¹‹åå¯¹è¿™ä¸ªäº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œä¹‹åå°±ä¼šå†è¿›è¡Œç­‰å¾…, é€šè¿‡ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢, ä»è€Œé¿å…èµ„æºå ç”¨, è®©å½“å‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€. æ³¨æ„:ç­‰å¾… != æ­»å¾ªç¯ ï¼ŒRunLoopçš„å¾ªç¯é€šè¿‡çŠ¶æ€åˆ‡æ¢, è¾¾åˆ°æ²¡æœ‰æ¶ˆæ¯æ—¶ä¼‘çœ ,ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€,æœ‰æ¶ˆæ¯æ—¶å”¤é†’,å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€çš„è¿™æ ·ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶ ä»€ä¹ˆæ˜¯äº‹ä»¶å¾ªç¯ï¼Œäº‹ä»¶å¾ªç¯çš„æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ ç»´æŠ¤çš„äº‹ä»¶å¾ªç¯å¯ä»¥ç”¨æ¥ä¸æ–­çš„å¤„ç†æ¶ˆæ¯æˆ–è€…è¯´äº‹ä»¶ï¼Œå¯¹ä»–ä»¬è¿›è¡Œç®¡ç† åŒæ—¶å½“æ²¡æœ‰æ¶ˆæ¯éœ€è¦ç®¡ç†æ—¶ç”¨ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç”±æ­¤å¯ä»¥ç”¨æ¥è¿›è¡Œå½“å‰çº¿ç¨‹çš„ä¼‘çœ ï¼Œç„¶åé¿å…èµ„æºå ç”¨ åŒæ—¶å½“æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶ï¼Œä¼šå‘ç”Ÿä»å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œç„¶åå½“å‰çš„ç”¨æˆ·çº¿ç¨‹ä¼šè¢«å”¤é†’ æ‰€ä»¥çŠ¶æ€çš„åˆ‡æ¢æ‰æ˜¯ RunLoop çš„å…³é”®ç‚¹ äºŒã€RunLoopçš„æ•°æ®ç»“æ„RunLoopå¼€æºä»£ç åœ°å€åœ¨ OC ä¸­å®é™…æä¾›äº†ä¸¤ä¸ª RunLoop çš„ã€‚ä¸€ä¸ªæ˜¯ NSRunLoopï¼Œä¸€ä¸ªæ˜¯ CFRunLoopã€‚NSRunLoop æ˜¯å¯¹ CFRunLoop çš„å°è£…ï¼Œæä¾›äº†ä¸€äº›é¢å‘å¯¹è±¡çš„ APIã€‚NSRunLoop æ˜¯ä½äº Foundation å½“ä¸­çš„ï¼ŒCFRunLoop ä½äº CoreFoundation å½“ä¸­çš„ã€‚ RunLoop çš„æ•°æ®ç»“æ„ä¸»è¦æœ‰ä¸‰ä¸ªï¼š CFRunLoop CFRunLoopMode Source/Timer/Observer ####1ã€CFRunLoop CFRunLoopæ•°æ®ç»“æ„ ç”±äº”éƒ¨åˆ†ç»„æˆ: pthread ã€currentModeã€modesã€commonModesã€commonModeItems //æºç  struct __CFRunLoop { CFMutableSetRef _commonModes; // Set CFMutableSetRef _commonModeItems; // Set CFRunLoopModeRef _currentMode; // Current Runloop Mode CFMutableSetRef _modes; // Set ... }; (1)ã€pthreadï¼šä¸€ä¸€å¯¹åº”(RunLoopå’Œçº¿ç¨‹çš„å…³ç³») (2)ã€currentModeï¼šCFRunLoopMode (3)ã€modesï¼šNSMutableSet&lt;CFRunLoopMode*&gt; (4)ã€commonModesï¼šNSMutableSet&lt;NSString*&gt;1&gt;ã€commonModeä¸æ˜¯å®é™…å­˜åœ¨çš„ä¸€ç§Modeã€‚ 2&gt;ã€æ˜¯åŒæ­¥Source/Timer/Observeråˆ°å¤šä¸ªModeä¸­çš„ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆã€‚ (5)ã€commonModeItemsï¼šåŒ…å«Observerã€Timerã€Source 2ã€CFRunLoopModeæ•°æ®ç»“æ„ //æºç  struct __CFRunLoopMode { CFStringRef _name; // Mode Name, ä¾‹å¦‚ @&quot;kCFRunLoopDefaultMode&quot; CFMutableSetRef _sources0; // Set CFMutableSetRef _sources1; // Set CFMutableArrayRef _observers; // Array CFMutableArrayRef _timers; // Array ... }; name: å¯¹åº”æŸä¸€ä¸ªrunloopModeåç§°(å¦‚ NSDefaultRunLoopMode) sources0: MutableSet é›†åˆç±»å‹æ•°æ®ç»“æ„ sources1: MutableSet é›†åˆç±»å‹æ•°æ®ç»“æ„ observers: MutableArray timers: MutableArray 3ã€Source/Timer/Observer åœ¨ CF æ¡†æ¶å½“ä¸­å®˜æ–¹åç§°å« CFRunLoopSource ï¼Œæœ‰ä¸¤ç§ source0 å’Œ source1å”¤é†’çº¿ç¨‹å°±æ˜¯ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€1&gt;ã€CFRunLoopSourcesource0ï¼šéœ€è¦æ‰‹åŠ¨å”¤é†’çº¿ç¨‹ã€‚source1ï¼šå…·å¤‡å”¤é†’çº¿ç¨‹çš„èƒ½åŠ›ã€‚ source0: éç³»ç»Ÿäº‹ä»¶.åªåŒ…å«äº†ä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå®ƒå¹¶ä¸èƒ½ä¸»åŠ¨è§¦å‘äº‹ä»¶ã€‚ä½¿ç”¨æ—¶ï¼Œä½ éœ€è¦å…ˆè°ƒç”¨ CFRunLoopSourceSignal(source)ï¼Œå°†è¿™ä¸ª Source æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨ CFRunLoopWakeUp(runloop) æ¥å”¤é†’ RunLoopï¼Œè®©å…¶å¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚ source1 ï¼š ç³»ç»Ÿäº‹ä»¶åŒ…å«äº†ä¸€ä¸ª mach_portå’Œä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œè¢«ç”¨äºé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ã€‚è¿™ç§ Source èƒ½ä¸»åŠ¨å”¤é†’ RunLoop çš„çº¿ç¨‹ 2&gt;ã€CFRunLoopTimeråŸºäºäº‹ä»¶çš„å®šæ—¶å™¨ï¼Œå’ŒNSTimeræ˜¯toll-free bridgedçš„ã€‚å’Œå¹³æ—¶æ‰€ä½¿ç”¨çš„ NSTimer æ˜¯å…·å¤‡å…è´¹æ¡¥è½¬æ¢çš„ 3&gt;ã€CFRunLoopObserveræŸä¸ªobserverå¯ä»¥ç›‘å¬runloopçš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶ä½œå‡ºä¸€å®šååº”ã€‚ è§‚æµ‹æ—¶é—´ç‚¹ KCFRunLoopEntry (RunLoopå…¥å£æ—¶æœº) KCFRunLoopBeforeTimers (é€šçŸ¥è§‚å¯Ÿè€…RunLoopå°†è¦å¯¹timerä¸€äº›ç›¸å…³äº‹ä»¶è¿›è¡Œå¤„ç†) KCFRunLoopBeforeSources (å°†è¦å¯¹å¤„ç†ä¸€äº›sourcesäº‹ä»¶) KCFRunLoopBeforeWaiting (é€šçŸ¥è§‚å¯Ÿè€…RunLoopå°†è¦è¿›å…¥ä¼‘çœ çŠ¶æ€, å³å°†è¦å‘ç”¨æˆ·æ€åˆ°å†…æ ¸æ€åˆ‡æ¢) KCFRunLoopAfterWaiting (å†…æ ¸æ€åˆ°ç”¨æˆ·æ€åˆ‡æ¢ä¸ä¹…) KCFRunLoopExit (RunLoopé€€å‡ºé€šçŸ¥) å¯ä»¥é€šè¿‡æ³¨å†Œä¸€äº› Observer æ¥å®ç°å¯¹ RunLoop çš„ä¸€äº›ç›¸å…³æ—¶é—´ç‚¹çš„ç›‘æµ‹æˆ–è€…è§‚å¯Ÿã€‚ 4ã€å„ä¸ªæ•°æ®ç»“æ„ä¹‹é—´å…³ç³»é—®é¢˜:RunLoop å’ŒModeä»¥åŠ Modeå’Œå…¶å¯¹åº”çš„ Source ,Timer , Observer æœ‰ä»€ä¹ˆå…³ç³»?ç­”: ä¸€ä¸ªrunLoopå¯ä»¥æœ‰å¤šä¸ªmode, ä¸€å¯¹å¤šå…³ç³» mode å’ŒSource, Timer, Observer æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»å¯ä»¥çœ‹åˆ°, ä¸€ä¸ªRunLoopå¯ä»¥æœ‰å¤šä¸ªMode, è€Œæ¯ä¸ªModeä¸­åˆå¯ä»¥å­˜æ”¾å¤šä¸ªä¸åŒçš„äº‹ä»¶, æˆ‘ä»¬åœ¨åˆ‡æ¢Modeæ—¶, å…¶ä»–Modeçš„äº‹ä»¶å°†ä¸ä¼šè¢«å“åº”. 5ã€RunLoopçš„Mode Runloop Mode å®é™…ä¸Šæ˜¯ Sourceï¼ŒTimer å’Œ Observer çš„é›†åˆï¼Œä¸åŒçš„ Mode æŠŠä¸åŒç»„çš„ Sourceï¼ŒTimer å’Œ Observer éš”ç»å¼€æ¥ã€‚Runloop åœ¨æŸä¸ªæ—¶åˆ»åªèƒ½è·‘åœ¨ä¸€ä¸ª Mode ä¸‹ï¼Œå¤„ç†è¿™ä¸€ä¸ª Mode å½“ä¸­çš„ Sourceï¼ŒTimer å’Œ Observerã€‚ è‹¹æœæ–‡æ¡£ä¸­æåˆ°çš„ Mode æœ‰äº”ä¸ªï¼Œåˆ†åˆ«æ˜¯ï¼š NSDefaultRunLoopModeï¼šé»˜è®¤çš„modeï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½æ˜¯åœ¨è¿™ä¸ªmode NSConnectionReplyMode NSModalPanelRunLoopMode NSEventTrackingRunLoopModeï¼šä½¿ç”¨è¿™ä¸ªModeå»è·Ÿè¸ªæ¥è‡ªç”¨æˆ·äº¤äº’çš„äº‹ä»¶ï¼ˆæ¯”å¦‚UITableViewä¸Šä¸‹æ»‘åŠ¨ï¼‰ NSRunLoopCommonModes iOS ä¸­å…¬å¼€æš´éœ²å‡ºæ¥çš„åªæœ‰ NSDefaultRunLoopMode å’Œ NSRunLoopCommonModesã€‚ NSRunLoopCommonModes å®é™…ä¸Šæ˜¯ä¸€ä¸ª Mode çš„é›†åˆï¼Œé»˜è®¤åŒ…æ‹¬ NSDefaultRunLoopMode å’Œ NSEventTrackingRunLoopModeã€‚ é—®é¢˜:RunLoopä¸ºä»€ä¹ˆä¼šæœ‰å¤šä¸ªmode?ç­”ï¼š 6ã€CommonModesçš„ç‰¹æ®Šæ€§NSRunLoopCommonModes(é—®é¢˜:CommonModesæ˜¯å¦ä½¿ç”¨è¿‡, ä½ å¯¹CommonModesäº‹æ€æ ·ç†è§£?) CommonModesä¸æ˜¯å®é™…å­˜åœ¨çš„ä¸€ç§Mode æ˜¯åŒæ­¥Source/Timer/Observeråˆ°å¤šä¸ªModeä¸­çš„ä¸€ç§æŠ€æœ¯æ–¹æ¡ˆ åœ¨ OC å½“ä¸­ç»å¸¸ä¼šé€šè¿‡ NSRunLoopCommonModes å­—ç¬¦ä¸²å¸¸é‡æ¥è¡¨è¾¾ CommonModeã€‚ CommonModeså®ç°ï¼šä¸€ä¸ª Mode å¯ä»¥å°†è‡ªå·±æ ‡è®°ä¸ºâ€Commonâ€å±æ€§ï¼ˆé€šè¿‡å°†å…¶ ModeName æ·»åŠ åˆ° RunLoop çš„ â€œcommonModesâ€ ä¸­ï¼‰ã€‚æ¯å½“ RunLoop çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒRunLoop éƒ½ä¼šè‡ªåŠ¨å°† _commonModeItems é‡Œçš„ Source/Observer/Timer åŒæ­¥åˆ°å…·æœ‰ â€œCommonâ€ æ ‡è®°çš„æ‰€æœ‰Modeé‡Œã€‚ ä¸‰ã€RunLoopäº‹ä»¶å¾ªç¯æœºåˆ¶çš„å®ç°åœ¨å¼€å‘è¿‡ç¨‹ä¸­è°ƒç”¨çš„ NSRunLoop çš„ run ç³»åˆ—çš„ç›¸å…³æ–¹æ³•ä»¥åŠ CFRunLoop çš„ç›¸å…³çš„ run æ–¹æ³•æœ€ç»ˆéƒ½ä¼šè°ƒç”¨åˆ° CFRunLoopRun() å‡½æ•° 1 äº‹ä»¶å¾ªç¯çš„æ•´ä½“é€»è¾‘ï¼š1ï¼‰åœ¨ RunLoop å¯åŠ¨ä¹‹åé¦–å…ˆä¼šå‘å‡ºä¸€æ¡é€šçŸ¥æ¥å‘Šè¯‰è§‚å¯Ÿè€…å½“å‰ RunLoop å³å°†å¯åŠ¨2ï¼‰ä¹‹å RunLoop å°†è¦å¤„ç† Timer/Sources0 äº‹ä»¶ï¼Œå‘å‡ºé€šçŸ¥3ï¼‰è¿›å…¥æ­£å¼ Sources0 çš„å¤„ç†4ï¼‰å¦‚æœæœ‰ Sources1 éœ€è¦å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™ä¼šç”¨è¿‡ä¸€æ¡ goto è¯­å¥æ¥è¿›è¡Œä»£ç é€»è¾‘çš„è·³è½¬ï¼Œæ¥å¤„ç†å”¤é†’æ—¶æ”¶åˆ°çš„æ¶ˆæ¯5ï¼‰å¦‚æœæ²¡æœ‰ Source1è¦å¤„ç†ï¼Œæ­¤æ—¶çº¿ç¨‹å°†è¦ä¼‘çœ ï¼ŒåŒæ—¶ä¹Ÿä¼šå‘é€é€šçŸ¥ç»™ Observeï¼Œç„¶åå°±å‘ç”Ÿäº†ç”¨æˆ·å¸¦åˆ°å†…æ ¸æ€çš„åˆ‡æ¢6ï¼‰çº¿ç¨‹æ­£å¼è¿›å…¥ä¼‘çœ ï¼Œç­‰å¾…å”¤é†’7ï¼‰ä¹‹åçº¿ç¨‹è¢«å”¤é†’ï¼Œä¹Ÿè¦å‘é€ä¸€ä¸ªé€šçŸ¥ï¼Œé€šçŸ¥è§‚å¯Ÿç€è¯´å½“å‰çº¿ç¨‹è¢«å”¤é†’äº†ï¼Œç„¶åå¤„ç†å”¤é†’æ—¶å—åˆ°çš„æ¶ˆæ¯ï¼Œä¹‹ååˆä¼šå›åˆ°ç¬¬äºŒæ­¥ 2 å½“å¤„äºä¼‘çœ çš„runloopï¼Œå¯ä»¥é€šè¿‡å“ªäº›æ–¹å¼å”¤é†’?ç­”: é€šè¿‡ Sources1 è¿›è¡Œå½“å‰ RunLoop çš„å”¤é†’ Timer äº‹ä»¶çš„å›è°ƒ å¤–éƒ¨æ‰‹åŠ¨çš„å”¤é†’ 3 App ä»å¯åŠ¨åˆ°é€€å‡ºï¼Œè¿™ä¸ªè¿‡ç¨‹å½“ä¸­ç³»ç»Ÿéƒ½å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç­”ï¼š è°ƒç”¨äº† main å‡½æ•°ä¹‹åï¼Œåœ¨ main å‡½æ•°ä¸­ä¼šè°ƒç”¨ UIApplicationMain å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨ä¼šå¯åŠ¨ä¸€ä¸ªä¸»çº¿ç¨‹çš„ RunLoopï¼Œç„¶åç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†æœ€ç»ˆä¸»çº¿ç¨‹çš„ RunLoop å¤„äºä¼‘çœ çŠ¶æ€ï¼Œ å¦‚æœè¯´æ­¤æ—¶ç‚¹å‡»ä¸€ä¸ªå±å¹•ï¼Œä¼šäº§ç”Ÿä¸€ä¸ª Responder ï¼Œç„¶ååŸºäº Responder æœ€ç»ˆä¼šè½¬æˆ Sources1ï¼Œå¯ä»¥æŠŠä¸»çº¿ç¨‹å”¤é†’ï¼Œè¿è¡Œç„¶åå¤„ç†ï¼Œ ä¹‹åå½“æŠŠç¨‹åºæ€æ­»çš„æ—¶å€™ RunLoop å°±ä¼šé€€å‡ºï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‘å‡ºä¸€ä¸ªé€šçŸ¥å³å°†é€€å‡º RunLoop ï¼ŒRunLoop é€€å‡ºä¹‹åçº¿ç¨‹ä¹Ÿå°±é”€æ¯æ‰äº†ã€‚ 4 RunLoopçš„æ ¸å¿ƒmain å‡½æ•°ç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†ä¹‹åï¼Œå†…éƒ¨æœ€ç»ˆä¼šè°ƒç”¨ä¸€ä¸ªç³»ç»Ÿå‡½æ•° mach_msg() ,äºæ˜¯å°±å‘ç”Ÿäº†ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç»è¿‡ç³»ç»Ÿè°ƒç”¨å½“å‰ç”¨æˆ·çº¿ç¨‹å°±æŠŠæ§åˆ¶æƒè½¬äº¤æ ¸å¿ƒæ€ï¼Œç„¶å mach_msg() åœ¨ä¸€å®šæ¡ä»¶ä¸‹ä¼šè¿”å›ç»™è°ƒç”¨æ–¹ï¼Œè§¦å‘è¿”å›çš„é€»è¾‘å°±æ˜¯å”¤é†’çº¿ç¨‹çš„é€»è¾‘ï¼Œæ¯”å¦‚æ”¶åˆ°äº†ä¸€ä¸ª Sources1 æˆ–è€… Timer äº‹ä»¶çš„å›è°ƒï¼ŒåŒ…æ‹¬å¤–éƒ¨æ‰‹åŠ¨å”¤é†’ï¼Œå°±å¯ä»¥è§¦å‘æ ¸å¿ƒæ€åˆ°ç”¨æˆ·æ€çš„åˆ‡æ¢ï¼Œé‚£ä¹ˆå½“å‰appçš„ä¸»çº¿ç¨‹å¾ªç¯å°±ä¼šè¢«å”¤é†’ï¼Œè¿™å°±æ˜¯ RunLoop çš„æ ¸å¿ƒ å››ã€RunLoopä¸NSTimeré—®é¢˜:æ»‘åŠ¨TableViewçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„å®šæ—¶å™¨è¿˜ä¼šç”Ÿæ•ˆå—ï¼Ÿç­”: Runloop Mode å®é™…ä¸Šæ˜¯ Sourceï¼ŒTimer å’Œ Observer çš„é›†åˆï¼Œä¸åŒçš„ Mode æŠŠä¸åŒç»„çš„ Sourceï¼ŒTimer å’Œ Observer éš”ç»å¼€æ¥ã€‚Runloop åœ¨æŸä¸ªæ—¶åˆ»åªèƒ½è·‘åœ¨ä¸€ä¸ª Mode ä¸‹ï¼Œå¤„ç†è¿™ä¸€ä¸ª Mode å½“ä¸­çš„ Sourceï¼ŒTimer å’Œ Observerã€‚ æ»‘åŠ¨TableViewçš„æ—¶å€™Modeå‘ç”Ÿåˆ‡æ¢ï¼Œä»KCFRunLoopDefaultModeåˆ‡æ¢åˆ°UITrackingRunLoopMode. (å½“æŠŠSource/Timer/Observer æ·»åŠ åˆ°æŸä¸ªModeä¸Š, å¦‚æœå½“å‰runloopè¿è¡Œåœ¨å¦ä¸€ä¸ªmodeä¸Š, å¯¹åº”Source/Timer/Observeræ˜¯æ²¡æœ‰åŠæ³•è¿›è¡Œåç»­å¤„ç†å’Œå›è°ƒ.) è§£å†³: é€šè¿‡å‡½æ•°CFRunLoopAddTimer() å°†timeræ·»åŠ åˆ°commonModeä¸Š. CommonModeä¸æ˜¯å®é™…å­˜åœ¨çš„ä¸€ç§Mode, åªæ˜¯å°†ä¸€äº›modeæ‰“ä¸Šcommonæ ‡è®°, ç„¶åå¯ä»¥æŠŠæŸä¸ªäº‹ä»¶æº(å¦‚Timer)åŒæ­¥åˆ°å¤šä¸ªmodeä¸­.void CFRunLoopAddTimer(runloop, timer, commonMode) ` äº”ã€RunLoopä¸å¤šçº¿ç¨‹1ã€æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹?(1)ã€ä¸ºå½“å‰çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunLoopã€‚(2)ã€å‘è¯¥RunLoopä¸­æ·»åŠ ä¸€ä¸ªPort/Sourceç­‰ç»´æŒRunLoopçš„äº‹ä»¶å¾ªç¯ã€‚(3)ã€å¯åŠ¨è¯¥RunLoopã€‚ å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹çš„åŸºæœ¬æ­¥éª¤ï¼š 1)ä¸ºå½“å‰çº¿ç¨‹å¼€å¯ä¸€ä¸ª RunLoop ï¼šNSRunLoop *runLoop = [NSRunLoop currentRunLoop];ï¼Œå› ä¸ºè·å–å½“å‰ RunLoop è¿™ä¸ªæ–¹æ³•æœ¬èº«ä¼šæŸ¥æ‰¾å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰ RunLoop çš„è¯ï¼Œä¼šåœ¨ç³»ç»Ÿçš„å†…éƒ¨åˆ›å»º 2)å¦‚æœçº¿ç¨‹æ²¡æœ‰èµ„æºæˆ–è€…äº‹ä»¶æºè¦å¤„ç†çš„è¯ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸èƒ½ç»´æŒäº‹ä»¶å¾ªç¯çš„å°±ä¼šç›´æ¥é€€å‡ºäº†ï¼Œæ‰€ä»¥éœ€è¦ç»™ä»–æ·»åŠ ä¸€ä¸ª Port/Source æ¥ç»´æŒä»–çš„æ—¶é—´å¾ªç¯æœºåˆ¶ 3)ç„¶åå†è°ƒç”¨ RunLoop çš„ run æ–¹æ³•å°±å¯ä»¥å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ 2ã€RunLoopå’Œçº¿ç¨‹å…³ç³»(1)ã€runloopä¸çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸€ä¸ªrunloopå¯¹åº”ä¸€ä¸ªæ ¸å¿ƒçš„çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¯´æ˜¯æ ¸å¿ƒçš„ï¼Œæ˜¯å› ä¸ºrunloopæ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œä½†æ˜¯æ ¸å¿ƒçš„åªèƒ½æœ‰ä¸€ä¸ªï¼Œä»–ä»¬çš„å…³ç³»ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å­—å…¸é‡Œã€‚(2)ã€runloopæ˜¯æ¥ç®¡ç†çº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹çš„runloopè¢«å¼€å¯åï¼Œçº¿ç¨‹ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œæœ‰äº†ä»»åŠ¡å°±ä¼šè¢«å”¤é†’å»æ‰§è¡Œä»»åŠ¡ã€‚(3)ã€runloopåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶è¢«åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶è¢«é”€æ¯ã€‚(4)ã€å¯¹äºä¸»çº¿ç¨‹æ¥è¯´ï¼Œrunloopåœ¨ç¨‹åºä¸€å¯åŠ¨å°±é»˜è®¤åˆ›å»ºå¥½äº†ã€‚(5)ã€å¯¹äºå­çº¿ç¨‹æ¥è¯´ï¼Œrunloopæ˜¯æ‡’åŠ è½½çš„ï¼Œåªæœ‰å½“æˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šåˆ›å»ºã€‚ dispatch_queue_t queue = dispatch_queue_create(&quot;com.codeTao.testQueue&quot;, DISPATCH_QUEUE_SERIAL); dispatch_async(queue, ^{ [self performSelector:@selector(timerAction) withObject:nil afterDelay:1]; [[NSRunLoop currentRunLoop] run]; }); (6)ã€å­çº¿ç¨‹ä¸­ä½¿ç”¨å®šæ—¶å™¨ï¼Œéœ€å°†å®šæ—¶å™¨æ·»åŠ è‡³RunLoopä¸­ï¼Œç¡®ä¿å­çº¿ç¨‹çš„runloopè¢«åˆ›å»ºï¼Œä¸ç„¶å®šæ—¶å™¨ä¸ä¼šå›è°ƒã€‚ dispatch_queue_t queue = dispatch_queue_create(&quot;com.codeTao.testQueue&quot;, DISPATCH_QUEUE_SERIAL); dispatch_async(queue, ^{ //æ­¤ç§æ–¹å¼åˆ›å»ºçš„timerå·²ç»æ·»åŠ åˆ°NSRunloopä¸­äº† NSTimer *timer1 =[NSTimer scheduledTimerWithTimeInterval:0 target:self selector:@selector(timerAction) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] run]; //æ­¤ç§æ–¹å¼åˆ›å»ºçš„timeræ²¡æœ‰æ·»åŠ è‡³runloopä¸­ NSTimer *timer2 = [NSTimer timerWithTimeInterval:1.0f target:self selector:@selector(timerAction) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] addTimer:timer2 forMode:NSDefaultRunLoopMode]; [[NSRunLoop currentRunLoop] run]; }); å…­ RunLoopé¢è¯•æ€»ç»“é—®é¢˜:ä»€ä¹ˆæ˜¯RunLoop? å®ƒæ˜¯æ€æ ·åšåˆ°æœ‰äº‹åšäº‹,æ²¡äº‹ä¼‘æ¯?ç­”: RunLoopæ˜¯é€šè¿‡å†…éƒ¨ç»´æŠ¤çš„äº‹ä»¶å¾ªç¯æ¥å¯¹äº‹ä»¶/æ¶ˆæ¯è¿›è¡Œç®¡ç†çš„ä¸€ä¸ªå¯¹è±¡ã€‚è°ƒç”¨ [CFRunLoop run] ç›¸å…³æ–¹æ³•å, ä¼šè°ƒç”¨ç³»ç»Ÿå‡½æ•°mach_msg, åŒæ—¶å‘ç”Ÿäº†ç”¨æˆ·æ€å‘æ ¸å¿ƒæ€çš„åˆ‡æ¢,å½“å‰çº¿ç¨‹å¤„äºä¼‘çœ çŠ¶æ€.æ‰€æœ‰åšåˆ°æœ‰äº‹åšäº‹,æ²¡äº‹ä¼‘æ¯ é—®é¢˜:RunLoopä¸çº¿ç¨‹æ˜¯æ€æ ·çš„å…³ç³»?ç­”: runloopä¸çº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ ä¸€ä¸ªçº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰runloopçš„, éœ€è¦æ‰‹åŠ¨åˆ›å»º é—®é¢˜:å¦‚ä½•å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹?ç­”:ä¸‰ä¸ªæ­¥éª¤:(1)ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹å¯¹åº”çš„RunLoopã€‚(2)ã€å‘è¯¥RunLoopä¸­æ·»åŠ ä¸€ä¸ªPort/Source/Timer/Observerç­‰ç»´æŒRunLoopçš„äº‹ä»¶å¾ªç¯ã€‚(3)ã€å¯åŠ¨è¯¥RunLoop ã€‚è°ƒç”¨CFRunLoop runæ–¹æ³•æ³¨æ„:è¿è¡Œçš„æ¨¡å¼å’Œæ·»åŠ æ¨¡å¼å¿…é¡»æ˜¯åŒä¸€ä¸ª,å¦åˆ™å¤–éƒ¨ä½¿ç”¨whileå¾ªç¯ä¼šå¯¼è‡´æ­»å¾ªç¯ é—®é¢˜:æ€æ ·ä¿è¯å­çº¿ç¨‹æ•°æ®å›æ¥æ›´æ–°UIçš„æ—¶å€™ä¸æ‰“æ–­ç”¨æˆ·çš„æ»‘åŠ¨æ“ä½œ?ç­”: ç”¨æˆ·è¿›è¡Œæ»‘åŠ¨è¿‡ç¨‹ä¸­,å½“å‰RunLoopè¿è¡Œåœ¨UITrackingRunLoopModeä¸‹ æˆ‘ä»¬ä¸€èˆ¬åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œç½‘ç»œè¯·æ±‚, æ‰€ä»¥å¯ä»¥å°†å­çº¿ç¨‹æŠ›ç»™ä¸»çº¿ç¨‹æ•°æ®å¹¶è¿›è¡ŒUIæ›´æ–°çš„é€»è¾‘å°è£…èµ·æ¥æäº¤åˆ°ä¸»çº¿ç¨‹çš„NSDefaultRunLoopModeä¸‹. è¿™æ ·æŠ›å›æ¥çš„ä»»åŠ¡,å½“ç”¨æˆ·æ»‘åŠ¨æ—¶å¤„äºUITrackingRunLoopModeä¸‹å°±ä¸ä¼šæ‰§è¡Œä»»åŠ¡. å½“æ‰‹åœæ­¢æ»‘åŠ¨æ“ä½œå, å½“å‰çº¿ç¨‹modeåˆ‡æ¢åˆ°NSDefaultRunLoopModeä¸‹,å†å¤„ç†å­çº¿ç¨‹ä¸ŠæŠ›ç»™ä¸»çº¿ç¨‹çš„ä»»åŠ¡,è¿™æ ·å°±ä¸ä¼šæ‰“æ–­ç”¨æˆ·æ»‘åŠ¨æ“ä½œ. é—®é¢˜ï¼šæˆ‘ä»¬å¯ä»¥ç›‘å¬ RunLoop å“ªäº›æ—¶é—´ç‚¹ï¼Ÿç­”ï¼š KCFRunLoopEntryRunLoop çš„å…¥å£æ—¶æœºï¼Œå½“ RunLoop å‡†å¤‡å¯åŠ¨çš„æ—¶å€™ç³»ç»Ÿä¼šç»™æˆ‘ä»¬ä¸€ä¸ªå›è°ƒé€šçŸ¥ï¼Œè¿™ä¸ªé€šçŸ¥æ‰ CFRunLoopEntry KCFRunLoopBeforeTimersä»£è¡¨çš„å«ä¹‰ï¼šé€šçŸ¥è§‚å¯Ÿè€… RunLoop å°†è¦å¯¹ Timer ä¸€äº›ç›¸å…³äº‹ä»¶è¿›è¡Œå¤„ç†äº† KCFRunLoopBeforeSourcesä»£è¡¨å°†è¦å¤„ç†ä¸€äº› Source äº‹ä»¶ KCFRunLoopBeforeWaitingé€šçŸ¥å¯¹åº”è§‚å¯Ÿè€…ï¼Œå½“å‰ RunLoop å°†è¦è¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œè¿™ä¸ªé€šçŸ¥æˆ–è€…è¯´è§‚æµ‹ç‚¹æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªè§‚æµ‹ç‚¹ï¼Œåœ¨ RunLoop å‘é€è¿™ä¸ªé€šçŸ¥çš„æ—¶å€™ï¼Œå³å°†è¦å‘ç”Ÿç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ KCFRunLoopAfterWaitingè¿™ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„è§‚æµ‹ç‚¹ï¼Œè¿™ä¸ªé€šçŸ¥å‘å‡ºçš„æ—¶æœºæ°å¥½æ˜¯ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€ä¹‹åçš„ä¸ä¹…ä¹‹é—´ KCFRunLoopExitä»£è¡¨ RunLoop é€€å‡ºçš„é€šçŸ¥ é—®é¢˜:ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Runloop?å½“éœ€è¦å’Œè¯¥çº¿ç¨‹è¿›è¡Œäº¤äº’çš„æ—¶å€™æ‰ä¼šä½¿ç”¨Runloop é—®é¢˜: Runloopå’Œçº¿ç¨‹æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿç­”: æ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„RunLoopå¯¹è±¡ï¼Œå…¶å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ Dictionary é‡Œï¼› ä¸»çº¿ç¨‹çš„RunLoopå·²ç»è‡ªåŠ¨åˆ›å»ºï¼Œå­çº¿ç¨‹çš„RunLoopéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼› RunLoopåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯ é—®é¢˜:Runloopçš„modeä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿç­”:æŒ‡å®šäº‹ä»¶åœ¨è¿è¡Œå¾ªç¯ä¸­çš„ä¼˜å…ˆçº§çš„ï¼Œçº¿ç¨‹çš„è¿è¡Œéœ€è¦ä¸åŒçš„æ¨¡å¼ï¼Œå»å“åº”å„ç§ä¸åŒçš„äº‹ä»¶ï¼Œå»å¤„ç†ä¸åŒæƒ…å¢ƒæ¨¡å¼ã€‚(æ¯”å¦‚å¯ä»¥ä¼˜åŒ–tableviewçš„æ—¶å€™å¯ä»¥è®¾ç½®UITrackingRunLoopModeä¸‹ä¸è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚è®¾ç½®å›¾ç‰‡ç­‰ã€‚) é—®é¢˜: ä»¥+scheduledTimerWithTimeInterval:çš„æ–¹å¼è§¦å‘çš„timerï¼Œåœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚åœå›è°ƒï¼Œ ä¸ºä»€ä¹ˆï¼Ÿç­”:æ»‘åŠ¨scrollViewæ—¶ï¼Œä¸»çº¿ç¨‹çš„RunLoopä¼šåˆ‡æ¢åˆ°UITrackingRunLoopModeè¿™ä¸ªModeï¼Œæ‰§è¡Œçš„ä¹Ÿæ˜¯UITrackingRunLoopModeä¸‹çš„ä»»åŠ¡ï¼ˆModeä¸­çš„itemï¼‰ï¼Œè€Œtimeræ˜¯æ·»åŠ åœ¨NSDefaultRunLoopModeä¸‹çš„ï¼Œæ‰€ä»¥timerä»»åŠ¡å¹¶ä¸ä¼šæ‰§è¡Œï¼Œåªæœ‰å½“UITrackingRunLoopModeçš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œrunloopåˆ‡æ¢åˆ°NSDefaultRunLoopModeåï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œtimerã€‚ é—®é¢˜: å¦‚ä½•è§£å†³åœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚åœå›è°ƒï¼Ÿç­”:å°†Timeræ”¾åˆ°NSRunLoopCommonModesä¸­æ‰§è¡Œå³å¯ [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; [[NSRunLoop currentRunLoop] run]; é—®é¢˜: NSTimerä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿç­”: æ³¨æ„timeræ·»åŠ åˆ°runloopæ—¶åº”è¯¥è®¾ç½®ä¸ºä»€ä¹ˆmode æ³¨æ„timeråœ¨ä¸éœ€è¦æ—¶ï¼Œä¸€å®šè¦è°ƒç”¨invalidateæ–¹æ³•ä½¿å®šæ—¶å™¨å¤±æ•ˆï¼Œå¦åˆ™å¾—ä¸åˆ°é‡Šæ”¾ é—®é¢˜: RunLoop æœ‰å“ªäº›åº”ç”¨ï¼Ÿç­”: å¸¸é©»å†…å­˜ã€AutoreleasePool è‡ªåŠ¨é‡Šæ”¾æ±  é—®é¢˜: AutoreleasePool å’Œ RunLoop æœ‰ä»€ä¹ˆè”ç³»ï¼Ÿç­”:iOSåº”ç”¨å¯åŠ¨åä¼šæ³¨å†Œä¸¤ä¸ª Observer ç®¡ç†å’Œç»´æŠ¤ AutoreleasePoolã€‚åº”ç”¨ç¨‹åºåˆšåˆšå¯åŠ¨æ—¶é»˜è®¤æ³¨å†Œäº†å¾ˆå¤šä¸ªObserverï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªObserverçš„ callout éƒ½æ˜¯ _ wrapRunLoopWithAutoreleasePoolHandlerï¼Œè¿™ä¸¤ä¸ªæ˜¯å’Œè‡ªåŠ¨é‡Šæ”¾æ± ç›¸å…³çš„ä¸¤ä¸ªç›‘å¬ã€‚ ç¬¬ä¸€ä¸ª Observer ä¼šç›‘å¬ RunLoop çš„è¿›å…¥ï¼Œå®ƒä¼šå›è°ƒobjc_autoreleasePoolPush() å‘å½“å‰çš„ AutoreleasePoolPage å¢åŠ ä¸€ä¸ªå“¨å…µå¯¹è±¡æ ‡å¿—åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™ä¸ª Observer çš„ order æ˜¯ -2147483647 ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¡®ä¿å‘ç”Ÿåœ¨æ‰€æœ‰å›è°ƒæ“ä½œä¹‹å‰ã€‚ ç¬¬äºŒä¸ª Observer ä¼šç›‘å¬ RunLoop çš„è¿›å…¥ä¼‘çœ å’Œå³å°†é€€å‡º RunLoop ä¸¤ç§çŠ¶æ€ï¼Œåœ¨å³å°†è¿›å…¥ä¼‘çœ æ—¶ä¼šè°ƒç”¨ objc_autoreleasePoolPop() å’Œ objc_autoreleasePoolPush() æ ¹æ®æƒ…å†µä»æœ€æ–°åŠ å…¥çš„å¯¹è±¡ä¸€ç›´å¾€å‰æ¸…ç†ç›´åˆ°é‡åˆ°å“¨å…µå¯¹è±¡ã€‚è€Œåœ¨å³å°†é€€å‡º RunLoop æ—¶ä¼šè°ƒç”¨objc_autoreleasePoolPop() é‡Šæ”¾è‡ªåŠ¨è‡ªåŠ¨é‡Šæ”¾æ± å†…å¯¹è±¡ã€‚è¿™ä¸ªObserver çš„ order æ˜¯ 2147483647 ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œç¡®ä¿å‘ç”Ÿåœ¨æ‰€æœ‰å›è°ƒæ“ä½œä¹‹åã€‚ é—®é¢˜:NSRunLoop å’Œ CFRunLoopRef åŒºåˆ«?ç­”: CFRunLoopRef åŸºäºC çº¿ç¨‹å®‰å…¨ï¼ŒNSRunLoop åŸºäº CFRunLoopRef é¢å‘å¯¹è±¡çš„API æ˜¯ä¸å®‰å…¨çš„]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬6ç«  å¤šçº¿ç¨‹ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F24%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC6%E7%AB%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²å¤šçº¿ç¨‹ç›¸å…³é¢è¯•é—®é¢˜ï¼šåŒ…æ‹¬GCDã€NSOperationã€NSThreadã€å¤šçº¿ç¨‹ä¸é”ã€‚ ä¸€ã€GCD åŒæ­¥/å¼‚æ­¥ å’Œä¸²è¡Œ/å¹¶å‘ dispatch_barrier_async å¼‚æ­¥æ …æ è°ƒç”¨ dispatch_group 01 å¼‚æ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šå¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œä»»åŠ¡02 å¼‚æ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šå¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡03 åŒæ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡04 åŒæ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡05 å¼‚æ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ä¸²è¡Œæ‰§è¡Œä»»åŠ¡06 åŒæ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼ˆæ³¨æ„æ­»é”å‘ç”Ÿï¼‰æ³¨æ„åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°åœ¨æ‰§è¡Œé¡ºåºä¸Šé¢çš„å·®å¼‚ 1ã€åŒæ­¥/å¼‚æ­¥ å’Œ ä¸²è¡Œ/å¹¶å‘åŒæ­¥/å¼‚æ­¥ å’Œ ä¸²è¡Œ/å¹¶å‘ + åŒæ­¥åˆ†é…ä»»åŠ¡åˆ°ä¸²è¡Œé˜Ÿåˆ— dispatch_sync(serial_queue,{//ä»»åŠ¡}); + å¼‚æ­¥åˆ†é…ä»»åŠ¡åˆ°ä¸²è¡Œé˜Ÿåˆ— dispatch_async(serial_queue,{//ä»»åŠ¡}); + åŒæ­¥åˆ†é…ä»»åŠ¡åˆ°å¹¶å‘é˜Ÿåˆ— dispatch_sync(concurrent_queue,{//ä»»åŠ¡}); + å¼‚æ­¥åˆ†é…ä»»åŠ¡åˆ°å¹¶å‘é˜Ÿåˆ— dispatch_async(concurrent_queue,{//ä»»åŠ¡}); (1)ã€åŒæ­¥ä¸²è¡Œ dispatch_sync(serial_queue , ^{ //ä»»åŠ¡ });åŒæ­¥ä¸»çº¿ç¨‹//åŒæ­¥ä¸»çº¿ç¨‹ æ­»é” - (void)viewDidLoad { dispatch_sync(dispatch_get_main_queue(), ^{ [self doSomething]; }); } ç»“æœï¼šé€ æˆæ­»é” é˜Ÿåˆ—å¼•èµ·çš„å¾ªç¯ç­‰å¾….åœ¨ä¸»é˜Ÿåˆ—ä¸­æäº¤äº†viewDidLoadï¼Œç„¶ååˆæäº¤äº†blockã€‚å› æ­¤åœ¨æ‰§è¡ŒviewDidLoadè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è°ƒç”¨blockï¼Œblockå®Œæˆä¹‹åï¼ŒviewDidLoadæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè€Œblockå› ä¸ºé˜Ÿåˆ—å…ˆè¿›å…ˆå‡ºçš„æ€§è´¨å¿…é¡»è¦ç­‰viewDidLoadæ‰§è¡Œç»“æœæ‰èƒ½è°ƒç”¨,å¯¼è‡´ç›¸äº’ç­‰å¾…æƒ…å†µ,ä»è€Œæ­»é”. åŒæ­¥ä¸²è¡Œ- (void)viewDidLoad { dispatch_sync(serialQueue, ^{ [self doSomething]; }); } ç»“æœï¼šé¡ºåºæ‰§è¡Œ éƒ½åœ¨ä¸»çº¿ç¨‹ï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ (2)ã€åŒæ­¥å¹¶å‘ dispatch_sync(concurrent_queue , ^{ //ä»»åŠ¡ });- (void)viewDidLoad { NSLog(@&quot;1&quot;); dispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ NSLog(@&quot;2&quot;); dispatch_sync(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ NSLog(@&quot;3&quot;); }); NSLog(@&quot;4&quot;); }); NSLog(@&quot;5&quot;); } ç­”æ¡ˆ:12345 é¡ºåºæ‰§è¡Œ éƒ½åœ¨ä¸»çº¿ç¨‹ ä¸å¼€è¾Ÿæ–°çº¿ç¨‹psï¼šå¦‚æœ2 3 éƒ½æ˜¯æ·»åŠ åˆ°åŒä¸€ä¸²è¡Œé˜Ÿåˆ— å°±ä¼šé€ æˆæ­»é” 23å¾ªç¯ç­‰å¾… åªè¦åŒæ­¥æ–¹å¼æäº¤ä»»åŠ¡,æ— è®ºä¸²è¡Œè¿˜æ˜¯å¹¶å‘éƒ½æ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ dispatch_sync() åœ¨å½“å‰ä¸»çº¿ç¨‹æ‰§è¡Œ (3)ã€å¼‚æ­¥ä¸²è¡Œ dispatch_async(serial_queue , ^{ //ä»»åŠ¡ });å¼‚æ­¥ä¸»é˜Ÿåˆ— - (void)viewDidLoad { dispatch_async(dispatch_get_main_queue(), ^{ [self doSomething]; }); } é¡ºåºæ‰§è¡Œï¼Œéƒ½åœ¨ä¸»çº¿ç¨‹ï¼Œä¸å¼€è¾Ÿæ–°çº¿ç¨‹ (4)ã€å¼‚æ­¥å¹¶å‘ dispatch_async(concurrent_queue , ^{ //ä»»åŠ¡ });//è…¾è®¯é¢è¯•é¢˜: - (void)viewDidLoad { dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ NSLog(@&quot;1&quot;); [self performSelector:@selector(printLog) withObject:nil afterDelay:0]; NSLog(@&quot;3&quot;); }); } - (void)printLog{ NSLog(@&quot;2&quot;); } è¾“å‡º: 13 è¯¥é¢˜æ¶‰åŠçŸ¥è¯†ç‚¹è¾ƒå¤šï¼šGCDã€çº¿ç¨‹çš„Runloopã€performSeletorå†…éƒ¨å®ç° å¼‚æ­¥åˆ†æ´¾åˆ°å…¨å±€é˜Ÿåˆ—ä¸­ï¼ŒGCDåº•å±‚æ‰€åˆ†æ´¾çš„çº¿ç¨‹é»˜è®¤æ˜¯ä¸å¼€å¯å¯¹åº”runloopçš„ï¼Œè€ŒperformSeletorï¼šå³ä½¿æ˜¯å»¶è¿Ÿ0ç§’ï¼Œä¹Ÿæ˜¯éœ€è¦æäº¤ä»»åŠ¡åˆ°runloopçš„é€»è¾‘ï¼Œæ‰€ä»¥performSeletoræ–¹æ³•ä¼šå¤±æ•ˆçš„ performSeletor:æ–¹æ³•è¦æƒ³æœ‰æ•ˆæ‰§è¡Œ, å¿…é¡»æ˜¯æ–¹æ³•è°ƒç”¨æ‰€å±çº¿ç¨‹æ˜¯æœ‰runloopçš„,æ²¡æœ‰å°±ä¼šå¤±æ•ˆ 2ã€dispatch_barrier_async()å¤šè¯»å•å†™æ–¹æ¡ˆï¼šdispatch_barrier_async(concurrent_queue , ^{ //å†™æ“ä½œ }); é—®é¢˜:æ€ä¹ˆåˆ©ç”¨GCDå®ç°å¤šè¯»å•å†™ï¼Ÿæˆ–è€…è¯´æƒ³è¦å®ç°å¤šè¯»å•å†™ï¼Œæ€ä¹ˆå»å®ç°ï¼Ÿç­”: è¯»è€…ä¸è¯»è€…å¹¶å‘ï¼ˆè¯»æ“ä½œæ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—åŒæ­¥è®¿é—®ï¼‰ è¯»è€…ä¸å†™è€…ã€å†™è€…ä¸å†™è€…äº’æ–¥ ï¼ˆå†™æ“ä½œé€šè¿‡dispatch_barrier_async+ å¼‚æ­¥æ …æ æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ï¼‰ @interface UserCenter(){ // å®šä¹‰ä¸€ä¸ªå¹¶å‘é˜Ÿåˆ— dispatch_queue_t concurrent_queue; // ç”¨æˆ·æ•°æ®ä¸­å¿ƒ, å¯èƒ½å¤šä¸ªçº¿ç¨‹éœ€è¦æ•°æ®è®¿é—® NSMutableDictionary *userCenterDic; } @end // å¤šè¯»å•å†™æ¨¡å‹ @implementation UserCenter - (id)init{ self = [super init]; if (self) { // é€šè¿‡å®å®šä¹‰ DISPATCH_QUEUE_CONCURRENT åˆ›å»ºä¸€ä¸ªå¹¶å‘é˜Ÿåˆ— concurrent_queue = dispatch_queue_create(&quot;read_write_queue&quot;, DISPATCH_QUEUE_CONCURRENT); // åˆ›å»ºæ•°æ®å®¹å™¨ userCenterDic = [NSMutableDictionary dictionary]; } return self; } - (id)objectForKey:(NSString *)key { __block id obj; // åŒæ­¥è¯»å–æŒ‡å®šæ•°æ® dispatch_sync(concurrent_queue, ^{ obj = [userCenterDic objectForKey:key]; }); return obj; } - (void)setObject:(id)obj forKey:(NSString *)key { // å¼‚æ­¥æ …æ è°ƒç”¨è®¾ç½®æ•°æ® dispatch_barrier_async(concurrent_queue, ^{ [userCenterDic setObject:obj forKey:key]; }); } @end 3ã€dispatch_group_async()é—®é¢˜:ä½¿ç”¨GCDå®ç°ï¼šAã€Bã€Cä¸‰ä¸ªä»»åŠ¡å¹¶å‘ï¼Œå®Œæˆåæ‰§è¡Œä»»åŠ¡Dï¼Ÿç­”: æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨dispatch_group_notifyå‡½æ•°ï¼Œæ¥ç›‘å¬å‰é¢å¤šä¸ªçš„ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œå¦‚æœå®Œæˆ, å°±ä¼šè°ƒç”¨dispatch_group_notifyä¸­çš„block(å‚è€ƒä»£ç å®ä¾‹) äºŒã€NSOperationéœ€è¦å’ŒNSOperationQueueé…åˆä½¿ç”¨æ¥å®ç°å¤šçº¿ç¨‹æ–¹æ¡ˆã€‚1ã€ç‰¹ç‚¹ï¼šæ·»åŠ ä»»åŠ¡ä¾èµ–ã€ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ç›‘æ§ã€æœ€å¤§å¹¶å‘æ•°ã€‚2ã€ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€æ§åˆ¶ï¼šisReadyã€isExecutingã€isFinishedã€isCancelledã€‚ 3ã€çŠ¶æ€ç›‘æ§ å¦‚æœåªé‡å†™mainæ–¹æ³•ï¼Œåº•å±‚æ§åˆ¶å˜æ›´ä»»åŠ¡æ‰§è¡Œå®ŒæˆçŠ¶æ€ï¼Œä»¥åŠä»»åŠ¡é€€å‡ºã€‚ å¦‚æœé‡å†™startæ–¹æ³•ï¼Œéœ€è‡ªè¡Œæ§åˆ¶ä»»åŠ¡çŠ¶æ€ã€‚ 4ã€ç³»ç»Ÿæ˜¯æ€æ ·ç§»é™¤ä¸€ä¸ªisFinished=YESçš„NSOperationçš„ï¼Ÿç­”:é€šè¿‡KVOçš„æ–¹å¼ï¼Œé€šçŸ¥å¯¹åº”çš„NSOprationQueueè¾¾åˆ°å¯¹NSOperationå¯¹è±¡è¿›è¡Œç§»é™¤ã€‚ ä¸‰ã€NSThreadè€ƒæŸ¥é¢è¯•é¢˜:1&gt; å¦‚ä½•NSThreadç»“åˆrunloopå®ç°å¸¸é©»çº¿ç¨‹2&gt; NSThread çš„ å†…éƒ¨å®ç°æœºåˆ¶, startæ–¹æ³•å®ç°é€»è¾‘æµç¨‹(ç»“åˆ gnustep-base-1.24.9 æºç åˆ†æ) é—®é¢˜: NSThreadå¯åŠ¨æµç¨‹ï¼Ÿç­”: start() â€”â€”&gt;åˆ›å»ºpthreadçº¿ç¨‹â€”â€”&gt;main()â€”â€”&gt;[target performSelector:selector]â€”â€”&gt;exit() é—®é¢˜: å¦‚ä½•é€šè¿‡runloopå’ŒNSThreadå®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿä»ä¸‹ä¸€ç« runloopä¸­å¯»æ‰¾ç­”æ¡ˆ é—®é¢˜: NSThreadæ‰§è¡ŒåŸç†æ˜¯æ€æ ·çš„?ç­”: å®é™…å†…éƒ¨åˆ›å»ºä¸€ä¸ªpthreadçº¿ç¨‹ ,å½“main()å‡½æ•°æˆ–è€…æŒ‡å®šçš„target çš„selectoræ–¹æ³•æ‰§è¡Œç»“æŸå,ç³»ç»Ÿä¼šä¸ºæˆ‘ä»¬è¿›è¡Œçº¿ç¨‹çš„é€€å‡ºç®¡ç†æ“ä½œ. å¦‚æœéœ€è¦ç»´æŠ¤ä¸€ä¸ªå¸¸é©»çº¿ç¨‹,éœ€è¦NSThreadæ‰€å¯¹åº”çš„selectoræ–¹æ³•ä¸­ç»´æŠ¤runloopäº‹ä»¶å¾ªç¯ã€‚ å››ã€å¤šçº¿ç¨‹ä¸é”iOSä¸­æœ‰å“ªäº›é”ï¼Ÿ @synchronized atomic OSSpinLock NSRecursiveLock NSLock dispatch_semaphore_t 1ã€ @synchronizedçš„ä½¿ç”¨åœºæ™¯ä¸€èˆ¬åœ¨åˆ›å»ºå•ä¾‹çš„æ—¶å€™ä½¿ç”¨ï¼Œä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åˆ›å»ºçš„å¯¹è±¡æ˜¯å”¯ä¸€çš„ 2ã€atomic ä¿®é¥°å±æ€§çš„å…³é”®å­— å¯¹è¢«ä¿®é¥°çš„å¯¹è±¡è¿›è¡ŒåŸå­æ“ä½œï¼ˆä¸è´Ÿè´£ä½¿ç”¨ï¼Œåªè´Ÿè´£èµ‹å€¼ï¼‰@property(atomic)NSMutableArray *array; self.array = [NSMutableArray array]; //arrayèµ‹å€¼æ“ä½œ,èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ [self.array addObject:obj]; // arrayä½¿ç”¨, ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨,éœ€è¦é¢å¤–åšçº¿ç¨‹å®‰å…¨ä¿æŠ¤ 3ã€OSSpinLockè‡ªæ—‹é” å¾ªç¯ç­‰å¾…è¯¢é—®ï¼Œä¸é‡Šæ”¾å½“å‰èµ„æº ç”¨äºè½»é‡çº§æ•°æ®è®¿é—®ï¼Œç®€å•çš„intå€¼+1/-1æ“ä½œ æ²¡æœ‰å…·ä½“ç”¨è¿‡,ä½†æ˜¯å¯ä»¥é€šè¿‡åˆ†æruntimeæºç æ¥å­¦ä¹ ç³»ç»Ÿå…³äºOSSpinLockè‡ªæ—‹é”çš„ä½¿ç”¨æƒ…å†µ. 4ã€ NSLock ä¸€èˆ¬ç”¨äºè§£å†³ç»†ç²’åº¦çš„çº¿ç¨‹åŒæ­¥é—®é¢˜, æ¥ä¿è¯å„ä¸ªçº¿ç¨‹äº’æ–¥,è¿›å…¥è‡ªå·±çš„ä¸´ç•ŒåŒº. - (void)methodA { [lock lock]; [self methodB]; [lock unlock]; } - (void)methodB { [lock lock]; //æ“ä½œé€»è¾‘ [lock unlock]; } è¯¥å†™æ³•é‡å…¥çš„åŸå›  ä¼šå¯¼è‡´æ­»é”! è§£å†³: é€šè¿‡NSRecursiveLocké€’å½’æ‰€å¯ä»¥è§£å†³5ã€NSRecursiveLock é€’å½’é” NSRecursiveLock é€’å½’é”ç‰¹æ€§: å¯ä»¥é‡å…¥` (void)methodA {[recursiveLock lock];[self methodB];[recursiveLock unlock];} (void)methodB {[recursiveLock lock];//æ“ä½œé€»è¾‘[recursiveLock unlock];}` 6ã€dispatch_semaphore_t ä¿¡å·é‡ dispatch_semaphore_t ä¿¡å·é‡ ä¹Ÿæ˜¯ç”¨æ¥å®ç°çº¿ç¨‹åŒæ­¥, åŒ…æ‹¬å¯¹å…±äº«èµ„æºäº’æ–¥è®¿é—®çš„ä¿¡å·é‡æœºåˆ¶,ç±»ä¼¼äºè®¡ç®—æœºä¸“ä¸šçš„è®°å½•å‹ä¿¡å·é‡ åˆ›å»ºä¿¡å·é‡ dispatch_semaphore_create(1) //dispatch_semaphore_createå†…éƒ¨å®ç° å®ä¾‹åŒ–ä¸€ä¸ªç»“æ„ä½“ struct semaphore{ int value; // ä¿¡å·é‡çš„å€¼ List&lt;thread&gt;; // çº¿ç¨‹çš„è¿›ç¨‹æ§åˆ¶è¡¨pcd æˆ–è€…ä¸€äº›å…¶ä»–çº¿ç¨‹çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†æ‰€ç»´æŠ¤çš„ä¸€ä¸ªçº¿ç¨‹åˆ—è¡¨ } dispatch_semaphore_wait(semaphore,DISPATCH_TIME_FOREVER)ä¿¡å·é‡-1ï¼Œé˜»å¡æ˜¯ä¸€ä¸ªä¸»åŠ¨è¡Œä¸º //dispatch_semaphore_wait() å®ç°é€»è¾‘ { S.value = S.value - 1; if S.value &lt; 0 then Block(S.List); //é˜»å¡æ˜¯ä¸€ä¸ªä¸»åŠ¨è¡Œä¸º } dispatch_semaphore_signal(semaphore) ä¿¡å·é‡+1ï¼Œå”¤é†’æ˜¯ä¸€ä¸ªè¢«åŠ¨è¡Œä¸º//dispatch_semaphore_signal()å®ç°é€»è¾‘ { S.value = S.value + 1; if S.value &lt;= 0 then wakeup(S.List); //å”¤é†’æ˜¯ä¸€ä¸ªè¢«åŠ¨è¡Œä¸º } äº” å¤šçº¿ç¨‹ç›¸å…³é¢è¯•é—®é¢˜1ã€æ€æ ·ç”¨GCDå®ç°å¤šè¯»å•å†™ï¼Ÿç­”: dispatch_barrier_async()çš„ä½¿ç”¨. è¯»è€…ä¸è¯»è€…å¹¶å‘ï¼ˆè¯»æ“ä½œæ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—åŒæ­¥è®¿é—®ï¼‰ è¯»è€…ä¸å†™è€…ã€å†™è€…ä¸å†™è€…äº’æ–¥ ï¼ˆå†™æ“ä½œé€šè¿‡dispatch_barrier_async+ å¼‚æ­¥æ …æ æ·»åŠ åˆ°å¹¶å‘é˜Ÿåˆ—ä¸­ï¼‰ 2ã€iOSç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›çš„å‡ ç§å¤šçº¿ç¨‹æŠ€æœ¯å„è‡ªçš„ç‰¹ç‚¹æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿç­”æ¡ˆï¼šGCDã€NSOperationã€NSThreadã€‚ GCD ç”¨æ¥å®ç°ç®€å•çš„çº¿ç¨‹åŒæ­¥ï¼ŒåŒ…æ‹¬å­çº¿ç¨‹çš„åˆ†æ´¾ï¼ŒåŒ…æ‹¬å®ç°å¤šè¯»å•å†™åœºæ™¯çš„è§£å†³ NSOperationåŠNSOperationQueue æ¯”å¦‚AFNetworkingã€SDWebImageéƒ½ä¼šæ¶‰åŠåˆ°NSOpration,ç”±äºå®ƒçš„ç‰¹ç‚¹æ˜¯æ–¹ä¾¿æˆ‘ä»¬å¯¹ä»»åŠ¡çš„çŠ¶æ€è¿›è¡Œæ§åˆ¶ï¼ŒåŒ…æ‹¬å¯ä»¥æ§åˆ¶æ·»åŠ ä¾èµ–ã€ç§»é™¤ä¾èµ– NSThread ä¸€èˆ¬ç”¨å®ƒæ¥å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ 3ã€NSOperationå¯¹è±¡åœ¨Finishedä¹‹åæ˜¯å’‹æ ·ä»queueå½“ä¸­ç§»é™¤æ‰çš„ï¼Ÿç­”: NSOperationå¯¹è±¡åœ¨Finishedä¹‹å, é€šè¿‡KVOçš„æ–¹å¼ï¼Œé€šçŸ¥å¯¹åº”çš„NSOprationQueueè¾¾åˆ°å¯¹NSOperationå¯¹è±¡è¿›è¡Œç§»é™¤ã€‚ 4ã€ä½ éƒ½ç”¨è¿‡å“ªäº›é”ï¼Ÿç»“åˆå®é™…è°ˆè°ˆä½ æ˜¯æ€æ ·ä½¿ç”¨çš„ï¼Ÿç­”:]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬5ç«  Blockç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F24%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC5%E7%AB%A0-Block%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²Blockç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬Blockä»‹ç»ã€æˆªè·å˜é‡ã€__blockä¿®é¥°ç¬¦ã€Blockçš„å†…å­˜ç®¡ç†ã€Blockçš„å¾ªç¯å¼•ç”¨ã€‚ ä¸€ã€Blockä»‹ç»å®šä¹‰:Blockæ˜¯å°†å‡½æ•°åŠå…¶æ‰§è¡Œä¸Šä¸‹æ–‡å°è£…èµ·æ¥çš„å¯¹è±¡ã€‚ Blockæœ¬è´¨:æºç è§£æ:ä½¿ç”¨ clang -rewrite-objc file.m æŸ¥çœ‹ç¼–è¯‘ä¹‹åçš„æ–‡ä»¶å†…å®¹ã€‚ Blockè°ƒç”¨:Blockè°ƒç”¨å°±æ˜¯å‡½æ•°çš„è°ƒç”¨ã€‚ äºŒã€æˆªè·å˜é‡ã€‚è¢«æˆªè·å˜é‡ç±»å‹è¢«æˆªè·å˜é‡ç±»å‹: åŒ…æ‹¬å±€éƒ¨å˜é‡(åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ç±»å‹)ã€é™æ€å±€éƒ¨å˜é‡ã€å…¨éƒ¨å˜é‡ã€é™æ€å…¨éƒ¨å˜é‡ã€‚ é—®é¢˜:å…³äºBlockæˆªè·å˜é‡çš„ç‰¹æ€§ï¼Œæ˜¯å¦æœ‰ç†è§£ï¼Ÿç­”: å¯¹ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæˆªè·æ–¹å¼å„æœ‰ä¸åŒ1.å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å±€éƒ¨å˜é‡æˆªè·å…¶å€¼2.å¯¹äºå¯¹è±¡ç±»å‹çš„å±€éƒ¨å˜é‡è¿åŒæ‰€æœ‰æƒä¿®é¥°ç¬¦ä¸€èµ·æˆªè·3.ä»¥æŒ‡é’ˆæ–¹å¼æˆªè·é™æ€å±€éƒ¨å˜é‡4.ä¸æˆªè·å…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡ æºç è§£æ:ä½¿ç”¨ clang -rewrite-objc -fobjc-arc file.m æŸ¥çœ‹ç¼–è¯‘ä¹‹åçš„æ–‡ä»¶å†…å®¹ã€‚ //é¢è¯•é¢˜ int multiplier = 6; int(^Block)(int) = ^int(int num){ return num*multiplier; }; multiplier = 4; NSLog(@&quot;result is %d&quot;,Block(2)); //è¾“å‡ºç»“æœ --&gt;result is 12 ä¸‰ã€__blockä¿®é¥°ç¬¦ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹è¢«æˆªè·å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œéœ€æ·»åŠ __blockä¿®é¥°ç¬¦ã€‚æ³¨æ„ï¼šèµ‹å€¼ä¸ç­‰äºä½¿ç”¨ã€‚ ç¬”è¯•é¢˜çš„å‘: NSMutableArray *array =[NSMutableArray array]; void(^Block)(void) = ^{ [array addObject:@&quot;123&quot;]; }; Block(); //è¯¥arrayä¸ºä½¿ç”¨ï¼Œåªæœ‰èµ‹å€¼æ“ä½œæ‰éœ€è¦__block ã€‚ NSMutableArray *array2 =nil; void(^Block2)(void) = ^{ array2 = [NSMutableArray array]; }; Block2(); //è¯¥blockä¸ºèµ‹å€¼ï¼Œå­˜åœ¨é—®é¢˜ï¼Œä¼šç¼–è¯‘æŠ¥é”™ï¼Œéœ€è¦ç”¨__blockä¿®é¥°è¢«æˆªè·å˜é‡array2ã€‚ é—®é¢˜:åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨__blockä¿®é¥°ç¬¦å‘¢ï¼Ÿ å¯¹æˆªè·å˜é‡è¿›è¡Œèµ‹å€¼æ“ä½œéœ€è¦æ·»åŠ __blockä¿®é¥°ç¬¦ï¼ˆèµ‹å€¼ != ä½¿ç”¨ï¼‰ å¯¹å±€éƒ¨å˜é‡ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ç±»å‹ï¼‰è¿›è¡Œèµ‹å€¼éœ€è¦__blockä¿®é¥°ç¬¦ å¯¹é™æ€å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡ä¸éœ€è¦__blockä¿®é¥°ç¬¦ __block é¢è¯•é¢˜{ __block int multiplier = 6; int(^Block)(int) = ^int(int num){ return num*multiplier; }; multiplier = 4; NSLog(@&quot;result is %d&quot;,Block(2)); //è¾“å‡ºç»“æœ --&gt;result is 8 } é—®é¢˜:blockä¿®é¥°ç¬¦èµ·åˆ°äº†ä»€ä¹ˆä½œç”¨ï¼Ÿblockçš„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿç­”: __blockä¿®é¥°å˜é‡å˜æˆäº†å¯¹è±¡ æ ˆä¸Šçš„blockå˜é‡çš„forwardingæŒ‡é’ˆæ˜¯æŒ‡å‘å…¶è‡ªèº«çš„ å››ã€Blockçš„å†…å­˜ç®¡ç†1ã€Blockç±»å‹Blockç±»å‹ï¼šNSGlobalBlockã€NSStackBlockã€NSMallocBlockã€‚ impl.isa = &amp;_NSConcreteStackBlock; 2ã€Blockçš„copyæ“ä½œ é—®é¢˜: ä¸‰ç§ç±»å‹çš„blockè¿›è¡Œcopyæœ‰ä»€ä¹ˆæ•ˆæœ?ç­”: å¯¹äºæ•°æ®åŒºçš„blockè¿›è¡Œcopyæ“ä½œï¼Œä»€ä¹ˆä¹Ÿä¸åš å¯¹äºæ ˆåŒºçš„blockè¿›è¡Œcopyæ“ä½œï¼Œåœ¨å †åŒºäº§ç”Ÿblock å¯¹äºå †åŒºçš„blockè¿›è¡Œcopyæ“ä½œï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•° 3ã€ç”Ÿå‘½å‘¨æœŸæ ˆä¸ŠBlockçš„é”€æ¯ å¯¹äºæ ˆåŒºçš„blockï¼Œå˜é‡ä½œç”¨åŸŸç»“æŸï¼Œéšä¹‹é”€æ¯ æ ˆä¸ŠBlockçš„copy é—®é¢˜:å¦‚æœå¯¹æ ˆä¸Šblockè¿›è¡Œcopy æ“ä½œå, MRCç¯å¢ƒä¸‹,æ˜¯å¦ä¼šå¼•èµ·å†…å­˜æ³„æ¼?ç­”: ä¼šå¼•èµ·å†…å­˜æ³„æ¼. æ ˆä¸Šblockåœ¨å˜é‡ä½œç”¨åŸŸç»“æŸåä¼šé”€æ¯, å †ä¸Šblockæ²¡æœ‰å…¶ä»–æˆå‘˜å˜é‡æŒ‡å‘å®ƒ, è¿™å’Œalloc å‡ºä¸€ä¸ªå¯¹è±¡æœ€åæ²¡æœ‰releaseæ•ˆæœæ˜¯ä¸€æ ·çš„, ä¼šå¼•èµ·å†…å­˜æ³„æ¼. æ ˆä¸Š__blockå˜é‡çš„copy å¦‚æœå¯¹æ ˆä¸Šçš„__blockå˜é‡æ²¡æœ‰è¿›è¡Œcopyæ“ä½œ, __forwardingæŒ‡é’ˆæŒ‡å‘å…¶è‡ªèº«, åŒæ ·ä¸Šè¾¹ä¸€è¡Œä»£ç ,ä¿®æ”¹çš„æ˜¯æ ˆä¸Šçš„__blockå˜é‡ å¯¹æ ˆä¸Šçš„__blockå˜é‡è¿›è¡Œcopyæ“ä½œå, å®é™…åœ¨å †ä¸Šé¢ä¹Ÿä¼šäº§ç”Ÿä¸€ä¸ªblockå˜é‡,å†…å®¹å®Œå…¨ä¸€æ ·,ä½†æ˜¯æ˜¯ä¸¤å—ä¸åŒå†…å­˜æ§ä»¶.` æ ˆä¸Šblockå˜é‡çš„__forwardingæŒ‡é’ˆæŒ‡å‘æ˜¯å †ä¸Šçš„blockå˜é‡,å †ä¸Šblockå˜é‡`çš„__forwardingæŒ‡é’ˆæŒ‡å‘å…¶è‡ªèº«. æ‰€ä»¥åœ¨å¯¹multiplier æ•´å‹å€¼è¿›è¡Œæ”¹å˜æ—¶ ,ä½¿ç”¨æ˜¯è½¬æ¢å‡ºæ¥çš„éƒ½æ˜¯åŒä¸€è¡Œä»£ç  . é¢è¯•é¢˜: { __block int multiplier = 10; _blk = ^int(int num){ return num * multiplier; } multiplier = 6; [self excuteBlock]; } - (void)excuteBlock{ int result = _blk(4); NSLog(@&quot;result is %d&quot;, result); // result is 24 } 4ã€__forwardingå­˜åœ¨çš„æ„ä¹‰ ä¸ç®¡åœ¨ä»»ä½•å†…å­˜ä½ç½®ï¼Œéƒ½å¯ä»¥é¡ºåˆ©çš„è®¿é—®åŒä¸€ä¸ª__blockå˜é‡ äº”ã€Blockçš„å¾ªç¯å¼•ç”¨Blockå¾ªç¯å¼•ç”¨ï¼ˆä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨ï¼‰åœ¨ä¸‹å›¾ä¸­ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ //_strBlk _array éƒ½ä¸ºå½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡ // _array ç”±strongä¿®é¥°, _strBlk ç”±copy ä¿®é¥° { _array = [NSMutableArray arrayWithObject:@&quot;block&quot;]; _strBlk = ^NSString* (NSString *num){ return [NSString stringWithFormat:@&quot;helloc_%@&quot;, _array[0]]; }; _strBlk(@&quot;hello&quot;); } //äº§ç”Ÿè‡ªå¾ªç¯å¾ªç¯å¼•ç”¨ äº§ç”Ÿè‡ªå¾ªç¯å¼•ç”¨ :å› ä¸ºå½“å‰å¯¹è±¡é€šè¿‡copyå£°æ˜blockï¼Œè€Œåœ¨å½“å‰blockä¸­åˆä½¿ç”¨åˆ°äº†å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œå› ä¸ºä¼šè¿å¸¦å±æ€§å…³é”®å­—ä¸€èµ·æˆªè·ï¼Œå› ä¸ºarrayæ˜¯é€šè¿‡strongä¿®é¥°ï¼Œå› æ­¤blockä¸­æœ‰ä¸€ä¸ªstrongç±»å‹çš„æŒ‡é’ˆæŒ‡å‘å½“å‰å¯¹è±¡ï¼Œäº§ç”Ÿå¾ªç¯å¼•ç”¨ è§£å†³æ–¹æ³•ï¼šé¿å…å¾ªç¯å¼•ç”¨â€”â€”åœ¨å½“å‰æ ˆä¸­ç”¨weakä¿®é¥°çš„weakArrayæŒ‡é’ˆæŒ‡å‘åŸå¯¹è±¡çš„_array,åœ¨blockä¸­ä½¿ç”¨weakArrayï¼ˆå› ä¸ºæˆªè·çš„æ˜¯ä¸€ä¸ªweakç±»å‹ï¼‰ //è§£å†³ { _array = [NSMutableArray arrayWithObject:@&quot;block&quot;]; __weak NSArray *weakArray = _array; _strBlk = ^NSString* (NSString *num){ return [NSString stringWithFormat:@&quot;helloc_%@&quot;, weakArray[0]]; }; _strBlk(@&quot;hello&quot;); } é—®é¢˜:blockå¤–éƒ¨ ä¸ºä»€ä¹ˆé€šè¿‡weakå±æ€§å…³é”®å­—ä¿®é¥°å¯¹è±¡,å°±å¯ä»¥é¿å…å¾ªç¯å¼•ç”¨?ç­”:ç”±äºblockæˆªè·å˜é‡æ˜¯å¯¹è±¡ç±»å‹,ä¼šè¿åŒå…¶æ‰€æœ‰æƒä¿®é¥°ç¬¦ä¸€èµ·æˆªè·,åœ¨blockå¤–éƒ¨å®šä¹‰å˜é‡æ˜¯weakæ‰€æœ‰æƒä¿®é¥°ç¬¦,åœ¨blockæ‰€äº§ç”Ÿç»“æ„ä½“ä¸­æ‰€æŒæœ‰çš„å˜é‡ä¹Ÿæ˜¯__weakçš„ é—®é¢˜: ï¼ˆ__blocké€ æˆçš„å¾ªç¯å¼•ç”¨ï¼‰åœ¨ä¸‹ä»£ç ä¸­ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ { __block MCBlock *blockSelf = self; _blk = ^int(int num){ //var = 2 return num * blockSelf.var; }; _blk(3); } ç­”: åœ¨MRCä¸­ï¼Œä¸ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨ åœ¨ARCä¸­ï¼Œäº§ç”Ÿå¾ªç¯å¼•ç”¨ï¼Œå¼•èµ·å†…å­˜æ³„æ¼ è§£å†³: { __block MCBlock *blockSelf = self; _blk = ^int(int num){ //var = 2 int result = num * blockSelf.var blockSelf = nil; return result; }; _blk(3); } Blocké¢è¯•æ€»ç»“é—®é¢˜: ä»€ä¹ˆæ˜¯blockï¼Ÿç­”:Blockæ˜¯å°†å‡½æ•°åŠå…¶æ‰§è¡Œä¸Šä¸‹æ–‡å°è£…èµ·æ¥çš„å¯¹è±¡ã€‚ é—®é¢˜: ä¸ºä»€ä¹ˆBlockä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨ï¼Ÿç­”:1&gt;å¦‚æœå½“å‰Blockå¯¹å½“å‰å¯¹è±¡çš„æŸä¸€æˆå‘˜å˜é‡è¿›è¡Œæˆªè·, blockä¼šå¯¹æˆå‘˜å˜é‡æœ‰å¼ºå¼•ç”¨, å½“å‰å¯¹è±¡åˆå¯¹å½“å‰blockæœ‰ä¸€ä¸ªcopyå¼ºå¼•ç”¨, å°±äº§ç”Ÿè‡ªå¾ªç¯å¼•ç”¨é—®é¢˜.å¯ä»¥é€šè¿‡å£°æ˜å¯¹è±¡çš„æˆå‘˜å˜é‡ä¸º __weak å˜é‡,æ¥è¿›è¡Œå¾ªç¯å¼•ç”¨æ¶ˆé™¤. (å› ä¸ºå½“å‰å¯¹è±¡é€šè¿‡copyå£°æ˜blockï¼Œè€Œåœ¨å½“å‰blockä¸­åˆä½¿ç”¨åˆ°äº†å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œå› ä¸ºä¼šè¿å¸¦å±æ€§å…³é”®å­—ä¸€èµ·æˆªè·ï¼Œå¦‚æœæˆå‘˜å˜é‡ä½¿ç”¨strongä¿®é¥°ï¼Œå› æ­¤blockä¸­æœ‰ä¸€ä¸ªstrongç±»å‹çš„æŒ‡é’ˆæŒ‡å‘å½“å‰å¯¹è±¡ï¼Œäº§ç”Ÿè‡ªå¾ªç¯å¼•ç”¨.) 2&gt;å¦‚æœå®šä¹‰__blockè¯´æ˜ç¬¦ ,åœ¨ARCä¸­ ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨, åœ¨MRCä¸­ä¸ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨.å¯ä»¥åœ¨ARCä¸­é‡‡å–æ–­ç¯çš„æ–¹å¼è§£å†³å¾ªç¯å¼•ç”¨,ä½†æ˜¯æœ‰ä¸ªå¼Šç«¯,å¦‚æœblock å¦‚æœä¸€ç›´æ²¡æœ‰è°ƒç”¨, å¾ªç¯å¼•ç”¨æ˜¯æ²¡æœ‰åŠæ³•æ¶ˆé™¤çš„. é—®é¢˜:æ€æ ·ç†è§£Blockæˆªè·å˜é‡çš„ç‰¹æ€§ï¼Ÿç­”:(è¢«æˆªè·ç±»å‹çš„åˆ†ç±»å›ç­”)ç­”: å¯¹ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œæˆªè·æ–¹å¼å„æœ‰ä¸åŒ1.å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹çš„å±€éƒ¨å˜é‡å¯¹å…¶å€¼è¿›è¡Œæˆªè·2.å¯¹äºå¯¹è±¡ç±»å‹çš„å±€éƒ¨å˜é‡è¿åŒæ‰€æœ‰æƒä¿®é¥°ç¬¦ä¸€èµ·æˆªè·3.å¯¹äºé™æ€å±€éƒ¨å˜é‡ä»¥æŒ‡é’ˆæ–¹å¼æˆªè·4.å¯¹äºå…¨å±€å˜é‡ã€é™æ€å…¨å±€å˜é‡ä¸æˆªè·. é—®é¢˜: ä½ éƒ½é‡è§è¿‡å“ªäº›å¾ªç¯å¼•ç”¨ï¼Ÿä½ åˆæ˜¯å’‹æ ·è§£å†³çš„ç­”:NSTimerå¾ªç¯å¼•ç”¨. Blockå¾ªç¯å¼•ç”¨:2æ–¹é¢1&gt;blockæ‰€æ•è·å˜é‡ä¹Ÿæ˜¯å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡, block ä¹Ÿæ˜¯å½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡,å°±ä¼šé€ æˆè‡ªå¾ªç¯å¼•ç”¨. é‡‡ç”¨é¿å…å¾ªç¯å¼•ç”¨æ–¹å¼, åŠ weakæ‰€æœ‰æƒä¿®é¥°ç¬¦,æ¥é¿å…å¾ªç¯å¼•ç”¨.2&gt;blockä¹Ÿä¼šé€ æˆå¾ªç¯å¼•ç”¨, åœ¨ARCä¸­ ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨, åœ¨MRCä¸­ä¸ä¼šäº§ç”Ÿå¾ªç¯å¼•ç”¨.å¯ä»¥åœ¨ARCä¸­é‡‡å–æ–­ç¯çš„æ–¹å¼è§£å†³å¾ªç¯å¼•ç”¨,ä½†æ˜¯æœ‰ä¸ªå¼Šç«¯,å¦‚æœblock å¦‚æœä¸€ç›´æ²¡æœ‰è°ƒç”¨, å¾ªç¯å¼•ç”¨æ˜¯æ²¡æœ‰åŠæ³•æ¶ˆé™¤çš„. 1ã€ç›¸äº’å¾ªç¯å¼•ç”¨ typedef void(^Block)(NSString*); @interface ClassA() { int age; } @property(nonatomic,strong)Block block; @property(nonatomic,strong)NSString *temp; @end @implementation ClassA - (void)viewDidLoad { [super viewDidLoad]; self.block = ^(NSString * content) { self.temp = content; self-&gt;age = 15; }; } -(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event{ self.block(@&quot;èµµå››&quot;); } (1)ã€å¦‚ä¸Šä»£ç ï¼ŒselfæŒæœ‰blockï¼Œè€Œå †ä¸Šçš„blockåˆä¼šæŒæœ‰selfï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ï¼Œè¿™ä¸ªä¾‹å­éå¸¸å¥½ï¼Œå› ä¸ºxcodeéƒ½èƒ½æ£€æµ‹å‡ºæ¥ï¼ŒæŠ¥å‡ºè­¦å‘Šï¼š[capturing self strongly in this block is likely to lead to a retain cycle]ï¼Œå½“ç„¶å¤§éƒ¨åˆ†å¾ªç¯å¼•ç”¨çš„æƒ…å†µxcodeæ˜¯ä¸ä¼šæŠ¥è­¦å‘Šçš„ã€‚(2)ã€è¿™æ—¶Blockå¯¹è±¡è™½ç„¶æ•è·äº†weakSelfï¼Œå»¶é•¿äº†weakSelfè¿™ä¸ªå±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†weakSelfæ˜¯é™„æœ‰__weakä¿®é¥°ç¬¦çš„å˜é‡ï¼Œå®ƒå¹¶ä¸ä¼šæŒæœ‰å¯¹è±¡ï¼Œä¸€æ—¦å®ƒæŒ‡å‘çš„å¯¹è±¡è¢«åºŸå¼ƒäº†ï¼Œå®ƒå°†è‡ªåŠ¨è¢«èµ‹å€¼ä¸ºnilã€‚åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œå¯èƒ½weakSelfæŒ‡å‘çš„å¯¹è±¡ä¼šåœ¨Blockæ‰§è¡Œå‰è¢«åºŸå¼ƒï¼Œè¿™æ ·å¯èƒ½é¡¶å¤šå°±æ˜¯è¿”å›nilï¼Œä½†åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ˆè­¬å¦‚åœ¨Blockä¸­æœ‰ç§»é™¤KVOçš„è§‚å¯Ÿè€…çš„é€»è¾‘ï¼Œåœ¨æ‰§è¡Œåˆ°è¯¥é€»è¾‘å‰selfå°±é‡Šæ”¾äº†ï¼‰å°±ä¼šå¯¼è‡´crashã€‚è¿™æ—¶å¯ä»¥åœ¨Blockå†…éƒ¨ï¼ˆç¬¬ä¸€å¥ï¼‰å†æŒæœ‰ä¸€æ¬¡weakSelfæŒ‡å‘çš„å¯¹è±¡ï¼Œä¿è¯åœ¨æ‰§è¡ŒBlockæœŸé—´è¯¥å¯¹è±¡ä¸ä¼šè¢«åºŸå¼ƒï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ weak-strongã€‚ è§£å†³è¿™ç§å¾ªç¯å¼•ç”¨çš„å¸¸ç”¨æ–¹å¼å¦‚ä¸‹ typedef void(^Block)(NSString*); @interface ClassA() { int age; } @property(nonatomic,strong)Block block; @property(nonatomic,strong)NSString *temp; @end @implementation ClassA - (void)viewDidLoad { [super viewDidLoad]; __weak typeof(self) weakSelf = self; self.block = ^(NSString * content) { __strong typeof(weakSelf)strongSelf = weakSelf; strongSelf.temp = content; strongSelf-&gt;age = 15; }; } -(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event{ self.block(@&quot;èµµå››&quot;); } 2ã€å¤šå¾ªç¯å¼•ç”¨ typedef void(^Block)(NSString*); @interface ClassB : UIViewController @property(nonatomic,strong)Block block; #import &quot;ClassA.h&quot; #import &quot;ClassB.h&quot; @interface ClassA() @property(nonatomic,strong)ClassB *classB; @property(nonatomic,strong)NSString *temp; @end @implementation ClassA - (void)viewDidLoad { [super viewDidLoad]; self.classB = [[ClassB alloc]init]; self.classB.block = ^(NSString *content) { self.temp = content; }; } -(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event{ self.classB.block(@&quot;èµµå››&quot;); } @end å¦‚ä¸Šä»£ç ï¼ŒClassAæŒæœ‰ClassBï¼ŒClassBæŒæœ‰blockï¼Œè€Œå †ä¸Šçš„blockåˆä¼šæŒæœ‰ClassAï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨ã€‚]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬4ç«  å†…å­˜ç®¡ç†ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F23%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC4%E7%AB%A0-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²å†…å­˜ç®¡ç†ç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬å†…å­˜å¸ƒå±€ã€å†…å­˜ç®¡ç†æ–¹æ¡ˆã€æ•°æ®ç»“æ„ã€ARC&amp;MRCã€å¼•ç”¨è®¡æ•°ç®¡ç†ã€å¼±å¼•ç”¨ç®¡ç†ã€è‡ªåŠ¨é‡Šæ”¾æ± ã€å¾ªç¯å¼•ç”¨ã€‚ ä¸€ã€å†…å­˜å¸ƒå±€ 1ã€stack(æ ˆåŒº)ï¼šæ–¹æ³•è°ƒç”¨ã€‚2ã€heap(å †åŒº)ï¼šé€šè¿‡allocç­‰åˆ†é…çš„å¯¹è±¡ã€‚3ã€bssï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ç­‰ã€‚4ã€Dataï¼šå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ç­‰ã€‚5ã€textï¼šç¨‹åºä»£ç ã€‚ äºŒã€å†…å­˜ç®¡ç†æ–¹æ¡ˆé—®é¢˜:iOSæ“ä½œç³»ç»Ÿæ˜¯æ€æ ·å¯¹å†…å­˜è¿›è¡Œç®¡ç†çš„?(iOSä¼šæ ¹æ®ä¸åŒåœºæ™¯ä¼šé‡‡å–ä¸åŒå†…å­˜æ–¹æ¡ˆ) 1ã€TaggedPoint(å°å¯¹è±¡)ã€‚ å¦‚NSNumberï¼ŒDSDataç±»å‹ã€‚2ã€NONPOINTER_ISA(éæŒ‡é’ˆå‹çš„isa)ã€‚ åœ¨arm64ä½æ¶æ„ä¸‹ä½¿ç”¨çš„ä¸€ç§æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆä¸»è¦æ˜¯é«˜æ•ˆåˆ©ç”¨64ä½æ¶æ„ä¸‹isaæŒ‡é’ˆçš„å‰©ä½™å†…å­˜ç©ºé—´ã€‚3ã€æ•£åˆ—è¡¨(æ•£åˆ—è¡¨æ˜¯å¤æ‚çš„æ•°æ®ç»“æ„,å…¶ä¸­åŒ…å«å¼•ç”¨è®¡æ•°è¡¨ã€å¼±å¼•ç”¨è¡¨)ã€‚ åœ¨32ä½æ¶æ„ä¸‹ä½¿ç”¨ä»¥åŠ64ä½æ¶æ„ä¸‹isaæŒ‡é’ˆå­˜æ”¾ä¸ä¸‹çš„åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ä¿¡å¼•ç”¨è®¡æ•°è¡¨ 1.NONPOINTER_ISANONPOINTER_ISA 64ä¸ªæ¯”ç‰¹ä½åˆ†æ: indexed(1ä½): 0 ä»£è¡¨çº¯isaæŒ‡é’ˆ,å†…å®¹ä»£è¡¨å½“å‰å¯¹è±¡çš„ç±»å¯¹è±¡çš„åœ°å€ . 1ä»£è¡¨isaæŒ‡é’ˆä¸ä»…å­˜å‚¨ç±»å¯¹è±¡çš„åœ°å€, è¿˜æœ‰å†…å­˜ç®¡ç†æ•°æ®ä¹Ÿå°±æ˜¯NONPOINTER_ISA(éæŒ‡é’ˆå‹çš„isa). has_assoc(2ä½):è¡¨ç¤ºå½“å‰å¯¹è±¡æ˜¯å¦æœ‰å…³è”å¯¹è±¡, 0 æ²¡æœ‰, 1æœ‰. has_cxx_dtor(3ä½): å½“å‰å¯¹è±¡æ˜¯å¦æœ‰ä½¿ç”¨C++è¯­è¨€ç›¸å…³å†…å®¹.å½“å‰å¯¹è±¡æ˜¯å¦ä½¿ç”¨ARCç®¡ç†å†…å­˜ shiftcls(4~37ä½): å…±33ä½æ¯”ç‰¹ä½ è¡¨ç¤ºå½“å‰å¯¹è±¡ç±»å¯¹è±¡çš„æŒ‡é’ˆåœ°å€. magic(38~43ä½): weakly_referenced(44ä½): æ ‡è¯†å½“å‰å¯¹è±¡æ˜¯å¦æœ‰å¼±å¼•ç”¨æŒ‡é’ˆ deallocating(45ä½): å½“å‰å¯¹è±¡æ˜¯å¦æ­£åœ¨è¿›è¡Œdeallocæ“ä½œ has_sidetable_rc(46ä½): å½“å‰isaæŒ‡é’ˆä¸­æ‰€å­˜å‚¨å¼•ç”¨è®¡æ•°è¾¾åˆ°ä¸Šé™, éœ€è¦å¤–æŒ‚ä¸€ä¸ªsidetableæ•°æ®ç»“æ„ç”¨æ¥å­˜å‚¨ç›¸å…³çš„å¼•ç”¨å†…å®¹,ä¹Ÿå°±æ˜¯æ•£åˆ—è¡¨ extra_rc(47~64ä½): é¢å¤–çš„å¼•ç”¨è®¡æ•°, å½“å¼•ç”¨è®¡æ•°åœ¨å¾ˆå°å€¼èŒƒå›´å°±ä¼šå­˜å‚¨åœ¨isaæŒ‡é’ˆä¸­. 2.æ•£åˆ—è¡¨æ–¹å¼ SideTables()ï¼ˆéåµŒå…¥å¼ç³»ç»Ÿä¸­åŒ…å«64ä¸ªSideTableï¼‰ï¼Œå®é™…æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé€šè¿‡å¯¹è±¡çš„æŒ‡é’ˆæ‰¾åˆ°å¯¹åº”çš„å¼•ç”¨è®¡æ•°è¡¨æˆ–å¼±å¼•ç”¨è¡¨ï¼Œåœ¨å“ªä¸€ä¸ªSideTableä¸­ SideTableç»“æ„åŒ…å«è‡ªæ—‹é” å¼•ç”¨è®¡æ•°è¡¨ å¼±å¼•ç”¨è¡¨ é—®é¢˜:ä¸ºä»€ä¹ˆä¸æ˜¯ä¸€ä¸ªSideTableï¼Ÿå­˜åœ¨æ•ˆç‡é—®é¢˜ï¼Œå¦‚æœå¤šä¸ªå¯¹è±¡åœ¨å¯¹åŒä¸€å¼ è¡¨è¿›è¡Œå¼•ç”¨è®¡æ•°æ—¶ï¼Œå°±ä¼šç­‰å¾…å‰ä¸€ä¸ªå¯¹è±¡æ“ä½œç»“æŸæ‰èƒ½æ“ä½œã€‚å¼•ç”¨åˆ†ç¦»é”çš„æ–¹æ¡ˆï¼Œå¯ä»¥æé«˜è®¿é—®æ•ˆç‡ã€‚ é—®é¢˜:æ€æ ·å®ç°å¿«é€Ÿåˆ†æµï¼Ÿï¼ˆå“ˆå¸ŒæŸ¥æ‰¾çš„è¿‡ç¨‹ï¼‰ SideTablesçš„æœ¬è´¨æ˜¯ä¸€å¼ Hashè¡¨ã€‚ æ ¹æ®å¯¹è±¡çš„åœ°å€ï¼Œé€šè¿‡ä¸€ä¸ªå‡åŒ€æ•£åˆ—å‡½æ•°çš„è®¡ç®—å°±å¯ä»¥å¾—åˆ°æ•°ç»„ä¸‹æ ‡ç´¢å¼•å€¼ã€‚ HashæŸ¥æ‰¾è¿‡ç¨‹ä¾‹: ç»™å®šå€¼æ˜¯å¯¹è±¡å†…å­˜åœ°å€,ç›®æ ‡å€¼æ˜¯æ•°ç»„ä¸‹æ ‡ç´¢å¼•ã€‚ f(ptr) = (uintptr_t)ptr% array.count ä¸‰ã€æ•£åˆ—è¡¨ä¸­æ•°æ®ç»“æ„1)è‡ªæ—‹é”ï¼ˆSpinlock_tï¼‰ æ˜¯ä¸€ç§å¿™ç­‰çš„é”ï¼ˆå½“å‰é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œå½“å‰çº¿ç¨‹å°±ä¼šä¸æ–­çš„æ¢æµ‹è¿™ä¸ªé”æ˜¯å¦è¢«é‡Šæ”¾,å¦‚æœé‡Šæ”¾è‡ªå·±ç¬¬ä¸€æ—¶é—´è·å–é”ï¼‰ é€‚ç”¨äºè½»é‡è®¿é—®ã€‚ ä¾‹å¦‚å¼•ç”¨è®¡æ•°+1ã€-1æ“ä½œ è¡¥å……:ä¿¡å·é‡ å¦‚æœè·å–ä¸åˆ°é”,è‡ªå·±ä¼šç­‰å¾…ä¼‘çœ ,ç­‰ä»–å…¶ä»–çº¿ç¨‹é‡Šæ”¾é”æ—¶,å”¤é†’å½“å‰çº¿ç¨‹. 2)å¼•ç”¨è®¡æ•°è¡¨ï¼ˆRefcountMapï¼‰ptr â€”â€”&gt; DisguisedPtr(obj) â€”â€”&gt;size_tæé«˜æŸ¥æ‰¾æ•ˆç‡ï¼Œæ’å…¥å’Œè·å–éƒ½æ˜¯é€šè¿‡åŒä¸€ä¸ªå“ˆå¸Œç®—æ³•ï¼Œé¿å…äº†æ•°ç»„éå† 3)å¼±å¼•ç”¨è¡¨ï¼ˆweal_table_tï¼‰ptr â€”â€”&gt; Hashå‡½æ•°â€”â€”&gt;value å››ã€ARC&amp;MRC1ã€MRCï¼šæ‰‹åŠ¨å¼•ç”¨è®¡æ•°ã€‚allocã€retainã€releaseã€retainCountã€autoreleaseã€deallocã€‚2ã€ARCï¼šè‡ªåŠ¨å¼•ç”¨è®¡æ•°ã€‚(1)ã€ARCæ˜¯LLVMï¼ˆç¼–è¯‘å™¨ï¼‰å’ŒRunTimeåä½œçš„ç»“æœã€‚(2)ã€ARCä¸­ç¦æ­¢æ‰‹åŠ¨è°ƒç”¨retain/release/retainCount/deallocã€‚(3)ã€ARCä¸­æ–°å¢weakã€strongå±æ€§å…³é”®å­—ã€‚ äº”ã€å¼•ç”¨è®¡æ•°ç®¡ç†å®ç°åŸç†åˆ†æï¼ŒåŒ…æ‹¬allocã€retainã€releaseã€retainCountã€deallocã€‚ 1ã€allocå®ç°ç»è¿‡ä¸€ç³»åˆ—è°ƒç”¨ï¼Œæœ€ç»ˆè°ƒç”¨çš„Cå‡½æ•°callocï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰è®¾ç½®å¼•ç”¨è®¡æ•°ä¸º1ï¼ˆä½†æ˜¯é€šè¿‡retainCountå¾—çŸ¥æ˜¯1ï¼Œåœ¨åé¢ä¼šè®²åˆ°ï¼‰ 2ã€retainå®ç°ç»è¿‡ä¸¤æ¬¡HashæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¼•ç”¨è®¡æ•°å€¼ï¼Œç„¶åè¿›è¡Œ+1çš„æ“ä½œ SideTable&amp; table = SideTables()[this]; size_t&amp; refcntStorage = table.refcnts[this]; refcntStorage += SIDE_TABLE_RC_ONE; 3ã€releaseå®ç°ç»è¿‡ä¸¤æ¬¡HashæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¼•ç”¨è®¡æ•°å€¼ï¼Œç„¶åè¿›è¡Œ-1çš„æ“ä½œ SideTable&amp; table = SideTables()[this]; RefcountMap::iterator it = table.refcnts.find(this); it -&gt;second -= SIDE_TABLE_RC_ONE; 4ã€retainCountå®ç°ç»è¿‡ä¸¤æ¬¡HashæŸ¥æ‰¾ï¼Œæ‰¾åˆ°å¯¹åº”çš„å¼•ç”¨è®¡æ•°å€¼ï¼Œç„¶åä¸1ç›¸åŠ ï¼ˆå› æ­¤åˆšallocçš„å¯¹è±¡ï¼Œåœ¨å¯¹åº”çš„å¼•ç”¨è®¡æ•°è¡¨ä¸­å®é™…æ˜¯æ²¡æœ‰è¿™ä¸ªæ˜ å°„çš„ï¼‰ SideTable&amp; table = SideTables()[this]; size_t refcnt_result = 1; RefcountMap::iterator it = table.refcnts.find(this); refcnt_result += it-&gt;secont &gt;&gt; SIDE_TABLE_RC_SHIFT; 5ã€deallocå®ç° åˆ¤æ–­å¯¹è±¡æ—¶å€™å¯ä»¥é‡Šæ”¾çš„æ¡ä»¶ï¼ˆäº”ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯ï¼‰ æ²¡æœ‰ä½¿ç”¨nonpointer_isa æ²¡æœ‰weakæŒ‡é’ˆæŒ‡å‘ æ²¡æœ‰æœ‰å…³è”å¯¹è±¡ æ²¡æœ‰ä½¿ç”¨ARCæˆ–è€…æ¶‰åŠC++ å½“å‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ²¡æœ‰é€šè¿‡SideTableä¸­çš„å¼•ç”¨è®¡æ•°è¡¨æ¥å­˜å‚¨çš„ object_dispose() å®ç° objc_destructInstance()å®ç° clearDeallocating()å®ç° å…­ã€å¼±å¼•ç”¨ç®¡ç† é—®é¢˜:å¦‚ä½•æ·»åŠ weakå˜é‡çš„?(ç³»ç»Ÿæ˜¯æ€æ ·æŠŠä¸€ä¸ªweakå˜é‡æ·»åŠ åˆ°å¼±å¼•ç”¨è¡¨ä¸­?)ç­”:å¯¹è±¡æŒ‡é’ˆåœ¨ç»è¿‡ç¼–è¯‘å™¨çš„ç¼–è¯‘ä¹‹åè°ƒç”¨objc_initweak()ï¼Œç„¶åstoreweak()æ–¹æ³•ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„å‡½æ•°è°ƒç”¨æ ˆï¼Œæœ€ç»ˆåœ¨weak_register_no_lock()è¿›è¡Œå¼±å¼•ç”¨å˜é‡çš„æ·»åŠ ï¼Œ(å…·ä½“æ·»åŠ ä½ç½®æ˜¯)é€šè¿‡hashç®—æ³•ä½ç½®æŸ¥æ‰¾ï¼Œå¦‚æœå·²ç»å­˜åœ¨å½“å‰å¯¹è±¡å¯¹åº”çš„å¼±å¼•ç”¨æ•°ç»„ï¼Œåˆ™ç›´æ¥åŠ è¿›å»ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºæ–°ä¸ªæ–°çš„å¼±å¼•ç”¨æ•°ç»„ï¼Œç„¶åæŠŠç¬¬0ä¸ªä½ç½®å­˜æ”¾æ–°çš„weakæŒ‡é’ˆ,åé¢çš„éƒ½åˆå§‹åŒ–nilæˆ–è€…0ã€‚ é—®é¢˜: ç³»ç»Ÿå¦‚ä½•å®ç°å°†åºŸå¼ƒå¯¹è±¡çš„weakæŒ‡é’ˆç½®ä¸ºnil?ç­”:å½“å¯¹è±¡è¢«deallocåºŸå¼ƒä¹‹åï¼Œdeallocå†…éƒ¨å®ç°ä¸­ä¼šè°ƒç”¨å¼±å¼•ç”¨æ¸…é™¤çš„ç›¸å…³å‡½æ•°(weak_clear_no_lock())ã€‚ç„¶ååœ¨å‡½æ•°å®ç°ä¸­ï¼Œæ ¹æ®å½“å‰å¯¹è±¡æŒ‡é’ˆï¼Œå“ˆå¸ŒæŸ¥æ‰¾å¼±å¼•ç”¨è¡¨ï¼ŒæŠŠå½“å‰å¯¹è±¡å¯¹åº”çš„å¼±å¼•ç”¨éƒ½æ‹¿å‡ºæ¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„ä¸­æ‰€æœ‰çš„å¼±å¼•ç”¨æŒ‡é’ˆç½®åˆ†åˆ«ç½®ä¸ºnilã€‚ ä¸ƒã€è‡ªåŠ¨é‡Šæ”¾æ± 1 è‡ªåŠ¨é‡Šæ”¾æ± æ•°æ®ç»“æ„ç¼–è¯‘å™¨ä¼šå°†@autoreleasepool{}æ”¹å†™ä¸º: void *ctx = objc_autoreleasePoolPush(); {}ä¸­çš„ä»£ç  objc_autoreleasePoolPop(ctx); ä¸‹é¢å¯¹ä¸Šé¢çš„ä¸»è¦å‡½æ•°è¿›è¡Œä¸€ä¸ªç®€å•çš„è¯´æ˜: 1)objc_autoreleasePoolPushå†…éƒ¨å®ç° 2)objc_autoreleasePoolPopå†…éƒ¨å®ç° å®é™…objc_autoreleasePoolPopå‡½æ•°åœ¨å†…éƒ¨åšäº†popæ“ä½œï¼Œæ‰¹é‡å°†autoreleasepoolä¸­çš„æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šåšä¸€æ¬¡releaseæ“ä½œ. ä¸‹é¢å¯¹ä¸Šé¢çš„ä¸»è¦å‡½æ•°è¿›è¡Œä¸€ä¸ªç®€å•çš„è¯´æ˜: 3)AutoreleasePoolçš„ç»“æ„ æ˜¯ä»¥æ ˆä¸ºç»“ç‚¹é€šè¿‡åŒå‘é“¾è¡¨çš„å½¢å¼ç»„åˆè€Œæˆ æ˜¯å’Œçº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ é—®é¢˜:AutoreleasePoolçš„å®ç°ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ(ä»€ä¹ˆæ˜¯è‡ªåŠ¨é‡Šæ”¾æ± ?å®ç°åŸç†)ç­”:AutoreleasePoolæ˜¯ä»¥æ ˆä¸ºç»“ç‚¹ï¼Œé€šè¿‡åŒå‘é“¾è¡¨çš„å½¢å¼ç»„åˆè€Œæˆçš„æ•°æ®ç»“æ„ã€‚ AutoreleasePoolæ˜¯å’Œçº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ã€‚ 2 åŒå‘é“¾è¡¨ AutoreleasePoolPage 1)AutoreleasePoolPage::pushå®ç°æµç¨‹ï¼ˆé‡Šæ”¾æ± å¤šå±‚åµŒå¥—ï¼‰ æ’å…¥å“¨å…µå¯¹è±¡ 2)AutoreleasePoolPage::popå®ç°æµç¨‹ï¼ˆä¸pushç›¸åï¼‰ æ ¹æ®ä¼ å…¥çš„å“¨å…µå¯¹è±¡æ‰¾åˆ°å¯¹åº”çš„ä½ç½® ç»™ä¸Šæ¬¡pushæ“ä½œä¹‹åæ·»åŠ çš„å¯¹è±¡ä¾æ¬¡å‘é€releaseæ¶ˆæ¯ å›é€€nextæŒ‡é’ˆåˆ°æ­£ç¡®çš„ä½ç½® [obj autorelease]çš„å®ç°ï¼ˆå¯¹è±¡åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ï¼‰å…ˆåˆ¤æ–­å½“å‰nextæŒ‡é’ˆæ˜¯å¦æŒ‡å‘æ ˆé¡¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å‘æ ˆé¡¶ç›´æ¥å°†å¯¹è±¡åŠ å…¥åˆ°nextæŒ‡é’ˆä½ç½®,ç»“æŸæµç¨‹ï¼›å¦‚æœnextå·²ç»ä½äºæ ˆé¡¶ï¼Œåˆ™å¢åŠ ä¸€ä¸ªæ ˆç»“ç‚¹åˆ°é“¾è¡¨ä¸Šï¼Œåœ¨æ–°çš„æ ˆæ·»åŠ å¯¹è±¡,ç»“æŸæµç¨‹ é—®é¢˜: arrayæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾çš„å‘¢? - (void)viewDidLoad { [super viewDidLoad]; NSMutableArray *arrar =[NSMutableArray array]; NSLog(@&quot;%@&quot;,arrar); } ç­”ï¼šåœ¨å½“æ¬¡runloopå°†è¦ç»“æŸçš„æ—¶å€™è°ƒç”¨AutoreleasePoolPage:pop(),å¯¹arrayå¯¹è±¡æ‰§è¡Œreleaseæ“ä½œ é—®é¢˜:AutoreleasePoolä¸ºä½•å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Ÿç­”: å¤šæ¬¡æ’å…¥å“¨å…µå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å¯¹ä¸€ä¸ªæ–°çš„autoreleasePoolçš„åˆ›å»ºï¼Œå¦‚æœå½“å‰æ ˆæ²¡æœ‰æ»¡ï¼Œåˆ™ä¸éœ€è¦åˆ›å»ºæ–°çš„page,å¦‚æœæ»¡äº†ï¼Œæ–°å¢ä¸€ä¸ªæ ˆèŠ‚ç‚¹ é—®é¢˜: AutoreleasePoolçš„ä½¿ç”¨åœºæ™¯ï¼Ÿç­”: åœ¨forå¾ªç¯ä¸­ï¼Œallocå›¾ç‰‡æ•°æ®ç­‰å†…å­˜æ¶ˆè€—è¾ƒå¤§çš„åœºæ™¯æ‰‹åŠ¨æ’å…¥autoreleasePoolï¼Œæ¯ä¸€æ¬¡forå¾ªç¯éƒ½è¿›è¡Œä¸€æ¬¡å†…å­˜çš„é‡Šæ”¾ï¼Œé™ä½å†…å­˜æ¶ˆè€— å…«ã€å¾ªç¯å¼•ç”¨1ã€ä¸‰ç§å¾ªç¯å¼•ç”¨ï¼šè‡ªå¾ªç¯å¼•ç”¨ã€ç›¸äº’å¾ªç¯å¼•ç”¨ã€å¤šå¾ªç¯å¼•ç”¨ã€‚ 2ã€å¦‚ä½•ç ´é™¤å¾ªç¯å¼•ç”¨ï¼Ÿ1) é¿å…äº§ç”Ÿå¾ªç¯å¼•ç”¨ (å¦‚ä½¿ç”¨ä»£ç†ä¸¤ä¸ªå¯¹è±¡,ä¸€ä¸ªæ˜¯å¼ºå¼•ç”¨,ä¸€ä¸ªæ˜¯å¼±å¼•ç”¨)2) åœ¨åˆé€‚çš„æ—¶æœºæ‰‹åŠ¨æ–­ç¯ 3ã€ å¸¸è§çš„å¾ªç¯å¼•ç”¨åœºæ™¯ï¼šä»£ç†ï¼ˆdelegateï¼‰ã€block ã€ NSTimer ã€å¤§ç¯å¼•ç”¨ 4ã€å…·ä½“çš„è§£å†³æ–¹æ¡ˆéƒ½æœ‰å“ªäº›ï¼Ÿ __weak __block __unsafe_unretained(ä¸weakç­‰æ•ˆ) blockç ´è§£ (**blockåœ¨ARCå’ŒMRCæ¡ä»¶ä¸‹çš„åŒºåˆ«?**) MRCä¸‹ï¼Œ__blockä¿®é¥°å¯¹è±¡ä¸ä¼šå¢åŠ å…¶å¼•ç”¨è®¡æ•°ï¼Œé¿å…äº†å¾ªç¯å¼•ç”¨ ARCä¸‹ï¼Œ__blockä¿®é¥°å¯¹è±¡ä¼šè¢«å¼ºå¼•ç”¨ï¼Œæ— æ³•é¿å…å¾ªç¯å¼•ç”¨ï¼Œéœ€æ‰‹åŠ¨è§£ç¯ __unsafe_unretainedç ´è§£ ä¿®é¥°å¯¹è±¡ä¸ä¼šå¢åŠ å…¶å¼•ç”¨è®¡æ•°ï¼Œé¿å…äº†å¾ªç¯å¼•ç”¨ã€‚ å¦‚æœè¢«ä¿®é¥°å¯¹è±¡åœ¨æŸä¸€æ—¶æœºè¢«é‡Šæ”¾ï¼Œä¼šäº§ç”Ÿæ‚¬ç©ºæŒ‡é’ˆã€‚ å¾ªç¯å¼•ç”¨çš„ç¤ºä¾‹ï¼Ÿï¼ˆå¹³æ—¶å¼€å‘æ—¶æ˜¯å¦æœ‰é‡åˆ°å¾ªç¯å¼•ç”¨ï¼Œåˆæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿï¼‰ Blockä½¿ç”¨ç¤ºä¾‹ï¼ˆåœ¨åé¢blockè®²è§£æ—¶ï¼‰ NSTimer çš„å¾ªç¯å¼•ç”¨é—®é¢˜ //NSTimer+WeakTimer.h @interface NSTimer (WeakTimer) + (NSTimer *)scheduledWeakTimerWithTimeInterval:(NSTimeInterval)interval target:(id)aTarget selector:(SEL)aSelector userInfo:(id)userInfo repeats:(BOOL)repeats; @end //NSTimer+WeakTimer.m @interface TimerWeakObject : NSObject @property (nonatomic, weak) id target; @property (nonatomic, assign) SEL selector; @property (nonatomic, weak) NSTimer *timer; - (void)fire:(NSTimer *)timer; @end @implementation TimerWeakObject - (void)fire:(NSTimer *)timer { if (self.target) { if ([self.target respondsToSelector:self.selector]) { [self.target performSelector:self.selector withObject:timer.userInfo]; } }else{ [self.timer invalidate]; } } @end @implementation NSTimer (WeakTimer) + (NSTimer *)scheduledWeakTimerWithTimeInterval:(NSTimeInterval)interval target:(id)aTarget selector:(SEL)aSelector userInfo:(id)userInfo repeats:(BOOL)repeats { TimerWeakObject *object = [[TimerWeakObject alloc] init]; object.target = aTarget; object.selector = aSelector; object.timer = [NSTimer scheduledTimerWithTimeInterval:interval target:object selector:@selector(fire:) userInfo:userInfo repeats:repeats]; return object.timer; } @end å†…å­˜ç®¡ç†é¢è¯•æ€»ç»“:é—®é¢˜:ä»€ä¹ˆæ˜¯ARC?ç­”:è‡ªåŠ¨å¼•ç”¨è®¡æ•°ã€‚ARCæ˜¯ç”±LLVMï¼ˆç¼–è¯‘å™¨ï¼‰å’ŒRunTimeå…±åŒåä½œæ¥ä¸ºæˆ‘ä»¬å®ç°è‡ªåŠ¨å¼•ç”¨è®¡æ•°çš„ç®¡ç†ã€‚ é—®é¢˜:ä¸ºä»€ä¹ˆweakæŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡åœ¨åºŸå¼ƒä¹‹åä¼šè¢«è‡ªåŠ¨ç½®ä¸ºnil?ç­”:å½“å¯¹è±¡è¢«åºŸå¼ƒä¹‹åï¼Œdeallocå†…éƒ¨å®ç°ä¸­ä¼šè°ƒç”¨æ¸…é™¤å¼±å¼•ç”¨çš„ç›¸å…³å‡½æ•°(weak_clear_no_lock())ã€‚ç„¶ååœ¨æ¸…é™¤å¼±å¼•ç”¨å‡½æ•°å®ç°ä¸­ï¼Œä¼šé€šè¿‡å“ˆå¸Œç®—æ³•æŸ¥æ‰¾è¢«åºŸå¼ƒå¯¹è±¡åœ¨å¼±å¼•ç”¨è¡¨ä¸­ä½ç½®ï¼Œæ¥æå–å®ƒæ‰€å¯¹åº”çš„å¼±å¼•ç”¨æŒ‡é’ˆçš„åˆ—è¡¨æ•°ç»„ï¼Œç„¶åè¿›è¡Œforå¾ªç¯éå†, æŠŠæ‰€æœ‰çš„å¼±å¼•ç”¨æŒ‡é’ˆç½®åˆ†åˆ«ç½®ä¸ºnilã€‚ é—®é¢˜:è‹¹æœæ˜¯å¦‚ä½•å®ç°AutoreleasePoolçš„?ç­”:AutoreleasePoolæ˜¯ä»¥æ ˆä¸ºç»“ç‚¹ï¼Œé€šè¿‡åŒå‘é“¾è¡¨çš„å½¢å¼ç»„åˆè€Œæˆçš„æ•°æ®ç»“æ„ã€‚ é—®é¢˜:ä»€ä¹ˆæ˜¯å¾ªç¯å¼•ç”¨?ä½ é‡åˆ°è¿‡å“ªäº›å¾ªç¯å¼•ç”¨,æ˜¯æ€æ ·è§£å†³çš„?ç­”: NSTimerå¾ªç¯å¼•ç”¨ //__weakä¿®é¥°ï¼Œå¼±åº”ç”¨ï¼Œå¯¹è±¡å¼•ç”¨è®¡æ•°ä¸ä¼šåŠ 1 __weak NSArray *weakArr1; __weak NSArray *weakArr2; { //arr1æŒ‡å‘çš„æ•°ç»„å¯¹è±¡æ²¡æœ‰è¢«æ³¨å†Œåˆ°autorelease pool NSArray *arr1 = [[NSArray alloc] initWithObjects:@&quot;123&quot;, nil]; weakArr1 = arr1; //arr2æŒ‡å‘çš„æ•°ç»„å¯¹è±¡å·²è¢«æ³¨å†Œåˆ°autorelease pool NSArray *arr2 = [NSArray arrayWithObjects:@&quot;123&quot;, nil]; weakArr2 = arr2; } //å±€éƒ¨å˜é‡arr1å’Œarr2çš„ä½œç”¨åŸŸç»“æŸï¼Œ //æ­¤æ—¶arr1æŒ‡å‘çš„å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨ï¼Œå› æ­¤è¢«å›æ”¶ï¼› //è€Œarr2æŒ‡å‘çš„å¯¹è±¡ä»ç„¶åœ¨autorelease poolä¸­ NSLog(@&quot;%@&quot;, weakArr1);//è¾“å‡ºnull NSLog(@&quot;%@&quot;, weakArr2);//è¾“å‡ºarr2ï¼Œå› ä¸ºæ­¤åˆ»arr2åœ¨autorelease poolä¸­ï¼Œä¸ä¼šå› ä¸ºarr2ä½œç”¨åŸŸçš„ç»“æŸè€Œè¢«å›æ”¶ __weak NSObject *weakObj1; __weak NSObject *weakObj2; { __autoreleasing NSObject *obj1 = [[NSObject alloc] init]; //weakObj1æŒ‡å‘çš„å¯¹è±¡å·²è¢«æ³¨å†Œåˆ°autorelease pool weakObj1 = obj1; __strong NSObject *obj2 = [[NSObject alloc] init]; //weakObj2æŒ‡å‘çš„å¯¹è±¡æ²¡æœ‰è¢«æ³¨å†Œåˆ°autorelease pool weakObj2 = obj2; } //å±€éƒ¨å˜é‡obj1å’Œobj2çš„ä½œç”¨åŸŸç»“æŸï¼Œ //æ­¤æ—¶weakObj2æŒ‡å‘çš„å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨ï¼Œå› æ­¤è¢«å›æ”¶ï¼› //è€ŒweakObj1æŒ‡å‘çš„å¯¹è±¡ä»ç„¶åœ¨autorelease poolä¸­ NSLog(@&quot;%@&quot;, weakObj1);//è¾“å‡º&lt;NSObject: 0x100206030&gt;ï¼Œå› ä¸ºæ­¤åˆ»weakObj1åœ¨autorelease poolä¸­ï¼Œä¸ä¼šå› ä¸ºobj1ä½œç”¨åŸŸçš„ç»“æŸè€Œè¢«å›æ”¶ NSLog(@&quot;%@&quot;, weakObj2);//è¾“å‡ºnull Runloopæ¯æ¬¡å¾ªç¯éƒ½æ˜¯è¢«ä¸€ä¸ªAutoReleasePoolåŒ…å›´ç€çš„ï¼Œå…·ä½“è¯´æ¯æ¬¡Runloopå¾ªç¯å°†è¦ç»“æŸçš„æ—¶å€™ä¼šé‡Šæ”¾å½“å‰runloopçš„å†…å­˜å ç”¨ã€‚å†åˆ›å»ºå¥½ä¸€ä¸ªAutoReleasePoolç»™ä¸‹ä¸€æ¬¡Runloopå¾ªç¯ä½¿ç”¨ã€‚åœ¨è¯¥æ–¹æ³•ä¸­åˆ›å»ºçš„arrayä¼šåŠ å…¥åˆ°å½“æ¬¡RunLoopçš„AutoReleasePoolä¸­ï¼Œarrayä¼šåœ¨å½“å‰RunLoopå°†è¦ç»“æŸçš„æ—¶å€™è°ƒç”¨AutoreleasePoolPage:pop()ï¼Œå¾—åˆ°å†…å­˜é‡Šæ”¾ã€‚]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬3ç«  RunTimeç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F23%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC3%E7%AB%A0-RunTime%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²RunTimeç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€ç±»å¯¹è±¡ä¸å…ƒç±»å¯¹è±¡ã€æ¶ˆæ¯ä¼ é€’ã€æ–¹æ³•ç¼“å­˜ã€æ¶ˆæ¯è½¬å‘ã€Method-Swizzlingã€åŠ¨æ€æ·»åŠ æ–¹æ³•ã€åŠ¨æ€æ–¹æ³•è§£æã€‚ ä¸€.ç±»å¯¹è±¡ä¸å…ƒç±»å¯¹è±¡1) objc_object å®é™…ä½¿ç”¨æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯idç±»å‹, idå¯¹è±¡ä»£è¡¨å°±æ˜¯objc_objectç»“æ„ä½“.id = objc_object åˆ†ä¸ºä»¥ä¸‹å‡ éƒ¨åˆ†: isa_t å…³äºisaæ“ä½œç›¸å…³(å¦‚:è·å–isaæ‰€æŒ‡å‘çš„ç±»å¯¹è±¡ æˆ–è€… é€šè¿‡ç±»å¯¹è±¡isaè·å–å®ƒå…ƒç±»å¯¹è±¡ä¸€äº›ä¾¿åˆ©æ–¹æ³•) å¼±å¼•ç”¨ç›¸å…³ (å¦‚:æ ‡è®°ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ ‡è®°è¿‡å¼±å¼•ç”¨æŒ‡é’ˆ) å…³è”å¯¹è±¡ç›¸å…³(å¦‚: è¿™ä¸ªå¯¹è±¡è®¾ç½®å…³è”å±æ€§) å†…å­˜ç®¡ç†ç›¸å…³ (å¦‚:MRC retain release , ARC @autoreleasepool) 2) objc_class Class = objc_classobjc_class ç»§æ‰¿è‡ª objc_object, æ‰€ä»¥Classä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ Class superClass (æŒ‡å‘çˆ¶ç±»å¯¹è±¡) cache_t cache (æ–¹æ³•ç¼“å­˜ç»“æ„, è¿›è¡Œæ¶ˆæ¯ä¼ é€’ä¼šä½¿ç”¨è¿™ä¸ªæ•°æ®ç»“æ„) class_data_bits_t bits (ç±»å®šä¹‰çš„å˜é‡ å±æ€§å’Œæ–¹æ³•éƒ½åœ¨è¿™ä¸ªç»“æ„ä¸­) 3) isaæŒ‡é’ˆ å…±ç”¨ä½“ isa_t (é—®é¢˜:isaæŒ‡é’ˆæ˜¯ä»€ä¹ˆå«ä¹‰?) åœ¨32ä½æˆ–64ä½æ¶æ„ä¸‹ï¼Œéƒ½æ˜¯32æˆ–è€…64ä¸ª0æˆ–è€…1çš„äºŒè¿›åˆ¶æ•°å­— ,isaæŒ‡é’ˆåˆ†ä¸ºæŒ‡é’ˆå½¢isaå’ŒéæŒ‡é’ˆå½¢isa æŒ‡é’ˆå‹isaçš„å€¼ä»£è¡¨Classçš„åœ°å€ éæŒ‡é’ˆå‹isaçš„å€¼çš„éƒ¨åˆ†ä»£è¡¨Classçš„åœ°å€ 4) isaæŒ‡é’ˆçš„æŒ‡å‘ å…³äºå¯¹è±¡ï¼Œå…¶æŒ‡å‘ç±»å¯¹è±¡ å…³äºç±»å¯¹è±¡ï¼Œå…¶æŒ‡å‘å…ƒç±»å¯¹è±¡ å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆéƒ½æŒ‡å‘æ ¹å…ƒç±»å¯¹è±¡ï¼Œè€Œæ ¹å…ƒç±»å¯¹è±¡å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘æ ¹ç±»å¯¹è±¡ã€‚ æ–¹æ³•è°ƒç”¨æ—¶,è°ƒç”¨å®ä¾‹æ–¹æ³•å®é™…ä¸Šé€šè¿‡isaæŒ‡é’ˆåˆ°ç±»å¯¹è±¡ä¸­è¿›è¡Œæ–¹æ³•æŸ¥æ‰¾.å¦‚æœè°ƒç”¨ç±»æ–¹æ³•, é€šè¿‡ç±»å¯¹è±¡isaè¿™ç§åˆ°å…ƒç±»å¯¹è±¡ä¸­è¿›è¡Œæ–¹æ³•æŸ¥æ‰¾. 5) cache_tcache_t ç‰¹ç‚¹: ç”¨äºå¿«é€ŸæŸ¥æ‰¾æ–¹æ³•æ‰§è¡Œå‡½æ•° (æé«˜æ¶ˆæ¯ä¼ é€’é€Ÿåº¦) æ˜¯å¯å¢é‡æ‰©å±•çš„å“ˆå¸Œè¡¨ç»“æ„ (æé«˜æŸ¥æ‰¾æ•ˆç‡) æ˜¯å±€éƒ¨æ€§åŸç†çš„æœ€ä½³åº”ç”¨ cache_t ç†è§£ä¸ºä¸€ä¸ªæ•°ç»„å®ç°çš„, é‡Œè¾¹å­˜å‚¨ bucket_tç»“æ„ä½“, bucket_tæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡. keyå¯¹åº”OCä¸­ @selector , IMPç†è§£ä¸ºæ— ç±»å‹å‡½æ•°æŒ‡é’ˆ. è°ƒç”¨æ–¹æ³•æ—¶ä½¿ç”¨SEL, é€šè¿‡æ–¹æ³•é€‰æ‹©å™¨åç§°æ¥å¯»æ‰¾å…·ä½“å®ç°IMP. 6)class_data_bits_t class_data_bits_tä¸»è¦æ˜¯å¯¹class_rw_tçš„å°è£… class_rw_t ä»£è¡¨ç±»ç›¸å…³çš„è¯»å†™ä¿¡æ¯, å¯¹class_ro_tçš„å°è£… class_ro_tä»£è¡¨ç±»ç›¸å…³çš„åªè¯»ä¿¡æ¯ 7) class_rw_t ä¸ºä¸€ä¸ªç±»æ·»åŠ åˆ†ç±»ä¸­çš„åè®® å±æ€§ æ–¹æ³•éƒ½åœ¨protocols properties methods è¿™ä¸‰ä¸ªç»“æ„ä¸­.è¿™ä¸‰ä¸ªæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„(list_array_tt) 8) class_ro_t class_ro_t ä¸­ä¸€ç»´æ•°ç»„ ivars protocols properties methodList å­˜å‚¨çš„åŸå§‹ç±»å®šä¹‰æ·»åŠ çš„æˆå‘˜å˜é‡ åè®® å±æ€§å’Œæ–¹æ³•åˆ—è¡¨ äºŒ.runtimeæ•´ä½“æ•°æ®ç»“æ„1) method_t method_tç»“æ„ä½“å°è£…äº†å‡½æ•°å››è¦ç´ ï¼Œå…¶ä¸­åç§°é€šè¿‡SELæ–¹æ³•é€‰æ‹©å™¨è¡¨ç¤ºï¼Œè¿”å›å€¼å’Œå‚æ•°åˆ™ç”±â€œType Encodingsâ€ç±»å‹çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå‡½æ•°ä½“åˆ™æŒ‡ä»£äº†IMPå‡½æ•°æŒ‡é’ˆã€‚ æ›´å¤šå…³äºType Encodings 2)runtimeæ•´ä½“æ•°æ®ç»“æ„ ä¸‰ å®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡ã€å…ƒç±»å¯¹è±¡ ç±»å¯¹è±¡å­˜å‚¨å®ä¾‹æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯ çš„æ•°æ®ç»“æ„ å…ƒç±»å¯¹è±¡å­˜å‚¨ç±»æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯ çš„æ•°æ®ç»“æ„. å…³äºç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š Root class æ˜¯æ ¹ç±»,åˆ†ç±»çˆ¶ç±»æŒ‡å‘nil, å®é™…æŒ‡ NSObjectè¿™ä¸ªç±» å·¦ä¾§éƒ¨åˆ†æŒ‡å®ä¾‹å¯¹è±¡, ä¹Ÿå°±æ˜¯objc_objectè¿™ä¸ªæ•°æ®ç»“æ„,å®ä¾‹isaæŒ‡å‘å®ä¾‹å¯¹è±¡çš„ç±»å¯¹è±¡ å³ä¾§éƒ¨åˆ†æŒ‡å…ƒç±»å¯¹è±¡, ä»»ä½•å…ƒç±»å¯¹è±¡isaæŒ‡é’ˆæŒ‡å‘æ ¹å…ƒç±»å¯¹è±¡,æ ¹å…ƒç±»å¯¹è±¡è‡ªèº«isaæŒ‡é’ˆæŒ‡å‘æ ¹å…ƒç±»å¯¹è±¡.æ ¹å…ƒç±»å¯¹è±¡superclassæŒ‡é’ˆæŒ‡å‘æ ¹ç±»å¯¹è±¡ å½“è°ƒç”¨ç±»æ–¹æ³•ä»å…ƒç±»å¯¹è±¡æ–¹æ³•åˆ—è¡¨ä¸­é€çº§çˆ¶ç±»å¾€ä¸ŠæŸ¥æ‰¾ , æŸ¥æ‰¾åˆ°æ ¹å…ƒç±»å¯¹è±¡(Root class meta)æ‰¾ä¸åˆ°æ—¶, å°±ä¼šå»æ ¹ç±»(Root class class)å¯¹è±¡ä¸­æŸ¥æ‰¾åŒåçš„å®ä¾‹æ–¹æ³•å®ç°. é—®é¢˜:ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»?ç­”: å®ä¾‹å¯¹è±¡å¯ä»¥é€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°å®ƒçš„ç±»å¯¹è±¡ ç±»å¯¹è±¡å­˜å‚¨å®ä¾‹æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯,ç±»å¯¹è±¡å¯ä»¥é€šè¿‡å®ƒçš„isaæŒ‡é’ˆæ‰¾åˆ°å®ƒçš„å…ƒç±»å¯¹è±¡,ä»è€Œå¯ä»¥è®¿é—®ç±»æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯. ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡éƒ½æ˜¯objc_classæ•°æ®ç»“æ„,objc_classæ•°æ®ç»“æ„ç”±äºç»§æ‰¿objc_object,æ‰€ä»¥ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡æ‰æœ‰isaæŒ‡é’ˆ.è¿›è€Œå®ä¾‹å¯¹è±¡å¯ä»¥é€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°å¯¹åº”ç±»å¯¹è±¡,è®¿é—®å®ä¾‹æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯, ç±»å¯¹è±¡é€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°å…ƒç±»å¯¹è±¡,è®¿é—®ç±»æ–¹æ³•åˆ—è¡¨ç­‰ä¿¡æ¯. é—®é¢˜:å¦‚æœè°ƒç”¨ç±»æ–¹æ³•æ²¡æœ‰å¯¹åº”çš„å®ç°, å½“æ—¶æœ‰åŒåçš„å®ä¾‹æ–¹æ³•å®ç°, è¿™ä¸ªæ—¶å€™ä¼šä¸ä¼šå‘ç”Ÿå´©æºƒ?ä¼šä¸ä¼šäº§ç”Ÿå®é™…è°ƒç”¨?ç­”: ç”±äºæ ¹å…ƒç±»å¯¹è±¡çš„superclassæŒ‡é’ˆæŒ‡å‘äº†æ ¹ç±»å¯¹è±¡, å½“æŸ¥æ‰¾åˆ°æ ¹å…ƒç±»å¯¹è±¡(Root class meta)ç±»æ–¹æ³•æ‰¾ä¸åˆ°æ—¶, å°±ä¼šå»æ ¹ç±»(Root class class)å¯¹è±¡ä¸­æŸ¥æ‰¾åŒåçš„å®ä¾‹æ–¹æ³•å®ç°,å¦‚æœæ‰¾åˆ°è°ƒç”¨. å›› æ¶ˆæ¯ä¼ é€’æœºåˆ¶1) æ¶ˆæ¯ä¼ é€’æµç¨‹å¯ä»¥ç”¨ä¸‹å›¾å±•ç¤ºæ¶ˆæ¯ä¼ é€’çš„æµç¨‹ï¼š æ³¨æ„ï¼šåœ¨æ¶ˆæ¯ç¼“å­˜ä¸­æŸ¥æ‰¾æ˜¯é€šè¿‡å“ˆå¸Œè¡¨æ¥å¿«é€Ÿå®šä½å‡½æ•°æŒ‡é’ˆï¼Œè€Œåœ¨å½“å‰ç±»æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾æ—¶ï¼Œå¯¹äºå·²ç»æ’åºå¥½çš„åˆ—è¡¨ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œè€Œå¯¹äºæ²¡æœ‰æ’åºçš„åˆ—è¡¨é‡‡ç”¨ä¸€èˆ¬éå†æŸ¥æ‰¾æ³•ã€‚ 2) ç¼“å­˜æŸ¥æ‰¾ä¾‹ ï¼šç»™å®šå€¼æ˜¯SEL, ç›®æ ‡å€¼æ˜¯å¯¹åº”çš„bucket_tä¸­çš„IMP. é—®é¢˜:ç¼“å­˜æŸ¥æ‰¾å…·ä½“çš„æ˜¯æ€æ ·çš„æµç¨‹å’Œæ­¥éª¤?ç­”:ç¼“å­˜æŸ¥æ‰¾å®é™…ä¸Šå°±æ˜¯ä» cache_tä¸­ æŠŠå¯¹åº”bucket_tæ‰¾å‡ºæ¥.æ ¹æ®ç»™å®šçš„æ–¹æ³•é€‰æ‹©å™¨,é€šè¿‡ä¸€ä¸ªå‡½æ•°æ¥æ˜ å°„å‡ºbucket_tåœ¨æ•°ç»„ä¸­æ˜ å°„çš„ä½ç½®, å®é™…ä¸Šå°±æ˜¯å“ˆå¸ŒæŸ¥æ‰¾. å“ˆå¸ŒæŸ¥æ‰¾é€šè¿‡ç»™å®šçš„å€¼, ç»è¿‡å“ˆå¸Œå‡½æ•°ç®—æ³•ç®—å‡ºçš„å€¼, å®é™…ä¸ºç»™å®šå€¼åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•ä½ç½®. 3)å½“å‰ç±»ä¸­æŸ¥æ‰¾ å¯¹äºå·²æ’åºå¥½çš„åˆ—è¡¨, é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•æŸ¥æ‰¾æ–¹æ³•å¯¹åº”æ‰§è¡Œå‡½æ•°. å¯¹äºæ²¡æœ‰æ’åºçš„åˆ—è¡¨, é‡‡ç”¨ä¸€èˆ¬éå†æŸ¥æ‰¾æ–¹æ³•å¯¹åº”æ‰§è¡Œå‡½æ•°. 4)çˆ¶ç±»é€çº§æŸ¥æ‰¾ é—®é¢˜: æ¶ˆæ¯ä¼ é€’æœºåˆ¶?ç­”:1)ç¼“å­˜æ˜¯å¦å‘½ä¸­, å½“å‰ç±»æ–¹æ³•åˆ—è¡¨æ˜¯å¦å‘½ä¸­, é€çº§çˆ¶ç±»æ–¹æ³•åˆ—è¡¨æ˜¯å¦å‘½ä¸­2)æ ¹æ®ä¸‰ä¸ªæ–¹é¢åˆ†åˆ«è®²è¿°å…·ä½“æƒ…å†µ äº” æ¶ˆæ¯è½¬å‘æµç¨‹ resolvelnstanceMethodæ–¹æ³•ä¸­ä¸ºå¯¹è±¡åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œå·²è¾¾åˆ°å¤„ç†æ¶ˆæ¯æœªè¢«å®ç°çš„é—®é¢˜ã€‚ å½“objc_msgSendæ–¹æ³•è°ƒç”¨æ‰¾ä¸åˆ°å“åº”çš„å‡½æ•°åç§°æ—¶å°±ä¼šè¿›è¡Œæ¶ˆæ¯è½¬å‘ï¼Œä¸»è¦åˆ†ä¸º3æ­¥:1ã€åŠ¨æ€æ–¹æ³•è§£æè°ƒç”¨æ–¹æ³•+(BOOL)resolveInstanceMethod:(SEL)sel(å®ä¾‹æ–¹æ³•åŠ¨æ€è§£æ)å’Œ+ (BOOL)resolveClassMethod:(SEL)sel(ç±»æ–¹æ³•åŠ¨æ€è§£æ)ã€‚ 2ã€å¤‡æ´æ¥æ”¶è€…è°ƒç”¨æ–¹æ³• - (id)forwardingTargetForSelector:(SEL)aSelector 3ã€å®Œå…¨è½¬å‘è°ƒç”¨æ–¹æ³•- (void)forwardInvocation:(NSInvocation )anInvocationå’Œ- (NSMethodSignature )methodSignatureForSelector:(SEL)aSelector å…­ Method-Swizzling+ (void)load{ //è·å–testæ–¹æ³• Method test = class_getInstanceMethod(self, @selector(test)); //è·å–otherTestæ–¹æ³• Method otherTest = class_getInstanceMethod(self, @selector(otherTest)); //äº¤æ¢ä¸¤ä¸ªæ–¹æ³• method_exchangeImplementations(test, otherTest); } - (void)test{ NSLog(@&quot;test&quot;); } - (void)otherTest{ //å®é™…ä¸Šæ˜¯è°ƒç”¨testå…·ä½“å®ç° [self otherTest]; NSLog(@&quot;otherTest&quot;); } ä¸ƒ åŠ¨æ€æ·»åŠ æ–¹æ³•é—®é¢˜:æ˜¯å¦ä½¿ç”¨è¿‡performSelector: æ–¹æ³•?ç­”: void testImp (void) { NSLog(@&quot;test invoke&quot;); } + (BOOL)resolveInstanceMethod:(SEL)sel { // å¦‚æœæ˜¯testæ–¹æ³• æ‰“å°æ—¥å¿— if (sel == @selector(test)) { NSLog(@&quot;resolveInstanceMethod:&quot;); // åŠ¨æ€æ·»åŠ testæ–¹æ³•çš„å®ç° class_addMethod(self, @selector(test), testImp, &quot;v@:&quot;); //è§£å†³äº†å®ä¾‹æ–¹æ³•è°ƒç”¨ è¿”å›YES return YES; }else{ // è¿”å›çˆ¶ç±»çš„é»˜è®¤è°ƒç”¨ return [super resolveInstanceMethod:sel]; } } å…« åŠ¨æ€æ–¹æ³•è§£æ@dynamic (é—®é¢˜:æ˜¯å¦ä½¿ç”¨è¿‡@dynamic å…³é”®å­—?) åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€å°†å‡½æ•°å†³è®®æ¨è¿Ÿåˆ°è¿è¡Œæ—¶(å½“æŠŠå±æ€§æ ‡è¯†ä¸º@dynamicæ—¶, ä»£è¡¨ç€ä¸éœ€è¦ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¸ºå±æ€§ç”Ÿæˆgetæ–¹æ³•å’Œsetæ–¹æ³•çš„å…·ä½“å®ç°,è€Œæ˜¯åœ¨è¿è¡Œæ—¶å…·ä½“è°ƒç”¨getæ–¹æ³•æˆ–è€…setæ–¹æ³•æ—¶,å†å»æ·»åŠ å…·ä½“å®ç°) ç¼–è¯‘æ—¶è¯­è¨€åœ¨ç¼–è¯‘æœŸè¿›è¡Œå‡½æ•°å†³è®®(åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šäº†æ–¹æ³•å‡½æ•°ä½“æ˜¯å“ªä¸ª, å…·ä½“è¿è¡Œè¿‡ç¨‹ä¸­ä¸èƒ½ä¿®æ”¹) Runtimeé¢è¯•é—®é¢˜æ€»ç»“é—®é¢˜: [obj foo] å’Œ objc_msgSend()å‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»?ç­”: å®é™…ä¸Šæ¶ˆæ¯ä¼ é€’, åœ¨ç¼–è¯‘æœŸå¤„ç†è¿‡ç¨‹å, [obj foo] å°±è½¬å˜æˆäº†objc_magSend(obj, @selector(foo)) , ä¹‹åå¼€å§‹runtimeæ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ é—®é¢˜:runtimeå¦‚ä½•é€šè¿‡Selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€çš„?ç­”:è€ƒå¯Ÿæ¶ˆæ¯ä¼ é€’æœºåˆ¶. é¦–å…ˆæŸ¥æ‰¾å½“å‰å®ä¾‹æ‰€å¯¹åº”ç±»å¯¹è±¡çš„ç¼“å­˜æ˜¯å¦æœ‰Selectorå¯¹åº”ç¼“å­˜çš„IMPå®ç°, å¦‚æœç¼“å­˜å‘½ä¸­äº†,å°±æŠŠå‘½ä¸­ç¼“å­˜å‡½æ•°è¿”å›ç»™è°ƒç”¨æ–¹. å¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­,æ ¹æ®å½“å‰ç±»æ–¹æ³•åˆ—è¡¨æŸ¥æ‰¾Selectorå¯¹åº”çš„IMPå®ç° å¦‚æœå½“å‰ç±»æ²¡æœ‰å‘½ä¸­, åœ¨æ ¹æ®å½“å‰ç±»superclassæŒ‡é’ˆé€çº§æŸ¥æ‰¾çˆ¶ç±»æ–¹æ³•åˆ—è¡¨,ç„¶åæŸ¥æ‰¾Selectorå¯¹åº”çš„IMPå®ç°. é—®é¢˜:èƒ½å¦å‘ç¼–è¯‘åçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡?ç­”:(ä¸¤ä¸ªç‚¹ ç¼–è¯‘åçš„ç±»,è¿˜æ˜¯åŠ¨æ€æ·»åŠ çš„ç±»?)ä¸èƒ½.ç”±äºruntimeæ˜¯æ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ ç±», ç¼–è¯‘ä¹‹å‰åˆ›å»ºçš„ç±»,å·²ç»å®Œæˆäº†å®ä¾‹å˜é‡çš„å¸ƒå±€, runtimeæ•°æ®ç»“æ„ä¸­ class_ro_t ç¼–è¯‘åæ²¡æœ‰åŠæ³•ä¿®æ”¹çš„. é—®é¢˜:èƒ½å¦å‘åŠ¨æ€æ·»åŠ çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡?ç­”:å¯ä»¥. åŠ¨æ€æ·»åŠ çš„ç±»è°ƒç”¨æ³¨å†Œç±»æ–¹æ³•å‰,å®Œæˆå®ä¾‹å˜é‡çš„æ·»åŠ æ˜¯å¯ä»¥å®ç°çš„.]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬2ç«  Objective-Cè¯­è¨€ç‰¹æ€§ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F23%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC2%E7%AB%A0-Objective-C%E8%AF%AD%E8%A8%80%E7%89%B9%E6%80%A7%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²Objective-Cè¯­è¨€ç‰¹æ€§ç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬åˆ†ç±»ã€å…³è”å¯¹è±¡ã€æ‰©å±•ã€ä»£ç†ã€é€šçŸ¥ã€KVOã€ KVCã€ å±æ€§å…³é”®å­—ã€‚ ä¸€ã€åˆ†ç±»(Category)ä»€ä¹ˆæ˜¯åˆ†ç±»ï¼ˆcategoryï¼‰?Categoryæ˜¯ä¸€ä¸ªæŒ‡å‘åˆ†ç±»çš„ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œç»“æ„ä½“ä¸»è¦åŒ…å«åˆ†ç±»å®šä¹‰çš„å®ä¾‹æ–¹æ³•ä»¥åŠç±»æ–¹æ³• 1ã€ä½ ç”¨åˆ†ç±»éƒ½åšäº†å“ªäº›äº‹ï¼Ÿ(1)ã€å£°æ˜ç§æœ‰æ–¹æ³•(2)ã€åˆ†è§£ä½“ç§¯åºå¤§çš„ç±»æ–‡ä»¶(3)ã€æŠŠFrameworkçš„ç§æœ‰æ–¹æ³•å…¬å¼€ 2ã€åˆ†ç±»ç‰¹ç‚¹(1)ã€è¿è¡Œæ—¶å†³è®®ï¼ˆè¿è¡Œæ—¶æ‰ä¼šæ·»åŠ åˆ°å®¿ä¸»ç±»ï¼‰åœ¨ç¼–å†™åˆ†ç±»æ–‡ä»¶ä¹‹åï¼Œå¹¶ä¸ä¼šç«‹å³æŠŠåˆ†ç±»ä¸­æ·»åŠ çš„å†…å®¹æ·»åŠ åˆ°å®¿ä¸»ç±»ä¸­ï¼Œè€Œæ˜¯é€šè¿‡runtimeæŠŠåˆ†ç±»ä¸­çš„å†…å®¹æ·»åŠ åˆ°å®¿ä¸»ç±»ä¸­(2)ã€å¯ä»¥ä¸ºç³»ç»Ÿç±»æ·»åŠ åˆ†ç±» åˆ†ç±»æœ‰å¤šä¸ªçš„æƒ…å†µä¸‹ï¼ŒåŸæœ‰ç±»ä»¥åŠæ¯ä¸ªåˆ†ç±»éƒ½æœ‰åŒåçš„åˆ†ç±»æ–¹æ³•ï¼Œæœ€åå“ªä¸ªä¼šç”Ÿæ•ˆï¼Ÿç­”ï¼šé€šè¿‡æºç åˆ†æï¼Œå–å†³äºç¼–è¯‘å™¨ï¼Œæœ€åä¸€ä¸ªå‚ä¸ç¼–è¯‘çš„åˆ†ç±»ä¼šç”Ÿæ•ˆã€‚åˆ†ç±»æ–¹æ³•åœ¨runtimeåˆ†é…å†…å­˜æ—¶ä¼šæ’åœ¨æ•°ç»„å‰åˆ—ï¼Œåœ¨æ–¹æ³•æŸ¥æ‰¾è¿‡ç¨‹ä¸­ï¼Œåˆ†ç±»æ·»åŠ çš„æ–¹æ³•ä¼šâ€è¦†ç›–â€œå®¿ä¸»ç±»çš„åŒåæ–¹æ³•(æ·»åŠ åœ¨ï¼ŒåŸæ–¹æ³•ä¾ç„¶å­˜åœ¨) 3ã€åˆ†ç±»ä¸­éƒ½å¯ä»¥æ·»åŠ å“ªäº›å†…å®¹ï¼Ÿ(1)ã€å®ä¾‹æ–¹æ³•(2)ã€ç±»æ–¹æ³•(3)ã€åè®®(4)ã€å±æ€§(åªä¼šç”Ÿæˆsetã€getæ–¹æ³•ï¼Œä¸ä¼šç”Ÿæˆæˆå‘˜å˜é‡)å¯ä»¥å†™@propertyä½†å¹¶ä¸ä¼šåœ¨åˆ†ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ åˆ†ç±»ç»“æ„ä½“åˆ†æ: //objc-runtime-680ç‰ˆæœ¬ struct category_t { const char *name; //åˆ†ç±»å classref_t cls; //åˆ†ç±»æ‰€å±çš„ç±»å //åˆ†ç±»ä¸­æ‰€æœ‰ç»™ç±»æ·»åŠ çš„å®ä¾‹æ–¹æ³•çš„åˆ—è¡¨ struct method_list_t *instanceMethods; //åˆ†ç±»ä¸­æ‰€æœ‰æ·»åŠ çš„ç±»æ–¹æ³•çš„åˆ—è¡¨ struct method_list_t *classMethods; //åˆ†ç±»å®ç°çš„æ‰€æœ‰åè®®çš„åˆ—è¡¨ struct protocol_list_t *protocols; //åˆ†ç±»ä¸­æ·»åŠ çš„æ‰€æœ‰å®ä¾‹å±æ€§åˆ—è¡¨ struct property_list_t *instanceProperties; // Fields below this point are not always present on disk. // struct property_list_t *_classProperties; method_list_t *methodsForMeta(bool isMeta) { if (isMeta) return classMethods; else return instanceMethods; } property_list_t *propertiesForMeta(bool isMeta) { if (isMeta) return nil; //classProperties else return instanceProperties; } }; å¯ä»¥çœ‹åˆ°ï¼Œåˆ†ç±»ç»“æ„ä½“ä¸­ä¼šå¼•ç”¨å…¶å®ä¾‹å¯¹è±¡ï¼Œç±»å¯¹è±¡ï¼Œåè®®ä»¥åŠå®ä¾‹å±æ€§çš„åˆ—è¡¨ã€‚åœ¨åŠ è½½ä¸­ï¼Œç³»ç»Ÿä¼šè¯»å–é•œåƒåŠ è½½åˆ†ç±»æ–‡ä»¶å¹¶å…³è”åˆ°ä»–çš„å®¿ä¸»ç±»ä¸­ã€‚ 4ã€åˆ†ç±»åŠ è½½è°ƒç”¨æ ˆ åŠ è½½ä¸­ï¼Œåˆ†ç±»çš„æ–¹æ³•ä¼šâ€œè¦†ç›–â€åŸç”Ÿç±»çš„æ–¹æ³•ï¼Œè¿™é‡Œçš„è¦†ç›–å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„è¦†ç›–ï¼Œè€Œæ˜¯å°†åŸç±»çš„æ–¹æ³•åœ¨å†…å­˜æŒ‡é’ˆä¸­åç§»ï¼Œè€Œåˆ†ç±»æ–¹æ³•ä¼šå‰ç§»ã€‚ä¸åŒåˆ†ç±»æ‰€æ·»åŠ çš„åŒæ–¹æ³•åçš„æ–¹æ³•ä¹Ÿä¼šæ ¹æ®ç¼–è¯‘é¡ºåºè€Œäº’ç›¸è¦†ç›–ï¼Œæœ€åè¢«ç¼–è¯‘çš„åˆ†ç±»æ–¹æ³•å°†ä¼šâ€œè¦†ç›–â€æ‰ä¹‹å‰ç¼–è¯‘çš„åˆ†ç±»ã€‚ç”±äºç¼–è¯‘æ—¶ï¼Œåˆ†ç±»æ‰€æ‹¥æœ‰çš„æ–¹æ³•ä¼šæ ¹æ®åˆ†ç±»çš„åç§°å¯¹åº”å­˜å‚¨åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ‰€ä»¥ç›¸åŒçš„åˆ†ç±»åä¼šé€ æˆç¼–è¯‘æ—¶çš„æŠ¥é”™ã€‚ 5ã€æºç åˆ†æ(1)ã€åˆ†ç±»æ·»åŠ çš„æ–¹æ³•å¯ä»¥â€è¦†ç›–â€åŸç±»æ–¹æ³•ã€‚(2)ã€åŒååˆ†ç±»æ–¹æ³•è°èƒ½ç”Ÿæ•ˆå–å†³äºç¼–è¯‘é¡ºåºã€‚æœ€åè¢«ç¼–è¯‘çš„åˆ†ç±»æœ€ä¼˜å…ˆä¼šç”Ÿæ•ˆ(3)ã€åå­—ç›¸åŒçš„åˆ†ç±»ä¼šå¼•èµ·ç¼–è¯‘æŠ¥é”™ã€‚ äºŒã€å…³è”å¯¹è±¡1ã€èƒ½å¦ç»™åˆ†ç±»æ·»åŠ â€æˆå‘˜å˜é‡â€ï¼Ÿå¯ä»¥ï¼å¯ä»¥å†™@propertyï¼ŒåŸåˆ™ä¸Šæ˜¯ä¸å¯ä»¥æ·»åŠ æˆå‘˜å˜é‡ï¼Œä½†å¹¶æ²¡æœ‰åœ¨åˆ†ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ã€‚å®é™…ä¸Šå¯ä»¥é€šè¿‡å…³è”å¯¹è±¡associated objectæ‰©å±•å±æ€§ã€‚ //æ ¹æ®æŒ‡å®škey åˆ°objectå¯¹è±¡ä¸­è·å–keyç›¸å¯¹åº”çš„å…³è”å€¼,å°†å…³è”å€¼ä½œä¸ºå‡½æ•°è¿”å›å€¼,è¿”å›ç»™è°ƒç”¨æ–¹ id objc_getAssociatedObject(id object, const void * key) //å°†keyå’Œvalueå»ºç«‹æ˜ å°„å…³ç³»,å°†å¯¹åº”å…³ç³»é€šè¿‡policyç­–ç•¥å…³è”åˆ°å¯¹è±¡objectä¸Šé¢, å…³è”ç­–ç•¥æ˜¯å‘Šè¯‰å‡½æ•°valueæ˜¯copyè¿˜æ˜¯assign, retainå½¢å¼å…³è”åˆ°æ•°ç»„å¯¹è±¡ä¸Š void objc_setAssociatedObject(id object, const void * key, id value, objc_AssociationPolicy policy) //ç§»é™¤æŒ‡å®šå¯¹è±¡çš„æ‰€æœ‰çš„å…³è”å¯¹è±¡ void objc_removeAssociatedObjects(id object) åœ¨åˆ†ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡ï¼Œå¯ä»¥ä½¿åˆ†ç±»å…·æœ‰æˆå‘˜å˜é‡çš„æ•ˆæœã€‚ 2ã€å…³è”å¯¹è±¡çš„æœ¬è´¨åˆ†ç±»æ·»åŠ çš„æˆå‘˜å˜é‡ï¼Œæ·»åŠ åˆ°æˆå‘˜å˜é‡æ•°ç»„é‡Œé¢äº†å—ï¼Ÿ(1)ã€å…³è”å¯¹è±¡ç”±AssociationsMangerç®¡ç†ï¼Œå¹¶åœ¨AssociationsHashMapå­˜å‚¨ã€‚(2)ã€æ‰€æœ‰å¯¹è±¡çš„å…³è”å†…å®¹éƒ½åœ¨åŒä¸€ä¸ªå…¨å±€å®¹å™¨ä¸­ã€‚ å›¾è¯´æ˜:1&gt;æ ¹æ®ä¼ å…¥value (å¦‚ @â€Helloâ€) å’Œpolicy å°è£…æˆObjcAssociationç»“æ„2&gt; ObjcAssociation å’Œ key (å¦‚ @selector(text) ) å»ºç«‹æ˜ å°„å…³ç³»æ„æˆ ObjcAssociationMap3&gt; ç”±objectçš„åœ°å€é€šè¿‡DISGUISEå‡½æ•°è¿”å›å€¼ç”Ÿæˆkey,å’Œæ‰€å»ºç«‹æ˜ å°„ç»“æ„ ObjcAssociationMap ä½œä¸ºå…¨å±€å®¹å™¨AssociationHashMapä¸­ object å¯¹åº”çš„value ,æ”¾åˆ°å…¨å±€å®¹å™¨ä¸­ å…³è”å¯¹è±¡ä¿å­˜äº†éœ€è¦å…³è”å®ä¾‹çš„å€¼ï¼Œå’Œå¼•ç”¨è§„åˆ™ï¼Œå¹¶ä½¿ç”¨é”®Keyæ¥æŒ‡å‘å…³è”å¯¹è±¡ï¼Œè¢«å…³è”å¯¹è±¡ä½œä¸ºkeyåˆæŒ‡å‘äº†ä»–è‡ªèº«çš„å…³è”è¡¨ã€‚ 3ã€æºç åˆ†æ ä¸‰ã€æ‰©å±•1ã€ä¸€èˆ¬ç”¨æ‰©å±•åšä»€ä¹ˆï¼Ÿ(1)ã€å£°æ˜ç§æœ‰å±æ€§(2)ã€å£°æ˜ç§æœ‰æ–¹æ³•(3)ã€å£°æ˜ç§æœ‰æˆå‘˜å˜é‡ 2ã€æ‰©å±•ç‰¹ç‚¹ï¼Ÿ(1)ã€ç¼–è¯‘æ—¶å†³è®®(2)ã€åªä»¥å£°æ˜çš„å½¢å¼å­˜åœ¨ï¼Œå¤šæ•°æƒ…å†µä¸‹å¯„ç”Ÿäºå®¿ä¸»ç±»çš„.mä¸­ã€‚(3)ã€ä¸èƒ½ä¸ºç³»ç»Ÿç±»æ·»åŠ æ‰©å±•ã€‚ é—®é¢˜ï¼š æ‰©å±•å’Œç±»åˆ«çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä»äºŒè€…çš„ç‰¹ç‚¹æ¥å›ç­” å››ã€ä»£ç†(Delegate)1&gt;å®šä¹‰1ã€å‡†ç¡®çš„è¯´æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚ä»£ç†è®¾è®¡æ¨¡å¼2ã€iOSå½“ä¸­ä»¥@protocolå½¢å¼ä½“ç°ã€‚3ã€ä¼ é€’æ–¹å¼ä¸€å¯¹ä¸€ã€‚ 2&gt; ä»£ç†å·¥ä½œæµç¨‹ã€‚ å§”æ‰˜æ–¹è¦æ±‚åè®®å£°æ˜éœ€è¦çš„å±æ€§ä»¥åŠæ–¹æ³• ä»£ç†æ–¹éµå¾ªè¿™ä¸ªåè®®ï¼Œå¹¶å®ç°æ–¹æ³•ï¼Œå¯èƒ½è¿”å›å¤„ç†ç»“æœ å§”æ‰˜æ–¹è°ƒç”¨ä»£ç†æ–¹éµä»çš„æ–¹æ³•ï¼Œå¦‚æœ‰è¿”å›ç»“æœï¼Œæ¥æ”¶å¹¶å¤„ç† 3&gt;ä»£ç†é‡åˆ°é—®é¢˜:é—®é¢˜: ä»£ç†æ–¹å’Œå§”æ‰˜æ–¹ä»¥ä»€ä¹ˆæ ·çš„å…³ç³»å­˜åœ¨ï¼Ÿåº”è¯¥æ³¨æ„ä»€ä¹ˆé—®é¢˜ï¼Ÿç­”: å£°æ˜ä¸ºweakè§„é¿å¾ªç¯å¼•ç”¨ï¼ˆä»£ç†æ–¹å¼ºæŒæœ‰strongå§”æ‰˜æ–¹ å§”æ‰˜æ–¹éœ€è¦æœ‰ä¸€ä¸ªä»£ç†æ–¹çš„å£°æ˜ å£°æ˜weakï¼‰ äº”ã€é€šçŸ¥(NSNotification)1ã€é€šçŸ¥ç‰¹ç‚¹(1)ã€æ˜¯ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°çš„ç”¨äºè·¨å±‚ä¼ é€’æ¶ˆæ¯çš„æœºåˆ¶ã€‚(2)ã€ä¼ é€’æ–¹å¼ä¸ºä¸€å¯¹å¤šã€‚ é—®é¢˜:é€šçŸ¥å’Œä»£ç†çš„åŒºåˆ« æ¨¡å¼åŒºåˆ« ä»£ç†æ¨¡å¼ è§‚å¯Ÿè€…æ¨¡å¼ ä¼ é€’æ–¹å¼ ä¸€å¯¹å¤š ä¸€å¯¹ä¸€ 2ã€å¦‚ä½•å®ç°é€šçŸ¥æœºåˆ¶ï¼Ÿ é—®é¢˜:é€šçŸ¥çš„å®ç°æœºåˆ¶ï¼Ÿå‘é€è€… â€”â€”&gt;é€šçŸ¥ä¸­å¿ƒâ€”â€”&gt;å¹¿æ’­ç»™å¤šä¸ªè§‚å¯Ÿè€… é—®é¢˜: æ€ä¹ˆå®ç°é€šçŸ¥æœºåˆ¶çŒœæƒ³ï¼šï¼ˆç±»ä¼¼runtimeæ·»åŠ å±æ€§çš„æ–¹å¼ï¼‰å¯èƒ½ä¼šç”±ä¸€ä¸ªç®¡ç†è€…ç®¡ç†ä¸€ä¸ªHashMapè¡¨ï¼Œæ¯ä¸€ä¸ªnotificationNameå¯¹åº”ä¸€ä¸ªå­˜æ”¾æœ‰å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡ç›¸å…³ä¿¡æ¯( å›è°ƒæ–¹æ³•)çš„æ•°ç»„ å…­ã€KVO1ã€KVOä»‹ç» KVOæ˜¯Key-value observingçš„ç¼©å†™ã€‚ KVOæ˜¯OCå¯¹è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼çš„åˆä¸€å®ç°ã€‚ Appleä½¿ç”¨äº† isa æ··å†™ (isa-swizzling) æ¥å®ç°KVOã€‚ è¿™é‡Œæåˆ°çš„isaæ··å†™æ¨¡å¼å°±æ˜¯æŒ‡ï¼Œæ³¨å†ŒKVOçš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ªè¢«è§‚å¯Ÿå¯¹è±¡çš„å­ç±»ï¼Œç„¶åä»¤è¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è¯¥å­ç±»ï¼Œåœ¨è¯¥å­ç±»ä¸­é‡å†™äº†setteræ–¹æ³•ã€‚è¿™æ ·ï¼Œå½“åŸå¯¹è±¡å±æ€§è¢«ä¿®æ”¹æ—¶ï¼ˆåŸºäºKVCçš„ä¿®æ”¹ï¼‰ï¼Œå°±ä¼šè°ƒç”¨setteræ–¹æ³•ï¼Œç„¶åé€šçŸ¥è§‚å¯Ÿè€…ã€‚ é—®é¢˜:isa-swizzling æ··å†™æŠ€æœ¯æ€ä¹ˆä½“ç°?ç­”: å½“è°ƒç”¨addObserver:forKeyPath:options:context: å, ç³»ç»Ÿä¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºç±»KVONotifying_A, åŒæ—¶å°†åŸæ¥Açš„æŒ‡é’ˆæŒ‡å‘ç±»KVONotifying_A ã€‚ é—®é¢˜:isaæ··å†™æ˜¯æ€ä¹ˆå®ç°KVOçš„å‘¢ï¼Ÿç­”:å½“æ³¨å†Œä¸€ä¸ªå¯¹è±¡classçš„è§‚å¯Ÿè€…çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ï¼Œç³»ç»Ÿä¼šåœ¨runtimeåŠ¨æ€åˆ›å»ºä¸€ä¸ªè¯¥å¯¹è±¡çš„å­ç±»NSKVONotifiying_class(NSKVONotifiying_ç±»å)ï¼Œå¹¶å°†isaæŒ‡é’ˆæŒ‡å‘è¯¥æ´¾ç”Ÿç±»ï¼Œå¹¶é‡å†™setteræ–¹æ³•ï¼Œè´Ÿè´£é€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿå¯¹è±¡ /* options: æœ‰4ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯ï¼š NSKeyValueObservingOptionOld æŠŠæ›´æ”¹ä¹‹å‰çš„å€¼æä¾›ç»™å¤„ç†æ–¹æ³• NSKeyValueObservingOptionNew æŠŠæ›´æ”¹ä¹‹åçš„å€¼æä¾›ç»™å¤„ç†æ–¹æ³• NSKeyValueObservingOptionInitial æŠŠåˆå§‹åŒ–çš„å€¼æä¾›ç»™å¤„ç†æ–¹æ³•ï¼Œä¸€æ—¦æ³¨å†Œï¼Œç«‹é©¬å°±ä¼šè°ƒç”¨ä¸€æ¬¡ã€‚é€šå¸¸å®ƒä¼šå¸¦æœ‰æ–°å€¼ï¼Œè€Œä¸ä¼šå¸¦æœ‰æ—§å€¼ã€‚ NSKeyValueObservingOptionPrior åˆ†2æ¬¡è°ƒç”¨ã€‚åœ¨å€¼æ”¹å˜ä¹‹å‰å’Œå€¼æ”¹å˜ä¹‹åã€‚ */ //æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨ç”¨äºç›‘å¬æŒ‡å®šçš„keyè·¯å¾„ [self.person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:nil]; é”®å€¼è§‚å¯Ÿä¾èµ–ä¾èµ–äºNSObjectçš„ä¸¤ä¸ªæ–¹æ³•willChangeValueForKey:å’ŒdidChangevalueForKey:ç»§è€Œä¹Ÿä¼šè°ƒç”¨çš„ä¸‹é¢çš„æ–¹æ³•observeValueForKeyPath - (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)contex } ä¾‹å¦‚ï¼ŒAç±»çš„å®ä¾‹çš„nameå±æ€§è¢«Bç±»çš„å®ä¾‹ç›‘å¬äº†ã€‚è¿™æ—¶ï¼ŒOCçš„runtimeæœºåˆ¶ç”Ÿæˆäº†ä¸€ä¸ªKVONotifying_Açš„ç±»æ¥æ›¿ä»£åŸæ¥çš„Aç±»ï¼Œé‡å†™äº†+ (Class)classæ–¹æ³•ï¼Œè¿”å›[A Class]ï¼Œä»è€ŒæŠŠè‡ªå·±ä¼ªè£…æˆAç±»ã€‚é‡å†™äº†Aç±»å±æ€§nameçš„setteræ–¹æ³•åŠ å…¥äº†NSObjectçš„ä¸¤ä¸ªæ–¹æ³•:willChangeValueForKey:(å€¼æ”¹å˜ä¹‹å‰)å’ŒdidChangevlueForKey:(å€¼æ”¹å˜ä¹‹å)ã€‚åœ¨ä¸€ä¸ªè¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKey:ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿™å°±ä¼šè®°å½•æ—§çš„å€¼ã€‚è€Œå½“æ”¹å˜å‘ç”Ÿåï¼ŒdidChangeValueForKey:ä¼šè¢«è°ƒç”¨ï¼Œç»§è€ŒobserveValueForKey:ofObject:change:context:ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ 2ã€KVOç‰¹ç‚¹ (ä»€ä¹ˆæƒ…å†µä¸‹èƒ½ä½¿KVOç”Ÿæ•ˆå‘¢ï¼Ÿ) ä½¿ç”¨setteræ–¹æ³•æ”¹å˜å€¼ï¼ŒKVOæ‰ä¼šç”Ÿæ•ˆã€‚ ä½¿ç”¨setValue: forKey: æ”¹å˜å€¼ï¼ŒKVOæ‰ä¼šç”Ÿæ•ˆã€‚ æˆå‘˜å˜é‡ç›´æ¥ä¿®æ”¹ï¼Œéœ€æ‰‹åŠ¨æ·»åŠ KVOæ‰ä¼šç”Ÿæ•ˆã€‚ 3ã€é€šè¿‡KVCè®¾ç½®valueèƒ½å¦ä¿ƒä½¿KVOç”Ÿæ•ˆï¼Ÿä¸ºä»€ä¹ˆç­”:å¯ä»¥ï¼ŒKVCä¼šé‡å†™setteræ–¹æ³•ã€‚setValue: forKey:ä¼šè°ƒç”¨å¯¹è±¡çš„setæ–¹æ³• 4ã€é€šè¿‡æˆå‘˜å˜é‡ç›´æ¥èµ‹å€¼valueèƒ½å¦ç”Ÿæ•ˆï¼Ÿä¸å¯ä»¥ã€‚å¯ä»¥åœ¨ç»™æˆå‘˜å˜é‡èµ‹å€¼å‰åæ‰‹åŠ¨æ·»åŠ  [self willChangeValueForKey: ] å’Œ [self didChangeValueForKey: ] ã€‚didChangeValueForKeyæ–¹æ³•ä¼šè§¦å‘KVOå›è°ƒã€‚ å¦‚ä½•å®ç°æ‰‹åŠ¨KVOï¼Ÿ - (void)setValue:(id)obj { [self willChangeValueForKey:@&quot;keyPath&quot;]; [super setValue:obj]; [self didChangeValueForKey:@&quot;keyPath&quot;]; } ä¸ƒã€KVCKVCæ˜¯key-value codingçš„ç¼©å†™ã€‚ //è·å–æŸä¸ªå®ä¾‹keyåŒåæˆ–è€…ç›¸ä¼¼åç§°çš„å®ä¾‹å˜é‡çš„å€¼ -(id)valueForKey:(NSString *)key //è®¾ç½®æŸä¸ªå®ä¾‹å’ŒkeyåŒåæˆ–è€…ç›¸ä¼¼åç§°çš„å®ä¾‹å˜é‡çš„å€¼ -(void)setValue:(id)value forKey:(NSString *)key é—®é¢˜: KVCæ˜¯å¦ä¼šç ´åé¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ï¼Ÿç­”: åœ¨æˆ‘ä»¬å¤–éƒ¨çŸ¥é“æŸä¸ªç±»çš„ç§æœ‰æˆå‘˜å˜é‡åæ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•è®¾ç½®/è®¿é—®ï¼Œä¼šç ´åé¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ 1ã€-(id)valueForKey:(NSString *)key ç³»ç»Ÿå®ç°æµç¨‹ å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿå…ˆåˆ¤æ–­æœ‰æ²¡æœ‰å¯¹åº”setter getteræ–¹æ³•ï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ¤æ–­æœ‰æ²¡æœ‰å¯¹åº”çš„å®ä¾‹å˜é‡ï¼Œå¦‚æœæœ‰åˆ™æ‰§è¡Œå®ä¾‹å˜é‡çš„èµ‹å€¼ï¼Œæ²¡æœ‰åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ Accessor Method (è®¿é—®å™¨æ–¹æ³•æ˜¯å¦å­˜åœ¨åˆ¤æ–­) Instance var (å®ä¾‹å˜é‡æ˜¯å¦å­˜åœ¨åˆ¤æ–­) _key _isKey key isKey é—®é¢˜: valueForKeyçš„å®ç°é€»è¾‘ï¼Ÿç­”: åˆ¤æ–­è®¿é—®å™¨æ–¹æ³•ï¼Œæ˜¯å¦å­˜åœ¨æˆ–ç›¸ä¼¼çš„æ–¹æ³•å( getKey key isKey )ï¼Œå­˜åœ¨åˆ™è¿”å›ï¼›ä¸å­˜åœ¨å†åˆ¤æ–­å®ä¾‹å˜é‡(_key _isKey key isKey)ï¼Œå­˜åœ¨æˆ–ç›¸ä¼¼åˆ™è¿”å›ï¼›ä¸å­˜åœ¨å°±è°ƒç”¨valueForUndefineKey:ç„¶åæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ 2ã€-(void)setValue:(id)value forKey:(NSString *)key ç³»ç»Ÿå®ç°æµç¨‹ é—®é¢˜:setValue:forKey:çš„å®ç°é€»è¾‘ï¼Ÿç­”: åˆ¤æ–­è®¿é—®å™¨æ–¹æ³•ï¼Œå­˜åœ¨æˆ–ç›¸ä¼¼åˆ™è¿”å›ï¼›ä¸å­˜åœ¨å†åˆ¤æ–­å®ä¾‹å˜é‡ï¼Œå­˜åœ¨æˆ–ç›¸ä¼¼åˆ™è¿”å›ï¼›ä¸å­˜åœ¨å°±è°ƒç”¨setValue:ForUndefineKey:ç„¶åæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ å…«ã€å±æ€§å…³é”®å­—1ã€è¯»å†™æƒé™ readonlyã€*readwrite(é»˜è®¤)2ã€åŸå­æ€§ atomic(é»˜è®¤)ã€nonatomicã€‚atomicåªèƒ½ä¿è¯èµ‹å€¼å’Œè·å–æ˜¯çº¿ç¨‹å®‰å…¨(æˆå‘˜å±æ€§)ï¼Œä¸èƒ½ä¿è¯æ“ä½œå’Œè®¿é—®çº¿ç¨‹å®‰å…¨ã€‚ä¾‹å¦‚NSArrayï¼Œå¯ä»¥ä¿è¯èµ‹å€¼å’Œè·å–å¯¹è±¡çº¿ç¨‹å®‰å…¨ï¼Œä¸èƒ½ä¿è¯åˆ é™¤å’Œæ·»åŠ å¯¹è±¡çº¿ç¨‹å®‰å…¨ã€‚ 3ã€å¼•ç”¨è®¡æ•°(1)ã€retain/strong ï¼ˆéƒ½ç”¨äºä¿®é¥°å¯¹è±¡ï¼Œretainåœ¨ MRCä¸­ä½¿ç”¨ï¼Œ stongåœ¨ARCä¸­ä½¿ç”¨ï¼‰ã€‚(2)ã€assign /unsafe_unretained (assign ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹/å¯¹è±¡ç±»å‹ï¼Œ unsafe_unretained ARCåŸºæœ¬ä¸ç”¨)assignç‰¹ç‚¹: ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚intã€BOOLç­‰ã€‚ ä¿®é¥°å¯¹è±¡ç±»å‹æ—¶ï¼Œä¸æ”¹å˜å…¶å¼•ç”¨è®¡æ•°ã€‚ ä¼šäº§ç”Ÿæ‚¬å‚æŒ‡é’ˆã€‚(3)ã€weakweakç‰¹ç‚¹ ä¸æ”¹å˜è¢«ä¿®é¥°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚ æ‰€æŒ‡å¯¹è±¡åœ¨è¢«é‡Šæ”¾ä¹‹åä¼šè‡ªåŠ¨ç½®ä¸ºnilã€‚ é—®é¢˜:é€šè¿‡atomicä¿®é¥°æ˜¯æ€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿç­”: é€šè¿‡atomicä¿®é¥°ä¸€ä¸ªæ•°ç»„ï¼Œå¯¹å…¶è¿›è¡Œèµ‹å€¼è·å–ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯å¯¹å…¶è¿›è¡Œå¢åŠ ã€åˆ é™¤æ˜¯æ— æ³•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ é—®é¢˜: assignå’Œweakæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç­”:ä»äºŒè€…çš„ç‰¹ç‚¹æ¥è¯´ï¼šassignçš„ç‰¹ç‚¹ å¯ä»¥ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡ ä¿®é¥°å¯¹è±¡ç±»å‹æ—¶ï¼Œä¸æ”¹å˜å¼•ç”¨è®¡æ•° é‡Šæ”¾æ—¶ä¾ç„¶æŒ‡å‘åŸå¯¹è±¡å†…å­˜åœ°å€ï¼Œç»§ç»­è®¿é—®ä¼šäº§ç”Ÿæ‚¬ç©ºæŒ‡é’ˆï¼ˆé‡æŒ‡é’ˆæ˜¯åªæ²¡æœ‰è¢«åˆå§‹åŒ–è¿‡çš„æŒ‡é’ˆ åŒºåˆ†ï¼‰ weakçš„ç‰¹ç‚¹ åªç”¨äºä¿®é¥°å¯¹è±¡ ä¸æ”¹å˜è¢«ä¿®é¥°å¯¹è±¡çš„å¼•ç”¨è®¡æ•° æ‰€æŒ‡å¯¹è±¡å†è¢«é‡Šæ”¾ä¹‹åä¼šè‡ªåŠ¨ç½®ä¸ºnil (4)ã€copyé—®é¢˜:æµ…æ‹·è´å’Œæ·±æ‹·è´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿç­”:æµ…æ‹·è´ï¼šå¯¹å†…å­˜åœ°å€çš„å¤åˆ¶ï¼Œè®©ç›®æ ‡å¯¹è±¡æŒ‡é’ˆå’Œæºå¯¹è±¡æŒ‡å‘åŒä¸€å—å†…å­˜ç©ºé—´æµ…æ‹·è´ç‰¹ç‚¹ :1.æµ…æ‹·è´ä¼šå¢åŠ è¢«æ‹·è´å¯¹è±¡çš„å¼•ç”¨è®¡æ•°2.æ²¡æœ‰å‘ç”Ÿæ–°çš„å†…å­˜åˆ†é…æ·±æ‹·è´ï¼šè®©ç›®æ ‡å¯¹è±¡æŒ‡é’ˆå’Œæºå¯¹è±¡æŒ‡é’ˆæŒ‡å‘ä¸¤ç‰‡å†…å®¹ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼ˆç‰¹ç‚¹:äº§ç”Ÿå†…å­˜åˆ†é…ï¼‰æ·±æ‹·è´ç‰¹ç‚¹:1.æ·±æ‹·è´ä¸ä¼šå¢åŠ è¢«æ‹·è´å¯¹è±¡çš„å¼•ç”¨è®¡æ•°2.æ·±æ‹·è´å‘ç”Ÿæ–°çš„å†…å­˜åˆ†é…,å‡ºç°ä¸¤å—å†…å­˜ æ·±æ‹·è´ã€æµ…æ‹·è´åŒºåˆ«? æ˜¯å¦å¼€è¾Ÿäº†æ–°çš„å†…å­˜ç©ºé—´ æ˜¯å¦å½±å“äº†å¼•ç”¨è®¡æ•° 2&gt; copyå¯¹å¯¹è±¡é€ äº†ä»€ä¹ˆå½±å“ï¼Ÿ è¡¨æ ¼æ€»ç»“ï¼š å¯å˜å¯¹è±¡çš„copyå’ŒmutableCopyéƒ½æ˜¯æ·±æ‹·è´ã€‚ ä¸å¯å˜å¯¹è±¡çš„copyæ˜¯æµ…æ‹·è´ï¼ŒmutableCopyæ˜¯æ·±æ‹·è´ã€‚ copyæ–¹æ³•è¿”å›çš„å¯¹è±¡éƒ½æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ 3&gt;ã€copyé¢è¯•é¢˜ @property(copy)NSMutableArray *array? ç­”: å¦‚æœèµ‹å€¼è¿‡æ¥çš„æ˜¯NSMutableArray, copyä¹‹åæ˜¯NSArray å¦‚æœèµ‹å€¼è¿‡æ¥çš„æ˜¯NSArray, copyä¹‹åæ˜¯NSArray OCè¯­è¨€ç‰¹æ€§é¢è¯•æ€»ç»“:1ã€MRCä¸‹å¦‚ä½•é‡å†™retainä¿®é¥°å˜é‡çš„setteræ–¹æ³•ï¼Ÿ @property(nonatomic,retain) id obj; - (void)setObj:(id)obj { //åˆ¤æ–­é˜²æ­¢å¼‚å¸¸å¤„ç† é˜²æ­¢å¦‚æœä¼ è¿›æ¥çš„æ˜¯éobjå¯¹è±¡ï¼Œå°±ä¼šreleaseæ‰éobjçš„å¯¹è±¡ if(_obj != obj) { [_obj release]; _obj = [obj retain]; } } 2ã€è¯·ç®€è¿°åˆ†ç±»å®ç°åŸç†ã€‚ç­”: åˆ†ç±»å®ç°åŸç†ç”±è¿è¡Œæ—¶æ¥å†³è®®çš„ ä¸åŒåˆ†ç±»ä¸­å«æœ‰åŒååˆ†ç±»æ–¹æ³•,è°æœ€ç»ˆç”Ÿæ•ˆå–å†³äºè°æœ€åå‚ä¸ç¼–è¯‘,æœ€åå‚ä¸ç¼–è¯‘çš„åˆ†ç±»ä¸­åŒåæ–¹æ³•ä¼šæœ€ç»ˆç”Ÿæ•ˆ. å¦‚æœåˆ†ç±»ä¸­çš„æ–¹æ³•å’Œå®¿ä¸»ç±»æ–¹æ³•åŒå,åˆ†ç±»æ–¹æ³•ä¼šè¦†ç›–å®¿ä¸»ç±»åŒåæ–¹æ³•. è¦†ç›–æŒ‡ç”±äºæ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­, ä¼˜å…ˆæŸ¥æ‰¾æ•°ç»„é å‰çš„å…ƒç´ ,å¦‚æœæ‰¾åˆ°åŒåæ–¹æ³•å°±è¿›è¡Œè°ƒç”¨,å®é™…å®¿ä¸»ç±»åŒåæ–¹æ³•ä»ç„¶å­˜åœ¨. 3ã€KVOçš„å®ç°åŸç†æ˜¯å’‹æ ·çš„ï¼Ÿç­”:1)KVOæ˜¯ç³»ç»Ÿå…³äºè§‚å¯Ÿè€…æ¨¡å¼çš„å®ç°2)KVOè¿ç”¨isaæ··å†™æŠ€æœ¯,ç³»ç»Ÿä¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ªè¢«è§‚å¯Ÿå¯¹è±¡çš„å­ç±»ï¼Œç„¶åä»¤è¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è¯¥å­ç±»ï¼Œåœ¨è¯¥å­ç±»ä¸­é‡å†™äº†setteræ–¹æ³•ã€‚è¿™æ ·ï¼Œå½“åŸå¯¹è±¡å±æ€§è¢«ä¿®æ”¹æ—¶ï¼ˆåŸºäºKVCçš„ä¿®æ”¹ï¼‰ï¼Œå°±ä¼šè°ƒç”¨setteræ–¹æ³•ï¼Œç„¶åé€šçŸ¥è§‚å¯Ÿè€…ã€‚ 4ã€èƒ½å¦ä¸ºåˆ†ç±»æ·»åŠ æˆå‘˜å˜é‡ï¼Ÿç­”: èƒ½, å¯ä»¥é€šè¿‡å…³è”å¯¹è±¡associated objectæ¥ä¸ºåˆ†ç±»æ·»åŠ æˆå‘˜å˜é‡]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[[iOSé¢è¯•]ç¬¬1ç«  UIè§†å›¾ç›¸å…³é¢è¯•é—®é¢˜]]></title>
    <url>%2F2020%2F05%2F23%2FiOS%E9%9D%A2%E8%AF%95-%E7%AC%AC1%E7%AB%A0-UI%E8%A7%86%E5%9B%BE%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡ä¸»è®²UIç›¸å…³é¢è¯•é—®é¢˜ï¼ŒåŒ…æ‹¬UITableViewç›¸å…³ã€äº‹ä»¶ä¼ é€’&amp;è§†å›¾ç›¸åº”ã€å›¾åƒæ˜¾ç¤ºåŸç†ã€å¡é¡¿&amp;æ‰å¸§ã€ç»˜åˆ¶åŸç†&amp;å¼‚æ­¥ç»˜åˆ¶ã€ç¦»å±æ¸²æŸ“ã€‚ ä¸€ã€UITableViewç›¸å…³1ã€é‡ç”¨æœºåˆ¶ ä¸ºä»€ä¹ˆè¦ç”¨é‡ç”¨æœºåˆ¶ï¼Ÿå½“UITableViewæ»šåŠ¨æ—¶ï¼Œå¦‚æœä¸ç”¨é‡ç”¨æœºåˆ¶ï¼Œä¼šé‡å¤åˆå§‹åŒ–åŸæ¥å·²ç»æœ‰åˆå§‹åŒ–è¿‡çš„cellï¼Œå› æ­¤ç”¨é‡ç”¨æœºåˆ¶ä¼šèŠ‚çœæ€§èƒ½ï¼Œé¿å…å‡ºç°å¡é¡¿ç°è±¡ é‡ç”¨æœºåˆ¶çš„åŸç†é‡ç”¨æœºåˆ¶ä¸»è¦ç”¨åˆ°äº†ä¸€ä¸ªå¯å˜æ•°ç»„visiableCellså’Œä¸€ä¸ªå¯å˜çš„å­—å…¸ç±»å‹reusableTableCells,å…¶ä¸­visiableCellsç”¨æ¥å­˜å‚¨å½“å‰UITableViewæ˜¾ç¤ºçš„cellï¼ŒreusableTableCellsç”¨æ¥å­˜å‚¨å·²ç»ç”¨â€™identifyâ€™ç¼“å­˜çš„cellã€‚å½“UITableViewæ»šåŠ¨çš„æ—¶å€™ï¼Œä¼šå…ˆåœ¨reusableTableCellsä¸­æ ¹æ®identifyæ‰¾æ˜¯å¦æœ‰æœ‰å·²ç»ç¼“å­˜çš„cellï¼Œå¦‚æœæœ‰ç›´æ¥ç”¨ï¼Œæ²¡æœ‰å†å»åˆå§‹åŒ–ã€‚ ä»£ç å®ä¾‹:è‡ªå®šä¹‰tableView å­—æ¯ç´¢å¼•æ¡ 2ã€æ•°æ®æºåŒæ­¥(1)ã€æ•°æ®æºåŒæ­¥é—®é¢˜ (2)ã€æ•°æ®æºåŒæ­¥è§£å†³æ–¹æ¡ˆ1&gt;ã€å¹¶å‘è®¿é—®ã€æ•°æ®æ‹·è´ å¹¶å‘å³å¤šä¸ªçº¿ç¨‹éƒ½å¯ä»¥æ‰§è¡ŒåŒä¸€æ®µæ—¶é—´ï¼Œä¸éœ€è¦ç›¸äº’ç­‰å¾…ï¼Œä¸»çº¿ç¨‹ä¸ç”¨æˆ·äº’åŠ¨ï¼Œå­çº¿ç¨‹åšæ‰€éœ€è¦çš„ç½‘ç»œæ•°æ®è¯·æ±‚ã€æ•°æ®è§£æåŠé¢„æ’ç‰ˆç­‰ ä¸»çº¿ç¨‹äº‹å…ˆæ‹·è´ä¸€ä»½æ•°æ®ç»™å­çº¿ç¨‹åšç½‘ç»œè¯·æ±‚ã€æ•°æ®è§£æã€é¢„æ’ç‰ˆç­‰ï¼Œå¦‚æœä¸»çº¿ç¨‹æœ‰ç›¸å…³æ“ä½œï¼Œè®°å½•æ“ä½œï¼Œåœ¨å­çº¿ç¨‹å®Œæˆç›¸å…³æ“ä½œåå°†è¿™æ¡æ“ä½œï¼Œä¸å­çº¿ç¨‹çš„æ•°æ®è¿›è¡ŒåŒæ­¥ï¼Œå†å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°ç•Œé¢ ç¼ºç‚¹ï¼šéœ€è¦æ‹·è´å¤§é‡æ•°æ®ï¼Œè€—å†…å­˜ 2&gt;ã€ä¸²è¡Œè®¿é—® åˆ›å»ºä¸€ä¸ªGCDä¸²è¡Œé˜Ÿåˆ—ï¼Œä¸»çº¿ç¨‹çš„æ“ä½œéœ€è¦ç­‰å¾…å­çº¿ç¨‹æ“ä½œå®Œæˆ ç¼ºç‚¹ï¼šéœ€è¦ç­‰å¾…å­çº¿ç¨‹å®Œæˆï¼Œå¯èƒ½ä¼šè€—æ—¶è¾ƒé•¿ 3&gt; æ¯”è¾ƒ:ä¸¤ç§æ–¹æ¡ˆå„æœ‰åˆ©å¼Šä¸²è¡Œè®¿é—®æ–¹å¼: è¦æ±‚åœ¨å­çº¿ç¨‹å¤„ç†ä»»åŠ¡ç‰¹åˆ«è€—æ—¶çš„æ—¶å€™,æˆ‘ä»¬æŸä¸€ä¸ªåˆ é™¤åŠ¨ä½œå¯èƒ½ä¼šæœ‰å»¶æ—¶.å¹¶å‘è®¿é—®,æ•°æ®æ‹·è´æ–¹å¼:è¦è®°å½•æ•°æ®åŒæ­¥æ“ä½œ,å¦‚ä¸Šè¾¹ä¾‹å­éœ€è¦è®°å½•åŒæ­¥åˆ é™¤çš„åŠ¨ä½œ,éœ€è¦è¿›è¡Œå¤§é‡çš„æ•°æ®æºæ‹·è´,å¯¹å†…å­˜çš„å¼€é”€æ˜¯æœ‰ä¸€å®šçš„é—®é¢˜.æ‰€ä»¥åœ¨å…·ä½“åœºæ™¯ä¸­,éœ€è¦æ ¹æ®å®é™…ä¸šåŠ¡å»é€‰æ‹©ä½¿ç”¨å“ªç§æ–¹æ¡ˆ. äºŒã€äº‹ä»¶ä¼ é€’&amp;è§†å›¾å“åº”1ã€UIViewå’ŒCALayerçš„å…³ç³»å’ŒåŒºåˆ« å…³ç³»ï¼šUIViewçš„å†…éƒ¨åŒ…å«CALayerå±‚ã€‚åˆ›å»ºUIViewæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªCALyerå±‚çš„å¯¹è±¡ï¼Œé€šè¿‡UIViewçš„layerå±æ€§å¯ä»¥è®¿é—®åˆ°ã€‚UIViewéœ€è¦æ˜¾ç¤ºæ—¶ï¼Œä¼šè°ƒç”¨drawRectæ–¹æ³•è¿›è¡Œç»˜åˆ¶ï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹ç»˜åˆ¶åœ¨è‡ªå·±çš„layerå±‚ã€‚ä¹Ÿå°±æ˜¯CALayerå±‚æ‰æœ‰æ˜¾ç¤ºåŠŸèƒ½ã€‚åŒºåˆ«ï¼šUIViewè´Ÿè´£æä¾›å†…å®¹ï¼Œä»¥åŠè´Ÿè´£å¤„ç†è§¦æ‘¸ç­‰äº‹ä»¶ï¼Œå‚ä¸å“åº”é“¾CALayerè´Ÿè´£æ˜¾ç¤ºå†…å®¹contentsè¿™ä½“ç°äº†ç³»ç»Ÿè®¾è®¡çš„åŸåˆ™:å…­å¤§èŒè´£åŸåˆ™ä¸­çš„ å•ä¸€åŸåˆ™, èŒè´£ä¸Šçš„åˆ†å·¥. 2ã€äº‹ä»¶ä¼ é€’ä¸è§†å›¾å“åº”é“¾ é—®é¢˜:ç‚¹å‡»c2ç©ºç™½åŒºåŸŸ,ç³»ç»Ÿæœ€ç»ˆæ˜¯ä»¥æ€æ ·æ–¹å¼æ‰¾åˆ°æœ€ç»ˆè§†å›¾å“åº”è§†å›¾æ˜¯c2å‘¢?(è€ƒå¯Ÿç³»ç»Ÿæœ‰å…³è§†å›¾) äº‹ä»¶çš„åˆ†å‘ä¸ä¼ é€’:1)å½“iOSç¨‹åºä¸­å‘ç”Ÿè§¦æ‘¸äº‹ä»¶ï¼Œç³»ç»Ÿä¼šå°†äº‹ä»¶åŠ å…¥åˆ°UIApplicationç®¡ç†çš„ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—2)UIApplicationå°†å¤„äºä»»åŠ¡é˜Ÿåˆ—æœ€å‰ç«¯çš„äº‹ä»¶å‘ä¸‹åˆ†å‘ã€‚å³UIWindow -&gt;UIView3)UIViewé¦–å…ˆçœ‹è‡ªå·±æ˜¯å¦èƒ½å¤„ç†äº‹ä»¶ï¼Œè§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è‡ªå·±èº«ä¸Šã€‚å¦‚æœèƒ½ï¼Œé‚£ä¹ˆç»§ç»­å¯»æ‰¾å­è§†å›¾ã€‚4)éå†å­æ§ä»¶ï¼Œé‡å¤ä»¥ä¸Šä¸¤æ­¥5)å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆè‡ªå·±å°±æ˜¯äº‹ä»¶å¤„ç†è€…6)å¦‚æœè‡ªå·±ä¸èƒ½å¤„ç†ï¼Œé‚£ä¹ˆä¸åšä»»ä½•å¤„ç† å…¶ä¸­ä¸æ¥å—å¤„ç†çš„äº‹ä»¶æƒ…å†µå¦‚ä¸‹ä¸‰ç§ï¼š alpha &lt;0.01 userInteractionEnabled = NO hidden ï¼ YES.å¦‚æœçˆ¶è§†å›¾ä¸æ¥å—äº‹ä»¶å¤„ç†ï¼Œåˆ™å­è§†å›¾ä¹Ÿä¸èƒ½æ¥æ”¶ã€‚äº‹ä»¶åªè¦è§¦æ‘¸å°±ä¼šäº§ç”Ÿï¼Œå…³é”®åœ¨äºæ˜¯å¦æœ‰åˆé€‚çš„Viewå¤„ç†æ¥æ”¶äº‹ä»¶ 1&gt; å¦‚ä½•å¯»æ‰¾æœ€åˆé€‚çš„Viewå‘¢ï¼Ÿä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³• //è¿”å›å“åº”äº‹ä»¶çš„è§†å›¾ - (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event; //åˆ¤æ–­ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨å½“å‰è§†å›¾èŒƒå›´å†…, åœ¨èŒƒå›´å†…è¿”å›YES - (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event; è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªæ–¹æ³•ç”¨äºæ‰¾å‡ºäº‹ä»¶çš„å“åº”è€…ï¼Œç¬¬äºŒä¸ªæ–¹æ³•ç”¨äºç¡®å®šäº‹ä»¶è§¦å‘çš„ä½ç½®ã€‚ äº‹ä»¶ä¼ é€’ç»™çª—å£æˆ–æ§ä»¶çš„åï¼Œå°±è°ƒç”¨hitTest:withEvent:æ–¹æ³•å¯»æ‰¾æ›´åˆé€‚çš„view,å¦‚æœå­æ§ä»¶æ˜¯åˆé€‚çš„viewï¼Œåˆ™åœ¨å­æ§ä»¶å†è°ƒç”¨hitTest:withEvent:ç›´åˆ°æ‰¾åˆ°æœ€åˆé€‚çš„ä¸ºæ­¢ã€‚ é€šè¿‡è¿™ä¸¤ä¸ªæ–¹æ³•æ¥åšäº‹ä»¶çš„ä¼ é€’å’Œå“åº”è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š 2&gt;äº‹ä»¶ä¼ é€’æµç¨‹ hitTest:withEvent:æ–¹æ³•å†…éƒ¨ä¼šè¿›è¡Œä¸€ä¸ªé€’å½’è°ƒç”¨ï¼Œå¯¹å“åº”è€…çš„æ‰€æœ‰subviewsè°ƒç”¨hittestï¼ŒhitTest:withEvent:ç³»ç»Ÿå®ç°å¦‚ä¸‹å›¾ï¼š 3&gt;ä»£ç å®æˆ˜:æ–¹å½¢æŒ‰é’®æŒ‡å®šåŒºåŸŸæ¥æ”¶äº‹ä»¶å“åº” 4&gt;è§†å›¾å“åº”æµç¨‹ å“åº”è€…é“¾çš„ä¼ é€’æ–¹æ³•æ˜¯äº‹ä»¶ä¼ é€’çš„åæ–¹æ³•ï¼Œå¦‚æœæ‰€æœ‰çš„å“åº”è€…éƒ½ä¸å¤„ç†ï¼Œåˆ™äº‹ä»¶è¢«ä¸¢å¼ƒ è§†å›¾äº‹ä»¶å“åº”ä¸‰ä¸ªæ–¹æ³•: - (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event; - (void)touchesMoved:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event; - (void)touchesEnded:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event; ä¸‰ã€å›¾åƒæ˜¾ç¤ºåŸç† CPU GPUé€šè¿‡æ€»çº¿è¿æ¥ é€šè¿‡CPUè¿›è¡Œç»˜å›¾ï¼Œå°†ä½å›¾ç»ç”±æ€»çº¿åœ¨åˆé€‚çš„æ—¶æœºç»™GPUï¼ŒGPUåšä½å›¾çš„æ¶‚å±‚æ¸²æŸ“å’Œçº¹ç†åˆæˆï¼Œå†æ”¾åˆ°å¸§ç¼“å†²åŒºåŸŸ(Frame Buffer)ä¸­ï¼Œ ç”±è§†é¢‘æ§åˆ¶å™¨æ ¹æ®VSyncåœ¨å¸§ç¼“å†²åŒºåŸŸä¸­æå–å±å¹•æ˜¾ç¤ºå†…å®¹ï¼Œæ˜¾ç¤ºåˆ°æ‰‹æœºå±å¹•ä¸­ å¯ä»¥çœ‹åˆ°ï¼ŒCPUå¤„ç†äº†UIå¸ƒå±€ï¼Œç»˜åˆ¶ï¼Œä»¥åŠå›¾ç‰‡ç¼–è§£ç ç­‰é¢„å¤„ç†å·¥ä½œï¼Œæœ€åå°†bitmapä½å›¾æäº¤ç»™GPUè¿›è¡Œå±å¹•æ¸²æŸ“ã€‚ 1ã€CPUå·¥ä½œLayout(UIå¸ƒå±€ã€æ–‡æœ¬è®¡ç®—)ï¼› Display(ç»˜åˆ¶ï¼ŒdrawRectæ–¹æ³•)ï¼›Prepare(å›¾ç‰‡ç¼–è§£ç )ï¼› Commit(æäº¤ä½å›¾)ã€‚2ã€GPUæ¸²æŸ“ç®¡çº¿(openGL)é¡¶ç‚¹ç€è‰²ã€å›¾å…ƒè£…é…ã€å…‰æ …åŒ–ã€ç‰‡æ®µç€è‰²ã€ç‰‡æ®µå¤„ç†ã€‚GPUæ¸²æŸ“ç®¡çº¿äº”æ­¥åšå®Œåå°±ä¼š,å°±ä¼šæŠŠæœ€ç»ˆåƒç´ ç‚¹æäº¤åˆ°å¯¹åº”çš„å¸§ç¼“å†²åŒºä¸­,ç„¶åç”±è§†é¢‘æ§åˆ¶å™¨åœ¨å¯¹åº”çš„VSyncä¿¡å·åˆ°æ¥ä¹‹å‰,å»å¸§ç¼“å†²åŒºä¸­æå–æœ€ç»ˆè¦æ˜¾ç¤ºçš„å±å¹•å†…å®¹ã€‚ å››ã€å¡é¡¿&amp;æ‰å¸§1ã€åŸå›  UIå¡é¡¿ã€æ‰å¸§çš„åŸå› :ä¿æŒæµç•…çš„UIäº¤äº’ï¼Œå±å¹•çš„åˆ·æ–°é¢‘ç‡åº”è¯¥ä¿æŒåœ¨60å¸§ï¼Œå³æ¯16.7mså°±ä¼šè¿›è¡Œä¸€æ¬¡å±å¹•åˆ·æ–°ï¼Œå¦‚æœæ­¤æ—¶ç³»ç»Ÿä¸­ç»˜åˆ¶æ¸²æŸ“å·¥ä½œè¿˜æ²¡æœ‰å®Œæˆï¼Œå¯¼è‡´VSyncä¿¡å·åˆ°æ¥ä¹‹å‰CPUå’ŒGPUæ— æ³•å®Œæˆä¸‹ä¸€å¸§ç”»é¢çš„åˆæˆï¼Œåˆ™ä¼šå°†æ˜¾ç¤ºæ‹–å»¶åˆ°ä¸‹ä¸€ä¸ªåˆ·æ–°ç‚¹ï¼Œè¿™æ ·å°±ä¼šé€ æˆæ‰å¸§ä»è€Œäº§ç”Ÿå¡é¡¿ 2ã€æ»‘åŠ¨ä¼˜åŒ–æ–¹æ¡ˆ(1)ã€CPUå¯¹è±¡åˆ›å»ºã€è°ƒæ•´ã€é”€æ¯ , æ”¾åˆ°å­çº¿ç¨‹ä¸­åšï¼›é¢„æ’ç‰ˆï¼ˆå¸ƒå±€è®¡ç®—ã€æ–‡æœ¬è®¡ç®—ï¼‰, æ”¾åˆ°å­çº¿ç¨‹ä¸­åšï¼›é¢„æ¸²æŸ“ï¼ˆæ–‡æœ¬ç­‰å¼‚æ­¥ç»˜åˆ¶ï¼Œå›¾ç‰‡ç¼–è§£ç ç­‰ï¼‰ã€‚(2)ã€GPUçº¹ç†æ¸²æŸ“ï¼ˆç¦»å±æ¸²æŸ“ï¼‰ï¼›è§†å›¾æ··åˆï¼ˆè§†å›¾å±‚çº§å¤æ‚åº¦ï¼ŒGPUéœ€è¦åšæ¯ä¸ªè§†å›¾çš„åˆæˆï¼‰ã€‚(åœ¨ç»˜åˆ¶æ—¶å‡å°‘å›¾å±‚å±‚çº§ï¼Œå°†å¤šä¸ªå±‚çº§ç»˜åˆ¶åˆ°ä¸€ä¸ªå±‚çº§ä¸‹ï¼Œä»¥å‡å°‘GPUåœ¨åšè§†å›¾æ··åˆæ—¶æ¶ˆè€—çš„æ—¶é—´) å¦‚ä½•å…·ä½“ä¼˜åŒ–å‘¢ï¼Ÿ å®˜æ–¹åœ¨iOS9.0åå¯¹UIImageViewè®¾ç½®åœ†è§’è¿›è¡Œä¼˜åŒ–ï¼Œä½†æ˜¯è®¾ç½®é˜´å½±ä¾ç„¶ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ åœ†è§’ä¼˜åŒ–1.ä½¿ç”¨è´å¡å°”æ›²çº¿UIBezierPathå’ŒCore Graphicsæ¡†æ¶ç”»å‡ºä¸€ä¸ªåœ†è§’2.ä½¿ç”¨CAShapeLayerå’ŒUIBezierPathè®¾ç½®åœ†è§’ shadowä¼˜åŒ–é€šè¿‡è®¾ç½®shadowPathæ¥ä¼˜åŒ–æ€§èƒ½ å…¶ä»–ä¼˜åŒ–æ–¹æ¡ˆï¼š å°½é‡ä½¿ç”¨ä¸åŒ…å«é€æ˜ï¼ˆalphaï¼‰é€šé“çš„å›¾ç‰‡èµ„æº å°½é‡è®¾ç½®layerçš„å¤§å°å€¼ä¸ºæ•´å½¢å€¼ ä½¿ç”¨ä¸€å¼ ä¸­é—´é€æ˜å›¾ç‰‡è’™ä¸Šå» å¦‚æœæ˜¯æœ¬åœ°å›¾:ç›´æ¥è®©ç¾å·¥æŠŠå›¾ç‰‡åˆ‡æˆåœ†è§’è¿›è¡Œæ˜¾ç¤º ä¸Šä¼ å›¾ç‰‡è¿›è¡Œæ˜¾ç¤ºï¼Œå¯ä»¥è®©æœåŠ¡ç«¯å¤„ç†åœ†è§’ åˆ©ç”¨UIBezierPathï¼ˆCoreGraphicsæ¡†æ¶ï¼‰ç”»å‡ºæ¥åœ†è§’å›¾ç‰‡ Core Animationå·¥å…·æ£€æµ‹ç¦»å±æ¸²æŸ“å¯¹äºç¦»å±æ¸²æŸ“çš„æ£€æµ‹ï¼Œè‹¹æœä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæµ‹è¯•å·¥å…·Core Animationã€‚å¯ä»¥åœ¨Xcode-&gt;Open Develeper Tools-&gt;Instrumentsä¸­æ‰¾åˆ° äº”ã€UIViewç»˜åˆ¶åŸç†&amp;å¼‚æ­¥ç»˜åˆ¶ CALayerä¼šåœ¨å½“å‰RunLoopç»“æŸå‰è°ƒç”¨è‡ªèº«çš„displayæ–¹æ³•è¿›è¡Œç»˜åˆ¶ï¼Œä¸‹å›¾æ˜¯ç³»ç»Ÿè°ƒç”¨CALayerçš„displayæ–¹æ³•ç»˜åˆ¶çš„æµç¨‹ï¼š ä¸€ã€ç³»ç»Ÿç»˜åˆ¶æµç¨‹ UIViewçš„drawRectæ–¹æ³•æ˜¯ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œä»–ç»™è°ƒç”¨è€…æä¾›äº†ä¸€ä¸ªåœ¨ç³»ç»Ÿç»˜åˆ¶çš„åŸºç¡€ä¸ŠäºŒæ¬¡æ“ä½œçš„ç©ºé—´ã€‚bitmapä½œä¸ºlayerçš„contentså±æ€§çš„å€¼ï¼Œåœ¨è¢«èµ‹å€¼åæäº¤ç»™GPUè¿›è¡Œæ¸²æŸ“ã€‚æˆ‘ä»¬å¯ä»¥åœ¨displayLayeræ–¹æ³•ä¸­è¿›è¡Œå¼‚æ­¥ç»˜åˆ¶ã€‚ äºŒã€å¼‚æ­¥ç»˜åˆ¶-[layer.delegate displayLayer:]ä»£ç†è´Ÿè´£ç”Ÿæˆå¯¹åº”çš„bitmapè®¾ç½®è¯¥bitmapä½œä¸ºlayer.contentså±æ€§çš„å€¼ å…­ã€ç¦»å±æ¸²æŸ“1ã€ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“ï¼Ÿ On-Screen Renderingæ„ä¸ºå½“å‰å±å¹•æ¸²æŸ“ï¼ŒæŒ‡çš„æ˜¯GPUçš„æ¸²æŸ“æ“ä½œæ˜¯åœ¨å½“å‰ç”¨äºæ˜¾ç¤ºçš„å±å¹•ç¼“å†²åŒºä¸­è¿›è¡Œ Off-Screen Renderingæ„ä¸ºç¦»å±æ¸²æŸ“ï¼ŒæŒ‡çš„æ˜¯GPUåœ¨å½“å‰å±å¹•ç¼“å†²åŒºä»¥å¤–æ–°å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œ é€šä¿—è®²: å½“è®¾ç½®æŸä¸€äº›UIè§†å›¾çš„å›¾å±‚å±æ€§æ—¶ï¼Œå¦‚æœæœªè¢«é¢„åˆæˆä¹‹å‰ä¸èƒ½ç”¨äºå½“å‰å±å¹•ç›´æ¥æ˜¾ç¤ºçš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼Œæ¯”å¦‚è®¾ç½®åœ†è§’å±æ€§ï¼Œä¸€äº›è§†å›¾é®ç½©ã€‚è€Œç¦»å±æ¸²æŸ“çš„æ¦‚å¿µèµ·æºäºGPUå±‚é¢ï¼ŒæŒ‡çš„æ˜¯GPUåœ¨å½“å‰å±å¹•ç¼“å†²åŒºä»¥å¤–æ–°å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œã€‚ å½“å±æ¸²æŸ“ï¼šæŒ‡çš„æ˜¯GPUçš„æ¸²æŸ“æ“ä½œæ˜¯åœ¨å½“å‰ç”¨äºæ˜¾ç¤ºçš„å±å¹•ç¼“å­˜åŒºä¸­è¿›è¡Œã€‚ 2ã€ä½•æ—¶ä¼šè§¦å‘ï¼Ÿ(1)ã€åœ†è§’ï¼ˆlayer.masksToBounds = YES å’Œlayer.cornerRadius åŒæ—¶ä½¿ç”¨)(2)ã€å›¾å±‚è’™ç‰ˆ (layer.mask)(3)ã€é˜´å½± (layer.shadow)(4)ã€å…‰æ …åŒ– ( layer.shouldRasterize=true)(5)ã€é€æ˜åº¦ (layer.allowsGroupOpacity = YES å’Œ layer.opacity &lt; 1.0) ç”±äºç¦»å±æ¸²æŸ“è¦åˆ›å»ºæ–°çš„æ¸²æŸ“ç¼“å†²åŒºï¼ŒåŒæ—¶è¿˜è¦è¿›è¡Œä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œè¿™ä¼šå¢åŠ GPUçš„å¤„ç†æ—¶é—´ï¼Œå¯èƒ½ä¼šé€ æˆæ‰å¸§ 3ã€ä¸ºä½•è¦é¿å…ç¦»å±æ¸²æŸ“ï¼Ÿ(1)ã€è§¦å‘ç¦»å±æ¸²æŸ“ï¼Œä¼šå¢åŠ GPUçš„å·¥ä½œé‡ï¼Œä¼šå¯¼è‡´CPUå’ŒGPUçš„å·¥ä½œæ€»è€—æ—¶è¶…è¿‡16.7æ¯«ç§’ï¼Œä¼šå¯¼è‡´UIçš„å¡é¡¿å’Œæ‰å¸§ã€‚(2)ã€åˆ›å»ºæ–°çš„æ¸²æŸ“ç¼“å†²åŒºï¼Œä¼šå†…å­˜å¼€é”€ã€‚(3)ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¼šå¯¼è‡´GPUé¢å¤–å¼€é”€ã€‚ UIè§†å›¾ç›¸å…³é¢è¯•é—®é¢˜æ€»ç»“ï¼š1ã€ç³»ç»Ÿçš„UIäº‹ä»¶ä¼ é€’æœºåˆ¶æ˜¯å’‹æ ·çš„ï¼Ÿè€ƒå¯ŸhitTest: å’ŒpointInside: ç³»ç»Ÿå†…éƒ¨å®ç°2ã€ä½¿UITableViewæ»šåŠ¨æ›´æµç•…çš„æ–¹æ¡ˆæˆ–æ€è·¯éƒ½æœ‰å“ªäº›ï¼Ÿ(å‚è€ƒæ»‘åŠ¨ä¼˜åŒ–æ–¹æ¡ˆ)ä»CPUå’ŒGPUä¸¤æ–¹é¢3ã€ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“ï¼Ÿ(å‚è€ƒæ¦‚å¿µ å’Œä¸ºä½•è¦é¿å…ç¦»å±æ¸²æŸ“)ç¦»å±æ¸²æŸ“çš„æ¦‚å¿µèµ·æºäºGPUå±‚é¢ï¼ŒæŒ‡çš„æ˜¯GPUåœ¨å½“å‰å±å¹•ç¼“å†²åŒºä»¥å¤–æ–°å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºè¿›è¡Œæ¸²æŸ“æ“ä½œã€‚ 4ã€UIViewå’ŒCALayerä¹‹é—´çš„å…³ç³»æ˜¯å’‹æ ·çš„ï¼Ÿ]]></content>
      <categories>
        <category>iOSç¬”è®°</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Carthageå®‰è£…å’Œä½¿ç”¨æ•™ç¨‹]]></title>
    <url>%2F2018%2F11%2F18%2FCarthage%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[Carthageç®€å•ä»‹ç» ä¸»é¡µ: https://github.com/Carthage/Carthage.git ä½œè€…: Justin Spahr-Summersç­‰ ç‰ˆæœ¬: 0.31 ç›®æ ‡: ç”¨æœ€ç®€å•çš„æ–¹å¼æ¥ç®¡ç†Cocoaç¬¬ä¸‰æ–¹æ¡†æ¶ æ€§è´¨: ç¬¬ä¸‰æ–¹æ¡†æ¶ç®¡ç†å·¥å…·(ç±»ä¼¼äºcocoapods) Carthageä¸ºç”¨æˆ·ç®¡ç†ç¬¬ä¸‰æ–¹æ¡†æ¶å’Œä¾èµ–ï¼Œä½†ä¸ä¼šè‡ªåŠ¨ä¿®æ”¹é¡¹ç›®æ–‡ä»¶å’Œç”Ÿæˆé…ç½®ï¼ŒæŠŠå¯¹é¡¹ç›®ç»“æ„å’Œè®¾ç½®çš„æ§åˆ¶æƒäº¤ç»™ç”¨æˆ·ã€‚ åŸç† è‡ªåŠ¨å°†ç¬¬ä¸‰æ–¹æ¡†æ¶ç¼–ç¨‹ä¸ºDynamic framework(åŠ¨æ€åº“) é™åˆ¶ ä»…æ”¯æŒiOS8+ã€‚å®ƒåªæ”¯æŒæ¡†æ¶ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ¥é’ˆå¯¹iOS8ä»¥å‰çš„ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œå¼€å‘ Carthageçš„å®‰è£…å’Œä½¿ç”¨ ç›´æ¥ä¸‹è½½Carthage.pkgå®‰è£…åŒ…ï¼Œå®‰è£…è¿è¡Œ Carthage.pkgä¸‹è½½ å¦‚æœä½¿ç”¨çš„XCodeä¸º7.0+ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•æ¥å®‰è£… 1 å®‰è£…homebrew $ /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; 2 å‡çº§brew $ brew update 3 ä½¿ç”¨brewæ¥å®‰è£… $ brew install Carthage 4 æŸ¥çœ‹ç‰ˆæœ¬ $ Carthage version Carthageçš„ä½¿ç”¨å…ˆè¿›å…¥åˆ°é¡¹ç›®æ‰€åœ¨æ–‡ä»¶å¤¹ $ cd é¡¹ç›®è·¯å¾„ åˆ›å»ºä¸€ä¸ªç©ºçš„Carthageæ–‡ä»¶$ touch Cartfile ç¼–è¾‘cartfileæ–‡ä»¶,ä¾‹å¦‚è¦å®‰è£…AFNæ¡†æ¶GitHubåº“å¯åœ¨cartfileæ–‡ä»¶æ·»åŠ ä»¥ä¸‹å†…å®¹,æŒ‡å®šGitHubçš„å…³é”®å­—: github &quot;AFNetworking/AFNetworking&quot; æˆ–è€…å¡«å†™å…¶ä»–gitæº,æŒ‡å®šgitå…³é”®è¯: git &quot;https://github.com/AFNetworking/AFNetworking.git&quot; ä¿å­˜å¹¶å…³é—­cartfileæ–‡ä»¶ï¼Œä½¿ç”¨cartfileå®‰è£…æ¡†æ¶$ Carthage update --platform iOS æ³¨: ä¸è¿½åŠ å‚æ•°ä¼šç¼–è¯‘å‡º iOSã€OSXã€tvoså¤šä¸ªframework æ³¨2: å¦‚æœå¤±è´¥çš„è¯ï¼Œå…ˆç”¨Xcodeæ‰“å¼€ä½ çš„é¡¹ç›®ï¼ŒProduct &gt; Scheme &gt; Manage Schemes åœ¨æ–°çª—å£ä¸­ï¼Œå‹¾é€‰ä¸Š Sharedï¼Œç‚¹å‡» Closeã€‚åœ¨ç»ˆç«¯å†æ¬¡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ æ‰“å¼€Carthage æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶ç›®å½•$ open Carthage æ‰§è¡Œå®‰è£…ä¾èµ–å‘½ä»¤åçš„æ–‡ä»¶å¤¹ç»“æ„ # æ‰§è¡Œæ–‡ä»¶å¤šå‡ºä¸‰ä¸ªæ–‡ä»¶ Cartfile # å­˜æ”¾éœ€è¦å®‰è£…çš„ä¾èµ–åˆ—è¡¨ Cartfile.resolved # è‡ªåŠ¨ç”Ÿæˆçš„ä¾èµ–å…³ç³»æ–‡ä»¶ï¼Œéœ€æäº¤åˆ°git # ç¡®ä¿æäº¤çš„é¡¹ç›®å¯ä»¥ä½¿ç”¨å®Œå…¨ç›¸åŒçš„é…ç½®ä¸æ–¹å¼è¿è¡Œå¯ç”¨, è·Ÿè¸ªé¡¹ç›®å½“å‰æ‰€ç”¨çš„ä¾èµ–ç‰ˆæœ¬å· Carthage # è‡ªåŠ¨ç”Ÿæˆçš„Carthageç›®å½• (ä¸éœ€è¦æäº¤åˆ° Git) # ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼šBuild Checkouts # Build å­˜æ”¾ç¼–è¯‘åçš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ iOS/Mac/tvOS/watchOSå¯¹åº”çš„framework # Checkouts å­˜æ”¾ä»gitæ‹‰å–çš„ä¾èµ–åº“æºæ–‡ä»¶ é…ç½®é¡¹ç›®æ‰“å¼€é¡¹ç›®ï¼Œç‚¹å‡»Target -&gt; Build Phases -&gt; Link Library with Librariesé€‰æ‹©Carthage/Buildç›®å½•ä¸­è¦å¯¼å…¥çš„framework æ·»åŠ ç¼–è¯‘çš„è„šæœ¬ï¼ˆè¯¥è„šæœ¬æ–‡ä»¶ä¿è¯åœ¨æäº¤å½’æ¡£æ—¶ä¼šå¯¹ç›¸å…³æ–‡ä»¶å’ŒdSYMsè¿›è¡Œå¤åˆ¶ï¼‰ (1)ç‚¹å‡»Build Phasesï¼Œç‚¹å‡»â€œ+â€ -&gt; New Run Script Phase (2)æ·»åŠ æ·»åŠ è„šæœ¬ /usr/local/bin/Carthage copy-frameworks (3)æ·»åŠ â€Input Filesâ€ $(SRCROOT)/Carthage/Build/iOS/AFNetworking.framework åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ #import &lt;AFNetworking/AFNetworking.h&gt; å…¶å®ƒï¼š å¸è½½Carthageï¼š$ brew uninstall Carthage æ›´æ–°ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼šæ›´æ–°å¤šä¸ªæ¡†æ¶ï¼šä¿®æ”¹Cartfileæ–‡ä»¶ï¼Œå¹¶é‡æ–°æ‰§è¡Œ $ carthage updateæ›´æ–°æŸä¸ªæ¡†æ¶ï¼š$ carthage update å…·ä½“çš„æ¡†æ¶åç§° carthage update # ä¿®æ”¹äº†Cartfileæ–‡ä»¶ï¼Œå¹¶é‡æ–°ç¼–è¯‘ carthage update Alamofire # ä»…æ›´æ–°Alamofireæ¡†æ¶ carthage update --platform ios # ä»…ç¼–è¯‘iOSå¹³å°çš„framework carthage bootstrap # ä»æœ¬åœ°åº“é‡æ–°ç¼–è¯‘ä¾èµ– Carthageä¼˜ç¼ºç‚¹Carthageçš„ä¼˜ç‚¹â€‹ 1ï¼‰ä½¿ç”¨äº†CocoaPodsçš„é¡¹ç›®æ˜¯é«˜åº¦é›†æˆçš„ï¼Œè€ŒCarthageæ›´çµæ´»å¼ºè°ƒå°½å¯èƒ½å°†ä»»åŠ¡å§”æ‰˜ç»™Xcodeå’ŒGitã€‚â€‹ CocoaPodsåœ¨ä½¿ç”¨ä¸­ä¼šè‡ªåŠ¨åˆ›å»ºå’Œæ›´æ–°workspaceã€ä¾èµ–å’ŒPodé¡¹ç›®å¹¶è¿›è¡Œæ•´åˆ;â€‹ Carthageåœ¨ä½¿ç”¨ä¸­ä¸éœ€è¦åˆ›å»ºå’Œé›†æˆç›¸åº”çš„workspaceå’Œproject,åªéœ€è¦ä¾èµ–æ‰“åŒ…å¥½çš„frameworkæ–‡ä»¶å³å¯ã€‚â€‹ æ€»ç»“ä¸€ä¸‹ï¼ŒCocoaPodsçš„æ–¹æ³•æ›´å®¹æ˜“ä½¿ç”¨ï¼Œè€ŒCarthageæ›´çµæ´»ä¸”å¯¹é¡¹ç›®æ²¡æœ‰ä¾µå…¥æ€§ã€‚â€‹ 2ï¼‰CocoaPodsç›¸å¯¹æ¥è¯´åŠŸèƒ½è¦æ¯”Carthageå¤šå¾ˆå¤šï¼Œå› æ­¤ä¹Ÿæ›´å¤æ‚,è€ŒCocoaPodsé…ç½®ç®€å•é¡¹ç›®å¹²å‡€ã€‚â€‹ 3ï¼‰CocoaPodsæœ‰ä¸€ä¸ªä¸­å¿ƒä»“åº“ï¼Œè€ŒCarthageæ˜¯å»ä¸­å¿ƒåŒ–çš„ï¼Œæ²¡æœ‰ä¸­å¿ƒæœåŠ¡å™¨ä¹Ÿå°±é¿å…äº†å¯èƒ½å› ä¸­å¿ƒèŠ‚ç‚¹é”™è¯¯è€Œå¸¦æ¥çš„å¤±è´¥ï¼Œå³Carthageæ¯æ¬¡é…ç½®å’Œæ›´æ–°ç¯å¢ƒï¼Œåªä¼šå»æ›´æ–°å…·ä½“çš„åº“ï¼Œæ—¶é—´æ›´å¿«ã€‚â€‹ 4) Carthage ç®¡ç†çš„ä¾èµ–åªéœ€ç¼–è¯‘ä¸€æ¬¡ï¼Œé¡¹ç›®å¹²å‡€ç¼–è¯‘æ—¶ï¼Œä¸ä¼šå†å»é‡æ–°ç¼–è¯‘ä¾èµ–ï¼ŒèŠ‚çœæ—¶é—´â€‹ 5) ä¸ CocoaPods æ— ç¼é›†æˆï¼Œä¸€ä¸ªé¡¹ç›®èƒ½åŒæ—¶æ‹¥æœ‰ CocoaPods å’Œ Carthage Carthageçš„ä¸è¶³ ä»…æ”¯æŒ iOS8 + å®ƒåªæ”¯æŒæ¡†æ¶ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ¥é’ˆå¯¹ iOS 8 ä»¥å‰çš„ç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œå¼€å‘ æ”¯æŒçš„ Carthage å®‰è£…çš„ç¬¬ä¸‰æ–¹æ¡†æ¶å’Œä¾èµ–ä¸å¦‚ CocoaPods ä¸°å¯Œ æ— æ³•åœ¨ Xcode é‡Œå®šä½åˆ°ç¬¬ä¸‰æ–¹åº“æºç  Carthageçš„å·¥ä½œè¿‡ç¨‹è¯´æ˜â‘  åˆ›å»ºä¸€ä¸ªCartfileæ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶ä¸­åˆ—å‡ºæ‚¨æƒ³ä½¿ç”¨çš„æ¡†æ¶ â‘¡ è¿è¡ŒCarthage,è·å–å¹¶ç¼–è¯‘Cartfileæ–‡ä»¶ä¸­åˆ—å‡ºçš„æ¡†æ¶ â‘¢ æŠŠæ¡†æ¶çš„äºŒè¿›åˆ¶æ–‡ä»¶é…ç½®åˆ°é¡¹ç›®ä¸­ å…³äºç‰ˆæœ¬æŒ‡å®šCarthage æ”¯æŒä»¥ä¸‹å‡ ç§ç‰ˆæœ¬æŒ‡å®šæ–¹æ³•: = 1.0 ä»£è¡¨ â€œæœ€ä½ 1.0ç‰ˆæœ¬â€~&gt; 1.0 ä»£è¡¨ â€œè¡¨ç¤ºä½¿ç”¨ç‰ˆæœ¬1.0ä»¥ä¸Šä½†æ˜¯ä½äº2.0çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚1.5, 1.9â€== 1.0 ä»£è¡¨ â€œå¿…é¡»æ˜¯ 1.0 ç‰ˆæœ¬â€ â€œsome-branch-or-tag-or-commitâ€æŒ‡å®šä¸€ä¸ª Git å¯¹è±¡ (ä»»ä½•è¢« git rev-parse å…è®¸çš„)å¦‚æœæ²¡æœ‰ç‰ˆæœ¬è¦æ±‚,ä»»ä½•ç‰ˆæœ¬çš„ä¾èµ–æ˜¯å…è®¸çš„ã€‚ ç‰ˆæœ¬å¥½çš„å…¼å®¹æ€§æ˜¯æ ¹æ®è¯­è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶å†³å®šçš„ã€‚è¿™æ„å‘³ç€ä»»ä½•å¤§äºæˆ–ç­‰äº1.5.1ç‰ˆæœ¬,ä½†å°äº2.0,å°†è®¤ä¸ºä¸1.5.1â€œå…¼å®¹â€ã€‚ Cartfileç¤ºä¾‹ # Require version 2.3.1 or later æœ€ä½2.3.1ç‰ˆæœ¬ github &quot;ReactiveCocoa/ReactiveCocoa&quot; &gt;= 2.3.1 # Require version 1.x å¿…é¡»1.xç‰ˆæœ¬ github &quot;Mantle/Mantle&quot; ~&gt; 1.0 # (å¤§äºæˆ–ç­‰äº 1.0 ï¼Œå°äº 2.0) # Require exactly version 0.4.1 å¿…é¡»0.4.1ç‰ˆæœ¬ github &quot;jspahrsummers/libextobjc&quot; == 0.4.1 # Use the latest version ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ github &quot;jspahrsummers/xcconfigs&quot; # Use the branch ä½¿ç”¨gitåˆ†æ”¯ github &quot;jspahrsummers/xcconfigs&quot; &quot;branch&quot; # Use a project from GitHub Enterprise ä½¿ç”¨ä¸€ä¸ªä¼ä¸šé¡¹ç›®ï¼Œåœ¨ &quot;development&quot; åˆ†æ”¯ github &quot;https://enterprise.local/ghe/desktop/git-error-translations&quot; # Use a project from any arbitrary server, on the &quot;development&quot; branch ä½¿ç”¨ä¸€ä¸ªç§æœ‰é¡¹ç›®ï¼Œåœ¨ &quot;development&quot; åˆ†æ”¯ git &quot;https://enterprise.local/desktop/git-error-translations2.git&quot; &quot;development&quot; # Use a local project ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°çš„é¡¹ç›® git &quot;file:///directory/to/project&quot; &quot;branch&quot; Git ä¸­å¿½ç•¥ä¸éœ€è¦æäº¤åˆ°ç‰ˆæœ¬åº“çš„æ–‡ä»¶ä¸æ–‡ä»¶å¤¹ä¿®æ”¹ .gitignore æ–‡ä»¶ï¼Œå¢åŠ å¿½ç•¥ Carthage æ–‡ä»¶å¤¹å°±è¡Œäº†ï¼š #Carthage Carthage Carthageçš„å…¶ä»–å‘½ä»¤ archive Archives built frameworks into a zip that Carthage can use bootstrap Check out and build the project&#39;s dependencies build Build the project&#39;s dependencies checkout Check out the project&#39;s dependencies copy-frameworks In a Run Script build phase, copies each framework specified by a SCRIPT_INPUT_FILE environment variable into the built app bundle fetch Clones or fetches a Git repository ahead of time help Display general or command-specific help outdated Check for compatible updates to the project&#39;s dependencies update Update and rebuild the project&#39;s dependencies version Display the current version of Carthage]]></content>
      <categories>
        <category>Tool</category>
      </categories>
      <tags>
        <tag>iOSTool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GCDä¹‹dispatch_semaphore]]></title>
    <url>%2F2018%2F11%2F17%2FGCD%E4%B9%8Bdispatch-semaphore%2F</url>
    <content type="text"><![CDATA[dispatch_semaphoreå®šä¹‰1&gt; ä¿¡å·é‡ï¼šå°±æ˜¯ä¸€ç§å¯ç”¨æ¥æ§åˆ¶è®¿é—®èµ„æºçš„æ•°é‡çš„æ ‡è¯†ï¼Œè®¾å®šäº†ä¸€ä¸ªä¿¡å·é‡ï¼Œåœ¨çº¿ç¨‹è®¿é—®ä¹‹å‰ï¼ŒåŠ ä¸Šä¿¡å·é‡çš„å¤„ç†ï¼Œåˆ™å¯å‘ŠçŸ¥ç³»ç»ŸæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„ä¿¡å·é‡æ•°é‡æ¥æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ã€‚ å…¶å®ï¼Œè¿™æœ‰ç‚¹ç±»ä¼¼é”æœºåˆ¶äº†ï¼Œåªä¸è¿‡ä¿¡å·é‡éƒ½æ˜¯ç³»ç»Ÿå¸®åŠ©æˆ‘ä»¬å¤„ç†äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ‰§è¡Œçº¿ç¨‹ä¹‹å‰ï¼Œè®¾å®šä¸€ä¸ªä¿¡å·é‡å€¼ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨æ—¶ï¼ŒåŠ ä¸Šä¿¡å·é‡å¤„ç†æ–¹æ³•å°±è¡Œäº†ã€‚ 2&gt; ä¿¡å·é‡ä¸»è¦æœ‰3ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š // åˆ›å»ºä¿¡å·é‡.è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªlongç±»å‹çš„å‚æ•°, è¿”å›ä¸€ä¸ªdispatch_semaphore_tç±»å‹çš„ä¿¡å·é‡ï¼Œå€¼ä¸ºä¼ å…¥çš„å‚æ•° dispatch_semaphore_t dispatch_semaphore_create(long value) //ç­‰å¾…é™ä½ä¿¡å·é‡. æ¥æ”¶ä¸€ä¸ªä¿¡å·å’Œæ—¶é—´å€¼ï¼Œè‹¥ä¿¡å·çš„ä¿¡å·é‡ä¸º0ï¼Œåˆ™ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°ä¿¡å·é‡å¤§äº0æˆ–è€…ç»è¿‡è¾“å…¥çš„æ—¶é—´å€¼ï¼›è‹¥ä¿¡å·é‡å¤§äº0ï¼Œåˆ™ä¼šä½¿ä¿¡å·é‡å‡1å¹¶è¿”å›ï¼Œç¨‹åºç»§ç»­ä½ä¸‹æ‰§è¡Œ long dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout) // æé«˜ä¿¡å·é‡. ä½¿ä¿¡å·é‡åŠ 1å¹¶è¿”å› long dispatch_semaphore_signal(dispatch_semaphore_t dsema) //dispatch_semaphore_wait() ä¸ dispatch_semaphore_signal() æˆå¯¹ä½¿ç”¨ dispatch_semaphore ç®€å•ä½¿ç”¨- (void)dispatchSignal{ //crateçš„valueè¡¨ç¤ºï¼Œæœ€å¤šå‡ ä¸ªèµ„æºå¯è®¿é—® dispatch_semaphore_t semaphore = dispatch_semaphore_create(2); dispatch_queue_t quene = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //ä»»åŠ¡1 dispatch_async(quene, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;run task 1&quot;); sleep(1); NSLog(@&quot;complete task 1&quot;); dispatch_semaphore_signal(semaphore); });&lt;br&gt; //ä»»åŠ¡2 dispatch_async(quene, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;run task 2&quot;); sleep(1); NSLog(@&quot;complete task 2&quot;); dispatch_semaphore_signal(semaphore); });&lt;br&gt; //ä»»åŠ¡3 dispatch_async(quene, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;run task 3&quot;); sleep(1); NSLog(@&quot;complete task 3&quot;); dispatch_semaphore_signal(semaphore); }); } æ‰§è¡Œç»“æœï¼š æ€»ç»“ï¼šç”±äºè®¾å®šçš„ä¿¡å·å€¼ä¸º2ï¼Œå…ˆæ‰§è¡Œä¸¤ä¸ªçº¿ç¨‹ï¼Œç­‰æ‰§è¡Œå®Œä¸€ä¸ªï¼Œæ‰ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œä¿è¯åŒä¸€æ—¶é—´æ‰§è¡Œçš„çº¿ç¨‹æ•°ä¸è¶…è¿‡2ã€‚ è¿™é‡Œæˆ‘ä»¬æ‰©å±•ä¸€ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬è®¾å®šä¿¡å·å€¼=1 dispatch_semaphore_create(1) é‚£ä¹ˆç»“æœå°±æ˜¯ï¼š å¦‚æœè®¾å®šä¿¡å·å€¼=3 dispatch_semaphore_create(3) é‚£ä¹ˆç»“æœå°±æ˜¯ï¼š å…¶å®è®¾å®šä¸º3ï¼Œå°±æ˜¯ä¸é™åˆ¶çº¿ç¨‹æ‰§è¡Œäº†ï¼Œå› ä¸ºä¸€å…±æ‰åªæœ‰3ä¸ªçº¿ç¨‹ã€‚ dispatch_semaphore ä½œç”¨ dispatch_semaphoreæœ‰ä¸¤ä¸ªä¸»è¦åº”ç”¨ ï¼š ä¿æŒçº¿ç¨‹åŒæ­¥ ä¸ºçº¿ç¨‹åŠ é” dispatch_semaphore ä¿æŒçº¿ç¨‹åŒæ­¥- (void)syncThread{ dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_semaphore_t semaphore = dispatch_semaphore_create(0); __block int j = 0; dispatch_async(queue, ^{ j = 100; dispatch_semaphore_signal(semaphore); }); dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;finish j = %d&quot;, j); } ç»“æœè¾“å‡º j ï¼ 100ï¼›å¦‚æœæ³¨æ‰dispatch_semaphore_waitè¿™ä¸€è¡Œï¼Œåˆ™ j ï¼ 0ï¼›åŸç†ï¼š ç”±äºæ˜¯å°†blockå¼‚æ­¥æ·»åŠ åˆ°ä¸€ä¸ªå¹¶è¡Œé˜Ÿåˆ—é‡Œé¢ï¼Œæ‰€ä»¥ç¨‹åºåœ¨ä¸»çº¿ç¨‹è·ƒè¿‡blockç›´æ¥åˆ°dispatch_semaphore_waitè¿™ä¸€è¡Œï¼Œå› ä¸ºsemaphoreä¿¡å·é‡ä¸º0ï¼Œæ—¶é—´å€¼ä¸ºDISPATCH_TIME_FOREVERï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°blockåœ¨å­çº¿ç¨‹æ‰§è¡Œåˆ°dispatch_semaphore_signalï¼Œä½¿ä¿¡å·é‡+1ï¼Œæ­¤æ—¶semaphoreä¿¡å·é‡ä¸º1äº†ï¼Œæ‰€ä»¥ç¨‹åºç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚è¿™å°±ä¿è¯äº†çº¿ç¨‹é—´åŒæ­¥äº†ã€‚ dispatch_semaphore çº¿ç¨‹åŠ é”- (void)lockThread{ dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_semaphore_t semaphore = dispatch_semaphore_create(1); for (int i = 0; i &lt; 100; i++) { dispatch_async(queue, ^{ // ç›¸å½“äºåŠ é” dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@&quot;i = %d semaphore = %@&quot;, i, semaphore); // ç›¸å½“äºè§£é” dispatch_semaphore_signal(semaphore); }); } } åŸç†ï¼šå½“çº¿ç¨‹1æ‰§è¡Œåˆ°dispatch_semaphore_waitè¿™ä¸€è¡Œæ—¶ï¼Œsemaphoreçš„ä¿¡å·é‡ä¸º1ï¼Œæ‰€ä»¥ä½¿ä¿¡å·é‡-1å˜ä¸º0ï¼Œå¹¶ä¸”çº¿ç¨‹1ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼›å¦‚æœå½“åœ¨çº¿ç¨‹1NSLogè¿™ä¸€è¡Œä»£ç è¿˜æ²¡æ‰§è¡Œå®Œçš„æ—¶å€™ï¼Œåˆæœ‰çº¿ç¨‹2æ¥è®¿é—®ï¼Œæ‰§è¡Œdispatch_semaphore_waitæ—¶ç”±äºæ­¤æ—¶ä¿¡å·é‡ä¸º0ï¼Œä¸”æ—¶é—´ä¸ºDISPATCH_TIME_FOREVER,æ‰€ä»¥ä¼šä¸€ç›´é˜»å¡çº¿ç¨‹2ï¼ˆæ­¤æ—¶çº¿ç¨‹2å¤„äºç­‰å¾…çŠ¶æ€ï¼‰ï¼Œç›´åˆ°çº¿ç¨‹1æ‰§è¡Œå®ŒNSLogå¹¶æ‰§è¡Œå®Œdispatch_semaphore_signalä½¿ä¿¡å·é‡ä¸º1åï¼Œçº¿ç¨‹2æ‰èƒ½è§£é™¤é˜»å¡ç»§ç»­ä½ä¸‹æ‰§è¡Œã€‚ä»¥ä¸Šå¯ä»¥ä¿è¯åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒNSLogè¿™ä¸€è¡Œä»£ç ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSæŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[AppExtensionç¼–ç¨‹æŒ‡å—:æ‰©å±•åŸºç¡€]]></title>
    <url>%2F2018%2F11%2F17%2FAppExtension%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97-%E6%89%A9%E5%B1%95%E5%9F%BA%E7%A1%80%2F</url>
    <content type="text"><![CDATA[é€šè¿‡åº”ç”¨æ‰©å±•æå‡ä½ çš„åº”ç”¨iOS8/OS X v10.10 ç¿»è¯‘è‡ªè‹¹æœå®˜æ–¹æ–‡æ¡£ App Extension Programming Guideâ€“App Extensions Essentials é‡è¦æç¤ºï¼š è¯¥æ–‡æ¡£æ˜¯ä¸€ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨APIæˆ–æŠ€æœ¯çš„é¢„å‘å¸ƒæ–‡æ¡£ã€‚Appleæä¾›è¯¥æ–‡æ¡£çš„ç›®çš„åœ¨äºè®©å¼€å‘è€…å°½å¿«ç†Ÿæ‚‰æ–°æŠ€æœ¯å’Œæ–°çš„ç¼–ç¨‹æ¥å£ï¼Œä½¿å¾—å¼€å‘è€…é’ˆå¯¹è‹¹æœå“ç‰Œè®¾å¤‡è¿›è¡Œå¼€å‘ã€‚ä½†æ˜¯è¯¥æ–‡æ¡£ä¼šä¸æ–­çš„æ›´æ–°ï¼Œä½¿ç”¨è¯¥æ–‡æ¡£æä¾›çš„æŠ€æœ¯å¼€å‘çš„è½¯ä»¶åº”è¯¥åŸºäºæœ€ç»ˆæ“ä½œç³»ç»Ÿè½¯ä»¶å’Œæœ€ç»ˆçš„æ–‡æ¡£è¿›è¡Œæµ‹è¯•ã€‚è¦æ—¶åˆ»å…³æ³¨è¯¥æ–‡æ¡£çš„æ›´æ–°ï¼Œä»¥ä¾¿äº†è§£æ–°çš„APIå’ŒæŠ€æœ¯ç‰¹æ€§ã€‚ å½“iOS 8.0å’ŒOS X v10.10å‘å¸ƒåï¼Œä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µå‡ºç°åœ¨æˆ‘ä»¬çœ¼å‰ï¼Œé‚£å°±æ˜¯åº”ç”¨æ‰©å±•ã€‚é¡¾åæ€ä¹‰ï¼Œåº”ç”¨æ‰©å±•å…è®¸å¼€å‘è€…æ‰©å±•åº”ç”¨çš„è‡ªå®šä¹‰åŠŸèƒ½å’Œå†…å®¹ï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·åœ¨ä½¿ç”¨å…¶ä»–appæ—¶ä½¿ç”¨è¯¥é¡¹åŠŸèƒ½ã€‚ä½ å¯ä»¥å¼€å‘ä¸€ä¸ªåº”ç”¨æ‰©å±•æ¥æ‰§è¡ŒæŸäº›ç‰¹å®šçš„ä»»åŠ¡ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥æ‰©å±•åå°±å¯ä»¥åœ¨å¤šä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œè¯¥ä»»åŠ¡ã€‚æ¯”å¦‚è¯´ï¼Œä½ æä¾›äº†ä¸€ä¸ªèƒ½è®©ç”¨æˆ·æŠŠå†…å®¹åˆ†äº«åˆ°ç¤¾äº¤ç½‘ç«™çš„æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥åœ¨é˜…è¯»é‚®ä»¶ä¿¡æ¯æˆ–è€…ä¸Šç½‘æ—¶é€šè¿‡appæ‰©å±•æ¥å‘è¡¨è¯„è®ºã€‚æˆ–è€…è¯´ï¼Œå¦‚æœä½ æä¾›äº†ä¸€ä¸ªèƒ½å±•ç¤ºå½“å‰æ¯”èµ›åˆ†æ•°çš„æ‰©å±•ï¼Œé‚£ä¹ˆç”¨æˆ·å¯ä»¥æŠŠå®ƒæ”¾åœ¨é€šçŸ¥ä¸­å¿ƒï¼Œè¿™æ ·åœ¨ä»–ä»¬æ‰“å¼€Today viewæ—¶å°±èƒ½çœ‹åˆ°æœ€æ–°çš„æ¯”åˆ†ã€‚ä½ ç”šè‡³å¯ä»¥å¼€å‘ä¸€ä¸ªæä¾›è‡ªå®šä¹‰é”®ç›˜çš„æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥ç”¨å®ƒä»£æ›¿iOSç³»ç»Ÿè‡ªå¸¦çš„é”®ç›˜ã€‚ APPæ‰©å±•çš„ç±»å‹iOSå’ŒOS Xå®šä¹‰äº†å‡ ç§åº”ç”¨æ‰©å±•çš„ç±»å‹ï¼Œæ¯ä¸€ç§ç±»å‹çš„æ‰©å±•éƒ½å¯¹åº”ç³»ç»Ÿä¸­çš„ä¸€å—åŒºåŸŸï¼Œæ¯”å¦‚åˆ†äº«ã€é€šçŸ¥ä¸­å¿ƒä»¥åŠé”®ç›˜ç­‰ã€‚æˆ‘ä»¬æŠŠè¿™äº›æ”¯æŒæ‰©å±•çš„åŒºåŸŸç§°ä¸ºæ‰©å±•ç‚¹ã€‚æ¯ä¸ªæ‰©å±•ç‚¹éƒ½å®šä¹‰äº†ä½¿ç”¨ç­–ç•¥å¹¶æä¾›äº†APIï¼Œä½ å¯ä»¥ç”¨æ¥é’ˆå¯¹è¯¥åŒºåŸŸåˆ›å»ºæ‰©å±•ã€‚è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå½“ä½ é’ˆæŸä¸ªæ‰©å±•ç‚¹å¼€å‘åº”ç”¨æ‰©å±•æ—¶ï¼Œè¯¥åº”ç”¨æ‰©å±•çš„åŠŸèƒ½å¿…é¡»è¦ç¬¦åˆè¯¥æ‰©å±•ç‚¹çš„åŠŸèƒ½ç‰¹æ€§ã€‚ table 1-1 åˆ—å‡ºäº†iOSå’ŒOS Xä¸­çš„æ‰©å±•ç‚¹ï¼Œå¹¶åˆ—ä¸¾äº†å¯¹åº”æ‰©å±•ç‚¹çš„ç¤ºä¾‹ä»»åŠ¡ã€‚ ç”±äºç³»ç»Ÿå®šä¹‰äº†æ‰©å±•ç‰¹å®šé¢†åŸŸï¼Œæ‰€ä»¥å½“ä½ åœ¨å¼€å‘åº”ç”¨æ‰©å±•æ—¶ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œä½ è¦é€‰æ‹©æœ€èƒ½åŒ¹é…ä½ æƒ³åœ¨appä¸­æä¾›çš„åŠŸèƒ½çš„åŒºåŸŸã€‚æ¯”å¦‚è¯´ä½ è¦å¼€å‘ä¸€ä¸ªåˆ†äº«ä¿¡æ¯çš„åº”ç”¨æ‰©å±•ï¼Œé‚£ä¹ˆä½ åªèƒ½é€‰æ‹©åˆ†äº«æ‰©å±•ç‚¹ï¼Œè€Œä¸èƒ½ä½¿ç”¨Todayæˆ–Actionæ‰©å±•ç‚¹ã€‚ é‡è¦æç¤ºï¼šä½ å¼€å‘çš„appæ‰©å±•è¦ç²¾ç¡®åœ°åŒ¹é…Table 1-1ä¸­åˆ—å‡ºçš„æ‰©å±•ç‚¹ã€‚ä½ ä¸èƒ½å¼€å‘ä¸€ä¸ªé€šç”¨çš„æ‰©å±•æ¥åŒ¹é…ä¸€ä¸ªä»¥ä¸Šçš„æ‰©å±•ç‚¹ï¼Œ Xcodeå’ŒApp Storeå¸®åŠ©ä½ åˆ›å»ºå¹¶äº¤ä»˜åº”ç”¨æ‰©å±•åº”ç”¨æ‰©å±•ä¸åŒäºåº”ç”¨ï¼Œè™½ç„¶ä½ éœ€è¦åŸºäºåº”ç”¨å»å¼€å‘åº”ç”¨æ‰©å±•ï¼Œä½†æ˜¯æ¯ä¸ªåº”ç”¨æ‰©å±•éƒ½æ˜¯ç‹¬ç«‹äºåº”ç”¨è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å½“ä½ è¦åˆ›å»ºä¸€ä¸ªåº”ç”¨æ‰©å±•æ—¶ï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„Targetã€‚å’Œå…¶ä»– Target ä¸€æ ·ï¼Œæ‰©å±• Target å°†è®¾ç½®ä¿¡æ¯å’Œç›¸å…³æ–‡ä»¶æ‰“åŒ…åœ¨Productsæ–‡ä»¶ä¸‹ç”Ÿæˆä¸€ä¸ªæ‰©å±•åä¸º.appexçš„åŒ…ã€‚ä½ å¯ä»¥åœ¨åº”ç”¨é¡¹ç›®ä¸­åˆ›å»ºå¤šä¸ªæ‰©å±•Targetï¼ˆä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç”¨æ‰©å±•ï¼Œè¯¥åº”ç”¨ç¨‹åºç§°ä¸ºä¸»ä½“åº”ç”¨ç¨‹åºï¼‰ã€‚ å¼€å‘ä¸€ä¸ªåº”ç”¨æ‰©å±•æœ€å¥½çš„åˆ‡å…¥ç‚¹æ˜¯ä½¿ç”¨ Xcode åœ¨ä¸¤ä¸ªå¹³å°ä¸Šä¸ºæ¯ä¸ªæ‰©å±•ç‚¹æä¾›çš„æ¨¡æ¿å»å¼€å‘ã€‚æ¯ä¸ªæ¨¡æ¿åŒ…å«æ‰©å±•ç‚¹çš„å…·ä½“å®ç°æ–‡ä»¶å’Œç›¸å…³è®¾ç½®ï¼Œå¹¶ç”Ÿæˆç‹¬ç«‹çš„äºŒè¿›åˆ¶æ–‡ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„åŒ…ä¸­ã€‚ æ³¨æ„ï¼šåœ¨iOSä¸­ï¼ŒåŒ…å«æ‰©å±•çš„åº”ç”¨å¿…é¡»æä¾›ä¸€ä¸ªæ‰©å±•ä¹‹å¤–çš„åŠŸèƒ½ã€‚è€Œåœ¨OS Xä¸­æ²¡æœ‰è¿™ä¸ªç¡¬æ€§è¦æ±‚ï¼Œä¸€ä¸ªåŒ…å«æ‰©å±•çš„åº”ç”¨ä¸è¦æ±‚å¿…é¡»æä¾›ä¸€ä¸ªé¢å¤–åŠŸèƒ½ã€‚ ä¸ºäº†å°†æ‰©å±•åˆ†å‘ç»™ä½¿ç”¨è€…ï¼Œä½ éœ€è¦æäº¤ä¸€ä¸ªåŒ…å«æ‰©å±•çš„åº”ç”¨åˆ°App Storeã€‚ç”¨æˆ·åªè¦ä¸‹è½½å¹¶å®‰è£…äº†ä½ çš„åº”ç”¨ï¼Œé‚£ä¹ˆåŒæ—¶ä¹Ÿè‡ªåŠ¨å®‰è£…äº†ä½ çš„åº”ç”¨æ‰©å±•ã€‚ å½“å®‰è£…äº†åº”ç”¨æ‰©å±•ä¹‹åï¼Œç”¨æˆ·é¦–å…ˆå¿…é¡»è¦å¼€å¯ä»–ä»¬ã€‚é€šå¸¸ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»–ä»¬å½“å‰ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å¯åŠ¨æ‰©å±•ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ çš„æ‰©å±•å¯ç”¨äº†â€œTodayâ€é€šçŸ¥ï¼Œé‚£ç”¨æˆ·å¯ä»¥åœ¨é€šçŸ¥ä¸­å¿ƒç¼–è¾‘â€œToday â€view æ¥æ·»åŠ ä½ çš„æ‰©å±•ã€‚åœ¨å…¶ä»–æƒ…å†µä¸­ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ iOS ä¸­çš„â€œSettingsâ€æˆ–è€… OS X ä¸­çš„â€œSystem Preferencesâ€æ¥å¯ç”¨å’Œç®¡ç†æ‰©å±•ã€‚ ç”¨æˆ·åœ¨ä¸åŒçš„æƒ…å½¢ä¸‹ä½“éªŒä¸åŒçš„åº”ç”¨æ‰©å±•è™½ç„¶æ¯ç§ç±»å‹çš„åº”ç”¨æ‰©å±•çš„åŠŸèƒ½éƒ½æ˜¯ä¸åŒçš„ï¼Œä½†å¯¹å¤§éƒ¨åˆ†æ‰©å±•æ¥è¯´ï¼Œå®ƒä»¬åœ¨ç”¨æˆ·ä½“éªŒä¸Šè¿˜æ˜¯æœ‰ä¸€äº›å…±åŒç‚¹çš„ã€‚å¦‚æœä½ å‡†å¤‡å¼€å‘ä¸€ä¸ªåº”ç”¨æ‰©å±•ï¼Œæœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼Œé‚£å°±æ˜¯è¦ç†è§£åœ¨ä½ é€‰æ‹©çš„æ‰©å±•ç‚¹ä¸­ï¼Œç”¨æˆ·ä½“éªŒæ˜¯ä»€ä¹ˆæ ·çš„ã€‚ä»ä¸€ä¸ªæ›´é«˜è§’åº¦çœ‹ï¼Œå¯¹äºæ‰€æœ‰æ‰©å±•æ¥è¯´ï¼Œæœ€ä½³çš„ç”¨æˆ·ä½“éªŒæ˜¯å¿«é€Ÿã€æµç•…ä»¥åŠåªå…³æ³¨å•ä¸€ä»»åŠ¡ã€‚ é€šå¸¸ç”¨æˆ·é€šè¿‡ä¸ç³»ç»Ÿæä¾›çš„ç”¨æˆ·ç•Œé¢è¿›è¡Œäº¤äº’æ¥å¼€å¯åº”ç”¨æ‰©å±•ã€‚æ¯”å¦‚è¯´ï¼Œç”¨æˆ·åœ¨appä¸­é€šè¿‡æ¿€æ´»ç³»ç»Ÿæä¾›çš„åˆ†äº«æŒ‰é’®æ¥è®¿é—® Share æ‰©å±•ï¼Œå¹¶ä»å±•ç¤ºçš„åˆ—è¡¨ä¸­é€‰æ‹©æ‰©å±•ã€‚ä¸€ä¸ªåº”ç”¨æ‰©å±•å¿…é¡»è¦æä¾›ä¸€ä¸ªå›¾æ ‡ï¼Œä»¥ä¾¿ç”¨æˆ·é€‰æ‹©å’Œè¯†åˆ«ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œåº”ç”¨æ‰©å±•çš„å›¾æ ‡ä¸åº”ç”¨ç¨‹åºçš„å›¾æ ‡æ˜¯ç›¸åŒçš„ã€‚ è™½ç„¶å¤§å¤šæ•°çš„åº”ç”¨ç¨‹åºæ‰©å±•éƒ½æä¾›äº†ä¸€äº›è‡ªå®šä¹‰çš„UIå…ƒç´ ï¼Œä½†ä¸€èˆ¬ç”¨æˆ·ä¸ä¼šçœ‹åˆ°ä½ çš„è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ï¼Œé™¤éä»–ä»¬è¿›å…¥åˆ°åº”ç”¨ç¨‹åºæ‰©å±•ä¸­ã€‚å½“ç”¨æˆ·è¿›å…¥åº”ç”¨æ‰©å±•ï¼Œä½ çš„è‡ªå®šä¹‰UIå¯ä»¥è®©ç”¨æˆ·çŸ¥æ™“ä»–ä»¬æ­£è¿›å…¥ä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚ç”±äºç”¨æˆ·å¯ä»¥æŠŠä½ çš„æ‰©å±•å’Œå½“å‰åº”ç”¨åŒºåˆ«å¼€æ¥ï¼Œæ‰€ä»¥ä»–ä»¬ä¼šæ¬£èµä½ æä¾›çš„ç‹¬ç‰¹åŠŸèƒ½ã€‚å½“ç”¨æˆ·æ„è¯†åˆ°æ‰©å±•å…¶å®æ˜¯ç‹¬ç«‹è¿è¡Œçš„å®ä½“æ—¶ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥ç¡®è®¤å¹¶ç§»é™¤ä½“éªŒä¸å¥½æˆ–åŠŸèƒ½ä¸å¥½çš„æ‰©å±•ã€‚ ä¸ºäº†è®©ç”¨æˆ·å¹³æ»‘è¿‡æ¸¡åˆ°ä½ çš„åº”ç”¨ç¨‹åºæ‰©å±•ï¼Œä½ è¦æ–Ÿé…Œè‡ªå®šä¹‰ç•Œé¢ä¸æ‰©å±•ç‚¹ç•Œé¢çš„é£æ ¼ï¼Œåšä¸€ä¸ªæƒè¡¡ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•å°±æ˜¯è®©ä½ çš„æ’ä»¶çœ‹èµ·æ¥åƒæ˜¯é€šçŸ¥ä¸­å¿ƒä¸­åŸç”Ÿçš„Widgetï¼Œå†æ¯”å¦‚è¯´ç…§ç‰‡ç¼–è¾‘æ‰©å±•ï¼Œä½ åº”è¯¥åˆ›å»ºä¸€ä¸ªå’Œ iOS ä¸­ Photos åº”ç”¨é£æ ¼ç›¸åè°ƒçš„ç”¨æˆ·ç•Œé¢ã€‚ æ³¨æ„ï¼šå³ä½¿ä½ çš„åº”ç”¨ç¨‹åºæ‰©å±•æ²¡æœ‰å±•ç¤ºè‡ªå®šä¹‰UIï¼ˆä¸åŒ…æ‹¬å›¾æ ‡ï¼‰ï¼Œä½†ç”¨æˆ·ä»ç„¶çŸ¥é“è¯¥æ‰©å±•ä¸åŒäºå½“å‰çš„åº”ç”¨ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦é‡‡ç”¨ç‰¹å®šçš„æ“ä½œæ¥æ¿€æ´»ã€‚ äº†è§£åº”ç”¨ç¨‹åºæ‰©å±•çš„å·¥ä½œåŸç†iOS8/OS X v10.10 åº”ç”¨ç¨‹åºæ‰©å±•ä¸æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œç›¸åï¼Œå®ƒæ˜¯ä¸»ä½“åº”ç”¨ç¨‹åºï¼ˆcontaining appï¼‰ä¸­ä¸€ä¸ªå•ç‹¬çš„åŒ…ï¼Œå¹¶èƒ½ç”Ÿæˆå•ç‹¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä¸ä¸»ä½“åº”ç”¨ç¨‹åºä¸åŒï¼Œåº”ç”¨æ‰©å±•å®ç°çš„æ˜¯ä¸€ä¸ªç‰¹å®šçš„ã€ç‹­ä¹‰èŒƒå›´å†…çš„ä»»åŠ¡ï¼Œå¹¶ä¸”è¦ä¸¥æ ¼éµå¾ªæ‰©å±•ç‚¹çš„åè®®ã€‚ åº”ç”¨ç¨‹åºæ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸå› ä¸ºä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰©å±•ä¸æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥å®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œè¿è¡Œç¯å¢ƒä¹Ÿä¸åŒäºåº”ç”¨ã€‚ä¸€èˆ¬æƒ…å†µæ¥è¯´ï¼Œåº”ç”¨ç¨‹åºæ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸå§‹äºç”¨æˆ·ä»æŸä¸ªåº”ç”¨ä¸­å¯åŠ¨å®ƒã€‚å…è®¸ç”¨æˆ·é€‰æ‹©æŸä¸€ç§æ‰©å±•æ¥å¸®åŠ©ä»–ä»¬æ‰§è¡ŒæŸé¡¹ä»»åŠ¡çš„åº”ç”¨ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºæ‰©å±•çš„è½½ä½“åº”ç”¨ï¼ˆhost appï¼‰ã€‚è½½ä½“åº”ç”¨ï¼ˆhost appï¼‰å®šä¹‰äº†æ¿€æ´»æ‰©å±•çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶åœ¨å…¶å‘é€è¯·æ±‚ä»¥å“åº”ç”¨æˆ·æ“ä½œæ—¶å¼€å§‹æ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“åº”ç”¨æ‰©å±•å®Œæˆè½½ä½“åº”ç”¨å‘é€çš„è¯·æ±‚ä»»åŠ¡åï¼Œè¯¥æ‰©å±•çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿéšä¹‹ç»“æŸã€‚ æ¯”å¦‚è¯´ï¼Œå‡å®šè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œç”¨æˆ·åœ¨æ‰©å±•è½½ä½“åº”ç”¨ï¼ˆhost appï¼‰ä¸­é€‰ä¸­ä¸€æ®µæ–‡å­—ï¼Œç‚¹å‡»åˆ†äº«æŒ‰é’®ï¼Œå¹¶ä»åˆ†äº«åˆ—è¡¨ä¸­é€‰æ‹©æŸä¸€ä¸ªåˆ†äº«æ‰©å±•ï¼Œå°†é€‰ä¸­çš„å†…å®¹åˆ†äº«è‡³ç¤¾äº¤ç½‘ç«™ã€‚æ­¤æ—¶ï¼Œè½½ä½“åº”ç”¨å°±ä¼šå‘æ‰©å±•å‘é€ä¸€ä¸ªåŒ…å«ç”¨æˆ·æ‰€é€‰æ–‡æœ¬çš„è¯·æ±‚ï¼Œå¯åŠ¨è¯¥æ‰©å±•ï¼Œä»è€Œå»å“åº”ç”¨æˆ·çš„è¯·æ±‚ï¼Œå³åˆ†äº«æ‰€é€‰æ–‡æœ¬çš„å†…å®¹ã€‚åº”ç”¨æ‰©å±•åŸºæœ¬çš„ç”Ÿå‘½å‘¨æœŸå½’çº³åœ¨ä¸‹å›¾2-1ä¸­ã€‚ åŸºæœ¬çš„æ‰©å±•ç”Ÿå‘½å‘¨æœŸ åœ¨å›¾2-1ä¸­çš„ç¬¬2æ­¥ä¸­ï¼Œç³»ç»Ÿå®ä¾‹åŒ–è½½ä½“åº”ç”¨è¯·æ±‚ä¸­ç¡®å®šçš„æ‰©å±•ï¼Œå¹¶åœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹é€šä¿¡é€šé“ã€‚ç„¶åæ‰©å±•åœ¨è½½ä½“åº”ç”¨çš„ä¸Šä¸‹æ–‡åœºæ™¯ä¸­æ˜¾ç¤ºç›¸å…³ç•Œé¢ï¼Œå¹¶ä½¿ç”¨å…¶åœ¨è½½ä½“åº”ç”¨è¯·æ±‚ä¸­æ¥æ”¶åˆ°çš„é¡¹ç›®æ¥æ‰§è¡Œä»»åŠ¡ï¼ˆåœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæ‰©å±•æ¥æ”¶åˆ°çš„é¡¹ç›®æ˜¯ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬ï¼‰ åœ¨å›¾2-1çš„ç¬¬3æ­¥ä¸­ï¼Œç”¨æˆ·åœ¨æ‰©å±•ä¸­æ‰§è¡Œæˆ–å–æ¶ˆæŸä¸ªä»»åŠ¡ï¼Œæˆ–è€…ç›´æ¥å¯ä»¥å¿½ç•¥è¯¥æ‰©å±•ã€‚åœ¨å¯¹ç”¨æˆ·çš„æ“ä½œåšå‡ºå“åº”çš„è¿‡ç¨‹ä¸­ï¼Œæ‰©å±•ä¼šæ ¹æ®è½½ä½“åº”ç”¨çš„è¯·æ±‚ç«‹å³å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œä½†å¦‚æœæœ‰ç‰¹æ®Šéœ€è¦æ—¶ï¼Œæ‰©å±•ä¹Ÿä¼šåœ¨ç³»ç»Ÿåå°æ‰§è¡Œä»»åŠ¡ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè½½ä½“ä¸ä¼šæ˜¾ç¤ºæ‰©å±•ç›¸å…³ç•Œé¢ï¼Œå¹¶ä¸”ç”¨æˆ·è¿”å›åˆ°å…¶å…ˆå‰åœ¨è½½ä½“åº”ç”¨ä¸­çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å½“åº”ç”¨æ‰©å±•æ‰§è¡Œå®Œä»»åŠ¡åï¼Œä¸ç®¡æ˜¯ç«‹åˆ»è¿”å›è¿˜æ˜¯å»¶è¿Ÿè¿”å›ï¼Œä½†æœ€åå…¶æ‰§è¡Œç»“æœéƒ½ä¼šè¿”å›ç»™è½½ä½“åº”ç”¨ã€‚ å½“æ‰©å±•å¼€å§‹æ‰§è¡Œä»»åŠ¡ä¹‹åï¼ˆæˆ–è€…å¼€å§‹åœ¨ç³»ç»Ÿåå°æ‰§è¡Œä»»åŠ¡ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šç»ˆæ­¢æ‰©å±•ï¼Œæ¯”å¦‚å›¾2-1ä¸­çš„ç¬¬4æ­¥ã€‚ åº”ç”¨æ‰©å±•æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„å½“åº”ç”¨æ‰©å±•åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå®ƒåªä¼šç›´æ¥å’Œè½½ä½“åº”ç”¨ï¼ˆhost appï¼‰è¿›è¡Œé€šä¿¡ï¼Œè€Œæ‰©å±•å’Œä¸»ä½“åº”ç”¨containing appä¹‹é—´ä¸ä¼šç›´æ¥é€šä¿¡ã€‚åœ¨æ‰©å±•è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸»ä½“åº”ç”¨ï¼ˆcontaining appï¼‰ç”šè‡³éƒ½ä¸è¿è¡Œã€‚å¦å¤–ï¼Œè½½ä½“åº”ç”¨ï¼ˆhost appï¼‰å’Œä¸»ä½“åº”ç”¨ï¼ˆcontaining appï¼‰ä¹‹é—´ä¹Ÿä¸ä¼šè¿›è¡Œé€šä¿¡ã€‚å›¾2-2ä¸­æè¿°äº†è¿è¡Œä¸­çš„åº”ç”¨æ‰©å±•ã€è½½ä½“åº”ç”¨ï¼ˆhost appï¼‰ä»¥åŠä¸»ä½“åº”ç”¨ï¼ˆcontaining appï¼‰è¿™ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ è¿è¡Œä¸­çš„æ‰©å±•ä»…å’Œè½½ä½“åº”ç”¨è¿›è¡Œé€šä¿¡ å½“ä¸€ä¸ªæ‰©å±•éœ€è¦å’Œä¸»ä½“åº”ç”¨containing appè¿›è¡Œé€šä¿¡æ—¶ï¼Œåªèƒ½åœ¨è½½ä½“åº”ç”¨ç¡®å®šçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è¿›è¡Œé—´æ¥é€šä¿¡ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªåº”ç”¨æ‰©å±•æœ‰å¯èƒ½ä¼šè¿è¡Œè°ƒç”¨å®ƒçš„åº”ç”¨ç¨‹åºã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰©å±•ä½¿ç”¨äº†ä¸èƒ½ä¸ containing app ä¼ é€’æ¶ˆæ¯çš„APIã€‚æ­¤å¤–ï¼Œåº”ç”¨æ‰©å±•ä¸å…¶ containing app å¯ä»¥åœ¨ä¸€ä¸ªå®šä¹‰ä¸ºç§æœ‰çš„å…±äº«å®¹å™¨ä¸­è®¿é—®æ•°æ®ã€‚å›¾2-3æè¿°äº†æ‰©å±•å’Œ containing app ä¹‹é—´çš„é—´æ¥é€šä¿¡ç±»å‹ã€‚ è¿è¡Œä¸­çš„æ‰©å±•å¯ä»¥ä¸å…¶containing appè¿›è¡Œé—´æ¥é€šä¿¡ æ³¨æ„ï¼šåœ¨åº•å±‚ï¼Œç³»ç»Ÿä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡æ¥ç¡®ä¿åº”ç”¨æ‰©å±•å’Œæ‰©å±•è½½ä½“åº”ç”¨å…±åŒæ¥å¼€å¯æ— ç¼ç»“åˆä½“éªŒã€‚åœ¨ä½ çš„ä»£ç ä¸­ï¼Œä½ æ— éœ€è€ƒè™‘è¿™äº›åº•å±‚çš„é€šä¿¡æœºåˆ¶ï¼Œå› ä¸ºä½ ä½¿ç”¨çš„æ˜¯æ‰©å±•ç‚¹å’Œç³»ç»Ÿæä¾›çš„é«˜çº§APIã€‚ åˆ›å»ºåº”ç”¨æ‰©å±•iOS8/OS X v10.10 å½“ä½ å‡†å¤‡å¥½å¼€å‘ä¸€ä¸ªåº”ç”¨æ‰©å±•æ—¶ï¼Œå¯ä»¥ä»é€‰æ‹©ä¸€ä¸ªæ”¯æŒä½ æƒ³æ‰§è¡Œçš„ä»»åŠ¡çš„æ‰©å±•ç‚¹å¼€å§‹ã€‚ç„¶åé€‰æ‹©é€‚ç”¨äºä½ æ‰€é€‰çš„æ‰©å±•ç‚¹çš„Xcodeæ¨¡æ¿ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä½¿ç”¨è‡ªå®šä¹‰ä»£ç å’Œè‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢æ¥å¢å¼ºé»˜è®¤æ–‡ä»¶ã€‚æœ€åï¼Œåœ¨ä½ è°ƒè¯•å¹¶ä¼˜åŒ–ä½ çš„åº”ç”¨æ‰©å±•ä¹‹åï¼Œå°±å¯ä»¥æ‰“åŒ…è¿›ä½ çš„åº”ç”¨ç¨‹åºç»™ç”¨æˆ·ä½¿ç”¨äº†ã€‚ ä»é€‰æ‹©æ­£ç¡®çš„æ‰©å±•ç‚¹å¼€å§‹æ¯ä¸ªæ‰©å±•ç‚¹éƒ½é’ˆå¯¹ä¸€ä¸ªå®šä¹‰æ˜ç¡®çš„ç”¨æˆ·åœºæ™¯ï¼Œä½ é¦–å…ˆè¦æ¸…æ¥šè¿™ä¸ªåº”ç”¨èƒ½ä¸ºç”¨æˆ·æä¾›ä»€ä¹ˆæ ·çš„åŠŸèƒ½ï¼Œæ‰€ä»¥è¦é€‰æ‹©ä¸€ä¸ªæ”¯æŒè¯¥åŠŸèƒ½çš„æ‰©å±•ç‚¹ã€‚è¿™æ˜¯éå¸¸å…³é”®çš„ï¼Œå› ä¸ºæ¯ä¸ªæ‰©å±•ç‚¹å®šä¹‰äº†ä¸åŒçš„APIï¼Œä¸ºä½ æä¾›ä¸åŒçš„åŠŸèƒ½å¼€å‘ï¼Œæ‰€ä»¥å¦‚æœé€‰é”™äº†æ‰©å±•ç‚¹ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ— æ³•å®ç°æƒ³è¦çš„åŠŸèƒ½ã€‚è¡¨1-1åˆ—å‡ºäº†iOSå’ŒOS Xä¸­æ”¯æŒçš„æ‰€æœ‰æ‰©å±•ç‚¹ã€‚ é€‰å®šäº†ä¸€ä¸ªé€‚ç”¨äºåº”ç”¨æ‰©å±•çš„æ‰©å±•ç‚¹åï¼Œåœ¨ä½ çš„containing appä¸­ä¼šæœ‰ä¸€ä¸ªæ–°çš„Targetã€‚æ·»åŠ åº”ç”¨æ‰©å±•Targetæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨Xcodeæä¾›çš„æ¨¡æ¿ï¼Œè¿™äº›æ¨¡æ¿ä¸ºæ‰©å±•ç‚¹æä¾›äº†é¢„é…ç½®ã€‚ ä½ å¯ä»¥é€šè¿‡èœå•é€‰æ‹© File &gt; New &gt; Targetåœ¨ä½ çš„Xcodeå·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªæ–°Targetã€‚åœ¨å·¦è¾¹çš„ä¾§è¾¹æ ä¸­ï¼Œé€‰æ‹©iOSæˆ–OS Xçš„Application Extensioné€‰é¡¹ï¼Œç„¶ååœ¨å³è¾¹é¢æ¿å‘ˆç°çš„Xcode æ¨¡æ¿ä¸­é€‰æ‹©ä½ æƒ³è¦åˆ›å»ºçš„åº”ç”¨æ‰©å±•æ¨¡æ¿ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€‰æ‹©å¥½æ¨¡æ¿ï¼Œå¹¶åœ¨å·¥ç¨‹ä¸­æ·»åŠ Targetï¼Œåœ¨è‡ªå®šä¹‰æ‰©å±•ä»£ç ä¹‹å‰ï¼Œä½ å¯ä»¥è¯•ç€ç¼–è¯‘å¹¶è¿è¡Œä¸€ä¸‹é¡¹ç›®ã€‚å¦‚æœä½ æ˜¯åŸºäºXcodeæä¾›çš„æ¨¡æ¿åˆ›å»ºçš„æ‰©å±•ï¼Œé‚£ä¹ˆå½“ç¼–è¯‘æˆåŠŸåï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæ‰©å±•åä¸º .appexçš„åº”ç”¨æ‰©å±•åŒ…ã€‚ æ³¨æ„64ä½çš„æ¶æ„ï¼šä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰©å±•åœ¨Architecturesè®¾ç½®ä¸­å¿…é¡»è¦åŒ…å«arm64çš„æ¶æ„ï¼Œå¦åˆ™åœ¨ä¸Šä¼ App Storeæ—¶ä¼šè¢«æ‹’ç»ã€‚åˆ›å»ºå®Œä¸€ä¸ªåº”ç”¨æ‰©å±•åï¼Œä½ å¯ä»¥åœ¨Xcodeçš„â€œStandard architecturesâ€è®¾ç½®é€‰é¡¹ä¸­è®¾ç½®arm64æ¶æ„ã€‚ å¦‚æœä½ çš„åŒ…å«æ‰©å±•çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†ä¸€äº›åµŒå…¥æ¡†æ¶ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨ç¨‹åºä¹Ÿå¿…é¡»è¦åŒ…å«arm64æ¶æ„ï¼Œå¦åˆ™ä¸Šä¼ App Storeæ—¶ä¹Ÿä¼šè¢«æ‹’ç»ã€‚ å…³äº64ä½æ¶æ„å¼€å‘ç¯å¢ƒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æ ¹æ®ä½ çš„targetå¹³å°å‚é˜…64-Bit Transition Guide for Cocoa Touchæˆ–è€…64-Bit Transition Guide for Cocoaã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨System Preferencesæˆ–Settingsä¸­å¯ç”¨åº”ç”¨æ‰©å±•æˆ–è€…æˆäºˆæƒé™æ¥æµ‹è¯•é»˜è®¤çš„åº”ç”¨æ‰©å±•ï¼Œç„¶åå¯ä»¥é€šè¿‡å…¶ä»–åº”ç”¨æ¥è®¿é—®å®ƒã€‚æ¯”å¦‚ä½ å¯ä»¥åœ¨OS Xç³»ç»Ÿä¸­é€šè¿‡Safariä¸­æ‰“å¼€ä¸€ä¸ªé¡µé¢æ¥æµ‹è¯•åˆ†äº«æ‰©å±•ï¼Œç‚¹å‡»åˆ†äº«æŒ‰é’®ï¼Œç„¶åé€‰æ‹©ä½ è¦æµ‹è¯•çš„æ‰©å±•å³å¯ã€‚ æ£€æŸ¥é»˜è®¤çš„æ‰©å±•æ¨¡æ¿ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ‰©å±•æ¨¡æ¿éƒ½åŒ…å«ä¸€ä¸ªå±æ€§åˆ—è¡¨æ–‡ä»¶ï¼ˆå°±æ˜¯Info.plistæ–‡ä»¶ï¼‰ï¼Œä¸€ä¸ªView Controllerç±»å’Œä¸€ä¸ªé»˜è®¤çš„UIï¼Œè¿™äº›éƒ½æ˜¯æ‰©å±•ç‚¹å®šä¹‰çš„ã€‚é»˜è®¤çš„View Controllerç±»ï¼ˆæˆ–principal classï¼‰éƒ½å«æœ‰æ‰©å±•ç‚¹å¯¹åº”åŠŸèƒ½çš„æ–¹æ³•ï¼Œéœ€è¦æˆ‘ä»¬å»å®ç°ã€‚ åº”ç”¨æ‰©å±•Targetçš„Info.plistæ–‡ä»¶é™¤äº†è¯†åˆ«æ‰©å±•ç‚¹å¤–è¿˜ç½—åˆ—äº†åº”ç”¨æ‰©å±•çš„è¯¦ç»†ä¿¡æ¯ã€‚è¯¥æ–‡ä»¶è‡³å°‘åŒ…æ‹¬NSExtensionå­—å…¸ä»¥åŠæ‰©å±•ç‚¹æŒ‡å®šçš„å…¶ä»–é”®å€¼å­—å…¸ã€‚ã€‚æ¯”å¦‚NSExtensionPointIdentifierçš„keyå€¼å°±æ˜¯æ‰©å±•ç‚¹çš„åå‘DNSåç§°ï¼Œæ¯”å¦‚com.apple.widget-extensionã€‚åœ¨åº”ç”¨æ‰©å±•çš„NSExtensionå­—å…¸ä¸­è¿˜æœ‰å…¶ä»–çš„Keyå’Œå€¼ï¼š NSExtensionAttributesï¼šè¿™æ˜¯ä¸€ä¸ªæè¿°æ‰©å±•ç‚¹å…·ä½“å±æ€§çš„å­—å…¸ï¼Œå°±åƒç…§ç‰‡ç¼–è¾‘æ‰©å±•ä¸­çš„PHSupportedMediaTypesä¸€æ ·ã€‚NSExtensionPrincipalClassï¼šè¿™æ˜¯æ‰©å±•æ¨¡æ¿åˆ›å»ºçš„ä¸»ä½“è§†å›¾æ§åˆ¶å™¨ç±»ï¼Œæ¯”å¦‚SharingViewControllerã€‚å½“è½½ä½“åº”ç”¨ç¨‹åºï¼ˆhost appï¼‰è°ƒç”¨æ‰©å±•æ—¶ï¼Œæ‰©å±•ç‚¹ä¼šå®ä¾‹åŒ–è¿™ä¸ªç±»ã€‚NSExtensionMainStoryboardï¼ˆåªé€‚ç”¨äºiOSï¼‰ï¼šæ‰©å±•é»˜è®¤çš„Storyboardæ–‡ä»¶ï¼Œä¸€èˆ¬åä¸ºMainInterfaceã€‚ é™¤äº†åœ¨å±æ€§åˆ—è¡¨ä¸­è®¾ç½®ä»¥å¤–ï¼Œæ‰©å±•æ¨¡æ¿è¿˜å¯ä»¥è®¾ç½®ä¸€äº›é»˜è®¤çš„åŠŸèƒ½ã€‚æ¯ä¸ªæ‰©å±•ç‚¹å¯ä»¥å®šä¹‰æ‰©å±•ç‚¹æ”¯æŒçš„é€‚ç”¨äºæŸä¸ªç±»å‹ä»»åŠ¡çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªiOSçš„Document Provideræ‰©å±•å°±åŒ…å«com.apple.security.application-groupsçš„åŠŸèƒ½ã€‚ æ‰€æœ‰çš„OS Xæ‰©å±•æ¨¡æ¿éƒ½é»˜è®¤åŒ…å«åº”ç”¨ç¨‹åºæ²™ç®±å’Œcom.apple.security.files.user-selected.read-onlyåŠŸèƒ½ã€‚å¦‚æœä½ å¼€å‘çš„æ‰©å±•éœ€è¦é€‚ç”¨ç½‘ç»œï¼Œæˆ–è€…è®¿é—®ç”¨æˆ·çš„ç›¸å†Œï¼Œå†æˆ–è€…éœ€è¦è®¿é—®ç”¨æˆ·çš„é€šè®¯å½•ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦é¢å¤–å®šä¹‰è¿™äº›åŠŸèƒ½ã€‚ æ³¨æ„ï¼šé€šå¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨æˆ·å…è®¸ä¸»åº”ç”¨ç¨‹åºï¼ˆcontaining appï¼‰è®¿é—®ä»–ä»¬çš„ç§æœ‰æ•°æ®ï¼Œé‚£ä¹ˆä¸»ç¨‹åºé‡Œçš„æ‰©å±•ä¹ŸåŒæ ·æ‹¥æœ‰è¯¥æƒé™ã€‚ å“åº”â€œè½½ä½“ç¨‹åºâ€ï¼ˆHost Appï¼‰çš„è¯·æ±‚æ­£å¦‚ä½ åœ¨Understand How an Extension Worksè¿™ç¯‡æ–‡æ¡£ä¸­äº†è§£çš„ï¼Œå½“ç”¨æˆ·åœ¨host appé€‰æ‹©ä¸€ä¸ªæ‰©å±•ï¼Œå¹¶ä½¿host appå‘æ‰©å±•å‘å‡ºè¯·æ±‚æ—¶ï¼Œå°±ä¼šæ‰“å¼€æ‰©å±•ã€‚è¯´çš„å†è¯¦ç»†ä¸€ç‚¹ï¼Œä½ çš„æ‰©å±•ä¼šæ ¹æ®ç”¨æˆ·çš„æ“ä½œæ¥æ”¶åˆ°è¯·æ±‚ï¼Œå¸®ç”¨æˆ·æ‰§è¡Œä»»åŠ¡ï¼Œç„¶åå®Œæˆæˆ–è€…å…³é—­è¯·æ±‚ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªåˆ†äº«æ‰©å±•æ”¶åˆ°äº†æ¥è‡ªhost appçš„è¯·æ±‚ï¼Œç„¶åè¯¥æ‰©å±•ä¼šæ‰“å¼€ç›¸åº”è§†å›¾æ¥å“åº”è¯·æ±‚ã€‚ç„¶åç”¨æˆ·åœ¨è¯¥ç•Œé¢ä¸­ç¼–è¾‘è¦åˆ†äº«çš„å†…å®¹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å‘é€æˆ–è€…ä¸å‘é€ï¼Œæœ€åæ‰©å±•æ ¹æ®ç”¨æˆ·çš„è¡Œä¸ºå“åº”å®Œæˆè¿˜æ˜¯å…³é—­è¯·æ±‚ã€‚ å½“host appå‘æ‰©å±•å‘å‡ºè¯·æ±‚æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šæŒ‡æ˜æ‰©å±•è¿è¡Œçš„ä¸Šä¸‹æ–‡ã€‚å¯¹äºå¾ˆå¤šæ‰©å±•æ¥è¯´ï¼Œæœ€é‡è¦çš„ä¸€éƒ¨åˆ†å°±æ˜¯è¦è®¾ç½®ä¸€ä¸ªå·¥ä½œé¡¹ï¼Œè¿™ä¸ªå·¥ä½œé¡¹å°±æ˜¯ç”¨æˆ·åœ¨ä½¿ç”¨è¿™ä¸ªæ‰©å±•æ—¶è¦å¤„ç†çš„å·¥ä½œé¡¹ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªåˆ†äº«æ‰©å±•çš„ä¸Šä¸‹æ–‡å¯èƒ½å°±åŒ…å«ç”¨æˆ·é€‰æ‹©çš„æƒ³è¦åˆ†äº«çš„ä¸€æ®µæ–‡å­—ã€‚ å½“host appå‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼ˆé€šå¸¸å°±æ˜¯è°ƒç”¨beginRequestWithExtensionContext:æ–¹æ³•ï¼‰ï¼Œä½ çš„æ‰©å±•å°±å¯ä»¥ç”¨ä¸»è¯•å›¾æ§åˆ¶å™¨ä¸­çš„ extensionContext å±æ€§æ¥è·å¾—ä¸Šä¸‹æ–‡ï¼Œç„¶åä½¿ç”¨ NSExtensionContext ç±»è§£æä¸Šä¸‹æ–‡å¹¶è·å¾—å·¥ä½œé¡¹ã€‚é€šå¸¸ï¼Œåœ¨è§†å›¾æ§åˆ¶å™¨çš„ loadView æ–¹æ³•ä¸­è§£æä¸Šä¸‹æ–‡å¹¶è·å¾—å·¥ä½œé¡¹ï¼Œè¿™æ ·åœ¨åŠ è½½å®Œè§†å›¾åå°±å¯ä»¥å°†ä¿¡æ¯æ˜¾ç¤ºåœ¨è§†å›¾ç•Œé¢ä¸­äº†ã€‚è·å–æ‰©å±•ä¸Šä¸‹æ–‡å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š NSExtensionContext *myExtensionContext = [self extensionContext]; æœ‰æ„æ€çš„æ˜¯å†…å®¹å¯¹è±¡çš„ inputItems å±æ€§ï¼Œå®ƒåŒ…å«äº†åº”ç”¨æ‰©å±•éœ€è¦ä½¿ç”¨çš„å·¥ä½œé¡¹ã€‚inputItems å±æ€§åŒ…å«ä¸€ä¸ª NSExtensionItem ç±»å‹çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸€ä¸ªæˆå‘˜éƒ½åŒ…å«ä¸€ä¸ªå¯æ‰§è¡Œçš„å·¥ä½œé¡¹ã€‚ä»ä¸Šä¸‹æ–‡ä¸­è·å–å·¥ä½œé¡¹å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š NSArray *inputItems = [myExtensionContext inputItems]; æ¯ä¸ª NSExtensionItem å¯¹è±¡éƒ½åŒ…å«è‹¥å¹²ä¸ªæè¿°å·¥ä½œé¡¹çš„å±æ€§ï¼Œæ¯”å¦‚æ ‡é¢˜ã€æ–‡æœ¬å†…å®¹ã€é™„ä»¶ä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ã€‚ æ³¨æ„ attachments å±æ€§ï¼Œå®ƒåŒ…å«ä¸€ä¸ªä¸å·¥ä½œé¡¹ç›¸å…³è”çš„åª’ä½“æ•°æ®æ•°ç»„ã€‚æ¯”å¦‚è¯´ä¸€ä¸ªåˆ†äº«è¯·æ±‚çš„å·¥ä½œé¡¹ï¼Œé‚£ä¹ˆ attachments å±æ€§å¯èƒ½å°±åŒ…å«ç”¨æˆ·æƒ³è¦åˆ†äº«ç½‘é¡µä¸­çš„ä¿¡æ¯ã€‚ å½“ç”¨æˆ·å·¥ä½œé¡¹å¤„ç†å®Œåï¼Œåº”ç”¨æ‰©å±•é€šå¸¸ä¼šç»™ç”¨æˆ·ä¸¤ä¸ªé€‰æ‹©ï¼Œå®Œæˆä»»åŠ¡æˆ–å–æ¶ˆä»»åŠ¡ã€‚æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©ï¼Œæ‰©å±•ä¼šè°ƒç”¨ completeRequestReturningItems:expirationHandler:completion: æ–¹æ³•ï¼ŒæŠŠå·¥ä½œé¡¹è¿”å›ç»™ host appï¼Œæˆ–è€…ä¼šè°ƒç”¨ cancelRequestWithError: æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ä»£ç ã€‚ åœ¨iOSä¸­ï¼Œä½ çš„åº”ç”¨ç¨‹åºæ‰©å±•å¯èƒ½éœ€è¦æ›´å¤šçš„æ—¶é—´å»å¤„ç†æ½œåœ¨çš„éœ€é•¿æ—¶é—´å¤„ç†çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´å¾€ç½‘ä¸Šä¸Šä¼ å†…å®¹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å°±è¦ä½¿ç”¨ NSURLSession ç±»å°†è¯¥ä»»åŠ¡è½¬ä¸ºåå°å¤„ç†çš„ä»»åŠ¡ã€‚å› ä¸ºè½¬æ¢åˆ°åå°å¤„ç†ä»»åŠ¡éœ€è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œæ‰€ä»¥åœ¨æ‰©å±•å®Œæˆä¸»åº”ç”¨è¯·æ±‚å¹¶å…³é—­åä»ç„¶å¯ä»¥å¤„ç†ã€‚æƒ³äº†è§£æ›´å¤šå…³äºæ‰©å±•ä¸­NSURLSessionç±»çš„ç”¨æ³•ï¼Œè¯·å‚é˜…ï¼šPerforming Uploads and Downloadsã€‚ é‡è¦ï¼šè™½ç„¶ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªåå°URLæ¥ä¸Šä¼ æˆ–ä¸‹è½½ä»»åŠ¡ï¼Œä½†æ˜¯æœ‰ä¸€äº›ç±»å‹çš„åå°ä»»åŠ¡ï¼Œæ¯”å¦‚æ”¯æŒ VoIp æˆ–è€…åœ¨åå°æ’­æ”¾éŸ³ä¹çš„ä»»åŠ¡ï¼Œæ˜¯ä¸èƒ½é€šè¿‡æ‰©å±•æ¥å®ç°çš„ã€‚ å¦‚æœä½ åº”ç”¨æ‰©å±•çš„Info.plistæ–‡ä»¶ä¸­å«æœ‰ UIBackgroundModes å…³é”®å­—ï¼Œé‚£ä¹ˆåœ¨ä¸Šä¼ App Storeæ—¶ä¼šè¢«æ‹’ç»ã€‚ï¼ˆæƒ³äº†è§£æ›´å¤šå…³äº UIBackgroundModes å…³é”®å­—çš„å†…å®¹ï¼Œè¯·å‚é˜… Information Property List Key Reference ä¸­çš„ UIBackgroundModesï¼‰ ä¼˜åŒ–æ•ˆç‡å’Œæ€§èƒ½åº”ç”¨æ‰©å±•åœ¨å†…å­˜ä½¿ç”¨ä¼˜å…ˆçº§ä¸Šè¦æ˜æ˜¾ä½äºå½“å‰è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚ä¸ç®¡æ˜¯ iOS è¿˜æ˜¯ OS Xï¼Œç³»ç»Ÿéƒ½ä¼šæ¯«ä¸çŠ¹è±«åœ°ç»ˆæ­¢æ‰©å±•ï¼Œå› ä¸ºç”¨æˆ·æƒ³è¿”å›åˆ°host appä¸­çš„ä¸»è¦ç›®æ ‡ä¸­ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›åº”ç”¨æ‰©å±•çš„å†…å­˜ä½¿ç”¨ä¼˜å…ˆçº§è¦é«˜äºå…¶ä»–æ‰©å±•ï¼Œæ¯”å¦‚è¯´widgetså°±è¦æ±‚è¦é«˜ä¸€äº›ï¼Œå› ä¸ºå®ƒè¦å®æ—¶çš„æ˜¾ç¤ºä¸€äº›ä¿¡æ¯ï¼Œå› ä¸ºä¸€èˆ¬ç”¨æˆ·æ›´å€¾å‘äºåŒæ—¶å¼€å¯å¤šä¸ªwidgetsã€‚ ä½ çš„åº”ç”¨æ‰©å±•å¹¶ä¸æ‹¥æœ‰ä¸»å¾ªç¯çº¿ç¨‹ï¼Œä½ è¦éµå¾ªè¿™ä¸€è§„åˆ™ï¼Œä»¥ä¾¿è®©æ‰©å±•åœ¨ä¸»å¾ªç¯çº¿ç¨‹ä¸­å‘æŒ¥æœ€å¥½çš„æ€§èƒ½ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ çš„åº”ç”¨æ‰©å±•é˜»æ­¢äº†ä¸»å¾ªç¯çº¿ç¨‹ï¼Œé‚£ä¹ˆåœ¨ç”¨æˆ·ä½¿ç”¨ä¸»åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šé€ æˆéå¸¸ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒæ•ˆæœã€‚æˆ‘ä»¬éœ€è¦è®°ä½çš„ä¸€ç‚¹æ˜¯ï¼ŒGPUåœ¨ç³»ç»Ÿä¸­æ˜¯ä¸€ä¸ªå…±äº«çš„èµ„æºï¼Œæ‰€ä»¥åº”ç”¨æ‰©å±•ä¸ä¼šå¾—åˆ°å¾ˆé«˜çš„ä¼˜å…ˆçº§ç…§é¡¾ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœä½ æ­£åœ¨ç©ä¸€ä¸ªå¯¹GPUæ¶ˆè€—å¾ˆé«˜çš„æ¸¸æˆï¼Œé‚£ä¹ˆç”±äºå†…å­˜å‹åŠ›æ¯”è¾ƒå¤§ï¼Œå®ƒå°±æœ‰å¯èƒ½ä¼šé€‰æ‹©å…³é—­Today widgetã€‚ è®¾è®¡ä¸€ä¸ªç²¾ç®€çš„ç”¨æˆ·ç•Œé¢å¤§å¤šæ•°çš„æ‰©å±•ç‚¹éƒ½è¦æ±‚ä½ å‘ç”¨æˆ·æä¾›ä¸€äº›è‡ªå®šä¹‰çš„ç•Œé¢ï¼Œå®ƒåœ¨ç”¨æˆ·æ‰“å¼€ä½ çš„åº”ç”¨æ‰©å±•æ—¶å‘ˆç°ç»™ç”¨æˆ·ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”ç”¨æ‰©å±•çš„ç•Œé¢è¦å°½å¯èƒ½çš„ç®€çº¦ã€å†…æ•›ï¼Œå¹¶ä¸»è¦å…³æ³¨ä¸€ä¸ªå•ä¸€ä»»åŠ¡ã€‚ä¸ºäº†æé«˜æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒæ•ˆæœï¼Œä½ è¦é¿å…ä¸è¯¥æ‰©å±•åŠŸèƒ½æ— å…³çš„ç•Œé¢å‡ºç°ã€‚ å¤§å¤šæ•°Xcode æä¾›çš„åº”ç”¨æ‰©å±•æ¨¡æ¿éƒ½åŒ…å«ä¸€ä¸ªåˆå§‹ç•Œé¢æ–‡ä»¶ï¼Œä½ å¯ä»¥ä»è¿™ä¸ªæ–‡ä»¶ä¸­è®¾è®¡ç•Œé¢å¼€å§‹ã€‚ åœ¨ç”¨æˆ·çš„æƒ¯æ€§æ€ç»´ä¸­ï¼Œä¸€èˆ¬ä»–ä»¬éƒ½æ˜¯é€šè¿‡åº”ç”¨æ‰©å±•çš„å›¾æ ‡æ¥è¾¨è¯†æ‰©å±•åŠŸèƒ½çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”ç”¨æ‰©å±•çš„å›¾æ ‡å’Œå®ƒçš„ä¸»ä½“åº”ç”¨çš„å›¾æ ‡æ˜¯ä¸€è‡´çš„ã€‚ä½¿ç”¨ä¸»ä½“åº”ç”¨çš„å›¾æ ‡ä½œä¸ºåº”ç”¨æ‰©å±•çš„å›¾æ ‡æœ‰åˆ©äºç”¨æˆ·å»åˆ¤æ–­è¿™ä¸ªæ‰©å±•çš„æ¥æºï¼Œä¹Ÿå°±æ˜¯è¯´è®©ç”¨æˆ·ç¡®ä¿¡è¿™ä¸ªæ‰©å±•æ˜¯æ¥æºäºä»–ä»¬å®‰è£…çš„ä¸»ä½“åº”ç”¨ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ä¾‹å¤–ã€‚ åœ¨iOSä¸­ï¼Œè‡ªå®šä¹‰çš„Actionæ‰©å±•çš„å›¾æ ‡ä½¿ç”¨å…¶ä¸»ä½“åº”ç”¨çš„å›¾æ ‡ã€‚åœ¨OS Xä¸­ï¼Œå¦‚æœä¸€ä¸ªæ‰©å±•çš„ä¸»ä½“ç¨‹åºåªæ˜¯ç”¨æ¥å®‰è£…æ‰©å±•çš„å°è£…åŒ…ï¼Œé‚£ä¹ˆè¯¥æ‰©å±•è¦æä¾›ä¸€ä¸ªå•ç‹¬çš„å›¾æ ‡ï¼Œå¦åˆ™éƒ½ä¼šä½¿ç”¨ä¸»ä½“åº”ç”¨çš„å›¾æ ‡ã€‚ åº”ç”¨æ‰©å±•è¦ä½¿ç”¨ä¸€ä¸ªç®€çŸ­ï¼Œè¯­ä¹‰æ˜ç¡®çš„åå­—ï¼Œè¿™èƒ½è®©å¸®åŠ©ç”¨æˆ·æŠŠæ‰©å±•å’Œä½ çš„ä¸»åº”ç”¨ç¨‹åºè”ç³»èµ·æ¥ï¼Œå¹¶ä¸”èƒ½è®©ä»–ä»¬åœ¨ç³»ç»Ÿä¸­æ›´å¥½çš„ç®¡ç†åº”ç”¨æ‰©å±•ã€‚é€šè¿‡åº”ç”¨æ‰©å±• Targetçš„ CFBundleDisplayName å±æ€§æ¥è®¾ç½®å®ƒçš„åç§°ï¼Œä½ å¯ä»¥åœ¨Info.plistæ–‡ä»¶ä¸­ä¿®æ”¹å®ƒã€‚å¦‚æœä½ æ²¡æœ‰ç»™ CFBundleDisplayNameè®¾ç½®å€¼ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ç»™æ‰©å±•è®¾ç½®åç§°ï¼Œé‚£ä¹ˆåº”ç”¨æ‰©å±•ä¼šä½¿ç”¨å…¶ä¸»ä½“åº”ç”¨çš„åç§°ï¼Œä¹Ÿå°±æ˜¯CFBundleNameå±æ€§ä¸­çš„å€¼ã€‚ åŒæ—¶ä¸€äº›åº”ç”¨æ‰©å±•ä¹Ÿéœ€è¦ä¸€ä¸ªç®€çŸ­çš„è¯´æ˜ã€‚æ¯”å¦‚è¯´ï¼ŒOS Xä¸­çš„ Widget æ‰©å±•å°±ä¼šæ˜¾ç¤ºä¸€ä¸ªç®€å•çš„æè¿°ï¼Œè¿™èƒ½å¸®åŠ©ç”¨æˆ·æ›´å¥½çš„é€‰æ‹©ä»–ä»¬æƒ³è¦æ˜¾ç¤ºåœ¨ä»Šæ—¥é€šçŸ¥ä¸­çš„Widgetæ‰©å±•ã€‚æ‰©å±•çš„æè¿°å¯ä»¥åœ¨ InfoPlist.strings æ–‡ä»¶çš„widget.description å±æ€§ä¸­è®¾ç½®ã€‚ ç¡®ä¿æ‚¨çš„iOS Appæ‰©å±•é€‚ç”¨äºæ‰€æœ‰è®¾å¤‡æ‚¨å¿…é¡»ç¡®ä¿æäº¤çš„åº”ç”¨æ‰©å±•ç¨‹åºæ˜¯é€šç”¨çš„ï¼šå®ƒå¿…é¡»é€‚ç”¨äºiPhoneï¼ŒiPod touchå’ŒiPadã€‚æ— è®ºæ‚¨ä¸ºåŒ…å«çš„åº”ç”¨é€‰æ‹©å“ªä¸ªç›®æ ‡è®¾å¤‡ç³»åˆ—ï¼Œæ­¤è¦æ±‚å‡é€‚ç”¨ã€‚Xcodeä¸­çš„åº”ç”¨ç¨‹åºæ‰©å±•æ¨¡æ¿å·²é’ˆå¯¹é€šç”¨ç›®æ ‡è®¾å¤‡ç³»åˆ—è¿›è¡Œäº†æ­£ç¡®é…ç½®ã€‚ è¦å£°æ˜æ‚¨çš„åº”ç”¨æ‰©å±•ç¨‹åºæ˜¯é€šç”¨çš„ï¼Œè¯·ä½¿ç”¨Xcodeä¸­çš„ç›®æ ‡è®¾å¤‡ç³»åˆ—æ„å»ºè®¾ç½®ï¼ŒæŒ‡å®šâ€œiPhone / iPadâ€å€¼ã€‚ ç¡®ä¿æ‚¨çš„åº”ç”¨æ‰©å±•ç¨‹åºå…·æœ‰é€šç”¨æ€§ åœ¨keyboard projectçš„Xcodeé¡¹ç›®å¯¼èˆªå™¨ä¸­ï¼Œé€‰æ‹©é¡¹ç›®æ–‡ä»¶ã€‚å¦‚æœéšè—äº†é¡¹ç›®ç¼–è¾‘å™¨ä¸­çš„projectå’Œtargetsåˆ—è¡¨ï¼Œè¯·æ˜¾ç¤ºå®ƒã€‚ä¸ºæ­¤ï¼Œè¯·å•å‡»projectç¼–è¾‘å™¨é€‰é¡¹å¡æ å·¦ä¾§çš„æŒ‰é’®ã€‚ åœ¨project å’Œ targetsåˆ—è¡¨çš„targetsç»„ä¸­ï¼Œé€‰æ‹©åº”ç”¨æ‰©å±•ç¨‹åºçš„targetsã€‚ åœ¨projectç¼–è¾‘å™¨ä¸­é€‰æ‹©Build Settingsé€‰é¡¹å¡ã€‚ç¡®ä¿é€‰ä¸­Basic å’Œ CombinedæŒ‰é’®ï¼Œä»¥ä¾¿äºæ‚¨æ›´è½»æ¾åœ°æ‰¾åˆ°æ‰€éœ€çš„è®¾ç½®ã€‚ åœ¨projectç¼–è¾‘å™¨çš„Deployment groupä¸­ï¼ŒæŸ¥çœ‹â€œTargeted Device Familyâ€è®¾ç½®ã€‚å¯¹äºDebugå’ŒReleaseé…ç½®ï¼Œå€¼åº”ä¸ºâ€œiPhone / iPadâ€ã€‚å¦‚æœæ‚¨æ‰¾åˆ°ä¸åŒçš„å€¼ï¼Œè¯·å°†å…¶æ›´æ­£ä¸ºâ€œiPhone / iPadâ€ã€‚ åœ¨è®¾è®¡å’Œæ„å»ºåº”ç”¨æ‰©å±•æ—¶ ä½¿ç”¨Auto Layoutå’Œsize classesç±»ã€‚æµ‹è¯•æ‚¨çš„åº”ç”¨æ‰©å±•ç¨‹åºï¼Œä»¥ç¡®ä¿å…¶ç¬¦åˆæ‚¨å¯¹æ‰€æœ‰è®¾å¤‡å¤§å°å’Œæ–¹å‘çš„é¢„æœŸè¡Œä¸ºã€‚å¦‚â€œ Simulator User Guideæ‰€è¿°ï¼Œåœ¨iOSæ¨¡æ‹Ÿå™¨ä¸­æ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚æœå¯èƒ½ï¼Œè¿˜å¯ä»¥åœ¨ä¸¤ä¸ªæ–¹å‘ä¸Šå¯¹ç‰©ç†è®¾å¤‡è¿›è¡Œæµ‹è¯•ã€‚ è¯·è®°ä½ï¼Œå³ä½¿æ‚¨çš„ä¸»ä½“åº”ç”¨(containing app)ä»…é’ˆå¯¹iPadè®¾å¤‡ç³»åˆ—ï¼Œæ‚¨æ‰€åŒ…å«çš„åº”ç”¨æ‰©å±•ç¨‹åºä¹Ÿä¼šä»¥å…¼å®¹æ¨¡å¼è¿è¡Œæ˜¾ç¤ºåœ¨çš„iPhoneåº”ç”¨ä¸­ã€‚ é‡è¦è¦é€šè¿‡App Reviewï¼Œæ‚¨å¿…é¡»å°†â€œiPhone / iPadâ€ï¼ˆæœ‰æ—¶ç§°ä¸º*universal)*ï¼‰æŒ‡å®šä¸ºåº”ç”¨æ‰©å±•ç¨‹åºçš„ç›®æ ‡è®¾å¤‡ç³»åˆ—ï¼Œæ— è®ºæ‚¨ä¸ºä¸»ä½“åº”ç”¨(containing app)é€‰æ‹©å“ªä¸ªç›®æ ‡è®¾å¤‡ç³»åˆ—ã€‚ åœ¨ä»¥åçš„iOSæ›´æ–°ä¸­ï¼Œåº”ç”¨æ‰©å±•ç¨‹åºä»…åœ¨æ‰©å±•ç¨‹åºä¸»ä½“åº”ç”¨æœ¬æœºæ”¯æŒçš„è®¾å¤‡ï¼ˆæˆ–è®¾å¤‡å…¼å®¹æ¨¡å¼ï¼‰ä¸Šè¿è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨å…¼å®¹æ¨¡å¼ä¸‹ä½¿ç”¨iPhoneåº”ç”¨ç¨‹åºæ—¶ï¼Œåœ¨åªæœ‰iPadçš„ä¸»ä½“åº”ç”¨(containing app)æä¾›çš„æ‰©å±•ç¨‹åºå°†ä¸å¯è§ã€‚ä¸ºç¡®ä¿è·å¾—æœ€ä½³ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å»ºè®®æ‚¨çš„ä¸»ä½“åº”ç”¨(containing app)å’Œå…¶åº”ç”¨æ‰©å±•ç¨‹åºæ˜¯é€šç”¨çš„ã€‚ è°ƒè¯•ï¼Œé…ç½®å’Œæµ‹è¯•ä½ çš„åº”ç”¨æ‰©å±• æ³¨æ„ï¼šè¦ç¡®ä¿ä¸»ä½“åº”ç”¨ä¸­çš„æ‰€æœ‰æ‰©å±•éƒ½è¦ä½¿ç”¨ç›¸åŒç­¾åæ–¹å¼çš„ä»£ç ã€‚Xcodeé¡¹ç›®ä¸­çš„æ‰€æœ‰targetéƒ½å¿…é¡»ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œä»£ç ç­¾åã€‚ä¾‹å¦‚ï¼Œåœ¨æµ‹è¯•æœŸé—´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸´æ—¶ä»£ç ç­¾åæˆ–ä½¿ç”¨å¼€å‘äººå‘˜è¯ä¹¦ï¼Œä½†å¿…é¡»å¯¹é¡¹ç›®ä¸­çš„æ‰€æœ‰targetä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚è¦æäº¤åˆ°App Storeï¼Œè¯·ä½¿ç”¨æ‚¨çš„åˆ†å‘è¯ä¹¦æ¥è·å–æ‰€æœ‰ç›®æ ‡ã€‚ ä½¿ç”¨ Xcode è°ƒè¯•åº”ç”¨æ‰©å±•å’Œè°ƒè¯•å…¶ä»–ç¨‹åºåŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼Œä½†å”¯ä¸€ç‚¹ä¸åŒçš„æ˜¯ï¼šä½ è¦é€‰æ‹©ä¸€ä¸ªèƒ½è®¿é—®æ‰©å±•çš„è½½ä½“åº”ç”¨ã€‚å½“ä½ ç¼–è¯‘è¿è¡Œåº”ç”¨æ‰©å±•åï¼ŒXcode ä¼šè¿è¡Œè½½ä½“åº”ç”¨ï¼Œç­‰å¾…ä½ å»ä½¿ç”¨æ‰©å±•å¹¶è§¦å‘è°ƒè¯•ç‚¹æ¥è°ƒè¯•æ‰©å±•ã€‚ä½ è¦åœ¨ scheme ä¸­è¦ä¸ºæ‰©å±•æŒ‡å®šä¸€ä¸ªè½½ä½“åº”ç”¨ï¼ˆä¸€ä¸ª scheme å°è£…äº† Target ç¼–è¯‘çš„è¯´æ˜ï¼‰ã€‚ å½“ä½ åœ¨ä¸»ä½“åº”ç”¨å·¥ç¨‹ä¸­æ·»åŠ ä¸€ä¸ªåº”ç”¨æ‰©å±•çš„Targetæ—¶ï¼ŒXcode å°±ä¼šä¸ºåº”ç”¨æ‰©å±•é»˜è®¤åˆ›å»ºä¸€ä¸ª schemeã€‚åº”ç”¨æ‰©å±•çš„ scheme å¯ä»¥è®©ä½ æŒ‡å®šåœ¨è°ƒè¯•æ—¶ç”±å“ªä¸ªåº”ç”¨ç¨‹åºæ¥è°ƒç”¨ä½ çš„æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šä¸€ä¸ªè°ƒè¯•æ—¶çš„è½½ä½“åº”ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½ ç¼–è¯‘è¿è¡Œæ‰©å±•æ—¶ï¼Œä¼šè¯¢é—®ä½ ä½¿ç”¨å“ªä¸ªè½½ä½“åº”ç”¨æ¥è°ƒç”¨è¯¥æ‰©å±•ã€‚ åœ¨ä½ ç¼–è¯‘è¿è¡Œåº”ç”¨æ‰©å±•ä¹‹å‰ï¼Œä½ è¦ç¡®ä¿ä½ çš„æ‰©å±•å·²ç»é€‰æ‹©äº†ä¸€ä¸ª schemeã€‚ä½ å¯ä»¥é€šè¿‡ Product &gt; Scheme &gt; MyExtensionName æˆ–è€…ä½¿ç”¨ Xcode èœå•æ å‘¼å‡º scheme èœå•å¹¶é€‰æ‹© MyExtensionName æ¥è®¾ç½®åº”ç”¨æ‰©å±•çš„ schemeã€‚ æ³¨æ„ï¼šå¦‚æœä½ è¿è¡Œä¸»ä½“åº”ç”¨çš„ scheme ä»£æ›¿åº”ç”¨æ‰©å±•çš„ schemeï¼Œé‚£ä¹ˆä½ åœ¨ç¼–è¯‘å·¥ç¨‹æ—¶Xcodeä¼šå‘Šè¯‰ä½ å®ƒæ­£åœ¨ç­‰å¾…è°ƒè¯•åº”ç”¨æ‰©å±•ã€‚ å½“ä½ ç¼–è¯‘è¿è¡Œåº”ç”¨æ‰©å±•æ—¶ï¼ŒXcodeä¼šä¸ºä½ åˆ—å‡ºå…è®¸è°ƒç”¨è¯¥æ‰©å±•çš„è½½ä½“åº”ç”¨ç¨‹åºã€‚å½“ä½ é€‰æ‹©ä¸€ä¸ªè½½ä½“åº”ç”¨ç¨‹åºå¹¶ä¸”è¿è¡Œåï¼Œè°ƒè¯•å™¨å°±å‡†å¤‡å¼€å§‹å·¥ä½œäº†ï¼Œå¹¶å‡†å¤‡å¥½åœ¨ä½ æ‰“çš„æ–­ç‚¹å¤„è¿›è¡Œæ‹¦æˆªã€‚å½“ä½ åœ¨è½½ä½“åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ‰©å±•æ—¶ï¼Œå°±å¯ä»¥å¯¹åº”ç”¨æ‰©å±•è¿›è¡ŒDebugè°ƒè¯•äº†ã€‚è°ƒè¯•åº”ç”¨æ‰©å±•çš„æ–¹å¼å’Œä½¿ç”¨Xcodeè°ƒè¯•å…¶ä»–è¿›ç¨‹ä¸€æ ·ã€‚ åœ¨OS Xä¸­ï¼Œä½ åœ¨è½½ä½“åº”ç”¨ç¨‹åºä¸­è®¿é—®æ‰©å±•ä¹‹å‰ï¼Œè¦ç¡®ä¿è¯¥æ‰©å±•æ˜¯å…è®¸è¢«ä½¿ç”¨çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨System Preferencesçš„æ‰©å±•é¢æ¿ä¸­å¼€å¯æˆ–å…³é—­æ‰©å±•ï¼ˆä½ ä¹Ÿå¯ä»¥åœ¨å…±äº«æˆ–Actionèœå•ä¸­æ‰“å¼€åº”ç”¨æ‰©å±•é¢æ¿ï¼‰ã€‚è¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨ OS X ä¸­ä½¿ç”¨ Widget æ¨¡æ‹Ÿå™¨è°ƒè¯• Widgetæ‰©å±•æ—¶ï¼Œæ˜¯ä¸éœ€è¦å¯¹å…¶è¿›è¡Œå¼€å¯æ“ä½œçš„ã€‚å½“ä½ è¦è°ƒè¯•é”®ç›˜æ‰©å±•æ—¶ï¼Œå¿…é¡»è¦å¼€å¯è¯¥æ‰©å±•ï¼ˆä½ å¯ä»¥é€šè¿‡Settings &gt; General &gt; Keyboard &gt; Keyboardså¼€å¯é”®ç›˜æ‰©å±•ï¼‰ã€‚ åœ¨è°ƒè¯•æ—¶ï¼ŒXcodeä¼šåœ¨OS Xä¸­åˆ›å»ºä¸€ä¸ªæŒç»­çš„ç¼–è¯‘åº”ç”¨æ‰©å±•çš„ä¼šè¯ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ è¦ä½¿ç”¨OS Xç³»ç»Ÿä¸‹çš„æ‰©å±•ï¼Œä½ éœ€è¦ä½¿ç”¨FinderæŠŠå®ƒä»æ„å»ºå¤„æ‹·è´åˆ°ç±»ä¼¼ Applications folderçš„åœ°æ–¹ã€‚ æ³¨æ„ï¼šåœ¨Xcodeçš„è°ƒè¯•æ§åˆ¶å°æ—¥å¿—ä¸­ï¼Œåº”ç”¨æ‰©å±•çš„äºŒè¿›åˆ¶å€¼å¯èƒ½æ˜¯å’Œ CFBundleIdentifier å±æ€§å…³è”ï¼Œè€Œä¸æ˜¯ CFBundleDisplayName å±æ€§ã€‚ ç”±äºåº”ç”¨æ‰©å±•å¿…é¡»å…·æœ‰å“åº”æ€§å’Œé«˜æ•ˆæ€§ï¼Œå› æ­¤å½“è¿è¡Œåº”ç”¨æ‰©å±•æ—¶ï¼Œæœ€å¥½åœ¨è°ƒè¯•å¯¼èˆªå™¨ä¸­æŸ¥çœ‹è°ƒè¯•æŒ‡æ ‡( the debug gauges)ã€‚è°ƒè¯•æŒ‡æ ‡æ˜¾ç¤ºæ‰©å±•åœ¨è¿è¡Œæ—¶å¦‚ä½•ä½¿ç”¨CPUï¼Œå†…å­˜å’Œå…¶ä»–ç³»ç»Ÿèµ„æºã€‚å½“ä½ å‘ç°ç±»ä¼¼å ç”¨CPUèµ„æºå‡ºç°å¼‚å¸¸çš„æ€§èƒ½é—®é¢˜æ—¶ï¼Œä¾‹å¦‚CPUä½¿ç”¨ç‡å‡ºç°å¼‚å¸¸é«˜å³°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Instrumentsæ¥åˆ†ææ‚¨çš„æ‰©å±•ï¼Œå¹¶ç¡®å®šéœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚é€šè¿‡åœ¨ä»»ä½•è°ƒè¯•ä»ªè¡¨æŠ¥å‘Šä¸­å•å‡»Instrumentsä¸­çš„é…ç½®æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨è°ƒè¯•ä¼šè¯æœŸé—´æ‰“å¼€Instrumentsï¼ˆè¦æŸ¥çœ‹è°ƒè¯•ä»ªæŠ¥å‘Šï¼Œè¯·å•å‡»è°ƒè¯•åŒºåŸŸä¸­çš„ä»ªè¡¨ï¼‰ã€‚æƒ³å­¦ä¹ äº†è§£è°ƒè¯•ç›‘æ§å™¨ï¼Œè¯·æŸ¥é˜…Debug Your Appï¼›æƒ³å­¦ä¹ äº†è§£Instrumentsï¼Œè¯·æŸ¥é˜…Instruments User Guideã€‚ æ³¨æ„ï¼šåœ¨Xcodeä¸­é€‰æ‹© Product &gt; Profileå¯ä»¥ç›´æ¥åœ¨Instrumentsä¸­ç¼–è¯‘å¹¶è¿è¡Œåº”ç”¨æ‰©å±•ã€‚Instrumentsä½¿ç”¨æ–¹æ¡ˆçš„Profileéƒ¨åˆ†ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶é›†ä½œä¸ºæ‰©å±•çš„è½½ä½“ã€‚ å¦‚æœè¦ä½¿ç”¨Xcodeæä¾›çš„æµ‹è¯•æ¡†æ¶ï¼ˆæ¯”å¦‚XCTest APIsï¼‰æµ‹è¯•åº”ç”¨æ‰©å±•ï¼Œä½ éœ€è¦åœ¨ä¸»ä½“åº”ç”¨ç¨‹åºä¸­å†™ä¸€äº›æµ‹è¯•ç”¨ä¾‹ä»£ç ã€‚æƒ³äº†è§£æ›´å¤šXCTestçš„çŸ¥è¯†ï¼Œè¯·å‚é˜…Testing with Xcodeã€‚ åˆ†å‘æ‰©å±•ä¸»ä½“åº”ç”¨ç¨‹åºä½ æ— æ³•ç›´æ¥å°†åº”ç”¨æ‰©å±•ä¸Šä¼ è‡³App Storeï¼Œé™¤éå®ƒåŒ…å«åœ¨ä¸»ä½“åº”ç”¨ç¨‹åºä¸­ï¼Œå¹¶ä¸”ä½ ä¸èƒ½å°†åº”ç”¨æ‰©å±•ä»ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­è½¬åˆ°å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ å¦‚æœæƒ³è®©ç”¨æˆ·ä½¿ç”¨ä½ çš„åº”ç”¨æ‰©å±•ï¼Œä½ å¿…é¡»æäº¤ä¸€ä¸ªä¸»ä½“åº”ç”¨ç¨‹åºåˆ°App Storeä¸­ï¼Œå¹¶ä¸”ä¸»ä½“åº”ç”¨ç¨‹åºå¦‚è¦æœ‰å…¶ä»–çš„åŠŸèƒ½ï¼Œä¸èƒ½åªåŒ…å«åº”ç”¨æ‰©å±•ã€‚ å¦‚æœä½ æƒ³æäº¤ OS X åº”ç”¨ç¨‹åºæ‰©å±•ï¼Œæ¨èä½ å°†ä¸»ä½“åº”ç”¨ç¨‹åºæäº¤è‡³App Storeï¼Œä½†è¿™ä¹Ÿä¸æ˜¯å”¯ä¸€çš„é€”å¾„ã€‚åœ¨OS Xä¸­ï¼Œä¸»ä½“åº”ç”¨ç¨‹åºå°±å¯ä»¥åªåŒ…å«åº”ç”¨æ‰©å±•ï¼Œè€Œä¸éœ€è¦æä¾›æ‰©å±•å¤–çš„å…¶ä»–åŠŸèƒ½ã€‚ æ³¨æ„ï¼šå¦‚æœä½ ä¸ä½¿ç”¨App Storeæ¥å°†ä¸»ä½“åº”ç”¨ç¨‹åºå’ŒOS X æ‰©å±•äº¤ä»˜ç»™ç”¨æˆ·ï¼Œé‚£ä¹ˆåœ¨ä¸»ä½“åº”ç”¨ç¨‹åºé€šè¿‡å®¡æ ¸å‰ï¼ŒGatekeeperæ˜¯ä¸ä¼šå…è®¸åº”ç”¨æ‰©å±•ç”Ÿæ•ˆçš„ã€‚åŒæ—¶ï¼Œå¦‚æœä½ ä¸å°†ä¸»ä½“åº”ç”¨ç¨‹åºä¸Šä¼ è‡³App Storeï¼Œé‚£ä¹ˆè¯¥ä¸»ä½“åº”ç”¨ç¨‹åºä¹Ÿä¸èƒ½ç­¾ç½²ä½ çš„å¼€å‘è€…IDåç§°ï¼Œæ‰€ä»¥ç”¨æˆ·å¿…é¡»æ˜ç¡®ä»ä¸»ä½“åº”ç”¨ç¨‹åºä¸­é‡è½½Gatekeeperï¼Œæ‰å¯ä»¥è®©åº”ç”¨æ‰©å±•ç”Ÿæ•ˆã€‚ å¸¸è§é—®é¢˜çš„å¤„ç†æ–¹æ¡ˆå½“ç¼–å†™è‡ªå®šä¹‰ä»£ç ä»¥æ‰§è¡Œappæ‰©å±•ä»»åŠ¡æ—¶ï¼Œä½ å¯èƒ½éœ€è¦å¤„ç†ä¸€äº›å…¶ä»–å¤šç§ç±»å‹æ‰©å±•ä¹Ÿä¼šå‡ºç°çš„æƒ…å†µã€‚åœ¨è¿™ä¸€ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¸®åŠ©ä½ å¦‚ä½•åº”å¯¹å’Œå¤„ç†è¿™äº›å¸¸è§çš„é—®é¢˜ã€‚ ä½¿ç”¨å†…åµŒæ¡†æ¶å…±äº«ä»£ç ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå†…åµŒæ¡†æ¶ï¼Œç”¨äºåœ¨åº”ç”¨æ‰©å±•å’Œå®ƒçš„ä¸»åº”ç”¨ç¨‹åºï¼ˆcontaining appï¼‰ä¹‹é—´å…±äº«ä»£ç ã€‚æ¯”å¦‚ï¼Œä½ åœ¨ç…§ç‰‡ç¼–è¾‘æ‰©å±•ä¸­å¼€å‘äº†å›¾ç‰‡æ»¤é•œåŠŸèƒ½ï¼Œé‚£ä¹ˆåŒæ—¶è¯¥æ‰©å±•çš„ä¸»åº”ç”¨ç¨‹åºcontaining appä¹Ÿæœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†å®ç°è¯¥åŠŸèƒ½çš„ä»£ç å°è£…æˆä¸€ä¸ªæ¡†æ¶ï¼Œå¹¶åœ¨æ‰©å±•targetå’Œä¸»åº”ç”¨ç¨‹åºtargetä¸­åµŒå…¥è¿™ä¸ªæ¡†æ¶ã€‚ ä½ è¦ç¡®ä¿ä½ åˆ›å»ºçš„å†…åµŒæ¡†æ¶ä¸åŒ…å«åº”ç”¨æ‰©å±•ä¸èƒ½ä½¿ç”¨çš„APIã€‚è¿™ç±»APIä¸€èˆ¬ä½¿ç”¨unavailabilityå®æ¥æ ‡è®°ï¼Œæ¯”å¦‚åƒ NS_EXTENSION_UNAVAILABLEã€‚ å¦‚æœä½ åˆ›å»ºçš„å†…åµŒæ¡†æ¶ä¸­åŒ…å«åº”ç”¨æ‰©å±•ä¸èƒ½ä½¿ç”¨çš„APIï¼Œä½ å¯å°†å…¶å®‰å…¨åœ°Linkåˆ°containing appï¼Œå®ƒå¯ä»¥æ­£å¸¸ä½¿ç”¨æ¡†æ¶ä¸­çš„APIï¼Œä½†æ˜¯ä¸èƒ½ä¸åº”ç”¨æ‰©å±•å…±äº«ä»£ç ï¼ˆè¯‘è€…æ³¨ï¼šä¹Ÿå°±æ˜¯åº”ç”¨æ‰©å±•ä¸èƒ½ä½¿ç”¨è¯¥æ¡†æ¶æä¾›çš„æ‰€æœ‰APIï¼Œç»§è€Œæ— æ³•åšåˆ°ä»£ç å…±äº«ï¼‰ã€‚å¦‚æœä½ ä¸Šä¼ App Storeçš„åº”ç”¨æ‰©å±•ä¸­æœ‰è¿™ç§æ¡†æ¶ï¼Œæˆ–è€…å…¶ä»–éƒ¨åˆ†ä½¿ç”¨äº†ä¸å¯ç”¨çš„APIï¼Œé‚£ä¹ˆå®¡æ ¸æ—¶ä¼šè¢«æ‹’ç»ã€‚ å¦‚æœæˆ‘ä»¬è¦æƒ³åº”ç”¨æ‰©å±•ä½¿ç”¨å†…åµŒæ¡†æ¶ï¼Œé‚£ä¹ˆé¦–å…ˆè¦é…ç½®ä¸€ä¸‹ã€‚å°†targetçš„Require Only App-Extension-Safe APIé€‰é¡¹è®¾ç½®ä¸ºYesã€‚å¦‚æœä½ ä¸è¿™æ ·è®¾ç½®ï¼Œé‚£ä¹ˆXcodeä¼šå‘ä½ æç¤ºè­¦å‘Šï¼šlinking against dylib not safe for use in application extensionsã€‚ é‡è¦æç¤ºï¼šå¦‚æœcontaining appè¦é“¾æ¥è‡³å†…åµŒæ¡†æ¶ï¼Œé‚£ä¹ˆå¿…é¡»è¦æ”¯æŒarm64æ¶æ„ï¼Œå¦åˆ™åœ¨ä¸Šä¼ App Storeæ—¶ä¼šè¢«æ‹’ç»ã€‚ï¼ˆå¦‚â€œåˆ›å»ºåº”ç”¨æ‰©å±•â€ç« èŠ‚ä¸­ä»‹ç»çš„ï¼Œæ‰€æœ‰åº”ç”¨æ‰©å±•éƒ½è¦æ”¯æŒarm64æ¶æ„ã€‚ï¼‰ åœ¨é…ç½®é…ç½®Xcodeé¡¹ç›®æ—¶ï¼Œå¿…é¡»åœ¨Copy Filesç¼–è¯‘é˜¶æ®µé€‰æ‹©â€œFrameworksâ€ä½œä¸ºå†…åµŒæ¡†æ¶çš„ç›®æ ‡ã€‚ é‡è¦æç¤ºï¼šæˆ‘ä»¬é€šå¸¸è¦é€‰æ‹© Frameworks ä½œä¸º Copy Files ç¼–è¯‘é˜¶æ®µç›®æ ‡ã€‚å¦‚æœä½ å°†å…¶è®¾ç½®ä¸º SharedFrameworkï¼Œé‚£ä¹ˆä¸Šä¼ App Storeæ—¶ä¼šè¢«æ‹’ç»çš„ã€‚ ä½ å¯ä»¥è®©containing appæ”¯æŒiOS7æˆ–æ›´æ—©çš„ç‰ˆæœ¬ï¼Œä½†å½“åœ¨iOS8æˆ–æ›´æ–°çš„ç‰ˆæœ¬ä¸­è¿è¡Œæ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„å†…åµŒæ¡†æ¶çš„å®‰å…¨æ€§ã€‚è¯¦ç»†å†…å®¹å¯ä»¥å‚é˜… Deploying a Containing App to Older Versions of iOSã€‚ æœ‰å…³åˆ›å»ºå’Œä½¿ç”¨å†…åµŒæ¡†æ¶çš„æ›´å¤šå†…å®¹ï¼Œè¯·è§‚çœ‹WWDC 2014çš„è§†é¢‘â€œBuilding Modern Frameworksâ€ã€‚ ä¸Containing Appå…±äº«æ•°æ®åº”ç”¨æ‰©å±•å’Œå®ƒçš„containing appçš„å®‰å…¨åŸŸæ˜¯æœ‰åŒºåˆ«çš„ã€‚å³ä¾¿æ‰©å±•åŒ…æ˜¯åµŒå¥—åœ¨containing appåŒ…ä¸­çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨æ‰©å±•å’Œcontaining appæ˜¯ä¸èƒ½ç›´æ¥è®¿é—®å¯¹æ–¹çš„å®¹å™¨çš„ã€‚ BACKGROUND è¦äº†è§£å®¹å™¨ï¼Œé˜…è¯» About the iOS File System ä¸­çš„ File System Programming Guid. ä¸è¿‡ä½ å¯ä»¥é€šè¿‡æ•°æ®å…±äº«æ¥å®ç°è¿™ä¸ªæ„¿æœ›ã€‚æ¯”å¦‚ï¼Œä½ å¸Œæœ›åº”ç”¨æ‰©å±•å’Œå®ƒçš„containing appå…±äº«ä¸€ä¸ªå•ä¸€çš„å¤§æ•°æ®é›†ã€‚æ¯”å¦‚prerendered assetsã€‚ è¦å®ç°æ•°æ®å…±äº«ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨Xcodeæˆ–è€…å¼€å‘è€…é—¨æˆ·ç½‘ç«™å…è®¸åº”ç”¨æ‰©å±•å’Œå®ƒçš„containing appæˆä¸ºä¸€ä¸ªåº”ç”¨ç»„ï¼Œç„¶ååœ¨å¼€å‘è€…é—¨æˆ·ç½‘ç«™ä¸­æ³¨å†Œåº”ç”¨ç»„ï¼Œå¹¶æŒ‡æ˜åœ¨containing appä¸­ä½¿ç”¨è¯¥åº”ç”¨ç»„ã€‚å…³äºåº”ç”¨ç»„çš„çŸ¥è¯†è¯·æŸ¥é˜… Entitlement Key Reference æ–‡æ¡£çš„ Adding an App to an App Group ç« èŠ‚ã€‚ å½“ä½ è®¾ç½®å¥½åº”ç”¨ç»„åï¼Œåº”ç”¨æ‰©å±•å’Œå®ƒçš„containing appå°±å¯ä»¥é€šè¿‡ NSUserDefaults APIå…±äº«è®¿é—®ç”¨æˆ·çš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ initWithSuiteName: æ–¹æ³•å®ä¾‹åŒ–ä¸€ä¸ª NSUserDefaults å¯¹è±¡ï¼Œç„¶åä¼ å…¥å…±äº«ç»„çš„æ ‡ç¤ºç¬¦ã€‚æ¯”å¦‚ä¸€ä¸ªå…±äº«æ‰©å±•ï¼Œå®ƒæˆ–è®¸ä¼šæ›´æ–°ç”¨æˆ·æœ€è¿‘ç»å¸¸ä½¿ç”¨çš„å…±äº«è´¦å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥å†™ï¼š // Create and share access to an NSUserDefaults object. NSUserDefaults *mySharedDefaults = [[NSUserDefaults alloc] initWithSuiteName:@"com.example.domain.MyShareExtension"]; // Use the shared user defaults object to update the user's account. [mySharedDefaults setObject:theAccountName forKey:@"lastAccountName"]; ä¸‹å›¾å‘æˆ‘ä»¬å±•ç¤ºäº†åº”ç”¨æ‰©å±•å’Œå®ƒçš„containing appæ˜¯å¦‚ä½•é€šè¿‡å…±äº«å®¹å™¨å®ç°æ•°æ®å…±äº«çš„. Figure 4-1åº”ç”¨æ‰©å±•çš„å®¹å™¨ä¸å…¶containing appçš„å®¹å™¨æ˜¯ä¸åŒçš„ã€‚ é‡è¦æç¤ºï¼šå¦‚æœä½ çš„åº”ç”¨æ‰©å±•ä½¿ç”¨NSURLSessionç±»æ‰§è¡Œåå°çš„ä¸Šä¼ ä¸‹è½½ä»»åŠ¡æ—¶ï¼Œä½ å¿…é¡»è¦è®¾ç½®ä¸€ä¸ªå…±äº«å®¹å™¨ï¼Œè¿™æ ·æ‰©å±•å’Œcontaining appå°±å¯ä»¥è®¿é—®åˆ°è½¬æ¢ä¼ è¾“çš„æ•°æ®ã€‚åå°ä¸Šä¼ ä¸‹è½½çš„æ›´å¤šçŸ¥è¯†è¯·å‚é˜… Performing Uploads and Downloadsã€‚ å¦‚æœä½ è®¾ç½®äº†å…±äº«å®¹å™¨ï¼Œé‚£ä¹ˆcontaining appå’Œå®ƒåŒ…å«çš„å…è®¸å‚ä¸æ•°æ®åˆ†äº«çš„æ‰©å±•å°±å¯ä»¥å¯¹å…±äº«å®¹å™¨é‡Œçš„å†…å®¹è¿›è¡Œè¯»å†™æ“ä½œäº†ã€‚åŒæ—¶ä½ è¿˜å¿…é¡»è¦å¯¹æ•°æ®çš„æ“ä½œè¿›è¡ŒåŒæ­¥ï¼Œä»¥é¿å…æ•°æ®æŸåæˆ–å‡ºé”™ã€‚ä½¿ç”¨UIDocumentç±»ã€Core Dataæˆ–è€…SQLiteå¯ä»¥å¸®ä½ å¯ä»¥è®©ç”¨æˆ·é€šè¿‡è¦æ±‚Safariè¿è¡ŒJSæ–‡ä»¶æ¥è®¿é—®ç½‘ç»œå†…å®¹ï¼Œå¹¶å°†ç»“æœè¿”å›åˆ°æ‰©å±•ã€‚ ç‰ˆæœ¬è¯´æ˜åœ¨iOS 8.2åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨UIDocumentè¯¥ç±»æ¥åè°ƒå…±äº«æ•°æ®è®¿é—®ã€‚åœ¨iOS 9åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œæ‚¨å¯ä»¥NSFileCoordinatorç›´æ¥ä½¿ç”¨è¯¥ç±»è¿›è¡Œå…±äº«æ•°æ®è®¿é—®ï¼Œä½†æ˜¯å¦‚æœæ‚¨è¿™æ ·åšï¼Œåˆ™å¿…é¡»NSFilePresenteråœ¨åº”ç”¨æ‰©å±•è½¬æ¢ä¸ºåå°æ—¶åˆ é™¤å¯¹è±¡ã€‚ è®¿é—®ç½‘é¡µåœ¨åˆ†äº«æ‰©å±•ï¼ˆiOSä¸OS Xå¹³å°ï¼‰å’ŒActionæ‰©å±•ï¼ˆiOSå¹³å°ï¼‰ä¸­ï¼Œä¸€èˆ¬éƒ½å…è®¸ç”¨æˆ·ä½¿ç”¨Safariæµè§ˆå™¨è®¿é—®ç½‘é¡µå¹¶é€šè¿‡æ‰§è¡ŒJavaScriptè„šæœ¬ï¼Œå¹¶å°†ç»“æœè¿”å›åˆ°æ‰©å±•ä¸­ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ä½ çš„æ‰©å±•è¿è¡Œä¹‹å‰ï¼ˆé€‚ç”¨äºä¸¤ä¸ªå¹³å°ï¼‰æˆ–æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼ˆä»…é€‚ç”¨äºiOSå¹³å°ï¼‰é€šè¿‡JavaScriptæ–‡ä»¶ä¿®æ”¹ç½‘é¡µå†…å®¹ã€‚æ¯”å¦‚åˆ†äº«æ‰©å±•ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·åˆ†äº«ç½‘é¡µä¸Šçš„å†…å®¹ï¼Œæˆ–è€…iOSä¸Šçš„Actionæ‰©å±•å¯èƒ½ä¼šæ˜¾ç¤ºå½“å‰ç½‘é¡µçš„æŒ‡å®šç¿»è¯‘å†…å®¹ã€‚ å¦‚æœæƒ³æ·»åŠ ç½‘é¡µè®¿é—®å’Œæ“ä½œåº”ç”¨æ‰©å±•ï¼Œé‚£ä¹ˆéœ€è¦éµå¾ªä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š1.åˆ›å»ºä¸€ä¸ªJavaScriptæ–‡ä»¶ï¼Œå¹¶ç”³æ˜ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œå‘½åä¸º ExtensionPreprocessingJSï¼Œå¹¶ä¸ºè¯¥å¯¹è±¡åˆ†é…ä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰JavaScriptç±»çš„å®ä¾‹ã€‚2.åœ¨åº”ç”¨æ‰©å±•çš„å±æ€§åˆ—è¡¨æ–‡ä»¶ä¸­æ·»åŠ å…³é”®å­— NSExtensionJavaScriptPreprocessingFileï¼Œç»™ Safari æµè§ˆå™¨æŒ‡æ˜ä½¿ç”¨å“ªä¸ª JavaScript æ–‡ä»¶ã€‚3.åœ¨NSExtensionActivationRuleå­—å…¸ä¸­ï¼Œå°†NSExtensionActivationSupportsWebURLWithMaxCount èµ‹å€¼ä¸€ä¸ªéé›¶çš„å€¼ã€‚ï¼ˆæ›´å¤šå…³äº NSExtensionActivationRule å­—å…¸çš„çŸ¥è¯†è¯·å‚é˜… Declaring Supported Data Types for a Share or Action Extensionã€‚ï¼‰4.å½“ä½ çš„åº”ç”¨æ‰©å±•å¼€å§‹è¿è¡Œæ—¶ï¼Œä½¿ç”¨NSItemProviderç±»è·å¾—è¿è¡ŒJavaScriptæ–‡ä»¶æ‰€è¿”å›çš„ç»“æœã€‚5.åœ¨iOSç³»ç»Ÿçš„åº”ç”¨æ‰©å±•ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›Safariåœ¨æ‰©å±•æ‰§è¡Œå®Œä»»åŠ¡åæ›´æ–°ç½‘é¡µï¼Œé‚£ä¹ˆä½ è¦å‘JavaScriptæ–‡ä»¶ä¸­ä¼ å…¥å€¼ã€‚ï¼ˆåœ¨è¿™ä¸€æ­¥ä¸­ä¹Ÿä½¿ç”¨NSItemProviderç±»ã€‚ï¼‰ ä¸ºäº†å‘ŠçŸ¥Safariä½ çš„åº”ç”¨æ‰©å±•ä¸­åŒ…å«ä¸€ä¸ªJavaScriptæ–‡ä»¶ï¼Œä½ éœ€è¦åœ¨åº”ç”¨æ‰©å±•çš„Info.plistæ–‡ä»¶ä¸­ï¼Œå‘NSExtensionAttributeså­—å…¸æ·»åŠ NSExtensionJavaScriptPreprocessingFileå…³é”®å­—æ¥æŒ‡æ˜ä½ çš„JavaScriptæ–‡ä»¶ã€‚è¿™ä¸ªé”®çš„å€¼å°±æ˜¯ä½ å¸Œæœ›å½“ä½ çš„åº”ç”¨æ‰©å±•è¿è¡Œå‰ï¼ŒSafariè¦åŠ è½½çš„JavaScriptæ–‡ä»¶çš„åç§°ã€‚æ¯”å¦‚ï¼š &lt;key>NSExtensionAttributes&lt;/key> &lt;dict> &lt;key>NSExtensionJavaScriptPreprocessingFile&lt;/key> &lt;string>MyJavaScriptFile&lt;/string> &lt;!-- Do not include the ".js" filename extension --> &lt;/dict> åœ¨iOSå’ŒOS Xå¹³å°ä¸­ï¼Œåœ¨ä½ è‡ªå®šä¹‰çš„JavaScriptç±»ä¸­å¯ä»¥å®šä¹‰ä¸€ä¸ªrun()å‡½æ•°ï¼Œè¯¥å‡½æ•°å°±æ˜¯SafariåŠ è½½JavaScriptæ–‡ä»¶çš„å…¥å£ã€‚åœ¨run()å‡½æ•°ä¸­ï¼ŒSafariæä¾›äº†ä¸€ä¸ªåä¸ºcompletionFunctionçš„å‚æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨é”®å€¼å¯¹è±¡çš„å½¢å¼å°†ç»“æœä¼ ç»™åº”ç”¨æ‰©å±•ã€‚ åœ¨iOSå¹³å°ä¸­ï¼Œä½ è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªfinalize()å‡½æ•°ï¼Œå½“åº”ç”¨æ‰©å±•åœ¨ä»»åŠ¡ç»“æŸé˜¶æ®µè°ƒç”¨completeRequestReturningItems:expirationHandler:completion:æ–¹æ³•æ—¶Safariä¼šè°ƒç”¨finalize()å‡½æ•°ã€‚åœ¨è¯¥å‡½æ•°ä¸­ï¼Œå¯ä»¥é€šè¿‡å‘completeRequestReturningItems:expirationHandler:completion:æ–¹æ³•ä¼ å€¼ï¼Œæ¥æ”¹å˜ç½‘é¡µå†…å®¹ã€‚ æ¯”å¦‚ï¼Œä½ çš„iOSåº”ç”¨æ‰©å±•éœ€è¦åŸºäºä¸€ä¸ªç½‘é¡µURIå¯åŠ¨ï¼Œå¹¶ä¸”å½“å®ƒç»“æŸè¿è¡Œæ—¶æ”¹å˜ç½‘é¡µçš„èƒŒæ™¯è‰²ï¼Œé‚£ä¹ˆä½ éœ€è¦è¿™æ ·å†™JavaScriptä»£ç ï¼š æ¸…å•4-1ç¤ºä¾‹run()å’Œfinalize()å‡½æ•° var MyExtensionJavaScriptClass = function() {}; MyExtensionJavaScriptClass.prototype = { run: function(arguments) { // Pass the baseURI of the webpage to the extension. arguments.completionFunction({"baseURI": document.baseURI}); }, // Note that the finalize function is only available in iOS. finalize: function(arguments) { // arguments contains the value the extension provides in [NSExtensionContext completeRequestReturningItems:completion:]. // In this example, the extension provides a color as a returning item. document.body.style.backgroundColor = arguments["bgColor"]; } }; // The JavaScript file must contain a global object named "ExtensionPreprocessingJS". var ExtensionPreprocessingJS = new MyExtensionJavaScriptClass; åœ¨iOSå’ŒOS Xå¹³å°ä¸­ï¼Œä½ éœ€è¦ç¼–å†™ä»£ç æ¥å¤„ç†run()å‡½æ•°è¿”å›çš„å€¼ï¼Œä¸ºè·å–åˆ°å­—å…¸ä¸­çš„å€¼ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®škUTTypePropertyListç±»å‹ä½œä¸ºæ ‡ç¤ºç¬¦ä¼ å…¥NSItemProviderç±»çš„ loadItemForTypeIdentifier:options:completionHandler:æ–¹æ³•ã€‚åœ¨è¯¥å­—å…¸ä¸­ä½¿ç”¨ NSExtensionJavaScriptPreprocessingResultsKeyä½œä¸ºkeyæ¥å–å€¼ã€‚æ¯”å¦‚ä¸‹é¢ä¾‹å­ä¸­æˆ‘ä»¬æƒ³è¦è·å–å°† URI ä¼ å…¥ run()çš„è¿”å›å€¼ï¼š [imageProvider loadItemForTypeIdentifier:kUTTypePropertyList options:nil completionHandler:^(NSDictionary *item, NSError *error) { NSDictionary *results = (NSDictionary *)item; NSString *baseURI = [[results objectForKey:NSExtensionJavaScriptPreprocessingResultsKey] objectForKey:@"baseURI"]; }]; finalize() å‡½æ•°æ˜¯åœ¨å½“åº”ç”¨æ‰©å±•æ‰§è¡Œå®Œä»»åŠ¡åä¼ å‚å¹¶è°ƒç”¨çš„ï¼Œåˆ›å»ºä¸€ä¸ªå«æœ‰æˆ‘ä»¬éœ€è¦å¤„ç†çš„å€¼çš„å­—å…¸ï¼Œç„¶åç”¨NSItemProvider çš„ initWithItem:typeIdentifier:æ–¹æ³•æ¥å°è£…è¯¥å­—å…¸ã€‚æ¯”å¦‚å½“æ‰©å±•æ‰§è¡Œå®Œä»»åŠ¡åæˆ‘ä»¬æƒ³è®©ç½‘é¡µå˜ä¸ºçº¢è‰²ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š NSExtensionItem *extensionItem = [[NSExtensionItem alloc] init]; extensionItem.attachments = @[[[NSItemProvider alloc] initWithItem: @{NSExtensionJavaScriptFinalizeArgumentKey: @{@"bgColor":@"red"}} typeIdentifier:(NSString *)kUTTypePropertyList]]; [[self extensionContext] completeRequestReturningItems:@[extensionItem] completion:nil]; æ‰§è¡Œä¸Šä¼ ä¸‹è½½ä»»åŠ¡ç”¨æˆ·ä¸€èˆ¬çš„æ“ä½œä¹ æƒ¯éƒ½å€¾å‘äºå½“ä½¿ç”¨ä½ çš„åº”ç”¨æ‰©å±•å®ŒæˆæŸä¸ªä»»åŠ¡åï¼Œå¯ä»¥å°†ç»“æœç«‹å³åé¦ˆåœ¨ä½¿ç”¨æ‰©å±•çš„åº”ç”¨ä¸­ã€‚å¦‚æœä¸€ä¸ªæ‰©å±•è¦å¤„ç†çš„ä»»åŠ¡åŒ…å«è¾ƒé•¿æ—¶é—´çš„ä¸Šä¼ ä¸‹è½½æ“ä½œæ—¶ï¼Œä½ è¦ç¡®ä¿å½“ä½ çš„åº”ç”¨æ‰©å±•å…³é—­åèƒ½ç»§ç»­å®Œæˆè¯¥ä»»åŠ¡ã€‚ä¸ºå®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨NSURLSessionç±»åˆ›å»ºä¸€ä¸ªURLä¼šè¯å¹¶åˆ›å»ºåå°çš„ä¸Šä¼ ä¸‹è½½ä»»åŠ¡ã€‚ æç¤ºï¼šä½ å¯ä»¥å›æƒ³ä¸€ä¸‹å…¶ä»–ç±»å‹çš„åå°ä»»åŠ¡ï¼Œæ¯”å¦‚åå°æ”¯æŒVoIPã€åå°æ’­æ”¾éŸ³ä¹ï¼Œè¿™äº›æ˜¯ä¸èƒ½ç”¨åº”ç”¨æ‰©å±•å»å®ç°çš„ã€‚æ›´å¤šä¿¡æ¯è¯·å‚é˜…Respond to the Host Appâ€™s Requestã€‚ å½“ä½ çš„åº”ç”¨æ‰©å±•å‡†å¤‡å¥½ä¸Šä¼ ä¸‹è½½ä»»åŠ¡åï¼Œæ‰©å±•ä¼šå®Œæˆè°ƒç”¨å®ƒçš„åº”ç”¨å‘å‡ºçš„è¯·æ±‚ï¼Œå¹¶åœ¨ä¸å½±å“ä¸Šä¼ ä¸‹è½½ä»»åŠ¡çš„å‰æä¸‹ç»ˆæ­¢æ‰©å±•ã€‚æ›´å¤šå…³äºæ‰©å±•å¤„ç†è½½ä½“åº”ç”¨è¯·æ±‚çš„çŸ¥è¯†è¯·å‚é˜…Respond to the Host Appâ€™s Requestã€‚åœ¨iOSç³»ç»Ÿä¸­ï¼Œå¦‚æœä½ çš„åº”ç”¨æ‰©å±•åœ¨æ‰§è¡Œå®Œåå°ä»»åŠ¡æ—¶å¹¶æ²¡æœ‰åœ¨è¿è¡Œï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨åå°è¿è¡Œæ‰©å±•çš„è½½ä½“åº”ç”¨ï¼Œå¹¶è°ƒç”¨application:handleEventsForBackgroundURLSession:completionHandler: ä»£ç†æ–¹æ³•ã€‚ é‡è¦æç¤ºï¼šå¦‚æœä½ çš„åº”ç”¨æ‰©å±•åœ¨åå°åˆ›å»ºäº† NSURLSession ä»»åŠ¡ï¼Œé‚£ä¹ˆä½ å¿…é¡»è¦è®¾ç½®ä¸€ä¸ªå…±äº«å®¹å™¨ï¼Œä»¥ç¡®ä¿æ‰©å±•å’Œè½½ä½“åº”ç”¨å®ç°æ•°æ®å…±äº«ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ NSURLSessionConfiguration ç±»ä¸­ä½¿ç”¨sharedContainerIdentifierå±æ€§æ¥æŒ‡å®šä¸€ä¸ªå…±äº«å®¹å™¨çš„æ ‡ç¤ºç¬¦ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¯¥æ ‡ç¤ºç¬¦è·å–åˆ°å…±äº«å®¹å™¨ã€‚è¯·å‚é˜… Sharing Data with Your Containing App æ–‡æ¡£æ¥è®¾ç½®å…±äº«å®¹å™¨ã€‚ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•é…ç½®ä¸€ä¸ªURLä¼šè¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä¸‹è½½ä»»åŠ¡ï¼š NSURLSession *mySession = [self configureMySession]; NSURL *url = [NSURL URLWithString:@"http://www.example.com/LargeFile.zip"]; NSURLSessionTask *myTask = [mySession downloadTaskWithURL:url]; [myTask resume]; - (NSURLSession *) configureMySession { if (!mySession) { NSURLSessionConfiguration* config = [NSURLSessionConfiguration backgroundSessionConfigurationWithIdentifier:@â€œcom.mycompany.myapp.backgroundsessionâ€]; // To access the shared container you set up, use the sharedContainerIdentifier property on your configuration object. config.sharedContainerIdentifier = @â€œcom.mycompany.myappgroupidentifierâ€; mySession = [NSURLSession sessionWithConfiguration:config delegate:self delegateQueue:nil]; } return mySession; } å› ä¸ºåœ¨å•ä½æ—¶é—´å†…åªèƒ½ç”±ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨åå°ä¼šè¯ï¼Œæ‰€ä»¥ä½ éœ€è¦ä¸ºè½½ä½“åº”ç”¨ä¸­çš„æ‰€æœ‰æ‰©å±•åˆ›å»ºä¸åŒçš„åå°ä¼šè¯ï¼ˆæ¯ä¸ªåå°ä¼šè¯éƒ½è¦æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡ç¤ºç¬¦ï¼‰ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å»ºè®®å½“è½½ä½“åº”ç”¨åœ¨åå°å¤„ç†æ‰©å±•çš„ä»»åŠ¡æ—¶ï¼Œåªä½¿ç”¨ä¸€ä¸ªè¯¥æ‰©å±•åˆ›å»ºçš„åå°ä¼šè¯ã€‚å¦‚æœä½ è¦æ‰§è¡Œå…¶ä»–çš„ç½‘ç»œç›¸å…³çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±è¦åˆ›å»ºç›¸åº”çš„URLä¼šè¯ã€‚ å¦‚æœä½ éœ€è¦åœ¨åå°åˆ›å»ºURLä¼šè¯ä¹‹å‰å®Œæˆè½½ä½“åº”ç”¨çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¦ç¡®ä¿åˆ›å»ºå’Œä½¿ç”¨ä¼šè¯çš„ä»£ç æ˜¯æœ‰æ•ˆå¯æ‰§è¡Œçš„ã€‚å½“ä½ çš„æ‰©å±•è°ƒç”¨ completeRequestReturningItems:completionHandler: æ–¹æ³•å‘ŠçŸ¥ä¸»å«åº”ç”¨å·²ç»å®Œæˆç›¸å…³è¯·æ±‚åï¼Œç³»ç»Ÿå°±å¯ä»¥éšæ—¶ç»ˆæ­¢ä½ çš„åº”ç”¨æ‰©å±•ã€‚ ä¸ºåˆ†äº«å’ŒActionæ‰©å±•ç”³æ˜æ”¯æŒçš„æ•°æ®ç±»å‹åœ¨ä½ çš„åˆ†äº«æˆ–Actionæ‰©å±•ä¸­ï¼Œåœ¨å®ƒä»¬çš„å·¥ä½œä¸­å¯èƒ½ä¼šä½¿ç”¨åˆ°ä¸€äº›æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®çš„ç±»å‹å„ä¸ç›¸åŒã€‚ä¸ºäº†ç¡®ä¿åªæœ‰å½“ç”¨æˆ·åœ¨è½½ä½“åº”ç”¨ä¸­é€‰æ‹©äº†ä½ çš„æ‰©å±•æ”¯æŒçš„æ•°æ®ç±»å‹æ—¶ï¼Œæ‰ä¼šå±•ç¤ºä½ çš„æ‰©å±•åŠŸèƒ½ã€‚ä½ éœ€è¦åœ¨æ‰©å±•çš„Info.plistå±æ€§åˆ—è¡¨æ–‡ä»¶ä¸­æ·»åŠ  NSExtensionActivationRule å…³é”®å­—ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥å…³é”®å­—æŒ‡å®šæ‰©å±•å¤„ç†æ¯ç§ç±»å‹çš„æœ€å¤§æ•°ç›®ã€‚å½“ä½ çš„åº”ç”¨æ‰©å±•è¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šå°†NSExtensionActivationRuleé”®çš„å€¼ä¸æ‰©å±•é¡¹çš„attachmentså±æ€§ä¸­çš„ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒã€‚å…³äº NSExtensionActivationRule å…³é”®å­—çš„è¯¦ç»†ä¿¡æ¯å¯ä»¥å‚é˜… Action Extension Keysæ–‡æ¡£ä¸­çš„ Information Property List Key Reference ç« èŠ‚ã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥ç”³æ˜ä½ çš„åˆ†äº«æ‰©å±•æ”¯æŒæœ€å¤šå¤„ç†10å¼ å›¾ç‰‡ï¼Œä¸€éƒ¨å½±ç‰‡å’Œä¸€ä¸ªç½‘ç«™URLã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å­—å…¸ä½œä¸ºè¯¥NSExtensionAttributesé”®çš„å€¼ï¼š &lt;key&gt;NSExtensionAttributes&lt;/key&gt; &lt;dict&gt; &lt;key&gt;NSExtensionActivationRule&lt;/key&gt; &lt;dict&gt; &lt;key&gt;NSExtensionActivationSupportsImageWithMaxCount&lt;/key&gt; &lt;integer&gt;10&lt;/integer&gt; &lt;key&gt;NSExtensionActivationSupportsMovieWithMaxCount&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt; &lt;key&gt;NSExtensionActivationSupportsWebURLWithMaxCount&lt;/key&gt; &lt;integer&gt;1&lt;/integer&gt; &lt;/dict&gt; &lt;/dict&gt; å¦‚æœä½ æƒ³æŒ‡å®šä¸æ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°†è¯¥ç±»å‹çš„å€¼è®¾ç½®ä¸º0ï¼Œæˆ–è€…åœ¨ NSExtensionActivationRule ä¸­ä¸æ·»åŠ è¯¥ç±»å‹å³å¯ã€‚ æ³¨æ„ï¼šå¦‚æœä½ çš„åˆ†äº«æ‰©å±•æˆ–iOSä¸­çš„Actionæ‰©å±•éœ€è¦è®¿é—®ç½‘é¡µï¼Œé‚£ä½ å¿…é¡»è¦ç¡®ä¿ NSExtensionActivationSupportsWebURLWithMaxCount å…³é”®å­—çš„å€¼ä¸ä¸º0ï¼ˆæ›´å¤šå…³äºåœ¨åº”ç”¨æ‰©å±•ä¸­é€šè¿‡JavaScriptè®¿é—®ç½‘é¡µçš„å†…å®¹è¯·å‚é˜…Accessing a Webpage ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ NSExtensionItem å®šä¹‰çš„ UTIå­ ç±»å‹ä»¥ä¾¿æ•°æ®æ£€æµ‹å™¨æ£€æµ‹æ–‡æœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚ç”µè¯å·ç æˆ–é€šè®¯åœ°å€ã€‚ NSExtensionActivationRuleå­—å…¸ä¸­çš„é”®è¶³ä»¥æ»¡è¶³å¤§å¤šæ•°åº”ç”¨çš„è¿‡æ»¤éœ€æ±‚ã€‚å¦‚æœä½ éœ€è¦åšæ›´å¤æ‚çš„è¿‡æ»¤ï¼Œæ¯”å¦‚åƒ public.url å’Œ public.image ä¹‹é—´çš„åŒºåˆ«ï¼Œé‚£ä¹ˆä½ å°±å¾—åœ¨æ–‡æœ¬ä¸­åˆ›å»ºæ–­è¨€è¯­å¥ã€‚å¦‚æœä½ è¦åˆ›å»ºä¸€ä¸ªæ–­è¨€ï¼Œé‚£ä¹ˆå°±å°†NSExtensionActivationRuleå…³é”®å­—çš„å€¼è®¾ç½®ä¸ºä½ æŒ‡å®šçš„æ–­è¨€å­—ç¬¦ä¸²ã€‚ï¼ˆåœ¨è¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°†è¯¥å­—ç¬¦ä¸²ç¼–è¯‘ä¸º NSPredicate å¯¹è±¡ æ¯”å¦‚ï¼Œä¸€ä¸ªåº”ç”¨æ‰©å±•çš„é™„ä»¶å±æ€§å¯ä»¥æŒ‡å®šä¸ºPDFæ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š {extensionItems = ({ attachments = ({ registeredTypeIdentifiers = ( &quot;com.adobe.pdf&quot;, &quot;public.file-url&quot; ); }); })} ä¸ºäº†æŒ‡å®šä½ çš„åº”ç”¨æ‰©å±•å¯ä»¥å¤„ç†PDFæ–‡ä»¶ï¼Œä½ å¯ä»¥åƒè¿™æ ·åˆ›å»ºæ–­è¨€å­—ç¬¦ä¸²ï¼š SUBQUERY ( extensionItems, $extensionItem, SUBQUERY ( $extensionItem.attachments, $attachment, ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO &quot;com.adobe.pdf&quot; ).@count == $extensionItem.attachments.@count ).@count == 1 ä»¥ä¸‹æ˜¯æ›´å¤æ‚çš„æ–­è¨€è¯­å¥çš„ç¤ºä¾‹ï¼š SUBQUERY ( extensionItems, $extensionItem, SUBQUERY ( $extensionItem.attachments, $attachment, ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO &quot;org.appextension.action-one&quot; || ANY $attachment.registeredTypeIdentifiers UTI-CONFORMS-TO &quot;org.appextension.action-two&quot; ).@count == $extensionItem.attachments.@count ).@count == 1 æ­¤è¯­å¥éå†ä¸€ä¸ªNSExtensionItemå¯¹è±¡æ•°ç»„ï¼Œå…¶æ¬¡æ˜¯éå†attachmentsæ¯ä¸ªæ‰©å±•é¡¹ä¸­çš„æ•°ç»„ã€‚å¯¹äºæ¯ä¸ªé™„ä»¶ï¼Œè°“è¯è¯„ä¼°é™„ä»¶ä¸­æ¯ä¸ªè¡¨ç¤ºçš„ç»Ÿä¸€ç±»å‹æ ‡è¯†ç¬¦ï¼ˆUTIï¼‰ã€‚å½“é™„ä»¶è¡¨ç¤ºUTIç¬¦åˆä¸¤ä¸ªä¸åŒçš„æŒ‡å®šUTIä¸­çš„ä»»ä½•ä¸€ä¸ªï¼ˆæ‚¨åœ¨æ¯ä¸ªUTI-CONFORMS-TOæ“ä½œå‘˜çš„å³ä¾§çœ‹åˆ°ï¼‰æ—¶ï¼Œæ”¶é›†è¯¥UTIä»¥è¿›è¡Œæœ€ç»ˆæ¯”è¾ƒæµ‹è¯•ã€‚TRUEå¦‚æœåº”ç”¨ç¨‹åºæ‰©å±•åä»…æä¾›äº†ä¸€ä¸ªæ”¯æŒUTIçš„æ‰©å±•é¡¹é™„ä»¶ï¼Œåˆ™è¿”å›æœ€åä¸€è¡Œã€‚ å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåœ¨ä½ åˆ›å»ºæ–­è¨€è¯­å¥ä¹‹å‰ä½ å¯ä»¥ä½¿ç”¨TRUEPREDICATEå¸¸é‡ï¼ˆç»“æœä¸ºtrueï¼‰æµ‹è¯•ä½ çš„ä»£ç è·¯å¾„ã€‚æ›´å¤šæ–­è¨€è¯­å¥çš„è¯­æ³•çŸ¥è¯†è¯·å‚é˜…Predicate Format String Syntaxã€‚ é‡è¦æç¤ºï¼šåœ¨å°†ä½ çš„è½½ä½“åº”ç”¨ä¸Šä¼ App Storeä¹‹å‰ï¼Œè¦ç¡®ä¿æ‰€æœ‰çš„ TRUEPREDICATE å¸¸é‡å·²ç»æ›¿æ¢ä¸ºæŒ‡å®šçš„æ–­è¨€è¯­å¥æˆ– NSExtensionActivationRule å…³é”®å­—ï¼Œä¸ç„¶è½½ä½“åº”ç”¨ä¼šè¢«App Storeæ‹’ç»ã€‚ é…ç½®è½½ä½“åº”ç”¨ä»¥é€‚ç”¨äºè€ç‰ˆæœ¬çš„iOSç³»ç»Ÿå¦‚æœä½ åœ¨ä¸»ä½“åº”ç”¨ä¸­ä½¿ç”¨äº†å†…åµŒæ¡†æ¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥åœ¨iOS8.0ä¹‹åçš„ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼Œå³ä¾¿å†…åµŒæ¡†æ¶ä¸æ”¯æŒè€ç‰ˆæœ¬çš„ç³»ç»Ÿä¹Ÿæ²¡å…³ç³»ã€‚ ä½¿ä¸»ä½“åº”ç”¨èƒ½åšåˆ°ä¸Šè¿°è¿™ä¸€ç‚¹çš„æ˜¯ dlopen å‘½ä»¤ï¼Œå®ƒå¯ä»¥ä½¿ä½ ä½¿ç”¨æ¡ä»¶é“¾æ¥å’ŒåŠ è½½æ¡†æ¶åŒ…çš„æœºåˆ¶ã€‚ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤æ¥ä»£æ›¿ç¼–è¯‘æ—¶é“¾æ¥ï¼Œä½ å¯ä»¥åœ¨ Xcode çš„ General é€‰é¡¹æˆ– Build Phases é€‰é¡¹ä¸­å¯¹è¯¥å‘½ä»¤è¿›è¡Œç¼–è¾‘ã€‚å…¶åŸç†å°±æ˜¯åªæœ‰å½“ä¸»ä½“åº”ç”¨åœ¨ iOS8.0 æˆ–æ›´é«˜çš„ç‰ˆæœ¬ä¸­è¿è¡Œæ—¶ï¼Œæ‰ä¼šé“¾æ¥ä½¿ç”¨å†…åµŒæ¡†æ¶ã€‚ æ‚¨å¿…é¡»åœ¨æœ‰æ¡ä»¶åœ° framework bundleçš„ä»£ç è¯­å¥ä¸­ä½¿ç”¨Objective-Cè€Œä¸æ˜¯Swiftã€‚æ‚¨çš„åº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å¯ä»¥ç”¨ä»»ä½•ä¸€ç§è¯­è¨€ç¼–å†™ï¼Œå†…åµŒæ¡†æ¶æœ¬èº«ä¹Ÿå¯ä»¥ç”¨ä»»ä½•ä¸€ç§è¯­è¨€ç¼–å†™ã€‚ è°ƒç”¨ä¹‹ådlopenï¼Œä½¿ç”¨ä»¥ä¸‹ç±»å‹çš„è¯­å¥è®¿é—®å†…åµŒæ¡†æ¶ç±»ï¼š MyLoadedClass *loadedClass = [[NSClassFromString (@&quot;MyClass&quot;) alloc] init]; é‡è¦æç¤ºï¼šå¦‚æœä½ çš„ä¸»ä½“åº”ç”¨ä½¿ç”¨äº†å†…åµŒæ¡†æ¶ï¼Œé‚£ä¹ˆå°±å¿…é¡»è¦æ”¯æŒarm64æ¶æ„ï¼Œå¦åˆ™ä¼šè¢«App Storeæ‹’ç»ã€‚ è®¾ç½®Xcodeé¡¹ç›®ä¸­åº”ç”¨æ‰©å±•çš„æ¡ä»¶é“¾æ¥ 1.å°†æ¯ä¸€ä¸ªåº”ç”¨æ‰©å±•çš„è¿è¡Œç³»ç»Ÿç‰ˆæœ¬è®¾ç½®ä¸ºiOS8.0æˆ–æ›´é«˜ï¼Œé€šå¸¸é€‰ä¸­Xcodeä¸­çš„targetï¼Œåœ¨Generalé€‰é¡¹ä¸­è®¾ç½®Deployment infoã€‚2.å°†ä½ ä¸»ä½“åº”ç”¨çš„è¿è¡Œç³»ç»Ÿç‰ˆæœ¬è®¾ç½®ä¸ºä½ æƒ³æ”¯æŒçš„æœ€ä½iOSç‰ˆæœ¬ã€‚3.åœ¨ä½ çš„ä¸»ä½“åº”ç”¨ä¸­ï¼Œé€šè¿‡ systemVersion æ–¹æ³•ï¼Œåœ¨è¿è¡Œæ—¶æ£€æŸ¥åˆ¤æ–­iOSçš„ç‰ˆæœ¬ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ‰§è¡Œdlopenå‘½ä»¤ã€‚åªæœ‰ä½ çš„è½½ä½“åº”ç”¨åœ¨iOS8.0æˆ–æ›´é«˜çš„ç‰ˆæœ¬ä¸­è¿è¡Œæ—¶æ‰ä¼šæŒ‡å®šdlopenå‘½ä»¤ã€‚è¿›è¡Œæ­¤è°ƒç”¨æ—¶ï¼Œè¯·åŠ¡å¿…ä½¿ç”¨Objective-Cï¼Œè€Œä¸æ˜¯Swiftã€‚ ç‰¹å®šçš„iOS APIé€šè¿‡dlopenå‘½ä»¤ä½¿ç”¨å†…åµŒæ¡†æ¶ã€‚ä½ å¿…é¡»é€‰æ‹©æ€§çš„ä½¿ç”¨è¿™äº›APIï¼Œå°±åƒä½¿ç”¨ dlopen å‘½ä»¤æ—¶é‚£æ ·ã€‚è¿™äº›APIéƒ½æ˜¯ CFBundleRef çš„å°è£…ç±»å‹ï¼š CFBundleGetFunctionPointerForName CFBundleGetFunctionPointersforNames è¿˜æœ‰æ¥è‡ªNSBundleç±»çš„æ–¹æ³•ï¼š loadloadAndReturnError:classNamed: å› ä¸ºä½ ä¸€èˆ¬ä¼šå°†è½½ä½“åº”ç”¨çš„è¿è¡Œç³»ç»Ÿç‰ˆæœ¬é…ç½®ä¸ºè¾ƒä½çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿™äº›APIé€šå¸¸éƒ½æ˜¯åœ¨è¿è¡Œæ—¶æ£€æŸ¥ï¼Œåªæœ‰ç¡®ä¿è½½ä½“åº”ç”¨åœ¨iOS8.0æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­è¿è¡Œæ—¶æ‰ä¼šä½¿ç”¨è¿™äº›APIã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[2018CocoaPodså®‰è£…å’Œä½¿ç”¨]]></title>
    <url>%2F2018%2F11%2F12%2F2018CocoaPods%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[2018 CocoaPodsæœ€æ–°å®‰è£…å’Œä½¿ç”¨ä»¥åŠè·³è¿‡pod setupå¿«é€Ÿå®‰è£…æ•™ç¨‹ ç¬¬ä¸€æ­¥:ä¿®æ”¹rubyæºå®‰è£…CocoaPods,éœ€è¦rubyç¯å¢ƒ,ç„¶è€ŒMacç³»ç»Ÿé»˜è®¤ä¼šå®‰è£…å¥½rubyç¯å¢ƒã€‚ æ‰“å¼€Macç»ˆç«¯ gem sources -l //æŸ¥çœ‹rubyæº é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼šæ˜¾ç¤º https://rubygems.org/ rubyæºåœ¨å¢™å†…æ˜¯è®¿é—®ä¸åˆ°çš„,éœ€è¦ç½®æ¢ä¸ºå›½å†… åŸæ¥ä¸€ç›´ç”¨çš„æ˜¯æ·˜å®çš„ gem sources -a https://ruby.taobao.org/ ä½†æ˜¯æ·˜å®çš„rubyæºä¸æ›´æ–°äº†,ä¸å»ºè®®ä½¿ç”¨ ,åŸå› å¯ä»¥çœ‹è¿™ä¸ªé“¾æ¥ https://ruby.taobao.org/ ç°åœ¨ç”¨ https://gems.ruby-china.org //åˆ é™¤ä¹‹å‰ä½¿ç”¨çš„æ·˜å® gem sources --remove https://ruby.taobao.org/ gem source -a https://gems.ruby-china.org ä¸ºäº†éªŒè¯ä½ çš„Rubyé•œåƒæ˜¯å¹¶ä¸”ä»…æ˜¯gems.ruby-chinaï¼Œå¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š gem sources -l //æ£€æµ‹æ˜¯å¦æˆåŠŸ åªæœ‰åœ¨ç»ˆç«¯ä¸­å‡ºç°ä¸‹é¢æ–‡å­—æ‰è¡¨æ˜ä½ ä¸Šé¢çš„å‘½ä»¤æ˜¯æˆåŠŸçš„ï¼š https://gems.ruby-china.org è¡¥å……: æœ€è¿‘ruby-chinaåŸŸåå˜åŒ–ç”±orgæ›´æ”¹ä¸ºcomï¼Œè¯·å¤§å®¶æ”¹ä¸º https://gems.ruby-china.com gem sources --remove https://gems.ruby-china.org gem source -a https://gems.ruby-china.com ç¬¬äºŒæ­¥:å‡çº§GemGemæ˜¯æ¥ç®¡ç†Rubyæ ‡å‡†åŒ…. gem -v //æŸ¥çœ‹ç‰ˆæœ¬ sudo gem update --system //å‡çº§gem ä¸å‡çº§åœ¨ç¬¬ä¸‰æ­¥å¯èƒ½,ä¼šæŠ¥å¾ˆå¤šé”™è¯¯,å› ä¸ºGemç‰ˆæœ¬å¤ªä½,æ— æ³•å®‰è£…ç¬¬ä¸‰æ­¥,å®‰è£…CocoaPods å¦‚æœæŠ¥é”™ï¼š ERROR: While executing gem ... (OptionParser::AmbiguousOption) ambiguous option: -system å®‰è£…RVM: curl -L get.rvm.io | bash -s stable æŸ¥çœ‹ç‰ˆæœ¬ï¼š ruby -v å·²çŸ¥ç‰ˆæœ¬ï¼š rvm list known å®‰è£…ç‰ˆæœ¬ï¼š rvm install 2.4.1 ç¬¬ä¸‰æ­¥,å®‰è£…CocoaPodssudo gem install cocoapods // Mac OS X 10.11å‰ è¾“å…¥è¿™ä¸€æ¡ sudo gem install -n /usr/local/bin cocoapods //Mac OS X 10.11å è¾“å…¥è¿™ä¸€æ¡ æˆåŠŸå pod setup è¿™æ¡å‘½ä»¤æ˜¯å°†Githubä¸Šçš„å¼€æºåº“éƒ½æ‰˜ç®¡éƒ½å®‰è£…Podspecç´¢å¼•å®‰è£…åˆ°åˆ°æœ¬åœ°, æµ‹è¯•å¦‚æœæœ‰ç‰ˆæœ¬å·ï¼Œåˆ™è¯´æ˜å·²ç»å®‰è£…æˆåŠŸ pod --version //æŸ¥çœ‹ç‰ˆæœ¬ ç¬¬å››æ­¥,åˆ©ç”¨cocoapodsæ¥å®‰è£…ç¬¬ä¸‰æ–¹æ¡†æ¶ 1 è¿›å…¥è¦å®‰è£…æ¡†æ¶çš„é¡¹ç›®çš„.xcodeprojåŒçº§æ–‡ä»¶å¤¹ 2 åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªæ–‡ä»¶Podfile pod init pod inité¦–å…ˆéœ€è¦åˆ¤æ–­å½“å‰ç›®å½•æœ‰æ²¡æœ‰ XCODEPROJ é¡¹ç›®ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥æŠ¥é”™ï¼›è‹¥æœæœ‰å•ä¸ª XCODEPROJ é¡¹ç›®ï¼Œä¼šç›´æ¥åˆ›å»ºä¸€ä¸ª podfile æ–‡ä»¶ï¼›å¦‚æœæœ‰å¤šä¸ªXCODEPROJ é¡¹ç›®ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªé¡¹ç›®ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š [!] Multiple Xcode projects found, please specify one æˆ–è€…æ‰‹åŠ¨ æ–°å»ºæ–‡ä»¶Podfile vim Podfile vim Podfile Podfileæ–‡ä»¶ä¸­, å†™å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜ å°æç¤ºï¼šï¼ˆç»ˆç«¯vimæ–‡ä»¶ æŒ‰ i å¯ç¼–è¾‘ ï¼Œesc é€€å‡ºç¼–è¾‘ï¼Œï¼šwq å¯ä¿å­˜é€€å‡ºï¼‰ # Uncomment the next line to define a global platform for your project platform :ios, &#39;7.0&#39; target &#39;MyApp&#39; do # Uncomment the next line if you&#39;re using Swift or would like to use dynamic frameworks # use_frameworks! # Pods for sync pod &#39;AFNetworking&#39; , &#39;~&gt; 3.1.0&#39; end è§£é‡Šä¸€ä¸‹platform : ios, â€˜7.0â€™ä»£è¡¨å½“å‰AFNetworkingæ”¯æŒçš„iOSæœ€ä½ç‰ˆæœ¬æ˜¯iOS 7.0, ä½¿ç”¨æ—¶éœ€è¦å»æ‰å‰é¢äº•å·MyApp : å°±æ˜¯ä½ è‡ªå·±çš„å·¥ç¨‹åå­—ï¼Œpod &#39;AFNetworking&#39;, &#39;~&gt; 3.1.0&#39;ä»£è¡¨è¦ä¸‹è½½çš„AFNetworkingç‰ˆæœ¬æ˜¯3.1.0åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œè¿˜å¯ä»¥å»æ‰åé¢çš„â€™~&gt; 3.1.0â€™ï¼Œç›´æ¥å†™pod â€˜AFNetworkingâ€™ï¼Œè¿™æ ·ä»£è¡¨ä¸‹è½½çš„AFNetworkingæ˜¯æœ€æ–°ç‰ˆã€‚ 3 ä¸Šé¢ä¿¡æ¯è¡¨ç¤ºæ–‡ä»¶ä¸­å‘Šè¯‰cocoapodséœ€è¦å®‰è£…çš„æ¡†æ¶ä¿¡æ¯ a.è¯¥æ¡†æ¶æ”¯æŒçš„å¹³å° b.é€‚ç”¨çš„iOSç‰ˆæœ¬ c.æ¡†æ¶çš„åç§° d.æ¡†æ¶çš„ç‰ˆæœ¬ 4.å¯¼å…¥ç¬¬ä¸‰æ–¹åº“â€“no-repo-update : ä¸æ›´æ–°ä»“åº“,è¿…é€ŸåŠ è½½ç¬¬ä¸‰æ–¹æ¡†æ¶pod install --no-repo-update pod update --no-repo-update 5.å¯ä½¿ç”¨searchå‘½ä»¤æœç´¢ç±»åº“åæ¯”å¦‚:pod search AFNetworkingï¼ˆä¹Ÿå¯ä»¥pod search UIç­‰ï¼Œå¯ä»¥æŸ¥è¯¢ä½ æƒ³è¦çš„ï¼‰ é€€å‡ºæœç´¢, è¾“å…¥ :wq ç¬¬äº”æ­¥,CocoaPods ä¸­åˆ é™¤ä¸éœ€è¦çš„ç¬¬ä¸‰æ–¹åº“ 1 æ‰“å¼€Podfile, æ‰¾åˆ°ä¸éœ€è¦çš„ç±»åº“, ç›´æ¥åˆ é™¤è¯¥ç±»åº“ä¿¡æ¯, æˆ–è€…å‰é¢åŠ #æ³¨é‡Šæ‰æ¯”å¦‚è¦åˆ é™¤AFNetworkingåº“ ,ç›´æ¥å»æ‰Podfileä¸­ç¬¬äº”è¡Œä¿¡æ¯ pod â€˜AFNetworkingâ€™, â€˜~&gt; 3.1.0â€™ 2 æ‰“å¼€ç»ˆç«¯cdåˆ°å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹é‡æ–°æ‰§è¡Œ pod update --no-repo-update 3 æ›´æ–°å®Œæˆå°±åˆ é™¤æˆåŠŸäº† æ³¨æ„: åˆ é™¤ä¸€äº›ä¸‰æ–¹åº“åç¼–è¯‘å¯èƒ½ä¼šæŠ¥é”™: library not found for -l åº“å è§£å†³:åœ¨Build Settingsä¸­æœç´¢Other Linker Flagsï¼Œå»æ‰-lâ€åº“åâ€ã€‚(æœ‰æ—¶ä¸ç®¡ç”¨,åº”è¯¥æ˜¯cocoapodsçš„ç‰ˆæœ¬é—®é¢˜) ç¬¬å…­, Cocoapodsé™ä½ç‰ˆæœ¬åŠå¸è½½ä¸€. ç§»é™¤podç»„ä»¶ 1.è¿™æ¡æŒ‡ä»¤ä¼šå‘Šè¯‰ä½ Cocoapodsç»„ä»¶è£…åœ¨å“ªé‡Œ : which pod 2.ä½ å¯ä»¥æ‰‹åŠ¨ç§»é™¤è¿™ä¸ªç»„ä»¶ : sudo rm -rf è·¯å¾„ äºŒ. ç§»é™¤ RubyGems ä¸­çš„ Cocoapodsç¨‹åºåŒ… Q: RubyGemsæ˜¯ä»€ä¹ˆ? A: RubyGemsï¼ˆç®€ç§° gemsï¼‰æ˜¯ä¸€ä¸ªç”¨äºå¯¹ Rubyç»„ä»¶è¿›è¡Œæ‰“åŒ…çš„ Ruby æ‰“åŒ…ç³»ç»Ÿã€‚ å®ƒæä¾›ä¸€ä¸ªåˆ†å‘ Ruby ç¨‹åºå’Œåº“çš„æ ‡å‡†æ ¼å¼ï¼Œè¿˜æä¾›ä¸€ä¸ªç®¡ç†ç¨‹åºåŒ…å®‰è£…çš„å·¥å…·ã€‚ 1.æŸ¥çœ‹gemsä¸­æœ¬åœ°ç¨‹åºåŒ… gem list 2.ç§»é™¤ç¨‹åºåŒ… sudo gem uninstall cocoapods -v è¦ç§»é™¤çš„ç‰ˆæœ¬å· 3.å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Cocoapods sudo gem install cocoapods -v è¦å®‰è£…çš„ç‰ˆæœ¬å· è·³è¿‡pod setupå¿«é€Ÿå®‰è£…æœ‰ä¸å°‘åŒå­¦æ‰§è¡Œpod setupè¿™ä¸€æ­¥, æ„Ÿè§‰å¾ˆæ…¢â€¦.. å¤§çº¦è¦ä¸‹è½½200Mçš„æ–‡ä»¶,ååä¸‹è½½é€Ÿåº¦å‡ºå¥‡çš„æ…¢,æœ¬äººä¿æŒåœ¨30K/S,å¤§çº¦2ä¸ªå°æ—¶,å…³é”®æ˜¯æ²¡æœ‰ä»»ä½•è¿›åº¦æ¡æ˜¾ç¤º,å°±è¿™æ ·å‚»ä¹ä¹çš„å¡æ­»åœ¨è¿™é‡Œ ä¸€å¥ pod setup å¡ä½ 2ä¸ªå°æ—¶,å‰æè¿˜æ˜¯ä½ å®‰è£…æ²¡æœ‰é”™,å¦‚æœé”™è¯¯,åˆè¦é‡æ–°2å°æ—¶. æ€ä¹ˆèƒ½å¦‚æ­¤æµªè´¹æ—¶é—´å‘¢? å‰é¢è¯´äº†,pod setup è¿™æ¡å‘½ä»¤æ˜¯å°†Githubä¸Šçš„å¼€æºåº“éƒ½æ‰˜ç®¡éƒ½å®‰è£…Podspecç´¢å¼•å®‰è£…åˆ°åˆ°æœ¬åœ°. ç®€å•è¯´å°±æ˜¯ä¸‹è½½ä¸€ä¸ªåŒ…,åˆ°æœ¬åœ°,ä¹Ÿå°±æ˜¯è¿™ä¸ªä¸œè¥¿ å¦‚æœä½ åŒäº‹ç”µè„‘ä¸Šæœ‰å®‰è£…å¥½,ä½ å…¶å®å¯ä»¥ä»ä½ åŒäº‹ç”µè„‘ä¸Šæ‹·è´è¿‡æ¥,ç›´æ¥æ”¾åˆ°è¯¥è·¯å¾„å°±OKäº†. å¦‚æœä½ èº«è¾¹æ²¡æœ‰è£…å¥½çš„CocoaPodsçš„æœ‹å‹,å¯ä»¥è®¿é—®è¿™ä¸ªé“¾æ¥ https://github.com/CocoaPods/Specs (githubæ‰€æœ‰çš„ç¬¬ä¸‰æ–¹å¼€æºåº“çš„Podspecæ–‡ä»¶éƒ½æ‰˜ç®¡åœ¨è¿™é‡Œ,è¿™ä¹Ÿæ˜¯ä½ pod setupæ‰€è¦ä¸‹è½½çš„). é€‰æ‹©Download ZIP,ç”¨ä½ çš„æµè§ˆå™¨æˆ–è€…è¿…é›·ä»€ä¹ˆçš„,ä»€ä¹ˆä¸‹è½½å¿«ç”¨ä»€ä¹ˆ,åˆ†åˆ†é’Ÿä¸‹è½½å®Œç›®å‰ä¸º111.3M(éšç€å¼€æºåº“çš„å£®å¤§,ä¼šæ…¢æ…¢å˜å¤§). è§£å‹åä¸ºè¿™ä¸ªæ ·å­ å¯¹æ¯”ä¸Šå›¾,Specs-masteræ”¹åä¸ºmaster æ”¾åœ¨ ~/.cocoapods/repos è·¯å¾„å³å¯. ~/.cocoapods/repos è¿™ä¸ªè·¯å¾„æ˜¯åœ¨æ‰§è¡Œ pod setupç”Ÿæˆçš„,æ‰€ä»¥ç”µè„‘æ— æ³•å‰å¾€æ­¤è·¯å¾„æ˜¯,å»ºè®®å…ˆpod setupä¸‹,ç„¶åå…³é—­æ‰å³å¯ç”Ÿæˆè·¯å¾„. è¿˜æœ‰å°±æ˜¯,FQ,ä¼šå¾ˆå¿«ä¸‹è½½,ä¹Ÿå°±æ˜¯æŒ‚ä¸ªVPN.]]></content>
      <categories>
        <category>Tool</category>
      </categories>
      <tags>
        <tag>iOSTool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ­å»ºgithubåšå®¢]]></title>
    <url>%2F2018%2F11%2F11%2FHexo%E6%90%AD%E5%BB%BAgithub%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[hexoå®˜æ–¹ç½‘ç«™ ä¸€.ç³»ç»Ÿç¯å¢ƒé…ç½®ï¼šè¦ä½¿ç”¨Hexoï¼Œéœ€è¦åœ¨ä½ çš„ç³»ç»Ÿä¸­æ”¯æŒNodejsä»¥åŠGitï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼Œé‚£å°±å¼€å§‹å®‰è£…å§ï¼ 1.å®‰è£… node.jsâ€‹ ä¸‹è½½åœ°å€ node.jsâ€‹ ç›´æ¥åŒå‡»ä¸‹è½½ä¸‹æ¥çš„msiæ–‡ä»¶ï¼Œä¸€è·¯ä¸‹ä¸€æ­¥å°±okäº†ï¼Œå®‰è£…å®Œä¹‹åè°ƒå‡ºå‘½ä»¤è¡Œæˆ–è€…nodeå‘½ä»¤è¾“å…¥ç»ˆç«¯ï¼Œè¾“å…¥node -vçœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯å°±è¡¨æ˜å®‰è£…æˆåŠŸäº†ã€‚å¦‚æœä¸ä¼šå°±å‚è€ƒnode.jså®‰è£… 2.å®‰è£… gitâ€‹ ä¸‹è½½åœ°å€ gitä¸‹è½½â€‹ ç›´æ¥åŒå‡»ä¸‹è½½ä¸‹æ¥çš„gitå®‰è£…ç¨‹åºï¼ŒåŒnodeå®‰è£…ï¼Œå®‰è£…å®Œä¹‹åå³é”®å‘ç°å¤šäº†ä¸¤ä¸ªGit GUI Here ã€Git Bash Hereï¼Œç‚¹å‡»åè€…ï¼Œç„¶åè¾“å…¥git â€“versionå‡ºç°ç‰ˆæœ¬ä¿¡æ¯å°±è¡¨æ˜å®‰è£…æˆåŠŸäº†ã€‚ 3.æ³¨å†Œ githubè´¦å·â€‹ github å®˜ç½‘ github äºŒ.æ­å»ºä¸ªäººåšå®¢å®‰è£… hexoï¼š 1.æ›´æ–°é•œåƒå‚è€ƒ 2018 macç»ˆç«¯æ›´æ–°æ·˜å®npmé•œåƒ 2. å®‰è£… hexo å‘½ä»¤ $ sudo cnpm install -g hexo-cli åœ¨è¿™é‡Œä¼šæœ‰ ä¸€æ®µæ—¶é—´ç­‰å¾…ï¼Œè¯·ç¨ç­‰ 3. å®‰è£…ä¸ªäººåšå®¢è¿›å…¥åˆ° ä½ æœ¬åœ°çš„åšå®¢å­˜æ”¾è·¯å¾„ # è¿›å…¥æœ¬åœ°åšå®¢å­˜æ”¾ç›®å½• $ cd /github/blog # åˆå§‹åŒ– ä¸ªäººåšå®¢ $ hexo init #ç­‰å¾…ä¸€æ®µæ—¶é—´ åˆå§‹åŒ–å®Œæˆä»¥åï¼Œä¼šç”Ÿæˆä»¥ä¸‹ç›®å½•ï¼š #ç”Ÿæˆé™æ€ç½‘é¡µ $ hexo g # å¯åŠ¨æœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè®¿é—®ç½‘å€ä¸ºï¼š http://localhost:4000/ $ hexo s æ‰§è¡Œå®Œä»¥åï¼Œä½ å°±å¯ä»¥å»æ‰“å¼€ http://localhost:4000/ çœ‹æœ¬åœ°ç‰ˆçš„åšå®¢æ•ˆæœäº†ã€‚ ä¸‰.ä¿®æ”¹ä¸»é¢˜ï¼šnextå®˜ç½‘è¿™é‡Œæœ‰ä¸€äº›å¸¸è§çš„hexoä¸»é¢˜ï¼Œè¯»è€…å¯ä»¥æŒ‘é€‰è‡ªå·±å–œæ¬¢çš„å®‰è£…ã€‚ ä¸ªäººæ¯”è¾ƒå–œæ¬¢ next è¿™æ¬¾ä¸»é¢˜ã€‚åŸºæœ¬å‘¢å°±æ˜¯è¿™ä¸ªæ•ˆæœä¸ªäººåšå®¢ æ¸…é™¤ç¼“å­˜æ–‡ä»¶ (db.json) å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶ (public)ã€‚ $ hexo clean ä¸‹è½½ä¸»é¢˜ $ git clone https://github.com/iissnan/hexo-theme-next.git themes/next å¯åŠ¨ä¸»é¢˜ï¼š1. ä¿®æ”¹Hexoç›®å½•ä¸‹çš„_config.ymlé…ç½®æ–‡ä»¶ä¸­çš„themeå±æ€§ï¼Œå°†å…¶è®¾ç½®ä¸ºnext theme : next 2.ç”Ÿæˆé™æ€é¡µé¢ $ hexo clean # ç”Ÿæˆé™æ€é¡µé¢ $ hexo g # å¯åŠ¨æœåŠ¡å™¨ $ hexo s æ‰“å¼€ http://localhost:4000/ æŸ¥çœ‹é™æ€é¡µé¢. å››.éƒ¨ç½²åˆ°GitHubä¸Šï¼šä¿®æ”¹ç«™ç‚¹æ ¹ç›®å½•ä¸‹ _config.yml æ–‡ä»¶ï¼Œåœ¨æœ€åæ·»åŠ  # Deployment ## Docs: https://hexo.io/docs/deployment.html deploy: type: git repo: git@github.com:honkerSK/honkerSK.github.io.git #è¿™é‡Œå¡«ä½ è‡ªå·±çš„githubåœ°å€ branch: master ç„¶ååœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ #æ³¨æ„éœ€è¦æå‰å®‰è£…ä¸€ä¸ªæ‰©å±•ï¼š $ cnpm install hexo-deployer-git --save #éƒ¨ç½²ç½‘ç«™, æäº¤åˆ°github $ hexo d åˆ°æ­¤å‘¢ï¼Œä½ çš„åšå®¢åŸºæœ¬å°±æ­å»ºå®Œæ¯•äº†ã€‚ åšå®¢å¤–éƒ¨æ’ä»¶ï¼šè¿™ä¸ªæ˜¯ä¸ªäººåšå®¢çš„ç¬¬ä¸‰æ–¹æ’ä»¶ï¼Œä¸€ä¸ªåšå®¢æœç´¢æ’ä»¶ï¼Œä¸€ä¸ªè¯„è®ºæ’ä»¶ã€‚ æœç´¢æ’ä»¶ algoliaï¼š 1) æ³¨å†Œè´¦å· algolia 2) ç™»é™†ï¼Œè¿›å»åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå¦‚å›¾ï¼š 3) åˆ›å»ºä¸€ä¸ªapi keyï¼Œå¹¶èµ‹äºˆå¢åˆ çš„æƒé™ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š å¹¶èµ‹äºˆ add records,delete recourds,list indices,delete index 4ä¸ªæƒé™ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š 4) ç„¶åç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆæ˜¯ next ç›®å½•ä¸‹çš„ _config.ymlï¼š å°† # Algolia Search ä¸‹çš„ algolia_search: enable: true ---æ”¹ä¸ºtrue 5) ç„¶åä¿®æ”¹ ç«™ç‚¹ç›®å½•ä¸‹çš„ _config.ymlï¼š æœ€åå¢åŠ ï¼š #ç«™å†…æœç´¢ï¼š algolia: applicationID: &#39;ZMNZVONxxx&#39; #Application ID å¯¹åº”çš„å€¼ apiKey: &#39;a3b6cc86714b99e25e614968b07xxxxx&#39; # è¿™é‡Œå¡«ä½ æ–°å»ºçš„ api key å¯¹åº”çš„å€¼ indexName: &#39;bigDataBeginner&#39; #è¿™é‡Œå¡«ä½  åˆ›å»ºçš„ç´¢å¼•åç§° chunkSize: 5000 #è¿™ä¸ªå€¼ä¸åŠ¨ 6) æ‰§è¡Œå‘½ä»¤ï¼Œå°†æ–‡ç« åˆ—è¡¨åŒæ­¥åˆ° algoliaï¼š $ export HEXO_ALGOLIA_INDEXING_KEY=a3b6cc86714b99e25e614968b073f442 # keyå€¼å¯¹äºä½ æ–°å»º api keyçš„å€¼ $ hexo algolia å¦‚æœæŠ¥é”™ æ‰§è¡Œ hexo clean åï¼Œé‡è¯•ã€‚ç„¶åé¢„è§ˆã€‚ è¯„è®ºæ’ä»¶ æ¥å¿…åŠ›ï¼š 1) æ³¨å†Œè´¦å·æ¥å¿…åŠ› 2) ç™»é™†ï¼Œç»‘å®šè‡ªå·±åšå®¢åœ°å€ã€‚å¦‚å›¾æ‰€ç¤ºï¼š 3) å¤åˆ¶ è‡ªå·±åœ°å€å¯¹åº”çš„idå€¼ã€‚å¦‚å›¾æ‰€ç¤ºï¼š 4) ç¼–è¾‘ next ç›®å½•ä¸‹çš„ _config.yml é…ç½®æ–‡ä»¶ï¼š ä¿®æ”¹ä¸‹é¢ä¸€è¡Œï¼š livere_uid: &quot;MTAyMC8zMjg2xxxxxx&quot; ---è¿™é‡Œå¡«å…¥ä½ å¤åˆ¶çš„idå€¼ æ¸…ç©ºç¼“å­˜ï¼Œé‡æ–°ç”Ÿæˆé™æ€é¡µé¢é¢„è§ˆå°±çœ‹åˆ°æ•ˆæœäº†ã€‚ Hexoå¸¸ç”¨å‘½ä»¤ï¼š$ hexo clean æ¸…é™¤æœ¬åœ°ç¼“å­˜ $ hexo g # æˆ–è€…hexo generateï¼Œç”Ÿæˆé™æ€é¡µé¢ $ hexo s # æˆ–è€…hexo serverï¼Œå¯ä»¥åœ¨http://localhost:4000/ æŸ¥çœ‹ $ hexo new &quot;postName&quot; #æ–°å»ºæ–‡ç«  $ hexo new page &quot;pageName&quot; #æ–°å»ºé¡µé¢ $ hexo d # ä»£ç åŒæ­¥åˆ°githubä¸Š å¥½äº†ï¼Œæœ¬æ–‡åˆ°æ­¤ç»“æŸã€‚]]></content>
      <categories>
        <category>Tool</category>
      </categories>
      <tags>
        <tag>å‰ç«¯Tool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¦‚ä½•ä¼˜é›…ç®¡ç†githubçš„staré¡¹ç›®]]></title>
    <url>%2F2018%2F11%2F11%2F%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%AE%A1%E7%90%86github%E7%9A%84star%E9%A1%B9%E7%9B%AE%2F</url>
    <content type="text"><![CDATA[åœ¨ä½¿ç”¨GitHubçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šStarä¸€äº›é¡¹ç›®ã€‚æ•°é‡ä¸€å¤šï¼Œå®Œå…¨æ— æ³•æŒæ§ã€‚å¾ˆæ—©å°±æœ‰äººæè®®å®˜æ–¹æ·»åŠ åˆ†ç»„å’Œæ ‡ç­¾åŠŸèƒ½ï¼Œä½†å®˜æ–¹ç»™å‡ºäº†å›åº”è¯´ï¼Œä¸ä¼šåšè¿™ä¸ªåŠŸèƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„å·¥å…·æ¥ç®¡ç†staré¡¹ç›®äº†ï¼Œæ¥ä¸‹æ¥ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„å·¥å…·ï¼š Chrome æ’ä»¶github-stars-manager (æ¨è)github-stars-manageræºä»£ç  Chromeåº”ç”¨å•†åº— æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ å¼€æº åªæœ‰startæ ‡ç­¾ï¼Œæ²¡æœ‰Repositoriesbæ ‡ç­¾ ç›´æ¥åœ¨ github çš„ star é¡µé¢ä¸­å¢åŠ tagï¼Œæ— ç¼é›†æˆã€‚ éœ€è¦githubæˆæƒè®¿é—®æ‰€æœ‰å…¬å¼€å’Œç§æœ‰ä»“åº“ å¯ä»¥ç›´æ¥å¯¼å‡ºæ•°æ®åˆ°chromeä¹¦ç­¾æ  æ·»åŠ æ ‡ç­¾è¦ä¸€æ¬¡è¯»å–å†…å®¹ï¼Œæœ‰å»¶è¿Ÿ æ¯”è¾ƒæ–°ï¼Œ18å¹´5æœˆåˆ›å»ºå¹¶ä¸Šæ¶Chromeåº”ç”¨å•†åº— æ ‡ç­¾ä¸èƒ½æ’åºï¼Œçœ‹ä¸Šå»æ¯”è¾ƒä¹± github-stars-taggergithub-stars-taggeræºä»£ç  Chromeåº”ç”¨å•†åº— Github æ”¹ç‰ˆä¹‹å‰çš„æ’ä»¶ï¼Œå¯ä»¥ç®¡ç† star é¡¹ç›®ï¼Œè‡ªå¸¦åŒæ­¥åŠŸèƒ½ï¼Œæœ€è¿‘æ›´æ–°æ—¶é—´17å¹´2æœˆï¼ŒGithubæ”¹ç‰ˆä¹‹åè¿™ä¸ªæ’ä»¶ä¸èƒ½ç”¨äº†ã€‚ CodelfCodelfåœ¨çº¿åº”ç”¨ Chromeåº”ç”¨å•†åº— å…·æœ‰Bootstrap é£æ ¼ï¼Œä¸æ˜¯å¾ˆç¾è§‚ï¼Œä¸è¿‡å®ƒæ”¯æŒå¯¼å‡ºå¯¼å…¥æ•°æ®ï¼Œæ–¹ä¾¿åŒæ­¥ï¼ è¿™ä¸ªå·¥å…·æœ‰ä¸€ä¸ª Chrome æ’ä»¶ï¼Œä¸è¿‡æ’ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªç½‘é¡µã€‚ æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ æ”¯æŒå¯¼å…¥å¯¼å‡º åœ¨çº¿ç½‘ç«™ç®¡ç†ï¼Œéœ€è¦æˆæƒ å“åº”å¿« åªèƒ½å¯¼å…¥å¯¼å‡ºï¼Œæ•°æ®ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå®¹æ˜“ä¸¢å¤±ã€‚ å¼€æºçš„AstralAstralæºä»£ç  Astralåœ¨çº¿åº”ç”¨ Astral æ˜¯ä¸€æ¬¾åŸºäº PHP ä½¿ç”¨ Vue.js æ„å»ºçš„ Github star é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œæ–¹ä¾¿ä¸ªäººç”¨æˆ·ç®¡ç†è‡ªå·±çš„ star é¡¹ç›®ã€‚ æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ å¼€æº åœ¨çº¿ç½‘ç«™æ ‡ç­¾ç®¡ç† ç•Œé¢æ¼‚äº® ä¸èƒ½åŒæ­¥åˆ°chromeä¹¦ç­¾ å¯ä»¥ä»¥jsonå¯¼å‡ºå¤‡ä»½ éœ€è¦æˆæƒ gitmarkgitmarkæºä»£ç  gitmarkåœ¨çº¿ç½‘å€ æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ å¼€æº åªæ˜¯åœ¨çº¿æŸ¥çœ‹ï¼Œæ²¡æœ‰æ ‡ç­¾ç®¡ç†åŠŸèƒ½ 15å¹´åˆ›å»ºé¡¹ç›®ï¼Œæœ€è¿‘ä¸€ç›´åœ¨æ›´æ–° éœ€è¦æˆæƒè®¿é—®å…¬å…±ä»“åº“ ä¸å¼€æºçš„GitconstellationGitconstellationç½‘ç«™ï¼šhttp://gitconstellation.com è¿™æ˜¯ä¸€ä¸ªä¸å¼€æºçš„ star ç®¡ç†å·¥å…·ã€‚ç•Œé¢æœ‰ä¸€ç§å°æ¸…æ–°çš„é£æ ¼ã€‚å®ƒé‡‡ç”¨åˆ†æ®µåŠ è½½ star é¡¹ç›®çš„æ–¹å¼åŠ è½½ã€‚ æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ ç•Œé¢ç¾è§‚ ä¸å¼€æº åªæˆæƒäº†è¯»å–å…¬å…±ä¿¡æ¯ æ— æ³•å¯¼å‡ºç›¸å…³å†…å®¹ å“åº”é€Ÿåº¦æ…¢ OhMyStar2ohmystarapp2 ç½‘å€ï¼š http://www.ohmystarapp.com/ åªèƒ½åœ¨è‹¹æœç”µè„‘ä¸Šç”¨ã€‚ åˆ†ä¸ºå…è´¹ç‰ˆå’Œæ”¶è´¹ç‰ˆã€‚ æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ ç•Œé¢ç¾è§‚ ä¸å¼€æº å¯ä»¥å¯¼å‡ºç›¸å…³å†…å®¹ éœ€è¦æˆæƒè®¿é—®å…¬å…±ä»“åº“ å…è´¹ç‰ˆæ·»åŠ æ ‡ç­¾æ²¡æœ‰æ•°é‡é™åˆ¶ æ·»åŠ æ ‡ç­¾ï¼Œå“åº”é€Ÿåº¦æ…¢ Starry å›½äººå¼€å‘ï¼ŒAppstore 17å¹´ä¸Šçº¿ï¼Œ ç•Œé¢å’ŒOhMyStar2ç±»ä¼¼ã€‚ æ¯”è¾ƒï¼š ä¼˜ç‚¹ ç¼ºç‚¹ å¯ä»¥åˆ›å»ºgroupç®¡ç† ä¸å¼€æº èƒ½æ‹–æ‹½é¡¹ç›®æ·»åŠ åˆ°groupä¸­ å…è´¹ç‰ˆæœ€å¤šæ·»åŠ 5ä¸ªgroup å“åº”é€Ÿåº¦å¿« éœ€è¦æˆæƒè®¿é—®å…¬å…±ä»“åº“ ä¸èƒ½å¯¼å‡ºæ•°æ® Star Orde AppStoreä¸Šæ”¶è´¹12RMB,æœ‰macç‰ˆå’ŒiOSç‰ˆã€‚ ä¸å»ºè®®çš„MyGitStarMyGitStaræºç  è¿™ä¸ªé¡¹ç›®æœ€è¿‘æ›´æ–°æ˜¯14å¹´4æœˆï¼Œä¸æ¸…æ¥šå…·ä½“é•¿å•¥æ ·ã€‚ è¯´æ˜æ–‡æ¡£ä¸ºä¸­æ–‡ gitstars-openapigitstars-openapi æºç  æœ€è¿‘æ›´æ–°æ˜¯16å¹´9æœˆï¼Œç°åœ¨ä»…ä»…æ˜¯å…ˆæŠŠ API å…¬å¼€å‡ºæ¥äº†ï¼Œè¿˜åœ¨å¼€å‘ä¸­ï¼Œç½‘ç«™è¿˜æ²¡ä¸Šçº¿ã€‚ GitStars.comGitStars.comæºç  æœ€è¿‘æ›´æ–°æ˜¯15å¹´3æœˆï¼Œç°åœ¨åœäº†ï¼Œç½‘ç«™éƒ½æ‰“ä¸å¼€äº†ï¼Œä¸è¿‡æºç è¿˜åœ¨ã€‚ Gitrep Gitrepåœ¨çº¿ç½‘ç«™ ç½‘ç«™è™½ç„¶åœ¨ï¼Œä½†æ˜¯åŸºæœ¬æ˜¯åºŸäº†ï¼Œä¸èƒ½ç”¨ã€‚ æ€»ç»“å¦‚æœä½ æ²¡æœ‰ç§æœ‰ä»“åº“ï¼Œå»ºè®®ä½¿ç”¨ googleæ’ä»¶github-stars-managerã€‚å¦‚æœæ˜¯è‹¹æœç”µè„‘ï¼Œå¹¶ä¸”æƒ³è¦æœ¬åœ°ç®¡ç†ä¿å­˜ï¼Œå»ºè®®ä½¿ç”¨macè½¯ä»¶ OhMyStar2]]></content>
      <categories>
        <category>Tool</category>
      </categories>
      <tags>
        <tag>plug-in</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šä¸ªgithubå¸å·æ›´æ–°å¤šä¸ªhexoåšå®¢]]></title>
    <url>%2F2018%2F11%2F11%2F%E5%A4%9A%E4%B8%AAgithub%E5%B8%90%E5%8F%B7%E6%9B%B4%E6%96%B0%E5%A4%9A%E4%B8%AAhexo%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[ä¸€å°ç”µè„‘, å¤šä¸ªgithubå¸å·çš„SSH keyåˆ‡æ¢, æ›´æ–°å¤šä¸ªhexoåšå®¢ githubè´¦å·ï¼Œå·¥ä½œæœ‰ä¸€ä¸ªï¼Œè‡ªå·±æœ‰ä¸€ä¸ªã€‚ä½†æ˜¯é»˜è®¤ä¸‹ä½¿ç”¨ssh keyåœ¨git pushæ—¶åªæœ‰é»˜è®¤è´¦å·èƒ½å…è¾“å…¥è´¦å·å’Œå¯†ç ã€‚ å¦‚æœä½ å»ºç«‹å¹¶é…ç½®äº†.ssh/configæ–‡ä»¶å, ä½†å´ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨ã€‚è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºä½ å‡†å¤‡çš„ã€‚ æ‰“å¼€ç»ˆç«¯,è¿›å…¥sshæ ¹ç›®å½•ä¸‹cd ~/.ssh/ åˆ›å»ºæ–°çš„ ç§é’¥/å…¬é’¥, å¹¶æŒ‡å®šç§˜é’¥åç§°, å¦‚ kentsun_rsa ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤è¡Œ, ç„¶åä¸¤æ¬¡å›è½¦å³å¯. ssh-keygen -t rsa -f ~/.ssh/éšä¾¿åå­—_id_rsa -C &quot;yourmail@xxx.com&quot; æˆ–è€…ä½¿ç”¨ä¸‹é¢å‘½ä»¤è¡Œåˆ›å»ºç§˜é’¥, éœ€è¦ä¸‰æ¬¡å›è½¦, ä½†æ˜¯ç¬¬ä¸€æ¬¡å›è½¦éœ€è¦è¾“å…¥ç§˜é’¥åå­—. ssh-keygen -t rsa -C &quot;yourmail@xxx.com&quot; æ³¨æ„:è¿™æ¬¡åˆ›å»ºæ–°çš„ç§˜é’¥ ,ä¸è¦å†ä¸‰æ¬¡å›è½¦äº†, è¦åœ¨ç¬¬ä¸€æ¬¡å›è½¦çš„åœ°æ–¹,å¡«å…¥æ–°ç§˜é’¥åå­—, å¦‚æœä¸å¡«å°†ä½¿ç”¨é»˜è®¤çš„id_rsa , ä¼šå°†åŸæ¥çš„ssh_keyè¦†ç›–. æ–°ç§˜é’¥ååé¢å»ºè®®åŠ _rsaæˆ–è€…id_rsa. é…ç½®configå¦‚æœ ~/.ssh/æ ¹è·¯å¾„ä¸‹, æ²¡æœ‰config, åˆ™åˆ›å»ºä¸€ä¸ªconfigæ–‡ä»¶ touch config configé…ç½®å¦‚ä¸‹, ç¬¬ä¸€ä¸ªä¸ºåŸæ¥çš„ssh keyé…ç½®, kentsunä¸ºæ–°çš„ssh keyé…ç½® #ç¬¬ä¸€ä¸ªè´¦å·ï¼Œé»˜è®¤ä½¿ç”¨çš„è´¦å· Host github.com HostName github.com User git IdentityFile ~/.ssh/id_rsa # ç¬¬äºŒä¸ªè´¦å· kentsun Host kentsun.github.com # kentsunä¸ºå‰ç¼€åï¼Œå¯ä»¥ä»»æ„è®¾ç½® HostName github.com User git IdentityFile ~/.ssh/kentsun_rsa æˆ‘ä»¬æŒ‡å®š kentsun.github.com è¿™ä¸ªâ€ä½œç”¨åŸŸâ€ä¸‹çš„sshè¿æ¥ç»Ÿä¸€æŒ‡å‘ github.com ï¼Œå¹¶ä¸”ä½¿ç”¨ä¹‹å‰ç”Ÿæˆå¥½çš„ github_rsa è¿™ä¸ªå¯†é’¥åŠ å¯†ã€‚ é»˜è®¤çš„ä½¿ç”¨ ~/.ssh/id_rsa è¿™ä¸ªå¯†é’¥åŠ å¯† åŸç†åˆ†æ: 1.ssh å®¢æˆ·ç«¯æ˜¯é€šè¿‡ç±»ä¼¼ git@github.com:githubUserName/repName.git çš„åœ°å€æ¥è¯†åˆ«ä½¿ç”¨æœ¬åœ°çš„å“ªä¸ªç§é’¥çš„ï¼Œåœ°å€ä¸­çš„ User æ˜¯@å‰é¢çš„gitï¼Œ Host æ˜¯@åé¢çš„github.comã€‚ 2.å¦‚æœæ‰€æœ‰è´¦å·çš„ User å’Œ Host éƒ½ä¸º git å’Œ github.comï¼Œé‚£ä¹ˆå°±åªèƒ½ä½¿ç”¨ä¸€ä¸ªç§é’¥ã€‚æ‰€ä»¥è¦å¯¹User å’Œ Host è¿›è¡Œé…ç½®ï¼Œè®©æ¯ä¸ªè´¦å·ä½¿ç”¨è‡ªå·±çš„ Hostï¼Œæ¯ä¸ª Host çš„åŸŸååš CNAME è§£æåˆ° github.comï¼Œå¦‚ä¸Šé¢é…ç½®ä¸­çš„Host kentsun.github.comã€‚ 3.é…ç½®äº†åˆ«åä¹‹åï¼Œæ–°çš„åœ°å€å°±æ˜¯git@kentsun.github.com:githubUserName/repName.gitã€‚è¿™æ · ssh åœ¨è¿æ¥æ—¶å°±å¯ä»¥åŒºåˆ«ä¸åŒçš„è´¦å·äº†ã€‚ è®¾ç½®æ–°githubè´¦æˆ·SSH keyæœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åœ¨ç”¨æˆ·ç›®å½•ä¸‹ï¼Œæ‰“å¼€ç”¨æˆ·ç›®å½•ï¼Œæ‰¾åˆ°.ssh\kentsun_rsa.pubæ–‡ä»¶ï¼Œè®°äº‹æœ¬æ‰“å¼€å¹¶å¤åˆ¶é‡Œé¢çš„å†…å®¹ï¼Œæ‰“å¼€ä½ çš„githubä¸»é¡µï¼Œè¿›å…¥ä¸ªäººè®¾ç½® -&gt; SSH and GPG keys -&gt; New SSH keyï¼š å°†åˆšå¤åˆ¶çš„å†…å®¹ç²˜è´´åˆ°keyé‚£é‡Œï¼Œtitleéšä¾¿å¡«ï¼Œä¿å­˜ã€‚ åœ¨.sshæ ¹ç›®å½•ä¸‹, æ¸…ç©ºæœ¬åœ°çš„ SSH ç¼“å­˜ï¼Œæ·»åŠ æ–°çš„ SSH å¯†é’¥ åˆ° SSH agentä¸­cd ~/.ssh ssh-add -D ssh-add id_rsa ssh-add id_rsa_second æœ€åç¡®è®¤ä¸€ä¸‹æ–°ç§˜é’¥å·²ç»æ·»åŠ æˆåŠŸssh-add -l è¾“å…¥æŒ‡ä»¤, éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ é»˜è®¤ssh_keyéªŒè¯ ssh -T git@github.com æ–°ssh_keyéªŒè¯, æ–°ç§˜é’¥åæ›¿æ¢username ssh -T git@username.github.com å¦‚ä¸‹æç¤ºä¿¡æ¯, åˆ™é…ç½®æˆåŠŸ $ ssh -T git@github.com Hi username! You&#39;ve successfully authenticated, but GitHub does not provide shell access. è¿›å…¥å„è‡ªé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå•ç‹¬è®¾ç½®ç”¨æˆ·å/é‚®ç®± æ³¨æ„ï¼šå¦‚æœæœ‰å¤šä¸ªè´¦å·ï¼Œå»ºè®®ä½¿ç”¨å±€éƒ¨çš„ã€‚ // å–æ¶ˆå…¨å±€ ç”¨æˆ·å/é‚®ç®± é…ç½® git config â€“global â€“unset user.name git config â€“global â€“unset user.email // å•ç‹¬è®¾ç½®æ¯ä¸ªrepo ç”¨æˆ·å/é‚®ç®± git config user.name &quot;ç”¨æˆ·å&quot; //åœ¨configååŠ ä¸Š--globalå³å…¨å±€ git config user.email &quot;é‚®ç®±&quot; æŸ¥çœ‹è®¾ç½®æ˜¯å¦æˆåŠŸgit config --list æœ€ååœ¨ hexo é…ç½®æ–‡ä»¶ä¿®æ”¹gitåœ°å€deploy: type: git repository: git@username.github.com:githubUserName/githubUserName.github.io.git branch: master repoé…ç½®ç›¸å½“äºåœ¨åŸæ¥ gitä»“åº“åœ°å€ä¸­æ·»åŠ äº†Hoståå­— kentsun, å…¶ä»–ä¸å˜. å¯å‚è€ƒæˆ‘çš„: deploy: type: git repo: git@kentsun.github.com:KentSun/KentSun.github.io.git branch: master é…ç½®å¤šä¸ªgitè´¦æˆ·é‡å¤ä»¥ä¸Šæ­¥éª¤ã€‚ ä¿®æ”¹remote ä½œç”¨åŸŸ+ æœ€åä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬åœ¨ kentsun å…‹éš†ä¸‹æ¥çš„é¡¹ç›®çš„ remote â€œä½œç”¨åŸŸâ€ ã€‚ $ git remote rm origin $ git remote add origin git@kentsun.github.com:kentsun/123.git // æ³¨æ„æ˜¯ kentsun.github.com $ git push origin master Everything up-to-date]]></content>
      <categories>
        <category>Tool</category>
      </categories>
      <tags>
        <tag>å‰ç«¯Tool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å®‰è£…telnet]]></title>
    <url>%2F2018%2F11%2F11%2F%E5%AE%89%E8%A3%85telnet%2F</url>
    <content type="text"><![CDATA[MacOS 10.12åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œéƒ½å†…ç½®äº†telnetå‘½ä»¤ï¼Œä½†æ˜¯åœ¨ä¹‹åçš„ç‰ˆæœ¬å°±å·²ç»å–æ¶ˆäº†, ä¼šæŠ¥ä¸€ä¸‹é”™è¯¯-bash: telnet: command not found æ‰€ä»¥æ¥ä¸‹æ¥, æˆ‘ä»¬å…ˆæ¥å®‰è£…ä¸‹telnet: ä¸€.telnetå®‰è£… å®‰è£…homebrew /usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot; ä½¿ç”¨ homebrew å®‰è£…telnetï¼š brew install telnet äºŒ.telnetä½¿ç”¨telnetå‘½ä»¤ç”¨äºç™»å½•è¿œç¨‹ä¸»æœºï¼Œå¯¹è¿œç¨‹ä¸»æœºè¿›è¡Œç®¡ç†ã€‚telnetå› ä¸ºé‡‡ç”¨æ˜æ–‡ä¼ é€æŠ¥æ–‡ï¼Œå®‰å…¨æ€§ä¸å¥½ï¼Œå¾ˆå¤šLinuxæœåŠ¡å™¨éƒ½ä¸å¼€æ”¾telnetæœåŠ¡ï¼Œè€Œæ”¹ç”¨æ›´å®‰å…¨çš„sshæ–¹å¼äº†ã€‚ä½†ä»ç„¶æœ‰å¾ˆå¤šåˆ«çš„ç³»ç»Ÿå¯èƒ½é‡‡ç”¨äº†telnetæ–¹å¼æ¥æä¾›è¿œç¨‹ç™»å½•ï¼Œå› æ­¤å¼„æ¸…æ¥štelnetå®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹å¼ä»æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ è¯­æ³•telnet(é€‰é¡¹)(å‚æ•°) é€‰é¡¹-8ï¼šå…è®¸ä½¿ç”¨8ä½å­—ç¬¦èµ„æ–™ï¼ŒåŒ…æ‹¬è¾“å…¥ä¸è¾“å‡ºï¼› -aï¼šå°è¯•è‡ªåŠ¨ç™»å…¥è¿œç«¯ç³»ç»Ÿï¼› -b&lt;ä¸»æœºåˆ«å&gt;ï¼šä½¿ç”¨åˆ«åæŒ‡å®šè¿œç«¯ä¸»æœºåç§°ï¼› -cï¼šä¸è¯»å–ç”¨æˆ·ä¸“å±ç›®å½•é‡Œçš„.telnetrcæ–‡ä»¶ï¼› -dï¼šå¯åŠ¨æ’é”™æ¨¡å¼ï¼› -e&lt;è„±ç¦»å­—ç¬¦&gt;ï¼šè®¾ç½®è„±ç¦»å­—ç¬¦ï¼› -Eï¼šæ»¤é™¤è„±ç¦»å­—ç¬¦ï¼› -fï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®š&quot;-F&quot;å‚æ•°ç›¸åŒï¼› -Fï¼šä½¿ç”¨Kerberos V5è®¤è¯æ—¶ï¼ŒåŠ ä¸Šæ­¤å‚æ•°å¯æŠŠæœ¬åœ°ä¸»æœºçš„è®¤è¯æ•°æ®ä¸Šä¼ åˆ°è¿œç«¯ä¸»æœºï¼› -k&lt;åŸŸå&gt;ï¼šä½¿ç”¨Kerberosè®¤è¯æ—¶ï¼ŒåŠ ä¸Šæ­¤å‚æ•°è®©è¿œç«¯ä¸»æœºé‡‡ç”¨æŒ‡å®šçš„é¢†åŸŸåï¼Œè€Œéè¯¥ä¸»æœºçš„åŸŸåï¼› -Kï¼šä¸è‡ªåŠ¨ç™»å…¥è¿œç«¯ä¸»æœºï¼› -l&lt;ç”¨æˆ·åç§°&gt;ï¼šæŒ‡å®šè¦ç™»å…¥è¿œç«¯ä¸»æœºçš„ç”¨æˆ·åç§°ï¼› -Lï¼šå…è®¸è¾“å‡º8ä½å­—ç¬¦èµ„æ–™ï¼› -n&lt;è®°å½•æ–‡ä»¶&gt;ï¼šæŒ‡å®šæ–‡ä»¶è®°å½•ç›¸å…³ä¿¡æ¯ï¼› -rï¼šä½¿ç”¨ç±»ä¼¼[rlogin](http://man.linuxde.net/rlogin &quot;rloginå‘½ä»¤&quot;)æŒ‡ä»¤çš„ç”¨æˆ·ç•Œé¢ï¼› -S&lt;æœåŠ¡ç±»å‹&gt;ï¼šè®¾ç½®telnetè¿çº¿æ‰€éœ€çš„[ip](http://man.linuxde.net/ip &quot;ipå‘½ä»¤&quot;) TOSä¿¡æ¯ï¼› -xï¼šå‡è®¾ä¸»æœºæœ‰æ”¯æŒæ•°æ®åŠ å¯†çš„åŠŸèƒ½ï¼Œå°±ä½¿ç”¨å®ƒï¼› -X&lt;è®¤è¯å½¢æ€&gt;ï¼šå…³é—­æŒ‡å®šçš„è®¤è¯å½¢æ€ã€‚ å‚æ•° è¿œç¨‹ä¸»æœºï¼šæŒ‡å®šè¦ç™»å½•è¿›è¡Œç®¡ç†çš„è¿œç¨‹ä¸»æœºï¼› ç«¯å£ï¼šæŒ‡å®šTELNETåè®®ä½¿ç”¨çš„ç«¯å£å·ã€‚ å®ä¾‹telnet 192.168.2.10 Trying 192.168.2.10... Connected to 192.168.2.10 (192.168.2.10). Escape character is &#39;^]&#39;. localhost (Linux release 2.6.18-274.18.1.el5 #1 SMP Thu Feb 9 12:45:44 EST 2012) (1) [login](http://man.linuxde.net/login &quot;loginå‘½ä»¤&quot;): root Password: Login incorrect]]></content>
      <categories>
        <category>Tool</category>
      </categories>
      <tags>
        <tag>iOSTool</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä½¿ç”¨runtimeå°è£…å­—å…¸è½¬æ¨¡å‹åˆ†ç±»]]></title>
    <url>%2F2018%2F09%2F28%2F%E4%BD%BF%E7%94%A8runtime%E5%B0%81%E8%A3%85%E5%AD%97%E5%85%B8%E8%BD%AC%E6%A8%A1%E5%9E%8B%E5%88%86%E7%B1%BB%2F</url>
    <content type="text"><![CDATA[å°†åå°JSONæ•°æ®ä¸­çš„å­—å…¸è½¬æˆæœ¬åœ°çš„æ¨¡å‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€‰ç”¨éƒ¨åˆ†ä¼˜ç§€çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œå¦‚SBJSONã€JSONKitã€MJExtensionã€YYModelç­‰ã€‚ä½†æ˜¯ï¼Œä¸€äº›ç®€å•çš„æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•è‡ªå·±æ¥å®ç°è½¬æ¢çš„è¿‡ç¨‹ã€‚ å¿«é€Ÿä½¿ç”¨å½“æˆ‘ä»¬çš„è¯·æ±‚åˆ°çš„æ•°æ®ä¸æ˜¯å¾ˆå¤æ‚, ä¹Ÿä¸å¸Œæœ›å¼•å…¥ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨ä¸‹è¿™ä¸ªåˆ†ç±», æ¥å®ç°å­—å…¸è½¬æ¨¡å‹. 1.æ ¹æ®è¯·æ±‚æ•°æ®, åˆ›å»ºå¯¹åº”çš„æ¨¡å‹ç±», å¹¶æ ¹æ®å­—å…¸ä¸­çš„é”®å€¼å¯¹å®šä¹‰å¯¹åº”çš„å±æ€§ åˆ›å»ºæ¨¡å‹åŸåˆ™: ä»å¤–å±‚åˆ°å†…å­˜, ä¸€ä¸ªç±»å‹å­—å…¸å¯¹åº”ä¸€ä¸ªæ¨¡å‹ ç¤ºä¾‹ç¨‹åºä¸­, æ ¹æ®plist, åˆ›å»ºäº†ä¸‰ä¸ªç±»: ShopItem , AttrModel , ListItemModel æ³¨æ„: å®šä¹‰çš„å±æ€§åå’Œå­—å…¸ä¸­çš„é”®åå­—ä¸€è‡´. 2.åœ¨åˆ†ç±»ä¸­å¯¼å…¥æœ€å¤–å±‚æ¨¡å‹ 3.æœ€å¤–å±‚ç±»ä¸­å¯¼å…¥ NSObject+EnumDict åˆ†ç±» 4.éµå®ˆåˆ†ç±»åè®® ModelDelegate, å®ç°åè®®æ–¹æ³• 5.æ§åˆ¶å™¨ä¸­, å¯¼å…¥æœ€å¤–å±‚æ¨¡å‹ ShopItem.h , è§£ææ•°æ®éå†æ•°ç»„, å¹¶å­—å…¸è½¬æ¨¡å‹ åŸç†è®²è§£runtimeå­—å…¸è½¬æ¨¡å‹çš„æ ¸å¿ƒç®—æ³•æ€è·¯ ä»¥å¾€, æˆ‘ä»¬å­—å…¸è½¬æ¨¡å‹,æ€»æ˜¯éœ€è¦åœ¨æ¨¡å‹ç±»ä¸­å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•æˆ–è€…å¯¹è±¡æ–¹æ³•,æ¥å­—å…¸è½¬æ¨¡å‹, è¿™æ ·, æˆ‘ä»¬åœ¨ä¸åŒçš„æ¨¡å‹ä¸­, éƒ½å¿…é¡»å®šä¹‰è¿™æ ·ä¸€ä¸ªæ–¹æ³•æ¥å®Œæˆå­—å…¸è½¬æ¨¡å‹, å¦‚æœæˆ‘ä»¬å†™çš„é¡¹ç›®æ¯”è¾ƒå¤§, æ¨¡å‹æ¯”è¾ƒå¤š,è¿™æ ·å­—å…¸è½¬æ¨¡å‹çš„æ•ˆç‡å°±å¤ªä½äº†,è€¦åˆæ€§ä¹Ÿæ¯”è¾ƒé«˜, é‚£æˆ‘ä»¬å¦‚ä½•åšåˆ°å­—å…¸è½¬æ¨¡å‹ ä¸ æ¨¡å‹ç±»çš„å½»åº•è§£è€¦å‘¢? æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª NSObject çš„åˆ†ç±», å› ä¸ºæ‰€æœ‰çš„ç±»(NSProxy é™¤å¤–)éƒ½ç»§æ‰¿è‡ª NSObject, é‚£æˆ‘ä»¬å°±å¯ä»¥ç”¨ä»»æ„çš„ç±»å»è°ƒ NSObject çš„è¿™ä¸ªåˆ†ç±»æ–¹æ³•, å­ç±»å¯ä»¥ä»»æ„è°ƒç”¨çˆ¶ç±»æ–¹æ³• é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•åœ¨è¿™ä¸ªåˆ†ç±»æ–¹æ³•ä¸­å®Œæˆå­—å…¸è½¬æ¨¡å‹å‘¢? è¿™é‡Œå°±è¦ç”¨åˆ°è¿è¡Œæ—¶çš„æ¦‚å¿µäº†, é¦–å…ˆæˆ‘ä»¬åœ¨åˆ†ç±»ä¸­å¯¼å…¥ &lt;objc/runtime.h&gt;è¿™ä¸ªæ¡†æ¶, ç„¶åè¿›è¡Œç¬¬ä¸€æ­¥,è·å–å±æ€§åˆ—è¡¨const char *kPropertyListKey = "SKPropertyListKey"; + (NSArray *)sk_objcProperties { /* è·å–å…³è”å¯¹è±¡ */ NSArray *ptyList = objc_getAssociatedObject(self, kPropertyListKey); /* å¦‚æœ ptyList æœ‰å€¼,ç›´æ¥è¿”å› */ if (ptyList) { return ptyList; } /* è°ƒç”¨è¿è¡Œæ—¶æ–¹æ³•, å–å¾—ç±»çš„å±æ€§åˆ—è¡¨ */ /* æˆå‘˜å˜é‡: * class_copyIvarList(__unsafe_unretained Class cls, unsigned int *outCount) * æ–¹æ³•: * class_copyMethodList(__unsafe_unretained Class cls, unsigned int *outCount) * å±æ€§: * class_copyPropertyList(__unsafe_unretained Class cls, unsigned int *outCount) * åè®®: * class_copyProtocolList(__unsafe_unretained Class cls, unsigned int *outCount) */ unsigned int outCount = 0; /** * å‚æ•°1: è¦è·å–å¾—ç±» * å‚æ•°2: ç±»å±æ€§çš„ä¸ªæ•°æŒ‡é’ˆ * è¿”å›å€¼: æ‰€æœ‰å±æ€§çš„æ•°ç»„, C è¯­è¨€ä¸­,æ•°ç»„çš„åå­—,å°±æ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„åœ°å€ */ /* retain, creat, copy éœ€è¦release */ objc_property_t *propertyList = class_copyPropertyList([self class], &outCount); NSMutableArray *mtArray = [NSMutableArray array]; /* éå†æ‰€æœ‰å±æ€§ */ for (unsigned int i = 0; i < outCount; i++) { /* ä»æ•°ç»„ä¸­å–å¾—å±æ€§ */ objc_property_t property = propertyList[i]; /* ä» property ä¸­è·å¾—å±æ€§åç§° */ const char *propertyName_C = property_getName(property); /* å°† C å­—ç¬¦ä¸²è½¬åŒ–æˆ OC å­—ç¬¦ä¸² */ NSString *propertyName_OC = [NSString stringWithCString:propertyName_C encoding:NSUTF8StringEncoding]; [mtArray addObject:propertyName_OC]; } /* è®¾ç½®å…³è”å¯¹è±¡ */ /** * å‚æ•°1 : å¯¹è±¡self * å‚æ•°2 : åŠ¨æ€æ·»åŠ å±æ€§çš„ key * å‚æ•°3 : åŠ¨æ€æ·»åŠ å±æ€§å€¼ * å‚æ•°4 : å¯¹è±¡çš„å¼•ç”¨å…³ç³» */ objc_setAssociatedObject(self, kPropertyListKey, mtArray.copy, OBJC_ASSOCIATION_RETAIN_NONATOMIC); /* é‡Šæ”¾ */ free(propertyList); return mtArray.copy; } å…¶å®ä¸Šé¢è¿™æ®µä»£ç ,åªæœ‰4å¥æ˜¯æœ€å…³é”®çš„1./* è·å–å…³è”å¯¹è±¡ */ NSArray *ptyList = objc_getAssociatedObject(self, kPropertyListKey);å¦‚æœåœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™, æ¨¡å‹å¯¹è±¡çš„å±æ€§æ˜¯ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„, æˆ‘ä»¬åœ¨åˆ©ç”¨è¿™ä¸ªå‡½æ•°å¦‚æœèƒ½è·å–åˆ°å…³è”å¯¹è±¡çš„å±æ€§åˆ—è¡¨, å°±ä¸ç”¨å†èµ°ä¸‹é¢çš„ä»£ç å»åˆ©ç”¨è¿è¡Œæ—¶å†å»è·å–å±æ€§åˆ—è¡¨äº† 2.objc_property_t *propertyList = class_copyPropertyList([self class], &amp;outCount);è¿™å¥ä»£ç å°±æ˜¯çœŸæ­£çš„åˆ©ç”¨è¿è¡Œæ—¶è·å–å±æ€§åˆ—è¡¨, è¿™ä¸ªå±æ€§åˆ—è¡¨æ˜¯ C çš„ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„,æˆ‘ä»¬å¿…é¡»å°†å…¶éå†,å¹¶åˆ©ç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°å°†å–å‡ºç»“æ„ä½“æŒ‡é’ˆæ‰€æŒ‡å‘çš„ç»“æ„ä½“ä¸­å›½çš„ C å­—ç¬¦ä¸²,ä¹Ÿå°±æ˜¯å±æ€§åç§° 3.const char *propertyName_C = property_getName(property);è·å¾—Cå­—ç¬¦ä¸²å,æˆ‘ä»¬åªéœ€è¦å°†å…¶è½¬æ¢ä¸º OC å­—ç¬¦ä¸²,åŠ åˆ°å¯å˜æ•°ç»„ä¸­å³å¯ 4.objc_setAssociatedObject(self, kPropertyListKey, mtArray.copy, OBJC_ASSOCIATION_RETAIN_NONATOMIC);è®¾ç½®å±æ€§åˆ—è¡¨, å°±æ˜¯æŠŠå·²ç»ç”Ÿæˆå¥½çš„å±æ€§åˆ—è¡¨è®¾ç½®åˆ°ä¸€ä¸ªç±»ä¼¼äºå±æ€§çš„ä¸œè¥¿å‚¨å­˜èµ·æ¥, ä¸‹æ¬¡ get çš„æ—¶å€™,ç›´æ¥æ‹¿å‡ºæ¥ç”¨å³å¯,æœ‰ç‚¹ç±»ä¼¼äºæ‡’åŠ è½½. è·å–å±æ€§åˆ—è¡¨ä¹‹å, æˆ‘ä»¬å°±è¦è¿›è¡Œå­—å…¸è½¬æ¨¡å‹çš„æ“ä½œäº†é¦–å…ˆæˆ‘ä»¬è¦éå†å‚æ•°å­—å…¸, å¦‚æœæˆ‘ä»¬è·å–å¾—å±æ€§åˆ—è¡¨ä¸­åŒ…å«äº†å­—å…¸ä¸­çš„ key,å°±åˆ©ç”¨ KVC æ–¹æ³•èµ‹å€¼,ç„¶åå°±å®Œæˆäº†å­—å…¸è½¬æ¨¡å‹çš„æ“ä½œ + (instancetype)sk_objcWithDict:(NSDictionary *)dict { /* å®ä¾‹åŒ–å¯¹è±¡ */ id objc = [[self alloc]init]; /* ä½¿ç”¨å­—å…¸,è®¾ç½®å¯¹è±¡ä¿¡æ¯ */ /* 1\. è·å¾— self çš„å±æ€§åˆ—è¡¨ */ NSArray *propertyList = [self sk_objcProperties]; /* 2\. éå†å­—å…¸ */ [dict enumerateKeysAndObjectsUsingBlock:^(id _Nonnull key, id _Nonnull obj, BOOL * _Nonnull stop) { /* 3\. åˆ¤æ–­ key æ˜¯å¦å­— propertyList ä¸­ */ if ([propertyList containsObject:key]) { /* è¯´æ˜å±æ€§å­˜åœ¨,å¯ä»¥ä½¿ç”¨ KVC è®¾ç½®æ•°å€¼ */ [objc setValue:obj forKey:key]; } }]; /* è¿”å›å¯¹è±¡ */ return objc; } è¿™æ ·, æ¯”å¦‚æˆ‘åœ¨ ViewDidLoad æ–¹æ³•ä¸­, è‡ªå®šä¹‰ä¸€ä¸ªå­—å…¸ç„¶åæˆ‘åªéœ€è¦ä¸€è¡Œä»£ç å°±å¯ä»¥è·å–åˆ°æ¨¡å‹å¯¹è±¡,å¦‚ä¸‹ - (void)viewDidLoad { [super viewDidLoad]; /* åˆ›å»ºä¸€ä¸ªå­—å…¸ */ NSDictionary *dict = @{ @"name":@"å°æ˜", @"age":@18, @"title":@"master", @"height":@1.7, @"something":@"nothing" }; Person *person = [Person sk_objcWithDict:dict]; } è€Œæ­¤æ—¶, æ¨¡å‹ç±»ä¸­,æ²¡æœ‰æ·»åŠ ä»»ä½•çš„æ„é€ æ–¹æ³•,åªæœ‰å•çº¯çš„å±æ€§,è¿™æ ·å°±åšåˆ°äº†å½»åº•çš„è§£è€¦, æ¯”å¦‚æˆ‘ç°åœ¨å†æ¥ä¸€ä¸ªå­¦ç”Ÿ(Student)ç±»,æˆ‘ä¹Ÿæ— éœ€æ·»åŠ æ„é€ æ–¹æ³•,ä¹ŸåŒæ ·åªéœ€è¦è°ƒç”¨-(instancetype)sk_objcWithDict:dict;å³å¯. ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSæŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVOå®˜æ–¹æ–‡æ¡£-é”®å€¼è§‚å¯Ÿè€…æŒ‡å—]]></title>
    <url>%2F2018%2F09%2F18%2FKVO%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E8%A7%82%E5%AF%9F%E8%80%85%E6%8C%87%E5%8D%97%2F</url>
    <content type="text"><![CDATA[KVOç¼–ç¨‹æŒ‡å— Key-Value Observing Programming Guide 1 Introduction to Key-Value Observing Programming Guide - KVOç¼–ç¨‹æŒ‡å—ä»‹ç»Key-value observing is a mechanism that allows objects to be notified of changes to specified properties of other objects. é”® - å€¼è§‚å¯Ÿæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå½“æŒ‡å®šå¯¹è±¡å±æ€§æ”¹å˜çš„æ—¶å€™å…è®¸å¦ä¸€ä¸ªå¯¹è±¡æ¥å—é€šçŸ¥ã€‚ Important: In order to understand key-value observing, you must first understand key-value coding. é‡è¦ï¼šäº†è§£é”®å€¼è§‚å¯Ÿä¹‹å‰ï¼Œé¦–å…ˆè¦ç†è§£é”®å€¼ç¼–ç¨‹ (key-value coding) 1.1 At a Glance - æ¦‚æ‹¬Key-value observing provides a mechanism that allows objects to be notified of changes to specific properties of other objects. It is particularly useful for communication between model and controller layers in an application. (In OS X, the controller layer binding technology relies heavily on key-value observing.) A controller object typically observes properties of model objects, and a view object observes properties of model objects through a controller. In addition, however, a model object may observe other model objects (usually to determine when a dependent value changes) or even itself (again to determine when a dependent value changes). You can observe properties including simple attributes, to-one relationships, and to-many relationships. Observers of to-many relationships are informed of the type of change madeâ€”as well as which objects are involved in the change. There are three steps to setting up an observer of a property. Understanding these three steps provides a clear illustration of how KVO works. é”® - å€¼è§‚å¯Ÿæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå½“æŒ‡å®šå¯¹è±¡å±æ€§æ”¹å˜çš„æ—¶å€™å…è®¸å¦ä¸€ä¸ªå¯¹è±¡æ¥å—é€šçŸ¥ã€‚åœ¨åº”ç”¨ä¸­ï¼Œå¯¹äºæ¨¡å‹å’Œæ§åˆ¶å™¨å±‚ä¹‹é—´çš„äº¤æµéå¸¸æœ‰ç”¨ã€‚ï¼ˆåœ¨ OS X ä¸­ï¼Œæ§åˆ¶å™¨å±‚ç»‘å®šæŠ€æœ¯ä¸¥é‡ä¾èµ–äºé”®-å€¼è§‚å¯Ÿã€‚ï¼‰ä¸€ä¸ªæ§åˆ¶å™¨å¯¹è±¡é€šå¸¸è§‚å¯Ÿæ¨¡å‹å¯¹è±¡çš„å±æ€§ï¼Œè§†å›¾å¯¹è±¡é€šè¿‡æ§åˆ¶å™¨è§‚å¯Ÿæ¨¡å‹å¯¹è±¡çš„å±æ€§ã€‚ç„¶åï¼Œä¸€ä¸ªæ¨¡å‹å¯¹è±¡å¯ä»¥è§‚å¯Ÿå…¶å®ƒæ¨¡å‹å¯¹è±¡ï¼ˆé€šå¸¸ä¸ºäº†ç¡®å®šä»å±å€¼æ˜¯ä»€ä¹ˆæ—¶å€™æ”¹å˜çš„ï¼‰ï¼Œæˆ–è€…ç”šè‡³è§‚å¯Ÿè‡ªèº«ï¼ˆä¹Ÿæ˜¯ä¸ºäº†ç¡®å®šä»å±å€¼ä½•æ—¶å˜åŒ–ï¼‰ã€‚ ä½ å¯ä»¥è§‚å¯Ÿä¸€äº›å±æ€§ï¼Œæ¯”å¦‚ç®€å•çš„å±æ€§ï¼Œä¸€å¯¹ä¸€å…³ç³»çš„ï¼Œä¸€å¯¹å¤šå…³ç³»çš„ã€‚ä¸€å¯¹å¤šå…³ç³»çš„è§‚å¯Ÿè€…å¯ä»¥æ”¶åˆ°å˜åŒ–çš„ç±»å‹ï¼Œä»¥åŠå“ªäº›å¯¹è±¡å‘ç”Ÿäº†æ”¹å˜ã€‚ å»ºç«‹å±æ€§çš„è§‚å¯Ÿè€…æœ‰ä¸‰æ­¥ã€‚ä¸‹é¢æä¾›ä¸€ä¸ªæ¸…æ™°çš„KVOå·¥ä½œæ–¹å¼æ¼”ç¤ºï¼Œæ¥ç†è§£è¿™ä¸‰æ­¥ã€‚ 1.First, see whether you have a scenario where key-value observing could be beneficial, for example, an object that needs to be notified when any changes are made to a specific property in another object. 1.é¦–å…ˆï¼Œè€ƒè™‘è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼Œä¾‹å¦‚å½“å¯¹ä¸€ä¸ªAå¯¹è±¡çš„ç‰¹å®šåšå‡ºä»»ä½•æ”¹å˜çš„æ—¶å€™ï¼ŒBå¯¹è±¡éœ€è¦è¢«é€šçŸ¥ã€‚ 2.The PersonObject must register as an observer of the BankObjectâ€™s accountBalance property by sending an addObserver:forKeyPath:options:context: message. 2.PersonObjectå¿…é¡»æ³¨å†Œä¸º BankObject çš„ accountBalance å±æ€§çš„è§‚å¯Ÿè€…ï¼Œé€šè¿‡å‘é€ä¸€ä¸ªæ¶ˆæ¯ addObserver:forKeyPath:options:context: Note: The addObserver:forKeyPath:options:context: method establishes a connection between the instances of the objects that you specify. A connection is not established between the two classes, but rather between the two specified instances of the objects. æ³¨æ„ï¼šaddObserver:forKeyPath:options:context: æ–¹æ³•è§„å®šäº†ä¸€ä¸ªæŒ‡å®šå¯¹è±¡å®ä¾‹ä¹‹é—´çš„è¿æ¥ã€‚æ³¨æ„ä¸æ˜¯ä¸¤ä¸ªç±»ä¹‹é—´çš„è¿æ¥ï¼Œä¸¤ä¸ªå¯¹è±¡çš„å®ä¾‹ã€‚ 3.In order to respond to change notifications, the observer must implement the observeValueForKeyPath:ofObject:change:context: method. This method implementation defines how the observer responds to change notifications. It is in this method that you can customize your response to a change in one of the observed properties. 3.ä¸ºäº†å“åº”å˜åŒ–çš„é€šçŸ¥ï¼Œè§‚å¯Ÿè€…å¿…é¡»å®ç°æ–¹æ³• observeValueForKeyPath:ofObject:change:context:ã€‚è¿™ä¸ªæ–¹æ³•çš„å®ç°ä¸­å®šä¹‰äº†è§‚å¯Ÿè€…å¦‚ä½•å“åº”æ”¹å˜é€šçŸ¥ã€‚å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å®šåˆ¶è¢«è§‚å¯Ÿå±æ€§ä¹‹ä¸€æ”¹å˜æ—¶çš„å“åº”ã€‚ Registering for Key-Value Observing describes how to register and receive observation notifications. Registering for Key-Value Observingè¯´æ˜å¦‚ä½•æ³¨å†Œå’Œæ¥å—è§‚å¯Ÿçš„é€šçŸ¥ã€‚ 4.The observeValueForKeyPath:ofObject:change:context: method is automatically invoked when the value of an observed property is changed in a KVO-compliant manner, or if a key upon which it depends is changed. 4.å½“è¢«è§‚å¯Ÿå±æ€§çš„å€¼åœ¨KVO-compliantæ–¹å¼ä¸­æ”¹å˜ æˆ–è€…å®ƒä¾èµ–çš„ä¸€ä¸ªkeyæ”¹å˜çš„æ—¶å€™ï¼ŒobserveValueForKeyPath:ofObject:change:context: æ–¹æ³•è‡ªåŠ¨è¢«è°ƒç”¨ã€‚ Registering Dependent Keys explains how to specify that the value of a key is dependent on the value of another key. Registering Dependent Keys è§£é‡Šäº†æŒ‡å®šä¸€ä¸ªé”®çš„å€¼ä¾èµ–äºå¦ä¸€ä¸ªé”®çš„å€¼ã€‚ KVOâ€™s primary benefit is that you donâ€™t have to implement your own scheme to send notifications every time a property changes. Its well-defined infrastructure has framework-level support that makes it easy to adoptâ€”typically you do not have to add any code to your project. In addition, the infrastructure is already full-featured, which makes it easy to support multiple observers for a single property, as well as dependent values. KVO Compliance describes the difference between automatic and manual key-value observing, and how to implement both. Unlike notifications that use NSNotificationCenter, there is no central object that provides change notification for all observers. Instead, notifications are sent directly to the observing objects when changes are made. NSObject provides this base implementation of key-value observing, and you should rarely need to override these methods. Key-Value Observing Implementation Details describes how key-value observing is implemented. KVOçš„ä¼˜ç‚¹æ˜¯ï¼Œæ¯æ¬¡å±æ€§æ”¹å˜çš„æ—¶å€™ï¼Œä¸éœ€è¦è‡ªå·±å®ç°å‘é€é€šçŸ¥ã€‚å®ƒè‰¯å¥½å®šä¹‰çš„åŸºç¡€è®¾æ–½æœ‰æ¶æ„å±‚é¢çš„æ”¯æŒï¼Œä½¿å¾—å®ƒæ˜“äºä½¿ç”¨ï¼Œé€šå¸¸ä¸éœ€è¦å†å·¥ç¨‹ä¸­æ·»åŠ ä»»ä½•ä»£ç ã€‚æ­¤å¤–ï¼ŒåŸºç¡€è®¾æ–½å·²ç»æ˜¯å…¨ç‰¹æ€§çš„ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°æ”¯æŒå•ä¸€å±æ€§çš„å¤šä¸ªè§‚å¯Ÿè€…ï¼Œä»¥åŠç›¸å…³çš„å€¼ã€‚ KVO Compliance æè¿°äº†è‡ªåŠ¨å’Œæ‰‹åŠ¨é”®å€¼è§‚å¯Ÿçš„åŒºåˆ«ï¼Œä»¥åŠå¦‚ä½•å®ç°ä¸¤è€…ã€‚ äºä½¿ç”¨ NSNotificationCenter çš„é€šçŸ¥ä¸åŒï¼Œè¿™é‡Œæ²¡æœ‰ä¸ºæ‰€æœ‰è§‚å¯Ÿè€…æä¾›æ›´æ”¹é€šçŸ¥çš„ä¸­å¤®å¯¹è±¡ï¼Œã€‚ç›¸åï¼Œæ›´æ”¹æ—¶é€šçŸ¥ç›´æ¥è¢«å‘é€åˆ°è§‚å¯Ÿå¯¹è±¡ã€‚NSObject æä¾›äº†é”®å€¼è§‚å¯Ÿçš„åŸºæœ¬å®ç°ï¼Œä½ åº”è¯¥å¾ˆå°‘éœ€è¦é‡å†™è¿™äº›æ–¹æ³•ã€‚ Key-Value Observing Implementation Detailsæè¿°é”®å€¼è§‚å¯Ÿå®¤å¦‚ä½•å®ç°çš„ã€‚ 2 Registering for Key-Value Observing - æ³¨å†Œé”®å€¼è§‚å¯ŸIn order to receive key-value observing notifications for a property, three things are required: The observed class must be key-value observing compliant for the property that you wish to observe. You must register the observing object with the observed object, using the method addObserver:forKeyPath:options:context:. The observing class must implement observeValueForKeyPath:ofObject:change:context:. é’ˆå¯¹ä¸€ä¸ªå±æ€§ï¼Œä¸ºäº†æ¥æ”¶é”®å€¼è§‚å¯Ÿé€šçŸ¥ï¼Œæœ‰3ä¸ªè¦æ±‚ï¼š å¯¹äºä½ å¸Œæœ›è§‚å¯Ÿçš„å±æ€§ï¼Œè¢«è§‚å¯Ÿçš„ç±»å¿…é¡»æ˜¯é”®å€¼è§‚å¯Ÿå…¼å®¹çš„ã€‚ ä½ å¿…é¡»å¯¹è¢«è§‚å¯Ÿçš„å¯¹è±¡æ³¨å†Œè§‚å¯Ÿå¯¹è±¡ï¼Œä½¿ç”¨æ–¹æ³• addObserver:forKeyPath:options:context: è§‚å¯Ÿç±»å¿…é¡»å®ç°æ–¹æ³• observeValueForKeyPath:ofObject:change:context: Important: Not all classes are KVO-compliant for all properties. You can ensure your own classes are KVO-compliant by following the steps described in KVO Compliance. Typically properties in Apple-supplied frameworks are only KVO-compliant if they are documented as such. é‡è¦æç¤ºï¼šä¸æ˜¯æ‰€æœ‰ç±»å¯¹äºæ‰€æœ‰å±æ€§éƒ½æ˜¯KVOå…¼å®¹çš„ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢å‡ ä¸ªæ­¥éª¤ç¡®ä¿ä½ è‡ªå·±çš„ç±»æ˜¯KVOå…¼å®¹çš„ï¼Œåœ¨KVO Complianceä¸­æœ‰æè¿°ã€‚é€šå¸¸ï¼Œå¦‚æœå®ƒä»¬è¢«è®°å½•ä¸ºè¿™ç§è‹¹æœæä¾›çš„æ¡†æ¶å±æ€§ï¼Œé‚£å°±å”¯ä¸€KVOå…¼å®¹çš„ã€‚ 2.1 Registering as an Observer - æ³¨å†Œä¸ºä¸€ä¸ªè§‚å¯Ÿè€…In order to be notified of changes to a property, an observing object must first register with the object to be observed by sending it an addObserver:forKeyPath:options:context: message, passing the observer object and the key path of the property to be observed. The options parameter specifies the information that is provided to the observer when a change notification is sent. Using the option NSKeyValueObservingOptionOld specifies that the original object value is provided to the observer as an entry in the change dictionary. Specifying the NSKeyValueObservingOptionNew option provides the new value as an entry in the change dictionary. To receive both values, you would bitwise OR the option constants. The example in Listing 1 demonstrates registering an inspector object for the property openingBalance. ä¸ºäº†å±æ€§æ”¹å˜æ—¶èƒ½è¢«é€šçŸ¥åˆ°ï¼Œè§‚å¯Ÿå¯¹è±¡é¦–å…ˆè¦å¯¹è¢«è§‚å¯Ÿå¯¹è±¡è¿›è¡Œæ³¨å†Œï¼Œé€šè¿‡ç»™è¢«è§‚å¯Ÿå¯¹è±¡å‘é€æ¶ˆæ¯ addObserver:forKeyPath:options:context: ã€‚ä¼ ç»™çš„å‚æ•°æ˜¯è§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡å±æ€§çš„é”®è·¯å¾„ï¼ˆkey pathï¼‰ã€‚å¯é€‰çš„å‚æ•°æ˜¯å½“æ”¹å˜é€šçŸ¥è¢«å‘é€çš„æ—¶å€™ï¼Œæä¾›ç»™è§‚å¯Ÿè€…çš„æŒ‡å®šä¿¡æ¯ã€‚ä½¿ç”¨é€‰é¡¹ NSKeyValueObservingOptionOld æŒ‡å®šåŸå§‹å¯¹è±¡çš„å€¼ï¼Œåœ¨å˜åŒ–å­—å…¸ä¸­æä¾›ç»™è§‚å¯Ÿè€…ã€‚NSKeyValueObservingOptionNew é€‰é¡¹ï¼Œæä¾›æ–°çš„å€¼ã€‚ä¸ºäº†æ”¶åˆ°è¿™ä¸¤ä¸ªå€¼ï¼Œä½ åº”è¯¥å¯¹è¿™ä¸¤ä¸ªé€‰é¡¹å¸¸é‡ä½¿ç”¨ä½æˆ–ã€‚ æ¸…å•1çš„ä¾‹å­æ¼”ç¤ºç»™ openingBalance å±æ€§æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€… inspector å¯¹è±¡ã€‚ - (void)registerAsObserver { /* æ³¨å†Œ `inspector` ï¼Œæ¥æ¥æ”¶ `account` å¯¹è±¡çš„å±æ€§ `openingBalance` æ”¹å˜æ—¶çš„é€šçŸ¥ï¼Œå¹¶ä¸”æŒ‡å®šæ—§å€¼å’Œæ–°å€¼éƒ½åº”è¯¥æä¾›ç»™è§‚å¯Ÿè€…ã€‚ */ [account addObserver:inspector forKeyPath:@"openingBalance" options:(NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld) context:NULL]; } When you register an object as an observer, you can also provide a context pointer. The context pointer is provided to the observer when observeValueForKeyPath:ofObject:change:context: is invoked. The context pointer can be a C pointer or an object reference. The context pointer can be used as a unique identifier to determine the change that is being observed, or to provide some other data to the observer. Note: The key-value observing addObserver:forKeyPath:options:context: method does not maintain strong references to the observing object, the observed objects, or the context. You should ensure that you maintain strong references to the observing, and observed, objects, and the context as necessary. æ³¨å†Œçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥æä¾›ä¸€ä¸ªä¸Šä¸‹æ–‡æŒ‡é’ˆï¼ˆcontext pointerï¼‰ï¼Œå½“ observeValueForKeyPath:ofObject:change:context: è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œcontext pointer ä¼šè¢«æä¾›ç»™è§‚å¯Ÿè€…ã€‚context pointer å¯ä»¥æ˜¯ä¸€ä¸ª C pointer æˆ–è€… ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ã€‚context pointer å¯ä»¥ç”¨ä½œå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ¥ç¡®å®šæ­£åœ¨è¢«è§‚å¯Ÿå¯¹è±¡çš„å˜åŒ–ï¼Œæˆ–è€…æä¾›æŸäº›å…¶ä»–æ•°æ®ç»™è§‚å¯Ÿè€…ã€‚ æ³¨æ„ï¼šé”®å€¼è§‚å¯Ÿæ–¹æ³• addObserver:forKeyPath:options:context: ï¼Œå¯¹äºè§‚å¯Ÿè€…å¯¹è±¡ï¼Œè¢«è§‚å¯Ÿçš„å¯¹è±¡æˆ–è€… context éƒ½ä¸ä¼šç»´æŒå¼ºå¼•ç”¨ã€‚åœ¨å¿…è¦çš„æ—¶å€™ï¼Œä½ åº”è¯¥è‡ªå·±ç¡®ä¿ä½ å¯¹äºå®ƒä»¬ç»´æŒå¼ºå¼•ç”¨ã€‚ 2.2 Receiving Notification of a Change - é’ˆå¯¹æ”¹å˜æ¥æ”¶é€šçŸ¥When the value of an observed property of an object changes, the observer receives an observeValueForKeyPath:ofObject:change:context: message. All observers must implement this method. The observer is provided the object and key path that triggered the observer notification, a dictionary containing details about the change, and the context pointer that was provided when the observer was registered. The change dictionary entry NSKeyValueChangeKindKey provides information about the type of change that occurred. If the value of the observed object has changed, the NSKeyValueChangeKindKey entry returns NSKeyValueChangeSetting. Depending on the options specified when the observer was registered, the NSKeyValueChangeOldKey and NSKeyValueChangeNewKey entries in the change dictionary contain the values of the property before, and after, the change. If the property is an object, the value is provided directly. If the property is a scalar or a C structure, the value is wrapped in an NSValue object (as with key-value coding). If the observed property is a to-many relationship, the NSKeyValueChangeKindKey entry also indicates whether objects in the relationship were inserted, removed, or replaced by returning NSKeyValueChangeInsertion, NSKeyValueChangeRemoval, or NSKeyValueChangeReplacement, respectively. The change dictionary entry for NSKeyValueChangeIndexesKey is an NSIndexSet object specifying the indexes in the relationship that changed. If NSKeyValueObservingOptionNew or NSKeyValueObservingOptionOld are specified as options when the observer is registered, the NSKeyValueChangeOldKey and NSKeyValueChangeNewKey entries in the change dictionary are arrays containing the values of the related objects before, and after, the change. The example in Listing 2 shows the observeValueForKeyPath:ofObject:change:context: implementation for an inspector that reflects the old and new values of the property openingBalance, as registered in Listing 1. å½“ä¸€ä¸ªæ”¹å˜äº†è¢«è§‚å¯Ÿå¯¹è±¡å±æ€§çš„å€¼ï¼Œè§‚å¯Ÿè€…æ”¶åˆ°æ¶ˆæ¯ observeValueForKeyPath:ofObject:change:context: ã€‚æ‰€æœ‰çš„è§‚å¯Ÿè€…å¿…é¡»å®ç°è¿™ä¸ªæ–¹æ³•ã€‚ è§‚å¯Ÿè€…è¢«æä¾› è§¦å‘è§‚å¯Ÿè€…é€šçŸ¥çš„å¯¹è±¡å’Œ key path ï¼Œå°±æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å˜åŒ–å’Œæ³¨å†Œæ—¶å¡«å†™çš„context pointerã€‚ å˜åŒ–å­—å…¸ä¸­ NSKeyValueChangeKindKey æä¾›äº†å…³äºå‘ç”Ÿå˜åŒ–çš„ä¿¡æ¯ã€‚å¦‚æœè¢«è§‚å¯Ÿå¯¹è±¡çš„å€¼è¢«æ”¹å˜äº†ï¼ŒNSKeyValueChangeKindKey è¿”å› NSKeyValueChangeSetting ã€‚æ ¹æ®è§‚å¯Ÿè€…è¢«æ³¨å†Œæ—¶æŒ‡å®šçš„é€‰é¡¹ï¼ŒNSKeyValueChangeOldKey å’Œ NSKeyValueChangeNewKey ï¼Œåœ¨å˜åŒ–å­—å…¸ä¸­åŒ…å«äº†å±æ€§ä¹‹å‰çš„å€¼ä»¥åŠæ”¹å˜ä¹‹åçš„å€¼ã€‚å¦‚æœå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå€¼ä¼šè¢«ç›´æ¥æä¾›ã€‚å¦‚æœå±æ€§æ˜¯æ ‡é‡æˆ–è€…Cç»“æ„ä½“ï¼Œå€¼ä¼šè¢«åŒ…å«åœ¨ä¸€ä¸ª NSValue å¯¹è±¡ä¸­ï¼ˆæ¯”å¦‚ é”®å€¼ç¼–ç¨‹ï¼‰ã€‚ å¦‚æœè¢«è§‚å¯Ÿçš„å±æ€§æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼ˆæ¯”å¦‚æ•°ç»„ï¼Œé›†åˆï¼‰ï¼ŒNSKeyValueChangeKindKey ä¹Ÿä¼šæŒ‡å®šå…³ç³»ä¸­çš„å¯¹è±¡æ˜¯å¦è¢«è¿”å›çš„ NSKeyValueChangeInsertion æ’å…¥ï¼ŒNSKeyValueChangeRemoval ç§»é™¤æˆ–è€… NSKeyValueChangeReplacement æ›¿ä»£ã€‚ å˜åŒ–å­—å…¸çš„æ¡ç›® NSKeyValueChangeIndexesKey æ˜¯ä¸€ä¸ª NSIndexSet å¯¹è±¡ï¼ŒæŒ‡å‡ºè¢«æ”¹å˜å…³ç³»çš„ä¸‹æ ‡ã€‚å¦‚æœæ³¨å†Œçš„æ—¶å€™ NSKeyValueObservingOptionNew æˆ–è€… NSKeyValueObservingOptionOld è¢«æŒ‡å®šä¸ºé€‰é¡¹ï¼Œå˜åŒ–å­—å…¸ä¸­ NSKeyValueChangeOldKey å’Œ NSKeyValueChangeNewKey å°±ä¼šæ˜¯æ•°ç»„ï¼ŒåŒ…å«äº†ç›¸å…³å¯¹è±¡å˜åŒ–ä¹‹å‰å’Œä¹‹åçš„å€¼ã€‚ æ¸…å•2çš„ä¾‹å­æ¼”ç¤ºäº† observeValueForKeyPath:ofObject:change:context: å®ç° - (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context { if ([keyPath isEqual:@"openingBalance"]) { [openingBalanceInspectorField setObjectValue: [change objectForKey:NSKeyValueChangeNewKey]]; } /* Be sure to call the superclass's implementation *if it implements it*. NSObject does not implement the method. */ [super observeValueForKeyPath:keyPath ofObject:object change:change context:context]; } 2.3 Removing an Object as an Observer ç§»é™¤å¯¹è±¡è§‚å¯Ÿè€…You remove a key-value observer by sending the observed object a removeObserver:forKeyPath: message, specifying the observing object and the key path. The example in Listing 3 removes the inspector as an observer of openingBalance. ä½ å¯ä»¥ç»™è¢«è§‚å¯Ÿå¯¹è±¡å‘é€ä¸€ä¸ªæ¶ˆæ¯ removeObserver:forKeyPath: æ¥ç§»é™¤é”®å€¼è§‚å¯Ÿï¼ŒæŒ‡å®šè§‚å¯Ÿè€…å¯¹è±¡å’Œ key path ã€‚æ¸…å•3 çš„ä¾‹å­ç§»é™¤äº† openingBalance çš„è§‚å¯Ÿè€… inspector ã€‚ - (void)unregisterForChangeNotification { [observedObject removeObserver:inspector forKeyPath:@"openingBalance"]; } If the context is an object, you must keep a strong reference to it until removing the observer. After receiving a removeObserver:forKeyPath: message, the observing object will no longer receive any observeValueForKeyPath:ofObject:change:context: messages for the specified key path and object. å¦‚æœ context æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨ç§»é™¤è§‚å¯Ÿè€…ä¹‹å‰ä½ å¿…é¡»å¯¹å®ƒä¿æŒä¸€ä¸ªå¼ºå¼•ç”¨ã€‚æ¥æ”¶åˆ° removeObserver:forKeyPath: æ¶ˆæ¯åï¼Œè§‚å¯Ÿå¯¹è±¡å°†ä¸åœ¨æ¥æ”¶ä»»ä½•æŒ‡å®š key path å’Œå¯¹è±¡çš„ observeValueForKeyPath:ofObject:change:context: æ¶ˆæ¯ã€‚ 3 KVO Compliance - KVO å…¼å®¹æ€§In order to be considered KVO-compliant for a specific property, a class must ensure the following: The class must be key-value coding compliant for the property, as specified in Ensuring KVC Compliance. KVO supports the same data types as KVC. The class emits KVO change notifications for the property. Dependent keys are registered appropriately (see Registering Dependent Keys). There are two techniques for ensuring the change notifications are emitted. Automatic support is provided by NSObject and is by default available for all properties of a class that are key-value coding compliant. Typically, if you follow standard Cocoa coding and naming conventions, you can use automatic change notificationsâ€”you donâ€™t have to write any additional code. Manual change notification provides additional control over when notifications are emitted, and requires additional coding. You can control automatic notifications for properties of your subclass by implementing the class method automaticallyNotifiesObserversForKey:. è€ƒè™‘åˆ°æŒ‡å®šå±æ€§çš„ KVO-compliantï¼Œç±»å¿…é¡»ç¡®è®¤ä¸‹é¢å‡ ç‚¹ï¼š ç±»å¯¹äºå±æ€§å¿…é¡»è¢«é”®å€¼ç¼–ç¨‹å…¼å®¹ï¼Œåœ¨ Ensuring KVC Compliance ä¸­æœ‰æŒ‡å‡ºã€‚KVOæ”¯æŒä¸KVCç›¸åŒçš„æ•°æ®ç±»å‹ã€‚ ç±»å¯¹äºå±æ€§èƒ½å‘å‡ºKVOæ”¹å˜é€šçŸ¥ã€‚ åœ¨æ³¨å†Œæ—¶é€‚å½“çš„è®¾ç½®ç›¸å…³çš„ key ï¼ˆè§ Registering Dependent Keysï¼‰ æœ‰ä¸¤ç§æŠ€æœ¯ç¡®ä¿æ”¹å˜é€šçŸ¥è¢«å‘å‡ºã€‚è‡ªåŠ¨æ”¯æŒç”± NSObject æä¾›ï¼Œå¹¶ä¸”å¯¹äºä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§é”®å€¼ç¼–ç¨‹å…¼å®¹æ€§éƒ½æ˜¯å¯ç”¨çš„ã€‚é€šå¸¸æ¥è¯´ï¼Œå¦‚æœéµå¾ªæ ‡å‡†çš„Cocoa ç¼–ç¨‹å’Œå‘½åè§„èŒƒï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è‡ªåŠ¨å˜åŒ–é€šçŸ¥ï¼Œä¸ç”¨å†™ä»»ä½•é¢å¤–çš„ä»£ç ã€‚ æ‰‹åŠ¨å˜åŒ–é€šçŸ¥åœ¨å½“é€šçŸ¥è¢«å‘å‡ºçš„æ—¶å€™æä¾›äº†é¢å¤–çš„æ§åˆ¶ï¼Œå¹¶ä¸”éœ€è¦æ·»åŠ ä¸€äº›ä»£ç ã€‚ä½ å¯ä»¥é€šè¿‡å®ç°ç±»æ–¹æ³• automaticallyNotifiesObserversForKey: æ¥æ§åˆ¶ä½ å­ç±»å±æ€§çš„è‡ªåŠ¨é€šçŸ¥ã€‚ 3.1 Automatic Change Notification - è‡ªåŠ¨å˜åŒ–é€šçŸ¥NSObject provides a basic implementation of automatic key-value change notification. Automatic key-value change notification informs observers of changes made using key-value compliant accessors, as well as the key-value coding methods. Automatic notification is also supported by the collection proxy objects returned by, for example, mutableArrayValueForKey:. The examples shown in Listing 1 result in any observers of the property name to be notified of the change. Listing 1 Examples of method calls that cause KVO change notifications to be emitted NSObject æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨é”®å€¼å˜åŒ–é€šçŸ¥çš„åŸºæœ¬å®ç°ã€‚è‡ªåŠ¨é”®å€¼å˜åŒ–é€šçŸ¥å‘ŠçŸ¥æ‰€åšæ”¹å˜çš„è§‚å¯Ÿè€…ä½¿ç”¨é”®å€¼å…¼å®¹çš„ accessorsï¼Œä»¥åŠé”®å€¼ç¼–ç¨‹æ–¹æ³•ã€‚è‡ªåŠ¨é€šçŸ¥ä¹Ÿè¢«è¿”å›çš„é›†åˆä»£ç†å¯¹è±¡æ”¯æŒï¼Œä¾‹å¦‚ mutableArrayValueForKey:ã€‚ æ¸…å•1çš„ä¾‹å­å±•ç¤ºäº†æ”¹å˜æ—¶ï¼Œå±æ€§åè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ä»»ä½•è§‚å¯Ÿè€…çš„ç»“æœã€‚ æ¸…å•1ï¼Œå¯¼è‡´å‘å‡ºKVOå˜åŒ–é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¾‹å­ // Call the accessor method. [account setName:@"Savings"]; // Use setValue:forKey:. [account setValue:@"Savings" forKey:@"name"]; // Use a key path, where 'account' is a kvc-compliant property of 'document'. [document setValue:@"Savings" forKeyPath:@"account.name"]; // Use mutableArrayValueForKey: to retrieve a relationship proxy object. Transaction *newTransaction = ; NSMutableArray *transactions = [account mutableArrayValueForKey:@"transactions"]; [transactions addObject:newTransaction]; 3.2 Manual Change Notification - æ‰‹åŠ¨å˜åŒ–é€šçŸ¥Manual change notification provides more granular control over how and when notifications are sent to observers. This can be useful to help minimize triggering notifications that are unnecessary, or to group a number of changes into a single notification. A class that implements manual notification must override the NSObject implementation of automaticallyNotifiesObserversForKey:. It is possible to use both automatic and manual observer notifications in the same class. For properties that perform manual notification, the subclass implementation of automaticallyNotifiesObserversForKey: should return NO. A subclass implementation should invoke super for any unrecognized keys. The example in Listing 2 enables manual notification for the openingBalance property allowing the superclass to determine the notification for all other keys. Listing 2 Example implementation of automaticallyNotifiesObserversForKey: æ‰‹åŠ¨å˜åŒ–é€šçŸ¥åœ¨å½“é€šçŸ¥è¢«å‘é€ç»™è§‚å¯Ÿè€…çš„æ—¶å€™æä¾›äº†æ›´å¤šç²¾ç»†çš„æ§åˆ¶ã€‚å¯¹äºå‡å°‘ä¸å¿…è¦çš„è§¦å‘é€šçŸ¥ï¼Œæˆ–è€…ä¸€å¤§æ³¢å˜åŒ–ç»™ä¸€ä¸ªé€šçŸ¥ï¼Œéƒ½å¾ˆæœ‰å¸®åŠ©ã€‚ å®ç°æ‰‹åŠ¨é€šçŸ¥çš„ç±»å¿…é¡»é‡å†™ NSObject å®ç°çš„æ–¹æ³• automaticallyNotifiesObserversForKey: ã€‚æœ‰å¯èƒ½åœ¨ç›¸åŒçš„ç±»ä¸­ä½¿ç”¨è‡ªåŠ¨å’Œæ‰‹åŠ¨çš„è§‚å¯Ÿé€šçŸ¥ã€‚å¯¹äºæ‰§è¡Œæ‰‹åŠ¨é€šçŸ¥çš„å±æ€§ï¼Œå­ç±»çš„ automaticallyNotifiesObserversForKey: æ–¹æ³•å®ç°åº”è¯¥è¿”å› NOã€‚å­ç±»å®ç°ä¸­å¯¹äºä»»ä½•ä¸ºç¡®è®¤çš„ keyï¼Œåº”è¯¥è°ƒç”¨çˆ¶ç±»ã€‚æ¸…å•2çš„ä¾‹å­å¯¹äº openingBalance å±æ€§å¯ç”¨äº†æ‰‹åŠ¨é€šçŸ¥ï¼Œå…è®¸çˆ¶ç±»æ¥å†³å®šæ‰€æœ‰å…¶ä»– key çš„é€šçŸ¥ã€‚ æ¸…å•2 automaticallyNotifiesObserversForKey:å®ç°çš„ä¾‹å­ + (BOOL)automaticallyNotifiesObserversForKey:(NSString *)theKey { BOOL automatic = NO; if ([theKey isEqualToString:@"openingBalance"]) { automatic = NO; } else { automatic = [super automaticallyNotifiesObserversForKey:theKey]; } return automatic; } To implement manual observer notification, you invoke willChangeValueForKey: before changing the value, and didChangeValueForKey: after changing the value. The example in Listing 3 implements manual notifications for the openingBalance property. Listing 3 Example accessor method implementing manual notification è¦å®ç°æ‰‹åŠ¨è§‚å¯Ÿé€šçŸ¥ï¼Œåœ¨å€¼å˜åŒ–ä¹‹å‰è¦è°ƒç”¨ willChangeValueForKey:ï¼Œå€¼å˜åŒ–ä¹‹åè¦è°ƒç”¨ didChangeValueForKey: ã€‚æ¸…å•3çš„ä¾‹å­ï¼Œå¯¹äº openingBalance å±æ€§å®ç°äº†æ‰‹åŠ¨é€šçŸ¥ã€‚ æ¸…å•3 accessor æ–¹æ³•å®ç°æ‰‹åŠ¨é€šçŸ¥çš„ä¾‹å­ - (void)setOpeningBalance:(double)theBalance { [self willChangeValueForKey:@"openingBalance"]; _openingBalance = theBalance; [self didChangeValueForKey:@"openingBalance"]; } You can minimize sending unnecessary notifications by first checking if the value has changed. The example in Listing 4 tests the value of openingBalance and only provides the notification if it has changed. Listing 4 Testing the value for change before providing notification ä½ å¯ä»¥å…ˆæ£€æŸ¥å€¼æ˜¯å¦æ”¹å˜ï¼Œæ¥å°†ä¸å¿…è¦å‘é€çš„é€šçŸ¥æœ€å°åŒ–ã€‚æ¸…å•3çš„ä¾‹å­æµ‹è¯•äº† openingBalance çš„å€¼ï¼Œå¹¶ä¸”åªæä¾›äº†å¦‚æœå®ƒæ”¹å˜çš„é€šçŸ¥ã€‚ æ¸…å•4 åœ¨é€šçŸ¥ä¹‹å‰æµ‹è¯•å€¼å¾—å˜åŒ– - (void)setOpeningBalance:(double)theBalance { if (theBalance != _openingBalance) { [self willChangeValueForKey:@&quot;openingBalance&quot;]; _openingBalance = theBalance; [self didChangeValueForKey:@&quot;openingBalance&quot;]; } } If a single operation causes multiple keys to change you must nest the change notifications as shown in Listing 5. Listing 5 Nesting change notifications for multiple keys å¦‚æœä¸€ä¸ªæ“ä½œå¯¼è‡´å¤šä¸ª key çš„å˜åŒ–ï¼Œä½ å¿…é¡»åƒæ¸…å•5 ä¸€æ ·å°†å˜åŒ–é€šçŸ¥è¿›è¡ŒåµŒå¥—ã€‚ æ¸…å•5 å¯¹å¤šä¸ª key å°†å˜åŒ–é€šçŸ¥åµŒå¥— - (void)setOpeningBalance:(double)theBalance { [self willChangeValueForKey:@&quot;openingBalance&quot;]; [self willChangeValueForKey:@&quot;itemChanged&quot;]; _openingBalance = theBalance; _itemChanged = _itemChanged+1; [self didChangeValueForKey:@&quot;itemChanged&quot;]; [self didChangeValueForKey:@&quot;openingBalance&quot;]; } In the case of an ordered to-many relationship, you must specify not only the key that changed, but also the type of change and the indexes of the objects involved. The type of change is an NSKeyValueChange that specifies NSKeyValueChangeInsertion, NSKeyValueChangeRemoval, or NSKeyValueChangeReplacement. The indexes of the affected objects are passed as an NSIndexSet object. The code fragment in Listing 6 demonstrates how to wrap a deletion of objects in the to-many relationship transactions. Listing 6 Implementation of manual observer notification in a to-many relationship åœ¨æœ‰åºï¼Œä¸€å¯¹å¤šå…³ç³»çš„æƒ…å†µä¸‹ï¼Œä½ å¿…é¡»æŒ‡å‡ºä¸ä»… key å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿˜è¦æŒ‡å‡ºå˜åŒ–çš„ç±»å‹ä»¥åŠè¢«è°ƒç”¨å¯¹è±¡çš„ä¸‹æ ‡ã€‚å˜æ¢çš„ç±»å‹æ˜¯ NSKeyValueChange ï¼Œå¯ä»¥æŒ‡å®š NSKeyValueChangeInsertionï¼ŒNSKeyValueChangeRemovalæˆ–è€… NSKeyValueChangeReplacement ã€‚å—å½±å“å¯¹è±¡çš„ç´¢å¼•ä½œä¸º NSIndexSet å¯¹è±¡è¢«ä¼ é€’ã€‚ æ¸…å•6 ä¸€å¯¹å¤šå…³ç³»çš„æ‰‹åŠ¨è§‚å¯Ÿé€šçŸ¥çš„å®ç° - (void)removeTransactionsAtIndexes:(NSIndexSet *)indexes { [self willChange:NSKeyValueChangeRemoval valuesAtIndexes:indexes forKey:@&quot;transactions&quot;]; // Remove the transaction objects at the specified indexes. [self didChange:NSKeyValueChangeRemoval valuesAtIndexes:indexes forKey:@&quot;transactions&quot;]; } 4 Registering Dependent Keys - æ³¨å†Œç›¸å…³ keyThere are many situations in which the value of one property depends on that of one or more other attributes in another object. If the value of one attribute changes, then the value of the derived property should also be flagged for change. How you ensure that key-value observing notifications are posted for these dependent properties depends on the cardinality of the relationship. ä¸€ä¸ªå±æ€§çš„å€¼å–å†³äºä¸€ä¸ªæˆ–è€…å¤šä¸ªå…¶ä»–å¯¹è±¡çš„å±æ€§ï¼Œæœ‰å¾ˆå¤šç§æƒ…å†µã€‚å¦‚æœä¸€ä¸ªå±æ€§å˜åŒ–ï¼Œé‚£ä¹ˆæ´¾ç”Ÿå±æ€§ä¹Ÿåº”è¯¥è¢«æ ‡è®°æ”¹å˜ã€‚å¯¹äºè¿™äº›ç›¸å…³å±æ€§ä¾èµ–äºå…³ç³»çš„åŸºæ•°ï¼Œä½ å¦‚æœç¡®ä¿é€šçŸ¥è¢«å‘å‡ºã€‚ 4.1 To-one Relationships - ä¸€å¯¹ä¸€å…³ç³»To trigger notifications automatically for a to-one relationship you should either override keyPathsForValuesAffectingValueForKey: or implement a suitable method that follows the pattern it defines for registering dependent keys. For example, the full name of a person is dependent on both the first and last names. A method that returns the full name could be written as follows: å¯¹äºä¸€å¯¹ä¸€å…³ç³»ï¼Œä¸ºäº†è‡ªåŠ¨è§¦å‘é€šçŸ¥ï¼Œä½ åº”è¯¥é‡å†™ keyPathsForValuesAffectingValueForKey: æ–¹æ³•ï¼Œæˆ–è€…å®ç°ä¸€ä¸ªåˆé€‚çš„æ–¹æ³•ï¼Œéµå¾ªä¸€ç§æ¨¡å¼ï¼Œå®ƒå®šä¹‰å–å†³äºæ³¨å†Œç›¸å…³çš„keyã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªäººçš„å…¨åä¾èµ–äºäººçš„å§“å’Œåã€‚ä¸€ä¸ªè¿”å›å…¨åçš„æ–¹æ³•å¯ä»¥å†™æˆä¸‹é¢å½¢å¼ï¼š - (NSString *)fullName { return [NSString stringWithFormat:@"%@ %@",firstName, lastName]; } An application observing the fullName property must be notified when either the firstName or lastName properties change, as they affect the value of the property. One solution is to override keyPathsForValuesAffectingValueForKey: specifying that the fullName property of a person is dependent on the lastName and firstName properties. Listing 1 shows an example implementation of such a dependency: Listing 1 Example implementation of keyPathsForValuesAffectingValueForKey: åº”ç”¨è§‚å¯Ÿ fullName å±æ€§ï¼Œå¿…é¡»æ³¨æ„åˆ°å½“ firstName æˆ–è€… lastName å±æ€§å˜åŒ–æ—¶ï¼Œä¼šå½±å“åˆ° fullNameå±æ€§çš„å€¼ã€‚ ä¸€ç§è§£å†³æ–¹æ³•æ˜¯é‡å†™ keyPathsForValuesAffectingValueForKey: ï¼ŒæŒ‡å®šäººçš„ fullName å±æ€§ä¾èµ–äº lastName å’Œ firstName å±æ€§ã€‚æ¸…å•1 å±•ç¤ºäº†è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š æ¸…å•1 keyPathsForValuesAffectingValueForKey: çš„å®ç°ä¾‹å­ + (NSSet *)keyPathsForValuesAffectingValueForKey:(NSString *)key { NSSet *keyPaths = [super keyPathsForValuesAffectingValueForKey:key]; if ([key isEqualToString:@"fullName"]) { NSArray *affectingKeys = @[@"lastName", @"firstName"]; keyPaths = [keyPaths setByAddingObjectsFromArray:affectingKeys]; } return keyPaths; } Your override should typically invoke super and return a set that includes any members in the set that result from doing that (so as not to interfere with overrides of this method in superclasses). You can also achieve the same result by implementing a class method that follows the naming convention keyPathsForValuesAffecting, where is the name of the attribute (first letter capitalized) that is dependent on the values. Using this pattern the code in Listing 1 could be rewritten as a class method named keyPathsForValuesAffectingFullName as shown in Listing 2. Listing 2 Example implementation of the keyPathsForValuesAffecting naming convention é‡å†™ï¼Œé€šå¸¸åº”è¯¥è°ƒç”¨ super ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ª set ï¼ŒåŒ…æ‹¬è¿™æ ·åšçš„å¯¼è‡´ç»“æœçš„ä»»ä½•æˆå‘˜ã€‚ï¼ˆåœ¨çˆ¶ç±»ä¸­ä¸è¦å› ä¸ºè¿™ä¸ªæ–¹æ³•çš„é‡å†™é€ æˆå¹²æ‰°ï¼‰ã€‚ ä½ ä¹Ÿå¯ä»¥é€šè¿‡å®ç°ä¸€ä¸ªç±»æ–¹æ³•è¾¾åˆ°åŒæ ·çš„ç»“æœï¼Œéµå¾ªå‘½åçº¦å®š keyPathsForValuesAffectingï¼Œ æ˜¯å±æ€§åï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ï¼Œä¾èµ–äºå€¼ã€‚æ¸…å•1ä¸­ä½¿ç”¨è¿™ç§æ¨¡å¼çš„ä»£ç ï¼Œå¯ä»¥åƒåœ¨æ¸…å•2ä¸­è¢«é‡å†™ä¸ºä¸€ä¸ªç±»æ–¹æ³• keyPathsForValuesAffectingFullName ã€‚ æ¸…å•2 keyPathsForValuesAffecting å‘½åçº¦å®šçš„å®ç°ä¾‹å­ + (NSSet *)keyPathsForValuesAffectingFullName { return [NSSet setWithObjects:@&quot;lastName&quot;, @&quot;firstName&quot;, nil]; } You canâ€™t override the keyPathsForValuesAffectingValueForKey: method when you add a computed property to an existing class using a category, because youâ€™re not supposed to override methods in categories. In that case, implement a matching keyPathsForValuesAffecting class method to take advantage of this mechanism. Note: You cannot set up dependencies on to-many relationships by implementing keyPathsForValuesAffectingValueForKey:. Instead, you must observe the appropriate attribute of each of the objects in the to-many collection and respond to changes in their values by updating the dependent key yourself. The following section shows a strategy for dealing with this situation. å½“ä½ ä½¿ç”¨ä¸€ä¸ª category ç»™ä¸€ä¸ªç°æœ‰çš„ç±»æ·»åŠ ä¸€ä¸ªè®¡ç®—å±æ€§çš„æ—¶å€™ï¼Œä½ ä¸èƒ½é‡å†™ keyPathsForValuesAffectingValueForKey: æ–¹æ³•ï¼Œå› ä¸ºä¸å…è®¸é‡å†™åˆ†ç±»ï¼ˆcategoriesï¼‰ä¸­çš„æ–¹æ³•ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå®ç°ä¸€ä¸ªåŒ¹é…çš„ keyPathsForValuesAffecting&lt;Key&gt; ç±»æ–¹æ³•ï¼Œä½“ç°äº†è¿™ç§æœºåˆ¶çš„ä¼˜åŠ¿ã€‚ æ³¨æ„ï¼šä½ ä¸èƒ½é€šè¿‡å®ç° keyPathsForValuesAffectingValueForKey: æ–¹æ³•å»ºç«‹ä¾èµ–äºä¸€å¯¹å¤šçš„å…³ç³»ã€‚ç›¸åï¼Œä½ å¿…é¡»è§‚å¯Ÿä¸€å¯¹å¤šé›†åˆä¸­å¯¹è±¡çš„æ¯ä¸ªå“åº”å±æ€§ï¼Œå¹¶é€šè¿‡æ›´æ–°è‡ªå·±ä¾èµ–çš„ key æ¥å“åº”å®ƒä»¬å€¼çš„å˜åŒ–ã€‚ä¸‹é¢ä¸€èŠ‚è®²äº†å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ç§ç­–ç•¥ã€‚ 4.2 To-many Relationships - ä¸€å¯¹å¤šå…³ç³»The keyPathsForValuesAffectingValueForKey: method does not support key-paths that include a to-many relationship. For example, suppose you have a Department object with a to-many relationship (employees) to a Employee, and Employee has a salary attribute. You might want the Department object have a totalSalary attribute that is dependent upon the salaries of all the Employees in the relationship. You can not do this with, for example, keyPathsForValuesAffectingTotalSalary and returning employees.salary as a key. There are two possible solutions in both situations: 1.You can use key-value observing to register the parent (in this example, Department) as an observer of the relevant attribute of all the children (Employees in this example). You must add and remove the parent as an observer as child objects are added to and removed from the relationship (see Registering for Key-Value Observing). In the observeValueForKeyPath:ofObject:change:context: method you update the dependent value in response to changes, as illustrated in the following code fragment: keyPathsForValuesAffectingValueForKey: æ–¹æ³•ä¸æ”¯æŒåŒ…å«ä¸€å¯¹å¤šå…³ç³»çš„ key-pathã€‚ä¾‹å¦‚ï¼ŒDepartment å¯¹è±¡æœ‰ä¸€ä¸ªä¸€å¯¹å¤šçš„å…³ç³» å¯¹äº Employeeï¼ŒEmployee æœ‰ salary å±æ€§ã€‚ä½ å¸Œæœ› Department å¯¹è±¡æœ‰ä¸€ä¸ª totalSalary å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¾èµ–äºæ‰€æœ‰ Employeesã€‚ä½ ä¸èƒ½åƒä¸‹é¢è¿™æ ·ï¼ŒkeyPathsForValuesAffectingTotalSalary å¹¶ä¸”å°† employees.salary ä½œä¸ºä¸€ä¸ª key è¿”å›ã€‚ åœ¨ä¸¤ç§æƒ…å†µä¸­æœ‰ä¸¤ä¸ªå¯èƒ½çš„è§£å†³æ–¹æ³•ï¼š 1.å¯ä»¥ä½¿ç”¨é”®å€¼è§‚å¯Ÿæ³¨å†Œ parent(ä¾‹å­ä¸­å°±æ˜¯ Department) ä½œä¸ºæ‰€æœ‰ childrenï¼ˆEmployeesï¼‰ ç›¸å…³å±æ€§çš„è§‚å¯Ÿè€…ã€‚ä½ å¿…é¡»æ·»åŠ å’Œç§»é™¤ parent ã€‚åœ¨ observeValueForKeyPath:ofObject:change:context: æ–¹æ³•ä¸­ï¼Œåœ¨å“åº”å˜åŒ–ä¸­æ›´æ–°ç›¸å…³çš„å€¼ï¼Œå°±åƒä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š - (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context { if (context == totalSalaryContext) { [self updateTotalSalary]; } else // deal with other observations and/or invoke super... } - (void)updateTotalSalary { [self setTotalSalary:[self valueForKeyPath:@&quot;employees.@sum.salary&quot;]]; } - (void)setTotalSalary:(NSNumber *)newTotalSalary { if (totalSalary != newTotalSalary) { [self willChangeValueForKey:@&quot;totalSalary&quot;]; _totalSalary = newTotalSalary; [self didChangeValueForKey:@&quot;totalSalary&quot;]; } } - (NSNumber *)totalSalary { return _totalSalary; } 2.If youâ€™re using Core Data, you can register the parent with the applicationâ€™s notification center as an observer of its managed object context. The parent should respond to relevant change notifications posted by the children in a manner similar to that for key-value observing. 2.å¦‚æœä½¿ç”¨Core Dataï¼Œä½ å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„é€šçŸ¥ä¸­å¿ƒæ³¨å†Œ parent ä½œä¸ºå®ƒç®¡ç†çš„å¯¹è±¡ context çš„è§‚å¯Ÿè€…ã€‚parent åº”è¯¥å“åº” ä¸é”®å€¼è§‚å¯Ÿç±»ä¼¼æ–¹å¼è¢« children å‘å‡ºçš„çš„å˜åŒ–é€šçŸ¥ã€‚ 4.3 Key-Value Observing Implementation Details - é”®å€¼è§‚å¯Ÿå®ç°ç»†èŠ‚Automatic key-value observing is implemented using a technique called isa-swizzling. The isa pointer, as the name suggests, points to the objectâ€™s class which maintains a dispatch table. This dispatch table essentially contains pointers to the methods the class implements, among other data. When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class. As a result the value of the isa pointer does not necessarily reflect the actual class of the instance. You should never rely on the isa pointer to determine class membership. Instead, you should use the class method to determine the class of an object instance. è‡ªåŠ¨é”®å€¼è§‚å¯Ÿæ˜¯ä½¿ç”¨ä¸€ç§ç§°ä¸º isa-swizzling çš„æŠ€æœ¯å®ç°ã€‚ isa æŒ‡é’ˆï¼Œé¡¾åæ€ä¹‰ï¼Œåªæƒ³ä¸€ä¸ªå¯¹è±¡çš„ç±»ï¼Œç»´æŒä¸€ä¸ªè°ƒåº¦è¡¨ã€‚è¿™ä¸ªè°ƒåº¦è¡¨åŸºæœ¬ä¸ŠåŒ…å«æŒ‡å‘ç±»çš„æ–¹æ³•å®ç°ä»¥åŠå…¶ä»–æ•°æ®çš„æŒ‡é’ˆã€‚ å½“ä¸€ä¸ªè§‚å¯Ÿè€…è¢«æ³¨å†Œï¼Œè¢«è§‚å¯Ÿè€…å¯¹è±¡çš„ isa æŒ‡é’ˆæ‰€æŒ‡çš„å¯¹è±¡çš„å±æ€§è¢«ä¿®æ”¹ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªä¸­é—´çš„ç±»è€Œä¸æ˜¯çœŸæ­£çš„ç±»ã€‚ç»“æœå°±æ˜¯ isa æŒ‡é’ˆçš„å€¼å¹¶ä¸ä¸€å®šåæ˜ å®é™…ç±»çš„å®ä¾‹ã€‚ ä½ åº”è¯¥æ°¸è¿œä¸è¦ä¾é  isa æŒ‡é’ˆæ¥ç¡®å®šç±»æˆå‘˜èµ„æ ¼ã€‚ç›¸åï¼Œä½ åº”è¯¥ä½¿ç”¨ class æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡å®ä¾‹çš„ç±»ã€‚ è‹¹æœå®˜æ–¹æ–‡æ¡£åœ°å€ï¼šKey-Value Observing Programming Guide ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬äºŒéƒ¨åˆ†6]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%866%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬6èŠ‚2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬6èŠ‚ Key-Value Coding Fundamatalsâ€“Accessor Search Patterns##è®¿é—®å™¨æœç´¢æ–¹å¼ NSObjecté»˜è®¤å®ç°NSKeyValueCodingåè®®æä¾›çš„åŸºäºé”®çš„è®¿é—®å™¨ï¼Œä½¿ç”¨ä¸€ç»„æ˜ç¡®å®šä¹‰çš„è§„åˆ™æ¥è°ƒç”¨å¯¹è±¡çš„åŸºç¡€å±æ€§ã€‚è¿™äº›åè®®æ–¹æ³•ä½¿ç”¨é”®å‚æ•°åœ¨å…¶è‡ªå·±çš„å¯¹è±¡å®ä¾‹ä¸­æœç´¢è®¿é—®å™¨ï¼Œå®ä¾‹å˜é‡ä»¥åŠéµå¾ªæŸäº›å‘½åçº¦å®šçš„ç›¸å…³æ–¹æ³•ã€‚å°½ç®¡æ‚¨å¾ˆå°‘ä¿®æ”¹æ­¤é»˜è®¤æœç´¢ï¼Œ ä½†äº†è§£å®ƒçš„å·¥ä½œæ–¹å¼ä¼šæœ‰æ‰€å¸®åŠ©ï¼Œå¯¹äºè·Ÿè¸ªé”®å€¼ç¼–ç å¯¹è±¡çš„è¡Œä¸ºï¼Œä¹Ÿå¯ä»¥ä½¿æ‚¨è‡ªå·±çš„å¯¹è±¡å…¼å®¹ã€‚ æ³¨æ„æœ¬èŠ‚ä¸­çš„æè¿°ä½¿ç”¨&lt;key&gt;æˆ–&lt;Key&gt;ä½œä¸ºé”®å­—ç¬¦ä¸²çš„å ä½ç¬¦ï¼Œè¯¥é”®å­—ç¬¦ä¸²åœ¨ä¸€ä¸ªé”®å€¼ç¼–ç åè®®æ–¹æ³•ä¸­ä½œä¸ºå‚æ•°å‡ºç°ï¼Œç„¶åè¯¥æ–¹æ³•å°†è¯¥é”®å­—ç¬¦ä¸²ç”¨ä½œé—´æ¥æ–¹æ³•è°ƒç”¨æˆ–å˜é‡åç§°æŸ¥æ‰¾çš„ä¸€éƒ¨åˆ†ã€‚æ˜ å°„çš„å±æ€§åç§°éµå¾ªå ä½ç¬¦å¤§å°å†™çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå¯¹äºgetter&lt;key&gt;å’Œis&lt;KEY &gt;ï¼Œåä¸º hidden çš„å±æ€§æ˜ å°„ä¸ºhiddenå’ŒisHidden .ã€‚ åŸºæœ¬çš„Getteræœç´¢æ¨¡å¼valueForKeyï¼šçš„é»˜è®¤å®ç°ï¼Œç»™å®šä¸€ä¸ªkeyå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œåœ¨æ¥æ”¶valueForKeyï¼šè°ƒç”¨çš„ç±»å®ä¾‹ä¸­æ“ä½œï¼Œæ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ã€‚ 1.æœç´¢å®ä¾‹ä¸åç§°ï¼ŒæŒ‰ç…§è¯¥é¡ºåºï¼Œæœç´¢æ‰¾åˆ°çš„åç§°ä¸ºget&lt;Key&gt;ã€&lt;key&gt;ã€is&lt;Key&gt;æˆ–&lt;key&gt;çš„ç¬¬ä¸€ä¸ªè®¿é—®å™¨æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°ï¼Œè°ƒç”¨å®ƒå¹¶ç»§ç»­åˆ°æ­¥éª¤5ã€‚å¦åˆ™è¯·ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚ 2.å¦‚æœæ‰¾ä¸åˆ°ç®€å•å–å€¼æ–¹æ³•, åˆ™åœ¨å®ä¾‹ä¸­æœç´¢å…¶æ–¹æ³•åå½¢å¦‚ countOf&lt;Key&gt;å’ŒobjectIn&lt;Key&gt;AtIndex: ï¼ˆç›¸å½“äºNSArrayç±»ä¸­å®šä¹‰çš„åŸºæœ¬æ–¹æ³•ï¼‰å’Œ&lt;key&gt;AtIndexes:ï¼ˆç›¸å½“äºNSArrayç±»ä¸­çš„objectsAtIndexes:æ–¹æ³•ï¼‰çš„æ–¹æ³•ã€‚ å¦‚æœç¬¬ä¸€ä¸ªæ–¹æ³•å’Œåè¾¹ä¸¤ä¸ªæ–¹æ³•ä¸­çš„è‡³å°‘ä¸€ä¸ªæ–¹æ³•è¢«å®ç°äº†, åˆ™åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå“åº”æ‰€æœ‰NSArrayæ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„é›†åˆä»£ç†å¯¹è±¡ã€‚å¦åˆ™, ç»§ç»­æ‰§è¡Œæ­¥éª¤3ã€‚ ä»£ç†å¯¹è±¡éšåå°†å®ƒæ¥æ”¶çš„ä»»ä½•NSArrayæ¶ˆæ¯è½¬æ¢ä¸ºcountOf &lt;Key&gt;ï¼ŒobjectIn &lt;Key&gt; AtIndexï¼šå’Œ&lt;key&gt; AtIndexesï¼šçš„æ¶ˆæ¯ï¼Œå¹¶å°†å…¶å‘é€ç»™åˆ›å»ºå®ƒçš„é”®å€¼ç¼–ç å…¼å®¹å¯¹è±¡ã€‚å¦‚æœåŸå§‹å¯¹è±¡è¿˜å®ç°äº†ä¸€ä¸ªåä¸ºget &lt;Key&gt;ï¼šrangeï¼šçš„å¯é€‰æ–¹æ³•ï¼Œåˆ™ä»£ç†å¯¹è±¡ä¹Ÿä¼šåœ¨é€‚å½“æ—¶ä½¿ç”¨è¯¥æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œä¸ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡ä¸€èµ·å·¥ä½œçš„ä»£ç†å¯¹è±¡å…è®¸åº•å±‚å±æ€§çš„è¡Œä¸ºå°±åƒå®ƒæ˜¯ä¸€æ ·NSArrayï¼Œå³ä½¿å®ƒä¸æ˜¯ã€‚ 3.å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç®€å•çš„è®¿é—®å™¨æ–¹æ³•æˆ–æ•°ç»„è®¿é—®æ–¹æ³•ç»„ï¼Œè¯·æŸ¥æ‰¾åä¸ºcountOf &lt;Key&gt;ï¼ŒenumeratorOf &lt;Key&gt;å’ŒmemberOf &lt;Key&gt;ï¼šçš„æ–¹æ³•çš„ä¸‰ä¸ªæ–¹æ³•ï¼ˆå¯¹åº”äºNSSetç±»å®šä¹‰çš„åŸå§‹æ–¹æ³•ï¼‰ã€‚ å¦‚æœæ‰¾åˆ°æ‰€æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œè¯·åˆ›å»ºä¸€ä¸ªå“åº”æ‰€æœ‰NSSetæ–¹æ³•å¹¶è¿”å›è¯¥æ–¹æ³•çš„é›†åˆä»£ç†å¯¹è±¡ã€‚ å¦åˆ™ï¼Œè¯·ç»§ç»­æ‰§è¡Œæ­¥éª¤4ã€‚ è¿™ä¸ªä»£ç†å¯¹è±¡éšåå°†å®ƒæ¥æ”¶çš„ä»»ä½•NSSetæ¶ˆæ¯è½¬æ¢ä¸ºcount Of &lt;Key&gt;ï¼Œenumeration of &lt;Key&gt;å’Œmember Of &lt;Key&gt;ï¼šæ¶ˆæ¯åˆ°åˆ›å»ºå®ƒçš„å¯¹è±¡ã€‚å®é™…ä¸Šï¼Œä¸ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡ä¸€èµ·å·¥ä½œçš„ä»£ç†å¯¹è±¡å…è®¸åº•å±‚å±æ€§çš„è¡Œä¸ºå°±åƒå®ƒæ˜¯ä¸€æ ·NSSetï¼Œå³ä½¿å®ƒä¸æ˜¯ã€‚ 4.å¦‚æœæ‰¾ä¸åˆ°ç®€å•è®¿é—®å™¨æ–¹æ³•æˆ–é›†åˆè®¿é—®æ–¹æ³•ç»„, å¹¶ä¸”æ¶ˆæ¯æ¥æ”¶è€…çš„ç±»æ–¹æ³•accessInstanceVariablesDirectlyè¿”å›YES, åˆ™ç³»ç»ŸæŒ‰ä»¥ä¸‹é¡ºåºæœç´¢åä¸º:_&lt;key&gt;ã€ _is&lt;Key&gt;ã€ &lt;key&gt;æˆ–is&lt;Key&gt;çš„å®ä¾‹å˜é‡ã€‚å¦‚æœæ‰¾åˆ°, åˆ™ç›´æ¥è·å–å®ä¾‹å˜é‡çš„å€¼, ç„¶åç»§ç»­æ‰§è¡Œæ­¥éª¤5ã€‚å¦åˆ™, ç»§ç»­è·³è½¬åˆ°æ­¥éª¤6ã€‚ 5.å¦‚æœè·å–åˆ°çš„å±æ€§å€¼æ˜¯å¯¹è±¡æŒ‡é’ˆ,å³è·å–çš„æ˜¯å¯¹è±¡, åˆ™ç›´æ¥å°†å¯¹è±¡è¿”å›ã€‚ å¦‚æœè·å–åˆ°çš„å±æ€§å€¼æ˜¯NSNumberæ”¯æŒçš„æ•°æ®ç±»å‹, åˆ™å°†å…¶å­˜å‚¨åœ¨NSNumberå®ä¾‹å¹¶è¿”å›ã€‚å¦‚æœè·å–åˆ°çš„å±æ€§å€¼ä¸æ˜¯ NSNumber æ”¯æŒçš„ç±»å‹, åˆ™è½¬æ¢ä¸ºNSValueå¯¹è±¡, ç„¶åè¿”å›ã€‚ 6.å¦‚æœä¸Šè¿°æ‰€æœ‰æ–¹æ³•éƒ½æ²¡æœ‰æ‰§è¡Œï¼Œåˆ™è°ƒç”¨valueForUndefinedKeyï¼šã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¼šå¼•å‘å¼‚å¸¸ï¼Œä½†NSObjectçš„å­ç±»å¯ä»¥é€šè¿‡é‡è½½å¹¶æ ¹æ®ç‰¹å®škeyåšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚ åŸºæœ¬çš„Setteræœç´¢æ–¹å¼setValue:forKey:çš„é»˜è®¤å®ç°, ç»™å®škeyå’Œvalueå‚æ•°ä½œä¸ºè¾“å…¥, åœ¨æ¥æ”¶è°ƒç”¨çš„å¯¹è±¡å†…å°è¯•å°†åä¸ºkeyçš„å±æ€§è®¾ç½®ä¸ºvalue(æˆ–è€…, å¯¹äºéå¯¹è±¡å±æ€§, åˆ™ä¸ºunwarp value, è¯¦è§Representing Non-Object Values), ä½¿ç”¨ä»¥ä¸‹è¿‡ç¨‹: 1.æŒ‰ç…§é¡ºåºæŸ¥æ‰¾ç¬¬ä¸€ä¸ªåä¸ºset&lt;Key&gt;:æˆ–_set&lt;Key&gt;çš„æ–¹æ³•ã€‚å¦‚æœæ‰¾åˆ°, ä¼ å…¥è¾“å…¥å€¼ (æˆ–æ ¹æ®éœ€è¦å±•å¼€å€¼) è°ƒç”¨å®ƒ, ç„¶åå®Œæˆã€‚ 2.å¦‚æœæ‰¾ä¸åˆ°ç®€å•è®¿é—®å™¨, å¹¶ä¸”ç±»æ–¹æ³•accessInstanceVariablesDirectlyè¿”å›YES, åˆ™æŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾å®ä¾‹å˜é‡: _&lt;key&gt;ã€ _is&lt;Key&gt;ã€&lt;key&gt;ã€is&lt;Key&gt; ã€‚å¦‚æœæ‰¾åˆ°, åˆ™ç›´æ¥ä½¿ç”¨è¾“å…¥å€¼ (æˆ–å±•å¼€å€¼) è®¾ç½®å˜é‡å¹¶å®Œæˆã€‚ 3.å¦‚æœæ‰¾ä¸åˆ°ä»¥ä¸Šæ–¹æ³•æˆ–å®ä¾‹å˜é‡, åˆ™è°ƒç”¨setValue:forUndefinedKey:ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¼šå¼•å‘å¼‚å¸¸ï¼Œä½†NSObjectçš„å­ç±»å¯ä»¥é€šè¿‡é‡è½½å¹¶æ ¹æ®ç‰¹å®škeyåšä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚ å¯å˜æ•°ç»„çš„æœç´¢æ–¹å¼mutableArrayValueForKeyï¼šçš„é»˜è®¤å®ç°ï¼Œç»™å®šä¸€ä¸ªkeyå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œä½¿ç”¨ä»¥ä¸‹è¿‡ç¨‹ä¸ºæ¥æ”¶è®¿é—®è€…è°ƒç”¨çš„å¯¹è±¡å†…çš„ä¸€ä¸ªåä¸ºkeyçš„å±æ€§è¿”å›ä¸€ä¸ªå¯å˜ä»£ç†æ•°ç»„ï¼š 1.æŸ¥æ‰¾ä¸€å¯¹æ–¹æ³•, åä¸ºinsertObjectï¼šin &lt;Key&gt; AtIndexï¼šå’ŒremoveObjectFrom &lt;Key&gt; AtIndexï¼šçš„æ–¹æ³•ï¼ˆåˆ†åˆ«å¯¹åº”äºNSMutableArrayåŸå§‹æ–¹æ³•insertObjectï¼šatIndexï¼šå’ŒremoveObjectAtIndexï¼šï¼‰ ï¼Œæˆ–è€…åç§°ç±»ä¼¼äºinsert &lt;Key&gt;ï¼šatIndexesï¼šå’Œremove &lt;Key&gt; AtIndexesï¼šï¼ˆå¯¹åº”äºNSMutableArrayinsertObjectsï¼šatIndexesï¼šå’ŒremoveObjectsAtIndexesï¼šæ–¹æ³•ï¼‰ã€‚ å¦‚æœå¯¹è±¡è‡³å°‘å®ç°ä¸€ä¸ªæ’å…¥æ–¹æ³•å’Œè‡³å°‘ä¸€ä¸ªåˆ é™¤æ–¹æ³•ï¼Œåˆ™è¿”å›ä¸€ä¸ªå“åº”NSMutableArrayæ¶ˆæ¯çš„ä»£ç†å¯¹è±¡ï¼Œæ–¹æ³•æ˜¯å‘é€insertObjectï¼šin &lt;Key&gt; AtIndexï¼šï¼ŒremoveObjectFrom &lt;Key&gt; AtIndexï¼šï¼Œinsert &lt;Key&gt;ï¼šatIndexesï¼šï¼Œå’Œremove &lt;Key&gt; AtIndexesï¼šæ¶ˆæ¯åˆ°mutableArrayValueForKeyï¼šçš„åŸå§‹æ¥æ”¶è€…ã€‚ å½“æ¥æ”¶mutableArrayValueForKeyï¼šæ¶ˆæ¯çš„å¯¹è±¡ä¹Ÿå®ç°äº†ä¸€ä¸ªå¯é€‰çš„æ›¿æ¢å¯¹è±¡æ–¹æ³•ï¼Œå…¶åç§°å¦‚replaceObjectIn &lt;Key&gt; AtIndexï¼šwithObjectï¼šæˆ–replace &lt;Key&gt; AtIndexesï¼šwith &lt;Key&gt;ï¼šï¼Œä»£ç†å¯¹è±¡åœ¨é€‚åˆæœ€ä½³æ€§èƒ½æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥å¯é€‰æ–¹æ³•ã€‚ 2.å¦‚æœå¯¹è±¡æ²¡æœ‰å¯å˜æ•°ç»„æ–¹æ³•ï¼Œåˆ™æŸ¥æ‰¾åç§°ä¸æ¨¡å¼set &lt;Key&gt;ï¼šåŒ¹é…çš„è®¿é—®å™¨æ–¹æ³•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡å‘mutableArrayValueForKeyï¼šçš„åŸå§‹æ¥æ”¶è€…å‘å‡ºset &lt;Key&gt;ï¼šæ¶ˆæ¯ï¼Œè¿”å›å“åº”NSMutableArrayæ¶ˆæ¯çš„ä»£ç†å¯¹è±¡ã€‚ æ³¨æ„:æ­¤æ­¥éª¤ä¸­æè¿°çš„æœºåˆ¶æ¯”ä¸Šä¸€æ­¥çš„æ•ˆç‡è¦ä½å¾—å¤š, å› ä¸ºå®ƒå¯èƒ½æ¶‰åŠé‡å¤åˆ›å»ºæ–°çš„é›†åˆå¯¹è±¡, è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„ã€‚å› æ­¤, åœ¨è®¾è®¡è‡ªå·±çš„é”®å€¼ç¼–ç å…¼å®¹å¯¹è±¡æ—¶, é€šå¸¸åº”é¿å…è¿™ç§æƒ…å†µã€‚ 3.å¦‚æœæ—¢æ²¡æœ‰æ‰¾åˆ°å¯å˜æ•°ç»„æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰æ‰¾åˆ°è®¿é—®å™¨ï¼Œå¹¶ä¸”æ¥æ”¶è€…çš„ç±»å¯¹accessInstanceVariablesDirectlyå“åº”â€™YESï¼Œåˆ™æŒ‰ç…§é¡ºåºæœç´¢åä¸º_ æˆ–`çš„å®ä¾‹å˜é‡ã€‚ å¦‚æœæ‰¾åˆ°è¿™æ ·çš„å®ä¾‹å˜é‡ï¼Œåˆ™è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†å®ƒæ¥æ”¶çš„æ¯ä¸ªNSMutableArrayæ¶ˆæ¯è½¬å‘ç»™å®ä¾‹å˜é‡çš„å€¼ï¼Œè¯¥å€¼é€šå¸¸æ˜¯NSMutableArrayçš„å®ä¾‹æˆ–å…¶å­ç±»ä¹‹ä¸€ã€‚ 4.å¦‚æœæ‰€æœ‰å…¶ä»–æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œåªè¦æ”¶åˆ°NSMutableArrayæ¶ˆæ¯ï¼Œå°±è¿”å›ä¸€ä¸ªå¯å˜é›†åˆä»£ç†å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å‘mutableArrayValueForKeyï¼šæ¶ˆæ¯çš„åŸå§‹æ¥æ”¶è€…å‘å‡ºsetValueï¼šforUndefinedKeyï¼šæ¶ˆæ¯ã€‚ setValue:forUndefinedKey:çš„é»˜è®¤å®ç°ä¼šæŠ›å‡ºNSUndefinedKeyExceptionå¼‚å¸¸, ä½†å­ç±»å¯èƒ½ä¼šé‡å†™æ­¤è¡Œä¸ºã€‚ å¯å˜æœ‰åºé›†çš„æœç´¢æ–¹å¼mutableOrderedSetValueForKeyçš„é»˜è®¤å®ç°ï¼šå°†ç›¸åŒçš„ç®€å•è®¿é—®å™¨æ–¹æ³•å’Œæœ‰åºé›†è®¿é—®å™¨æ–¹æ³•è¯†åˆ«ä¸ºvalueForKey :(è¯·å‚é˜… Default Search Pattern for the Basic Getterï¼‰ï¼Œå¹¶éµå¾ªç›¸åŒçš„ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ç­–ç•¥ï¼Œä½†å§‹ç»ˆè¿”å›å¯å˜é›†åˆä»£ç†å¯¹è±¡ valueForKeyï¼šè¿”å›çš„ä¸å¯å˜é›†åˆã€‚ æ­¤å¤–ï¼Œå®ƒè¿˜æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š 1.æœç´¢åç§°ç±»ä¼¼äºä»¥ä¸‹å½¢å¼çš„æ–¹æ³•: insertObjectï¼šin &lt;Key&gt; AtIndexï¼šå’ŒremoveObjectFrom &lt;Key&gt; AtIndexï¼šï¼ˆå¯¹åº”äºNSMutableOrderedSetç±»å®šä¹‰çš„ä¸¤ä¸ªæœ€åŸå§‹æ–¹æ³•ï¼‰ï¼Œä»¥åŠinsert &lt;Key&gt;ï¼š atIndexesï¼šå’Œremove &lt;Key&gt; AtIndexesï¼šï¼ˆå¯¹åº”äºinsertObjectsï¼šatIndexesï¼šå’ŒremoveObjectsAtIndexesï¼šï¼‰ã€‚ å¦‚æœæ‰¾åˆ°è‡³å°‘ä¸€ä¸ªinsertæ–¹æ³•å’Œè‡³å°‘ä¸€ä¸ªremoveæ–¹æ³•ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡æ¯æ¬¡æ¥æ”¶åˆ° NSMutableOrderedSetçš„æ¶ˆæ¯åï¼Œ ä¼šé€šè¿‡ä»¥ä¸‹ç»„åˆæ–¹æ³•ç»™mutableOrderedSetValueForKeyçš„åŸå§‹å¯¹è±¡ å‘é€æ¶ˆæ¯: mutableOrderedSetValueForKey: insertObject:in&lt;Key&gt;AtIndex:, removeObjectFrom &lt;Key&gt; AtIndex :, insert &lt;Key&gt;ï¼šatIndexesï¼š remove&lt;Key&gt;AtIndexes: ä»£ç†å¯¹è±¡è¿˜ä½¿ç”¨æ–¹æ³•åä¸º replaceObjectIn &lt;Key&gt; AtIndexï¼šwithObjectï¼š çš„æ–¹æ³•ï¼Œæˆ–replace&lt;Key&gt;AtIndexes:with&lt;Key&gt;: ,å½“è¿™äº›æ–¹æ³•å­˜åœ¨äºåŸå§‹å¯¹è±¡ä¸­æ—¶ã€‚ 2.å¦‚æœæ‰¾ä¸åˆ°å¯å˜çš„setæ–¹æ³•ï¼Œè¯·æœç´¢åä¸ºset &lt;Key&gt;ï¼šçš„è®¿é—®å™¨æ–¹æ³•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡æ¯æ¬¡æ”¶åˆ°NSMutableOrderedSetæ¶ˆæ¯æ—¶éƒ½ä¼šå‘mutableOrderedSetValueForKeyï¼šçš„åŸå§‹æ¥æ”¶è€…å‘é€ä¸€ä¸ªset &lt;Key&gt;ï¼šæ¶ˆæ¯ã€‚ æ³¨æ„æ­¤æ­¥éª¤ä¸­æè¿°çš„æœºåˆ¶æ¯”å‰ä¸€æ­¥éª¤çš„æ•ˆç‡ä½å¾—å¤šï¼Œå› ä¸ºå®ƒå¯èƒ½æ¶‰åŠé‡å¤åˆ›å»ºæ–°çš„é›†åˆå¯¹è±¡è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„é›†åˆå¯¹è±¡ã€‚ å› æ­¤ï¼Œåœ¨è®¾è®¡è‡ªå·±çš„ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡æ—¶ï¼Œé€šå¸¸åº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚ 3.å¦‚æœæ‰¾ä¸åˆ°å¯å˜é›†æ¶ˆæ¯å’Œè®¿é—®å™¨ï¼Œå¹¶ä¸”æ¥æ”¶è€…çš„accessInstanceVariablesDirectlyç±»æ–¹æ³•è¿”å›YESï¼Œåˆ™æŒ‰é¡ºåºæœç´¢åç§°å¦‚_ &lt;key&gt;æˆ–&lt;key&gt;çš„å®ä¾‹å˜é‡ã€‚ å¦‚æœæ‰¾åˆ°è¿™æ ·çš„å®ä¾‹å˜é‡ï¼Œåˆ™è¿”å›çš„ä»£ç†å¯¹è±¡å°†å®ƒæ¥æ”¶çš„ä»»ä½•NSMutableOrderedSetæ¶ˆæ¯è½¬å‘ç»™å®ä¾‹å˜é‡çš„å€¼ï¼Œè¯¥å€¼é€šå¸¸æ˜¯NSMutableOrderedSetæˆ–å…¶å­ç±»ä¹‹ä¸€çš„å®ä¾‹ã€‚ 4.å¦‚æœæ‰€æœ‰å…¶ä»–æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œé‚£ä¹ˆåªè¦æ”¶åˆ°ä¸€ä¸ªå¯å˜çš„setæ¶ˆæ¯ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡å°±ä¼šå‘mutableOrderedSetValueForKeyï¼šçš„åŸå§‹æ¥æ”¶è€…å‘é€ä¸€ä¸ªsetValueï¼šforUndefinedKeyï¼šæ¶ˆæ¯ã€‚ setValueï¼šforUndefinedKeyï¼šçš„é»˜è®¤å®ç°å¼•å‘äº†ä¸€ä¸ªNSUndefinedKeyExceptionï¼Œä½†æ˜¯å¯¹è±¡å¯èƒ½ä¼šè¦†ç›–æ­¤è¡Œä¸ºã€‚ å¯å˜é›†çš„æœç´¢æ–¹å¼mutableSetValueForKeyï¼šçš„é»˜è®¤å®ç°ï¼Œç»™å®šä¸€ä¸ªkeyå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œä½¿ç”¨ä»¥ä¸‹è¿‡ç¨‹ä¸ºæ¥æ”¶è®¿é—®è€…è°ƒç”¨çš„å¯¹è±¡å†…çš„ä¸€ä¸ªåä¸ºkeyçš„æ•°ç»„å±æ€§è¿”å›ä¸€ä¸ªå¯å˜ä»£ç†é›†ï¼š 1.æœç´¢æ–¹æ³•åç§°ä¸ºadd&lt;Key&gt;Object:å’Œ remove &lt;Key&gt; Object çš„æ–¹æ³•ï¼šï¼ˆåˆ†åˆ«å¯¹åº”äºNSMutableSetåŸå§‹æ–¹æ³•addObject:å’ŒremoveObject:ï¼‰ä»¥åŠadd&lt;Key&gt;ï¼šå’Œremove&lt;Key&gt;:ï¼ˆå¯¹åº”äºNSMutableSet æ–¹æ³•unionSet:å’ŒminusSet: ï¼‰ã€‚å¦‚æœæ‰¾åˆ°è‡³å°‘ä¸€ä¸ªæ·»åŠ æ–¹æ³•å’Œè‡³å°‘ä¸€ä¸ªåˆ é™¤æ–¹æ³•ï¼Œåˆ™è¿”å›ä¸€ä¸ªNSMutableSetä»£ç†å¯¹è±¡ï¼Œè¯¥ä»£ç†å¯¹è±¡å‘é€add &lt;Key&gt; Objectï¼šï¼Œremove &lt;Key&gt; Objectï¼šï¼Œadd &lt;Key&gt;ï¼šçš„æŸç§ç»„åˆï¼Œ å’Œremove &lt;Key&gt;ï¼šå¯¹äºå®ƒæ”¶åˆ°çš„æ¯ä¸ªNSMutableSetæ¶ˆæ¯çš„mutableSetValueForKeyï¼šçš„åŸå§‹æ¥æ”¶è€…çš„æ¶ˆæ¯ã€‚ ä»£ç†å¯¹è±¡è¿˜ä½¿ç”¨åç§°ä¸ºâ€œcrossï¼šâ€æˆ–â€œsetï¼šâ€çš„æ–¹æ³•æ¥æé«˜æ€§èƒ½ï¼ˆå¦‚æœå¯ç”¨çš„è¯ï¼‰ã€‚ 2.å¦‚æœmutableSetValueForKeyï¼šè°ƒç”¨çš„æ¥æ”¶è€…æ˜¯æ‰˜ç®¡å¯¹è±¡ï¼Œåˆ™æœç´¢æ¨¡å¼ä¸ä¼šåƒéæ‰˜ç®¡å¯¹è±¡é‚£æ ·ç»§ç»­ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…â€œCore Data Programming Guideâ€ä¸­çš„æ‰˜ç®¡å¯¹è±¡è®¿é—®å™¨æ–¹æ³•ã€‚ 3.å¦‚æœæ‰¾ä¸åˆ°å¯å˜é›†åˆæ–¹æ³•ï¼Œå¹¶ä¸”å¯¹è±¡ä¸æ˜¯æ‰˜ç®¡å¯¹è±¡ï¼Œåˆ™æœç´¢åä¸ºset &lt;Key&gt;ï¼šçš„è®¿é—®å™¨æ–¹æ³•ã€‚ å¦‚æœæ‰¾åˆ°è¿™æ ·çš„æ–¹æ³•ï¼Œåˆ™è¿”å›çš„ä»£ç†å¯¹è±¡å°†set &lt;Key&gt;ï¼šæ¶ˆæ¯å‘é€ç»™å®ƒæ¥æ”¶çš„æ¯ä¸ªNSMutableSetæ¶ˆæ¯çš„mutableSetValueForKeyï¼šçš„åŸå§‹æ¥æ”¶è€…ã€‚ æ³¨æ„æ­¤æ­¥éª¤ä¸­æè¿°çš„æœºåˆ¶çš„æ•ˆç‡è¿œä½äºç¬¬ä¸€æ­¥çš„æœºåˆ¶ï¼Œå› ä¸ºå®ƒå¯èƒ½æ¶‰åŠé‡å¤åˆ›å»ºæ–°çš„é›†åˆå¯¹è±¡è€Œä¸æ˜¯ä¿®æ”¹ç°æœ‰çš„é›†åˆå¯¹è±¡ã€‚ å› æ­¤ï¼Œåœ¨è®¾è®¡è‡ªå·±çš„ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡æ—¶ï¼Œé€šå¸¸åº”è¯¥é¿å…ä½¿ç”¨å®ƒã€‚ 4.å¦‚æœæ‰¾ä¸åˆ°å¯å˜çš„setæ–¹æ³•å’Œaccessoræ–¹æ³•ï¼Œå¹¶ä¸”accessInstanceVariablesDirectlyç±»æ–¹æ³•è¿”å›YESï¼Œåˆ™æŒ‰ç…§é¡ºåºæœç´¢åä¸º_ &lt;key&gt;æˆ–&lt;key&gt;çš„å®ä¾‹å˜é‡ã€‚ å¦‚æœæ‰¾åˆ°è¿™æ ·çš„å®ä¾‹å˜é‡ï¼Œåˆ™ä»£ç†å¯¹è±¡å°†å®ƒæ¥æ”¶çš„æ¯ä¸ªNSMutableSetæ¶ˆæ¯è½¬å‘ç»™å®ä¾‹å˜é‡çš„å€¼ï¼Œè¯¥å€¼é€šå¸¸æ˜¯NSMutableSetçš„å®ä¾‹æˆ–å…¶å­ç±»ä¹‹ä¸€ã€‚ 5.å¦‚æœæ‰€æœ‰å…¶ä»–æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œè¿”å›çš„ä»£ç†å¯¹è±¡é€šè¿‡å‘mutableSetValueForKeyï¼š&#39;çš„åŸå§‹æ¥æ”¶è€…å‘é€setValueï¼šforUndefinedKeyï¼šæ¶ˆæ¯æ¥å“åº”å®ƒæ”¶åˆ°çš„ä»»ä½•NSMutableSet`æ¶ˆæ¯ã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬äºŒéƒ¨åˆ†5]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%865%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬5èŠ‚2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬5èŠ‚ Key-Value Coding Fundamatalsâ€“Validating PropertieséªŒè¯å±æ€§é”®å€¼ç¼–ç åè®®å®šä¹‰äº†æ”¯æŒå±æ€§éªŒè¯çš„æ–¹æ³•ã€‚å°±åƒä½¿ç”¨åŸºäºé”®çš„è®¿é—®å™¨æ¥è¯»å–å’Œå†™å…¥ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡çš„å±æ€§ä¸€æ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥æŒ‰é”®ï¼ˆæˆ–é”®è·¯å¾„ï¼‰éªŒè¯å±æ€§ã€‚å½“æ‚¨è°ƒç”¨validateValue:forKey:error:(æˆ–validateValue:forKeyPath:error:) æ–¹æ³•æ—¶ï¼Œ åè®®çš„é»˜è®¤å®ç°å°†æœç´¢æ¥æ”¶éªŒè¯æ¶ˆæ¯çš„å¯¹è±¡ (æˆ–åœ¨é”®è·¯å¾„çš„æœ«å°¾çš„å¯¹è±¡)ï¼Œ ä»¥æŸ¥æ‰¾åç§°ä¸æ¨¡å¼åŒ¹é…çš„æ–¹æ³•validate&lt;Key&gt;:error:ã€‚å¦‚æœå¯¹è±¡æ²¡æœ‰æ­¤ç±»æ–¹æ³•ï¼Œ åˆ™é»˜è®¤æƒ…å†µä¸‹éªŒè¯æˆåŠŸ, é»˜è®¤å®ç°è¿”å›YES`ã€‚å½“å­˜åœ¨å±æ€§ç‰¹å®šçš„éªŒè¯æ–¹æ³•æ—¶ï¼Œ é»˜è®¤å®ç°å°†è¿”å›è°ƒç”¨è¯¥æ–¹æ³•çš„ç»“æœã€‚ æ³¨æ„æ‚¨é€šå¸¸ä»…åœ¨Objective-Cä¸­ä½¿ç”¨æ­¤å¤„æè¿°çš„éªŒè¯ã€‚åœ¨ Swift ä¸­, é€šè¿‡ä¾èµ– optionals å’Œå¼ºç±»å‹æ£€æŸ¥çš„ç¼–è¯‘å™¨æ”¯æŒ, å¯ä»¥æ›´ä¾¿æ·åœ°å¤„ç†å±æ€§éªŒè¯, åŒæ—¶ä½¿ç”¨å†…ç½®çš„ willSet å’Œ didSet å±æ€§è§‚å¯Ÿå™¨æ¥æµ‹è¯•ä»»ä½•è¿è¡Œæ—¶ API åå®š, è¯¦è§The Swift Programming Language (Swift 4.2)ä¸­Property Observersç« èŠ‚å¯¹willSet didSetçš„æè¿°ã€‚ ç”±äºå±æ€§ç‰¹å®šçš„éªŒè¯æ–¹æ³•é€šè¿‡å¼•ç”¨çš„æ–¹å¼æ¥æ”¶å€¼å’Œé”™è¯¯å‚æ•°, å› æ­¤éªŒè¯æœ‰ä¸‰ç§å¯èƒ½çš„ç»“æœ: éªŒè¯æ–¹æ³•åˆ¤æ–­å€¼å¯¹è±¡æœ‰æ•ˆå¹¶è¿”å›YESè€Œä¸æ”¹å˜å€¼æˆ–é”™è¯¯ã€‚ éªŒè¯æ–¹æ³•åˆ¤æ–­å€¼å¯¹è±¡æ— æ•ˆ, ä½†é€‰æ‹©ä¸æ›´æ”¹å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, è¯¥æ–¹æ³•è¿”å›NOå¹¶å°†é”™è¯¯å¼•ç”¨ (å¦‚æœè°ƒç”¨æ–¹æä¾›) è®¾ç½®åˆ°NSErroræŒ‡ç¤ºå¤±è´¥åŸå› çš„å¯¹è±¡ã€‚ éªŒè¯æ–¹æ³•åˆ¤æ–­å€¼å¯¹è±¡æ— æ•ˆ, ä½†åˆ›å»ºä¸€ä¸ªæ–°çš„ã€æœ‰æ•ˆçš„å¯¹è±¡ä½œä¸ºæ›¿æ¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, è¯¥æ–¹æ³•è¿”å›YESåŒæ—¶ä¿æŒé”™è¯¯å¯¹è±¡ä¸å˜ã€‚è¿”å›ä¹‹å‰, è¯¥æ–¹æ³•ä¿®æ”¹å€¼å¼•ç”¨ä»¥æŒ‡å‘æ–°å€¼å¯¹è±¡ã€‚å½“å®ƒè¿›è¡Œä¿®æ”¹æ—¶, è¯¥æ–¹æ³•æ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡, è€Œä¸æ˜¯ä¿®æ”¹æ—§å€¼, å³ä½¿ value å¯¹è±¡æ˜¯å¯å˜çš„ã€‚ æ¸…å• 6-1æ˜¾ç¤ºäº†å¦‚ä½•è°ƒç”¨nameå­—ç¬¦ä¸²çš„éªŒè¯çš„ç¤ºä¾‹ã€‚ Person* person = [[Person alloc] init]; NSError* error; NSString* name = @"John"; if (![person validateValue:&name forKey:@"name" error:&error]) { NSLog(@"%@",error); } è‡ªåŠ¨éªŒè¯é€šå¸¸, é”®å€¼ç¼–ç åè®®åŠå…¶é»˜è®¤å®ç°éƒ½ä¸å®šä¹‰ä»»ä½•è‡ªåŠ¨æ‰§è¡ŒéªŒè¯çš„æœºåˆ¶ã€‚ç›¸å, æ‚¨å¯ä»¥åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨é€‚åˆçš„éªŒè¯æ–¹æ³•ã€‚ æŸäº›å…¶ä»–CocoaæŠ€æœ¯åœ¨æŸäº›æƒ…å†µä¸‹ä¼šè‡ªåŠ¨è¿›è¡ŒéªŒè¯ã€‚ä¾‹å¦‚, Core Dataä¼šåœ¨ä¿å­˜æ‰˜ç®¡å¯¹è±¡ä¸Šä¸‹æ–‡æ—¶è‡ªåŠ¨æ‰§è¡ŒéªŒè¯ (è¯¦è§Core Data Programming Guide)ã€‚æ­¤å¤–, åœ¨ macOS ä¸­, Cocoa Bindings å…è®¸æ‚¨æŒ‡å®šéªŒè¯æ˜¯å¦è‡ªåŠ¨è¿›è¡Œ (è¯·é˜…è¯»Cocoa Bindings Programming Topicsäº†è§£æœ‰å…³Cocoa Bindingsçš„æ›´å¤šä¿¡æ¯ã€‚)ã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬äºŒéƒ¨åˆ†4]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%864%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬4èŠ‚2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬4èŠ‚ Key-Value Coding Fundamatalsâ€“Representing Non-Object Valuesè¡¨ç¤ºéå¯¹è±¡å€¼é€šè¿‡NSObjectä½¿ç”¨å¯¹è±¡å’Œéå¯¹è±¡å±æ€§æä¾›çš„é”®å€¼ç¼–ç åè®®æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚ é»˜è®¤å®ç°è‡ªåŠ¨åœ¨å¯¹è±¡å‚æ•°æˆ–è¿”å›å€¼ä»¥åŠéå¯¹è±¡å±æ€§ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ è¿™å…è®¸å³ä½¿å­˜å‚¨çš„å±æ€§æ˜¯æ ‡é‡æˆ–ç»“æ„ä½“ï¼ŒåŸºäºkeyçš„getterå’Œsetterçš„å‘½åä¹Ÿä¿æŒä¸€è‡´ã€‚ æ³¨æ„å› ä¸ºSwiftä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æœ¬èŠ‚ä»…é€‚ç”¨äºObjective-Cå±æ€§ã€‚ å½“ä½ è°ƒç”¨åè®®çš„å…¶ä¸­ä¸€ä¸ªgetteræ—¶ï¼ŒvalueForKeyï¼šï¼Œé»˜è®¤å®ç°æ ¹æ®Accessor Search Patternsä¸­æè¿°çš„è§„åˆ™ ç¡®å®šä¸ºæŒ‡å®šé”®æä¾›å€¼çš„ç‰¹å®šè®¿é—®å™¨æ–¹æ³•æˆ–å®ä¾‹å˜é‡ã€‚ å¦‚æœè¿”å›å€¼ä¸æ˜¯å¯¹è±¡ï¼Œåˆ™getterä½¿ç”¨æ­¤å€¼åˆå§‹åŒ–NSNumberå¯¹è±¡ï¼ˆå¯¹äºæ ‡é‡ï¼‰æˆ–NSValueå¯¹è±¡ï¼ˆå¯¹äºç»“æ„ä½“ï¼‰å¹¶è¿”å›è¯¥å€¼ã€‚ åŒæ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒåƒsetValueï¼šforKey:è¿™æ ·çš„setteråœ¨ç»™å®šç‰¹å®šé”®çš„æƒ…å†µä¸‹ç¡®å®šå±æ€§çš„è®¿é—®å™¨æˆ–å®ä¾‹å˜é‡æ‰€éœ€çš„æ•°æ®ç±»å‹ã€‚ å¦‚æœæ•°æ®ç±»å‹ä¸æ˜¯å¯¹è±¡ï¼Œåˆ™setteré¦–å…ˆå‘ä¼ å…¥å€¼å¯¹è±¡å‘é€é€‚å½“çš„&lt;type&gt; Valueæ¶ˆæ¯ä»¥æå–åŸºç¡€æ•°æ®ï¼Œå¹¶å­˜å‚¨è¯¥æ•°æ®ã€‚ æ³¨æ„å½“æ‚¨ä½¿ç”¨éå¯¹è±¡å±æ€§çš„nilå€¼è°ƒç”¨å…¶ä¸­ä¸€ä¸ªKVCåè®®setteræ—¶ï¼Œsetteræ²¡æœ‰æ˜æ˜¾çš„ä¸€èˆ¬æ“ä½œè¿‡ç¨‹ã€‚ å› æ­¤ï¼Œå®ƒå‘æ¥æ”¶setterè°ƒç”¨çš„å¯¹è±¡å‘é€setNilValueForKeyï¼šæ¶ˆæ¯ã€‚ æ­¤æ–¹æ³•çš„é»˜è®¤å®ç°å¼•å‘NSInvalidArgumentExceptionå¼‚å¸¸ï¼Œä½†å­ç±»å¯èƒ½ä¼šè¦†ç›–æ­¤è¡Œä¸ºï¼Œå¦‚Handling Non-Object Valuesä¸­æ‰€è¿°ï¼Œä¾‹å¦‚è®¾ç½®æ ‡è®°å€¼æˆ–æä¾›æœ‰æ„ä¹‰çš„é»˜è®¤å€¼ã€‚ åŒ…è£…å’Œè§£åŒ…æ ‡é‡ç±»å‹Table 5-1 åˆ—å‡ºé»˜è®¤KVCå®ç°ä½¿ç”¨NSNumberå®ä¾‹åŒ…è£…çš„æ ‡é‡ç±»å‹ã€‚ å¯¹äºæ¯ç§æ•°æ®ç±»å‹ï¼Œè¯¥è¡¨æ˜¾ç¤ºç”¨äºåˆå§‹åŒ–NSNumberåŸºç¡€å±æ€§å€¼ä»¥æä¾›getterè¿”å›å€¼çš„åˆ›å»ºæ–¹æ³•ã€‚ ç„¶åæ˜¾ç¤ºç”¨äºåœ¨è®¾ç½®æ“ä½œæœŸé—´ä»setterè¾“å…¥å‚æ•°ä¸­æå–å€¼çš„è®¿é—®å™¨æ–¹æ³•ã€‚ Table 5-1 æ ‡é‡ç±»å‹åŒ…å«åœ¨NSNumberå¯¹è±¡ä¸­ Data type Creation method Accessor method BOOL numberWithBool: boolValue (in iOS) charValue (in macOS)* char numberWithChar: charValue double numberWithDouble: doubleValue float numberWithFloat: floatValue int numberWithInt: intValue long numberWithLong: longValue long long numberWithLongLong: longLongValue short numberWithShort: shortValue unsigned char numberWithUnsignedChar: unsignedChar unsigned int numberWithUnsignedInt: unsignedInt unsigned long numberWithUnsignedLong: unsignedLong unsigned long long numberWithUnsignedLongLong: unsignedLongLong unsigned short numberWithUnsignedShort: unsignedShort æ³¨æ„*åœ¨macOSä¸­ï¼Œç”±äºå†å²åŸå› ï¼ŒBOOLçš„ç±»å‹å®šä¹‰ä¸ºsigned charï¼Œè€ŒKVCä¸åŒºåˆ†è¿™äº›ã€‚ å› æ­¤ï¼Œå½“keyä¸ºBOOLæ—¶ï¼Œä¸åº”å°†å­—ç¬¦ä¸²å€¼ï¼ˆä¾‹å¦‚@â€œtrueâ€æˆ–@â€œYESâ€ï¼‰ä¼ é€’ç»™setValueï¼šforKeyï¼šã€‚ KVCå°†å°è¯•è°ƒç”¨charValueï¼ˆå› ä¸ºBOOLæœ¬èº«å°±æ˜¯ä¸€ä¸ªcharï¼‰ï¼Œä½†æ˜¯NSStringæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¼šå¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ã€‚ ç›¸åï¼Œå½“keyä¸ºBOOLæ—¶ï¼Œåªä¼ é€’ä¸€ä¸ªNSNumberå¯¹è±¡ï¼Œå¦‚@(1) æˆ– @(YES)ï¼Œä½œä¸ºsetValueï¼šforKey: çš„å€¼å‚æ•°ã€‚ æ­¤é™åˆ¶ä¸é€‚ç”¨äºiOSï¼Œå…¶ä¸­BOOLçš„ç±»å‹å®šä¹‰ä¸ºæœ¬æœºå¸ƒå°”ç±»å‹boolï¼ŒKVCè°ƒç”¨boolValueï¼Œå®ƒé€‚ç”¨äºNSNumberå¯¹è±¡æˆ–æ ¼å¼æ­£ç¡®çš„NSStringå¯¹è±¡ã€‚ åŒ…è£…å’Œè§£åŒ…ç»“æ„ä½“Table 5-2 ä¸‹é¢åˆ—å‡ºäº†å¯ä»¥åŒ…è£…æˆNSPointï¼ŒNSRangeï¼ŒNSRectå’ŒNSSizeçš„å¸¸ç”¨ç»“æ„ä½“çš„è½¬åŒ–æ–¹æ³•å’Œå–å€¼æ–¹æ³• Table 5-2 åŒ…è£…æˆNSValueçš„å¸¸ç”¨ç»“æ„ç±»å‹ Data type Creation method Accessor method NSPoint valueWithPoint: pointValue NSRange valueWithRange: rangeValue NSRect valueWithRect: (macOS only). rectValue NSSize valueWithSize: sizeValue ä¸ä»…NSPointï¼ŒNSRangeï¼ŒNSRectå’ŒNSSizeçš„å¯ä»¥è‡ªåŠ¨åŒ…è£…å’Œè§£åŒ…ã€‚ ç»“æ„ä½“ç±»å‹ï¼ˆå³Objective-Cç±»å‹ä¸­å­—ç¬¦ä¸²ä»¥{å¼€å¤´ç¼–ç çš„ç±»å‹ï¼‰ä¹Ÿå¯ä»¥åŒ…æˆNSValueå¯¹è±¡ä¸­ã€‚ ä¾‹å¦‚ï¼Œå‚è€ƒ5-1è¡¨æ ¼ä¸­å£°æ˜çš„ç»“æ„ä½“å’Œç±»æ¥å£ã€‚ Listing 5-1 ä½¿ç”¨è‡ªå®šä¹‰ç»“æ„ä½“çš„ç±» typedef struct { float x, y, z; } ThreeFloats; @interface MyClass @property (nonatomic) ThreeFloats threeFloats; @end ä½¿ç”¨åä¸ºmyClassçš„ç±»çš„å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨KVCè·å–threeFloatså€¼ NSValue* result = [myClass valueForKey:@"threeFloats"]; valueForKeyï¼šçš„é»˜è®¤å®ç°è°ƒç”¨threeFloats çš„getteræ–¹æ³•ï¼Œç„¶åè¿”å›åŒ…å«åœ¨NSValueå¯¹è±¡ä¸­çš„ç»“æœã€‚ åŒæ ·ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨KVCè®¾ç½®threeFloatså€¼ï¼š ThreeFloats floats = {1., 2., 3.}; NSValue* value = [NSValue valueWithBytes:&floats objCType:@encode(ThreeFloats)]; [myClass setValue:value forKey:@"threeFloats"]; é»˜è®¤å®ç°ä½¿ç”¨getValue:æ–¹æ³•è§£åŒ…å€¼ï¼Œç„¶åä½¿ç”¨setThreeFloats:ç”Ÿæˆçš„ç»“æ„ä½“è¿›è¡Œè°ƒç”¨ã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬äºŒéƒ¨åˆ†3]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%863%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬3èŠ‚2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬3èŠ‚ Key-Value Coding Fundamatalsâ€“Using Collection Operatorsä½¿ç”¨é›†åˆè¿ç®—ç¬¦å½“ä½ å‘ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡å‘é€valueForKeyPath:æ¶ˆæ¯æ—¶, å¯ä»¥åœ¨é”®è·¯å¾„ä¸­åµŒå…¥é›†åˆè¿ç®—ç¬¦ã€‚é›†åˆè¿ç®—ç¬¦æ˜¯ä¸€ä¸ªå°çš„å…³é”®å­—åˆ—è¡¨ï¼Œå‰é¢å¸¦ä¸€ä¸ªatç¬¦å·ï¼ˆ@ï¼‰, å®ƒæŒ‡å®šäº†getteråº”è¯¥æ‰§è¡Œçš„æ“ä½œï¼Œä»¥ä¾¿åœ¨è¿”å›ä¹‹å‰ä»¥æŸç§æ–¹å¼æ“ä½œæ•°æ®ã€‚valueForKeyPath:ç”±NSObjecté»˜è®¤å®ç°ã€‚ å½“é”®è·¯å¾„åŒ…å«é›†åˆè¿ç®—ç¬¦æ—¶, è¿ç®—ç¬¦å‰é¢çš„é”®è·¯å¾„çš„ä»»ä½•éƒ¨åˆ† (ç§°ä¸ºå·¦é”®è·¯å¾„) æŒ‡å‘ç›¸å¯¹äºæ¶ˆæ¯æ¥æ”¶è€…æ“ä½œçš„é›†åˆã€‚å¦‚æœå°†æ¶ˆæ¯ç›´æ¥å‘é€åˆ°é›†åˆå¯¹è±¡ (ä¾‹å¦‚NSArrayå®ä¾‹), åˆ™å¯ä»¥çœç•¥å·¦é”®è·¯å¾„ã€‚æ“ä½œç¬¦ä¹‹åçš„é”®è·¯å¾„éƒ¨åˆ†ï¼ˆç§°ä¸ºå³é”®è·¯å¾„ï¼‰æŒ‡å®šæ“ä½œç¬¦åº”å¤„ç†çš„é›†åˆä¸­çš„å±æ€§ã€‚é™¤äº†@countéœ€è¦æ­£ç¡®çš„é”®è·¯å¾„ä¹‹å¤–ï¼Œæ‰€æœ‰é›†åˆè¿ç®—ç¬¦ã€‚å›¾4-1è¯´æ˜äº†æ“ä½œç¬¦é”®è·¯å¾„æ ¼å¼ã€‚ å›¾ 4-1è¿ç®—ç¬¦é”®è·¯å¾„æ ¼å¼ é›†åˆè¿ç®—ç¬¦å±•ç¤ºäº†ä¸‰ç§åŸºæœ¬è¡Œä¸ºç±»å‹: èšåˆè¿ç®—ç¬¦ä»¥æŸç§æ–¹å¼åˆå¹¶é›†åˆçš„å¯¹è±¡ï¼Œå¹¶è¿”å›é€šå¸¸ä¸å³é”®è·¯å¾„ä¸­æŒ‡å®šçš„å±æ€§çš„æ•°æ®ç±»å‹åŒ¹é…çš„å•ä¸ªå¯¹è±¡ã€‚è¯¥@countè¿ç®—ç¬¦æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼Œå®ƒæ²¡æœ‰å³é”®è·¯å¾„å¹¶å§‹ç»ˆå°†è¿”å›ä¸€ä¸ªNSNumberå®ä¾‹ã€‚ æ•°ç»„è¿ç®—ç¬¦è¿”å›ä¸€ä¸ªNSArrayå®ä¾‹ï¼Œè¯¥å®ä¾‹åŒ…å«å‘½åé›†åˆä¸­ä¿å­˜çš„å¯¹è±¡çš„æŸä¸ªå­é›†ã€‚ åµŒå¥—æ“ä½œç¬¦å¤„ç†åŒ…å«å…¶ä»–é›†åˆçš„é›†åˆï¼Œå¹¶æ ¹æ®æ“ä½œç¬¦è¿”å›ä¸€ä¸ªNSArrayæˆ–NSSetå®ä¾‹ï¼Œå®ƒä»¥æŸç§æ–¹å¼ç»„åˆåµŒå¥—é›†åˆçš„å¯¹è±¡ã€‚ ç¤ºä¾‹æ•°æ®ä¸‹é¢æè¿°åŒ…æ‹¬æ¼”ç¤ºå¦‚ä½•è°ƒç”¨æ¯ä¸ªè¿ç®—ç¬¦çš„ä»£ç æ®µï¼Œä»¥åŠæ‰§è¡Œæ­¤æ“ä½œçš„ç»“æœã€‚è¿™ä¾èµ–äºBankAccountç±» (åœ¨[åˆ—è¡¨ 2-1]ä¸­æ˜¾ç¤º), å®ƒæ˜¯ä¸€ä¸ªä¿å­˜Transactionå¯¹è±¡çš„æ•°ç»„ã€‚å…¶ä¸­æ¯ä¸€ä¸ªéƒ½ä»£è¡¨ä¸€ä¸ªç®€å•çš„checkbookæ¡ç›®, å¦‚æ¸…å• 4-1ä¸­æ‰€å£°æ˜çš„é‚£æ ·ã€‚ æ¸…å• 4-1Transactionå¯¹è±¡çš„æ¥å£å£°æ˜ @interface Transaction : NSObject @property (nonatomic) NSString* payee; // To whom @property (nonatomic) NSNumber* amount; // How much @property (nonatomic) NSDate* date; // When @end ä¸ºäº†ä¾¿äºè®¨è®º, å‡å®šBankAccountå®ä¾‹å…·æœ‰ä¸€ä¸ªä½¿ç”¨è¡¨4-1ä¸­æ˜¾ç¤ºçš„æ•°æ®å¡«å……çš„äº¤æ˜“æ•°ç»„, å¹¶ä¸”æ‚¨å¯ä»¥ä»BankAccountå¯¹è±¡å†…éƒ¨è¿›è¡Œè°ƒç”¨ã€‚ è¡¨ 4-1Transactionså¯¹è±¡çš„ç¤ºä¾‹æ•°æ® payee amount date Green Power $120.00 Dec 1, 2015 Green Power $150.00 Jan 1, 2016 Green Power $170.00 Feb 1, 2016 Car Loan $250.00 Jan 15, 2016 Car Loan $250.00 Feb 15, 2016 Car Loan $250.00 Mar 15, 2016 General Cable $120.00 Dec 1, 2015 General Cable $155.00 Jan 1, 2016 General Cable $120.00 Feb 1, 2016 Mortgage $1,250.00 Jan 15, 2016 Mortgage $1,250.00 Feb 15, 2016 Mortgage $1,250.00 Mar 15, 2016 Animal Hospital $600.00 Jul 15, 2016 èšåˆè¿ç®—ç¬¦èšåˆè¿ç®—ç¬¦å¤„ç†arrayæˆ–setå±æ€§, ä»è€Œç”Ÿæˆåæ˜ é›†åˆæŸäº›æ–¹é¢çš„å•ä¸ªå€¼ã€‚ @avgå½“æŒ‡å®š@avgè¿ç®—ç¬¦æ—¶, valueForKeyPath:è¯»å–é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§, å°†å…¶è½¬æ¢ä¸ºdouble (nilå€¼ç”¨0æ›¿ä»£), å¹¶è®¡ç®—è¿™äº›å€¼çš„ç®—æœ¯å¹³å‡å€¼ã€‚ç„¶åå®ƒè¿”å›å­˜å‚¨åœ¨NSNumberå®ä¾‹ä¸­çš„ç»“æœã€‚ è·å–è¡¨ 4-1ä¸­ç¤ºä¾‹æ•°æ®ä¹‹é—´çš„å¹³å‡äº¤æ˜“è®°å½•é‡‘é¢: NSNumber *transactionAverage = [self.transactions valueForKeyPath:@"@avg.amount"]; transactionAverageçš„æ ¼å¼åŒ–çš„ç»“æœä¸º $ 456.54ã€‚ @countæŒ‡å®š@countè¿ç®—ç¬¦æ—¶, valueForKeyPath:è¿”å›ä¸€ä¸ªåŒ…å«é›†åˆä¸­çš„å¯¹è±¡ä¸ªæ•°çš„NSNumberå®ä¾‹ã€‚å³é”®è·¯å¾„ (å¦‚æœå­˜åœ¨) å°†è¢«å¿½ç•¥ã€‚ åœ¨transactionsä¸­è·å–Transactionå¯¹è±¡çš„æ•°ç›®: NSNumber *numberOfTransactions = [self.transactions valueForKeyPath:@"@count"]; numberOfTransactionsçš„å€¼ä¸º13ã€‚ @maxæŒ‡å®š@maxè¿ç®—ç¬¦æ—¶, valueForKeyPath:åœ¨ç”±å³é”®è·¯å¾„å‘½åçš„é›†åˆé¡¹ä¹‹é—´è¿›è¡Œæœç´¢, å¹¶è¿”å›æœ€å¤§å€¼ã€‚æœç´¢ä½¿ç”¨compare:æ–¹æ³•è¿›è¡Œæ¯”è¾ƒ, è¯¥æ–¹æ³•ç”±è®¸å¤šFoundationç±»ï¼ˆä¾‹å¦‚NSNumberç±»ï¼‰å®šä¹‰ã€‚å› æ­¤, ç”±å³é”®è·¯å¾„æŒ‡ç¤ºçš„å±æ€§å¿…é¡»åŒ…å«ä¸€ä¸ªå¯¹æ­¤æ¶ˆæ¯æœ‰æ„ä¹‰å“åº”çš„å¯¹è±¡ã€‚æœç´¢å¿½ç•¥å€¼ä¸ºnilçš„é›†åˆé¡¹ã€‚ åœ¨è¡¨ 4-1ä¸­åˆ—å‡ºçš„äº¤æ˜“è®°å½•ä¸­, è·å–æ—¥æœŸå€¼ (å³æœ€æ–°äº¤æ˜“è®°å½•çš„æ—¥æœŸ) çš„æœ€å¤§æ•°é‡: NSDate *latestDate = [self.transactions valueForKeyPath:@"@max.date"]; latestDateçš„å€¼ä¸º Jul 15, 2016. @minæŒ‡å®š@minè¿ç®—ç¬¦æ—¶, valueForKeyPath:åœ¨ç”±å³é”®è·¯å¾„å‘½åçš„é›†åˆé¡¹ä¹‹é—´è¿›è¡Œæœç´¢, å¹¶è¿”å›æœ€å°å€¼ã€‚æœç´¢ä½¿ç”¨compare:æ–¹æ³•è¿›è¡Œæ¯”è¾ƒ, è®¸å¤šåŸºç¡€ç±» (å¦‚NSNumberç±») ä¸­éƒ½æœ‰å®šä¹‰ã€‚å› æ­¤, ç”±å³é”®è·¯å¾„æŒ‡ç¤ºçš„å±æ€§å¿…é¡»æŒæœ‰å¯¹æ­¤æ¶ˆæ¯æœ‰æ„ä¹‰å“åº”çš„å¯¹è±¡ã€‚æœç´¢å¿½ç•¥å€¼ä¸ºnilçš„é›†åˆé¡¹ã€‚ åœ¨è¡¨ 4-1ä¸­åˆ—å‡ºçš„äº‹åŠ¡ä¸­, è·å–æ—¥æœŸå€¼ (å³æœ€æ—©çš„äº‹åŠ¡çš„æ—¥æœŸ) çš„æœ€çŸ­æ—¶é—´ã€‚ NSDate *earliestDate = [self.transactions valueForKeyPath:@"@min.date"]; earliestDateçš„å€¼ä¸º Dec 1, 2015. @sumæŒ‡å®š@sumè¿ç®—ç¬¦æ—¶, valueForKeyPath:è¯»å–é›†åˆä¸­æ¯ä¸ªå…ƒç´ çš„å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§, å°†å…¶è½¬æ¢ä¸ºdouble (nilå€¼æ›¿æ¢ä¸º 0), å¹¶è®¡ç®—æ€»å’Œã€‚ç„¶åè¿”å›å­˜å‚¨åœ¨NSNumberå®ä¾‹ä¸­çš„ç»“æœã€‚ è·å–è¡¨ 4-1ä¸­ç¤ºä¾‹æ•°æ®ä¹‹é—´çš„äº¤æ˜“è®°å½•é‡‘é¢çš„æ€»å’Œ: NSNumber *amountSum = [self.transactions valueForKeyPath:@"@sum.amount"]; amountSumçš„ç»“æœä¸º $ 5935.00ã€‚ æ•°ç»„è¿ç®—ç¬¦æ•°ç»„è¿ç®—ç¬¦ä½¿valueForKeyPath:è¿”å›ä¸å³é”®è·¯å¾„æŒ‡ç¤ºçš„ç‰¹å®šå¯¹è±¡é›†ç›¸å¯¹åº”çš„å¯¹è±¡æ•°ç»„ã€‚ é‡è¦åœ¨ä½¿ç”¨æ•°ç»„è¿ç®—ç¬¦æ—¶, å¦‚æœæœ‰ä»»ä½•å¶(leaf)å¯¹è±¡ä¸ºnil, åˆ™valueForKeyPath:æ–¹æ³•å°†å¼•å‘å¼‚å¸¸ã€‚ @distinctUnionOfObjectsæŒ‡å®š@distinctUnionOfObjectsè¿ç®—ç¬¦æ—¶, valueForKeyPath:å°†åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„, è¯¥æ•°ç»„åŒ…å«ä¸å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§å¯¹åº”çš„é›†åˆçš„ä¸åŒå¯¹è±¡ã€‚ è·å–transactionsä¸­çš„äº¤æ˜“è®°å½•çš„payeeå±æ€§å€¼çš„é›†åˆ, å¹¶çœç•¥é‡å¤å€¼: NSArray *distinctPayees = [self.transactions valueForKeyPath:@"@distinctUnionOfObjects.payee"]; ç”Ÿæˆçš„distinctPayeesæ•°ç»„åŒ…å«ä»¥ä¸‹æ¯ä¸€ä¸ªå­—ç¬¦ä¸²å®ä¾‹ï¼šCar Loan, General Cable, Animal Hospital, Green Power, Mortgageã€‚ æ³¨æ„@unionOfObjectsè¿ç®—ç¬¦æä¾›ç±»ä¼¼çš„è¡Œä¸º, ä½†ä¸åˆ é™¤é‡å¤çš„å¯¹è±¡ã€‚ @unionOfObjectsæŒ‡å®š@unionOfObjectsè¿ç®—ç¬¦æ—¶, valueForKeyPath:å°†åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„, è¯¥æ•°ç»„åŒ…å«ä¸ç”±å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§å¯¹åº”çš„é›†åˆçš„æ‰€æœ‰å¯¹è±¡ã€‚ä¸@distinctUnionOfObjectsä¸åŒ, ä¸ä¼šåˆ é™¤é‡å¤å¯¹è±¡ã€‚ è·å–transactionsä¸­çš„äº¤æ˜“è®°å½•çš„payeeå±æ€§å€¼çš„é›†åˆ: NSArray *payees = [self.transactions valueForKeyPath:@"@unionOfObjects.payee"]; ç”Ÿæˆçš„payeesæ•°ç»„åŒ…å«ä»¥ä¸‹å­—ç¬¦ä¸²ï¼šGreen Power, Green Power, Green Power, Car Loan, Car Loan, Car Loan, General Cable, General Cable, General Cable, Mortgage, Mortgage, Mortgage, Animal Hospital.è®°å½•äº†é‡å¤å€¼ã€‚ æ³¨æ„@distinctUnionOfArraysè¿ç®—ç¬¦ç±»ä¼¼, ä½†åˆ é™¤é‡å¤çš„å¯¹è±¡ã€‚ åµŒå¥—è¿ç®—ç¬¦åµŒå¥—è¿ç®—ç¬¦å¯¹åµŒå¥—é›†åˆè¿›è¡Œæ“ä½œ, é›†åˆæœ¬èº«çš„æ¯ä¸ªæ¡ç›®éƒ½åŒ…å«ä¸€ä¸ªé›†åˆã€‚ é‡è¦å¦‚æœåœ¨ä½¿ç”¨åµŒå¥—è¿ç®—ç¬¦æ—¶, æœ‰ä»»ä½•å¶(leaf)å¯¹è±¡ä¸ºnil, åˆ™valueForKeyPath:æ–¹æ³•å°†å¼•å‘å¼‚å¸¸ã€‚ å¯¹äºä¸‹é¢çš„è¯´æ˜, è¯·çœ‹ç¬¬äºŒä¸ªç§°ä¸ºmoreTransactionsçš„æ•°æ®æ•°ç»„, å…¶ä¸­å¡«å……äº†è¡¨ 4-2ä¸­çš„æ•°æ®, å¹¶ä¸åŸæ¥çš„transactionsæ•°ç»„ä¸€èµ·æ’å…¥åµŒå¥—æ•°ç»„: NSArray* moreTransactions = @[]; NSArray* arrayOfArrays = @[self.transactions, moreTransactions]; è¡¨ 4-2 moreTransactionsæ•°ç»„ä¸­å‡è®¾çš„Transactionæ•°æ® payee amount date General Cable - Cottage $120.00 Dec 18, 2015 General Cable - Cottage $155.00 Jan 9, 2016 General Cable - Cottage $120.00 Dec 1, 2016 Second Mortgage $1,250.00 Nov 15, 2016 Second Mortgage $1,250.00 Sep 20, 2016 Second Mortgage $1,250.00 Feb 12, 2016 Hobby Sho $600.00 Jun 14, 2016 @distinctUnionOfArraysæŒ‡å®š@distinctUnionOfArraysè¿ç®—ç¬¦æ—¶, valueForKeyPath:åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„, å…¶ä¸­åŒ…å«ä¸å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ç›¸å¯¹åº”çš„æ‰€æœ‰é›†åˆçš„ç»„åˆçš„ä¸åŒå¯¹è±¡ã€‚ åœ¨arrayOfArraysä¸­çš„æ‰€æœ‰æ•°ç»„ä¸­è·å–payeeå±æ€§çš„ä¸åŒå€¼: NSArray *collectedDistinctPayees = [arrayOfArrays valueForKeyPath:@&quot;@distinctUnionOfArrays.payee&quot;]; ç”Ÿæˆçš„collectedDistinctPayeesæ•°ç»„åŒ…å«ä»¥ä¸‹å€¼: Hobby Shop, Mortgage, Animal Hospital, Second Mortgage, Car Loan, General Cable - Cottage, General Cable, Green Powerã€‚ æ³¨æ„@unionOfArraysè¿ç®—ç¬¦ç±»ä¼¼, ä½†ä¸ç§»é™¤é‡å¤å¯¹è±¡ã€‚ @unionOfArraysæŒ‡å®š@unionOfArraysè¿ç®—ç¬¦æ—¶, valueForKeyPath:åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„, å…¶ä¸­åŒ…å«ä¸ç”±å³é”®è·¯å¾„æŒ‡å®šçš„å±æ€§ç›¸å¯¹åº”çš„æ‰€æœ‰é›†åˆçš„ç»„åˆçš„æ‰€æœ‰å¯¹è±¡, è€Œä¸åˆ é™¤é‡å¤é¡¹ã€‚ åœ¨arrayOfArraysä¸­çš„æ‰€æœ‰æ•°ç»„ä¸­è·å–payeeå±æ€§çš„å€¼: NSArray *collectedPayees = [arrayOfArrays valueForKeyPath:@&quot;@unionOfArrays.payee&quot;]; ç”Ÿæˆçš„collectedPayeesæ•°ç»„åŒ…å«ä»¥ä¸‹å€¼:Green Power, Green Power, Green Power, Car Loan, Car Loan, Car Loan, General Cable, General Cable, General Cable, Mortgage, Mortgage, Mortgage, Animal Hospital, General Cableã€‚ æ³¨æ„@distinctUnionOfArraysè¿ç®—ç¬¦ç±»ä¼¼, ä½†ç§»é™¤é‡å¤å¯¹è±¡ã€‚ @distinctUnionOfSetså½“æŒ‡å®š@distinctUnionOfSetsè¿ç®—ç¬¦æ—¶, valueForKeyPath:åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªNSSetå¯¹è±¡, å…¶ä¸­åŒ…å«ä¸ç”±å³é”®è·¯å¾„æ‰€æŒ‡å®šçš„å±æ€§ç›¸å¯¹åº”çš„æ‰€æœ‰é›†åˆç»„åˆçš„ä¸åŒå¯¹è±¡ã€‚ æ­¤è¿ç®—ç¬¦çš„è¡Œä¸ºä¸@distinctUnionOfArraysç±»ä¼¼, åªæ˜¯å®ƒéœ€è¦ä¸€ä¸ªåŒ…å«NSSetå®ä¾‹çš„NSSetå®ä¾‹å¯¹è±¡, å…¶ä¸­, è€Œä¸æ˜¯åŒ…å«NSArrayå®ä¾‹çš„NSArrayå®ä¾‹å¯¹è±¡ã€‚æ­¤å¤–, å®ƒè¿˜è¿”å›ä¸€ä¸ªNSSetå®ä¾‹ã€‚å‡è®¾ç¤ºä¾‹æ•°æ®å·²å­˜å‚¨åœ¨é›†åˆè€Œä¸æ˜¯æ•°ç»„ä¸­, åˆ™ç¤ºä¾‹è°ƒç”¨å’Œç»“æœä¸@distinctUnionOfArraysä¸­æ˜¾ç¤ºçš„ç›¸åŒã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬äºŒéƒ¨åˆ†2]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%862%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬2èŠ‚2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬2èŠ‚ Key-Value Coding Fundamatalsâ€“Accessing Collection Propertiesè®¿é—®é›†åˆå±æ€§ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡ä»¥ä¸å…¬å¼€å…¶ä»–å±æ€§ç›¸åŒçš„æ–¹å¼å…¬å¼€å…¶å¤šå¯¹å¤šå±æ€§ã€‚æ‚¨å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»–å¯¹è±¡valueForKey:å’ŒsetValue:forKey: (æˆ–å®ƒä»¬çš„é”®è·¯å¾„ç­‰åŒæ–¹æ³•) ä¸€æ ·è·å–æˆ–è®¾ç½®é›†åˆå¯¹è±¡ã€‚ä½†æ˜¯, å½“æ‚¨è¦æ“ä½œè¿™äº›é›†åˆçš„å†…å®¹æ—¶, ä½¿ç”¨åè®®å®šä¹‰çš„å¯å˜ä»£ç†æ–¹æ³•é€šå¸¸æ˜¯æœ€æœ‰æ•ˆçš„ã€‚ è¯¥åè®®ä¸ºé›†åˆå¯¹è±¡è®¿é—®å®šä¹‰äº†ä¸‰ç§ä¸åŒçš„ä»£ç†æ–¹æ³•, æ¯ä¸ªéƒ½å…·æœ‰ä¸€ä¸ªé”®å’Œä¸€ä¸ªé”®è·¯å¾„å˜ä½“æ–¹æ³•: mutableArrayValueForKey: å’Œ mutableArrayValueForKeyPath: è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¼¼äºNSMutableArrayå¯¹è±¡çš„ä»£ç†å¯¹è±¡ã€‚ mutableSetValueForKey: å’Œ mutableSetValueForKeyPath: è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¼¼äºNSMutableSetå¯¹è±¡çš„ä»£ç†å¯¹è±¡ã€‚ mutableOrderedSetValueForKey: å’Œ mutableOrderedSetValueForKeyPath: è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç±»ä¼¼äº`NSMutableOrderedSet`å¯¹è±¡çš„ä»£ç†å¯¹è±¡ã€‚ å½“æ‚¨å¯¹ä»£ç†å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œå‘å¯¹è±¡æ·»åŠ å¯¹è±¡ï¼Œä»ä¸­åˆ é™¤å¯¹è±¡æˆ–æ›¿æ¢å¯¹è±¡æ—¶, åè®®çš„é»˜è®¤å®ç°å°†ç›¸åº”åœ°ä¿®æ”¹åŸºç¡€å±æ€§ã€‚è¿™æ¯”ä½¿ç”¨valueForKey:å¾—åˆ°ä¸€ä¸ªä¸å¯å˜é›†åˆå¯¹è±¡æ›´æœ‰æ•ˆï¼Œåˆ›å»ºä¸€ä¸ªä¿®æ”¹äº†å†…å®¹çš„å¯å˜é›†åˆå¯¹è±¡ï¼Œç„¶åä½¿ç”¨setValue:forKey:æ¶ˆæ¯å°†å…¶å­˜å‚¨å›å¯¹è±¡ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹, å®ƒä¹Ÿæ¯”ç›´æ¥ä½¿ç”¨å¯å˜å±æ€§æ›´æœ‰æ•ˆã€‚è¿™äº›æ–¹æ³•æä¾›äº†å¯¹é›†åˆå¯¹è±¡ä¸­ä¿å­˜çš„å¯¹è±¡ä¿æŒé”®å€¼è§‚å¯Ÿéµä»æ€§çš„é¢å¤–å¥½å¤„ (æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Key-Value Observing Programming Guideã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬äºŒéƒ¨åˆ†1]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%861%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬1èŠ‚2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬äºŒéƒ¨åˆ†ç¬¬1èŠ‚ Key-Value Coding Fundamatalsâ€“Accessing Object Properties é”®å€¼ç¼–ç åŸºç¡€â€“ è®¿é—®å¯¹è±¡å±æ€§ è®¿é—®å¯¹è±¡å±æ€§å¯¹è±¡é€šå¸¸åœ¨å…¶æ¥å£å£°æ˜ä¸­æŒ‡å®šå±æ€§, è¿™äº›å±æ€§å±äºä»¥ä¸‹å‡ ç§ç±»åˆ«ä¹‹ä¸€: å±æ€§. æŒ‡ç®€å•å€¼, ä¾‹å¦‚æ ‡é‡(scalars)ã€å­—ç¬¦ä¸²æˆ–å¸ƒå°”å€¼ã€‚å€¼å¯¹è±¡(å¦‚NSNumber)å’Œå…¶ä»–ä¸å¯å˜ç±»å‹(å¦‚NSColor) ä¹Ÿè¢«è§†ä¸ºå±æ€§ã€‚ ä¸€å¯¹ä¸€å…³ç³». æŒ‡å…·æœ‰è‡ªå·±å±æ€§çš„å¯å˜å¯¹è±¡ã€‚å¯¹è±¡çš„å±æ€§å¯ä»¥åœ¨å¯¹è±¡æœ¬èº«ä¸å˜çš„æƒ…å†µä¸‹æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œé“¶è¡Œå¸æˆ·å¯¹è±¡(bank account object)å¯èƒ½å…·æœ‰ownerå±æ€§ï¼Œè¯¥å±æ€§æ˜¯Personå¯¹è±¡çš„å®ä¾‹ï¼Œè¯¥Personå¯¹è±¡å…·æœ‰addresså±æ€§ã€‚ownerçš„addresså¯èƒ½ä¼šæ›´æ”¹ï¼Œè€Œä¸ä¼šæ›´æ”¹é“¶è¡Œå¸æˆ·æŒæœ‰çš„ownerã€‚é“¶è¡Œå¸æˆ·çš„owneræ²¡æœ‰å˜æ›´ã€‚åªæœ‰Personçš„address å‘ç”Ÿæ”¹å˜ã€‚ ä¸€å¯¹å¤šå…³ç³». æŒ‡é›†åˆå¯¹è±¡ã€‚ä½ é€šå¸¸ä½¿ç”¨NSArrayæˆ–NSSetä¿å­˜æ­¤ç±»é›†åˆçš„å®ä¾‹ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é›†åˆç±»ã€‚ æ¸…å• 2-1ä¸­å£°æ˜çš„BankAccountå¯¹è±¡æ¼”ç¤ºäº†æ¯ç§ç±»å‹çš„å±æ€§ã€‚ æ¸…å• 2-1BankAccountå¯¹è±¡çš„å±æ€§ @interface BankAccount : NSObject @property (nonatomic) NSNumber* currentBalance; // An attribute @property (nonatomic) Person* owner; // A to-one relation @property (nonatomic) NSArray* transactions; // A to-many relation @end ä¸ºäº†ä¿æŒå°è£…ï¼Œå¯¹è±¡é€šå¸¸ä¸ºå…¶æ¥å£ä¸Šçš„å±æ€§æä¾›è®¿é—®å™¨æ–¹æ³•ã€‚å¯¹è±¡çš„ä½œè€…å¯ä»¥æ˜¾å¼åœ°ç¼–å†™è¿™äº›æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä¾èµ–ç¼–è¯‘å™¨è‡ªåŠ¨åˆæˆå®ƒä»¬ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œä½¿ç”¨è¿™äº›è®¿é—®å™¨ä¹‹ä¸€çš„ä»£ç çš„ä½œè€…å¿…é¡»åœ¨ç¼–è¯‘ä¹‹å‰å°†å±æ€§åç§°å†™å…¥ä»£ç ä¸­ã€‚è®¿é—®å™¨æ–¹æ³•çš„åç§°æˆä¸ºä½¿ç”¨å®ƒçš„ä»£ç çš„é™æ€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œç»™å®šæ¸…å•2-1ä¸­å£°æ˜çš„BankAccountå¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¼šåˆæˆä¸€ä¸ªå¯ä»¥ä¸ºmyAccountå®ä¾‹è°ƒç”¨çš„setter ï¼š [myAccount setCurrentBalance:@(100.0)]; è¿™æ˜¯ç›´æ¥çš„ï¼Œä½†ç¼ºä¹çµæ´»æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡æä¾›äº†ä½¿ç”¨å­—ç¬¦ä¸²æ ‡è¯†ç¬¦è®¿é—®å¯¹è±¡å±æ€§çš„æ›´é€šç”¨æœºåˆ¶ã€‚ ä½¿ç”¨Keys å’Œ Key Pathsæ ‡è¯†å¯¹è±¡çš„å±æ€§é”®(key)æ˜¯æ ‡è¯†ç‰¹å®šå±æ€§çš„å­—ç¬¦ä¸²ã€‚é€šå¸¸, æŒ‰ç…§æƒ¯ä¾‹, è¡¨ç¤ºå±æ€§çš„é”®(key)æ˜¯ä»£ç ä¸­æ˜¾ç¤ºçš„å±æ€§åã€‚é”®(key)å¿…é¡»ä½¿ç”¨ ASCII ç¼–ç , ä¸èƒ½åŒ…å«ç©ºæ ¼, å¹¶ä¸”é€šå¸¸ä»¥å°å†™å­—æ¯å¼€å¤´ (å°½ç®¡æœ‰ä¾‹å¤–, å¦‚åœ¨è®¸å¤šç±»ä¸­çš„URLå±æ€§)ã€‚ ç”±äºæ¸…å• 2-1ä¸­çš„BankAccountç±»æ˜¯ç¬¦åˆé”®å€¼ç¼–ç çš„, æ‰€ä»¥å®ƒèƒ½è¯†åˆ«é”®(å³å®ƒçš„å±æ€§çš„åç§°)ownerã€currentBalanceå’Œtransactions ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡å…¶é”®æ¥è®¾ç½®å€¼, è€Œä¸æ˜¯è°ƒç”¨setCurrentBalance:æ–¹æ³•: [myAccount setValue:@(100.0) forKey:@"currentBalance"]; å®é™…ä¸Š, æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„é”®å‚æ•°é€šè¿‡ç›¸åŒæ–¹æ³•æ¥è®¾ç½®myAccountå¯¹è±¡çš„æ‰€æœ‰å±æ€§ã€‚å› ä¸ºå‚æ•°æ˜¯å­—ç¬¦ä¸²ç±»å‹, æ‰€ä»¥å®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶æ“ä½œå˜é‡ã€‚ é”®è·¯å¾„Key pathæ˜¯ä¸€ä¸ªç”¨ç‚¹æ“ä½œç¬¦.æ¥åˆ†éš”é”®çš„å­—ç¬¦ä¸², ç”¨äºæŒ‡å®šè¦éå†çš„å¯¹è±¡å±æ€§åºåˆ—ã€‚åºåˆ—ä¸­ç¬¬ä¸€ä¸ªé”®çš„å±æ€§æ˜¯ç›¸å¯¹äºæ¥æ”¶è€…çš„, æ¯ä¸ªåç»­é”®ç›¸å¯¹äºä¸Šä¸€ä¸ªå±æ€§çš„å€¼è¿›è¡Œè®¡ç®—ã€‚é”®è·¯å¾„(Key path)å¯¹äºä½¿ç”¨å•ä¸ªæ–¹æ³•æ·±å…¥è°ƒç”¨å¯¹è±¡çš„å±‚æ¬¡ç»“æ„å¾ˆæœ‰ç”¨ã€‚ ä¾‹å¦‚, åº”ç”¨äºé“¶è¡Œå¸æˆ·å®ä¾‹çš„é”®è·¯å¾„owner.address.streetæ˜¯æŒ‡å­˜å‚¨åœ¨é“¶è¡Œå¸æˆ·æ‰€æœ‰è€…åœ°å€ä¸­çš„è¡—é“å­—ç¬¦ä¸²çš„å€¼, å‡è®¾Personå’ŒAddressç±»ä¹Ÿç¬¦åˆçš„é”®å€¼ç¼–ç ã€‚ æ³¨æ„åœ¨ Swift ä¸­, æ‚¨å¯ä»¥ä½¿ç”¨#keyPathè¡¨è¾¾å¼, è€Œä¸æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²æ¥æŒ‡ç¤ºé”®æˆ–é”®è·¯å¾„ã€‚è¿™æä¾›äº†ç¼–è¯‘æ—¶æ£€æŸ¥çš„ä¼˜ç‚¹, è¯¦è§Using Swift with Cocoa and Objective-C (Swift 4.2) ä¸­çš„Keys and Key Pathsç« èŠ‚ã€‚ ä½¿ç”¨é”®è·å–å±æ€§å€¼å¯¹è±¡åœ¨éµå¾ªNSKeyValueCodingåè®®æ—¶ç¬¦åˆé”®å€¼ç¼–ç ã€‚ç»§æ‰¿è‡ªçš„å¯¹è±¡ï¼ˆNSObjectæä¾›åè®®çš„åŸºæœ¬æ–¹æ³•çš„é»˜è®¤å®ç°ï¼‰ä¼šè‡ªåŠ¨é‡‡ç”¨æ­¤åè®®çš„æŸäº›é»˜è®¤è¡Œä¸ºã€‚è¿™æ ·çš„å¯¹è±¡è‡³å°‘å®ç°äº†ä»¥ä¸‹åŸºäºé”®çš„åŸºæœ¬getterï¼š valueForKey: - è¿”å›ç”±keyå‚æ•°æŒ‡å®šçš„å±æ€§çš„å€¼ã€‚å¦‚æœæ ¹æ®è®¿é—®è€…æœç´¢æ¨¡å¼ä¸­æè¿°çš„è§„åˆ™æ— æ³•æ‰¾åˆ°keyå‘½åçš„å±æ€§ï¼Œåˆ™è¯¥å¯¹è±¡ä¼šå‘è‡ªèº«å‘é€valueForUndefinedKey:æ¶ˆæ¯ã€‚valueForUndefinedKey:å¼•å‘çš„é»˜è®¤å®ç°æŠ›å‡ºNSUndefinedKeyExceptionå¼‚å¸¸ï¼Œä½†æ˜¯å­ç±»å¯ä»¥è¦†ç›–æ­¤æ–¹æ³•å¹¶æ›´ä¼˜é›…åœ°å¤„ç†è¿™ç§æƒ…å†µã€‚ valueForKeyPath: - è¿”å›ç›¸å¯¹äºæ¥æ”¶å™¨çš„æŒ‡å®šé”®è·¯å¾„çš„å€¼ã€‚keyPathåºåˆ—ä¸­çš„ä»»ä½•å¯¹è±¡éƒ½ä¸ç¬¦åˆç‰¹å®škeyçš„é”®å€¼ç¼–ç  - å³ï¼Œé»˜è®¤å®ç°valueForKey:æ— æ³•æ‰¾åˆ°è®¿é—®å™¨æ–¹æ³• - -é‚£ä¹ˆå°±ä¼šæ¥æ”¶valueForUndefinedKey:æ¶ˆæ¯ã€‚ dictionaryWithValuesForKeys: - è¿”å›ç›¸å¯¹äºæ¥æ”¶å™¨çš„ä¸€ç»„é”®æ‰€å¯¹åº”çš„å€¼ã€‚è¯¥æ–¹æ³•ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªé”®è°ƒç”¨valueForKey:ã€‚è¿”å›çš„NSDictionaryåŒ…å«æ•°ç»„ä¸­æ‰€æœ‰é”®çš„å€¼ã€‚ æ³¨æ„é›†åˆå¯¹è±¡ (å¦‚NSArrayã€ NSSetå’ŒNSDictionary) ä¸èƒ½åŒ…å«nilçš„å€¼ã€‚è€Œæ˜¯ä½¿ç”¨NSNullå¯¹è±¡è¡¨ç¤ºnilå€¼ã€‚NSNullæä¾›ä¸€ä¸ªè¡¨ç¤ºå¯¹è±¡å±æ€§çš„nilå€¼çš„å•ä¸ªå®ä¾‹ã€‚dictionaryWithValuesForKeys:çš„é»˜è®¤å®ç°å’Œç›¸å…³çš„setValuesForKeysWithDictionary:ä¼šåœ¨NSNull (åœ¨å­—å…¸å‚æ•°ä¸­) å’Œnil(åœ¨å­˜å‚¨çš„å±æ€§ä¸­)ä¹‹é—´è¿›è¡Œè‡ªåŠ¨è½¬æ¢ ã€‚ å½“æ‚¨ä½¿ç”¨KeyPathæ¥å¯»å€å±æ€§æ—¶, å¦‚æœé”®è·¯å¾„ä¸­çš„æœ€åä¸€ä¸ªé”®æ˜¯ä¸€å¯¹å¤šå…³ç³» (å³å¼•ç”¨é›†åˆ), åˆ™åœ¨å¤šå¯¹é”®çš„å³ä¾§,è¿”å›çš„å€¼æ˜¯ä¸€ä¸ªåŒ…å«é”®çš„æ‰€æœ‰å€¼çš„é›†åˆã€‚ä¾‹å¦‚, è¯·æ±‚é”®è·¯å¾„ â€œtransactions.payeeâ€œ çš„å€¼è¿”å›åŒ…å«æ‰€æœ‰transactionå¯¹è±¡ä¸­payeeå¯¹è±¡çš„æ•°ç»„ã€‚è¿™ä¹Ÿé€‚ç”¨äºKeyPathä¸­çš„å¤šä¸ªæ•°ç»„ã€‚KeyPath accounts.transactions.payeeè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å¸æˆ·ä¸­æ‰€æœ‰äº¤æ˜“çš„æ‰€æœ‰æ”¶æ¬¾äººå¯¹è±¡ã€‚ ä½¿ç”¨é”®è®¾ç½®å±æ€§å€¼ä¸ getterä¸€æ ·, ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡ä¹Ÿæä¾›äº†ä¸€å°ç»„é€šç”¨setterï¼Œå…¶é»˜è®¤è¡Œä¸ºåŸºäºä»¥ä¸‹NSKeyValueCodingåè®®çš„å®ç°NSObject: setValue:forKey: - å°†æŒ‡å®šé”®è®¾ç½®ä¸ºç»™å®šå€¼ã€‚setValue:forKey:çš„é»˜è®¤å®ç°ä¼šè‡ªåŠ¨å¯¹è¡¨ç¤ºæ ‡é‡å’Œç»“æ„ä½“çš„NSNumberå’ŒNSValueå¯¹è±¡æ‰§è¡Œè§£åŒ…æ“ä½œï¼Œå¹¶å°†å®ƒä»¬è®¾ç½®åˆ°ç›¸åº”çš„å±æ€§ä¸­ã€‚æœ‰å…³åŒ…è£…(warp)å’Œè§£åŒ…(unwarp)è¯­ä¹‰çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Representing Non-Object Valuesã€‚ å¦‚æœæ¥æ”¶setterè°ƒç”¨çš„å¯¹è±¡ä¸­æ²¡æœ‰å¯¹åº”æŒ‡å®šé”®çš„å±æ€§ï¼Œè¯¥å¯¹è±¡å°†ç»™è‡ªå·±å‘é€ä¸€ä¸ª[setValue:forUndefinedKey:]æ¶ˆæ¯ã€‚setValue:forUndefinedKey:çš„é»˜è®¤å®ç°å°†æŠ›å‡ºNSUndefinedKeyExceptionå¼‚å¸¸ã€‚ä½†æ˜¯, å­ç±»å¯ä»¥é‡å†™æ­¤æ–¹æ³•ä»¥è‡ªå®šä¹‰æ–¹å¼å¤„ç†è¯·æ±‚ã€‚ setValue:forKeyPath: åœ¨ç›¸å¯¹äºæ¥æ”¶è€…çš„æŒ‡å®šé”®è·¯å¾„ä¸Šè®¾ç½®ç»™å®šå€¼ã€‚é”®è·¯å¾„åºåˆ—ä¸­æŒ‡å®šé”®æ‰€å¯¹åº”çš„å¯¹è±¡å¦‚æœä¸æ˜¯é”®å€¼ç¼–ç å…¼å®¹çš„ï¼Œå°†ä¼šæ”¶åˆ°setValue:forUndefinedKey:æ¶ˆæ¯ã€‚ setValuesForKeysWithDictionary: å°†æŒ‡å®šå­—å…¸ä¸­çš„å€¼è®¾ç½®åˆ°æ¥æ”¶è€…çš„å±æ€§ä¸­, ä½¿ç”¨å­—å…¸é”®æ ‡è¯†å±æ€§ã€‚é»˜è®¤å®ç°è°ƒç”¨æ¯ä¸ªé”®å€¼å¯¹çš„setValue:forKey: , æ ¹æ®éœ€è¦ç”¨nilæ›¿æ¢NSNullå¯¹è±¡ã€‚ åœ¨é»˜è®¤å®ç°ä¸­, å½“æ‚¨å°è¯•å°†éå¯¹è±¡å±æ€§è®¾ç½®ä¸ºnilå€¼æ—¶, ç¬¦åˆé”®å€¼ç¼–ç å…¼å®¹å¯¹è±¡å°†è‡ªå·±å‘é€ä¸€ä¸ªsetNilValueForKey:æ¶ˆæ¯ã€‚setNilValueForKey:çš„é»˜è®¤å®ç°å°†æŠ›å‡º[NSInvalidArgumentException]å¼‚å¸¸, ä½†å¯¹è±¡å¯ä»¥é‡å†™æ­¤æ–¹æ³•ä»¥æ›¿æ¢é»˜è®¤å€¼æˆ–æ ‡è®°å€¼, è¯¦è§å¤„ç†éå¯¹è±¡å€¼ã€‚ ä½¿ç”¨é”®ç®€åŒ–å¯¹è±¡è®¿é—®æƒ³çŸ¥é“åŸºäºkeyçš„ getter å’Œ setter å¦‚ä½•ç®€åŒ–ä»£ç , è¯·æŸ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ã€‚åœ¨ macOS ä¸­, NSTableViewå’ŒNSOutlineViewå¯¹è±¡çš„æ ‡è¯†ç¬¦å­—ç¬¦ä¸²ä¸æ¯ä¸ªå®ƒä»¬çš„åˆ—ç›¸å…³è”ã€‚å¦‚æœè¡¨çš„æ¨¡å‹å¯¹è±¡ä¸æ˜¯ç¬¦åˆé”®å€¼ç¼–ç çš„, åˆ™è¡¨çš„æ•°æ®æºæ–¹æ³•å°†å¼ºåˆ¶æ£€æŸ¥æ¯ä¸ªåˆ—æ ‡è¯†ç¬¦, ä¾æ¬¡æŸ¥æ‰¾è¦è¿”å›çš„æ­£ç¡®å±æ€§, å¦‚æ¸…å• 2-2æ‰€ç¤ºã€‚æ­¤å¤–, åœ¨å°†æ¥, å½“æ‚¨å‘æ¨¡å‹ä¸­æ·»åŠ å¦ä¸€ä¸ªå±æ€§æ—¶, åœ¨æœ¬ä¾‹ä¸­ä¸ºPerson å¯¹è±¡, è¿˜å¿…é¡»é‡æ–°è®¿é—®æ•°æ®æºæ–¹æ³•, æ·»åŠ å¦ä¸€ä¸ªæ¡ä»¶æ¥æµ‹è¯•æ–°å±æ€§å¹¶è¿”å›ç›¸å…³å€¼. æ¸…å• 2-2 ä¸åŸºäºé”®å€¼ç¼–ç çš„æ•°æ®æºæ–¹æ³•çš„å®ç° - (id)tableView:(NSTableView *)tableview objectValueForTableColumn:(id)column row:(NSInteger)row { id result = nil; Person *person = [self.people objectAtIndex:row]; if ([[column identifier] isEqualToString:@"name"]) { result = [person name]; } else if ([[column identifier] isEqualToString:@"age"]) { result = @([person age]); // Wrap age, a scalar, as an NSNumber } else if ([[column identifier] isEqualToString:@"favoriteColor"]) { result = [person favoriteColor]; } // And so on... return result; } å¦ä¸€æ–¹é¢,æ¸…å• 2-3å±•ç¤ºäº†ç›¸åŒæ•°æ®æºçš„æ–¹æ³•çš„ä¸€ä¸ªæ›´ç´§å‡‘çš„å®ç°, è¯¥æ•°æ®æºæ–¹æ³•ä½¿ç”¨çš„æ˜¯é”®å€¼ç¼–ç å…¼å®¹çš„Personå¯¹è±¡ã€‚ä»…ä½¿ç”¨valueForKey: getter, æ•°æ®æºæ–¹æ³•å°†ä½¿ç”¨åˆ—æ ‡è¯†ç¬¦ä½œä¸ºé”®è¿”å›é€‚å½“çš„å€¼ã€‚é™¤äº†æ›´çŸ­çš„æ—¶é—´å¤–, å®ƒè¿˜æ›´é€šç”¨, å› ä¸ºåœ¨ä»¥åæ·»åŠ æ–°åˆ—æ—¶, åªè¦åˆ—æ ‡è¯†ç¬¦å§‹ç»ˆä¸æ¨¡å‹å¯¹è±¡çš„å±æ€§åç§°åŒ¹é…, å®ƒå°±ä¼šç»§ç»­ä¿æŒä¸å˜ã€‚ æ¸…å• 2-3åŸºäºé”®å€¼ç¼–ç çš„æ•°æ®æºæ–¹æ³•çš„å®ç° - (id)tableView:(NSTableView *)tableview objectValueForTableColumn:(id)column row:(NSInteger)row { return [[self.people objectAtIndex:row] valueForKey:[column identifier]]; } ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[KVCå®˜æ–¹æ–‡æ¡£-é”®å€¼ç¼–ç æŒ‡å—ç¬¬ä¸€éƒ¨åˆ†]]></title>
    <url>%2F2018%2F09%2F18%2FKVC%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-%E9%94%AE%E5%80%BC%E7%BC%96%E7%A0%81%E6%8C%87%E5%8D%97%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%2F</url>
    <content type="text"><![CDATA[Key-Value Coding Programming Guide å®˜æ–¹æ–‡æ¡£ç¬¬ä¸€éƒ¨åˆ†2018.9.20 ç¬¬ä¸€æ¬¡ä¿®æ­£ iOS-KVCå®˜æ–¹æ–‡æ¡£ç¬¬ä¸€éƒ¨åˆ† Key-Value Coding Programming Guide - Getting Started é”®å€¼ç¼–ç ç¼–ç¨‹æŒ‡å—-å…¥é—¨ è¯¥æ–‡æ¡£è‹¹æœå®˜æ–¹å·²ä¸å†æ›´æ–°ã€‚æœ‰å…³Apple SDKçš„æœ€æ–°ä¿¡æ¯ï¼Œè¯·è®¿é—®æ–‡æ¡£ç½‘ç«™ã€‚ å…³äºé”®å€¼ç¼–ç è¡¥å……: key-value coding ç¿»è¯‘ä¸º é”®å€¼ç¼–ç  , ç®€ç§°KVC. é”®å€¼ç¼–ç æ˜¯ä¸€ç§ç”±NSKeyValueCodingéæ­£å¼åè®®å¯ç”¨çš„æœºåˆ¶ï¼Œå¯¹è±¡é‡‡ç”¨è¯¥æœºåˆ¶æä¾›å¯¹å…¶å±æ€§çš„é—´æ¥è®¿é—®ã€‚å½“å¯¹è±¡ç¬¦åˆé”®å€¼ç¼–ç æ—¶ï¼Œå…¶å±æ€§å¯é€šè¿‡å­—ç¬¦ä¸²å‚æ•°é€šè¿‡ç®€æ´ï¼Œç»Ÿä¸€çš„æ¶ˆæ¯ä¼ é€’æ¥å£å¯»å€ã€‚è¿™ç§é—´æ¥è®¿é—®æœºåˆ¶è¡¥å……äº†å®ä¾‹å˜é‡åŠå…¶ç›¸å…³è®¿é—®å™¨æ–¹æ³•æä¾›çš„ç›´æ¥è®¿é—®ã€‚ æ‚¨é€šå¸¸ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚getè®¿é—®å™¨ï¼ˆæˆ–getterï¼‰è¿”å›å±æ€§çš„å€¼ã€‚setè®¿é—®å™¨ï¼ˆæˆ–setterï¼‰è®¾ç½®å±æ€§çš„å€¼ã€‚åœ¨Objective-Cä¸­ï¼Œæ‚¨è¿˜å¯ä»¥ç›´æ¥è®¿é—®å±æ€§çš„åŸºç¡€å®ä¾‹å˜é‡ã€‚ä»¥ä»»ä½•è¿™äº›æ–¹å¼è®¿é—®å¯¹è±¡å±æ€§éƒ½å¾ˆç®€å•ï¼Œä½†éœ€è¦è°ƒç”¨ç‰¹å®šäºå±æ€§çš„æ–¹æ³•æˆ–å˜é‡åç§°ã€‚éšç€å±æ€§åˆ—è¡¨çš„å¢é•¿æˆ–å˜åŒ–ï¼Œè®¿é—®è¿™äº›å±æ€§çš„ä»£ç ä¹Ÿå¿…é¡»å¦‚æ­¤ã€‚ç›¸åï¼Œç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡æä¾›äº†ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯ä¼ é€’æ¥å£ï¼Œè¯¥æ¥å£åœ¨å…¶æ‰€æœ‰å±æ€§ä¸­éƒ½æ˜¯ä¸€è‡´çš„ã€‚ é”®å€¼ç¼–ç æ˜¯ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œæ˜¯è®¸å¤šå…¶ä»–CocoaæŠ€æœ¯çš„åŸºç¡€ï¼Œä¾‹å¦‚é”®å€¼è§‚å¯Ÿ(key-value observing)ï¼ŒCocoaç»‘å®š(Cocoa bindings)ï¼ŒCore Dataå’ŒAppleScript-abilityã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé”®å€¼ç¼–ç è¿˜æœ‰åŠ©äºç®€åŒ–ä»£ç ã€‚ ä½¿ç”¨é”®å€¼ç¼–ç å…¼å®¹å¯¹è±¡å¯¹è±¡é€šå¸¸åœ¨NSObjectï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰ç»§æ‰¿æ—¶é‡‡ç”¨é”®å€¼ç¼–ç ï¼Œå®ƒä»¬éƒ½é‡‡ç”¨NSKeyValueCodingåè®®å¹¶ä¸ºåŸºæœ¬æ–¹æ³•æä¾›é»˜è®¤å®ç°ã€‚è¿™æ ·çš„å¯¹è±¡é€šè¿‡ç´§å‡‘çš„æ¶ˆæ¯ä¼ é€’æ¥å£ä½¿å…¶ä»–å¯¹è±¡èƒ½å¤Ÿæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š è®¿é—®å¯¹è±¡å±æ€§ã€‚è¯¥åè®®æŒ‡å®šæ–¹æ³•ï¼Œä¾‹å¦‚getter valueForKey: å’Œsetter setValue:forKey:ï¼Œç”¨äºé€šè¿‡åç§°æˆ–é”®è®¿é—®å¯¹è±¡å±æ€§ï¼Œå‚æ•°ä¸ºå­—ç¬¦ä¸²ã€‚è¿™äº›å’Œç›¸å…³æ–¹æ³•çš„é»˜è®¤å®ç°ä½¿ç”¨é”®æ¥å®šä½åŸºç¡€æ•°æ®å¹¶ä¸å…¶äº¤äº’ï¼Œå¦‚Accessing Object Propertiesã€‚ æ“çºµé›†åˆå±æ€§ã€‚è®¿é—®æ–¹æ³•çš„é»˜è®¤å®ç°å’Œå¯¹è±¡çš„é›†åˆå±æ€§ï¼ˆå¦‚NSArrayå¯¹è±¡ï¼‰ä¸€æ ·ï¼Œä¹Ÿå’Œä»»ä½•å…¶ä»–å±æ€§ä¸€æ ·ã€‚æ­¤å¤–ï¼Œå¦‚æœå¯¹è±¡å®šä¹‰å±æ€§çš„é›†åˆè®¿é—®å™¨æ–¹æ³•ï¼Œåˆ™å®ƒå…è®¸å¯¹é›†åˆå†…å®¹è¿›è¡Œé”®å€¼è®¿é—®ã€‚è¿™é€šå¸¸æ¯”ç›´æ¥è®¿é—®æ›´æœ‰æ•ˆï¼Œå¹¶å…è®¸æ‚¨é€šè¿‡æ ‡å‡†åŒ–ç•Œé¢ä½¿ç”¨è‡ªå®šä¹‰é›†åˆå¯¹è±¡ï¼Œå¦‚Accessing Collection Propertiesã€‚ åœ¨é›†åˆå¯¹è±¡ä¸Šè°ƒç”¨é›†åˆè¿ç®—ç¬¦ã€‚åœ¨ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡ä¸­è®¿é—®é›†åˆå±æ€§æ—¶ï¼Œå¯ä»¥å°†é›†åˆè¿ç®—ç¬¦æ’å…¥åˆ°é”®å­—ç¬¦ä¸²ä¸­ï¼Œå¦‚Using Collection Operatorsã€‚é›†åˆè¿ç®—ç¬¦æ ¹æ®é»˜è®¤çš„NSKeyValueCodinggetterå®ç°å¯¹é›†åˆæ‰§è¡Œæ“ä½œï¼Œç„¶åè¿”å›é›†åˆçš„æ–°çš„è¿‡æ»¤ç‰ˆæœ¬æˆ–è¡¨ç¤ºé›†åˆçš„æŸäº›ç‰¹å¾çš„å•ä¸ªå€¼ã€‚ è®¿é—®éå¯¹è±¡å±æ€§ã€‚åè®®é»˜è®¤å®ç°æ£€æµ‹éå¯¹è±¡å±æ€§ï¼ŒåŒ…æ‹¬æ ‡é‡å’Œç»“æ„ä½“ï¼Œå¹¶è‡ªåŠ¨å°†å®ƒä»¬åŒ…è£…å’Œè§£åŒ…ä¸ºåè®®æ¥å£ä¸Šä½¿ç”¨çš„å¯¹è±¡ï¼Œå¦‚Representing Non-Object Valuesã€‚æ­¤å¤–ï¼Œè¯¥åè®®å£°æ˜äº†ä¸€ç§æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸å…¼å®¹å¯¹è±¡nilé€šè¿‡é”®å€¼ç¼–ç æ¥å£åœ¨éå¯¹è±¡å±æ€§ä¸Šè®¾ç½®å€¼æ—¶ä¸ºè¯¥æƒ…å†µæä¾›åˆé€‚çš„ä½œç”¨ã€‚ key pathè®¿é—®å±æ€§ã€‚å¦‚æœå…·æœ‰ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨åŸºäºkey pathçš„æ–¹æ³•è°ƒç”¨ï¼Œä½¿ç”¨å•ä¸ªè°ƒç”¨åœ¨å±‚æ¬¡ç»“æ„å†…æ·±å…¥æŸ¥çœ‹ï¼Œè·å–æˆ–è®¾ç½®å€¼ã€‚ é‡‡ç”¨å¯¹è±¡çš„é”®å€¼ç¼–ç ä¸ºäº†ä½¿æ‚¨è‡ªå·±çš„å¯¹è±¡é”®å€¼ç¼–ç ç¬¦åˆè¦æ±‚ï¼Œæ‚¨éœ€è¦ç¡®ä¿å®ƒä»¬é‡‡ç”¨NSKeyValueCodingéæ­£å¼åè®®å¹¶å®ç°ç›¸åº”çš„æ–¹æ³•ï¼Œä¾‹å¦‚ä½œä¸ºvalueForKey: é€šç”¨getterå’ŒsetValue:forKey: é€šç”¨setterã€‚å¹¸è¿çš„æ˜¯ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼ŒNSObject é‡‡ç”¨æ­¤åè®®å¹¶ä¸ºè¿™äº›å’Œå…¶ä»–åŸºæœ¬æ–¹æ³•æä¾›é»˜è®¤å®ç°ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä»NSObjectï¼ˆæˆ–å…¶è®¸å¤šå­ç±»ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼‰æ´¾ç”Ÿå¯¹è±¡ï¼Œé‚£ä¹ˆå¤§éƒ¨åˆ†å·¥ä½œå·²ç»å®Œæˆã€‚ ä¸ºäº†ä½¿é»˜è®¤æ–¹æ³•å®Œæˆå…¶å·¥ä½œï¼Œæ‚¨éœ€è¦ç¡®ä¿å¯¹è±¡çš„è®¿é—®å™¨æ–¹æ³•å’Œå®ä¾‹å˜é‡éµå¾ªæŸäº›æ˜ç¡®å®šä¹‰çš„æ¨¡å¼ã€‚è¿™å…è®¸é»˜è®¤å®ç°æ‰¾åˆ°å¯¹è±¡çš„å±æ€§ä»¥å“åº”é”®å€¼ç¼–ç æ¶ˆæ¯ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€‰æ‹©é€šè¿‡æä¾›éªŒè¯æ–¹æ³•å’Œå¤„ç†æŸäº›ç‰¹æ®Šæƒ…å†µæ¥æ‰©å±•å’Œè‡ªå®šä¹‰é”®å€¼ç¼–ç ã€‚ ä½¿ç”¨Swiftè¿›è¡Œé”®å€¼ç¼–ç NSObjectä»å…¶å­ç±»æˆ–å…¶å­ç±»ä¹‹ä¸€ ç»§æ‰¿çš„Swiftå¯¹è±¡é»˜è®¤æƒ…å†µä¸‹æ˜¯ç¬¦åˆå…¶å±æ€§çš„é”®å€¼ç¼–ç ã€‚è€Œåœ¨Objective-Cä¸­ï¼Œå±æ€§çš„è®¿é—®å™¨å’Œå®ä¾‹å˜é‡å¿…é¡»éµå¾ªæŸäº›æ¨¡å¼ï¼ŒSwiftä¸­çš„æ ‡å‡†å±æ€§å£°æ˜ä¼šè‡ªåŠ¨ä¿è¯è¿™ä¸€ç‚¹ã€‚å¦ä¸€æ–¹é¢ï¼Œåè®®çš„è®¸å¤šåŠŸèƒ½è¦ä¹ˆä¸ç›¸å…³ï¼Œè¦ä¹ˆä½¿ç”¨Objective-Cä¸­ä¸å­˜åœ¨çš„æœ¬æœºSwiftæ„é€ æˆ–æŠ€æœ¯æ¥æ›´å¥½åœ°å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå› ä¸ºæ‰€æœ‰Swiftå±æ€§éƒ½æ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æ‚¨æ°¸è¿œä¸ä¼šä½¿ç”¨é»˜è®¤å®ç°å¯¹éå¯¹è±¡å±æ€§çš„ç‰¹æ®Šå¤„ç†ã€‚ å› æ­¤ï¼Œè™½ç„¶é”®å€¼ç¼–ç åè®®æ–¹æ³•ç›´æ¥è½¬æ¢ä¸ºSwiftï¼Œä½†æœ¬æŒ‡å—ä¸»è¦å…³æ³¨Objective-Cï¼Œæ‚¨éœ€è¦åšæ›´å¤šå·¥ä½œä»¥ç¡®ä¿åˆè§„æ€§ï¼Œä»¥åŠé”®å€¼ç¼–ç é€šå¸¸æœ€æœ‰ç”¨çš„åœ°æ–¹ã€‚æ•´ä¸ªæŒ‡å—ä¸­éƒ½æåˆ°äº†éœ€è¦åœ¨Swiftä¸­é‡‡ç”¨æ˜æ˜¾ä¸åŒæ–¹æ³•çš„æƒ…å†µã€‚ æœ‰å…³ä½¿ç”¨Swiftå’ŒCocoaæŠ€æœ¯çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»å°†Swiftä¸Cocoaå’ŒObjective-Cä¸€èµ·ä½¿ç”¨ï¼ˆSwift 3ï¼‰ã€‚æœ‰å…³Swiftçš„å®Œæ•´æè¿°ï¼Œè¯·é˜…è¯»Swiftç¼–ç¨‹è¯­è¨€ï¼ˆSwift 3ï¼‰ã€‚ ä½¿ç”¨é”®å€¼ç¼–ç çš„å…¶ä»–CocoaæŠ€æœ¯ç¬¦åˆé”®å€¼ç¼–ç çš„å¯¹è±¡å¯ä»¥å‚ä¸ä¾èµ–äºæ­¤ç±»è®¿é—®çš„å„ç§CocoaæŠ€æœ¯ï¼ŒåŒ…æ‹¬ï¼š é”®å€¼è§‚å¯Ÿ(Key-value observing)ã€‚æ­¤æœºåˆ¶ä½¿å¯¹è±¡èƒ½å¤Ÿæ³¨å†Œå¼‚æ­¥é€šçŸ¥ç›‘å¬å¦ä¸€ä¸ªå¯¹è±¡å±æ€§çš„æ”¹å˜ï¼Œå¦‚â€œ Key-Value Observing Programmingã€‚ Cocoaç»‘å®š(Cocoa bindings)ã€‚è¿™ä¸€ç³»åˆ—æŠ€æœ¯å®Œå…¨å®ç°äº†Model-View-ControllerèŒƒä¾‹ï¼Œå…¶ä¸­æ¨¡å‹(Model)ç”¨äºå°è£…åº”ç”¨ç¨‹åºæ•°æ®ï¼Œè§†å›¾(View)ç”¨äºæ˜¾ç¤ºå’Œç¼–è¾‘æ•°æ®ï¼Œæ§åˆ¶å™¨(Controller)åœ¨ä¸¤è€…ä¹‹é—´è¿›è¡Œè°ƒè§£ã€‚é˜…è¯»Cocoa Bindings Programming Topicsä»¥äº†è§£æœ‰å…³Cocoaç»‘å®šçš„æ›´å¤šä¿¡æ¯ã€‚ æ ¸å¿ƒæ•°æ®(Core Data)ã€‚è¯¥æ¡†æ¶ä¸ºä¸å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’Œå¯¹è±¡å›¾å½¢åŒ–ç®¡ç†ç›¸å…³çš„å¸¸è§ä»»åŠ¡ï¼ˆåŒ…æ‹¬æŒä¹…æ€§ï¼‰æä¾›é€šç”¨å’Œè‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚æ‚¨å¯ä»¥åœ¨Core Data Programming Guideé˜…è¯»Core Data ã€‚ AppleScriptã€‚è¿™ç§è„šæœ¬è¯­è¨€å¯ä»¥ç›´æ¥æ§åˆ¶è„šæœ¬åŒ–åº”ç”¨ç¨‹åºå’ŒmacOSçš„è®¸å¤šéƒ¨åˆ†ã€‚Cocoaçš„è„šæœ¬æ”¯æŒåˆ©ç”¨é”®å€¼ç¼–ç æ¥è·å–å’Œè®¾ç½®è„šæœ¬åŒ–å¯¹è±¡ä¸­çš„ä¿¡æ¯ã€‚NSScriptKeyValueCodingéæ­£å¼åè®®ä¸­çš„æ–¹æ³•æä¾›äº†ä½¿ç”¨é”®å€¼ç¼–ç çš„é™„åŠ åŠŸèƒ½ï¼ŒåŒ…æ‹¬é€šè¿‡å¤šå€¼é”®ä¸­çš„ç´¢å¼•è·å–å’Œè®¾ç½®é”®å€¼ï¼Œä»¥åŠå°†é”®å€¼å¼ºåˆ¶ï¼ˆæˆ–è½¬æ¢ï¼‰ä¸ºé€‚å½“çš„æ•°æ®ç±»å‹ã€‚AppleScript Overviewæä¾›äº†AppleScriptåŠå…¶ç›¸å…³æŠ€æœ¯çš„é«˜çº§æ¦‚è¿°ã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOSæ–‡æ¡£</category>
      </categories>
      <tags>
        <tag>æ–‡æ¡£ç¿»è¯‘</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UITableViewçš„åˆ†å‰²çº¿è®¾ç½®åŠä¸èƒ½å…¨å±åŸå› ]]></title>
    <url>%2F2018%2F09%2F17%2FUITableView%E7%9A%84%E5%88%86%E5%89%B2%E7%BA%BF%E8%AE%BE%E7%BD%AE%E5%8F%8A%E4%B8%8D%E8%83%BD%E5%85%A8%E5%B1%8F%E5%8E%9F%E5%9B%A0%2F</url>
    <content type="text"><![CDATA[ä¸€èˆ¬TableViewè®¾ç½®å…¨å±åˆ†éš”çº¿æœ‰ä¸‹é¢ä¸‰ç§æ–¹æ³• æ–¹æ³•1:è‡ªå®šä¹‰cell, æ‰‹åŠ¨æ·»åŠ åˆ†å‰²çº¿ é¦–å…ˆå…ˆéšè—ç³»ç»Ÿè‡ªå¸¦çš„åˆ†å‰²çº¿, æ¥ä¸‹æ¥æœ‰2ç§åšæ³• (å»ºè®®ä½¿ç”¨åšæ³•a) tableView.separatorStyle = UITableViewCellSeparatorStyleNone; æˆ–è€… self.tableView.separatorColor = [UIColor clearColor]; åšæ³•a: å¯ä»¥é€šè¿‡addSubviewçš„æ–¹å¼æ·»åŠ ä¸€æ¡åˆ†å‰²çº¿ - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellId forIndexPath:indexPath]; //è‡ªå®šä¹‰åˆ†å‰²çº¿æ–¹æ³•ä¸€: é€šè¿‡addSubviewçš„æ–¹å¼æ·»åŠ ä¸€æ¡åˆ†å‰²çº¿ //åœ¨è‡ªå®šä¹‰cell é‡Œé¢ç»™æ¯ä¸ªcellæ·»åŠ é«˜åº¦ä¸º2çš„çº¢è‰²åˆ†å‰²çº¿ CGFloat cellH = cell.frame.size.height; if(indexPath.row != cars.count - 1){ UIView *line = [[UIView alloc] initWithFrame:CGRectMake(0, cellH-2, self.view.frame.size.width, 2)]; line.backgroundColor = [UIColor redColor]; [cell addSubview:line]; } return cell; } åšæ³•b:ä¹Ÿå¯ä»¥è‡ªå®šä¹‰cell, cellä¸­é‡å†™drawRect: è‡ªç»˜åˆ†å‰²çº¿ // è‡ªç»˜åˆ†å‰²çº¿ - (void)drawRect:(CGRect)rect { CGContextRef context = UIGraphicsGetCurrentContext(); CGContextSetFillColorWithColor(context, [UIColor whiteColor].CGColor); CGContextFillRect(context, rect); CGContextSetStrokeColorWithColor(context, [UIColor greenColor].CGColor); //ç»˜åˆ¶é«˜åº¦ä¸º2ç»¿è‰²åˆ†å‰²çº¿ CGContextStrokeRect(context, CGRectMake(0, rect.size.height - 2, rect.size.width, 2)); } æ–¹æ³•2:è‡ªå®šä¹‰cell , é‡å†™setFrameæ–¹æ³•,cellé«˜åº¦-1,éœ²å‡ºtableViewèƒŒæ™¯è‰² é¦–å…ˆéšè—ç³»ç»Ÿåˆ†å‰²çº¿, è®¾ç½®tableViewèƒŒæ™¯é¢œè‰². self.tableView.separatorStyle = UITableViewCellSeparatorStyleNone; // è®¾ç½®tableViewèƒŒæ™¯è‰² self.tableView.backgroundColor = [UIColor colorWithWhite:215 / 255.0 alpha:1]; åœ¨è‡ªå®šä¹‰cellä¸­é‡å†™setFrame: - (void)setFrame:(CGRect)frame { frame.size.height -= 1; // ç»™cellframeèµ‹å€¼ [super setFrame:frame]; } æ–¹æ³•3.åˆ©ç”¨ç³»ç»Ÿå±æ€§è®¾ç½®(separatorInset, layoutMargins), å…±éœ€æ·»åŠ ä¸‰å¥ä»£ç  å¯¹tableViewçš„separatorInset, layoutMarginså±æ€§çš„è®¾ç½® -(void)viewDidLoad { [super viewDidLoad]; //1.è°ƒæ•´(iOS7ä»¥ä¸Š)è¡¨æ ¼åˆ†éš”çº¿è¾¹è· if ([self.tableView respondsToSelector:@selector(setSeparatorInset:)]) { self.tableView.separatorInset = UIEdgeInsetsZero; } //2.è°ƒæ•´(iOS8ä»¥ä¸Š)viewè¾¹è·(æˆ–è€…åœ¨cellä¸­è®¾ç½®preservesSuperviewLayoutMargins,äºŒè€…ç­‰æ•ˆ) if ([self.tableView respondsToSelector:@selector(setLayoutMargins:)]) { self.tableView.layoutMargins = UIEdgeInsetsZero; } } å¯¹cellçš„LayoutMarginså±æ€§çš„è®¾ç½® è¡¥å……:å¯¹cellçš„è®¾ç½®å¯ä»¥å†™åœ¨cellForRowAtIndexPathé‡Œ,ä¹Ÿå¯ä»¥å†™åœ¨willDisplayCellæ–¹æ³•é‡Œ -(UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:ID forIndexPath:indexPath]; //2.è°ƒæ•´(iOS8ä»¥ä¸Š)tableViewè¾¹è·(ä¸ä¸Šé¢ç¬¬2æ­¥ç­‰æ•ˆ,äºŒé€‰ä¸€å³å¯) if ([cell respondsToSelector:@selector(setPreservesSuperviewLayoutMargins:)]) { cell.preservesSuperviewLayoutMargins = NO; } //3.è°ƒæ•´(iOS8ä»¥ä¸Š)viewè¾¹è· if ([cell respondsToSelector:@selector(setLayoutMargins:)]) { [cell setLayoutMargins:UIEdgeInsetsZero]; } return cell; } ä¸‰ç§æ–¹æ³•ä¼˜ç¼ºç‚¹æ¯”è¾ƒ: æ–¹æ³•1 ä¸­åšæ³•aæ¯”è¾ƒå¥½ç”¨,å¯ä»¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„cell, ä½†æ˜¯éœ€è¦æ·»åŠ ä¸€ä¸ªview,è®¾ç½®èƒŒæ™¯é¢œè‰²å’Œframe. è€Œåšæ³•bä»…ä»…ä¸ºäº†åˆ†éš”çº¿å´è¿˜å¿…é¡»å†è‡ªå®šä¹‰cell, é‡å†™drawRect,åˆæ˜¾å¾—éº»çƒ¦; æ–¹æ³•2æ¯”è¾ƒå–å·§,ä½†æ˜¯ä¹Ÿéœ€è¦è‡ªå®šä¹‰cell,åœ¨æŸäº›æƒ…å†µä¸‹ä¸å…è®¸æ”¹å˜tableViewçš„èƒŒæ™¯è‰²,ä½¿ç”¨åœºæ™¯æœ‰é™; æ–¹æ³•3ä¸éœ€è¦è‡ªå®šä¹‰cell,å¯¹ç³»ç»Ÿ(iOS7,iOS8ä»¥ä¸Š)åšä¸ªç®€å•åˆ¤æ–­å³å¯.å¯æƒœç½‘ä¸Šå¾ˆå¤šæ–‡ç« å†™çš„ä¸å¯¹,å¾ˆå¤šäººä¸ä¼šæ­£ç¡®ä½¿ç”¨,æœ‰äº›ä¼šç”¨çš„äººä¹Ÿè¯´ä¸æ¸…æ¥šåŸç†,åªç®¡å¤åˆ¶ç²˜è´´.æ¯”å¦‚ç½‘ä¸Šæµä¼ çš„ä¸€èˆ¬æ˜¯è¿™æ ·,éœ€è¦å››æ­¥,è™½ç„¶çœŸçš„ç®¡ç”¨,ä½†å¤šäº†ä¸€æ­¥[cell setSeparatorInset:UIEdgeInsetsZero];è€Œä¸”åŸç†ä¹Ÿæ²¡è®²,ä¼°è®¡æ˜¯æŸå¤§ç¥å†™çš„,æ ¹æœ¬ä¸å±‘äºè¿‡å¤šè§£é‡Š,è®©æˆ‘ç”¨èµ·æ¥å¾ˆéƒé—·,ç½‘ä¸Šæµä¼ ä»£ç : é¦–å…ˆåœ¨viewDidLoadæ–¹æ³•ä¸­åŠ ä¸Šå¦‚ä¸‹ä»£ç ï¼š -(void)viewDidLoad { [super viewDidLoad]; if ([self.tableView respondsToSelector:@selector(setSeparatorInset:)]) { [self.tableView setSeparatorInset:UIEdgeInsetsZero]; } if ([self.tableView respondsToSelector:@selector(setLayoutMargins:)]) { [self.tableView setLayoutMargins:UIEdgeInsetsZero]; } ç„¶ååœ¨willDisplayCellæ–¹æ³•ä¸­åŠ å…¥å¦‚ä¸‹ä»£ç ï¼š - (void)tableView:(UITableView *)tableView willDisplayCell:(UITableViewCell *)cell forRowAtIndexPath:(NSIndexPath *)indexPath { if ([cell respondsToSelector:@selector(setSeparatorInset:)]) { [cell setSeparatorInset:UIEdgeInsetsZero]; } if ([cell respondsToSelector:@selector(setLayoutMargins:)]) { [cell setLayoutMargins:UIEdgeInsetsZero]; } } åˆ†å‰²çº¿ä¸èƒ½å…¨å±åŸç†è§£æ å…¶å®å…³äºåˆ†éš”çº¿ä¸èƒ½å…¨å±çš„åŸç†,è‹¹æœå®˜æ–¹åœ¨æ–‡ä»¶ä¸­å·²ç»è¯´æ˜äº†,å¯ä»¥å»çœ‹ä¸€ä¸‹ åœ¨iOS7ä¹‹å‰ç³»ç»Ÿé»˜è®¤å°±æ˜¯å…¨å±çš„,iOS7æ—¶UITableViewå¤šäº†separatorInsetå±æ€§,å¯åœ¨UITableViewçš„å¤´æ–‡ä»¶ä¸­æŸ¥çœ‹,å¦‚ä¸‹: @property (nonatomic) UIEdgeInsets separatorInset NS_AVAILABLE_IOS(7_0) UI_APPEARANCE_SELECTOR; // allows customization of the frame of cell separators iOS7æ—¶åªè¦è®¾ç½®è¯¥å±æ€§ä¸ºUIEdgeInsetsZeroå°±æ²¡æœ‰é—®é¢˜äº†. iOS8ä¹‹åä»…ä»…å®Œæˆä»¥ä¸Šè®¾ç½®å°±ä¸è¡Œäº†,ä»”ç»†æŸ¥çœ‹åå‘ç°iOS8çš„UIViewçš„å¤´æ–‡ä»¶é‡Œåˆå¤šäº†ä¸ªlayoutMarginså±æ€§,å¹¶æœ‰å®˜æ–¹æ³¨é‡Š @property (nonatomic) UIEdgeInsets layoutMargins NS_AVAILABLE_IOS(8_0); /* -layoutMargins returns a set of insets from the edge of the view&#39;s bounds that denote a default spacing for laying out content. If preservesSuperviewLayoutMargins is YES, margins cascade down the view tree, adjusting for geometry offsets, so that setting the left value of layoutMargins on a superview will affect the left value of layoutMargins for subviews positioned close to the left edge of their superview&#39;s bounds If your view subclass uses layoutMargins in its layout or drawing, override -layoutMarginsDidChange in order to refresh your view if the margins change. */ å¤§æ„æ˜¯è¯´:layoutMarginsæ˜¯viewçš„boundsçš„è¾¹è·,ç”¨æ¥è°ƒæ•´å†…å®¹é»˜è®¤è¾¹è· å¦‚æœpreservesSuperviewLayoutMarginså±æ€§æ˜¯YES,é‚£ä¹ˆè®¾ç½®çˆ¶æ§ä»¶çš„layoutMarginsè¾¹è·, å°±ä¼šå½±å“æ‰€æœ‰å­æ§ä»¶çš„ç›¸å¯¹äºçˆ¶æ§ä»¶boundsçš„layoutMarginsè¾¹è· å¦‚æœä½ çš„viewçš„å­ç±»åœ¨å¸ƒå±€æˆ–è€…ç»˜å›¾ä¸­ä½¿ç”¨äº†layoutMarginså±æ€§,éœ€è¦é‡å†™-layoutMarginsDidChange æ–¹æ³•, ä»¥ä¾¿å½“è¾¹è·æ”¹å˜æ—¶èƒ½åˆ·æ–°ä½ çš„view æ­£æ˜¯å› ä¸ºlayoutMarginsæ˜¯UIViewçš„æ–°å¢å±æ€§,tabletå’Œcellä½œä¸ºUIViewçš„å­ç±»éƒ½æœ‰è¿™ä¸ªå±æ€§,æ‰€ä»¥ç›¸æ¯”è¾ƒiOS7ç³»ç»Ÿ,iOS8ä¹‹åå°±å¤šäº†ä¸¤æ­¥,å¿…é¡»åŒæ—¶å†å¯¹tableViewå’Œcellçš„layoutMarginså±æ€§è¿›è¡Œå¤„ç†,æ‰èƒ½è®©åˆ†éš”çº¿çœŸæ­£å…¨å±. åŒæ—¶å®˜æ–¹æ³¨é‡Šä¸­å¯¹preservesSuperviewLayoutMargins(æ„å³:ç»´æŒçˆ¶æ§ä»¶çš„å¸ƒå±€è¾¹è·)å±æ€§çš„è¯´æ˜,ä¹Ÿæ­£å¥½èƒ½è¯´æ˜ç½‘ä¸Šå¦ä¸€ç§æ–¹æ³•ä¸è®¾ç½®self.tableView.layoutMargins = UIEdgeInsetsZero;è€Œæ˜¯è®¾ç½®cell.preservesSuperviewLayoutMargins = NO;ä¸ºä»€ä¹ˆä¹Ÿèƒ½èµ·ä½œç”¨ å¼„æ¸…æ¥šäº†è¿™äº›åŸç†,å°±å¯ä»¥æ›´å¥½çš„è®°å¿†å’Œä½¿ç”¨è¿™äº›æ–¹æ³•,ä¸ç”¨æ¯æ¬¡éƒ½å»æ—§ä»£ç æŸ¥æ‰¾æˆ–è€…å»ç™¾åº¦äº†. è¯´åˆ°äº†æœ€å,ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰è§‰å¾—å½±å“åˆ†éš”çº¿å…¨å±çš„å…ƒå‡¶layoutMarginså±æ€§ ç¨å¾®æœ‰ç‚¹çœ¼ç†Ÿå‘¢?å…¶å®å®ƒåœ¨å¦ä¸€ä¸ªåœ°æ–¹ä¹Ÿåšäº†ä¸å°‘æ¶,å°±åœ¨storyboardä¸­: PS:é™„æ•ˆæœå›¾å¦‚ä¸‹: è®¾ç½®ä¹‹å‰æ•ˆæœå›¾: è®¾ç½®å®Œç¬¬1æ­¥self.tableView.separatorInset = UIEdgeInsetsZero;åæ•ˆæœå›¾: è®¾ç½®å®Œç¬¬2æ­¥self.tableView.layoutMargins = UIEdgeInsetsZero;åæ•ˆæœå›¾: è®¾ç½®å®Œç¬¬3æ­¥cell.layoutMargins = UIEdgeInsetsZero;åæ•ˆæœå›¾: ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSæŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[UITableViewStylePlainå’ŒUITableViewStyleGroupedæ ·å¼çš„åŒºåˆ«åŠæ•ˆæœå¤„ç†]]></title>
    <url>%2F2018%2F09%2F15%2FUITableViewStylePlain%E5%92%8CUITableViewStyleGrouped%E6%A0%B7%E5%BC%8F%E7%9A%84%E5%8C%BA%E5%88%AB%E5%8F%8A%E6%95%88%E6%9E%9C%E5%A4%84%E7%90%86%2F</url>
    <content type="text"><![CDATA[åˆ›å»ºUITableView æ—¶, éœ€è¦è®¾ç½®TableViewæ ·å¼, é»˜è®¤æœ‰ä¸¤ç§æ ·å¼:UITableViewStylePlain, UITableViewStyleGrouped UITableView *tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, 0, self.view.frame.size.width, self.view.frame.size.height) style: UITableViewStyleGrouped] ä¸‹é¢å…ˆä»‹ç»ä¸‹, è¿™ä¸¤ç§æ ·å¼ä»¥åŠåŒºåˆ«: ä¸€. UITableViewæ ·å¼ä»‹ç»UITableViewStylePlain ä»‹ç»åœ¨tableViewçš„UITableViewStylePlainä¸­ï¼Œå½“ä¸€ä¸ªsectionçš„rowsæœ‰ä¸€éƒ¨åˆ†å¯è§æ—¶ï¼Œsectionçš„headerå’Œfooteræµ®åŠ¨åœ¨å†…å®¹é¡¶éƒ¨ã€‚plain styleçš„tableViewå¯ä»¥æœ‰ä¸€ä¸ªsectionç´¢å¼•ï¼Œä½œä¸ºä¸€ä¸ªbaråœ¨tableçš„å³è¾¹(ä¾‹å¦‚A ~ Z)ã€‚ä½ å¯ä»¥ç‚¹å‡»ä¸€ä¸ªç‰¹å®šçš„æ ‡ç­¾ï¼Œè·³è½¬åˆ°ç›®æ ‡sectionã€‚ä¾‹å¦‚ä¸‹å›¾ï¼š UITableViewStyleGroup ä»‹ç»åœ¨tableViewçš„UITableViewStyleGroupä¸­ï¼Œæ‰€æœ‰å•å…ƒæ ¼æ‹¥æœ‰ä¸€ä¸ªé»˜è®¤çš„èƒŒæ™¯é¢œè‰²å’Œé»˜è®¤èƒŒæ™¯è§†å›¾ã€‚èƒŒæ™¯è§†å›¾ä¸ºç‰¹å®šsectionä¸­çš„æ‰€æœ‰cellæä¾›å¯è§†åˆ†ç»„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªgroupå¯ä»¥æ˜¯ä¸€ä¸ªäººçš„åå­—å’Œæ ‡é¢˜ï¼Œå¦ä¸€ä¸ªgroupå¯ä»¥æ˜¯ç”µè¯,ç”µå­é‚®ä»¶å¸æˆ·ç­‰ã€‚å¯å‚è€ƒiphoneâ€œè®¾ç½®â€ç¨‹åºã€‚ä¾‹å¦‚ä¸‹å›¾ï¼š Groupç±»å‹é»˜è®¤è®¾ç½®tableViewç°è‰²èƒŒæ™¯è‰²ï¼Œcellä¸ºç™½è‰²èƒŒæ™¯è‰²ï¼Œsectionå¤–è¾¹ç¼˜è®¾ç½®æµ…ç°è‰²è¾¹æ¡†ï¼Œcellè®¾ç½®æµ…ç°è‰²é—´éš”çº¿ã€‚å¦‚ä¸‹å›¾ï¼š äºŒ:åŒºåˆ«æ€»ç»“ï¼šUITableViewStylePlainä½¿ç”¨1.plainç±»å‹æœ‰å¤šæ®µæ—¶ï¼Œæ»šåŠ¨æ—¶Section Header åœ¨é¡¶éƒ¨åœç•™ï¼Œæœ‰äº›ç•Œé¢æ¯”å¦‚è®¾ç½®ç•Œé¢ï¼Œè¿™äº›æ–°ç‰¹æ€§å°†æ˜¾å¾—å¤šä½™ã€‚ï¼ˆè‡ªå¸¦æ•ˆæœï¼‰ 2.plainç±»å‹é»˜è®¤sectionä¹‹é—´æ²¡æœ‰ä¸­é—´çš„é—´è·å’Œå¤´éƒ¨é—´è·ï¼ˆæƒ³è®©plainç±»å‹çš„sectionä¹‹é—´ç•™æœ‰ç©ºç™½ï¼Œéœ€è¦åœ¨UITableViewä»£ç†æ–¹æ³•ä¸­returnè‡ªå®šä¹‰çš„headerViewå’ŒfooterViewï¼Œå¹¶åœ¨è‡ªå®šä¹‰çš„headerView å’Œ footerView é‡Œé¢é‡å†™setFrameæ–¹æ³•ï¼‰ è§£å†³æ–¹æ¡ˆï¼šè®©plainç±»å‹çš„UITableViewçš„sectionå¤´éƒ¨è§†å›¾ä¸åœç•™ï¼ˆå–æ¶ˆç²˜æ€§æ•ˆæœï¼‰ æ–¹æ³•ä¸€: ç½‘ä¸Šå¥½å¤šéƒ½æ˜¯è¿™ä¸ªæ–¹æ³•. è¿™ä¸ªä»£ç æ˜¯é€šè¿‡scrollåç§»é‡æ¥ç›‘å¬å’Œæ”¹å˜ä½ çš„tableViewçš„contentInset å¯è§å¾ˆä¸å¥½ï¼ˆè¯•è¯•å°±çŸ¥é“ï¼‰ //å»æ‰UItableview headerviewé»æ€§(sticky) - (void)scrollViewDidScroll:(UIScrollView *)scrollView { CGFloat sectionHeaderHeight = 30; if (scrollView.contentOffset.y =0) { scrollView.contentInset = UIEdgeInsetsMake(-scrollView.contentOffset.y, 0, 0, 0); } else if (scrollView.contentOffset.y >= sectionHeaderHeight) { scrollView.contentInset = UIEdgeInsetsMake(-sectionHeaderHeight, 0, 0, 0); } } æ–¹æ³•äºŒ: åœ¨è‡ªå®šä¹‰sectionçš„headerViewä¸­, é‡å†™setFrame: æ–¹æ³•æ¥é‡è½½tableçš„section. æ³¨æ„:setFrameæ–¹æ³•ä¸­éœ€è¦æ‹¿åˆ°é‡è½½çš„tableå’Œsection! - (void)setFrame:(CGRect)frame { CGRect sectionRect = [self.tableView rectForSection:self.section]; CGRect newFrame = CGRectMake(CGRectGetMinX(frame), CGRectGetMinY(sectionRect), CGRectGetWidth(frame), CGRectGetHeight(frame)); [super setFrame:newFrame]; } UITableViewStyleGroup ä½¿ç”¨è§£å†³æ–¹æ¡ˆï¼šå»æ‰ UITableViewStyleGroupç±»å‹çš„å¤šä½™é—´è· åº”ç”¨åœºæ™¯ä¸€: sctionçš„å¤´éƒ¨è§†å›¾å’Œå°¾éƒ¨è§†å›¾,æ— ä»»ä½•å†…å®¹ æ­¤åº”ç”¨åœºæ™¯éœ€è¦åˆ†ä¸¤æ­¥åš:ç¬¬ä¸€æ­¥: å¤„ç†ç¬¬ä¸€ä¸ªsectionä¸Šè¾¹å¤šä½™é—´è·(2ç§æ–¹æ³•) æ–¹æ³•ä¸€: tableViewçš„tableHeaderViewå±æ€§ æ³¨æ„: è®¾ç½®tableViewå¤´éƒ¨è§†å›¾çš„é«˜åº¦ä¸ºç‰¹å°å€¼ï¼Œä½†ä¸èƒ½ä¸ºé›¶ï¼Œè‹¥ä¸ºé›¶çš„è¯ï¼ŒiOSä¼šå–é»˜è®¤å€¼ï¼Œå°±æ— æ³•æ¶ˆé™¤å¤´éƒ¨é—´è·äº†ã€‚ - (void)viewDidLoad { //è®¾ç½®ä»£ç† tableView.delegate = self; //éšè—UITableViewStyleGroupedä¸Šè¾¹å¤šä½™çš„é—´éš” tableView.tableHeaderView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 0, CGFLOAT_MIN)]; } æ–¹æ³•äºŒ: è®¾ç½®é¡¶éƒ¨é¢æ»šåŠ¨åŒºåŸŸ tableView.contentInset = UIEdgeInsetsMake(-20, 0, 0, 0); è¡¥å……: å±æ€§tableHeaderViewå’ŒcontentInset ç»“åˆä½¿ç”¨, å¯ä»¥è®¾ç½®è¡¨æ ¼ç¬¬ä¸€ä¸ªcellé¡¶åˆ°æœ€é¡¶éƒ¨ tableView.tableHeaderView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 0, CGFLOAT_MIN)]; tableView.contentInset = UIEdgeInsetsMake(-20, 0, 0, 0); ç¬¬äºŒæ­¥: å¤„ç†æ¯ä¸ªsectionä¸‹è¾¹å¤šä½™é—´è·(2ç§æ–¹æ³•) Groupæ ·å¼, é»˜è®¤æ¯ä¸€ç»„éƒ½ä¼šæœ‰å¤´éƒ¨å’Œå°¾éƒ¨é—´è·, è¿™ä¸¤ä¸ªé—´è·ä¿ç•™ä¸€ä¸ªå°±å¯ä»¥äº†.å¦ä¸€ä¸ªé—´è·è®¾ç½®ä¸º0. æ–¹æ³•ä¸€: tableView å±æ€§sectionHeaderHeight å’Œ å±æ€§sectionFooterHeight , å¤„ç†å¤šä½™é—´è· //è®¾ç½®tableViewä¸»é—´è·ä¸º20 tableView.sectionHeaderHeight = 0; tableView.sectionFooterHeight = 20; æ–¹æ³•äºŒ: è°ƒç”¨tableViewçš„ä»£ç†æ–¹æ³• , è®¾ç½®å°¾éƒ¨è§†å›¾çš„é«˜åº¦ï¼Œ æ³¨æ„: å»æ‰çš„è§†å›¾, è¿”å›å€¼ä¸èƒ½ä¸º0ï¼Œå¦åˆ™ç³»ç»Ÿå¯ç”¨é»˜è®¤å€¼ã€‚è¿”å›çš„é«˜åº¦ä½¿ç”¨æå°å€¼CGFLOAT_MINã€‚ æ³¨æ„2: è°ƒç”¨ä¸‹é¢ä¸¤ä¸ªtableViewä»£ç†æ–¹æ³•å, sectionHeaderHeightå±æ€§å’ŒsectionFooterHeightå±æ€§è®¾ç½®çš„å€¼å¤±æ•ˆ. - (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{ return 44; } // æ³¨æ„:return height ä¸º 0ï¼Œåˆ™ height è¢«è®¾ç½®æˆé»˜è®¤å€¼ - (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{ return CGFLOAT_MIN; } åº”ç”¨åœºæ™¯äºŒ: sctionæœ‰å¤´éƒ¨æ ‡é¢˜ å°¾éƒ¨æ ‡é¢˜æ­¤åº”ç”¨åœºæ™¯ä¸¤ç§æ–¹æ³•å–å…¶ä¸€, å¯ä»¥åŒæ—¶å¤„ç†sectioné¡¶éƒ¨é—´è·å’Œä¸­é—´é—´è· æ–¹æ³•ä¸€: è®¾ç½® tableView å±æ€§sectionHeaderHeight å’Œ å±æ€§sectionFooterHeight , å¯åŒæ—¶å¤„ç†sectionå¤šä½™é¡¶éƒ¨é—´è·å’Œä¸­é—´é—´è· tableView.sectionHeaderHeight = 30; tableView.sectionFooterHeight = 0; æ–¹æ³•äºŒ:è°ƒç”¨tableViewçš„ä»£ç†æ–¹æ³• , è®¾ç½®å¤´éƒ¨è§†å›¾å’Œå°¾éƒ¨è§†å›¾çš„é«˜åº¦ //ç¬¬äºŒæ­¥:éšè—UITableViewStyleGroupedä¸‹è¾¹å¤šä½™çš„é—´éš” - (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{ return 30; } // æ³¨æ„:æ­¤æ—¶å¯ä»¥è®¾ç½®ä¸º0 - (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{ return 0; } åº”ç”¨åœºæ™¯ä¸‰: sectionè‡ªå®šä¹‰å¤´éƒ¨è§†å›¾å’Œå°¾éƒ¨è§†å›¾ è°ƒç”¨ä¸‹é¢tableViewä»£ç†æ–¹æ³• è‡ªå®šä¹‰å¤´éƒ¨è§†å›¾å’Œå°¾éƒ¨è§†å›¾å, ä¸éœ€è¦åšé¡¶éƒ¨é—´è·å¤„ç†, ç¬¬ä¸€ä¸ªsectionå¤´éƒ¨è§†å›¾ä¼šè‡ªåŠ¨é¡¶åˆ°æœ€é¡¶éƒ¨. - (UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section{ } - (UIView *)tableView:(UITableView *)tableView viewForFooterInSection:(NSInteger)section{ } ä¸­é—´é—´è· åªéœ€è¦é€šè¿‡tableViewä»£ç†æ–¹æ³•, è°ƒæ•´å¤´éƒ¨è§†å›¾æˆ–è€…å°¾éƒ¨è§†å›¾å„è‡ªçš„é«˜åº¦å³å¯. - (CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section{ return 30; } //æ³¨æ„:æ­¤æ—¶å¯ä»¥è®¾ç½®ä¸º0 - (CGFloat)tableView:(UITableView *)tableView heightForFooterInSection:(NSInteger)section{ return 0; } ä¸‰. åœ¨ Storyboard ä¸­ 0 ä»£ç æå®šé¡¶éƒ¨å¤šä½™é—´è·æ²¡ç”¨ Storyboard çš„åŒå­¦ä½¿ç”¨ä¸Šé¢çš„ä»£ç å°± OK äº†ï¼›è€Œåœ¨ Storyboard ä¸­å¯ä»¥ 0 ä»£ç æå®šè¿™ä¸ªäº‹ï¼š é¦–å…ˆï¼Œåœ¨ç¬¬ä¸€ä¸ª Section çš„ä¸Šé¢æ‹–è¿›æ¥ä¸€ä¸ªç©º UIView ç„¶åé€‰ä¸­è¿™ä¸ª UIView çš„ Runtime Attributes æ ï¼Œæ·»åŠ ä¸€ä¸ª frame çš„ KeyPath è¿™æ ·å¤´éƒ¨çš„é—´éš”å°±ä¹–ä¹–çš„ä¸è§äº†ï¼š åˆ¨æ ¹é—®åº• UITableViewHeader çš„çŒ«è…»ä¸ºä»€ä¹ˆåˆšæ‰è¯´ 0.1 å’Œ CGFLOAT_MIN æ˜¯ç­‰æ•ˆçš„å‘¢ï¼Ÿç»è¿‡ç ”ç©¶ï¼Œè¿™ä¸ªé«˜åº¦å€¼çš„å½±å“å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š è‹¥ä¼ å…¥çš„ height == 0ï¼Œåˆ™ height è¢«è®¾ç½®æˆé»˜è®¤å€¼ è‹¥ height å°äºå±å¹•åŠåƒç´ å¯¹åº”çš„é«˜åº¦ï¼Œè¿™ä¸ª header ä¸åœ¨å¦ä¸€ä¸ªåƒç´ æ¸²æŸ“ åŠåƒç´ ä¹Ÿå°±æ˜¯ 1.0 / scale / 2.0ï¼Œå¦‚åœ¨ @2x å±ä¸Šæ˜¯ 0.25ç›´è§‚çš„æ„Ÿå—ä¸‹ï¼Œå‡å¦‚è¿™ä¸ª height è¢«è®¾ç½®æˆ 0.5 çš„æ ·å­ï¼š å¯¼èˆªæ ä¸‹é¢çš„é˜´å½±çº¿çœ‹ä¸Šå»å®½äº† 0.5 åƒç´ çš„ï¼ŒDoneã€‚ ç”±äºç¬”è€…æ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¿˜æœ›å¤§ç¥æŒ‡å‡ºã€‚é™„ä¸Šæœ¬æ–‡çš„æ‰€æœ‰ demo ä¸‹è½½é“¾æ¥ï¼Œã€GitHubã€‘ã€‚å¦‚æœä½ çœ‹å®Œåè§‰å¾—å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¿˜æœ›åœ¨ GitHub ä¸Šç‚¹ä¸ª starã€‚èµ äººç«ç‘°ï¼Œæ‰‹æœ‰ä½™é¦™ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSæŠ€æœ¯</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[runtimeä½¿ç”¨ç¤ºä¾‹ä»£ç ]]></title>
    <url>%2F2018%2F09%2F13%2Fruntime%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%2F</url>
    <content type="text"><![CDATA[ä¸€ã€runtimeç®€ä»‹ RunTimeç®€ç§°è¿è¡Œæ—¶ã€‚OCå°±æ˜¯è¿è¡Œæ—¶æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿è¡Œæ—¶å€™çš„ä¸€äº›æœºåˆ¶ï¼Œå…¶ä¸­æœ€ä¸»è¦çš„æ˜¯æ¶ˆæ¯æœºåˆ¶ã€‚ å¯¹äºCè¯­è¨€ï¼Œå‡½æ•°çš„è°ƒç”¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚ å¯¹äºOCçš„å‡½æ•°ï¼Œå±äºåŠ¨æ€è°ƒç”¨è¿‡ç¨‹ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸èƒ½å†³å®šçœŸæ­£è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œåªæœ‰åœ¨çœŸæ­£è¿è¡Œçš„æ—¶å€™æ‰ä¼šæ ¹æ®å‡½æ•°çš„åç§°æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°æ¥è°ƒç”¨ã€‚ äº‹å®è¯æ˜ï¼š åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒOCå¯ä»¥è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°å¹¶æœªå®ç°ï¼Œåªè¦å£°æ˜è¿‡å°±ä¸ä¼šæŠ¥é”™ã€‚ åœ¨ç¼–è¯‘é˜¶æ®µï¼ŒCè¯­è¨€è°ƒç”¨æœªå®ç°çš„å‡½æ•°å°±ä¼šæŠ¥é”™ã€‚ äºŒã€runtimeä½œç”¨1.å‘é€æ¶ˆæ¯ æ–¹æ³•è°ƒç”¨çš„æœ¬è´¨ï¼Œå°±æ˜¯è®©å¯¹è±¡å‘é€æ¶ˆæ¯ã€‚ objc_msgSend,åªæœ‰å¯¹è±¡æ‰èƒ½å‘é€æ¶ˆæ¯ï¼Œå› æ­¤ä»¥objcå¼€å¤´. ä½¿ç”¨æ¶ˆæ¯æœºåˆ¶å‰æï¼Œå¿…é¡»å¯¼å…¥#import &lt;objc/message.h&gt; æ¶ˆæ¯æœºåˆ¶ç®€å•ä½¿ç”¨ // åˆ›å»ºpersonå¯¹è±¡ Person *p = [[Person alloc] init]; // è°ƒç”¨å¯¹è±¡æ–¹æ³• [p eat]; // æœ¬è´¨ï¼šè®©å¯¹è±¡å‘é€æ¶ˆæ¯ objc_msgSend(p, @selector(eat)); // è°ƒç”¨ç±»æ–¹æ³•çš„æ–¹å¼ï¼šä¸¤ç§ // ç¬¬ä¸€ç§é€šè¿‡ç±»åè°ƒç”¨ [Person eat]; // ç¬¬äºŒç§é€šè¿‡ç±»å¯¹è±¡è°ƒç”¨ [[Person class] eat]; // ç”¨ç±»åè°ƒç”¨ç±»æ–¹æ³•ï¼Œåº•å±‚ä¼šè‡ªåŠ¨æŠŠç±»åè½¬æ¢æˆç±»å¯¹è±¡è°ƒç”¨ // æœ¬è´¨ï¼šè®©ç±»å¯¹è±¡å‘é€æ¶ˆæ¯ objc_msgSend([Person class], @selector(eat)); æ¶ˆæ¯æœºåˆ¶åŸç†:å¯¹è±¡æ ¹æ®æ–¹æ³•ç¼–å·SELå»æ˜ å°„è¡¨æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³•å®ç° 2.äº¤æ¢æ–¹æ³• å¼€å‘ä½¿ç”¨åœºæ™¯:ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•åŠŸèƒ½ä¸å¤Ÿï¼Œç»™ç³»ç»Ÿè‡ªå¸¦çš„æ–¹æ³•æ‰©å±•ä¸€äº›åŠŸèƒ½ï¼Œå¹¶ä¸”ä¿æŒåŸæœ‰çš„åŠŸèƒ½ã€‚ æ–¹å¼ä¸€:ç»§æ‰¿ç³»ç»Ÿçš„ç±»ï¼Œé‡å†™æ–¹æ³•. æ–¹å¼äºŒ:ä½¿ç”¨runtime,äº¤æ¢æ–¹æ³•. @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. // éœ€æ±‚ï¼šç»™imageNamedæ–¹æ³•æä¾›åŠŸèƒ½ï¼Œæ¯æ¬¡åŠ è½½å›¾ç‰‡å°±åˆ¤æ–­ä¸‹å›¾ç‰‡æ˜¯å¦åŠ è½½æˆåŠŸã€‚ // æ­¥éª¤ä¸€ï¼šå…ˆæä¸ªåˆ†ç±»ï¼Œå®šä¹‰ä¸€ä¸ªèƒ½åŠ è½½å›¾ç‰‡å¹¶ä¸”èƒ½æ‰“å°çš„æ–¹æ³•+ (instancetype)imageWithName:(NSString *)name; // æ­¥éª¤äºŒï¼šäº¤æ¢imageNamedå’ŒimageWithNameçš„å®ç°ï¼Œå°±èƒ½è°ƒç”¨imageWithNameï¼Œé—´æ¥è°ƒç”¨imageWithNameçš„å®ç°ã€‚ UIImage *image = [UIImage imageNamed:@"123"]; } @end @implementation UIImage (Image) // åŠ è½½åˆ†ç±»åˆ°å†…å­˜çš„æ—¶å€™è°ƒç”¨ + (void)load { // äº¤æ¢æ–¹æ³• // è·å–imageWithNameæ–¹æ³•åœ°å€ Method imageWithName = class_getClassMethod(self, @selector(imageWithName:)); // è·å–imageWithNameæ–¹æ³•åœ°å€ Method imageName = class_getClassMethod(self, @selector(imageNamed:)); // äº¤æ¢æ–¹æ³•åœ°å€ï¼Œç›¸å½“äºäº¤æ¢å®ç°æ–¹å¼ method_exchangeImplementations(imageWithName, imageName); } // ä¸èƒ½åœ¨åˆ†ç±»ä¸­é‡å†™ç³»ç»Ÿæ–¹æ³•imageNamedï¼Œå› ä¸ºä¼šæŠŠç³»ç»Ÿçš„åŠŸèƒ½ç»™è¦†ç›–æ‰ï¼Œè€Œä¸”åˆ†ç±»ä¸­ä¸èƒ½è°ƒç”¨super. // æ—¢èƒ½åŠ è½½å›¾ç‰‡åˆèƒ½æ‰“å° + (instancetype)imageWithName:(NSString *)name { // è¿™é‡Œè°ƒç”¨imageWithNameï¼Œç›¸å½“äºè°ƒç”¨imageName UIImage *image = [self imageWithName:name]; if (image == nil) { NSLog(@"åŠ è½½ç©ºçš„å›¾ç‰‡"); } return image; } @end äº¤æ¢åŸç†ï¼š äº¤æ¢ä¹‹å‰ï¼š äº¤æ¢ä¹‹åï¼š 3.åŠ¨æ€æ·»åŠ æ–¹æ³• å¼€å‘ä½¿ç”¨åœºæ™¯ï¼šå¦‚æœä¸€ä¸ªç±»æ–¹æ³•éå¸¸å¤šï¼ŒåŠ è½½ç±»åˆ°å†…å­˜çš„æ—¶å€™ä¹Ÿæ¯”è¾ƒè€—è´¹èµ„æºï¼Œéœ€è¦ç»™æ¯ä¸ªæ–¹æ³•ç”Ÿæˆæ˜ å°„è¡¨ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ç»™æŸä¸ªç±»ï¼Œæ·»åŠ æ–¹æ³•è§£å†³ã€‚ ç»å…¸é¢è¯•é¢˜ï¼šæœ‰æ²¡æœ‰ä½¿ç”¨performSelectorï¼Œå…¶å®ä¸»è¦æƒ³é—®ä½ æœ‰æ²¡æœ‰åŠ¨æ€æ·»åŠ è¿‡æ–¹æ³•ã€‚ ç®€å•ä½¿ç”¨ @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. Person *p = [[Person alloc] init]; // é»˜è®¤personï¼Œæ²¡æœ‰å®ç°eatæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡performSelectorè°ƒç”¨ï¼Œä½†æ˜¯ä¼šæŠ¥é”™ã€‚ // åŠ¨æ€æ·»åŠ æ–¹æ³•å°±ä¸ä¼šæŠ¥é”™ [p performSelector:@selector(eat)]; } @end @implementation Person // void(*)() // é»˜è®¤æ–¹æ³•éƒ½æœ‰ä¸¤ä¸ªéšå¼å‚æ•°ï¼Œ void eat(id self,SEL sel) { NSLog(@"%@ %@",self,NSStringFromSelector(sel)); } // å½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨æœªå®ç°çš„æ–¹æ³•ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•å¤„ç†,å¹¶ä¸”ä¼šæŠŠå¯¹åº”çš„æ–¹æ³•åˆ—è¡¨ä¼ è¿‡æ¥. // åˆšå¥½å¯ä»¥ç”¨æ¥åˆ¤æ–­ï¼Œæœªå®ç°çš„æ–¹æ³•æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦åŠ¨æ€æ·»åŠ çš„æ–¹æ³• + (BOOL)resolveInstanceMethod:(SEL)sel { if (sel == @selector(eat)) { // åŠ¨æ€æ·»åŠ eatæ–¹æ³• // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªç±»æ·»åŠ æ–¹æ³• // ç¬¬äºŒä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„æ–¹æ³•ç¼–å· // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šæ·»åŠ æ–¹æ³•çš„å‡½æ•°å®ç°ï¼ˆå‡½æ•°åœ°å€ï¼‰ // ç¬¬å››ä¸ªå‚æ•°ï¼šå‡½æ•°çš„ç±»å‹ï¼Œ(è¿”å›å€¼+å‚æ•°ç±»å‹) v:void @:å¯¹è±¡->self :è¡¨ç¤ºSEL->_cmd class_addMethod(self, @selector(eat), eat, "v@:"); } return [super resolveInstanceMethod:sel]; } @end 4.ç»™åˆ†ç±»æ·»åŠ å±æ€§ åŸç†ï¼šç»™ä¸€ä¸ªç±»å£°æ˜å±æ€§ï¼Œå…¶å®æœ¬è´¨å°±æ˜¯ç»™è¿™ä¸ªç±»æ·»åŠ å…³è”ï¼Œå¹¶ä¸æ˜¯ç›´æ¥æŠŠè¿™ä¸ªå€¼çš„å†…å­˜ç©ºé—´æ·»åŠ åˆ°ç±»å­˜ç©ºé—´ã€‚ @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. // ç»™ç³»ç»ŸNSObjectç±»åŠ¨æ€æ·»åŠ å±æ€§name NSObject *objc = [[NSObject alloc] init]; objc.name = @"ä¹”å¸ƒæ–¯"; NSLog(@"%@",objc.name); } @end // å®šä¹‰å…³è”çš„key static const char *key = "name"; @implementation NSObject (Property) - (NSString *)name { // æ ¹æ®å…³è”çš„keyï¼Œè·å–å…³è”çš„å€¼ã€‚ return objc_getAssociatedObject(self, key); } - (void)setName:(NSString *)name { // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªå¯¹è±¡æ·»åŠ å…³è” // ç¬¬äºŒä¸ªå‚æ•°ï¼šå…³è”çš„keyï¼Œé€šè¿‡è¿™ä¸ªkeyè·å– // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå…³è”çš„value // ç¬¬å››ä¸ªå‚æ•°:å…³è”çš„ç­–ç•¥ objc_setAssociatedObject(self, key, name, OBJC_ASSOCIATION_RETAIN_NONATOMIC); } @end 5.å­—å…¸è½¬æ¨¡å‹ è®¾è®¡æ¨¡å‹ï¼šå­—å…¸è½¬æ¨¡å‹çš„ç¬¬ä¸€æ­¥ æ¨¡å‹å±æ€§ï¼Œé€šå¸¸éœ€è¦è·Ÿå­—å…¸ä¸­çš„keyä¸€ä¸€å¯¹åº” é—®é¢˜ï¼šä¸€ä¸ªä¸€ä¸ªçš„ç”Ÿæˆæ¨¡å‹å±æ€§ï¼Œå¾ˆæ…¢ï¼Ÿ éœ€æ±‚ï¼šèƒ½ä¸èƒ½è‡ªåŠ¨æ ¹æ®ä¸€ä¸ªå­—å…¸ï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§ã€‚ è§£å†³ï¼šæä¾›ä¸€ä¸ªåˆ†ç±»ï¼Œä¸“é—¨æ ¹æ®å­—å…¸ç”Ÿæˆå¯¹åº”çš„å±æ€§å­—ç¬¦ä¸²ã€‚ @implementation NSObject (Log) // è‡ªåŠ¨æ‰“å°å±æ€§å­—ç¬¦ä¸² + (void)resolveDict:(NSDictionary *)dict { // æ‹¼æ¥å±æ€§å­—ç¬¦ä¸²ä»£ç  NSMutableString *strM = [NSMutableString string]; // 1.éå†å­—å…¸ï¼ŒæŠŠå­—å…¸ä¸­çš„æ‰€æœ‰keyå–å‡ºæ¥ï¼Œç”Ÿæˆå¯¹åº”çš„å±æ€§ä»£ç  [dict enumerateKeysAndObjectsUsingBlock:^(id _Nonnull key, id _Nonnull obj, BOOL * _Nonnull stop) { // ç±»å‹ç»å¸¸å˜ï¼ŒæŠ½å‡ºæ¥ NSString *type; if ([obj isKindOfClass:NSClassFromString(@"__NSCFString")]) { type = @"NSString"; }else if ([obj isKindOfClass:NSClassFromString(@"__NSCFArray")]){ type = @"NSArray"; }else if ([obj isKindOfClass:NSClassFromString(@"__NSCFNumber")]){ type = @"int"; }else if ([obj isKindOfClass:NSClassFromString(@"__NSCFDictionary")]){ type = @"NSDictionary"; } // å±æ€§å­—ç¬¦ä¸² NSString *str; if ([type containsString:@"NS"]) { str = [NSString stringWithFormat:@"@property (nonatomic, strong) %@ *%@;",type,key]; }else{ str = [NSString stringWithFormat:@"@property (nonatomic, assign) %@ %@;",type,key]; } // æ¯ç”Ÿæˆå±æ€§å­—ç¬¦ä¸²ï¼Œå°±è‡ªåŠ¨æ¢è¡Œã€‚ [strM appendFormat:@"\n%@\n",str]; }]; // æŠŠæ‹¼æ¥å¥½çš„å­—ç¬¦ä¸²æ‰“å°å‡ºæ¥ï¼Œå°±å¥½äº†ã€‚ NSLog(@"%@",strM); } @end å­—å…¸è½¬æ¨¡å‹çš„æ–¹å¼ä¸€ï¼šKVC @implementation Status + (instancetype)statusWithDict:(NSDictionary *)dict { Status *status = [[self alloc] init]; [status setValuesForKeysWithDictionary:dict]; return status; } @end KVCå­—å…¸è½¬æ¨¡å‹å¼Šç«¯ï¼šå¿…é¡»ä¿è¯ï¼Œæ¨¡å‹ä¸­çš„å±æ€§å’Œå­—å…¸ä¸­çš„keyä¸€ä¸€å¯¹åº”ã€‚ å¦‚æœä¸ä¸€è‡´ï¼Œå°±ä¼šè°ƒç”¨[&lt;Status 0x7fa74b545d60&gt; setValue:forUndefinedKey:]æŠ¥keyæ‰¾ä¸åˆ°çš„é”™ã€‚ åˆ†æ:æ¨¡å‹ä¸­çš„å±æ€§å’Œå­—å…¸çš„keyä¸ä¸€ä¸€å¯¹åº”ï¼Œç³»ç»Ÿå°±ä¼šè°ƒç”¨setValue:forUndefinedKey:æŠ¥é”™ã€‚ è§£å†³:é‡å†™å¯¹è±¡çš„setValue:forUndefinedKey:,æŠŠç³»ç»Ÿçš„æ–¹æ³•è¦†ç›–ï¼Œå°±èƒ½ç»§ç»­ä½¿ç”¨KVCï¼Œå­—å…¸è½¬æ¨¡å‹äº†ã€‚ - (void)setValue:(id)value forUndefinedKey:(NSString *)key { } å­—å…¸è½¬æ¨¡å‹çš„æ–¹å¼äºŒï¼šRuntime æ€è·¯ï¼šåˆ©ç”¨è¿è¡Œæ—¶ï¼Œéå†æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§ï¼Œæ ¹æ®æ¨¡å‹çš„å±æ€§åï¼Œå»å­—å…¸ä¸­æŸ¥æ‰¾keyï¼Œå–å‡ºå¯¹åº”çš„å€¼ï¼Œç»™æ¨¡å‹çš„å±æ€§èµ‹å€¼ã€‚ æ­¥éª¤ï¼šæä¾›ä¸€ä¸ªNSObjectåˆ†ç±»ï¼Œä¸“é—¨å­—å…¸è½¬æ¨¡å‹ï¼Œä»¥åæ‰€æœ‰æ¨¡å‹éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªåˆ†ç±»è½¬ã€‚ @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. // è§£æPlistæ–‡ä»¶ NSString *filePath = [[NSBundle mainBundle] pathForResource:@"status.plist" ofType:nil]; NSDictionary *statusDict = [NSDictionary dictionaryWithContentsOfFile:filePath]; // è·å–å­—å…¸æ•°ç»„ NSArray *dictArr = statusDict[@"statuses"]; // è‡ªåŠ¨ç”Ÿæˆæ¨¡å‹çš„å±æ€§å­—ç¬¦ä¸² // [NSObject resolveDict:dictArr[0][@"user"]]; _statuses = [NSMutableArray array]; // éå†å­—å…¸æ•°ç»„ for (NSDictionary *dict in dictArr) { Status *status = [Status modelWithDict:dict]; [_statuses addObject:status]; } // æµ‹è¯•æ•°æ® NSLog(@"%@ %@",_statuses,[_statuses[0] user]); } @end @implementation NSObject (Model) + (instancetype)modelWithDict:(NSDictionary *)dict { // æ€è·¯ï¼šéå†æ¨¡å‹ä¸­æ‰€æœ‰å±æ€§-ã€‹ä½¿ç”¨è¿è¡Œæ—¶ // 0.åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ id objc = [[self alloc] init]; // 1.åˆ©ç”¨runtimeç»™å¯¹è±¡ä¸­çš„æˆå‘˜å±æ€§èµ‹å€¼ // class_copyIvarList:è·å–ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å±æ€§ // Ivarï¼šæˆå‘˜å±æ€§çš„æ„æ€ // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¡¨ç¤ºè·å–å“ªä¸ªç±»ä¸­çš„æˆå‘˜å±æ€§ // ç¬¬äºŒä¸ªå‚æ•°ï¼šè¡¨ç¤ºè¿™ä¸ªç±»æœ‰å¤šå°‘æˆå‘˜å±æ€§ï¼Œä¼ å…¥ä¸€ä¸ªIntå˜é‡åœ°å€ï¼Œä¼šè‡ªåŠ¨ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ // è¿”å›å€¼Ivar *ï¼šæŒ‡çš„æ˜¯ä¸€ä¸ªivaræ•°ç»„ï¼Œä¼šæŠŠæ‰€æœ‰æˆå‘˜å±æ€§æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé€šè¿‡è¿”å›çš„æ•°ç»„å°±èƒ½å…¨éƒ¨è·å–åˆ°ã€‚ /* ç±»ä¼¼ä¸‹é¢è¿™ç§å†™æ³• Ivar ivar; Ivar ivar1; Ivar ivar2; // å®šä¹‰ä¸€ä¸ªivarçš„æ•°ç»„a Ivar a[] = {ivar,ivar1,ivar2}; // ç”¨ä¸€ä¸ªIvar *æŒ‡é’ˆæŒ‡å‘æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  Ivar *ivarList = a; // æ ¹æ®æŒ‡é’ˆè®¿é—®æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´  ivarList[0]; */ unsigned int count; // è·å–ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜å±æ€§ Ivar *ivarList = class_copyIvarList(self, &count); for (int i = 0; i < count; i++) { // æ ¹æ®è§’æ ‡ï¼Œä»æ•°ç»„å–å‡ºå¯¹åº”çš„æˆå‘˜å±æ€§ Ivar ivar = ivarList[i]; // è·å–æˆå‘˜å±æ€§å NSString *name = [NSString stringWithUTF8String:ivar_getName(ivar)]; // å¤„ç†æˆå‘˜å±æ€§å->å­—å…¸ä¸­çš„key // ä»ç¬¬ä¸€ä¸ªè§’æ ‡å¼€å§‹æˆªå– NSString *key = [name substringFromIndex:1]; // æ ¹æ®æˆå‘˜å±æ€§åå»å­—å…¸ä¸­æŸ¥æ‰¾å¯¹åº”çš„value id value = dict[key]; // äºŒçº§è½¬æ¢:å¦‚æœå­—å…¸ä¸­è¿˜æœ‰å­—å…¸ï¼Œä¹Ÿéœ€è¦æŠŠå¯¹åº”çš„å­—å…¸è½¬æ¢æˆæ¨¡å‹ // åˆ¤æ–­ä¸‹valueæ˜¯å¦æ˜¯å­—å…¸ if ([value isKindOfClass:[NSDictionary class]]) { // å­—å…¸è½¬æ¨¡å‹ // è·å–æ¨¡å‹çš„ç±»å¯¹è±¡ï¼Œè°ƒç”¨modelWithDict // æ¨¡å‹çš„ç±»åå·²çŸ¥ï¼Œå°±æ˜¯æˆå‘˜å±æ€§çš„ç±»å‹ // è·å–æˆå‘˜å±æ€§ç±»å‹ NSString *type = [NSString stringWithUTF8String:ivar_getTypeEncoding(ivar)]; // ç”Ÿæˆçš„æ˜¯è¿™ç§@"@\"User\"" ç±»å‹ -ã€‹ @"User" åœ¨OCå­—ç¬¦ä¸²ä¸­ \" -> "ï¼Œ\æ˜¯è½¬ä¹‰çš„æ„æ€ï¼Œä¸å ç”¨å­—ç¬¦ // è£å‰ªç±»å‹å­—ç¬¦ä¸² NSRange range = [type rangeOfString:@"\""]; type = [type substringFromIndex:range.location + range.length]; range = [type rangeOfString:@"\""]; // è£å‰ªåˆ°å“ªä¸ªè§’æ ‡ï¼Œä¸åŒ…æ‹¬å½“å‰è§’æ ‡ type = [type substringToIndex:range.location]; // æ ¹æ®å­—ç¬¦ä¸²ç±»åç”Ÿæˆç±»å¯¹è±¡ Class modelClass = NSClassFromString(type); if (modelClass) { // æœ‰å¯¹åº”çš„æ¨¡å‹æ‰éœ€è¦è½¬ // æŠŠå­—å…¸è½¬æ¨¡å‹ value = [modelClass modelWithDict:value]; } } // ä¸‰çº§è½¬æ¢ï¼šNSArrayä¸­ä¹Ÿæ˜¯å­—å…¸ï¼ŒæŠŠæ•°ç»„ä¸­çš„å­—å…¸è½¬æ¢æˆæ¨¡å‹. // åˆ¤æ–­å€¼æ˜¯å¦æ˜¯æ•°ç»„ if ([value isKindOfClass:[NSArray class]]) { // åˆ¤æ–­å¯¹åº”ç±»æœ‰æ²¡æœ‰å®ç°å­—å…¸æ•°ç»„è½¬æ¨¡å‹æ•°ç»„çš„åè®® if ([self respondsToSelector:@selector(arrayContainModelClass)]) { // è½¬æ¢æˆidç±»å‹ï¼Œå°±èƒ½è°ƒç”¨ä»»ä½•å¯¹è±¡çš„æ–¹æ³• id idSelf = self; // è·å–æ•°ç»„ä¸­å­—å…¸å¯¹åº”çš„æ¨¡å‹ NSString *type = [idSelf arrayContainModelClass][key]; // ç”Ÿæˆæ¨¡å‹ Class classModel = NSClassFromString(type); NSMutableArray *arrM = [NSMutableArray array]; // éå†å­—å…¸æ•°ç»„ï¼Œç”Ÿæˆæ¨¡å‹æ•°ç»„ for (NSDictionary *dict in value) { // å­—å…¸è½¬æ¨¡å‹ id model = [classModel modelWithDict:dict]; [arrM addObject:model]; } // æŠŠæ¨¡å‹æ•°ç»„èµ‹å€¼ç»™value value = arrM; } } if (value) { // æœ‰å€¼ï¼Œæ‰éœ€è¦ç»™æ¨¡å‹çš„å±æ€§èµ‹å€¼ // åˆ©ç”¨KVCç»™æ¨¡å‹ä¸­çš„å±æ€§èµ‹å€¼ [objc setValue:value forKey:key]; } } return objc; } @end]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[const,static,externåŒºåˆ«]]></title>
    <url>%2F2018%2F09%2F12%2Fconst-static-extern%E5%8C%BA%E5%88%AB%2F</url>
    <content type="text"><![CDATA[ä¸€ã€constä¸å®çš„åŒºåˆ«ï¼ˆé¢è¯•é¢˜ï¼‰: constç®€ä»‹:ä¹‹å‰å¸¸ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œä¸€èˆ¬æ˜¯æŠ½æˆå®ï¼Œä½†æ˜¯è‹¹æœä¸æ¨èæˆ‘ä»¬æŠ½æˆå®ï¼Œæ¨èæˆ‘ä»¬ä½¿ç”¨constå¸¸é‡ã€‚ æ‰§è¡Œæ—¶åˆ»:å®æ˜¯é¢„ç¼–è¯‘ï¼ˆç¼–è¯‘ä¹‹å‰å¤„ç†ï¼‰ï¼Œconstæ˜¯ç¼–è¯‘é˜¶æ®µã€‚ ç¼–è¯‘æ£€æŸ¥:å®ä¸åšæ£€æŸ¥ï¼Œä¸ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼Œåªæ˜¯æ›¿æ¢ï¼Œconstä¼šç¼–è¯‘æ£€æŸ¥ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚ å®çš„å¥½å¤„:å®èƒ½å®šä¹‰ä¸€äº›å‡½æ•°ï¼Œæ–¹æ³•ã€‚ constä¸èƒ½ã€‚ å®çš„åå¤„:ä½¿ç”¨å¤§é‡å®ï¼Œå®¹æ˜“é€ æˆç¼–è¯‘æ—¶é—´ä¹…ï¼Œæ¯æ¬¡éƒ½éœ€è¦é‡æ–°æ›¿æ¢ã€‚ æ³¨æ„:å¾ˆå¤šBlogéƒ½è¯´ä½¿ç”¨å®ï¼Œä¼šæ¶ˆè€—å¾ˆå¤šå†…å­˜ï¼Œæˆ‘è¿™éªŒè¯å¹¶ä¸ä¼šç”Ÿæˆå¾ˆå¤šå†…å­˜ï¼Œå®å®šä¹‰çš„æ˜¯å¸¸é‡ï¼Œå¸¸é‡éƒ½æ”¾åœ¨å¸¸é‡åŒºï¼Œåªä¼šç”Ÿæˆä¸€ä»½å†…å­˜ã€‚ //å¸¸è§å¸¸é‡: æŠ½æˆå® #define SKAccount @"account123" //å­—ç¬¦ä¸²å˜é‡ static NSString *const account = @"account123"; @interface ViewController () @end @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; NSString *str = SKAccount; NSString *str2 = SKAccount; NSLog(@"%p %p", str, str2); //æ‰“å°ç»“æœ 0x10c7ba068 0x10c7ba068 } // å¸¸è§çš„å¸¸é‡ï¼šæŠ½æˆå® #define Account @"account" #define UserDefault [NSUserDefaults standardUserDefaults] // å­—ç¬¦ä¸²å¸¸é‡ static NSString * const account = @"account"; - (void)viewDidLoad { [super viewDidLoad]; // åå¥½è®¾ç½®å­˜å‚¨ // ä½¿ç”¨å® [UserDefault setValue:@"123" forKey:Account]; // ä½¿ç”¨constå¸¸é‡ [[NSUserDefaults standardUserDefaults] setValue:@"123" forKey:account]; } äºŒã€constä½œç”¨ï¼šé™åˆ¶ç±»å‹* 1.constä»…ä»…ç”¨æ¥ä¿®é¥°å³è¾¹çš„å˜é‡ï¼ˆåŸºæœ¬æ•°æ®å˜é‡pï¼ŒæŒ‡é’ˆå˜é‡*pï¼‰ * 2.è¢«constä¿®é¥°çš„å˜é‡æ˜¯åªè¯»çš„ã€‚ conståŸºæœ¬ä½¿ç”¨ - (void)viewDidLoad { [super viewDidLoad]; // å®šä¹‰å˜é‡ int a = 1; // å…è®¸ä¿®æ”¹å€¼ a = 20; // constä¸¤ç§ç”¨æ³• // const:ä¿®é¥°åŸºæœ¬å˜é‡b // è¿™ä¸¤ç§å†™æ³•æ˜¯ä¸€æ ·çš„ï¼Œconståªä¿®é¥°å³è¾¹çš„åŸºæœ¬å˜é‡b const int b = 20; // b:åªè¯»å˜é‡ int const b = 20; // b:åªè¯»å˜é‡ // ä¸å…è®¸ä¿®æ”¹å€¼ b = 1; // const:ä¿®é¥°æŒ‡é’ˆå˜é‡*pï¼Œå¸¦*çš„å˜é‡ï¼Œå°±æ˜¯æŒ‡é’ˆå˜é‡. // å®šä¹‰ä¸€ä¸ªæŒ‡å‘intç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼ŒæŒ‡å‘açš„åœ°å€ int *p = &a; int c = 10; p = &c; // å…è®¸ä¿®æ”¹pæŒ‡å‘çš„åœ°å€ï¼Œ // å…è®¸ä¿®æ”¹pè®¿é—®å†…å­˜ç©ºé—´çš„å€¼ *p = 20; // constä¿®é¥°æŒ‡é’ˆå˜é‡è®¿é—®çš„å†…å­˜ç©ºé—´ï¼Œä¿®é¥°çš„æ˜¯å³è¾¹*p1ï¼Œ // ä¸¤ç§æ–¹å¼ä¸€æ · const int *p1; // *p1ï¼šå¸¸é‡ p1:å˜é‡ int const *p1; // *p1ï¼šå¸¸é‡ p1:å˜é‡ // constä¿®é¥°æŒ‡é’ˆå˜é‡p1 int * const p1; // *p1:å˜é‡ p1:å¸¸é‡ // ç¬¬ä¸€ä¸ªconstä¿®é¥°*p1 ç¬¬äºŒä¸ªconstä¿®é¥° p1 // ä¸¤ç§æ–¹å¼ä¸€æ · const int * const p1; // *p1ï¼šå¸¸é‡ p1ï¼šå¸¸é‡ int const * const p1; // *p1ï¼šå¸¸é‡ p1ï¼šå¸¸é‡ } ä¸‰ã€constå¼€å‘ä¸­ä½¿ç”¨åœºæ™¯:* 1.éœ€æ±‚1:æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯åœ°å€ï¼Œé‡Œé¢åªèƒ½é€šè¿‡åœ°å€è¯»å–å€¼,ä¸èƒ½é€šè¿‡åœ°å€ä¿®æ”¹å€¼ * 2.éœ€æ±‚2:æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯åœ°å€ï¼Œé‡Œé¢ä¸èƒ½ä¿®æ”¹å‚æ•°çš„åœ°å€ã€‚ @implementation ViewController // constæ”¾*å‰é¢çº¦æŸå‚æ•°ï¼Œè¡¨ç¤º*aåªè¯» // åªèƒ½ä¿®æ”¹åœ°å€a,ä¸èƒ½é€šè¿‡aä¿®æ”¹è®¿é—®çš„å†…å­˜ç©ºé—´ - (void)test:(const int * )a { // *a = 20; } // constæ”¾*åé¢çº¦æŸå‚æ•°ï¼Œè¡¨ç¤ºaåªè¯» // ä¸èƒ½ä¿®æ”¹açš„åœ°å€ï¼Œåªèƒ½ä¿®æ”¹aè®¿é—®çš„å€¼ - (void)test1:(int * const)a { int b; // ä¼šæŠ¥é”™ a = &b; *a = 2; } - (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. int a = 10; // éœ€æ±‚1:æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯åœ°å€ï¼Œé‡Œé¢åªèƒ½é€šè¿‡åœ°å€è¯»å–å€¼,ä¸èƒ½é€šè¿‡åœ°å€ä¿®æ”¹å€¼ã€‚ // è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨constï¼Œçº¦æŸæ–¹æ³•çš„å‚æ•°åªè¯». [self test:&a]; // éœ€æ±‚2:æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯åœ°å€ï¼Œé‡Œé¢ä¸èƒ½ä¿®æ”¹å‚æ•°çš„åœ°å€ã€‚ [self test1:&a]; } @end å››ã€staticå’Œexternç®€å•ä½¿ç”¨(è¦ä½¿ç”¨ä¸€ä¸ªä¸œè¥¿ï¼Œå…ˆäº†è§£å…¶ä½œç”¨) staticä½œç”¨: ä¿®é¥°å±€éƒ¨å˜é‡ï¼š 1.å»¶é•¿å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ,ç¨‹åºç»“æŸæ‰ä¼šé”€æ¯ã€‚ 2.å±€éƒ¨å˜é‡åªä¼šç”Ÿæˆä¸€ä»½å†…å­˜,åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ã€‚ 3.æ”¹å˜å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸã€‚ ä¿®é¥°å…¨å±€å˜é‡ 1.åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è®¿é—®,ä¿®æ”¹å…¨å±€å˜é‡çš„ä½œç”¨åŸŸ,ç”Ÿå‘½å‘¨æœŸä¸ä¼šæ”¹ 2.é¿å…é‡å¤å®šä¹‰å…¨å±€å˜é‡ externä½œç”¨: åªæ˜¯ç”¨æ¥è·å–å…¨å±€å˜é‡(åŒ…æ‹¬å…¨å±€é™æ€å˜é‡)çš„å€¼ï¼Œä¸èƒ½ç”¨äºå®šä¹‰å˜é‡ externå·¥ä½œåŸç†: å…ˆåœ¨å½“å‰æ–‡ä»¶æŸ¥æ‰¾æœ‰æ²¡æœ‰å…¨å±€å˜é‡ï¼Œæ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰ä¼šå»å…¶ä»–æ–‡ä»¶æŸ¥æ‰¾ã€‚ // å…¨å±€å˜é‡ï¼šåªæœ‰ä¸€ä»½å†…å­˜ï¼Œæ‰€æœ‰æ–‡ä»¶å…±äº«ï¼Œä¸externè”åˆä½¿ç”¨ã€‚ int a = 20; // staticä¿®é¥°å…¨å±€å˜é‡ static int age = 20; - (void)test { // staticä¿®é¥°å±€éƒ¨å˜é‡ static int age = 0; age++; NSLog(@"%d",age); } - (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. [self test]; [self test]; extern int age; NSLog(@"%d",age); } äº”ã€staticä¸constè”åˆä½¿ç”¨ staticä¸constä½œç”¨:å£°æ˜ä¸€ä¸ªåªè¯»çš„é™æ€å˜é‡ å¼€å‘ä½¿ç”¨åœºæ™¯:åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨staticä¸constç»„åˆ // å¼€å‘ä¸­å¸¸ç”¨staticä¿®é¥°å…¨å±€å˜é‡,åªæ”¹å˜ä½œç”¨åŸŸ // ä¸ºä»€ä¹ˆè¦æ”¹å˜å…¨å±€å˜é‡ä½œç”¨åŸŸï¼Œé˜²æ­¢é‡å¤å£°æ˜å…¨å±€å˜é‡ã€‚ // å¼€å‘ä¸­å£°æ˜çš„å…¨å±€å˜é‡ï¼Œæœ‰äº›ä¸å¸Œæœ›å¤–ç•Œæ”¹åŠ¨ï¼Œåªå…è®¸è¯»å–ã€‚ // æ¯”å¦‚ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ä¸å¸Œæœ›åˆ«äººæ”¹åŠ¨ // å£°æ˜ä¸€ä¸ªé™æ€çš„å…¨å±€åªè¯»å¸¸é‡ static const int a = 20; // staicå’Œconstè”åˆçš„ä½œç”¨:å£°æ˜ä¸€ä¸ªé™æ€çš„å…¨å±€åªè¯»å¸¸é‡ // iOSä¸­staicå’Œconstå¸¸ç”¨ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯ç”¨æ¥ä»£æ›¿å®ï¼ŒæŠŠä¸€ä¸ªç»å¸¸ä½¿ç”¨çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå®šä¹‰æˆé™æ€å…¨å±€åªè¯»å˜é‡. // å¼€å‘ä¸­ç»å¸¸æ‹¿åˆ°keyä¿®æ”¹å€¼ï¼Œå› æ­¤ç”¨constä¿®é¥°key,è¡¨ç¤ºkeyåªè¯»ï¼Œä¸å…è®¸ä¿®æ”¹ã€‚ static NSString * const key = @"name"; // å¦‚æœ constä¿®é¥° *key1,è¡¨ç¤º*key1åªè¯»ï¼Œkey1è¿˜æ˜¯èƒ½æ”¹å˜ã€‚ static NSString const *key1 = @"name"; å…­ã€externä¸constè”åˆä½¿ç”¨ å¼€å‘ä¸­ä½¿ç”¨åœºæ™¯:åœ¨å¤šä¸ªæ–‡ä»¶ä¸­ç»å¸¸ä½¿ç”¨çš„åŒä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œå¯ä»¥ä½¿ç”¨externä¸constç»„åˆã€‚ åŸå› : staticä¸constç»„åˆï¼šåœ¨æ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦å®šä¹‰ä¸€ä»½é™æ€å…¨å±€å˜é‡ã€‚ externä¸constç»„åˆ:åªéœ€è¦å®šä¹‰ä¸€ä»½å…¨å±€å˜é‡ï¼Œå¤šä¸ªæ–‡ä»¶å…±äº«ã€‚ å…¨å±€å¸¸é‡æ­£è§„å†™æ³•:å¼€å‘ä¸­ä¾¿äºç®¡ç†æ‰€æœ‰çš„å…¨å±€å˜é‡ï¼Œé€šå¸¸æä¸€ä¸ªGlobeConstæ–‡ä»¶ï¼Œé‡Œé¢ä¸“é—¨å®šä¹‰å…¨å±€å˜é‡ï¼Œç»Ÿä¸€ç®¡ç†ï¼Œè¦ä¸ç„¶é¡¹ç›®æ–‡ä»¶å¤šä¸å¥½æ‰¾ã€‚ GlobeConst.h /*******************************é¦–é¡µ****************************/ extern NSString * const nameKey = @&quot;name&quot;; /*******************************é¦–é¡µ****************************/ GlobeConst.m #import &lt;Foundation/Foundation.h&gt; /*******************************é¦–é¡µ****************************/ NSString * const nameKey = @&quot;name&quot;; /*******************************é¦–é¡µ****************************/]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜24--è¡¥å……]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9824-%E8%A1%A5%E5%85%85%2F</url>
    <content type="text"><![CDATA[UML ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆUMLï¼ŒUnifiedModelingLanguageï¼‰æ˜¯é¢å‘å¯¹è±¡è½¯ä»¶çš„æ ‡å‡†åŒ–å»ºæ¨¡è¯­è¨€ã€‚UMLå› å…¶ç®€å•ã€ç»Ÿä¸€çš„ç‰¹ç‚¹ï¼Œè€Œä¸”èƒ½è¡¨è¾¾è½¯ä»¶è®¾è®¡ä¸­çš„åŠ¨æ€å’Œé™æ€ä¿¡æ¯ï¼Œç›®å‰å·²æˆä¸ºå¯è§†åŒ–å»ºæ¨¡è¯­è¨€çš„å·¥ä¸šæ ‡å‡†ã€‚åœ¨è½¯ä»¶æ— çº¿ç”µç³»ç»Ÿçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»Ÿä¸€å»ºæ¨¡è¯­è¨€å¯ä»¥åœ¨æ•´ä¸ªè®¾è®¡å‘¨æœŸä¸­ä½¿ç”¨ï¼Œå¸®åŠ©è®¾è®¡è€…ç¼©çŸ­è®¾è®¡æ—¶é—´ï¼Œå‡å°‘æ”¹è¿›çš„æˆæœ¬ï¼Œä½¿è½¯ç¡¬ä»¶åˆ†å‰²æœ€ä¼˜ã€‚ ç”¨ä¾‹å›¾ é™æ€å›¾ è¡Œä¸ºå›¾ äº¤äº’å›¾ å®ç°å›¾ å¦‚æœè®¾è®¡ä¸€ä¸ªäº¤æ˜“å¹³å°ï¼Œæµç¨‹å¦‚ä¸‹ï¼šAç”¨æˆ·åœ¨å¹³å°På‘ç°Bç”¨æˆ·æœ‰ä¸œè¥¿å‡ºå”®ï¼ŒPå¹³å°çš„ä¸šåŠ¡é€»è¾‘æ˜¯éœ€è¦Aå…ˆä»˜æ¬¾åˆ°På¾—ä¸­é—´è´¦æˆ·ï¼Œç­‰åˆ°Aç¡®è®¤æ”¶è´§åï¼ŒPå‘Bä»˜æ¬¾ï¼Œä½ èƒ½å°è¯•æŸç§è¡¨ç¤ºæ–¹å¼æ¥è®©ç¨‹åºå‘˜ï¼Œäº§å“è®¾è®¡ï¼Œç¾æœ¯è®¾è®¡æ˜ç™½è¿™ä¸ªæµç¨‹ä¹ˆï¼Ÿä»1-nä¸ªäº”åºåˆ—çš„æ•°å­—ä¸­æ’åºçš„ç®—æ³•æœ‰å“ªäº›ï¼Œç®€å•ä»£ç å®ç°ä¸€ä¸ªå¹¶å†™å‡ºæ—¶é—´å¤æ‚åº¦æœ‰ä¸€ä¸ª6å…‹å’Œ21å…‹çš„ç ç ï¼Œæ€æ ·ç§°é‡ä¸‰æ¬¡å°†420å…‹çš„ç³–åˆ†æˆ270å…‹å’Œ150å…‹ä¸€æ¡Œå­äººï¼Œæ¯ä¸ªäººé¢å¤´ä¸Šéƒ½è´´æœ‰æ ‡ç­¾ï¼Œç»¿è‰²å’Œçº¢è‰²ï¼Œç»¿è‰²è‡³å°‘1ä¸ªï¼Œå¤§å®¶éƒ½èƒ½çœ‹åˆ°åˆ«äººå¤´ä¸Šçš„æ ‡ç­¾ï¼Œçœ‹ä¸åˆ°è‡ªå·±å¤´ä¸Šçš„æ ‡ç­¾ï¼Œç„¶åå¼€å§‹é—­çœ¼æ¸¸æˆï¼Œå¤§å®¶è§‰å¾—è‡ªå·±å¤´ä¸Šæ˜¯ç»¿è‰²æ ‡ç­¾å°±æ‹ä¸€ä¸‹æ‰‹æŒï¼Œç¬¬ä¸€æ¬¡é—­çœ¼æ²¡äººæ‹æŒï¼Œç¬¬äºŒæ¬¡ï¼Œç¬¬ä¸‰æ¬¡ä¹ŸåŒæ ·æ²¡æœ‰äººæ‹æŒï¼Œç¬¬å››æ¬¡æœ‰ä¸€ä¸ªäººæ‹æŒäº†ï¼Œè¯·é—®ç»¿è‰²æ ‡ç­¾æœ‰å‡ å¼ æ˜¯å¦ä½¿ç”¨è¿‡coreImageå’ŒcoreText?å¦‚æœä½¿ç”¨è¿‡ï¼Œè¯´è¯´ä½ çš„ä½“éªŒ coreImageæ˜¯IOS5ä¸­æ–°åŠ å…¥çš„ä¸€ä¸ªObjective-cçš„æ¡†æ¶ï¼Œæä¾›äº†å¼ºå¤§é«˜æ•ˆçš„å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œç”¨æ¥å¯¹åŸºäºåƒç´ çš„å›¾åƒè¿›è¡Œæ“ä½œä¸åˆ†æã€‚ å†™ä¸€ä¸ªå•é¡¹é“¾è¡¨é€†åºä»€ä¹ˆæ˜¯OpenGL?å…·ä½“ä½¿ç”¨å¼€å¯ä¸€ä¸ªå…¶ä»–çº¿ç¨‹æ¥è®¡ç®—1+1 å¹¶ä¸”æŠŠç»“æœç”¨ä¸»çº¿ç¨‹æ˜¾ç¤ºåœ¨labelä¸Šæ›´æ–°UIffmpegæ¡†æ¶é™æ€é“¾æ¥åº“initå’ŒinitwithobjectåŒºåˆ«ï¼ˆè¯­æ³•ï¼‰ï¼Ÿä»€ä¹ˆæ˜¯OOPï¼Ÿä¸ºNSStringæ‰©å±•ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•èƒ½åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯Urlåœ°å€ï¼ˆå³åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥â€œhttp://â€ï¼‰ï¼Œæ”¾å›BOOLå€¼ç±»å‹å†™ä¸€ä¸ªiphoneç¨‹åºï¼Œæœ‰2å±ï¼Œå¯ä»¥é€šè¿‡æ»‘åŠ¨åˆ‡æ¢ï¼Œç¬¬äºŒå±æœ‰ä¸€ä¸ªwebviewï¼Œè¯»å–æœ¬åœ°çš„htmlæ–‡ä»¶ï¼ŒHtmlæ–‡ä»¶ä¸­ä¼šåŠ è½½ä¸€ä¸ªæœ¬åœ°xmlæ–‡ä»¶ï¼Œè·å–xmlæ–‡ä»¶ä¸­çš„æ•°æ®å†…å®¹å¹¶æ˜¾ç¤ºã€‚ï¼ˆå¯é€‰ï¼šhtmlä¸­åŠ è½½çš„jsæ–‡ä»¶ï¼‰.å¦‚ä½•é¿å…jsonè§£æå‡ºç°å†…å­˜æ³„éœ²ï¼Œå†…å­˜æ³„éœ²åæ€ä¹ˆè§£å†³ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºï¼Ÿæœ‰æ–¹æ³•æŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…å­˜ä½¿ç”¨æƒ…å†µå—ï¼Ÿ é™æ€åˆ†æ ï¼šé€šè¿‡é™æ€åˆ†ææˆ‘ä»¬å¯ä»¥æœ€åˆæ­¥çš„äº†è§£åˆ°ä»£ç çš„ä¸€äº›ä¸è§„èŒƒçš„åœ°æ–¹æˆ–è€…æ˜¯å­˜åœ¨çš„å†…å­˜æ³„æ¼ï¼Œè¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ­¥å¯¹å†…å­˜æ³„æ¼çš„æ£€æµ‹ã€‚å½“ç„¶æœ‰ä¸€äº›è­¦å‘Šå¹¶ä¸æ˜¯æˆ‘ä»¬å…³å¿ƒçš„å¯ä»¥ç•¥è¿‡ã€‚ é€šè¿‡instrumentsæ¥æ£€æŸ¥å†…å­˜æ³„æ¼ è¿™ä¸ªæ–¹æ³•èƒ½ç²—ç•¥çš„å®šä½æˆ‘ä»¬åœ¨å“ªé‡Œå‘ç”Ÿäº†å†…å­˜æ³„æ¼ã€‚æ–¹æ³•æ˜¯å®Œæˆä¸€ä¸ªå¾ªç¯æ“ä½œï¼Œå¦‚æœå†…å­˜å¢é•¿ä¸º0å°±è¯æ˜æˆ‘ä»¬ç¨‹åºåœ¨è¯¥æ¬¡å¾ªç¯æ“ä½œä¸­ä¸å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå¦‚æœå†…å­˜å¢é•¿ä¸ä¸º0é‚£è¯æ˜æœ‰å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ï¼Œå½“ç„¶å…·ä½“é—®é¢˜éœ€è¦å…·ä½“åˆ†æã€‚ ä»£ç æµ‹è¯•å†…å­˜æ³„æ¼ åœ¨åšè¿™é¡¹å·¥ä½œä¹‹å‰æˆ‘ä»¬è¦æ³¨æ„ä¸€ä¸‹ï¼Œåœ¨deallocçš„æ–¹æ³•ä¸­æˆ‘ä»¬æ˜¯å¦å·²ç»é‡Šæ”¾äº†è¯¥å¯¹è±¡æ‰€æ‹¥æœ‰çš„æ‰€æœ‰å¯¹è±¡ã€‚è§‚å¯Ÿå¯¹è±¡çš„ç”Ÿæˆå’Œé”€æ¯æ˜¯å¦é…å¯¹ã€‚å‡†ç¡®çš„è¯´å°±æ˜¯initï¼ˆåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼‰å’Œdeallocæ˜¯å¦ä¼šè¢«æˆå¯¹è§¦å‘ï¼ˆç®€å•è¯´æ¥å°±æ˜¯èµ°ä¸€æ¬¡åˆ›å»ºå¯¹è±¡å°±æœ‰èµ°ä¸€æ¬¡deallocè¯¥å¯¹è±¡ï¼‰ã€‚ ä¸‹é¢æ˜¯è‡ªå·±é‡åˆ°çš„ä¸€äº›æ¯”è¾ƒéšç§˜çš„é€ æˆå†…å­˜æ³„æ¼çš„æƒ…å†µï¼š 1.ä¸¤ä¸ªå¯¹è±¡äº’ç›¸æ‹¥æœ‰ï¼šä¹Ÿå°±æ˜¯è¯´å¯¹è±¡aé‡Œé¢retain/addSubviewäº†bå¯¹è±¡ï¼Œbå¯¹è±¡åŒæ—¶ä¹Ÿretain/addSubViewäº†aå¯¹è±¡ã€‚æ³¨æ„ï¼šdelegateä¸è¦ç”¨retainå±æ€§ï¼Œè¦ç”¨assignå±æ€§ä¹Ÿä¼šå¯¼è‡´äº’ç›¸æ‹¥æœ‰ã€‚ 2.æœ‰æ—¶å€™éœ€è¦ç”¨removeFromSuperViewæ¥é‡Šæ”¾ï¼šå…·ä½“è¯´æ˜ï¼Œä¹Ÿè®¸æˆ‘çš„aå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªbå¯¹è±¡ï¼Œbå¯¹è±¡addåˆ°äº†cå¯¹è±¡ä¸Šï¼Œè€Œåœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­bå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåº”è¯¥å’Œaå¯¹è±¡ç›¸åŒï¼›è¿™æ—¶å€™åªä¸€å¥[b release]/self.b = nilæ˜¯ä¸èƒ½æŠŠbå¯¹è±¡é‡Šæ”¾æ‰çš„ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹releaseä¼šä½¿å…¶retainCountï¼1,[super dealloc]ä¼šå†æ¬¡å°†æ‰€æœ‰subViewçš„retainCountï¼1,è€Œbå¹¶ä¸æ˜¯açš„subViewï¼Œæ‰€æœ‰æœ€åçš„ä¸€æ¬¡ï¼1æ²¡æœ‰äº†ï¼‰ï¼›æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ä¹‹å‰åŠ ä¸Š[b removeFromSuperView]ã€‚ å†™ä¸€ä¸ªè´ªåƒè›‡çš„ç®—æ³•è¯·å†™ä¸€ä¸ªç±»ä¼¼äºNSMutableArrayçš„ç±»ï¼Œå¯ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼Œä»¥åŠå¦‚ä½•ä»¥æœ€å¿«çš„é€Ÿåº¦æŸ¥æ‰¾æŸä¸ªå…ƒç´ ï¼Ÿç»™ä¸€ä¸ªæ•°å­—ï¼Œåˆ¤æ–­ä»å·¦è¯»å’Œä»å³è¯»æ˜¯å¦æ˜¯ä¸€è‡´çš„ï¼Ÿä¾‹å¦‚12321å’Œ4444ç»™ä¸€ä¸ªæ•°ç»„[1ã€3ã€2ã€4ã€8]æ’åºå[1ã€2ã€3ã€4ã€8]ï¼Ÿæ€ä¹ˆç”¨ä¸‹é¢çš„ç±»ï¼ŸåŒ—äº¬å“ç§‘è‰ºç§‘æŠ€æœ‰é™å…¬å¸ NSuserDefault NSMange Object Context NSPredict æ€ä¹ˆä»xibæ–‡ä»¶åŠ è½½æˆUIviewï¼ŸOAuth2.0æˆæƒçš„è¿‡ç¨‹ï¼Œæ˜¯å¦ç”¨è¿‡1.0ï¼Ÿidæ˜¯ç¼–è¯‘æ—¶è¿˜æ˜¯è¿è¡Œæ—¶è“ç‰™ã€CFNetworkåŸºäºå•¥ï¼Ÿé€»è¾‘è¿ç®—è·Ÿä½è¿ç®—çš„åŒºåˆ«ï¼Ÿä¸‰ç»´åŠ¨ç”»çš„æ—‹è½¬çš„åŸç†ï¼Ÿåº•å±‚æ€ä¹ˆå®ç°ï¼Ÿç‚¹ä¸ç‚¹ ç”¨è·é˜µå˜æ¢å®ç°çš„ã€‚NSFileManager/NSFileHandleä¸ºä»€ä¹ˆä¸ç”¨æ–‡ä»¶åŠ è½½è€Œç”¨æ•°æ®åº“ï¼ŸuikitåŸºäºä»€ä¹ˆï¼Ÿé»˜å†™äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ï¼Ÿè®¾è®¡ä¸€ä¸ªå¿½ç•¥å¤§å°å†™æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„ç®—æ³•ï¼Ÿæ€ä¹ˆè¿‡æ»¤ä¸€æ®µæ—¢æœ‰å­—ç¬¦ä¸²åˆæœ‰æ•°å­—çš„ï¼Œè®©ä»–åªå‰©æ•°å­—ï¼Ÿæ”¯ä»˜åŠŸèƒ½ã€‚å¾®ä¿¡æ”¯ä»˜ æ”¯ä»˜å®æ”¯ä»˜å‹ç›Ÿåˆ†äº« æŠ¥é”™å‡è®¾æŸä¸€ä¸ªç”Ÿç‰©æ¯Bå¹´ç¹æ®–ä¸€æ¬¡ï¼Œä¸€æ¬¡ç¹æ®–Nä¸ªåªï¼Œå¯¿å‘½æ˜¯Må¹´ï¼Œç¼–å†™ç¨‹åºèµ·åˆæœ‰Xåªç”Ÿç‰©ï¼Œæ±‚Tå¹´ä¹‹åç”Ÿç‰©çš„æ€»æ•°æ˜¯å¤šå°‘ï¼Ÿ=æœ‰ä¸ªä¸ç›¸åŒçš„æ•°ï¼Œä»ä¸­éšæœºå–Nä¸ªæ•°ï¼Œè¦æ±‚Nä¸ªæ•°äº’ä¸ç›¸åŒã€‚//ï¼ˆå·²ç»æœ‰éšæœºå‡½æ•°int getRandï¼ˆint minï¼Œint maxï¼‰è¡¨ç¤ºè·å–ä»æœ€å°å€¼åˆ°æœ€å¤§å€¼çš„éšæœºæ•´æ•°ï¼‰ { return min + (max â€“ min) *rand()/RAND_MAX; } ä»€ä¹ˆæ˜¯æ¶ˆæ¯æ¨é€ï¼Ÿå·²çŸ¥äºŒå‰æ ‘ååºéå†åºåˆ—æ˜¯dabecï¼Œä¸­åºéå†åºåˆ—æ˜¯debacï¼Œå®ƒçš„å‰åœ¨iPhoneä¸­æ€ä¹ˆå†™å…¥C++ç¨‹åºï¼Œè¯¦ç»†å†™ä¸‹æ¥è¿œç¨‹æ¨é€ï¼›æœ¬åœ°æ¶ˆæ¯å’ŒåŸåœ°æ¨é€çš„åŒºåˆ«è‹¹æœæ€ä¹ˆå®ç°å®‰å…¨æœºåˆ¶ è®¾å¤‡æ§åˆ¶å’Œä¿æŠ¤:æ”¯æŒç”¨æˆ·ä»ä¸€ç³»åˆ—å¯†ç è®¾è®¡ç­–ç•¥ä¸­æ ¹æ®å®‰å…¨éœ€æ±‚æ¥è¿›è¡Œé€‰æ‹©ï¼ŒåŒ…æ‹¬è¶…æ—¶è®¾å®šã€å¯†ç é•¿åº¦ä»¥åŠå¯†ç æ›´æ–°å‘¨æœŸç­‰ æ•°æ®ä¿æŠ¤ã€‚256ä½AESç¡¬ä»¶åŠ å¯†ç®—æ³•ã€‚è¿œç¨‹ä¿¡æ¯æ“¦é™¤ï¼Œæœ¬åœ°ä¿¡æ¯æ“¦é™¤ å®‰å…¨ç½‘ç»œé€šä¿¡ï¼ŒVPN SSL WAP/WAP2è®¤è¯æ–¹å¼æ¥å…¥wifi å®‰å…¨çš„iOSå¹³å°ã€‚è¿è¡Œæ—¶ä¿æŠ¤-æ²™ç›’æœºåˆ¶ï¼Œåº”ç”¨ä¹‹é—´ä¸èƒ½ç›¸äº’è®¿é—®ï¼Œç³»ç»Ÿèµ„æºä¸ç”¨æˆ·ç¨‹åºéš”ç¦»ã€‚å¼ºåˆ¶å‰é¢ã€‚å®‰å…¨è®¤è¯æ¡†æ¶ æå…‰æ¨é€åŸç†ï¼ˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼‰ï¼Œæ€ä¹ˆç”¨çš„ï¼Ÿé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆè§£å†³çš„ï¼Ÿå¾®ä¿¡çš„é™„è¿‘åŠŸèƒ½æ€ä¹ˆå®ç°çš„ï¼Ÿæ€ä¹ˆå®ç°ç¬¬ä¸‰æ–¹ç™»é™†autolayoutï¼ŸsizeclassHealthKitæ˜¯ä»€ä¹ˆï¼Ÿ2014å¹´6æœˆ2æ—¥å¬å¼€çš„å¹´åº¦å¼€å‘è€…å¤§ä¼šä¸Šï¼Œè‹¹æœå‘å¸ƒäº†ä¸€æ¬¾æ–°çš„ç§»åŠ¨åº”ç”¨å¹³å°ï¼Œå¯ä»¥æ”¶é›†å’Œåˆ†æç”¨æˆ·çš„å¥åº·æ•°æ®ï¼Œè¿™æ˜¯è‹¹æœè®¡åˆ’ä¸ºå…¶è®¡ç®—å’Œç§»åŠ¨è½¯ä»¶æ¨å‡ºçš„ä¸€ç³»åˆ—æ–°åŠŸèƒ½çš„ä¸€éƒ¨åˆ†è¯¥ç§»åŠ¨åº”ç”¨å¹³å°è¢«å‘½åä¸ºâ€œHealthkit â€ï¼Œè‹¹æœé«˜ç®¡å‘Šè¯‰å¼€å‘è€…ï¼Œå®ƒå¯ä»¥æ•´åˆiPhoneæˆ–iPadä¸Šå…¶å®ƒå¥åº·åº”ç”¨æ”¶é›†çš„æ•°æ®ï¼Œå¦‚è¡€å‹å’Œä½“é‡ç­‰ã€‚ HealthKitæ¡†æ¶æä¾›äº†ä¸€ä¸ªç»“æ„ï¼Œåº”ç”¨å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ†äº«å¥åº·å’Œå¥èº«æ•°æ®ã€‚HealthKitç®¡ç†ä»ä¸åŒæ¥æºè·å¾—çš„æ•°æ®ï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„åå¥½è®¾ç½®ï¼Œè‡ªåŠ¨å°†ä¸åŒæ¥æºçš„æ‰€æœ‰æ•°æ®åˆå¹¶èµ·æ¥ã€‚åº”ç”¨è¿˜å¯ä»¥è·å–æ¯ä¸ªæ¥æºçš„åŸå§‹æ•°æ®ï¼Œç„¶åæ‰§è¡Œè‡ªå·±çš„æ•°æ®åˆå¹¶ã€‚ HealthKitä¹Ÿå¯ä»¥ç›´æ¥ä¸å¥åº·å’Œå¥èº«è®¾å¤‡ä¸€èµ·å·¥ä½œã€‚åœ¨iOS8.0ä¸­ï¼Œç³»ç»Ÿå¯ä»¥è‡ªåŠ¨å°†å…¼å®¹çš„ä½åŠŸè€—è“ç‰™å¿ƒç‡ä»ªçš„æ•°æ®ç›´æ¥ä¿å­˜åœ¨ HealthKitå­˜å‚¨ä¸­ã€‚å¦‚æœæœ‰M7è¿åŠ¨åå¤„ç†å™¨ï¼Œç³»ç»Ÿè¿˜å¯ä»¥è‡ªåŠ¨å¯¼å…¥è®¡æ­¥æ•°æ®ã€‚å…¶ä»–çš„è®¾å¤‡å’Œæ•°æ®æºå¿…é¡»è¦æœ‰é…å¥—çš„åº”ç”¨æ‰å¯ä»¥è·å–æ•°æ®å¹¶ä¿å­˜åœ¨HealthKitä¸­ã€‚ HealthKitå¦å¤–æä¾›äº†ä¸€ä¸ªåº”ç”¨æ¥å¸®åŠ©ç®¡ç†ç”¨æˆ·çš„å¥åº·æ•°æ®ã€‚å¥åº·åº”ç”¨ä¸ºç”¨æˆ·å±•ç¤ºHealthKitçš„æ•°æ®ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨å¥åº·åº”ç”¨æ¥æŸ¥çœ‹ã€æ·»åŠ ã€åˆ é™¤æˆ–è€…ç®¡ç†å…¶å…¨éƒ¨çš„å¥åº·å’Œå¥èº«æ•°æ®ã€‚ç”¨æˆ·è¿˜å¯ä»¥ç¼–è¾‘æ¯ç§æ•°æ®ç±»å‹çš„åˆ†äº«æƒé™ã€‚ HealthKitå’Œå¥åº·åº”ç”¨åœ¨iPadä¸Šéƒ½ä¸å¯ç”¨ã€‚HealthKitæ¡†æ¶ä¸èƒ½ç”¨äºåº”ç”¨æ‰©å±•ã€‚ HomeKitæ˜¯ä»€ä¹ˆï¼ŸHomeKitï¼Œæ˜¯è‹¹æœ2014å¹´å‘å¸ƒçš„æ™ºèƒ½å®¶å±…å¹³å°ã€‚HomeKitåº“æ˜¯ç”¨æ¥æ²Ÿé€šå’Œæ§åˆ¶å®¶åº­è‡ªåŠ¨åŒ–é…ä»¶çš„ï¼Œè¿™äº›å®¶åº­è‡ªåŠ¨åŒ–é…ä»¶éƒ½æ”¯æŒè‹¹æœçš„HomeKit Accessory Protocolã€‚HomeKitåº”ç”¨ç¨‹åºå¯è®©ç”¨æˆ·å‘ç°å…¼å®¹é…ä»¶å¹¶é…ç½®å®ƒä»¬ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸€äº›actionæ¥æ§åˆ¶æ™ºèƒ½é…ä»¶ï¼ˆä¾‹å¦‚æ’æ¸©æˆ–è€…å…‰çº¿å¼ºå¼±ï¼‰ï¼Œå¯¹å…¶è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Siriè§¦å‘ã€‚HomeKitå¯¹è±¡è¢«å­˜å‚¨åœ¨ç”¨æˆ·iOSè®¾å¤‡çš„æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”é€šè¿‡iCloudè¿˜å¯ä»¥åŒæ­¥åˆ°å…¶ä»–iOSè®¾å¤‡ã€‚HomeKitæ”¯æŒè¿œç¨‹è®¿é—®æ™ºèƒ½é…ä»¶ï¼Œå¹¶æ”¯æŒå¤šä¸ªç”¨æˆ·è®¾å¤‡å’Œå¤šä¸ªç”¨æˆ·ã€‚HomeKit è¿˜å¯¹ç”¨æˆ·çš„å®‰å…¨å’Œéšç§åšäº†å¤„ç†ã€‚ iCloudæ˜¯ä»€ä¹ˆåŒ…å«äº†å“ªäº›æŠ€æœ¯ä¸æœåŠ¡ï¼ŸiCloudæ˜¯è‹¹æœå…¬å¸æ‰€æä¾›çš„äº‘ç«¯æœåŠ¡ï¼Œ2011å¹´6æœˆ6æ—¥è‹¹æœå…¬å¸æ‰§è¡Œé•¿ä¹”å¸ƒæ–¯ï¼ˆSteve Jobsï¼‰æŠ±ç—…ä¸»æŒå…¨çƒå¼€å‘è€…å¤§ä¼šï¼ˆWWDCï¼‰ï¼Œæ­£å¼å‘è¡¨äº‘ç«¯æœåŠ¡iCloud, iOS 5 ä»¥åŠ OS X Lion.å…¶ä¸­iCloudçš„åŠŸèƒ½æ˜¯å­˜å‚¨å†…å®¹ï¼ŒåŒ…æ‹¬è´­ä¹°çš„éŸ³ä¹ã€åº”ç”¨ã€ç”µå­ä¹¦ç­‰æ¨é€åˆ°æ‰€æœ‰è®¾å¤‡,iCloudæ˜¯ä¸€ç³»åˆ—æœåŠ¡çš„æŠ€æœ¯å°è£…,ä½¿ç”¨è€…å¯ä»¥å…è´¹å‚¨å­˜5GBèµ„æ–™ã€‚å¯ä»¥å¤‡ä»½å­˜æ”¾ç…§ç‰‡ã€éŸ³ä¹ã€é€šè®¯å½•ã€çŸ­ä¿¡ã€æ–‡æ¡£ç­‰å†…å®¹ï¼Œåœ¨ä½ éœ€è¦çš„æ—¶å€™ä»¥æ— çº¿æ–¹å¼å°†ä»–ä»¬æ¨é€åˆ°ä½ æ‰€æœ‰çš„è®¾å¤‡ä¸Šã€‚è‡ªè¡Œæ‰§è¡Œã€‚è½»æ¾è‡ªå¦‚ã€è¿ä½œæµç•…ï¼Œå®ƒå°±æ˜¯è¿™ä¹ˆç®¡ç”¨ã€‚å¯ä¸äº²æœ‹å¥½å‹å…±äº«ä½“éªŒçš„å®Œæ•´å¹³å°ã€‚å®ƒä¸ä»…å®‰å…¨ï¼Œè€Œä¸”å¯æä¾›ä¸°å¯Œçš„ç¤¾äº¤ä½“éªŒï¼Œä»ä»»ä½•è®¡ç®—æœºæˆ–è®¾å¤‡å‡å¯éšæ—¶æ–¹ä¾¿åœ°è¿›è¡Œè®¿é—®ã€‚iCloudä¸Šæ‰€æä¾›çš„åº”ç”¨ç¨‹åºåŒ…æ‹¬åŠå…¬ç”Ÿäº§ç‡ã€å¼€å‘å·¥å…·ã€åª’ä½“å’Œçª—å£å°éƒ¨ä»¶ç­‰ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿˜å°†é€šè¿‡æ˜“äºä½¿ç”¨çš„å¸‚åœºç©ºé—´å’Œåº”ç”¨ç¨‹åºå¼€å‘å·¥å…·ç®±æä¾›èŒƒå›´æ›´å¹¿çš„åº”ç”¨ç¨‹åºã€‚ æœåŠ¡:åº”ç”¨è½¯ä»¶ã€ç”µå­ä¹¦ä¸å¤‡ä»½ã€Documents in the Cloudã€Photo Streamï¼ˆç…§ç‰‡æµï¼‰ã€iTunes Matchã€Mobile Me CoreDataï¼šä¸­å¤šçº¿ç¨‹ä¸­å¤„ç†å¤§é‡æ•°æ®åŒæ­¥æ—¶çš„æ“ä½œ CoreData:æ˜¯CoCoaä¸­å¤„ç†æ•°æ®ç»‘å®šæ•°æ®çš„å…³é”®ç‰¹æ€§ï¼Œæä¾›å®Œæ•´çš„å¯¹è±¡æŒä¹…åŒ–å­˜å‚¨æ–¹æ¡ˆã€‚å¦‚æœä½ ä½¿ç”¨sqlite3åŒå€¦äº†æ•²æ‰“sqlè¯­å¥ï¼ŒCoreDataæ­£è§£å†³äº†ä½ è¿™çƒ¦æ¼ã€‚sqlite3æ˜¯CoreDataå¤„ç†çš„æ•°æ®ç±»å‹ä¹‹ä¸€ï¼Œå½“ä½ å°†CoreDataå’Œsqliteçš„ç»“åˆèµ·æ¥ä½¿ç”¨çš„è¯ï¼Œä½ å°†èƒ½å¼€å‘å‡ºå¼ºå¤§çš„æ•°æ®åº“åº”ç”¨ã€‚ CoreDataä¸å¤šçº¿ç¨‹æ“ä½œ:ä¸ºäº†åœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™ä¸è®©ç•Œé¢åœæ»ï¼Œä½¿ç”¨å¤šçº¿ç¨‹æ˜¯ä¸å¯é¿å…ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šç”¨threadï¼Œä¸²è¡Œçº¿ç¨‹æˆ–è€…å¹¶å‘çº¿ç¨‹ã€‚coredataä¸å¤šçº¿ç¨‹äº¤äº’çš„æ—¶å€™ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªmanager contextå¯¹è±¡ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š 1.æ¯ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ç§æœ‰çš„manager contextï¼Œå…±äº«ä¸€ä¸ª persistent store coordinator 2.æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ç§æœ‰çš„manager contextå’Œç§æœ‰çš„persistent store coordinator å¯¹äºè¿™ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬æ¯”è¾ƒæ¨èä½¿ç”¨ç¬¬ä¸€é’Ÿæ–¹å¼ï¼Œå› ä¸ºä½¿ç”¨ç¬¬äºŒç§æ–¹å¼çš„ä¼šæ¶ˆè€—æˆ‘ä»¬æ›´å¤šçš„å†…å­˜ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨ç¬¬ä¸€ç§ã€‚ æ³¨æ„:CoreDataé‡Œé¢è¿˜å¸¦æœ‰ä¸€ä¸ªé€šçŸ¥NSManagedObjectContextDidSaveNotificationï¼Œä¸»è¦ç›‘NSManagedObjectContextçš„æ•°æ®æ˜¯å¦æ”¹å˜ï¼Œå¹¶åˆå¹¶æ•°æ®æ”¹å˜åˆ°ç›¸åº”context è¯·è§£é‡Šä¸€ä¸‹Handoffæ˜¯ä»€ä¹ˆï¼Œå¹¶ç®€è¿°å®ƒæ˜¯å¦‚ä½•å®ç°iOSã€Mac/ç½‘é¡µåº”ç”¨äº’é€šçš„ å¼€å‘æŒ‡å—Handoffè‹±è¯‘æ˜¯ç”¨æ‰‹æ¨å¼€æŸäººï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸæ˜¯CDMAæœ¯è¯­ï¼Œè¡¨ç¤ºåˆ‡æ¢çš„æ„æ€ã€‚OSX 10.10 Yosemiteæ–°å¢äº†ä¸€ä¸ªé…·ç‚«çš„åŠŸèƒ½â€œHandOffâ€ï¼Œæ‰“å¼€è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼Œç”¨æˆ·å¯ä»¥åœ¨Macä¸Šå¯¹iPadå’ŒiPhoneè¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚èƒ½å¤Ÿç¼–å†™iPhoneä¸Šæœªå®Œæˆçš„é‚®ä»¶ï¼Œå¹¶ä¸”å¯ä»¥åœ¨Macä¸Šæ‰“å¼€iPhoneçš„çƒ­ç‚¹ç­‰ç­‰ï¼ŒMacçš„Hand OffåŠŸèƒ½åªèƒ½è¯†åˆ«Macå‘¨å›´çš„iPhoneæ‰‹æœºã€‚ Handoffçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼šç”¨æˆ·åœ¨ä¸€ä¸ªåº”ç”¨é‡Œæ‰€åšçš„ä»»ä½•æ“ä½œéƒ½åŒ…å«ç€ä¸€ä¸ªactivityï¼Œä¸€ä¸ªactivityå¯ä»¥å’Œä¸€ä¸ªç‰¹å®šç”¨æˆ·çš„å¤šå°è®¾å¤‡å…³è”èµ·æ¥ã€‚ç”¨è¡Œè¯æ¥è¯´ï¼ŒæŠ½è±¡å‡ºè¿™ç§activityçš„ç±»å«åšNSUserActivityï¼Œå¤§éƒ¨åˆ†æ—¶é—´æˆ‘ä»¬éƒ½ä¼šå’Œè¿™ä¸ªç±»æ‰“äº¤é“ã€‚éœ€è¦ä¸€æçš„æ˜¯ï¼Œæ‰€æœ‰çš„è®¾å¤‡éƒ½å¿…é¡»é è¿‘ï¼ˆé è¿‘æ˜¯æŒ‡ä¸¤å°è®¾å¤‡çš„è“ç‰™èƒ½å¤Ÿå½¼æ­¤è¿æ¥ï¼‰ï¼Œè¿™æ ·Handoffæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚è€Œä¸”è¿˜æœ‰ä¸¤ä¸ªå…ˆå†³æ¡ä»¶å¾—æ»¡è¶³ï¼šç¬¬ä¸€ä¸ªæ¡ä»¶æ˜¯å¾—æœ‰ä¸€ä¸ªèƒ½æ­£å¸¸ä½¿ç”¨çš„iCloudè´¦å·ï¼Œè€Œä¸”ç”¨æˆ·åº”è¯¥åœ¨æ¯å°å‡†å¤‡ä½¿ç”¨Handoffçš„è®¾å¤‡ä¸Šç™»é™†è¿™ä¸ªiCloudè´¦å·ã€‚äº‹å®ä¸Šï¼Œå½“åœ¨ä¸åŒçš„è®¾å¤‡ä¸Šåˆ‡æ¢æ—¶ï¼Œä¸ºäº†ä¿è¯æ­£åœ¨è¿›è¡Œçš„activityä¸è¢«ä¸­æ–­è€Œä¸”è¢«å…³è”åˆ°åŒä¸€ä¸ªç”¨æˆ·ï¼Œåº”è¯¥å°½å¯èƒ½åœ°åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šä½¿ç”¨åŒä¸€ä¸ªiCloudè´¦å·ã€‚ç¬¬äºŒä¸ªæ¡ä»¶æ˜¯å½“ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šä¸åŒçš„åº”ç”¨æƒ³è¦åœ¨åŒä¸€ä¸ªç”¨æˆ·activityè¿›è¡ŒHandoffçš„æ“ä½œæ—¶éœ€è¦å…·å¤‡çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„åº”ç”¨å¿…é¡»ä½¿ç”¨Xcodeé‡Œç›¸åŒçš„å›¢é˜Ÿæ ‡è¯†ï¼ˆTeamIDï¼‰ç­¾åã€‚ å½“ç¼–å†™ä¸€ä¸ªæ”¯æŒHandoffçš„åº”ç”¨æ—¶ï¼Œéœ€è¦å…³æ³¨ä»¥ä¸‹ä¸‰ä¸ªäº¤äº’äº‹ä»¶ï¼š 1.ä¸ºå°†åœ¨å¦ä¸€å°è®¾å¤‡ä¸Šç»§ç»­åšçš„äº‹åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·activityã€‚ 2.å½“éœ€è¦æ—¶ï¼Œç”¨æ–°çš„æ•°æ®æ›´æ–°å·²æœ‰çš„ç”¨æˆ·activityã€‚ 3.æŠŠä¸€ä¸ªç”¨æˆ·activityä¼ é€’åˆ°å¦ä¸€å°è®¾å¤‡ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯Handoffç›¸å…³çš„æµ‹è¯•åªèƒ½åœ¨çœŸå®è®¾å¤‡ä¸Šè¿›è¡Œï¼Œæ‰€ä»¥ä½ å¾—æœ‰è‡³å°‘ä¸¤å°è¿è¡Œç€iOS 8.0æˆ–ä»¥ä¸Šç³»ç»Ÿçš„è®¾å¤‡ã€‚ä¸ç®¡æ˜¯å¤šå°iPhoneï¼Œå¤šå°iPadæˆ–è€…åŒæ—¶æ‹¥æœ‰iPhoneå’ŒiPadéƒ½å¯ä»¥ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜23--é€šçŸ¥ä¸æ¨é€]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9823-%E9%80%9A%E7%9F%A5%E4%B8%8E%E6%8E%A8%E9%80%81%2F</url>
    <content type="text"><![CDATA[æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€é€šçŸ¥å¯¹åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ï¼Ÿimage æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€é€šçŸ¥éƒ½å¯ä»¥å‘ä¸åœ¨å‰å°è¿è¡Œçš„åº”ç”¨å‘é€æ¶ˆæ¯,è¿™ç§æ¶ˆæ¯æ—¢å¯èƒ½æ˜¯å³å°†å‘ç”Ÿçš„äº‹ä»¶,ä¹Ÿå¯èƒ½æ˜¯æœåŠ¡å™¨çš„æ–°æ•°æ®.ä¸ç®¡æ˜¯æœ¬åœ°é€šçŸ¥è¿˜æ˜¯è¿œç¨‹é€šçŸ¥,ä»–ä»¬åœ¨ç¨‹åºç•Œé¢çš„æ˜¾ç¤ºæ•ˆæœç›¸åŒ,éƒ½å¯èƒ½æ˜¾ç¤ºä¸ºä¸€æ®µè­¦å‘Šä¿¡æ¯æˆ–åº”ç”¨ç¨‹åºå›¾æ ‡ä¸Šçš„å¾®ç« . æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€é€šçŸ¥çš„åŸºæœ¬ç›®çš„éƒ½æ˜¯è®©åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šçŸ¥ç”¨æˆ·æŸäº›äº‹æƒ…, è€Œä¸”ä¸éœ€è¦åº”ç”¨ç¨‹åºåœ¨å‰å°è¿è¡Œ.äºŒè€…çš„åŒºåˆ«åœ¨äºæœ¬åœ°é€šçŸ¥ç”±æœ¬åº”ç”¨è´Ÿè´£è°ƒç”¨,åªèƒ½ä»å½“å‰è®¾å¤‡ä¸Šçš„iOSå‘å‡º, è€Œè¿œç¨‹é€šçŸ¥ç”±è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç¨‹åºå‘é€åˆ°APNS,å†ç”±APNSæŠŠæ¶ˆæ¯æ¨é€è‡³è®¾å¤‡ä¸Šçš„ç¨‹åº iOSå…è®¸æœ€è¿‘æœ¬åœ°é€šçŸ¥æ•°æœ€å¤§æ˜¯å¤šå°‘ï¼ˆcï¼‰A.16 B.32 C.64 D.128 æŠŠç¨‹åºè‡ªå·±å…³æ‰å’Œç¨‹åºè¿›å…¥åå°,è¿œç¨‹æ¨é€çš„åŒºåˆ« å…³æ‰åä¸æ‰§è¡Œä»»ä½•ä»£ç , ä¸èƒ½å¤„ç†äº‹ä»¶ åº”ç”¨ç¨‹åºè¿›å…¥åå°çŠ¶æ€ä¸ä¹…åè½¬å…¥æŒ‚èµ·çŠ¶æ€ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸æ‰§è¡Œä»»ä½•ä»£ç ï¼Œå¹¶æœ‰å¯èƒ½åœ¨ä»»æ„æ—¶å€™ä»å†…å­˜ä¸­åˆ é™¤ã€‚åªæœ‰å½“ç”¨æˆ·å†æ¬¡è¿è¡Œæ­¤åº”ç”¨ï¼Œåº”ç”¨æ‰ä¼šä»æŒ‚èµ·çŠ¶æ€å”¤é†’ï¼Œä»£ç å¾—ä»¥ç»§ç»­æ‰§è¡Œ æˆ–è€…è¿›å…¥åå°æ—¶å¼€å¯å¤šä»»åŠ¡çŠ¶æ€ï¼Œä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æ‰§è¡Œç³»ç»Ÿå…è®¸çš„åŠ¨ä½œ è¿œç¨‹æ¨é€æ˜¯ç”±è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç¨‹åºå‘é€åˆ°APNS,å†ç”±APNSæŠŠæ¶ˆæ¯æ¨é€è‡³è®¾å¤‡ä¸Šçš„ç¨‹åº,å½“åº”ç”¨ç¨‹åºæ”¶åˆ°æ¨é€çš„æ¶ˆæ¯ä¼šè‡ªåŠ¨è°ƒç”¨ç‰¹å®šçš„æ–¹æ³•æ‰§è¡Œäº‹å…ˆå†™å¥½çš„ä»£ç  æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€é€šçŸ¥å¯¹åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ï¼Ÿ æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€é€šçŸ¥éƒ½å¯ä»¥å‘ä¸åœ¨å‰å°è¿è¡Œçš„åº”ç”¨å‘é€æ¶ˆæ¯,è¿™ç§æ¶ˆæ¯æ—¢å¯èƒ½æ˜¯å³å°†å‘ç”Ÿçš„äº‹ä»¶,ä¹Ÿå¯èƒ½æ˜¯æœåŠ¡å™¨çš„æ–°æ•°æ®.ä¸ç®¡æ˜¯æœ¬åœ°é€šçŸ¥è¿˜æ˜¯è¿œç¨‹é€šçŸ¥,ä»–ä»¬åœ¨ç¨‹åºç•Œé¢çš„æ˜¾ç¤ºæ•ˆæœç›¸åŒ,éƒ½å¯èƒ½æ˜¾ç¤ºä¸ºä¸€æ®µè­¦å‘Šä¿¡æ¯æˆ–åº”ç”¨ç¨‹åºå›¾æ ‡ä¸Šçš„å¾®ç« . æœ¬åœ°é€šçŸ¥å’Œè¿œç¨‹æ¨é€é€šçŸ¥çš„åŸºæœ¬ç›®çš„éƒ½æ˜¯è®©åº”ç”¨ç¨‹åºèƒ½å¤Ÿé€šçŸ¥ç”¨æˆ·æŸäº›äº‹æƒ…, è€Œä¸”ä¸éœ€è¦åº”ç”¨ç¨‹åºåœ¨å‰å°è¿è¡Œ.äºŒè€…çš„åŒºåˆ«åœ¨äºæœ¬åœ°é€šçŸ¥ç”±æœ¬åº”ç”¨è´Ÿè´£è°ƒç”¨,åªèƒ½ä»å½“å‰è®¾å¤‡ä¸Šçš„iOSå‘å‡º, è€Œè¿œç¨‹é€šçŸ¥ç”±è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç¨‹åºå‘é€åˆ°APNS,å†ç”±APNSæŠŠæ¶ˆæ¯æ¨é€è‡³è®¾å¤‡ä¸Šçš„ç¨‹åº Push Notification æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ æ¨é€é€šçŸ¥åˆ†ä¸ºä¸¤ç§,ä¸€ä¸ªæ˜¯æœ¬åœ°æ¨é€,ä¸€ä¸ªæ˜¯è¿œç¨‹æ¨é€ æœ¬åœ°æ¨é€:ä¸éœ€è¦è”ç½‘ä¹Ÿå¯ä»¥æ¨é€,æ˜¯å¼€å‘äººå‘˜åœ¨APPå†…è®¾å®šç‰¹å®šçš„æ—¶é—´æ¥æé†’ç”¨æˆ·å¹²ä»€ä¹ˆ è¿œç¨‹æ¨é€:éœ€è¦è”ç½‘,ç”¨æˆ·çš„è®¾å¤‡ä¼šäºè‹¹æœAPNSæœåŠ¡å™¨å½¢æˆä¸€ä¸ªé•¿è¿æ¥,ç”¨æˆ·è®¾å¤‡ä¼šå‘é€uuidå’ŒBundle idenidentifierç»™è‹¹æœæœåŠ¡å™¨,è‹¹æœæœåŠ¡å™¨ä¼šåŠ å¯†ç”Ÿæˆä¸€ä¸ªdeviceTokenç»™ç”¨æˆ·è®¾å¤‡,ç„¶åè®¾å¤‡ä¼šå°†deviceTokenå‘é€ç»™APPçš„æœåŠ¡å™¨,æœåŠ¡å™¨ä¼šå°†deviceTokenå­˜è¿›ä»–ä»¬çš„æ•°æ®åº“,è¿™æ—¶å€™å¦‚æœæœ‰äººå‘é€æ¶ˆæ¯ç»™æˆ‘,æœåŠ¡å™¨ç«¯å°±ä¼šå»æŸ¥è¯¢æˆ‘çš„deviceToken,ç„¶åå°†deviceTokenå’Œè¦å‘é€çš„ä¿¡æ¯å‘é€ç»™è‹¹æœæœåŠ¡å™¨,è‹¹æœæœåŠ¡å™¨é€šè¿‡deviceTokenæ‰¾åˆ°æˆ‘çš„è®¾å¤‡å¹¶å°†æ¶ˆæ¯æ¨é€åˆ°æˆ‘çš„è®¾å¤‡ä¸Š,è¿™é‡Œè¿˜æœ‰ä¸ªæƒ…å†µæ˜¯å¦‚æœAPPåœ¨çº¿,é‚£ä¹ˆAPPæœåŠ¡å™¨ä¼šäºAPPäº§ç”Ÿä¸€ä¸ªé•¿è¿æ¥,è¿™æ—¶å€™APPFæœåŠ¡å™¨ä¼šç›´æ¥é€šè¿‡deviceTokenå°†æ¶ˆæ¯æ¨é€åˆ°è®¾å¤‡ä¸Š ä¸ºä»€ä¹ˆ NotificationCenter è¦ removeObserver? å¦‚ä½•å®ç°è‡ªåŠ¨ remove? å¦‚æœä¸ç§»é™¤çš„è¯,ä¸‡ä¸€æ³¨å†Œé€šçŸ¥çš„ç±»è¢«é”€æ¯ä»¥ååˆå‘äº†é€šçŸ¥,ç¨‹åºä¼šå´©æºƒ.å› ä¸ºå‘é‡æŒ‡é’ˆå‘é€äº†æ¶ˆæ¯ å®ç°è‡ªåŠ¨remove:é€šè¿‡è‡ªé‡Šæ”¾æœºåˆ¶,é€šè¿‡åŠ¨æ€å±æ€§å°†removeè½¬ç§»ç»™ç¬¬ä¸‰è€…,è§£é™¤è€¦åˆ,è¾¾åˆ°è‡ªåŠ¨å®ç°remove æ˜¯å¦å¯ä»¥æŠŠæ¯”è¾ƒè€—æ—¶çš„æ“ä½œæ”¾åœ¨NSNotificationCenterä¸­ å¦‚æœåœ¨å¼‚æ­¥çº¿ç¨‹å‘çš„é€šçŸ¥ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼› å¦‚æœåœ¨ä¸»çº¿ç¨‹å‘çš„é€šçŸ¥ï¼Œé‚£ä¹ˆå°±ä¸å¯ä»¥æ‰§è¡Œæ¯”è¾ƒè€—æ—¶çš„æ“ä½œ]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜22--æ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9822-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%2F</url>
    <content type="text"><![CDATA[æ–‡å­—æ˜¯ä»¥å‰æ”¶é›†çš„ï¼Œå›½å¤–å¤§ç‰›å†™çš„ï¼Œå¿˜è®°åŸæ–‡é“¾æ¥äº†ã€‚ å…¥é—¨çº§ ç”¨ARCç®¡ç†å†…å­˜ åœ¨æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨ reuseIdentifier å°½é‡æŠŠviewsè®¾ç½®ä¸ºé€æ˜ é¿å…è¿‡äºåºå¤§çš„XIB ä¸è¦é˜»å¡ä¸»çº¿ç¨‹ åœ¨Image Viewsä¸­è°ƒæ•´å›¾ç‰‡å¤§å°ã€‚å¦‚æœè¦åœ¨UIImageViewä¸­æ˜¾ç¤ºä¸€ä¸ªæ¥è‡ªbundleçš„å›¾ç‰‡ï¼Œä½ åº”ä¿è¯å›¾ç‰‡çš„å¤§å°å’ŒUIImageViewçš„å¤§å°ç›¸åŒã€‚åœ¨è¿è¡Œä¸­ç¼©æ”¾å›¾ç‰‡æ˜¯å¾ˆè€—è´¹èµ„æºçš„ï¼Œç‰¹åˆ«æ˜¯UIImageViewåµŒå¥—åœ¨UIScrollViewä¸­çš„æƒ…å†µä¸‹ã€‚å¦‚æœå›¾ç‰‡æ˜¯ä»è¿œç«¯æœåŠ¡åŠ è½½çš„ä½ ä¸èƒ½æ§åˆ¶å›¾ç‰‡å¤§å°ï¼Œæ¯”å¦‚åœ¨ä¸‹è½½å‰è°ƒæ•´åˆ°åˆé€‚å¤§å°çš„è¯ï¼Œä½ å¯ä»¥åœ¨ä¸‹è½½å®Œæˆåï¼Œæœ€å¥½æ˜¯ç”¨background threadï¼Œç¼©æ”¾ä¸€æ¬¡ï¼Œç„¶ååœ¨UIImageViewä¸­ä½¿ç”¨ç¼©æ”¾åçš„å›¾ç‰‡ã€‚ é€‰æ‹©æ­£ç¡®çš„Collectionã€‚ Arrays: æœ‰åºçš„ä¸€ç»„å€¼ã€‚ä½¿ç”¨indexæ¥lookupå¾ˆå¿«ï¼Œä½¿ç”¨value lookupå¾ˆæ…¢ï¼Œ æ’å…¥/åˆ é™¤å¾ˆæ…¢ã€‚ Dictionaries: å­˜å‚¨é”®å€¼å¯¹ã€‚ ç”¨é”®æ¥æŸ¥æ‰¾æ¯”è¾ƒå¿«ã€‚ Sets: æ— åºçš„ä¸€ç»„å€¼ã€‚ç”¨å€¼æ¥æŸ¥æ‰¾å¾ˆå¿«ï¼Œæ’å…¥/åˆ é™¤å¾ˆå¿«ã€‚ æ‰“å¼€gzipå‹ç¼©ã€‚appå¯èƒ½å¤§é‡ä¾èµ–äºæœåŠ¡å™¨èµ„æºï¼Œé—®é¢˜æ˜¯æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç§»åŠ¨è®¾å¤‡ï¼Œå› æ­¤ä½ å°±ä¸èƒ½æŒ‡æœ›ç½‘ç»œçŠ¶å†µæœ‰å¤šå¥½ã€‚å‡å°æ–‡æ¡£çš„ä¸€ä¸ªæ–¹å¼å°±æ˜¯åœ¨æœåŠ¡ç«¯å’Œä½ çš„appä¸­æ‰“å¼€gzipã€‚è¿™å¯¹äºæ–‡å­—è¿™ç§èƒ½æœ‰æ›´é«˜å‹ç¼©ç‡çš„æ•°æ®æ¥è¯´ä¼šæœ‰æ›´æ˜¾è‘—çš„æ•ˆç”¨ã€‚ iOSå·²ç»åœ¨NSURLConnectionä¸­é»˜è®¤æ”¯æŒäº†gzipå‹ç¼©ï¼Œå½“ç„¶AFNetworkingè¿™äº›åŸºäºå®ƒçš„æ¡†æ¶äº¦ç„¶ã€‚ ä¸­çº§ é‡ç”¨å’Œå»¶è¿ŸåŠ è½½(lazy load) Views æ›´å¤šçš„viewæ„å‘³ç€æ›´å¤šçš„æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯æ›´å¤šçš„CPUå’Œå†…å­˜æ¶ˆè€—ï¼Œå¯¹äºé‚£ç§åµŒå¥—äº†å¾ˆå¤šviewåœ¨UIScrollViewé‡Œè¾¹çš„appæ›´æ˜¯å¦‚æ­¤ã€‚ è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„æŠ€å·§å°±æ˜¯æ¨¡ä»¿UITableViewå’ŒUICollectionViewçš„æ“ä½œ: ä¸è¦ä¸€æ¬¡åˆ›å»ºæ‰€æœ‰çš„subviewï¼Œè€Œæ˜¯å½“éœ€è¦æ—¶æ‰åˆ›å»ºï¼Œå½“å®ƒä»¬å®Œæˆäº†ä½¿å‘½ï¼ŒæŠŠä»–ä»¬æ”¾è¿›ä¸€ä¸ªå¯é‡ç”¨çš„é˜Ÿåˆ—ä¸­ã€‚è¿™æ ·çš„è¯ä½ å°±åªéœ€è¦åœ¨æ»šåŠ¨å‘ç”Ÿæ—¶åˆ›å»ºä½ çš„viewsï¼Œé¿å…äº†ä¸åˆ’ç®—çš„å†…å­˜åˆ†é…ã€‚ Cache, Cache, è¿˜æ˜¯Cache! ä¸€ä¸ªæå¥½çš„åŸåˆ™å°±æ˜¯ï¼Œç¼“å­˜æ‰€éœ€è¦çš„ï¼Œä¹Ÿå°±æ˜¯é‚£äº›ä¸å¤§å¯èƒ½æ”¹å˜ä½†æ˜¯éœ€è¦ç»å¸¸è¯»å–çš„ä¸œè¥¿ã€‚ æˆ‘ä»¬èƒ½ç¼“å­˜äº›ä»€ä¹ˆå‘¢ï¼Ÿä¸€äº›é€‰é¡¹æ˜¯ï¼Œè¿œç«¯æœåŠ¡å™¨çš„å“åº”ï¼Œå›¾ç‰‡ï¼Œç”šè‡³è®¡ç®—ç»“æœï¼Œæ¯”å¦‚UITableViewçš„è¡Œé«˜ã€‚ NSCacheå’ŒNSDictionaryç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ç³»ç»Ÿå›æ”¶å†…å­˜çš„æ—¶å€™å®ƒä¼šè‡ªåŠ¨åˆ æ‰å®ƒçš„å†…å®¹ã€‚ æƒè¡¡æ¸²æŸ“æ–¹æ³•.æ€§èƒ½èƒ½è¿˜æ˜¯è¦bundleä¿æŒåˆé€‚çš„å¤§å°ã€‚ å¤„ç†å†…å­˜è­¦å‘Š.ç§»é™¤å¯¹ç¼“å­˜ï¼Œå›¾ç‰‡objectå’Œå…¶ä»–ä¸€äº›å¯ä»¥é‡åˆ›å»ºçš„objectsçš„strong references. é‡ç”¨å¤§å¼€é”€å¯¹è±¡ ä¸€äº›objectsçš„åˆå§‹åŒ–å¾ˆæ…¢ï¼Œæ¯”å¦‚NSDateFormatterå’ŒNSCalendarã€‚ç„¶è€Œï¼Œä½ åˆä¸å¯é¿å…åœ°éœ€è¦ä½¿ç”¨å®ƒä»¬ï¼Œæ¯”å¦‚ä»JSONæˆ–è€…XMLä¸­è§£ææ•°æ®ã€‚æƒ³è¦é¿å…ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„ç“¶é¢ˆä½ å°±éœ€è¦é‡ç”¨ä»–ä»¬ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ å±æ€§åˆ°ä½ çš„classé‡Œæˆ–è€…åˆ›å»ºé™æ€å˜é‡æ¥å®ç°ã€‚ é¿å…åå¤å¤„ç†æ•°æ®.åœ¨æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„æ•°æ®ç»“æ„å¾ˆé‡è¦ã€‚ é€‰æ‹©æ­£ç¡®çš„æ•°æ®æ ¼å¼.è§£æJSONä¼šæ¯”XMLæ›´å¿«ä¸€äº›ï¼ŒJSONä¹Ÿé€šå¸¸æ›´å°æ›´ä¾¿äºä¼ è¾“ã€‚ä»iOS5èµ·æœ‰äº†å®˜æ–¹å†…å»ºçš„JSON deserialization å°±æ›´åŠ æ–¹ä¾¿ä½¿ç”¨äº†ã€‚ä½†æ˜¯XMLä¹Ÿæœ‰XMLçš„å¥½å¤„ï¼Œæ¯”å¦‚ä½¿ç”¨SAX æ¥è§£æXMLå°±åƒè§£ææœ¬åœ°æ–‡ä»¶ä¸€æ ·ï¼Œä½ ä¸éœ€åƒè§£æjsonä¸€æ ·ç­‰åˆ°æ•´ä¸ªæ–‡æ¡£ä¸‹è½½å®Œæˆæ‰å¼€å§‹è§£æã€‚å½“ä½ å¤„ç†å¾ˆå¤§çš„æ•°æ®çš„æ—¶å€™å°±ä¼šæå¤§åœ°å‡ä½å†…å­˜æ¶ˆè€—å’Œå¢åŠ æ€§èƒ½ã€‚ æ­£ç¡®è®¾å®šèƒŒæ™¯å›¾ç‰‡ å…¨å±èƒŒæ™¯å›¾ï¼Œåœ¨viewä¸­æ·»åŠ ä¸€ä¸ªUIImageViewä½œä¸ºä¸€ä¸ªå­View åªæ˜¯æŸä¸ªå°çš„viewçš„èƒŒæ™¯å›¾ï¼Œä½ å°±éœ€è¦ç”¨UIColorçš„colorWithPatternImageæ¥åšäº†ï¼Œå®ƒä¼šæ›´å¿«åœ°æ¸²æŸ“ä¹Ÿä¸ä¼šèŠ±è´¹å¾ˆå¤šå†…å­˜ï¼š å‡å°‘ä½¿ç”¨Webç‰¹æ€§ã€‚æƒ³è¦æ›´é«˜çš„æ€§èƒ½ä½ å°±è¦è°ƒæ•´ä¸‹ä½ çš„HTMLäº†ã€‚ç¬¬ä¸€ä»¶è¦åšçš„äº‹å°±æ˜¯å°½å¯èƒ½ç§»é™¤ä¸å¿…è¦çš„javascriptï¼Œé¿å…ä½¿ç”¨è¿‡å¤§çš„æ¡†æ¶ã€‚èƒ½åªç”¨åŸç”Ÿjså°±æ›´å¥½äº†ã€‚å°½å¯èƒ½å¼‚æ­¥åŠ è½½ä¾‹å¦‚ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡scriptè¿™ç§ä¸å½±å“é¡µé¢è¡¨è¾¾çš„javascriptã€‚æ³¨æ„ä½ ä½¿ç”¨çš„å›¾ç‰‡ï¼Œä¿è¯å›¾ç‰‡çš„ç¬¦åˆä½ ä½¿ç”¨çš„å¤§å°ã€‚ Shadow Path ã€‚Core Animationä¸å¾—ä¸å…ˆåœ¨åå°å¾—å‡ºä½ çš„å›¾å½¢å¹¶åŠ å¥½é˜´å½±ç„¶åæ‰æ¸²æŸ“ï¼Œè¿™å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚ä½¿ç”¨shadowPathçš„è¯å°±é¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨shadow pathçš„è¯iOSå°±ä¸å¿…æ¯æ¬¡éƒ½è®¡ç®—å¦‚ä½•æ¸²æŸ“ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªé¢„å…ˆè®¡ç®—å¥½çš„è·¯å¾„ã€‚ä½†é—®é¢˜æ˜¯è‡ªå·±è®¡ç®—pathçš„è¯å¯èƒ½åœ¨æŸäº›Viewä¸­æ¯”è¾ƒå›°éš¾ï¼Œä¸”æ¯å½“viewçš„frameå˜åŒ–çš„æ—¶å€™ä½ éƒ½éœ€è¦å»update shadow path. ä¼˜åŒ–Table View æ­£ç¡®ä½¿ç”¨reuseIdentifieræ¥é‡ç”¨cells å°½é‡ä½¿æ‰€æœ‰çš„view opaqueï¼ŒåŒ…æ‹¬cellè‡ªèº« é¿å…æ¸å˜ï¼Œå›¾ç‰‡ç¼©æ”¾ï¼Œåå°é€‰äºº ç¼“å­˜è¡Œé«˜ å¦‚æœcellå†…ç°å®çš„å†…å®¹æ¥è‡ªwebï¼Œä½¿ç”¨å¼‚æ­¥åŠ è½½ï¼Œç¼“å­˜è¯·æ±‚ç»“æœ ä½¿ç”¨shadowPathæ¥ç”»é˜´å½± å‡å°‘subviewsçš„æ•°é‡ å°½é‡ä¸é€‚ç”¨cellForRowAtIndexPath:ï¼Œå¦‚æœä½ éœ€è¦ç”¨åˆ°å®ƒï¼Œåªç”¨ä¸€æ¬¡ç„¶åç¼“å­˜ç»“æœ ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æ•°æ® ä½¿ç”¨rowHeight, sectionFooterHeight å’Œ sectionHeaderHeightæ¥è®¾å®šå›ºå®šçš„é«˜ï¼Œä¸è¦è¯·æ±‚delegate é€‰æ‹©æ­£ç¡®çš„æ•°æ®å­˜å‚¨é€‰é¡¹ NSUserDefaultsçš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿè™½ç„¶å®ƒå¾ˆniceä¹Ÿå¾ˆä¾¿æ·ï¼Œä½†æ˜¯å®ƒåªé€‚ç”¨äºå°æ•°æ®ï¼Œæ¯”å¦‚ä¸€äº›ç®€å•çš„å¸ƒå°”å‹çš„è®¾ç½®é€‰é¡¹ï¼Œå†å¤§ç‚¹ä½ å°±è¦è€ƒè™‘å…¶å®ƒæ–¹å¼äº† XMLè¿™ç§ç»“æ„åŒ–æ¡£æ¡ˆå‘¢ï¼Ÿæ€»ä½“æ¥è¯´ï¼Œä½ éœ€è¦è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜é‡Œå»è§£æï¼Œè¿™æ ·æ˜¯å¾ˆä¸ç»æµçš„ã€‚ä½¿ç”¨SAXåˆæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ã€‚ NSCodingï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¹Ÿéœ€è¦è¯»å†™æ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿæœ‰ä»¥ä¸Šé—®é¢˜ã€‚ åœ¨è¿™ç§åº”ç”¨åœºæ™¯ä¸‹ï¼Œä½¿ç”¨SQLite æˆ–è€… Core Dataæ¯”è¾ƒå¥½ã€‚ä½¿ç”¨è¿™äº›æŠ€æœ¯ä½ ç”¨ç‰¹å®šçš„æŸ¥è¯¢è¯­å¥å°±èƒ½åªåŠ è½½ä½ éœ€è¦çš„å¯¹è±¡ã€‚ åœ¨æ€§èƒ½å±‚é¢æ¥è®²ï¼ŒSQLiteå’ŒCore Dataæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚ä»–ä»¬çš„ä¸åŒåœ¨äºå…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚ Core Dataä»£è¡¨ä¸€ä¸ªå¯¹è±¡çš„graph modelï¼Œä½†SQLiteå°±æ˜¯ä¸€ä¸ªDBMSã€‚ Appleåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨Core Dataï¼Œä½†æ˜¯å¦‚æœä½ æœ‰ç†ç”±ä¸ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆå°±å»ä½¿ç”¨æ›´åŠ åº•å±‚çš„SQLiteå§ã€‚ å¦‚æœä½ ä½¿ç”¨SQLiteï¼Œä½ å¯ä»¥ç”¨FMDBè¿™ä¸ªåº“æ¥ç®€åŒ–SQLiteçš„æ“ä½œï¼Œè¿™æ ·ä½ å°±ä¸ç”¨èŠ±å¾ˆå¤šç»å†äº†è§£SQLiteçš„C APIäº†ã€‚ é«˜çº§ åŠ é€Ÿå¯åŠ¨æ—¶é—´ã€‚å¿«é€Ÿæ‰“å¼€appæ˜¯å¾ˆé‡è¦çš„ï¼Œç‰¹åˆ«æ˜¯ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰“å¼€å®ƒæ—¶ï¼Œå¯¹appæ¥è®²ï¼Œç¬¬ä¸€å°è±¡å¤ªå¤ªå¤ªé‡è¦äº†ã€‚ä½ èƒ½åšçš„å°±æ˜¯ä½¿å®ƒå°½å¯èƒ½åšæ›´å¤šçš„å¼‚æ­¥ä»»åŠ¡ï¼Œæ¯”å¦‚åŠ è½½è¿œç«¯æˆ–è€…æ•°æ®åº“æ•°æ®ï¼Œè§£ææ•°æ®ã€‚é¿å…è¿‡äºåºå¤§çš„XIBï¼Œå› ä¸ºä»–ä»¬æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸ŠåŠ è½½çš„ã€‚æ‰€ä»¥å°½é‡ä½¿ç”¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„Storyboardså§ï¼ä¸€å®šè¦æŠŠè®¾å¤‡ä»Xcodeæ–­å¼€æ¥æµ‹è¯•å¯åŠ¨é€Ÿåº¦ ä½¿ç”¨Autorelease Poolã€‚NSAutoreleasePool`è´Ÿè´£é‡Šæ”¾blockä¸­çš„autoreleased objectsã€‚ä¸€èˆ¬æƒ…å†µä¸‹å®ƒä¼šè‡ªåŠ¨è¢«UIKitè°ƒç”¨ã€‚ä½†æ˜¯æœ‰äº›çŠ¶å†µä¸‹ä½ ä¹Ÿéœ€è¦æ‰‹åŠ¨å»åˆ›å»ºå®ƒã€‚å‡å¦‚ä½ åˆ›å»ºå¾ˆå¤šä¸´æ—¶å¯¹è±¡ï¼Œä½ ä¼šå‘ç°å†…å­˜ä¸€ç›´åœ¨å‡å°‘ç›´åˆ°è¿™äº›å¯¹è±¡è¢«releaseçš„æ—¶å€™ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰å½“UIKitç”¨å…‰äº†autorelease poolçš„æ—¶å€™memoryæ‰ä¼šè¢«é‡Šæ”¾ã€‚æ¶ˆæ¯æ˜¯ä½ å¯ä»¥åœ¨ä½ è‡ªå·±çš„@autoreleasepoolé‡Œåˆ›å»ºä¸´æ—¶çš„å¯¹è±¡æ¥é¿å…è¿™ä¸ªè¡Œä¸ºã€‚ é€‰æ‹©æ˜¯å¦ç¼“å­˜å›¾ç‰‡ã€‚å¸¸è§çš„ä»bundleä¸­åŠ è½½å›¾ç‰‡çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ä¸ªæ˜¯ç”¨imageNamedï¼ŒäºŒæ˜¯ç”¨imageWithContentsOfFileï¼Œç¬¬ä¸€ç§æ¯”è¾ƒå¸¸è§ä¸€ç‚¹ã€‚ é¿å…æ—¥æœŸæ ¼å¼è½¬æ¢ã€‚å¦‚æœä½ è¦ç”¨NSDateFormatteræ¥å¤„ç†å¾ˆå¤šæ—¥æœŸæ ¼å¼ï¼Œåº”è¯¥å°å¿ƒä»¥å¾…ã€‚å°±åƒå…ˆå‰æåˆ°çš„ï¼Œä»»ä½•æ—¶å€™é‡ç”¨NSDateFormatterséƒ½æ˜¯ä¸€ä¸ªå¥½çš„å®è·µã€‚å¦‚æœä½ å¯ä»¥æ§åˆ¶ä½ æ‰€å¤„ç†çš„æ—¥æœŸæ ¼å¼ï¼Œå°½é‡é€‰æ‹©Unixæ—¶é—´æˆ³ã€‚ä½ å¯ä»¥æ–¹ä¾¿åœ°ä»æ—¶é—´æˆ³è½¬æ¢åˆ°NSDate: - (NSDate*)dateFromUnixTimestamp:(NSTimeInterval)timestamp { return[NSDate dateWithTimeIntervalSince1970:timestamp]; } è¿™æ ·ä¼šæ¯”ç”¨Cæ¥è§£ææ—¥æœŸå­—ç¬¦ä¸²è¿˜å¿«ï¼éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¸å¤šweb APIä¼šä»¥å¾®ç§’çš„å½¢å¼è¿”å›æ—¶é—´æˆ³ï¼Œå› ä¸ºè¿™ç§æ ¼å¼åœ¨javascriptä¸­æ›´æ–¹ä¾¿ä½¿ç”¨ã€‚è®°ä½ç”¨dateFromUnixTimestampä¹‹å‰é™¤ä»¥1000å°±å¥½äº†ã€‚ å¹³æ—¶ä½ æ˜¯å¦‚ä½•å¯¹ä»£ç è¿›è¡Œæ€§èƒ½ä¼˜åŒ–çš„ï¼Ÿ åˆ©ç”¨æ€§èƒ½åˆ†æå·¥å…·æ£€æµ‹ï¼ŒåŒ…æ‹¬é™æ€ Analyze å·¥å…·ï¼Œä»¥åŠè¿è¡Œæ—¶ Profile å·¥å…·ï¼Œé€šè¿‡Xcodeå·¥å…·æ ä¸­Product-&gt;Profileå¯ä»¥å¯åŠ¨,å¯åŠ¨åç•Œé¢å¦‚ä¸‹: image æ¯”å¦‚æµ‹è¯•ç¨‹åºå¯åŠ¨è¿è¡Œæ—¶é—´ï¼Œå½“ç‚¹å‡»Time Profileråº”ç”¨ç¨‹åºå¼€å§‹è¿è¡Œå.å°±èƒ½è·å–åˆ°æ•´ä¸ªåº”ç”¨ç¨‹åºè¿è¡Œæ¶ˆè€—æ—¶é—´åˆ†å¸ƒå’Œç™¾åˆ†æ¯”.ä¸ºäº†ä¿è¯æ•°æ®åˆ†æåœ¨ç»Ÿä¸€ä½¿ç”¨åœºæ™¯çœŸå®éœ€è¦æ³¨æ„ä¸€å®šè¦ä½¿ç”¨çœŸæœº,å› ä¸ºæ­¤æ—¶æ¨¡æ‹Ÿå™¨æ˜¯è¿è¡Œåœ¨Macä¸Šï¼Œè€ŒMacä¸Šçš„CPUå¾€å¾€æ¯”iOSè®¾å¤‡è¦å¿«ã€‚ ä¸ºäº†é˜²æ­¢ä¸€ä¸ªåº”ç”¨å ç”¨è¿‡å¤šçš„ç³»ç»Ÿèµ„æºï¼Œå¼€å‘iOSçš„è‹¹æœå·¥ç¨‹å¸ˆé—¨è®¾è®¡äº†ä¸€ä¸ªâ€œçœ‹é—¨ç‹—â€çš„æœºåˆ¶ã€‚åœ¨ä¸åŒçš„åœºæ™¯ä¸‹ï¼Œâ€œçœ‹é—¨ç‹—â€ä¼šç›‘æµ‹åº”ç”¨çš„æ€§èƒ½ã€‚å¦‚æœè¶…å‡ºäº†è¯¥åœºæ™¯æ‰€è§„å®šçš„è¿è¡Œæ—¶é—´ï¼Œâ€œçœ‹é—¨ç‹—â€å°±ä¼šå¼ºåˆ¶ç»ˆç»“è¿™ä¸ªåº”ç”¨çš„è¿›ç¨‹ã€‚å¼€å‘è€…ä»¬åœ¨crashlogé‡Œé¢ï¼Œä¼šçœ‹åˆ°è¯¸å¦‚0x8badf00dè¿™æ ·çš„é”™è¯¯ä»£ç ã€‚ ä¼˜åŒ–Table View æ­£ç¡®ä½¿ç”¨reuseIdentifieræ¥é‡ç”¨cells å°½é‡ä½¿æ‰€æœ‰çš„view opaqueï¼ŒåŒ…æ‹¬cellè‡ªèº« å¦‚æœcellå†…ç°å®çš„å†…å®¹æ¥è‡ªwebï¼Œä½¿ç”¨å¼‚æ­¥åŠ è½½ï¼Œç¼“å­˜è¯·æ±‚ç»“æœ å‡å°‘subviewsçš„æ•°é‡ å°½é‡ä¸é€‚ç”¨cellForRowAtIndexPath:ï¼Œå¦‚æœä½ éœ€è¦ç”¨åˆ°å®ƒï¼Œåªç”¨ä¸€æ¬¡ç„¶åç¼“å­˜ç»“æœ ä½¿ç”¨rowHeight, sectionFooterHeightå’Œ sectionHeaderHeightæ¥è®¾å®šå›ºå®šçš„é«˜ï¼Œä¸è¦è¯·æ±‚delegate UIImageåŠ è½½å›¾ç‰‡æ€§èƒ½é—®é¢˜ imagedNamedåˆå§‹åŒ– imageWithContentsOfFileåˆå§‹åŒ– imageNamedé»˜è®¤åŠ è½½å›¾ç‰‡æˆåŠŸåä¼šå†…å­˜ä¸­ç¼“å­˜å›¾ç‰‡,è¿™ä¸ªæ–¹æ³•ç”¨ä¸€ä¸ªæŒ‡å®šçš„åå­—åœ¨ç³»ç»Ÿç¼“å­˜ä¸­æŸ¥æ‰¾å¹¶è¿”å›ä¸€ä¸ªå›¾ç‰‡å¯¹è±¡.å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ç›¸åº”çš„å›¾ç‰‡å¯¹è±¡,åˆ™ä»æŒ‡å®šåœ°æ–¹åŠ è½½å›¾ç‰‡ç„¶åç¼“å­˜å¯¹è±¡ï¼Œå¹¶è¿”å›è¿™ä¸ªå›¾ç‰‡å¯¹è±¡. imageWithContentsOfFileåˆ™ä»…åªåŠ è½½å›¾ç‰‡,ä¸ç¼“å­˜. åŠ è½½ä¸€å¼ å¤§å›¾å¹¶ä¸”ä½¿ç”¨ä¸€æ¬¡ï¼Œç”¨imageWithContentsOfFileæ˜¯æœ€å¥½,è¿™æ ·CPUä¸éœ€è¦åšç¼“å­˜èŠ‚çº¦æ—¶é—´. ä½¿ç”¨åœºæ™¯éœ€è¦ç¼–ç¨‹æ—¶ï¼Œåº”è¯¥æ ¹æ®å®é™…åº”ç”¨åœºæ™¯åŠ ä»¥åŒºåˆ†ï¼ŒUIimageè™½å°ï¼Œä½†ä½¿ç”¨å…ƒç´ è¾ƒå¤šé—®é¢˜ä¼šæœ‰æ‰€å‡¸æ˜¾. ä¸è¦åœ¨viewWillAppear ä¸­åšè´¹æ—¶çš„æ“ä½œï¼šviewWillAppear: åœ¨viewæ˜¾ç¤ºä¹‹å‰è¢«è°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼Œæ–¹æ³•ä¸­ä¸è¦å¤„ç†å¤æ‚è´¹æ—¶æ“ä½œï¼›åœ¨è¯¥æ–¹æ³•è®¾ç½® view çš„æ˜¾ç¤ºå±æ€§ä¹‹ç±»çš„ç®€å•äº‹æƒ…ï¼Œæ¯”å¦‚èƒŒæ™¯è‰²ï¼Œå­—ä½“ç­‰ã€‚å¦åˆ™ï¼Œä¼šæ˜æ˜¾æ„Ÿè§‰åˆ° view æœ‰å¡é¡¿æˆ–è€…å»¶è¿Ÿã€‚ åœ¨æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨reuseIdentifierï¼štable viewç”¨ tableView:cellForRowAtIndexPath:ä¸ºrowsåˆ†é…cellsçš„æ—¶å€™ï¼Œå®ƒçš„æ•°æ®åº”è¯¥é‡ç”¨è‡ªUITableViewCellã€‚ å°½é‡æŠŠviewsè®¾ç½®ä¸ºé€æ˜ï¼šå¦‚æœä½ æœ‰é€æ˜çš„Viewsä½ åº”è¯¥è®¾ç½®å®ƒä»¬çš„opaqueå±æ€§ä¸ºYESã€‚ç³»ç»Ÿç”¨ä¸€ä¸ªæœ€ä¼˜çš„æ–¹å¼æ¸²æŸ“è¿™äº›viewsã€‚è¿™ä¸ªç®€å•çš„å±æ€§åœ¨IBæˆ–è€…ä»£ç é‡Œéƒ½å¯ä»¥è®¾å®šã€‚ é¿å…è¿‡äºåºå¤§çš„XIBï¼šå°½é‡ç®€å•çš„ä¸ºæ¯ä¸ªControlleré…ç½®ä¸€ä¸ªå•ç‹¬çš„XIBï¼Œå°½å¯èƒ½æŠŠä¸€ä¸ªView Controllerçš„viewå±‚æ¬¡ç»“æ„åˆ†æ•£åˆ°å•ç‹¬çš„XIBä¸­å», å½“ä½ åŠ è½½ä¸€ä¸ªå¼•ç”¨äº†å›¾ç‰‡æˆ–è€…å£°éŸ³èµ„æºçš„nibæ—¶ï¼ŒnibåŠ è½½ä»£ç ä¼šæŠŠå›¾ç‰‡å’Œå£°éŸ³æ–‡ä»¶å†™è¿›å†…å­˜ã€‚ ä¸è¦é˜»å¡ä¸»çº¿ç¨‹ï¼šæ°¸è¿œä¸è¦ä½¿ä¸»çº¿ç¨‹æ‰¿æ‹…è¿‡å¤šã€‚å› ä¸ºUIKitåœ¨ä¸»çº¿ç¨‹ä¸Šåšæ‰€æœ‰å·¥ä½œï¼Œæ¸²æŸ“ï¼Œç®¡ç†è§¦æ‘¸ååº”ï¼Œå›åº”è¾“å…¥ç­‰éƒ½éœ€è¦åœ¨å®ƒä¸Šé¢å®Œæˆ,å¤§éƒ¨åˆ†é˜»ç¢ä¸»è¿›ç¨‹çš„æƒ…å½¢æ˜¯ä½ çš„appåœ¨åšä¸€äº›ç‰µæ¶‰åˆ°è¯»å†™å¤–éƒ¨èµ„æºçš„I/Oæ“ä½œï¼Œæ¯”å¦‚å­˜å‚¨æˆ–è€…ç½‘ç»œã€‚ dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ // é€‰æ‹©ä¸€ä¸ªå­çº¿ç¨‹æ¥æ‰§è¡Œè€—æ—¶æ“ä½œ dispatch_async(dispatch_get_main_queue(), ^{ // è¿”å›ä¸»çº¿ç¨‹æ›´æ–°UI }); }); åœ¨Image Viewsä¸­è°ƒæ•´å›¾ç‰‡å¤§å° å¦‚æœè¦åœ¨UIImageViewä¸­æ˜¾ç¤ºä¸€ä¸ªæ¥è‡ªbundleçš„å›¾ç‰‡ï¼Œä½ åº”ä¿è¯å›¾ç‰‡çš„å¤§å°å’ŒUIImageViewçš„å¤§å°ç›¸åŒã€‚åœ¨è¿è¡Œä¸­ç¼©æ”¾å›¾ç‰‡æ˜¯å¾ˆè€—è´¹èµ„æºçš„. è®²è®²ä½ ç”¨Instrumentä¼˜åŒ–åŠ¨ç”»æ€§èƒ½çš„ç»å†å§ï¼ˆåˆ«é—®æˆ‘ä»€ä¹ˆæ˜¯Instrumentï¼‰Appleçš„instrumentä¸ºå¼€å‘è€…æä¾›äº†å„ç§templateå»ä¼˜åŒ–appæ€§èƒ½å’Œå®šä½é—®é¢˜ã€‚å¾ˆå¤šå…¬å¸éƒ½åœ¨èµ¶featureï¼Œå¹¶æ²¡æœ‰å……è¶³çš„æ—¶é—´æ¥åšä¼˜åŒ–ï¼Œå¯¼è‡´ä¸å°‘å¼€å‘è€…å¯¹instrumentä¸æ€ä¹ˆç†Ÿæ‚‰ã€‚ä½†è¿™é‡Œé¢å…¶å®æ¶µç›–äº†éå¸¸å®Œæ•´çš„è®¡ç®—æœºåŸºç¡€ç†è®ºçŸ¥è¯†ä½“ç³»ï¼Œmemoryï¼Œdiskï¼Œnetworkï¼Œthreadï¼Œcpuï¼Œgpuç­‰ç­‰ï¼Œé¡ºè—¤æ‘¸ç“œå»å­¦ä¹ ï¼Œæ˜¯ä¸€ç¬”å·¨å¤§çš„çŸ¥è¯†è´¢å¯Œã€‚åŠ¨ç”»æ€§èƒ½åªæ˜¯å…¶ä¸­ä¸€ä¸ªtemplateï¼Œé‡ç‚¹è¿˜æ˜¯ç†è§£ä¸Šé¢é—®é¢˜å½“ä¸­CPU GPUå¦‚ä½•é…åˆå·¥ä½œçš„çŸ¥è¯†ã€‚ facebookå¯åŠ¨æ—¶é—´ä¼˜åŒ–1.ç˜¦èº«è¯·æ±‚ä¾èµ– 2.UDPå¯åŠ¨è¯·æ±‚å…ˆè¡Œç¼“å­˜ 3.é˜Ÿåˆ—ä¸²è¡ŒåŒ–å¤„ç†å¯åŠ¨å“åº”]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜21--Runtime]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9821-Runtime%2F</url>
    <content type="text"><![CDATA[Runtimeæ˜¯ä»€ä¹ˆRuntime åˆå«è¿è¡Œæ—¶ï¼Œæ˜¯ä¸€å¥—åº•å±‚çš„ C è¯­è¨€ APIï¼Œå…¶ä¸º iOS å†…éƒ¨çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œæˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„ OC ä»£ç ï¼Œåº•å±‚éƒ½æ˜¯åŸºäºå®ƒæ¥å®ç°çš„ã€‚æ¯”å¦‚ï¼š [receiver message]; // åº•å±‚è¿è¡Œæ—¶ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸ºï¼š objc_msgSend(receiver, selector) // å¦‚æœå…¶è¿˜æœ‰å‚æ•°æ¯”å¦‚ï¼š [receiver message:(id)arg...]; // åº•å±‚è¿è¡Œæ—¶ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸ºï¼š objc_msgSend(receiver, selector, arg1, arg2, ...) ä¸ºä»€ä¹ˆéœ€è¦Runtime Objective-C æ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œå®ƒä¼šå°†ä¸€äº›å·¥ä½œæ”¾åœ¨ä»£ç è¿è¡Œæ—¶æ‰å¤„ç†è€Œå¹¶éç¼–è¯‘æ—¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰å¾ˆå¤šç±»å’Œæˆå‘˜å˜é‡åœ¨æˆ‘ä»¬ç¼–è¯‘çš„æ—¶æ˜¯ä¸çŸ¥é“çš„ï¼Œè€Œåœ¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„ä»£ç ä¼šè½¬æ¢æˆå®Œæ•´çš„ç¡®å®šçš„ä»£ç è¿è¡Œã€‚ å› æ­¤ï¼Œç¼–è¯‘å™¨æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿ(Runtime system)æ¥å¤„ç†ç¼–è¯‘åçš„ä»£ç ã€‚ Runtime åŸºæœ¬æ˜¯ç”¨ C å’Œæ±‡ç¼–å†™çš„ï¼Œç”±æ­¤å¯è§è‹¹æœä¸ºäº†åŠ¨æ€ç³»ç»Ÿçš„é«˜æ•ˆè€Œåšå‡ºçš„åŠªåŠ›ã€‚è‹¹æœå’Œ GNU å„è‡ªç»´æŠ¤ä¸€ä¸ªå¼€æºçš„ Runtime ç‰ˆæœ¬ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´éƒ½åœ¨åŠªåŠ›ä¿æŒä¸€è‡´ã€‚ Runtime çš„ä½œç”¨OC åœ¨ä¸‰ç§å±‚é¢ä¸Šä¸ Runtime ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼š 1.é€šè¿‡ Objective-C æºä»£ç  åªéœ€è¦ç¼–å†™ OC ä»£ç ï¼ŒRuntime ç³»ç»Ÿè‡ªåŠ¨åœ¨å¹•åæå®šä¸€åˆ‡ï¼Œè°ƒç”¨æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¼šå°† OC ä»£ç è½¬æ¢æˆè¿è¡Œæ—¶ä»£ç ï¼Œåœ¨è¿è¡Œæ—¶ç¡®å®šæ•°æ®ç»“æ„å’Œå‡½æ•°ã€‚ 2.é€šè¿‡ Foundation æ¡†æ¶çš„ NSObject ç±»å®šä¹‰çš„æ–¹æ³• Cocoa ç¨‹åºä¸­ç»å¤§éƒ¨åˆ†ç±»éƒ½æ˜¯ NSObject ç±»çš„å­ç±»ï¼Œæ‰€ä»¥éƒ½ç»§æ‰¿äº† NSObject çš„è¡Œä¸ºã€‚(NSProxy ç±»æ—¶ä¸ªä¾‹å¤–ï¼Œå®ƒæ˜¯ä¸ªæŠ½è±¡è¶…ç±») ä¸€äº›æƒ…å†µä¸‹ï¼ŒNSObject ç±»ä»…ä»…å®šä¹‰äº†å®ŒæˆæŸä»¶äº‹æƒ…çš„æ¨¡æ¿ï¼Œå¹¶æ²¡æœ‰æä¾›æ‰€éœ€è¦çš„ä»£ç ã€‚ä¾‹å¦‚ - descriptionæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ç±»å†…å®¹çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œè¯¥æ–¹æ³•ä¸»è¦ç”¨æ¥è°ƒè¯•ç¨‹åºã€‚NSObjectç±»å¹¶ä¸çŸ¥é“å­ç±»çš„å†…å®¹ï¼Œæ‰€ä»¥å®ƒåªæ˜¯è¿”å›ç±»çš„åå­—å’Œå¯¹è±¡çš„åœ°å€ï¼ŒNSObjectçš„å­ç±»å¯ä»¥é‡æ–°å®ç°ã€‚ è¿˜æœ‰ä¸€äº›NSObjectçš„æ–¹æ³•å¯ä»¥ä»Runtimeç³»ç»Ÿä¸­è·å–ä¿¡æ¯ï¼Œå…è®¸å¯¹è±¡è¿›è¡Œè‡ªæˆ‘æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼š -classæ–¹æ³•è¿”å›å¯¹è±¡çš„ç±»ï¼› -isKindOfClass: å’Œ -isMemberOfClass: æ–¹æ³•æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨äºæŒ‡å®šçš„ç±»çš„ç»§æ‰¿ä½“ç³»ä¸­(æ˜¯å¦æ˜¯å…¶å­ç±»æˆ–è€…çˆ¶ç±»æˆ–è€…å½“å‰ç±»çš„æˆå‘˜å˜é‡)ï¼› -respondsToSelector: æ£€æŸ¥å¯¹è±¡èƒ½å¦å“åº”æŒ‡å®šçš„æ¶ˆæ¯ï¼› -conformsToProtocol:æ£€æŸ¥å¯¹è±¡æ˜¯å¦å®ç°äº†æŒ‡å®šåè®®ç±»çš„æ–¹æ³•ï¼› -methodForSelector: è¿”å›æŒ‡å®šæ–¹æ³•å®ç°çš„åœ°å€ã€‚ 3.é€šè¿‡å¯¹ Runtime åº“å‡½æ•°çš„ç›´æ¥è°ƒç”¨ Runtime ç³»ç»Ÿæ˜¯å…·æœ‰å…¬å…±æ¥å£çš„åŠ¨æ€å…±äº«åº“ã€‚å¤´æ–‡ä»¶å­˜æ”¾äº/usr/include/objcç›®å½•ä¸‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨æ—¶åªéœ€è¦å¼•å…¥objc/Runtime.hå¤´æ–‡ä»¶å³å¯ã€‚ è®¸å¤šå‡½æ•°å¯ä»¥è®©ä½ ä½¿ç”¨çº¯ C ä»£ç æ¥å®ç° Objc ä¸­åŒæ ·çš„åŠŸèƒ½ã€‚é™¤éæ˜¯å†™ä¸€äº› Objc ä¸å…¶ä»–è¯­è¨€çš„æ¡¥æ¥æˆ–æ˜¯åº•å±‚çš„ debug å·¥ä½œï¼Œä½ åœ¨å†™ Objc ä»£ç æ—¶ä¸€èˆ¬ä¸ä¼šç”¨åˆ°è¿™äº› C è¯­è¨€å‡½æ•°ã€‚ Runtimeçš„ç›¸å…³æœ¯è¯­1.SEL å®ƒæ˜¯selectoråœ¨ Objc ä¸­çš„è¡¨ç¤º(Swift ä¸­æ˜¯ Selector ç±»)ã€‚selector æ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œå…¶å®ä½œç”¨å°±å’Œåå­—ä¸€æ ·ï¼Œæ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡äººåè¾¨åˆ«è°æ˜¯è°ï¼Œæ³¨æ„ Objc åœ¨ç›¸åŒçš„ç±»ä¸­ä¸ä¼šæœ‰å‘½åç›¸åŒçš„ä¸¤ä¸ªæ–¹æ³•ã€‚selector å¯¹æ–¹æ³•åè¿›è¡ŒåŒ…è£…ï¼Œä»¥ä¾¿æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚å®ƒçš„æ•°æ®ç»“æ„æ˜¯ï¼š typedef struct objc_selector *SEL; æˆ‘ä»¬å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸ªæ˜ å°„åˆ°æ–¹æ³•çš„ C å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥é€šè¿‡ Objc ç¼–è¯‘å™¨å™¨å‘½ä»¤@selector() æˆ–è€… Runtime ç³»ç»Ÿçš„ sel_registerName å‡½æ•°æ¥è·å–ä¸€ä¸ª SEL ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ã€‚ æ³¨æ„ï¼šä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•æ‰€å¯¹åº”çš„ selector æ˜¯ç›¸åŒçš„ï¼Œç”±äºå˜é‡çš„ç±»å‹ä¸åŒï¼Œæ‰€ä»¥ä¸ä¼šå¯¼è‡´å®ƒä»¬è°ƒç”¨æ–¹æ³•å®ç°æ··ä¹±ã€‚ 2.id id æ˜¯ä¸€ä¸ªå‚æ•°ç±»å‹ï¼Œå®ƒæ˜¯æŒ‡å‘æŸä¸ªç±»çš„å®ä¾‹çš„æŒ‡é’ˆã€‚å®šä¹‰å¦‚ä¸‹ï¼š typedef struct objc_object *id; struct objc_object { Class isa; }; ä»¥ä¸Šå®šä¹‰ï¼Œçœ‹åˆ° objc_object ç»“æ„ä½“åŒ…å«ä¸€ä¸ª isa æŒ‡é’ˆï¼Œæ ¹æ® isa æŒ‡é’ˆå°±å¯ä»¥æ‰¾åˆ°å¯¹è±¡æ‰€å±çš„ç±»ã€‚ æ³¨æ„ï¼šisa æŒ‡é’ˆåœ¨ä»£ç è¿è¡Œæ—¶å¹¶ä¸æ€»æŒ‡å‘å®ä¾‹å¯¹è±¡æ‰€å±çš„ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½ä¾é å®ƒæ¥ç¡®å®šç±»å‹ï¼Œè¦æƒ³ç¡®å®šç±»å‹è¿˜æ˜¯éœ€è¦ç”¨å¯¹è±¡çš„ -class æ–¹æ³•ã€‚PS:KVO çš„å®ç°æœºç†å°±æ˜¯å°†è¢«è§‚å¯Ÿå¯¹è±¡çš„ isa æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»è€Œä¸æ˜¯çœŸå®ç±»å‹ã€‚ 3.Class typedef struct objc_class *Class; Class å…¶å®æ˜¯æŒ‡å‘ objc_class ç»“æ„ä½“çš„æŒ‡é’ˆã€‚objc_class çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š struct objc_class { Class isa OBJC_ISA_AVAILABILITY; #if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; const char *name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; struct objc_method_list **methodLists OBJC2_UNAVAILABLE; struct objc_cache *cache OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE; #endif } OBJC2_UNAVAILABLE; ä» objc_class å¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªè¿è¡Œæ—¶ç±»ä¸­å…³è”äº†å®ƒçš„çˆ¶ç±»æŒ‡é’ˆã€ç±»åã€æˆå‘˜å˜é‡ã€æ–¹æ³•ã€ç¼“å­˜ä»¥åŠé™„å±çš„åè®®ã€‚ å…¶ä¸­ objc_ivar_list å’Œ objc_method_list åˆ†åˆ«æ˜¯æˆå‘˜å˜é‡åˆ—è¡¨å’Œæ–¹æ³•åˆ—è¡¨ï¼š // æˆå‘˜å˜é‡åˆ—è¡¨ struct objc_ivar_list { int ivar_count OBJC2_UNAVAILABLE; #ifdef __LP64__ int space OBJC2_UNAVAILABLE; #endif /* variable length structure */ struct objc_ivar ivar_list[1] OBJC2_UNAVAILABLE; } OBJC2_UNAVAILABLE; // æ–¹æ³•åˆ—è¡¨ struct objc_method_list { struct objc_method_list *obsolete OBJC2_UNAVAILABLE; int method_count OBJC2_UNAVAILABLE; #ifdef __LP64__ int space OBJC2_UNAVAILABLE; #endif /* variable length structure */ struct objc_method method_list[1] OBJC2_UNAVAILABLE; } ç”±æ­¤å¯è§ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€ä¿®æ”¹ *methodList çš„å€¼æ¥æ·»åŠ æˆå‘˜æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ Category å®ç°çš„åŸç†ï¼ŒåŒæ ·è§£é‡Šäº† Category ä¸èƒ½æ·»åŠ å±æ€§çš„åŸå› ã€‚ objc_ivar_list ç»“æ„ä½“ç”¨æ¥å­˜å‚¨æˆå‘˜å˜é‡çš„åˆ—è¡¨ï¼Œè€Œ objc_ivar åˆ™æ˜¯å­˜å‚¨äº†å•ä¸ªæˆå‘˜å˜é‡çš„ä¿¡æ¯ï¼›åŒç†ï¼Œobjc_method_list ç»“æ„ä½“å­˜å‚¨ç€æ–¹æ³•æ•°ç»„çš„åˆ—è¡¨ï¼Œè€Œå•ä¸ªæ–¹æ³•çš„ä¿¡æ¯åˆ™ç”± objc_method ç»“æ„ä½“å­˜å‚¨ã€‚ å€¼å¾—æ³¨æ„çš„æ—¶ï¼Œobjc_class ä¸­ä¹Ÿæœ‰ä¸€ä¸ª isa æŒ‡é’ˆï¼Œè¿™è¯´æ˜ Objc ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ä¸ºäº†å¤„ç†ç±»å’Œå¯¹è±¡çš„å…³ç³»ï¼ŒRuntime åº“åˆ›å»ºäº†ä¸€ç§å«åš Meta Class(å…ƒç±») çš„ä¸œè¥¿ï¼Œç±»å¯¹è±¡æ‰€å±çš„ç±»å°±å«åšå…ƒç±»ã€‚Meta Class è¡¨è¿°äº†ç±»å¯¹è±¡æœ¬èº«æ‰€å…·å¤‡çš„å…ƒæ•°æ®ã€‚ æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ç±»æ–¹æ³•ï¼Œå°±æºè‡ªäº Meta Classã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºç±»æ–¹æ³•å°±æ˜¯ç±»å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€‚æ¯ä¸ªç±»ä»…æœ‰ä¸€ä¸ªç±»å¯¹è±¡ï¼Œè€Œæ¯ä¸ªç±»å¯¹è±¡ä»…æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³çš„å…ƒç±»ã€‚ å½“ä½ å‘å‡ºä¸€ä¸ªç±»ä¼¼ [NSObject alloc](ç±»æ–¹æ³•) çš„æ¶ˆæ¯æ—¶ï¼Œå®é™…ä¸Šï¼Œè¿™ä¸ªæ¶ˆæ¯è¢«å‘é€ç»™äº†ä¸€ä¸ªç±»å¯¹è±¡(Class Object)ï¼Œè¿™ä¸ªç±»å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªå…ƒç±»çš„å®ä¾‹ï¼Œè€Œè¿™ä¸ªå…ƒç±»åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæ ¹å…ƒç±»(Root Meta Class)çš„å®ä¾‹ã€‚æ‰€æœ‰å…ƒç±»çš„ isa æŒ‡é’ˆæœ€ç»ˆéƒ½æŒ‡å‘æ ¹å…ƒç±»ã€‚ æ‰€ä»¥å½“ [NSObject alloc] è¿™æ¡æ¶ˆæ¯å‘é€ç»™ç±»å¯¹è±¡çš„æ—¶å€™ï¼Œè¿è¡Œæ—¶ä»£ç  objc_msgSend() ä¼šå»å®ƒå…ƒç±»ä¸­æŸ¥æ‰¾èƒ½å¤Ÿå“åº”æ¶ˆæ¯çš„æ–¹æ³•å®ç°ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ä¼šå¯¹è¿™ä¸ªç±»å¯¹è±¡æ‰§è¡Œæ–¹æ³•è°ƒç”¨ã€‚ æœ€å objc_class ä¸­è¿˜æœ‰ä¸€ä¸ª objc_cache ï¼Œç¼“å­˜ï¼Œå®ƒçš„ä½œç”¨å¾ˆé‡è¦ï¼Œåé¢ä¼šæåˆ°ã€‚ 4.Method Method ä»£è¡¨ç±»ä¸­æŸä¸ªæ–¹æ³•çš„ç±»å‹ typedef struct objc_method *Method; struct objc_method { SEL method_name OBJC2_UNAVAILABLE; char *method_types OBJC2_UNAVAILABLE; IMP method_imp OBJC2_UNAVAILABLE; } objc_method å­˜å‚¨äº†æ–¹æ³•åï¼Œæ–¹æ³•ç±»å‹å’Œæ–¹æ³•å®ç°ï¼š æ–¹æ³•åç±»å‹ä¸º SEL æ–¹æ³•ç±»å‹ method_types æ˜¯ä¸ª char æŒ‡é’ˆï¼Œå­˜å‚¨æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹ method_imp æŒ‡å‘äº†æ–¹æ³•çš„å®ç°ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ Ivar Ivar æ˜¯è¡¨ç¤ºæˆå‘˜å˜é‡çš„ç±»å‹ã€‚ typedef struct objc_ivar *Ivar; struct objc_ivar { char *ivar_name OBJC2_UNAVAILABLE; char *ivar_type OBJC2_UNAVAILABLE; int ivar_offset OBJC2_UNAVAILABLE; #ifdef __LP64__ int space OBJC2_UNAVAILABLE; #endif } å…¶ä¸­ ivar_offset æ˜¯åŸºåœ°å€åç§»å­—èŠ‚ 5.IMP IMPåœ¨objc.hä¸­çš„å®šä¹‰æ˜¯ï¼š typedef id (*IMP)(id, SEL, ...); å®ƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè¿™æ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ã€‚å½“ä½ å‘èµ·ä¸€ä¸ª ObjC æ¶ˆæ¯ä¹‹åï¼Œæœ€ç»ˆå®ƒä¼šæ‰§è¡Œçš„é‚£æ®µä»£ç ï¼Œå°±æ˜¯ç”±è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å®šçš„ã€‚è€Œ IMP è¿™ä¸ªå‡½æ•°æŒ‡é’ˆå°±æŒ‡å‘äº†è¿™ä¸ªæ–¹æ³•çš„å®ç°ã€‚ å¦‚æœå¾—åˆ°äº†æ‰§è¡ŒæŸä¸ªå®ä¾‹æŸä¸ªæ–¹æ³•çš„å…¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»•å¼€æ¶ˆæ¯ä¼ é€’é˜¶æ®µï¼Œç›´æ¥æ‰§è¡Œæ–¹æ³•ï¼Œè¿™åœ¨åé¢ Cache ä¸­ä¼šæåˆ°ã€‚ ä½ ä¼šå‘ç° IMP æŒ‡å‘çš„æ–¹æ³•ä¸ objc_msgSend å‡½æ•°ç±»å‹ç›¸åŒï¼Œå‚æ•°éƒ½åŒ…å« id å’Œ SEL ç±»å‹ã€‚æ¯ä¸ªæ–¹æ³•åéƒ½å¯¹åº”ä¸€ä¸ª SEL ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ï¼Œè€Œæ¯ä¸ªå®ä¾‹å¯¹è±¡ä¸­çš„ SEL å¯¹åº”çš„æ–¹æ³•å®ç°è‚¯å®šæ˜¯å”¯ä¸€çš„ï¼Œé€šè¿‡ä¸€ç»„ idå’Œ SEL å‚æ•°å°±èƒ½ç¡®å®šå”¯ä¸€çš„æ–¹æ³•å®ç°åœ°å€ã€‚ è€Œä¸€ä¸ªç¡®å®šçš„æ–¹æ³•ä¹Ÿåªæœ‰å”¯ä¸€çš„ä¸€ç»„ id å’Œ SEL å‚æ•°ã€‚ 6.Cache Cache å®šä¹‰å¦‚ä¸‹ï¼š typedef struct objc_cache *Cache struct objc_cache { unsigned int mask /* total = mask + 1 */ OBJC2_UNAVAILABLE; unsigned int occupied OBJC2_UNAVAILABLE; Method buckets[1] OBJC2_UNAVAILABLE; }; Cache ä¸ºæ–¹æ³•è°ƒç”¨çš„æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œæ¯å½“å®ä¾‹å¯¹è±¡æ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå®ƒä¸ä¼šç›´æ¥åœ¨ isa æŒ‡é’ˆæŒ‡å‘çš„ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­éå†æŸ¥æ‰¾èƒ½å¤Ÿå“åº”çš„æ–¹æ³•ï¼Œå› ä¸ºæ¯æ¬¡éƒ½è¦æŸ¥æ‰¾æ•ˆç‡å¤ªä½äº†ï¼Œè€Œæ˜¯ä¼˜å…ˆåœ¨ Cache ä¸­æŸ¥æ‰¾ã€‚ Runtime ç³»ç»Ÿä¼šæŠŠè¢«è°ƒç”¨çš„æ–¹æ³•å­˜åˆ° Cache ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒæœ‰å¯èƒ½ä»Šåè¿˜ä¼šè¢«è°ƒç”¨ï¼Œä¸‹æ¬¡æŸ¥æ‰¾çš„æ—¶å€™å°±ä¼šæ•ˆç‡æ›´é«˜ã€‚å°±åƒè®¡ç®—æœºç»„æˆåŸç†ä¸­ CPU ç»•è¿‡ä¸»å­˜å…ˆè®¿é—® Cache ä¸€æ ·ã€‚ 7.Property typedef struct objc_property *Property; typedef struct objc_property *objc_property_t;//è¿™ä¸ªæ›´å¸¸ç”¨ å¯ä»¥é€šè¿‡class_copyPropertyList å’Œ protocol_copyPropertyList æ–¹æ³•è·å–ç±»å’Œåè®®ä¸­çš„å±æ€§ï¼š objc_property_t *class_copyPropertyList(Class cls, unsigned int *outCount) objc_property_t *protocol_copyPropertyList(Protocol *proto, unsigned int *outCount) æ³¨æ„ï¼š è¿”å›çš„æ˜¯å±æ€§åˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª objc_property_t æŒ‡é’ˆ #import &lt;Foundation/Foundation.h&gt; @interface Person : NSObject /** å§“å */ @property (strong, nonatomic) NSString *name; /** age */ @property (assign, nonatomic) int age; /** weight */ @property (assign, nonatomic) double weight; @end ä»¥ä¸Šæ˜¯ä¸€ä¸ª Person ç±»ï¼Œæœ‰3ä¸ªå±æ€§ã€‚è®©æˆ‘ä»¬ç”¨ä¸Šè¿°æ–¹æ³•è·å–ç±»çš„è¿è¡Œæ—¶å±æ€§ã€‚ unsigned int outCount = 0; objc_property_t *properties = class_copyPropertyList([Person class], &amp;outCount); NSLog(@&quot;%d&quot;, outCount); for (NSInteger i = 0; i &lt; outCount; i++) { NSString *name = @(property_getName(properties[i])); NSString *attributes = @(property_getAttributes(properties[i])); NSLog(@&quot;%@--------%@&quot;, name, attributes); } æ‰“å°ç»“æœå¦‚ä¸‹ï¼š test[2321:451525] 3 test[2321:451525] name--------T@&quot;NSString&quot;,&amp;,N,V_name test[2321:451525] age--------Ti,N,V_age test[2321:451525] weight--------Td,N,V_weight property_getName ç”¨æ¥æŸ¥æ‰¾å±æ€§çš„åç§°ï¼Œè¿”å› c å­—ç¬¦ä¸²ã€‚property_getAttributes å‡½æ•°æŒ–æ˜å±æ€§çš„çœŸå®åç§°å’Œ @encode ç±»å‹ï¼Œè¿”å› c å­—ç¬¦ä¸²ã€‚ objc_property_t class_getProperty(Class cls, const char *name) objc_property_t protocol_getProperty(Protocol *proto, const char *name, BOOL isRequiredProperty, BOOL isInstanceProperty) class_getProperty å’Œ protocol_getProperty é€šè¿‡ç»™å‡ºå±æ€§ååœ¨ç±»å’Œåè®®ä¸­è·å¾—å±æ€§çš„å¼•ç”¨ã€‚ Runtimeä¸æ¶ˆæ¯ ä¸€äº› Runtime æœ¯è¯­è®²å®Œäº†ï¼Œæ¥ä¸‹æ¥å°±è¦è¯´åˆ°æ¶ˆæ¯äº†ã€‚ä½“ä¼šè‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­çš„ messages arenâ€™t bound to method implementations until Runtimeã€‚æ¶ˆæ¯ç›´åˆ°è¿è¡Œæ—¶æ‰ä¼šä¸æ–¹æ³•å®ç°è¿›è¡Œç»‘å®šã€‚ è¿™é‡Œè¦æ¸…æ¥šä¸€ç‚¹ï¼Œobjc_msgSend æ–¹æ³•çœ‹æ¸…æ¥å¥½åƒè¿”å›äº†æ•°æ®ï¼Œå…¶å®objc_msgSend ä»ä¸è¿”å›æ•°æ®ï¼Œè€Œæ˜¯ä½ çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶å®ç°è¢«è°ƒç”¨åæ‰ä¼šè¿”å›æ•°æ®ã€‚ä¸‹é¢è¯¦ç»†å™è¿°æ¶ˆæ¯å‘é€çš„æ­¥éª¤ï¼š é¦–å…ˆæ£€æµ‹è¿™ä¸ª selector æ˜¯ä¸æ˜¯è¦å¿½ç•¥ã€‚æ¯”å¦‚ Mac OS X å¼€å‘ï¼Œæœ‰äº†åƒåœ¾å›æ”¶å°±ä¸ç†ä¼š retainï¼Œrelease è¿™äº›å‡½æ•°ã€‚ æ£€æµ‹è¿™ä¸ª selector çš„ target æ˜¯ä¸æ˜¯ nilï¼ŒObjc å…è®¸æˆ‘ä»¬å¯¹ä¸€ä¸ª nil å¯¹è±¡æ‰§è¡Œä»»ä½•æ–¹æ³•ä¸ä¼š Crashï¼Œå› ä¸ºè¿è¡Œæ—¶ä¼šè¢«å¿½ç•¥æ‰ã€‚ å¦‚æœä¸Šé¢ä¸¤æ­¥éƒ½é€šè¿‡äº†ï¼Œé‚£ä¹ˆå°±å¼€å§‹æŸ¥æ‰¾è¿™ä¸ªç±»çš„å®ç° IMPï¼Œå…ˆä» cache é‡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±è¿è¡Œå¯¹åº”çš„å‡½æ•°å»æ‰§è¡Œç›¸åº”çš„ä»£ç ã€‚ å¦‚æœ cache æ‰¾ä¸åˆ°å°±æ‰¾ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„æ–¹æ³•ã€‚ å¦‚æœç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾ä¸åˆ°å°±åˆ°çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ° NSObject ç±»ä¸ºæ­¢ã€‚ å¦‚æœè¿˜æ‰¾ä¸åˆ°ï¼Œå°±è¦å¼€å§‹è¿›å…¥åŠ¨æ€æ–¹æ³•è§£æäº†ï¼Œåé¢ä¼šæåˆ°ã€‚ åœ¨æ¶ˆæ¯çš„ä¼ é€’ä¸­ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®æƒ…å†µåœ¨ objc_msgSend ï¼Œ objc_msgSend_stret ï¼Œ objc_msgSendSuper ï¼Œ objc_msgSendSuper_stret è¿™å››ä¸ªæ–¹æ³•ä¸­é€‰æ‹©ä¸€ä¸ªè°ƒç”¨ã€‚å¦‚æœæ¶ˆæ¯æ˜¯ä¼ é€’ç»™çˆ¶ç±»ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨åå­—å¸¦æœ‰ Super çš„å‡½æ•°ï¼Œå¦‚æœæ¶ˆæ¯è¿”å›å€¼æ˜¯æ•°æ®ç»“æ„è€Œä¸æ˜¯ç®€å•å€¼æ—¶ï¼Œä¼šè°ƒç”¨åå­—å¸¦æœ‰ stret çš„å‡½æ•°ã€‚ æ–¹æ³•ä¸­çš„éšè—å‚æ•°ç–‘é—®ï¼š æˆ‘ä»¬ç»å¸¸ç”¨åˆ°å…³é”®å­— self ï¼Œä½†æ˜¯ self æ˜¯å¦‚ä½•è·å–å½“å‰æ–¹æ³•çš„å¯¹è±¡å‘¢ï¼Ÿ å…¶å®ï¼Œè¿™ä¹Ÿæ˜¯ Runtime ç³»ç»Ÿçš„ä½œç”¨ï¼Œself å®åœ¨æ–¹æ³•è¿è¡Œæ—¶è¢«åŠ¨æ€ä¼ å…¥çš„ã€‚ å½“ objc_msgSend æ‰¾åˆ°æ–¹æ³•å¯¹åº”å®ç°æ—¶ï¼Œå®ƒå°†ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•å®ç°ï¼Œå¹¶å°†æ¶ˆæ¯ä¸­æ‰€æœ‰å‚æ•°éƒ½ä¼ é€’ç»™æ–¹æ³•å®ç°ï¼ŒåŒæ—¶ï¼Œå®ƒè¿˜å°†ä¼ é€’ä¸¤ä¸ªéšè—å‚æ•°ï¼š æ¥å—æ¶ˆæ¯çš„å¯¹è±¡(self æ‰€æŒ‡å‘çš„å†…å®¹ï¼Œå½“å‰æ–¹æ³•çš„å¯¹è±¡æŒ‡é’ˆ) æ–¹æ³•é€‰æ‹©å™¨(_cmd æŒ‡å‘çš„å†…å®¹ï¼Œå½“å‰æ–¹æ³•çš„ SEL æŒ‡é’ˆ) å› ä¸ºåœ¨æºä»£ç æ–¹æ³•çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å‘ç°è¿™ä¸¤ä¸ªå‚æ•°çš„å£°æ˜ã€‚å®ƒä»¬æ—¶åœ¨ä»£ç è¢«ç¼–è¯‘æ—¶è¢«æ’å…¥æ–¹æ³•å®ç°ä¸­çš„ã€‚å°½ç®¡è¿™äº›å‚æ•°æ²¡æœ‰è¢«æ˜ç¡®å£°æ˜ï¼Œåœ¨æºä»£ç ä¸­æˆ‘ä»¬ä»ç„¶å¯ä»¥å¼•ç”¨å®ƒä»¬ã€‚ è¿™ä¸¤ä¸ªå‚æ•°ä¸­ï¼Œ selfæ›´å®ç”¨ã€‚å®ƒæ˜¯åœ¨æ–¹æ³•å®ç°ä¸­è®¿é—®æ¶ˆæ¯æ¥æ”¶è€…å¯¹è±¡çš„å®ä¾‹å˜é‡çš„é€”å¾„ã€‚ è¿™æ—¶æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°å¦ä¸€ä¸ªå…³é”®å­— super ï¼Œå®é™…ä¸Š super å…³é”®å­—æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåˆ›å»ºä¸€ä¸ª objc_super ç»“æ„ä½“ï¼š struct objc_super { id receiver; Class class; }; è¿™ä¸ªç»“æ„ä½“æŒ‡æ˜äº†æ¶ˆæ¯åº”è¯¥è¢«ä¼ é€’ç»™ç‰¹å®šçš„çˆ¶ç±»ã€‚ receiver ä»ç„¶æ˜¯ self æœ¬èº«ï¼Œå½“æˆ‘ä»¬æƒ³é€šè¿‡ [super class] è·å–çˆ¶ç±»æ—¶ï¼Œç¼–è¯‘å™¨å…¶å®æ˜¯å°†æŒ‡å‘ self çš„ id æŒ‡é’ˆå’Œ class çš„ SEL ä¼ é€’ç»™äº† objc_msgSendSuper å‡½æ•°ã€‚åªæœ‰åœ¨ NSObject ç±»ä¸­æ‰èƒ½æ‰¾åˆ° class æ–¹æ³•ï¼Œç„¶å class æ–¹æ³•åº•å±‚è¢«è½¬æ¢ä¸º object_getClass()ï¼Œ æ¥ç€åº•å±‚ç¼–è¯‘å™¨å°†ä»£ç è½¬æ¢ä¸º objc_msgSend(objc_super-&gt;receiver, @selector(class))ï¼Œä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å‘ self çš„ id æŒ‡é’ˆï¼Œä¸è°ƒç”¨ [self class] ç›¸åŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°çš„æ°¸è¿œéƒ½æ˜¯ self çš„ç±»å‹ã€‚å› æ­¤ä½ ä¼šå‘ç°ï¼š // è¿™å¥è¯å¹¶ä¸èƒ½è·å–çˆ¶ç±»çš„ç±»å‹ï¼Œåªèƒ½è·å–å½“å‰ç±»çš„ç±»å‹å NSLog(@&quot;%@&quot;, NSStringFromClass([super class])); è·å–æ–¹æ³•åœ°å€ NSObject ç±»ä¸­æœ‰ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼šmethodForSelectorï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥è·å–æŸä¸ªæ–¹æ³•é€‰æ‹©å™¨å¯¹åº”çš„ IMP ï¼Œä¸¾ä¸ªä¾‹å­ï¼š void (*setter)(id, SEL, BOOL); int i; setter = (void (*)(id, SEL, BOOL))[target methodForSelector:@selector(setFilled:)]; for ( i = 0 ; i &lt; 1000 ; i++ ) setter(targetList[i], @selector(setFilled:), YES); å½“æ–¹æ³•è¢«å½“åšå‡½æ•°è°ƒç”¨æ—¶ï¼Œä¸¤ä¸ªéšè—å‚æ•°ä¹Ÿå¿…é¡»æ˜ç¡®ç»™å‡ºï¼Œä¸Šé¢çš„ä¾‹å­è°ƒç”¨äº†1000æ¬¡å‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥å°è¯•ç»™ target å‘é€1000æ¬¡ setFilled: æ¶ˆæ¯ä¼šèŠ±å¤šä¹…ã€‚ è™½ç„¶å¯ä»¥æ›´é«˜æ•ˆçš„è°ƒç”¨æ–¹æ³•ï¼Œä½†æ˜¯è¿™ç§åšæ³•å¾ˆå°‘ç”¨ï¼Œé™¤éæ—¶éœ€è¦æŒç»­å¤§é‡é‡å¤è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æƒ…å†µï¼Œæ‰ä¼šé€‰æ‹©ä½¿ç”¨ä»¥å…æ¶ˆæ¯å‘é€æ³›æ»¥ã€‚ æ³¨æ„ï¼š methodForSelector:æ–¹æ³•æ˜¯ç”± Runtime ç³»ç»Ÿæä¾›çš„ï¼Œè€Œä¸æ˜¯ Objc è‡ªèº«çš„ç‰¹æ€§ åŠ¨æ€æ–¹æ³•è§£æ ä½ å¯ä»¥åŠ¨æ€æä¾›ä¸€ä¸ªæ–¹æ³•å®ç°ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨å…³é”®å­— @dynamic åœ¨ç±»çš„å®ç°æ–‡ä»¶ä¸­ä¿®é¥°ä¸€ä¸ªå±æ€§ï¼Œè¡¨æ˜æˆ‘ä»¬ä¼šä¸ºè¿™ä¸ªå±æ€§åŠ¨æ€æä¾›å­˜å–æ–¹æ³•ï¼Œç¼–è¯‘å™¨ä¸ä¼šå†é»˜è®¤ä¸ºæˆ‘ä»¬ç”Ÿæˆè¿™ä¸ªå±æ€§çš„ setter å’Œ getter æ–¹æ³•äº†ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±æä¾›ã€‚ @dynamic propertyName; è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ†åˆ«é‡è½½ resolveInstanceMethod: å’Œ resolveClassMethod: æ–¹æ³•æ·»åŠ å®ä¾‹æ–¹æ³•å®ç°å’Œç±»æ–¹æ³•å®ç°ã€‚ å½“ Runtime ç³»ç»Ÿåœ¨ Cache å’Œç±»çš„æ–¹æ³•åˆ—è¡¨(åŒ…æ‹¬çˆ¶ç±»)ä¸­æ‰¾ä¸åˆ°è¦æ‰§è¡Œçš„æ–¹æ³•æ—¶ï¼ŒRuntime ä¼šè°ƒç”¨ resolveInstanceMethod: æˆ– resolveClassMethod: æ¥ç»™æˆ‘ä»¬ä¸€æ¬¡åŠ¨æ€æ·»åŠ æ–¹æ³•å®ç°çš„æœºä¼šã€‚æˆ‘ä»¬éœ€è¦ç”¨ class_addMethod å‡½æ•°å®Œæˆå‘ç‰¹å®šç±»æ·»åŠ ç‰¹å®šæ–¹æ³•å®ç°çš„æ“ä½œï¼š void dynamicMethodIMP(id self, SEL _cmd) { // implementation .... } @implementation MyClass + (BOOL)resolveInstanceMethod:(SEL)aSEL { if (aSEL == @selector(resolveThisMethodDynamically)) { class_addMethod([self class], aSEL, (IMP) dynamicMethodIMP, &quot;v@:&quot;); return YES; } return [super resolveInstanceMethod:aSEL]; } @end ä¸Šé¢çš„ä¾‹å­ä¸º resolveThisMethodDynamically æ–¹æ³•æ·»åŠ äº†å®ç°å†…å®¹ï¼Œå°±æ˜¯ dynamicMethodIMP æ–¹æ³•ä¸­çš„ä»£ç ã€‚å…¶ä¸­ &quot;v@:&quot; è¡¨ç¤ºè¿”å›å€¼å’Œå‚æ•°ï¼Œè¿™ä¸ªç¬¦å·è¡¨ç¤ºçš„å«ä¹‰è§ï¼šType Encoding æ³¨æ„ï¼š åŠ¨æ€æ–¹æ³•è§£æä¼šåœ¨æ¶ˆæ¯è½¬å‘æœºåˆ¶ä¾µå…¥å‰æ‰§è¡Œï¼ŒåŠ¨æ€æ–¹æ³•è§£æå™¨å°†ä¼šé¦–å…ˆç»™äºˆæä¾›è¯¥æ–¹æ³•é€‰æ‹©å™¨å¯¹åº”çš„ IMP çš„æœºä¼šã€‚å¦‚æœä½ æƒ³è®©è¯¥æ–¹æ³•é€‰æ‹©å™¨è¢«ä¼ é€åˆ°è½¬å‘æœºåˆ¶ï¼Œå°±è®© resolveInstanceMethod: æ–¹æ³•è¿”å› NOã€‚ æ¶ˆæ¯è½¬å‘1.é‡å®šå‘ æ¶ˆæ¯è½¬å‘æœºåˆ¶æ‰§è¡Œå‰ï¼ŒRuntime ç³»ç»Ÿå…è®¸æˆ‘ä»¬æ›¿æ¢æ¶ˆæ¯çš„æ¥æ”¶è€…ä¸ºå…¶ä»–å¯¹è±¡ã€‚é€šè¿‡ - (id)forwardingTargetForSelector:(SEL)aSelector æ–¹æ³•ã€‚ - (id)forwardingTargetForSelector:(SEL)aSelector { if(aSelector == @selector(mysteriousMethod:)){ return alternateObject; } return [super forwardingTargetForSelector:aSelector]; } å¦‚æœæ­¤æ–¹æ³•è¿”å› nil æˆ–è€… selfï¼Œåˆ™ä¼šè®¡å…¥æ¶ˆæ¯è½¬å‘æœºåˆ¶(forwardInvocation:)ï¼Œå¦åˆ™å°†å‘è¿”å›çš„å¯¹è±¡é‡æ–°å‘é€æ¶ˆæ¯ã€‚ 2.è½¬å‘ å½“åŠ¨æ€æ–¹æ³•è§£æä¸åšå¤„ç†è¿”å› NO æ—¶ï¼Œåˆ™ä¼šè§¦å‘æ¶ˆæ¯è½¬å‘æœºåˆ¶ã€‚è¿™æ—¶ forwardInvocation: æ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•æ¥è‡ªå®šä¹‰æˆ‘ä»¬çš„è½¬å‘é€»è¾‘ï¼š - (void)forwardInvocation:(NSInvocation *)anInvocation { if ([someOtherObject respondsToSelector: [anInvocation selector]]) [anInvocation invokeWithTarget:someOtherObject]; else [super forwardInvocation:anInvocation]; } å”¯ä¸€å‚æ•°æ˜¯ä¸ª NSInvocation ç±»å‹çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°è£…äº†åŸå§‹çš„æ¶ˆæ¯å’Œæ¶ˆæ¯çš„å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥å®ç° forwardInvocation: æ–¹æ³•æ¥å¯¹ä¸èƒ½å¤„ç†çš„æ¶ˆæ¯åšä¸€äº›å¤„ç†ã€‚ä¹Ÿå¯ä»¥å°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡å¤„ç†ï¼Œè€Œä¸æŠ›å‡ºé”™è¯¯ã€‚ æ³¨æ„ï¼šå‚æ•° anInvocation æ˜¯ä»å“ªæ¥çš„ï¼Ÿ åœ¨ forwardInvocation: æ¶ˆæ¯å‘é€å‰ï¼ŒRuntime ç³»ç»Ÿä¼šå‘å¯¹è±¡å‘é€methodSignatureForSelector: æ¶ˆæ¯ï¼Œå¹¶å–åˆ°è¿”å›çš„æ–¹æ³•ç­¾åç”¨äºç”Ÿæˆ NSInvocation å¯¹è±¡ã€‚æ‰€ä»¥é‡å†™ forwardInvocation: çš„åŒæ—¶ä¹Ÿè¦é‡å†™ methodSignatureForSelector: æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚ å½“ä¸€ä¸ªå¯¹è±¡ç”±äºæ²¡æœ‰ç›¸åº”çš„æ–¹æ³•å®ç°è€Œæ— æ³•ç›¸åº”æŸæ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿå°†é€šè¿‡ forwardInvocation: æ¶ˆæ¯é€šçŸ¥è¯¥å¯¹è±¡ã€‚æ¯ä¸ªå¯¹è±¡éƒ½ç»§æ‰¿äº† forwardInvocation: æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œ NSObject ä¸­çš„æ–¹æ³•å®ç°åªæ˜¯ç®€å•çš„è°ƒç”¨äº† doesNotRecognizeSelector:ã€‚é€šè¿‡å®ç°è‡ªå·±çš„ forwardInvocation: æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚ forwardInvocation: æ–¹æ³•å°±æ˜¯ä¸€ä¸ªä¸èƒ½è¯†åˆ«æ¶ˆæ¯çš„åˆ†å‘ä¸­å¿ƒï¼Œå°†è¿™äº›ä¸èƒ½è¯†åˆ«çš„æ¶ˆæ¯è½¬å‘ç»™ä¸åŒçš„æ¥æ”¶å¯¹è±¡ï¼Œæˆ–è€…è½¬å‘ç»™åŒä¸€ä¸ªå¯¹è±¡ï¼Œå†æˆ–è€…å°†æ¶ˆæ¯ç¿»è¯‘æˆå¦å¤–çš„æ¶ˆæ¯ï¼Œäº¦æˆ–è€…ç®€å•çš„â€œåƒæ‰â€æŸäº›æ¶ˆæ¯ï¼Œå› æ­¤æ²¡æœ‰å“åº”ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚è¿™ä¸€åˆ‡éƒ½å–å†³äºæ–¹æ³•çš„å…·ä½“å®ç°ã€‚ æ³¨æ„ï¼š forwardInvocation:æ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯æ¥æ”¶å¯¹è±¡ä¸­æ— æ³•æ­£å¸¸å“åº”æ¶ˆæ¯æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å‘å¾€ä¸€ä¸ªå¯¹è±¡å°†ä¸€ä¸ªæ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡æ—¶ï¼Œè¦ç¡®ä¿è¿™ä¸ªå¯¹è±¡ä¸èƒ½æœ‰è¯¥æ¶ˆæ¯çš„æ‰€å¯¹åº”çš„æ–¹æ³•ã€‚å¦åˆ™ï¼ŒforwardInvocation:å°†ä¸å¯èƒ½è¢«è°ƒç”¨ã€‚ è½¬å‘å’Œå¤šç»§æ‰¿ è½¬å‘å’Œç»§æ‰¿ç›¸ä¼¼ï¼Œå¯ç”¨äºä¸º Objc ç¼–ç¨‹æ·»åŠ ä¸€äº›å¤šç»§æ‰¿çš„æ•ˆæœã€‚å°±åƒä¸‹å›¾é‚£æ ·ï¼Œä¸€ä¸ªå¯¹è±¡æŠŠæ¶ˆæ¯è½¬å‘å‡ºå»ï¼Œå°±å¥½åƒå®ƒæŠŠå¦ä¸€ä¸ªå¯¹è±¡ä¸­çš„æ–¹æ³•æ¥è¿‡æ¥æˆ–è€…â€œç»§æ‰¿â€è¿‡æ¥ä¸€æ ·ã€‚ è¿™ä½¿å¾—åœ¨ä¸åŒç»§æ‰¿ä½“ç³»åˆ†æ”¯ä¸‹çš„ä¸¤ä¸ªç±»å¯ä»¥å®ç°â€œç»§æ‰¿â€å¯¹æ–¹çš„æ–¹æ³•ï¼Œåœ¨ä¸Šå›¾ä¸­ Warrior å’Œ Diplomat æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œä½†æ˜¯ Warrior å°† negotiate æ¶ˆæ¯è½¬å‘ç»™äº† Diplomat åï¼Œå°±å¥½ä¼¼ Diplomat æ˜¯ Warrior çš„è¶…ç±»ä¸€æ ·ã€‚ æ¶ˆæ¯è½¬å‘å¼¥è¡¥äº† Objc ä¸æ”¯æŒå¤šç»§æ‰¿çš„æ€§è´¨ï¼Œä¹Ÿé¿å…äº†å› ä¸ºå¤šç»§æ‰¿å¯¼è‡´å•ä¸ªç±»å˜å¾—è‡ƒè‚¿å¤æ‚ã€‚ è½¬å‘ä¸ç»§æ‰¿è™½ç„¶è½¬å‘å¯ä»¥å®ç°ç»§æ‰¿çš„åŠŸèƒ½ï¼Œä½†æ˜¯ NSObject è¿˜æ˜¯å¿…é¡»è¡¨é¢ä¸Šå¾ˆä¸¥è°¨ï¼Œåƒ respondsToSelector: å’Œ isKindOfClass: è¿™ç±»æ–¹æ³•åªä¼šè€ƒè™‘ç»§æ‰¿ä½“ç³»ï¼Œä¸ä¼šè€ƒè™‘è½¬å‘é“¾ã€‚ Warrior å¯¹è±¡è¢«é—®åˆ°æ˜¯å¦èƒ½å“åº” negotiateæ¶ˆæ¯ï¼š if ( [aWarrior respondsToSelector:@selector(negotiate)] ) ... å›ç­”å½“ç„¶æ˜¯ NOï¼Œ å°½ç®¡å®ƒèƒ½æ¥å— negotiate æ¶ˆæ¯è€Œä¸æŠ¥é”™ï¼Œå› ä¸ºå®ƒé è½¬å‘æ¶ˆæ¯ç»™ Diplomat ç±»å“åº”æ¶ˆæ¯ã€‚ å¦‚æœä½ å°±æ˜¯æƒ³è¦è®©åˆ«äººä»¥ä¸º Warrior ç»§æ‰¿åˆ°äº† Diplomat çš„ negotiate æ–¹æ³•ï¼Œä½ å¾—é‡æ–°å®ç° respondsToSelector: å’Œ isKindOfClass: æ¥åŠ å…¥ä½ çš„è½¬å‘ç®—æ³•ï¼š - (BOOL)respondsToSelector:(SEL)aSelector { if ( [super respondsToSelector:aSelector] ) return YES; else { /* Here, test whether the aSelector message can * * be forwarded to another object and whether that * * object can respond to it. Return YES if it can. */ } return NO; } é™¤äº† respondsToSelector: å’Œ isKindOfClass: ä¹‹å¤–ï¼ŒinstancesRespondToSelector: ä¸­ä¹Ÿåº”è¯¥å†™ä¸€ä»½è½¬å‘ç®—æ³•ã€‚å¦‚æœä½¿ç”¨äº†åè®®ï¼ŒconformsToProtocol: åŒæ ·ä¹Ÿè¦åŠ å…¥åˆ°è¿™ä¸€è¡Œåˆ—ä¸­ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æƒ³è¦è½¬å‘å®ƒæ¥å—çš„ä»»ä½•è¿œç¨‹æ¶ˆæ¯ï¼Œå®ƒå¾—ç»™å‡ºä¸€ä¸ªæ–¹æ³•æ ‡ç­¾æ¥è¿”å›å‡†ç¡®çš„æ–¹æ³•æè¿° methodSignatureForSelector:ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šæœ€ç»ˆå“åº”è¢«è½¬å‘çš„æ¶ˆæ¯ã€‚ä»è€Œç”Ÿæˆä¸€ä¸ªç¡®å®šçš„ NSInvocation å¯¹è±¡æè¿°æ¶ˆæ¯å’Œæ¶ˆæ¯å‚æ•°ã€‚è¿™ä¸ªæ–¹æ³•æœ€ç»ˆå“åº”è¢«è½¬å‘çš„æ¶ˆæ¯ã€‚å®ƒéœ€è¦åƒä¸‹é¢è¿™æ ·å®ç°ï¼š - (NSMethodSignature*)methodSignatureForSelector:(SEL)selector { NSMethodSignature* signature = [super methodSignatureForSelector:selector]; if (!signature) { signature = [surrogate methodSignatureForSelector:selector]; } return signature; } å¥å£®çš„å®ä¾‹å˜é‡(Non Fragile ivars)åœ¨ Runtime çš„ç°è¡Œç‰ˆæœ¬ä¸­ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¥å£®çš„å®ä¾‹å˜é‡äº†ã€‚å½“ä¸€ä¸ªç±»è¢«ç¼–è¯‘æ—¶ï¼Œå®ä¾‹å˜é‡çš„å†…å­˜å¸ƒå±€å°±å½¢æˆäº†ï¼Œå®ƒè¡¨æ˜è®¿é—®ç±»çš„å®ä¾‹å˜é‡çš„ä½ç½®ã€‚å®ä¾‹å˜é‡ä¸€æ¬¡æ ¹æ®è‡ªå·±æ‰€å ç©ºé—´è€Œäº§ç”Ÿä½ç§»ï¼š ä¸Šå›¾å·¦æ˜¯ NSObject ç±»çš„å®ä¾‹å˜é‡å¸ƒå±€ã€‚å³è¾¹æ˜¯æˆ‘ä»¬å†™çš„ç±»çš„å¸ƒå±€ã€‚è¿™æ ·å­æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºé™·ï¼Œå°±æ˜¯ç¼ºä¹æ‹“å±•æ€§ã€‚å“ªå¤©è‹¹æœæ›´æ–°äº† NSObject ç±»çš„è¯ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼š æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»çš„åŒºåŸŸå’Œçˆ¶ç±»çš„åŒºåŸŸé‡å äº†ã€‚åªæœ‰è‹¹æœå°†çˆ¶ç±»æ”¹ä¸ºä»¥å‰çš„å¸ƒå±€æ‰èƒ½æ‹¯æ•‘æˆ‘ä»¬ï¼Œä½†è¿™æ ·å¯¼è‡´å®ƒä»¬ä¸èƒ½å†æ‹“å±•å®ƒä»¬çš„æ¡†æ¶äº†ï¼Œå› ä¸ºæˆå‘˜å˜é‡å¸ƒå±€è¢«å›ºå®šä½äº†ã€‚åœ¨è„†å¼±çš„å®ä¾‹å˜é‡(Fragile ivar)ç¯å¢ƒä¸‹ï¼Œéœ€è¦æˆ‘ä»¬é‡æ–°ç¼–è¯‘ç»§æ‰¿è‡ª Apple çš„ç±»æ¥æ¢å¤å…¼å®¹ã€‚å¦‚æœæ˜¯å¥å£®çš„å®ä¾‹å˜é‡çš„è¯ï¼Œå¦‚ä¸‹å›¾ï¼š åœ¨å¥å£®çš„å®ä¾‹å˜é‡ä¸‹ï¼Œç¼–è¯‘å™¨ç”Ÿæˆçš„å®ä¾‹å˜é‡å¸ƒå±€è·Ÿä»¥å‰ä¸€æ ·ï¼Œä½†æ˜¯å½“ Runtime ç³»ç»Ÿæ£€æµ‹åˆ°ä¸çˆ¶ç±»æœ‰éƒ¨åˆ†é‡å æ—¶å®ƒä¼šè°ƒæ•´ä½ æ–°æ·»åŠ çš„å®ä¾‹å˜é‡çš„ä½ç§»ï¼Œé‚£æ ·ä½ å†å­ç±»ä¸­æ–°æ·»åŠ çš„æˆå‘˜å˜é‡å°±è¢«ä¿æŠ¤èµ·æ¥äº†ã€‚ æ³¨æ„ï¼š åœ¨å¥å£®çš„å®ä¾‹å˜é‡ä¸‹ï¼Œä¸è¦ä½¿ç”¨ siof(SomeClass)ï¼Œè€Œæ˜¯ç”¨ class_getInstanceSize([SomeClass class]) ä»£æ›¿ï¼›ä¹Ÿä¸è¦ä½¿ç”¨ offsetof(SomeClass, SomeIvar)ï¼Œè€Œè¦ä½¿ç”¨ ivar_getOffset(class_getInstanceVariable([SomeClass class], &quot;SomeIvar&quot;)) æ¥ä»£æ›¿ã€‚ æ€»ç»“ æˆ‘ä»¬è®©è‡ªå·±çš„ç±»ç»§æ‰¿è‡ª NSObject ä¸ä»…ä»…æ˜¯å› ä¸ºåŸºç±»æœ‰å¾ˆå¤šå¤æ‚çš„å†…å­˜åˆ†é…é—®é¢˜ï¼Œæ›´æ˜¯å› ä¸ºè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥äº«å—åˆ° Runtime ç³»ç»Ÿå¸¦æ¥çš„ä¾¿åˆ©ã€‚ è™½ç„¶å¹³æ—¶æˆ‘ä»¬å¾ˆå°‘ä¼šè€ƒè™‘ä¸€å¥ç®€å•çš„è°ƒç”¨æ–¹æ³•ï¼Œå‘é€æ¶ˆæ¯åº•å±‚æ‰€åšçš„å¤æ‚çš„æ“ä½œï¼Œä½†æ·±å…¥ç†è§£ Runtime ç³»ç»Ÿçš„ç»†èŠ‚ä½¿å¾—æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¶ˆæ¯æœºåˆ¶å†™å‡ºåŠŸèƒ½æ›´å¼ºå¤§çš„ä»£ç ã€‚ runtimeå®ç°çš„æœºåˆ¶æ˜¯ä»€ä¹ˆ,æ€ä¹ˆç”¨ï¼Œä¸€èˆ¬ç”¨äºå¹²å˜›. ä½ è¿˜èƒ½è®°å¾—ä½ æ‰€ä½¿ç”¨çš„ç›¸å…³çš„å¤´æ–‡ä»¶æˆ–è€…æŸäº›æ–¹æ³•çš„åç§°å—ï¼Ÿ éœ€è¦å¯¼å…¥&lt;objc/message.h&gt;&lt;objc/runtime.h&gt; runtimeï¼Œè¿è¡Œæ—¶æœºåˆ¶ï¼Œå®ƒæ˜¯ä¸€å¥—Cè¯­è¨€åº“ å®é™…ä¸Šæˆ‘ä»¬ç¼–å†™çš„æ‰€æœ‰OCä»£ç ï¼Œæœ€ç»ˆéƒ½æ˜¯è½¬æˆäº†runtimeåº“çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ç±»è½¬æˆäº†runtimeåº“é‡Œé¢çš„ç»“æ„ä½“ç­‰æ•°æ®ç±»å‹ï¼Œæ–¹æ³•è½¬æˆäº†runtimeåº“é‡Œé¢çš„Cè¯­è¨€å‡½æ•°ï¼Œå¹³æ—¶è°ƒæ–¹æ³•éƒ½æ˜¯è½¬æˆäº†objc_msgSendå‡½æ•°ï¼ˆæ‰€ä»¥è¯´OCæœ‰ä¸ªæ¶ˆæ¯å‘é€æœºåˆ¶ï¼‰ å› æ­¤ï¼Œå¯ä»¥è¯´runtimeæ˜¯OCçš„åº•å±‚å®ç°ï¼Œæ˜¯OCçš„å¹•åæ‰§è¡Œè€… æœ‰äº†runtimeåº“ï¼Œèƒ½åšä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿruntimeåº“é‡Œé¢åŒ…å«äº†è·Ÿç±»ã€æˆå‘˜å˜é‡ã€æ–¹æ³•ç›¸å…³çš„APIï¼Œæ¯”å¦‚è·å–ç±»é‡Œé¢çš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œä¸ºç±»åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡ï¼ŒåŠ¨æ€æ”¹å˜ç±»çš„æ–¹æ³•å®ç°ï¼Œä¸ºç±»åŠ¨æ€æ·»åŠ æ–°çš„æ–¹æ³•ç­‰ å› æ­¤ï¼Œæœ‰äº†runtimeï¼Œæƒ³æ€ä¹ˆæ”¹å°±æ€ä¹ˆæ”¹ Objective-C å¦‚ä½•å¯¹å·²æœ‰çš„æ–¹æ³•ï¼Œæ·»åŠ è‡ªå·±çš„åŠŸèƒ½ä»£ç ä»¥å®ç°ç±»ä¼¼è®°å½•æ—¥å¿—è¿™æ ·çš„åŠŸèƒ½ï¼Ÿè¿™é¢˜ç›®ä¸»è¦è€ƒå¯Ÿçš„æ˜¯runtimeå¦‚ä½•äº¤æ¢æ–¹æ³•ã€‚å…ˆåœ¨åˆ†ç±»ä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•,æ³¨æ„ä¸èƒ½é‡å†™ç³»ç»Ÿæ–¹æ³•,ä¼šè¦†ç›– +(NSString *)myLog { // è¿™é‡Œå†™æ‰“å°è¡Œå·,ä»€ä¹ˆæ–¹æ³•,å“ªä¸ªç±»è°ƒç”¨ç­‰ç­‰ } // åŠ è½½åˆ†ç±»åˆ°å†…å­˜çš„æ—¶å€™è°ƒç”¨ +(void)load { // è·å–imageWithNameæ–¹æ³•åœ°å€ Method description = class_getClassMethod(self, @selector(description)); // è·å–imageWithNameæ–¹æ³•åœ°å€ Method myLog = class_getClassMethod(self, @selector(myLog)); // äº¤æ¢æ–¹æ³•åœ°å€ï¼Œç›¸å½“äºäº¤æ¢å®ç°æ–¹å¼ method_exchangeImplementations(description, myLog); } å¦‚ä½•è®© Category æ”¯æŒå±æ€§ï¼Ÿä½¿ç”¨runtimeå¯ä»¥å®ç° å¤´æ–‡ä»¶ @interface NSObject (test) @property (nonatomic, copy) NSString *name; @end .mæ–‡ä»¶ @implementation NSObject (test) // å®šä¹‰å…³è”çš„key static const char *key = &quot;name&quot;; -(NSString *)name { // æ ¹æ®å…³è”çš„keyï¼Œè·å–å…³è”çš„å€¼ã€‚ return objc_getAssociatedObject(self, key); } -(void)setName:(NSString *)name { // ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç»™å“ªä¸ªå¯¹è±¡æ·»åŠ å…³è” // ç¬¬äºŒä¸ªå‚æ•°ï¼šå…³è”çš„keyï¼Œé€šè¿‡è¿™ä¸ªkeyè·å– // ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå…³è”çš„value // ç¬¬å››ä¸ªå‚æ•°:å…³è”çš„ç­–ç•¥ objc_setAssociatedObject(self, key, name, OBJC_ASSOCIATION_RETAIN_NONATOMIC); } Toll-Free Bridging æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨ï¼Ÿ Toll-Free Bridgingç”¨äºåœ¨Foundationå¯¹è±¡ä¸Core Foundationå¯¹è±¡ä¹‹é—´äº¤æ¢æ•°æ®,ä¿—ç§°æ¡¥æ¥ åœ¨ARCç¯å¢ƒä¸‹,Foundationå¯¹è±¡è½¬æˆ Core Foundationå¯¹è±¡ ä½¿ç”¨__bridgeæ¡¥æ¥ä»¥åARCä¼šè‡ªåŠ¨ç®¡ç†2ä¸ªå¯¹è±¡ ä½¿ç”¨__bridge_retainedæ¡¥æ¥éœ€è¦æ‰‹åŠ¨é‡Šæ”¾Core Foundationå¯¹è±¡ åœ¨ARCç¯å¢ƒä¸‹, Core Foundationå¯¹è±¡è½¬æˆ Foundationå¯¹è±¡ ä½¿ç”¨__bridgeæ¡¥æ¥,å¦‚æœCore Foundationå¯¹è±¡è¢«é‡Šæ”¾,Foundationå¯¹è±¡ä¹ŸåŒæ—¶ä¸èƒ½ä½¿ç”¨äº†,éœ€è¦æ‰‹åŠ¨ç®¡ç†Core Foundationå¯¹è±¡ ä½¿ç”¨__bridge_transferæ¡¥æ¥,ç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç†2ä¸ªå¯¹è±¡ performSelector:withObject:afterDelay: å†…éƒ¨å¤§æ¦‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ä¹ˆï¼Ÿ åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨,æ—¶é—´ç»“æŸåç³»ç»Ÿä¼šä½¿ç”¨runtimeé€šè¿‡æ–¹æ³•åç§°(Selectoræœ¬è´¨å°±æ˜¯æ–¹æ³•åç§°)å»æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°å¹¶è°ƒç”¨æ–¹æ³• æ³¨æ„äº‹é¡¹ è°ƒç”¨performSelector:withObject:afterDelay:æ–¹æ³•æ—¶,å…ˆåˆ¤æ–­å¸Œæœ›è°ƒç”¨çš„æ–¹æ³•æ˜¯å¦å­˜åœ¨respondsToSelector: è¿™ä¸ªæ–¹æ³•æ˜¯å¼‚æ­¥æ–¹æ³•,å¿…é¡»åœ¨ä¸»çº¿ç¨‹è°ƒç”¨,åœ¨å­çº¿ç¨‹è°ƒç”¨æ°¸è¿œä¸ä¼šè°ƒç”¨åˆ°æƒ³è°ƒç”¨çš„æ–¹æ³• ä»€ä¹ˆæ˜¯ Method Swizzleï¼ˆé»‘é­”æ³•ï¼‰ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨ï¼Ÿ åœ¨æ²¡æœ‰ä¸€ä¸ªç±»çš„å®ç°æºç çš„æƒ…å†µä¸‹ï¼Œæƒ³æ”¹å˜å…¶ä¸­ä¸€ä¸ªæ–¹æ³•çš„å®ç°ï¼Œé™¤äº†ç»§æ‰¿å®ƒé‡å†™ã€å’Œå€ŸåŠ©ç±»åˆ«é‡åæ–¹æ³•æš´åŠ›æŠ¢å…ˆä¹‹å¤–ï¼Œè¿˜æœ‰æ›´åŠ çµæ´»çš„æ–¹æ³•Method Swizzleã€‚ Method swizzlingæŒ‡çš„æ˜¯æ”¹å˜ä¸€ä¸ªå·²å­˜åœ¨çš„é€‰æ‹©å™¨å¯¹åº”çš„å®ç°çš„è¿‡ç¨‹ã€‚OCä¸­æ–¹æ³•çš„è°ƒç”¨èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶é€šè¿‡æ”¹å˜â€”â€”é€šè¿‡æ”¹å˜ç±»çš„è°ƒåº¦è¡¨ï¼ˆdispatch tableï¼‰ä¸­é€‰æ‹©å™¨åˆ°æœ€ç»ˆå‡½æ•°é—´çš„æ˜ å°„å…³ç³»ã€‚ åœ¨OCä¸­è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå…¶å®æ˜¯å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ï¼ŒæŸ¥æ‰¾æ¶ˆæ¯çš„å”¯ä¸€ä¾æ®æ˜¯selectorçš„åå­—ã€‚åˆ©ç”¨OCçš„åŠ¨æ€ç‰¹æ€§ï¼Œå¯ä»¥å®ç°åœ¨è¿è¡Œæ—¶å·æ¢selectorå¯¹åº”çš„æ–¹æ³•å®ç°ã€‚ æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ï¼Œå­˜æ”¾ç€selectorçš„åå­—å’Œæ–¹æ³•å®ç°çš„æ˜ å°„å…³ç³»ã€‚IMPæœ‰ç‚¹ç±»ä¼¼å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å…·ä½“çš„Methodå®ç°ã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ method_exchangeImplementations æ¥äº¤æ¢2ä¸ªæ–¹æ³•ä¸­çš„IMPï¼Œ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ class_replaceMethod æ¥ä¿®æ”¹ç±»ï¼Œ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ method_setImplementation æ¥ç›´æ¥è®¾ç½®æŸä¸ªæ–¹æ³•çš„IMPï¼Œ å½’æ ¹ç»“åº•ï¼Œéƒ½æ˜¯å·æ¢äº†selectorçš„IMP èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ- ä¸èƒ½å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼› - èƒ½å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼› è§£é‡Šå¦‚ä¸‹ï¼š å› ä¸ºç¼–è¯‘åçš„ç±»å·²ç»æ³¨å†Œåœ¨ runtime ä¸­ï¼Œç±»ç»“æ„ä½“ä¸­çš„ objc_ivar_list å®ä¾‹å˜é‡çš„é“¾è¡¨ å’Œ instance_size å®ä¾‹å˜é‡çš„å†…å­˜å¤§å°å·²ç»ç¡®å®šï¼ŒåŒæ—¶runtime ä¼šè°ƒç”¨ class_setIvarLayout æˆ– class_setWeakIvarLayout æ¥å¤„ç† strong weak å¼•ç”¨ã€‚æ‰€ä»¥ä¸èƒ½å‘å­˜åœ¨çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼› è¿è¡Œæ—¶åˆ›å»ºçš„ç±»æ˜¯å¯ä»¥æ·»åŠ å®ä¾‹å˜é‡ï¼Œè°ƒç”¨ class_addIvar å‡½æ•°ã€‚ä½†æ˜¯å¾—åœ¨è°ƒç”¨ objc_allocateClassPair ä¹‹åï¼Œobjc_registerClassPair ä¹‹å‰ï¼ŒåŸå› åŒä¸Šã€‚ ä¸ºä»€ä¹ˆå…¶ä»–è¯­è¨€é‡Œå«å‡½æ•°è°ƒç”¨ï¼Œ objective cé‡Œåˆ™æ˜¯ç»™å¯¹è±¡å‘æ¶ˆæ¯ï¼ˆæˆ–è€…è°ˆä¸‹å¯¹runtimeçš„ç†è§£ï¼‰å…ˆæ¥çœ‹çœ‹æ€ä¹ˆç†è§£å‘é€æ¶ˆæ¯çš„å«ä¹‰ï¼š [receiver message]ä¼šè¢«ç¼–è¯‘å™¨è½¬åŒ–ä¸ºï¼š objc_msgSend(receiver, selector) å¦‚æœæ¶ˆæ¯å«æœ‰å‚æ•°ï¼Œåˆ™ä¸ºï¼š objc_msgSend(receiver, selector, arg1, arg2, ...) å¦‚æœæ¶ˆæ¯çš„æ¥æ”¶è€…èƒ½å¤Ÿæ‰¾åˆ°å¯¹åº”çš„selectorï¼Œé‚£ä¹ˆå°±ç›¸å½“äºç›´æ¥æ‰§è¡Œäº†æ¥æ”¶è€…è¿™ä¸ªå¯¹è±¡çš„ç‰¹å®šæ–¹æ³•ï¼›å¦åˆ™ï¼Œæ¶ˆæ¯è¦ä¹ˆè¢«è½¬å‘ï¼Œæˆ–æ˜¯ä¸´æ—¶å‘æ¥æ”¶è€…åŠ¨æ€æ·»åŠ è¿™ä¸ªselectorå¯¹åº”çš„å®ç°å†…å®¹ï¼Œè¦ä¹ˆå°±å¹²è„†ç©å®Œå´©æºƒæ‰ã€‚ ç°åœ¨å¯ä»¥çœ‹å‡º[receiver message]çœŸçš„ä¸æ˜¯ä¸€ä¸ªç®€ç®€å•å•çš„æ–¹æ³•è°ƒç”¨ã€‚å› ä¸ºè¿™åªæ˜¯åœ¨ç¼–è¯‘é˜¶æ®µç¡®å®šäº†è¦å‘æ¥æ”¶è€…å‘é€messageè¿™æ¡æ¶ˆæ¯ï¼Œè€Œreceiveå°†è¦å¦‚ä½•å“åº”è¿™æ¡æ¶ˆæ¯ï¼Œé‚£å°±è¦çœ‹è¿è¡Œæ—¶å‘ç”Ÿçš„æƒ…å†µæ¥å†³å®šäº†ã€‚ OC çš„ Runtime é“¸å°±äº†å®ƒåŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ï¼ŒObjc Runtimeä½¿å¾—Cå…·æœ‰äº†é¢å‘å¯¹è±¡èƒ½åŠ›ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºï¼Œæ£€æŸ¥ï¼Œä¿®æ”¹ç±»ã€å¯¹è±¡å’Œå®ƒä»¬çš„æ–¹æ³•ã€‚å¯ä»¥ä½¿ç”¨runtimeçš„ä¸€ç³»åˆ—æ–¹æ³•å®ç°ã€‚ é¡ºä¾¿é™„ä¸ŠOCä¸­ä¸€ä¸ªç±»çš„æ•°æ®ç»“æ„ /usr/include/objc/runtime.h struct objc_class { Class isa OBJC_ISA_AVAILABILITY; //isaæŒ‡é’ˆæŒ‡å‘Meta Classï¼Œå› ä¸ºObjcçš„ç±»çš„æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªObjectï¼Œä¸ºäº†å¤„ç†è¿™ä¸ªå…³ç³»ï¼Œruntimeå°±åˆ›é€ äº†Meta Classï¼Œå½“ç»™ç±»å‘é€[NSObject alloc]è¿™æ ·æ¶ˆæ¯æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŠŠè¿™ä¸ªæ¶ˆæ¯å‘ç»™äº†Class Object #if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; // çˆ¶ç±» const char *name OBJC2_UNAVAILABLE; // ç±»å long version OBJC2_UNAVAILABLE; // ç±»çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œé»˜è®¤ä¸º0 long info OBJC2_UNAVAILABLE; // ç±»ä¿¡æ¯ï¼Œä¾›è¿è¡ŒæœŸä½¿ç”¨çš„ä¸€äº›ä½æ ‡è¯† long instance_size OBJC2_UNAVAILABLE; // è¯¥ç±»çš„å®ä¾‹å˜é‡å¤§å° struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; // è¯¥ç±»çš„æˆå‘˜å˜é‡é“¾è¡¨ struct objc_method_list **methodLists OBJC2_UNAVAILABLE; // æ–¹æ³•å®šä¹‰çš„é“¾è¡¨ struct objc_cache *cache OBJC2_UNAVAILABLE; // æ–¹æ³•ç¼“å­˜ï¼Œå¯¹è±¡æ¥åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¼šæ ¹æ®isaæŒ‡é’ˆæŸ¥æ‰¾æ¶ˆæ¯å¯¹è±¡ï¼Œè¿™æ—¶ä¼šåœ¨method Listsä¸­éå†ï¼Œå¦‚æœcacheäº†ï¼Œå¸¸ç”¨çš„æ–¹æ³•è°ƒç”¨æ—¶å°±èƒ½å¤Ÿæé«˜è°ƒç”¨çš„æ•ˆç‡ã€‚ struct objc_protocol_list *protocols OBJC2_UNAVAILABLE; // åè®®é“¾è¡¨ #endif } OBJC2_UNAVAILABLE; OCä¸­ä¸€ä¸ªç±»çš„å¯¹è±¡å®ä¾‹çš„æ•°æ®ç»“æ„ï¼ˆ/usr/include/objc/objc.hï¼‰: typedef struct objc_class *Class; /// Represents an instance of a class. struct objc_object { Class isa OBJC_ISA_AVAILABILITY; }; /// A pointer to an instance of a class. typedef struct objc_object *id; å‘objectå‘é€æ¶ˆæ¯æ—¶ï¼ŒRuntimeåº“ä¼šæ ¹æ®objectçš„isaæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå®ä¾‹objectæ‰€å±äºçš„ç±»ï¼Œç„¶ååœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠçˆ¶ç±»æ–¹æ³•åˆ—è¡¨å¯»æ‰¾å¯¹åº”çš„æ–¹æ³•è¿è¡Œã€‚idæ˜¯ä¸€ä¸ªobjc_objectç»“æ„ç±»å‹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªç±»å‹çš„å¯¹è±¡èƒ½å¤Ÿè½¬æ¢æˆä»»ä½•ä¸€ç§å¯¹è±¡ã€‚ ç„¶åå†æ¥çœ‹çœ‹æ¶ˆæ¯å‘é€çš„å‡½æ•°ï¼šobjc_msgSendå‡½æ•° åœ¨å¼•è¨€ä¸­å·²ç»å¯¹objc_msgSendè¿›è¡Œäº†ä¸€ç‚¹ä»‹ç»ï¼Œçœ‹èµ·æ¥åƒæ˜¯objc_msgSendè¿”å›äº†æ•°æ®ï¼Œå…¶å®objc_msgSendä»ä¸è¿”å›æ•°æ®è€Œæ˜¯ä½ çš„æ–¹æ³•è¢«è°ƒç”¨åè¿”å›äº†æ•°æ®ã€‚ä¸‹é¢è¯¦ç»†å™è¿°ä¸‹æ¶ˆæ¯å‘é€æ­¥éª¤ï¼š æ£€æµ‹è¿™ä¸ª selector æ˜¯ä¸æ˜¯è¦å¿½ç•¥çš„ã€‚æ¯”å¦‚ Mac OS X å¼€å‘ï¼Œæœ‰äº†åƒåœ¾å›æ”¶å°±ä¸ç†ä¼š retain,release è¿™äº›å‡½æ•°äº†ã€‚ æ£€æµ‹è¿™ä¸ª target æ˜¯ä¸æ˜¯ nil å¯¹è±¡ã€‚ObjC çš„ç‰¹æ€§æ˜¯å…è®¸å¯¹ä¸€ä¸ª nil å¯¹è±¡æ‰§è¡Œä»»ä½•ä¸€ä¸ªæ–¹æ³•ä¸ä¼š Crashï¼Œå› ä¸ºä¼šè¢«å¿½ç•¥æ‰ã€‚ å¦‚æœä¸Šé¢ä¸¤ä¸ªéƒ½è¿‡äº†ï¼Œé‚£å°±å¼€å§‹æŸ¥æ‰¾è¿™ä¸ªç±»çš„ IMPï¼Œå…ˆä» cache é‡Œé¢æ‰¾ï¼Œå®Œäº†æ‰¾å¾—åˆ°å°±è·³åˆ°å¯¹åº”çš„å‡½æ•°å»æ‰§è¡Œã€‚ å¦‚æœ cache æ‰¾ä¸åˆ°å°±æ‰¾ä¸€ä¸‹æ–¹æ³•åˆ†å‘è¡¨ã€‚ å¦‚æœåˆ†å‘è¡¨æ‰¾ä¸åˆ°å°±åˆ°è¶…ç±»çš„åˆ†å‘è¡¨å»æ‰¾ï¼Œä¸€ç›´æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°NSObjectç±»ä¸ºæ­¢ã€‚ å¦‚æœè¿˜æ‰¾ä¸åˆ°å°±è¦å¼€å§‹è¿›å…¥åŠ¨æ€æ–¹æ³•è§£æäº†ï¼Œåé¢ä¼šæåˆ°ã€‚ åé¢è¿˜æœ‰ï¼š åŠ¨æ€æ–¹æ³•è§£æresolveThisMethodDynamically æ¶ˆæ¯è½¬å‘forwardingTargetForSelector runtimeå¦‚ä½•å®ç°weakå±æ€§ï¼Ÿâ€¢ é€šè¿‡å…³è”å±æ€§æ¥å®ç°ï¼š â€¢ // å£°æ˜ä¸€ä¸ªweakå±æ€§ï¼Œè¿™é‡Œå‡è®¾delegateï¼Œå…¶å®weakå…³é”®å­—å¯ä»¥ä¸ä½¿ç”¨ï¼Œ â€¢ // å› ä¸ºæˆ‘ä»¬é‡å†™äº†getter/setteræ–¹æ³• â€¢ @property (nonatomic, weak) id delegate; â€¢ â€¢ - (id)delegate { â€¢ return objc_getAssociatedObject(self, @&quot;__delegate__key&quot;); â€¢ } â€¢ â€¢ // æŒ‡å®šä½¿ç”¨OBJC_ASSOCIATION_ASSIGNï¼Œå®˜æ–¹æ³¨é‡Šæ˜¯ï¼š â€¢ // Specifies a weak reference to the associated object. â€¢ // ä¹Ÿå°±æ˜¯è¯´å¯¹äºå¯¹è±¡ç±»å‹ï¼Œå°±æ˜¯weakäº† â€¢ - (void)setDelegate:(id)delegate { â€¢ objc_setAssociatedObject(self, @&quot;__delegate__key&quot;, delegate, OBJC_ASSOCIATION_ASSIGN); â€¢ } â€¢ é€šè¿‡objc_storeWeakå‡½æ•°æ¥å®ç°ï¼Œä¸è¿‡è¿™ç§æ–¹å¼å‡ ä¹æ²¡æœ‰é‡åˆ°æœ‰äººè¿™ä¹ˆä½¿ç”¨è¿‡ï¼Œå› ä¸ºè¿™é‡Œä¸ç»†è¯´äº†ã€‚ runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ æ¯ä¸ªselectoréƒ½ä¸å¯¹åº”çš„IMPæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œé€šè¿‡selectorå°±å¯ä»¥ç›´æ¥æ‰¾åˆ°å¯¹åº”çš„IMPï¼š objc_msgForwardå‡½æ•°æ˜¯åšä»€ä¹ˆçš„ï¼Œç›´æ¥è°ƒç”¨å®ƒå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ_objc_msgForwardæ˜¯IMPç±»å‹ï¼Œç”¨äºæ¶ˆæ¯è½¬å‘çš„ï¼šå½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®ç°çš„æ—¶å€™ï¼Œ_objc_msgForwardä¼šå°è¯•åšæ¶ˆæ¯è½¬å‘ã€‚ IMP msgForward = _objc_msgForward; å¦‚æœæ‰‹åŠ¨è°ƒç”¨objcmsgForwardï¼Œå°†è·³è¿‡æŸ¥æ‰¾IMPçš„è¿‡ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥è§¦å‘â€œæ¶ˆæ¯è½¬å‘â€ï¼Œè¿›å…¥å¦‚ä¸‹æµç¨‹ï¼š â€¢ ç¬¬ä¸€æ­¥ï¼š+ (BOOL)resolveInstanceMethod:(SEL)selå®ç°æ–¹æ³•ï¼ŒæŒ‡å®šæ˜¯å¦åŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚è‹¥è¿”å›NOï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œè‹¥è¿”å›YESï¼Œåˆ™é€šè¿‡class_addMethodå‡½æ•°åŠ¨æ€åœ°æ·»åŠ æ–¹æ³•ï¼Œæ¶ˆæ¯å¾—åˆ°å¤„ç†ï¼Œæ­¤æµç¨‹å®Œæ¯•ã€‚ â€¢ ç¬¬äºŒæ­¥ï¼šåœ¨ç¬¬ä¸€æ­¥è¿”å›çš„æ˜¯NOæ—¶ï¼Œå°±ä¼šè¿›å…¥- (id)forwardingTargetForSelector:(SEL)aSelectoræ–¹æ³•ï¼Œè¿™æ˜¯è¿è¡Œæ—¶ç»™æˆ‘ä»¬çš„ç¬¬äºŒæ¬¡æœºä¼šï¼Œç”¨äºæŒ‡å®šå“ªä¸ªå¯¹è±¡å“åº”è¿™ä¸ªselectorã€‚ä¸èƒ½æŒ‡å®šä¸ºselfã€‚è‹¥è¿”å›nilï¼Œè¡¨ç¤ºæ²¡æœ‰å“åº”è€…ï¼Œåˆ™ä¼šè¿›å…¥ç¬¬ä¸‰æ­¥ã€‚è‹¥è¿”å›æŸä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ã€‚ â€¢ ç¬¬ä¸‰æ­¥ï¼šè‹¥ç¬¬äºŒæ­¥è¿”å›çš„æ˜¯nilï¼Œåˆ™æˆ‘ä»¬é¦–å…ˆè¦é€šè¿‡- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelectoræŒ‡å®šæ–¹æ³•ç­¾åï¼Œè‹¥è¿”å›nilï¼Œåˆ™è¡¨ç¤ºä¸å¤„ç†ã€‚è‹¥è¿”å›æ–¹æ³•ç­¾åï¼Œåˆ™ä¼šè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ â€¢ ç¬¬å››æ­¥ï¼šå½“ç¬¬ä¸‰æ­¥è¿”å›æ–¹æ³•æ–¹æ³•ç­¾ååï¼Œå°±ä¼šè°ƒç”¨- (void)forwardInvocation:(NSInvocation *)anInvocationæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡anInvocationå¯¹è±¡åšå¾ˆå¤šå¤„ç†ï¼Œæ¯”å¦‚ä¿®æ”¹å®ç°æ–¹æ³•ï¼Œä¿®æ”¹å“åº”å¯¹è±¡ç­‰ â€¢ ç¬¬äº”æ­¥ï¼šè‹¥æ²¡æœ‰å®ç°- (void)forwardInvocation:(NSInvocation *)anInvocationæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šè¿›å…¥- (void)doesNotRecognizeSelector:(SEL)aSelectoræ–¹æ³•ã€‚è‹¥æˆ‘ä»¬æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šcrashï¼Œç„¶åæç¤ºæ‰“ä¸åˆ°å“åº”çš„æ–¹æ³•ã€‚åˆ°æ­¤ï¼ŒåŠ¨æ€è§£æçš„æµç¨‹å°±ç»“æŸäº†ã€‚ runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿruntimeå¯¹æ³¨å†Œçš„ç±»ä¼šè¿›è¡Œå¸ƒå±€ï¼Œå¯¹äºweakå¯¹è±¡ä¼šæ”¾å…¥ä¸€ä¸ªhashè¡¨ä¸­ã€‚ ç”¨weakæŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€ä½œä¸ºkeyï¼Œå½“æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ä¼šdeallocã€‚å‡å¦‚weakæŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯aï¼Œé‚£ä¹ˆå°±ä¼šä»¥aä¸ºé”®ï¼Œåœ¨è¿™ä¸ª weak è¡¨ä¸­æœç´¢ï¼Œæ‰¾åˆ°æ‰€æœ‰ä»¥aä¸ºé”®çš„weakå¯¹è±¡ï¼Œä»è€Œè®¾ç½®ä¸ºnilã€‚ weakä¿®é¥°çš„æŒ‡é’ˆé»˜è®¤å€¼æ˜¯nilï¼ˆåœ¨Objective-Cä¸­å‘nilå‘é€æ¶ˆæ¯æ˜¯å®‰å…¨çš„ï¼‰ åŠ¨æ€ç»‘å®š åœ¨è¿è¡Œæ—¶ç¡®å®šè¦è°ƒç”¨çš„æ–¹æ³•,åŠ¨æ€ç»‘å®šå°†è°ƒç”¨æ–¹æ³•çš„ç¡®å®šä¹Ÿæ¨è¿Ÿåˆ°è¿è¡Œæ—¶ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œæ–¹æ³•çš„è°ƒç”¨å¹¶ä¸å’Œä»£ç ç»‘å®šåœ¨ä¸€èµ·ï¼Œåªæœ‰åœ¨æ¶ˆå®å‘é€å‡ºæ¥ä¹‹åï¼Œæ‰ç¡®å®šè¢«è°ƒç”¨çš„ä»£ç ã€‚é€šè¿‡åŠ¨æ€ç±»å‹å’ŒåŠ¨æ€ç»‘å®šæŠ€æœ¯ï¼Œä»£ç æ¯æ¬¡æ‰§è¡Œéƒ½å¯ä»¥å¾—åˆ°ä¸åŒçš„ç»“æœã€‚è¿è¡Œæ—¶å› å­è´Ÿè´£ç¡®å®šæ¶ˆæ¯çš„æ¥æ”¶è€…å’Œè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚è¿è¡Œæ—¶çš„æ¶ˆæ¯åˆ†å‘æœºåˆ¶ä¸ºåŠ¨æ€ç»‘å®šæä¾›æ”¯æŒã€‚å½“å‘ä¸€ä¸ªåŠ¨æ€ç±»å‹ç¡®å®šäº†çš„å¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œç¯å¢ƒç³»ç»Ÿä¼šé€šè¿‡æ¥æ”¶è€…çš„isaæŒ‡é’ˆå®šä½å¯¹è±¡çš„ç±»ï¼Œå¹¶ä»¥æ­¤ä¸ºèµ·ç‚¹ç¡®å®šè¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œæ–¹æ³•å’Œæ¶ˆæ¯æ˜¯åŠ¨æ€ç»‘å®šçš„ã€‚è€Œä¸”ï¼Œä¸å¿…åœ¨Objective-C ä»£ç ä¸­åšä»»ä½•å·¥ä½œï¼Œå°±å¯ä»¥è‡ªåŠ¨è·å–åŠ¨æ€ç»‘å®šçš„å¥½å¤„ã€‚åœ¨æ¯æ¬¡å‘é€æ¶ˆæ¯æ—¶ï¼Œç‰¹åˆ«æ˜¯å½“æ¶ˆæ¯çš„æ¥æ”¶è€…æ˜¯åŠ¨æ€ç±»å‹å·²ç»ç¡®å®šçš„å¯¹è±¡æ—¶ï¼ŒåŠ¨æ€ç»‘å®šå°±ä¼šä¾‹è¡Œè€Œé€æ˜åœ°å‘ç”Ÿ]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜20--å®‰å…¨æœºåˆ¶]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9820-%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6%2F</url>
    <content type="text"><![CDATA[è‹¹æœçš„å®‰å…¨æœºåˆ¶æœ‰å“ªäº› æ²¡ç»è¿‡ç”¨æˆ·åŒæ„ï¼Œä½ ä¸èƒ½éšä¾¿è·å–ç”¨æˆ·ä¿¡æ¯ã€‚ æ‰€æœ‰çš„ç¨‹åºéƒ½åœ¨æ²™ç›’é‡Œè¿è¡Œï¼ŒBç¨‹åºä¸èƒ½è¿›å…¥Aç¨‹åºçš„è¿è¡ŒèŒƒå›´ã€‚ å¦‚æœè·Ÿé’±æœ‰å…³ï¼Œæ¯”å¦‚è¯´æ”¯ä»˜å®ï¼Œè¿™äº›åº•å±‚çš„å®ç°éƒ½æ˜¯ä¿å¯†çš„ï¼Œåªæä¾›æ¥å£ä¾›å¼€å‘è€…è°ƒç”¨ï¼Œè¿™æ ·çš„è¯å®‰å…¨æ€§å¾—åˆ°ä¿éšœã€‚ å¦‚æœè¦é˜²æ­¢ä»£ç è¢«åç¼–è¯‘ï¼Œå¯ä»¥å°†è‡ªå·±çš„ä»£ç ä¸­çš„.mæ–‡ä»¶å°è£…æˆé™æ€åº“ï¼ˆ.aæ–‡ä»¶ï¼‰æˆ–è€…æ˜¯frameworkæ–‡ä»¶ï¼Œåªæä¾›ç»™å…¶å®ƒäºº.hæ–‡ä»¶ã€‚è¿™æ ·å°±ä¿è¯äº†ä¸ªäººä»£ç çš„å®‰å…¨æ€§ã€‚ ç½‘ç»œç™»å½•çš„è¯è·Ÿç”¨æˆ·åè·Ÿå¯†ç ç›¸å…³è¦å‘é€POSTè¯·æ±‚ï¼Œå¦‚æœæ˜¯GETè¯·æ±‚çš„è¯å¯†ç ä¼šç›´æ¥åœ¨URLä¸­æ˜¾ç¤ºã€‚ç„¶ååŒæ—¶è¦å¯¹å¸å·å¯†ç é‡‡ç”¨åŠ å¯†æŠ€æœ¯ï¼ŒåŠ ä¸€å¥ï¼šæˆ‘ä»¬å…¬å¸ç”¨çš„æ˜¯MD5ï¼Œä½†æ˜¯ç°åœ¨MD5æœ‰ä¸€ä¸ªä¸“é—¨çš„ç½‘ç«™æ¥ç ´è§£ï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸ªï¼Œå¯ä»¥é‡‡ç”¨åŠ ç›æŠ€æœ¯ã€‚ iOS çš„ç­¾åæœºåˆ¶å¤§æ¦‚æ˜¯æ€æ ·çš„ï¼Ÿ å‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªAPPéœ€è¦å‘å¸ƒï¼Œä¸ºäº†é˜²æ­¢ä¸­é€”ç¯¡æ”¹APPå†…å®¹ï¼Œä¿è¯APPçš„å®Œæ•´æ€§ï¼Œä»¥åŠAPPæ˜¯ç”±æŒ‡å®šçš„ç§é’¥å‘çš„ã€‚é¦–å…ˆï¼Œå…ˆå°†APPå†…å®¹é€šè¿‡æ‘˜è¦ç®—æ³•ï¼Œå¾—åˆ°æ‘˜è¦ï¼Œå†ç”¨ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†å¾—åˆ°å¯†æ–‡ï¼Œå°†æºæ–‡æœ¬ã€å¯†æ–‡ã€å’Œç§é’¥å¯¹åº”çš„å…¬é’¥ä¸€å¹¶å‘å¸ƒå³å¯ã€‚ é‚£ä¹ˆå¦‚ä½•éªŒè¯å‘¢ï¼Ÿ éªŒè¯æ–¹é¦–å…ˆæŸ¥çœ‹å…¬é’¥æ˜¯å¦æ˜¯ç§é’¥æ–¹çš„ï¼Œç„¶åç”¨å…¬é’¥å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†å¾—åˆ°æ‘˜è¦ï¼Œå°†APPç”¨åŒæ ·çš„æ‘˜è¦ç®—æ³•å¾—åˆ°æ‘˜è¦ï¼Œä¸¤ä¸ªæ‘˜è¦è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœç›¸ç­‰é‚£ä¹ˆä¸€åˆ‡æ­£å¸¸ã€‚è¿™ä¸ªè¿‡ç¨‹åªè¦æœ‰ä¸€æ­¥å‡ºé—®é¢˜å°±è§†ä¸ºæ— æ•ˆã€‚ å®¢æˆ·ç«¯å®‰å…¨æ€§å¤„ç†æ–¹å¼ï¼Ÿ1&gt; ç½‘ç»œæ•°æ®ä¼ è¾“(æ•æ„Ÿæ•°æ®[è´¦å·\å¯†ç \æ¶ˆè´¹æ•°æ®\é“¶è¡Œå¡è´¦å·], ä¸èƒ½æ˜æ–‡å‘é€) 2&gt; åè®®çš„é—®é¢˜(è‡ªå®šä¹‰åè®®, æ¸¸æˆä»£ç»ƒ) 3&gt; æœ¬åœ°æ–‡ä»¶å­˜å‚¨(æ¸¸æˆçš„å­˜æ¡£) 4&gt; æºä»£ç (æ··æ·†) å¦‚ä½•è¿›è¡Œæ•°æ®åŠ å¯†?å¸¸è§çš„åŠ å¯†ç®—æ³•:MD5 \ SHA \ DES \ 3DES \ RC2å’ŒRC4 \ RSA \ IDEA \ DSA \ AES åŠ å¯†ç®—æ³•çš„é€‰æ‹©:ä¸€èˆ¬å…¬å¸éƒ½ä¼šæœ‰ä¸€å¥—è‡ªå·±çš„åŠ å¯†æ–¹æ¡ˆï¼ŒæŒ‰ç…§å…¬å¸æ¥å£æ–‡æ¡£çš„è§„å®šå»åŠ å¯† MD5çš„ç‰¹ç‚¹: ï¼ˆ1ï¼‰è¾“å…¥ä¸¤ä¸ªä¸åŒçš„æ˜æ–‡ä¸ä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºå€¼ ï¼ˆ2ï¼‰æ ¹æ®è¾“å‡ºå€¼ï¼Œä¸èƒ½å¾—åˆ°åŸå§‹çš„æ˜æ–‡ï¼Œå³å…¶è¿‡ç¨‹ä¸å¯é€† ç°åœ¨çš„MD5å·²ä¸å†æ˜¯ç»å¯¹å®‰å…¨ï¼Œå¯¹æ­¤ï¼Œå¯ä»¥å¯¹MD5ç¨ä½œæ”¹è¿›ï¼Œä»¥å¢åŠ è§£å¯†çš„éš¾åº¦ åŠ ç›ï¼ˆSaltï¼‰ï¼šåœ¨æ˜æ–‡çš„å›ºå®šä½ç½®æ’å…¥éšæœºä¸²ï¼Œç„¶åå†è¿›è¡ŒMD5 å…ˆåŠ å¯†ï¼Œåä¹±åºï¼šå…ˆå¯¹æ˜æ–‡è¿›è¡ŒMD5ï¼Œç„¶åå¯¹åŠ å¯†å¾—åˆ°çš„MD5ä¸²çš„å­—ç¬¦è¿›è¡Œä¹±åº æ€»ä¹‹å®—æ—¨å°±æ˜¯ï¼šé»‘å®¢å°±ç®—æ”»ç ´äº†æ•°æ®åº“ï¼Œä¹Ÿæ— æ³•è§£å¯†å‡ºæ­£ç¡®çš„æ˜æ–‡]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜19--è®¾è®¡æ¨¡å¼]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9819-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%2F</url>
    <content type="text"><![CDATA[ä»è®¾è®¡æ¨¡å¼çš„è§’åº¦åˆ†æDelegateã€Notificationã€KVOçš„åŒºåˆ«ä¸‰è€…ä¼˜ç¼ºç‚¹ï¼š delegateçš„ä¼˜åŠ¿ï¼š 1.éå¸¸ä¸¥æ ¼çš„è¯­æ³•ã€‚æ‰€æœ‰å°†å¬åˆ°çš„äº‹ä»¶å¿…é¡»æ˜¯åœ¨delegateåè®®ä¸­æœ‰æ¸…æ™°çš„å®šä¹‰ã€‚ 2.å¦‚æœdelegateä¸­çš„ä¸€ä¸ªæ–¹æ³•æ²¡æœ‰å®ç°é‚£ä¹ˆå°±ä¼šå‡ºç°ç¼–è¯‘è­¦å‘Š/é”™è¯¯ 3.åè®®å¿…é¡»åœ¨controllerçš„ä½œç”¨åŸŸèŒƒå›´å†…å®šä¹‰ 4.åœ¨ä¸€ä¸ªåº”ç”¨ä¸­çš„æ§åˆ¶æµç¨‹æ˜¯å¯è·Ÿè¸ªçš„å¹¶ä¸”æ˜¯å¯è¯†åˆ«çš„ï¼› 5.åœ¨ä¸€ä¸ªæ§åˆ¶å™¨ä¸­å¯ä»¥å®šä¹‰å®šä¹‰å¤šä¸ªä¸åŒçš„åè®®ï¼Œæ¯ä¸ªåè®®æœ‰ä¸åŒçš„delegates 6.æ²¡æœ‰ç¬¬ä¸‰æ–¹å¯¹è±¡è¦æ±‚ä¿æŒ/ç›‘è§†é€šä¿¡è¿‡ç¨‹ã€‚ 7.èƒ½å¤Ÿæ¥æ”¶è°ƒç”¨çš„åè®®æ–¹æ³•çš„è¿”å›å€¼ã€‚è¿™æ„å‘³ç€delegateèƒ½å¤Ÿæä¾›åé¦ˆä¿¡æ¯ç»™controller 8.ç»å¸¸è¢«ç”¨åœ¨å­˜åœ¨çˆ¶å­å…³ç³»çš„å¯¹è±¡ä¹‹é—´é€šä¿¡ï¼Œä¾‹å¦‚æ§åˆ¶å™¨å’Œæ§åˆ¶å™¨çš„viewï¼ˆè‡ªå·±åŠ çš„ç†è§£ï¼‰ ç¼ºç‚¹ï¼š 1.éœ€è¦å®šä¹‰å¾ˆå¤šä»£ç ï¼š1.åè®®å®šä¹‰ï¼›2.controllerçš„delegateå±æ€§ï¼›3.åœ¨delegateæœ¬èº«ä¸­å®ç°delegateæ–¹æ³•å®šä¹‰ 2.åœ¨é‡Šæ”¾ä»£ç†å¯¹è±¡æ—¶ï¼Œéœ€è¦å°å¿ƒçš„å°†delegateæ”¹ä¸ºnilã€‚ä¸€æ—¦è®¾å®šå¤±è´¥ï¼Œé‚£ä¹ˆè°ƒç”¨é‡Šæ”¾å¯¹è±¡çš„æ–¹æ³•å°†ä¼šå‡ºç°å†…å­˜crash 3.åœ¨ä¸€ä¸ªcontrollerä¸­æœ‰å¤šä¸ªdelegateå¯¹è±¡ï¼Œå¹¶ä¸”delegateæ˜¯éµå®ˆåŒä¸€ä¸ªåè®®ï¼Œä½†è¿˜æ˜¯å¾ˆéš¾å‘Šè¯‰å¤šä¸ªå¯¹è±¡åŒä¸€ä¸ªäº‹ä»¶ï¼Œä¸è¿‡æœ‰å¯èƒ½ã€‚ 4.ç»å¸¸ç”¨åœ¨ä¸€å¯¹ä¸€çš„é€šä¿¡ã€‚ï¼ˆä¸çŸ¥é“æ˜¯ç¼ºç‚¹è¿˜æ˜¯ä¼˜ç‚¹ï¼Œåªèƒ½ç®—æ˜¯ç‰¹ç‚¹ï¼‰ï¼ˆè‡ªå·±åŠ çš„ç†è§£ï¼‰ notificationçš„ä¼˜åŠ¿ï¼š 1.ä¸éœ€è¦ç¼–å†™å¤šå°‘ä»£ç ï¼Œå®ç°æ¯”è¾ƒç®€å• 2.å¯¹äºä¸€ä¸ªå‘å‡ºçš„é€šçŸ¥ï¼Œå¤šä¸ªå¯¹è±¡èƒ½å¤Ÿåšå‡ºååº”ï¼Œå³ä¸€å¯¹å¤šçš„æ–¹å¼å®ç°ç®€å• 3.controllerèƒ½å¤Ÿä¼ é€’contextå¯¹è±¡ï¼ˆdictionaryï¼‰ï¼Œcontextå¯¹è±¡æºå¸¦äº†å…³äºå‘é€é€šçŸ¥çš„è‡ªå®šä¹‰çš„ä¿¡æ¯ ç¼ºç‚¹ï¼š 1.åœ¨ç¼–è¯‘æœŸä¸ä¼šæ£€æŸ¥é€šçŸ¥æ˜¯å¦èƒ½å¤Ÿè¢«è§‚å¯Ÿè€…æ­£ç¡®çš„å¤„ç†ï¼› 2.åœ¨é‡Šæ”¾æ³¨å†Œçš„å¯¹è±¡æ—¶ï¼Œéœ€è¦åœ¨é€šçŸ¥ä¸­å¿ƒå–æ¶ˆæ³¨å†Œï¼› 3.åœ¨è°ƒè¯•çš„æ—¶å€™åº”ç”¨çš„å·¥ä½œä»¥åŠæ§åˆ¶è¿‡ç¨‹éš¾è·Ÿè¸ªï¼› 4.éœ€è¦ç¬¬ä¸‰æ–¹å¯¹è±¡æ¥ç®¡ç†controllerä¸è§‚å¯Ÿè€…å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼› 5.controllerå’Œè§‚å¯Ÿè€…éœ€è¦æå‰çŸ¥é“é€šçŸ¥åç§°ã€UserInfo dictionary keysã€‚å¦‚æœè¿™äº›æ²¡æœ‰åœ¨å·¥ä½œåŒºé—´å®šä¹‰ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä¸åŒæ­¥çš„æƒ…å†µï¼› 6.é€šçŸ¥å‘å‡ºåï¼Œcontrollerä¸èƒ½ä»è§‚å¯Ÿè€…è·å¾—ä»»ä½•çš„åé¦ˆä¿¡æ¯ï¼ˆç›¸æ¯”è¾ƒdelegateï¼‰ã€‚ KVOçš„ä¼˜åŠ¿ï¼š 1.èƒ½å¤Ÿæä¾›ä¸€ç§ç®€å•çš„æ–¹æ³•å®ç°ä¸¤ä¸ªå¯¹è±¡é—´çš„åŒæ­¥ã€‚ä¾‹å¦‚ï¼šmodelå’Œviewä¹‹é—´åŒæ­¥ï¼› 2.èƒ½å¤Ÿå¯¹éæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡ï¼Œå³å†…éƒ¨å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ä½œå‡ºå“åº”ï¼Œè€Œä¸”ä¸éœ€è¦æ”¹å˜å†…éƒ¨å¯¹è±¡ï¼ˆSKDå¯¹è±¡ï¼‰çš„å®ç°ï¼› 3.èƒ½å¤Ÿæä¾›è§‚å¯Ÿçš„å±æ€§çš„æœ€æ–°å€¼ä»¥åŠå…ˆå‰å€¼ï¼› 4.ç”¨key pathsæ¥è§‚å¯Ÿå±æ€§ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è§‚å¯ŸåµŒå¥—å¯¹è±¡ï¼› 5.å®Œæˆäº†å¯¹è§‚å¯Ÿå¯¹è±¡çš„æŠ½è±¡ï¼Œå› ä¸ºä¸éœ€è¦é¢å¤–çš„ä»£ç æ¥å…è®¸è§‚å¯Ÿå€¼èƒ½å¤Ÿè¢«è§‚å¯Ÿ 6.å¯ä»¥ä¸€å¯¹å¤šã€‚ ç¼ºç‚¹ï¼š 1.æˆ‘ä»¬è§‚å¯Ÿçš„å±æ€§å¿…é¡»ä½¿ç”¨stringsæ¥å®šä¹‰ã€‚å› æ­¤åœ¨ç¼–è¯‘å™¨ä¸ä¼šå‡ºç°è­¦å‘Šä»¥åŠæ£€æŸ¥ï¼› 2.å¯¹å±æ€§é‡æ„å°†å¯¼è‡´æˆ‘ä»¬çš„è§‚å¯Ÿä»£ç ä¸å†å¯ç”¨ï¼› 3.å¤æ‚çš„â€œIFâ€è¯­å¥è¦æ±‚å¯¹è±¡æ­£åœ¨è§‚å¯Ÿå¤šä¸ªå€¼ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„è§‚å¯Ÿä»£ç é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥æŒ‡å‘ï¼› 4.å½“é‡Šæ”¾è§‚å¯Ÿè€…æ—¶ä¸éœ€è¦ç§»é™¤è§‚å¯Ÿè€…ã€‚ æ•ˆç‡ è‚¯å®šæ˜¯delegateæ¯”NSNotificationé«˜ã€‚ delegateæ–¹æ³•æ¯”notificationæ›´åŠ ç›´æ¥ï¼Œæœ€å…¸å‹çš„ç‰¹å¾æ˜¯ï¼Œdelegateæ–¹æ³•å¾€å¾€éœ€è¦å…³æ³¨è¿”å›å€¼ï¼Œ ä¹Ÿå°±æ˜¯delegateæ–¹æ³•çš„ç»“æœã€‚æ¯”å¦‚-windowShouldClose:ï¼Œéœ€è¦å…³å¿ƒè¿”å›çš„æ˜¯yesè¿˜æ˜¯noã€‚æ‰€ä»¥delegateæ–¹æ³•å¾€å¾€åŒ…å« shouldè¿™ä¸ªå¾ˆä¼ ç¥çš„è¯ã€‚ä¹Ÿå°±æ˜¯å¥½æ¯”ä½ åšæˆ‘çš„delegateï¼Œæˆ‘ä¼šé—®ä½ æˆ‘æƒ³å…³é—­çª—å£ä½ æ„¿æ„å—ï¼Ÿä½ éœ€è¦ç»™æˆ‘ä¸€ä¸ªç­”æ¡ˆï¼Œæˆ‘æ ¹æ®ä½ çš„ç­”æ¡ˆæ¥å†³å®šå¦‚ä½•åšä¸‹ä¸€ æ­¥ã€‚ç›¸åçš„ï¼Œnotificationæœ€å¤§çš„ç‰¹è‰²å°±æ˜¯ä¸å…³å¿ƒæ¥å—è€…çš„æ€åº¦ï¼Œ æˆ‘åªç®¡æŠŠé€šå‘Šæ”¾å‡ºæ¥ï¼Œä½ æ¥å—ä¸æ¥å—å°±æ˜¯ä½ çš„äº‹æƒ…ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¸å…³å¿ƒç»“æœã€‚æ‰€ä»¥notificationå¾€å¾€ç”¨didè¿™ä¸ªè¯æ±‡ï¼Œæ¯”å¦‚ NSWindowDidResizeNotificationï¼Œé‚£ä¹ˆNSWindowå¯¹è±¡æ”¾å‡ºè¿™ä¸ªnotificationåå°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ä¹Ÿä¸ä¼šç­‰å¾…æ¥ å—è€…çš„ååº”ã€‚ 2ã€KVOå’ŒNSNotificationçš„åŒºåˆ« ï¼š å’Œdelegateä¸€æ ·ï¼ŒKVOå’ŒNSNotificationçš„ä½œç”¨ä¹Ÿæ˜¯ç±»ä¸ç±»ä¹‹é—´çš„é€šä¿¡ï¼Œä¸delegateä¸åŒçš„æ˜¯1ï¼‰è¿™ä¸¤ä¸ªéƒ½æ˜¯è´Ÿè´£å‘å‡ºé€šçŸ¥ï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±ä¸ç®¡äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›å€¼ï¼›2ï¼‰delegateåªæ˜¯ä¸€å¯¹ä¸€ï¼Œè€Œè¿™ä¸¤ä¸ªå¯ä»¥ä¸€å¯¹å¤šã€‚è¿™ä¸¤è€…ä¹Ÿæœ‰å„è‡ªçš„ç‰¹ç‚¹ã€‚ æ€»ç»“ï¼š ä»ä¸Šé¢çš„åˆ†æä¸­å¯ä»¥çœ‹å‡º3ä¸­è®¾è®¡æ¨¡å¼éƒ½æœ‰å„è‡ªçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚åœ¨è¿™ä¸‰ç§æ¨¡å¼ä¸­ï¼Œæˆ‘è®¤ä¸ºKVOæœ‰æœ€æ¸…æ™°çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œè€Œä¸”é’ˆå¯¹æŸä¸ªéœ€æ±‚æœ‰æ¸…æ™°çš„å®ç”¨æ€§ã€‚è€Œå¦å¤–ä¸¤ç§æ¨¡å¼æœ‰æ¯”è¾ƒç›¸ä¼¼çš„ç”¨å¤„ï¼Œå¹¶ä¸”ç»å¸¸ç”¨æ¥ç»™controlleré—´è¿›è¡Œé€šä¿¡ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨ä»€ä¹ˆæƒ…å†µä½¿ç”¨å…¶ä¸­ä¹‹ä¸€å‘¢ï¼Ÿ æ ¹æ®æˆ‘å¼€å‘iOSåº”ç”¨çš„ç»å†ï¼Œæˆ‘å‘ç°æœ‰äº›è¿‡åˆ†çš„ä½¿ç”¨é€šçŸ¥æ¨¡å¼ã€‚æˆ‘ä¸ªäººä¸æ˜¯å¾ˆå–œæ¬¢ä½¿ç”¨é€šçŸ¥ä¸­å¿ƒã€‚æˆ‘å‘ç°ç”¨é€šçŸ¥ä¸­å¿ƒå¾ˆéš¾æŠŠæ¡åº”ç”¨çš„æ‰§è¡Œæµç¨‹ã€‚Userlnfo dictionariesçš„keysåˆ°å¤„ä¼ é€’å¯¼è‡´å¤±å»äº†åŒæ­¥ï¼Œè€Œä¸”åœ¨å…¬å…±ç©ºé—´éœ€è¦å®šä¹‰å¤ªå¤šçš„å¸¸é‡ã€‚å¯¹äºä¸€ä¸ªå·¥ä½œäºç°æœ‰çš„é¡¹ç›®çš„å¼€å‘è€…æ¥è¯´ï¼Œå¦‚æœè¿‡åˆ†çš„ä½¿ç”¨é€šçŸ¥ä¸­å¿ƒï¼Œé‚£ä¹ˆå¾ˆéš¾ç†è§£åº”ç”¨çš„æµç¨‹ã€‚ æˆ‘è§‰å¾—ä½¿ç”¨å‘½åè§„åˆ™å¥½çš„åè®®å’Œåè®®æ–¹æ³•å®šä¹‰å¯¹äºæ¸…æ™°çš„ç†è§£controllersé—´çš„é€šä¿¡æ˜¯å¾ˆå®¹æ˜“çš„ã€‚åŠªåŠ›çš„å®šä¹‰è¿™äº›åè®®æ–¹æ³•å°†å¢å¼ºä»£ç çš„å¯è¯»æ€§ï¼Œä»¥åŠæ›´å¥½çš„è·Ÿè¸ªä½ çš„appã€‚ä»£ç†åè®®å‘ç”Ÿæ”¹å˜ä»¥åŠå®ç°éƒ½å¯é€šè¿‡ç¼–è¯‘å™¨æ£€æŸ¥å‡ºæ¥ï¼Œå¦‚æœæ²¡æœ‰å°†ä¼šåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­è‡³å°‘ä¼šå‡ºç°crashï¼Œè€Œä¸ä»…ä»…æ˜¯è®©ä¸€äº›äº‹æƒ…å¼‚å¸¸å·¥ä½œã€‚ç”šè‡³åœ¨åŒä¸€äº‹ä»¶é€šçŸ¥å¤šæ§åˆ¶å™¨çš„åœºæ™¯ä¸­ï¼Œåªè¦ä½ çš„åº”ç”¨åœ¨controllerå±‚æ¬¡æœ‰ç€è‰¯å¥½çš„ç»“æ„ï¼Œæ¶ˆæ¯å°†åœ¨è¯¥å±‚æ¬¡ä¸Šä¼ é€’ã€‚è¯¥å±‚æ¬¡èƒ½å¤Ÿå‘åä¼ é€’ç›´è‡³è®©æ‰€æœ‰éœ€è¦çŸ¥é“äº‹ä»¶çš„controllerséƒ½çŸ¥é“ã€‚å½“ç„¶ä¼šæœ‰delegationæ¨¡å¼ä¸é€‚åˆçš„ä¾‹å¤–æƒ…å†µå‡ºç°ï¼Œè€Œä¸”notificationå¯èƒ½æ›´åŠ æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼šåº”ç”¨ä¸­æ‰€æœ‰çš„controlleréœ€è¦çŸ¥é“ä¸€ä¸ªäº‹ä»¶ã€‚ç„¶è€Œè¿™äº›ç±»å‹çš„åœºæ™¯å¾ˆå°‘å‡ºç°ã€‚å¦å¤–ä¸€ä¸ªä¾‹å­æ˜¯å½“ä½ å»ºç«‹äº†ä¸€ä¸ªæ¶æ„è€Œä¸”éœ€è¦é€šçŸ¥è¯¥äº‹ä»¶ç»™æ­£åœ¨è¿è¡Œä¸­åº”ç”¨ã€‚ æ ¹æ®ç»éªŒï¼Œå¦‚æœæ˜¯å±æ€§å±‚çš„äº‹ä»¶ï¼Œä¸ç®¡æ˜¯åœ¨ä¸éœ€è¦ç¼–ç¨‹çš„å¯¹è±¡è¿˜æ˜¯åœ¨ç´§ç´§ç»‘å®šä¸€ä¸ªviewå¯¹è±¡çš„modelå¯¹è±¡ï¼Œæˆ‘åªä½¿ç”¨è§‚å¯Ÿã€‚å¯¹äºå…¶ä»–çš„äº‹ä»¶ï¼Œæˆ‘éƒ½ä¼šä½¿ç”¨delegateæ¨¡å¼ã€‚å¦‚æœå› ä¸ºæŸç§åŸå› æˆ‘ä¸èƒ½ä½¿ç”¨delegateï¼Œé¦–å…ˆæˆ‘å°†ä¼°è®¡æˆ‘çš„appæ¶æ„æ˜¯å¦å‡ºç°äº†ä¸¥é‡çš„é”™è¯¯ã€‚å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œç„¶åæ‰ä½¿ç”¨notificationã€‚ ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ è®¾è®¡æ¨¡å¼æ˜¯ä¸ºç‰¹å®šåœºæ™¯ä¸‹çš„é—®é¢˜è€Œå®šåˆ¶çš„è§£å†³æ–¹æ¡ˆã€‚ç‰¹å®šåœºæ™¯æŒ‡é—®é¢˜æ‰€åœ¨çš„é‡å¤å‡ºç°çš„åœºæ™¯ï¼Œé—®é¢˜æŒ‡ç‰¹å®šç¯å¢ƒä¸‹ä½ æƒ³è¾¾æˆçš„ç›®æ ‡ã€‚åŒæ ·çš„é—®é¢˜åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ä¼šæœ‰ä¸åŒçš„é™åˆ¶å’ŒæŒ‘æˆ˜ã€‚å®šåˆ¶çš„è§£å†³æ–¹æ¡ˆæ˜¯æŒ‡åœ¨ç‰¹å®šç¯å¢ƒä¸‹å…‹æœäº†é—®é¢˜çš„é™åˆ¶æ¡ä»¶è€Œè¾¾æˆç›®æ ‡çš„ä¸€ç§è®¾è®¡ã€‚ è®¾è®¡æ¨¡å¼çš„åˆ†ç±» è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼Œå…±23ç§ã€‚ åˆ›å»ºå‹æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚ ç»“æ„å‹æ¨¡å¼ï¼šé€‚é…å™¨æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€è£…é¥°æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€‚ è¡Œä¸ºå‹æ¨¡å¼ï¼šæ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€è¿­ä»£å™¨æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreteræ¨¡å¼ï¼‰ã€çŠ¶æ€æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ã€èŒè´£é“¾æ¨¡å¼(è´£ä»»é“¾æ¨¡å¼)ã€è®¿é—®è€…æ¨¡å¼ã€‚ ç±»å·¥å‚æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ ç±»å·¥å‚æ–¹æ³•çš„å®ç°æ˜¯ä¸ºäº†å‘å®¢æˆ·æä¾›æ–¹ä¾¿ï¼Œå®ƒä»¬å°†åˆ†é…å’Œåˆå§‹åŒ–åˆåœ¨ä¸€ä¸ªæ­¥éª¤ä¸­ï¼Œ è¿”å›è¢«åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶ è¿›è¡Œè‡ªåŠ¨é‡Šæ”¾å¤„ç†ã€‚ è¿™äº›æ–¹æ³•çš„å½¢å¼æ˜¯+ (type)classNameâ€¦ï¼ˆå…¶ä¸­ classNameä¸åŒ…æ‹¬ä»»ä½•å‰ç¼€ï¼‰ã€‚ å·¥å‚æ–¹æ³•å¯èƒ½ä¸ä»…ä»…ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ã€‚å®ƒä»¬ä¸ä½†å¯ä»¥å°†åˆ†é…å’Œåˆå§‹åŒ–åˆåœ¨ä¸€èµ·ï¼Œè¿˜å¯ä»¥ä¸ºåˆå§‹åŒ–è¿‡ç¨‹æä¾›å¯¹ è±¡çš„åˆ†é…ä¿¡æ¯ã€‚ ç±»å·¥å‚æ–¹æ³•çš„å¦ä¸€ä¸ªç›®çš„æ˜¯ä½¿ç±»ï¼ˆæ¯”å¦‚NSWorkspaceï¼‰æä¾›å•ä¾‹ã€‚è™½ ç„¶initâ€¦æ–¹æ³•å¯ä»¥ç¡®è®¤ä¸€ ä¸ªç±»åœ¨æ¯æ¬¡ç¨‹åºè¿è¡Œè¿‡ç¨‹åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œä½†å®ƒéœ€è¦é¦–å…ˆåˆ†é…ä¸€ä¸ªâ€œç”Ÿçš„â€å®ä¾‹ï¼Œç„¶åè¿˜å¿…é¡»é‡Šæ”¾è¯¥å®ä¾‹ã€‚å·¥å‚æ–¹æ³•åˆ™å¯ä»¥é¿å…ä¸ºå¯èƒ½æ²¡æœ‰ç”¨çš„å¯¹è±¡ç›²ç›®åˆ†é…å†…å­˜ã€‚ å•ä¾‹æ˜¯ä»€ä¹ˆï¼Ÿå•ä¾‹æ¨¡å¼çš„æ„æ€å°±æ˜¯åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å•ä¾‹æ¨¡å¼ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ã€‚è¿™ä¸ªç±»ç§°ä¸ºå•ä¾‹ç±»ã€‚ å•ä¾‹æ¨¡å¼çš„è¦ç‚¹ï¼š æ˜¾ç„¶å•ä¾‹æ¨¡å¼çš„è¦ç‚¹æœ‰ä¸‰ä¸ªï¼›ä¸€æ˜¯æŸä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼›äºŒæ˜¯å®ƒå¿…é¡»è‡ªè¡Œåˆ›å»ºè¿™ä¸ªå®ä¾‹ï¼›ä¸‰æ˜¯å®ƒå¿…é¡»è‡ªè¡Œå‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹ã€‚ å•ä¾‹æ¨¡å¼çš„ä¼˜ç‚¹ï¼š å®ä¾‹æ§åˆ¶ï¼šSingleton ä¼šé˜»æ­¢å…¶ä»–å¯¹è±¡å®ä¾‹åŒ–å…¶è‡ªå·±çš„ Singleton å¯¹è±¡çš„å‰¯æœ¬ï¼Œä»è€Œç¡®ä¿æ‰€æœ‰å¯¹è±¡éƒ½è®¿é—®å”¯ä¸€å®ä¾‹ã€‚ çµæ´»æ€§ï¼šå› ä¸ºç±»æ§åˆ¶äº†å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ‰€ä»¥ç±»å¯ä»¥æ›´åŠ çµæ´»ä¿®æ”¹å®ä¾‹åŒ–è¿‡ç¨‹ æ‰‹å†™ä¸€ä¸‹å•ä¾‹æ–¹æ³•(æˆ–è€…å•ä¾‹æ¨¡å¼çš„è®¾è®¡ï¼šGCD æ–¹å¼å’ŒåŒæ­¥é”æ–¹å¼çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿunlock å‘¢ï¼ŸGCD æ˜¯æ€ä¹ˆä¿è¯å•ä¾‹çš„ï¼Ÿ)image ç®€è¦æè¿°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¹¶è¿ç”¨æ­¤æ¨¡å¼ç¼–å†™ä¸€æ®µä»£ç ï¼Ÿ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰æ˜¯æŒ‡ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡å¯¹å¦ä¸€ä¸ªå¯¹è±¡è¿›è¡Œè§‚å¯Ÿï¼Œå½“è¢«è§‚å¯Ÿå¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§‚å¯Ÿè€…å¯ä»¥ç›´æ¥æˆ–é—´æ¥åœ°å¾—åˆ°é€šçŸ¥ï¼Œä»è€Œèƒ½è‡ªåŠ¨åœ°æ›´æ–°è§‚å¯Ÿè€…çš„æ•°æ®ï¼Œæˆ–è€…è¿›è¡Œä¸€äº›æ“ä½œã€‚ å…·ä½“åˆ°iOSçš„å¼€å‘ä¸­ï¼Œå®ç°è§‚å¯Ÿè€…æ¨¡å¼å¸¸ç”¨çš„æ–¹å¼æœ‰KVOå’ŒNotificationä¸¤ç§ã€‚ ä¸¤è€…çš„ä¸åŒåœ¨äºï¼ŒKVOæ˜¯è¢«è§‚å¯Ÿè€…ä¸»åŠ¨å‘è§‚å¯Ÿè€…å‘é€æ¶ˆæ¯ï¼›Notificationæ˜¯è¢«è§‚å¯Ÿè€…å‘NotificationCenterå‘é€æ¶ˆæ¯ï¼Œå†ç”±NotificationCenter posté€šçŸ¥åˆ°æ¯ä¸ªæ³¨å†Œçš„è§‚å¯Ÿè€…ã€‚ è°ˆè°ˆä½ å¯¹MVCçš„ç†è§£?ä¸ºä»€ä¹ˆè¦ç”¨MVC?åœ¨Cocoaä¸­MVCæ˜¯æ€ä¹ˆå®ç°çš„?ä½ è¿˜ç†Ÿæ‚‰å…¶ä»–çš„OCè®¾è®¡æ¨¡å¼æˆ–åˆ«çš„è®¾è®¡æ¨¡å¼å—? MVCå°±æ˜¯Model-View-Controllerçš„ç¼©å†™,MæŒ‡çš„æ˜¯ä¸šåŠ¡æ¨¡å‹,VæŒ‡çš„æ˜¯ç”¨æˆ·é¡µé¢,CæŒ‡çš„æ˜¯æ§åˆ¶å™¨ã€‚MVCæ˜¯æ¶æ„æ¨¡å¼,æ˜¯è®²Må’ŒVçš„ä»£ç åˆ†ç¦»,ä»è€Œä½¿åŒé‚£ä¸ªä¸€ä¸ªç¨‹åºå¯ä»¥ä½¿ç”¨ä¸åŒçš„è¡¨ç°å½¢å¼ã€‚ å•ä¾‹,ä»£ç†,è§‚å¯Ÿè€…,å·¥å‚æ¨¡å¼ç­‰ å•ä¾‹æ¨¡å¼:ä¸Šé¢æœ‰è¯¦ç»†è¯´æ˜ ä»£ç†æ¨¡å¼:ä»£ç†æ¨¡å¼ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡,å¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹æºå¯¹è±¡çš„å¼•ç”¨.æ¯”å¦‚ä¸€ä¸ªå·¥å‚ç”Ÿäº§äº†äº§å“,å¹¶ä¸æƒ³ç›´æ¥å–ç»™ç”¨æˆ·,è€Œæ˜¯æäº†å¾ˆå¤šä»£ç†å•†,ç”¨æˆ·å¯ä»¥ç›´æ¥æ‰¾ä»£ç†å•†ä¹°ä¸œè¥¿,ä»£ç†å•†ä»å·¥å‚è¿›è´§.å¸¸è§çš„å¦‚QQçš„è‡ªåŠ¨å›å¤å°±å±äºä»£ç†æ‹¦æˆª,ä»£ç†æ¨¡å¼åœ¨iphoneä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨. MVCä¼˜ç‚¹ä¸æ­£ç¡®çš„æ˜¯A ä½è€¦åˆæ€§ B é«˜é‡ç”¨æ€§å’Œå¯é€‚ç”¨æ€§ C è¾ƒä½çš„ç”Ÿå‘½å‘¨æœŸæˆæœ¬ D ä»£ç é«˜æ•ˆç‡ å‚è€ƒç­”æ¡ˆï¼šD ç†ç”±ï¼šMVCåªæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒçš„å‡ºç°æœ‰æ¯”è¾ƒä¹…çš„å†å²äº†ã€‚Model-Controller-Viewæ˜¯åœ¨å¼€å‘ä¸­æœ€å¸¸è§åˆ°çš„è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡å°†Modelã€Viewã€Controllerä¸‰è€…ç›¸äº’è”ç³»ï¼Œä»¥Modelä½œä¸ºæ•°æ®åŠ å·¥å‚ï¼Œä»¥Controllerä½œä¸ºæ¡¥æ¢ï¼Œå¤„ç†ä¸šåŠ¡ï¼Œè€ŒViewåªæ˜¯æ•°æ®å±•ç¤ºå±‚ï¼Œç†åº”ä¸ä¸šåŠ¡æ— å…³ã€‚MVCè®¾è®¡æ¨¡å¼é™ä½äº†è€¦åˆæ€§ï¼Œæä¾›äº†é‡ç”¨æ€§å’Œé€‚ç”¨æ€§ï¼Œå¯æœ‰æ•ˆåœ°æé«˜å¼€å‘æ•ˆç‡ã€‚ å¦‚ä½•ç†è§£MVVMæ¡†æ¶ï¼Œå®ƒçš„ä¼˜ç‚¹å’Œç¼ºç‚¹åœ¨å“ªï¼Ÿè¿ç”¨æ­¤æ¡†æ¶ç¼–å†™ä¸€æ®µä»£ç ï¼Œå»ºè®®é‡‡ç”¨ReactiveCocoaåº“å®ç°ï¼› MVVMæ¡†æ¶ç›¸å¯¹äºä¼ ç»Ÿçš„MVCæ¥è¯´ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæŠŠåŸæœ¬åœ¨Cä¸­ï¼ˆViewControllerï¼‰çš„ä¸šåŠ¡é€»è¾‘ã€ç½‘ç»œè¯·æ±‚ã€æ•°æ®å­˜å‚¨ç­‰æ“ä½œå’Œè¡¨ç°é€»è¾‘ï¼Œåˆ†ç¦»åˆ°ViewModelä¸­ï¼Œä»è€Œä½¿ViewControllerå¾—åˆ°ç²¾ç®€ MVCä¸­ï¼ŒControlleråŒæ—¶æ“ä½œModelå’ŒViewï¼›MVVMä¸­ï¼ŒViewModelä½œä¸ºä¸€ä¸ªè¿‡æ¸¡ï¼ŒModelçš„æ•°æ®è·å–å’ŒåŠ å·¥ç”±ViewModelè´Ÿè´£ï¼Œå¾—åˆ°é€‚åˆViewçš„æ•°æ®ï¼Œåˆ©ç”¨ç»‘å®šæœºåˆ¶ï¼Œä½¿å¾—Viewå¾—ä»¥è‡ªåŠ¨æ›´æ–°ã€‚ ä¼˜ç‚¹ï¼š å±‚æ¬¡æ›´åŠ åˆ†æ˜æ¸…æ™° ä»£ç ç®€æ´ä¼˜é›… å‡å°‘VCçš„å¤æ‚æ€§ ä»£ç å’Œç•Œé¢å®Œå…¨åˆ†ç¦» æ–¹ä¾¿æµ‹è¯• ç¼ºç‚¹ï¼š MVVMéœ€è¦ä½¿ç”¨æ•°æ®ç»‘å®šæœºåˆ¶ï¼Œå¯¹äºOS X å¼€å‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Coocoa Bindingï¼Œå¯¹äºiOSï¼Œæ²¡æœ‰å¤ªå¥½çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨KVOï¼Œä½†å¦‚æœéœ€è¦ç»‘å®šçš„å±æ€§å¤ªå¤šçš„è¯ï¼Œéœ€è¦ç¼–å†™å¤§é‡çš„selectorä»£ç ã€‚ ReactiveCocoaæä¾›äº†ä¸€ç§å¾ˆæ–¹ä¾¿ä¼˜é›…çš„ç»‘å®šæœºåˆ¶ã€‚ ReactiveCocoa RACå…·æœ‰å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹çš„ç‰¹æ€§ è¯•å›¾è§£å†³ä»¥ä¸‹é—®é¢˜ ä¼ ç»ŸiOSå¼€å‘è¿‡ç¨‹ä¸­ï¼ŒçŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´ä¾èµ–è¿‡å¤šçš„é—®é¢˜ ä¼ ç»ŸMVCæ¶æ„çš„é—®é¢˜ï¼šControlleræ¯”è¾ƒå¤æ‚ï¼Œå¯æµ‹è¯•æ€§å·® æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ å“ªäº›é€”å¾„å¯ä»¥è®© ViewController ç˜¦ä¸‹æ¥ï¼Ÿ æŠŠ Data Source å’Œå…¶ä»– Protocols åˆ†ç¦»å‡ºæ¥(å°†UITableViewæˆ–è€…UICollectionViewçš„ä»£ç æå–å‡ºæ¥æ”¾åœ¨å…¶ä»–ç±»ä¸­) å°†ä¸šåŠ¡é€»è¾‘ç§»åˆ° Model ä¸­(å’Œæ¨¡å‹æœ‰å…³çš„é€»è¾‘å…¨éƒ¨åœ¨modelä¸­å†™) æŠŠç½‘ç»œè¯·æ±‚é€»è¾‘ç§»åˆ° Model å±‚(ç½‘ç»œè¯·æ±‚ä¾é æ¨¡å‹) æŠŠ View ä»£ç ç§»åˆ° View å±‚(è‡ªå®šä¹‰View) ä½ åœ¨ä½ çš„é¡¹ç›®ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿé¡¹ç›®ä¸­ä½¿ç”¨äº†å¾ˆå¤šçš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ç›¸ä¿¡é¢è¯•å®˜æœ€å¥½å¬åˆ°çš„ä¸ä»…ä»…æ˜¯è®¾è®¡æ¨¡å¼çš„åå­—ï¼Œæ›´æƒ³å¬åˆ°çš„æ˜¯è¿™äº›è®¾è®¡æ¨¡å¼åœ¨é¡¹ç›®ä¸­å¦‚ä½•åº”ç”¨ã€‚å› æ­¤ï¼Œç¬”è€…è®¤ä¸ºè¿™ä¸ªé—®é¢˜éšå¼åœ°è¯´æ˜äº†åº”è¯¥å›ç­”è®¾è®¡æ¨¡å¼åŠå…¶åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨ã€‚ å‚è€ƒç­”æ¡ˆï¼š â€¢ å•ä¾‹è®¾è®¡æ¨¡å¼ï¼šåœ¨é¡¹ç›®ä¸­ï¼Œå•ä¾‹æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æ¯”å¦‚UIApplicationã€NSUserDefaultså°±æ˜¯è‹¹æœæä¾›çš„å•ä¾‹ã€‚åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šå°†ç”¨æˆ·æ•°æ®ç®¡ç†å°è£…æˆä¸€ä¸ªå•ä¾‹ç±»ï¼Œå› æ­¤ç”¨æˆ·çš„ä¿¡æ¯éœ€è¦å…¨å±€ä½¿ç”¨ã€‚ â€¢ MVCè®¾è®¡æ¨¡å¼ï¼šç°åœ¨ç»å¤§éƒ¨åˆ†é¡¹ç›®éƒ½æ˜¯åŸºäºMVCè®¾è®¡æ¨¡å¼çš„ï¼Œç°åœ¨æœ‰ä¸€éƒ¨åˆ†å¼€å‘è€…é‡‡ç”¨MVVMã€MVPç­‰æ¨¡å¼ã€‚ â€¢ é€šçŸ¥(NSNotification)æ¨¡å¼ï¼šé€šçŸ¥åœ¨å¼€å‘ä¸­æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå¯¹äºè·¨æ¨¡å—çš„ç±»äº¤äº’ï¼Œéœ€è¦ä½¿ç”¨é€šçŸ¥ï¼›å¯¹äºå¤šå¯¹å¤šçš„å…³ç³»ï¼Œä½¿ç”¨é€šçŸ¥æ›´å¥½å®ç°ã€‚ â€¢ å·¥å‚è®¾è®¡æ¨¡å¼ï¼šåœ¨æˆ‘çš„é¡¹ç›®ä¸­ä½¿ç”¨äº†å¤§é‡çš„å·¥å‚è®¾è®¡æ¨¡å¼ï¼Œç‰¹åˆ«æ˜¯ç”Ÿæˆæ§ä»¶çš„APIï¼Œéƒ½å·²ç»å°è£…æˆä¸€å¥—ï¼Œå…¨éƒ¨æ˜¯æ‰©å±•çš„ç±»æ–¹æ³•ï¼Œå¯ç®€åŒ–å¾ˆå¤šçš„ä»£ç ã€‚ â€¢ KVC/KVOè®¾è®¡æ¨¡å¼ï¼šæœ‰çš„æ—¶å€™éœ€è¦ç›‘å¬æŸä¸ªç±»çš„å±æ€§å€¼çš„å˜åŒ–è€Œåšå‡ºç›¸åº”çš„æ”¹å˜ï¼Œè¿™æ—¶å€™ä¼šä½¿ç”¨KVC/KVOè®¾è®¡æ¨¡å¼ã€‚åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘éœ€è¦ç›‘å¬modelä¸­çš„æŸä¸ªå±æ€§å€¼çš„å˜åŒ–ï¼Œå½“å˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°UIæ˜¾ç¤ºï¼Œè¿™æ—¶å€™ä½¿ç”¨KVC/KVOè®¾è®¡æ¨¡å¼å°±å¾ˆæ–¹ä¾¿äº†ã€‚ å°±è¯´è¿™ä¹ˆå¤šå§ï¼Œè¿˜æœ‰å¾ˆå¤šçš„è®¾è®¡æ¨¡å¼ï¼Œä¸è¿‡å…¶å®ƒå¹¶ä¸æ˜¯é‚£ä¹ˆå¸¸ç”¨ã€‚ å¦‚ä½•å®ç°å•ä¾‹ï¼Œå•ä¾‹ä¼šæœ‰ä»€ä¹ˆå¼Šç«¯ï¼Ÿå•ä¾‹åœ¨é¡¹ç›®ä¸­çš„æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œå®ƒå¯ä»¥ä½¿æˆ‘ä»¬å…¨å±€éƒ½å¯å…±äº«æˆ‘ä»¬çš„æ•°æ®ã€‚è¿™åªæ˜¯ç®€å•çš„é—®é¢˜ï¼Œå¤§å®¶æ ¹æ®è‡ªå·±çš„æƒ…å†µå›ç­”ã€‚ å‚è€ƒç­”æ¡ˆï¼š â€¢ é¦–å…ˆï¼Œå•ä¾‹å†™æ³•æœ‰å¥½å‡ ç§ï¼Œé€šå¸¸çš„å†™æ³•æ˜¯åŸºäºçº¿ç¨‹å®‰å…¨çš„å†™æ³•ï¼Œç»“åˆdispatch_onceæ¥ä½¿ç”¨ï¼Œä¿è¯å•ä¾‹å¯¹è±¡åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚å¦‚æœä¸å°å¿ƒé”€æ¯äº†å•ä¾‹ï¼Œå†è°ƒç”¨å•ä¾‹ç”Ÿæˆæ–¹æ³•æ˜¯ä¸ä¼šå†åˆ›å»ºçš„ã€‚ â€¢ å…¶æ¬¡ï¼Œç”±äºå•ä¾‹æ˜¯çº¦å®šä¿—æˆçš„ï¼Œå› æ­¤åœ¨å®é™…å¼€å‘ä¸­é€šå¸¸ä¸ä¼šå»é‡å†™å†…å­˜ç®¡ç†æ–¹æ³•ã€‚ å•ä¾‹ç¡®å®ç»™æˆ‘ä»¬å¸¦æ¥çš„ä¾¿åˆ©ï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šæœ‰ä»£ä»·çš„ã€‚å•ä¾‹ä¸€æ—¦åˆ›å»ºï¼Œæ•´ä¸ªAppä½¿ç”¨è¿‡ç¨‹éƒ½ä¸ä¼šé‡Šæ”¾ï¼Œè¿™ä¼šå ç”¨å†…å­˜ï¼Œå› æ­¤ä¸å¯æ»¥ç”¨å•ä¾‹ã€‚ ä½ åœ¨ä½ çš„é¡¹ç›®ä¸­ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ è®¾è®¡æ¨¡å¼æœ‰å¾ˆå¤š,é¢è¯•å®˜è‚¯å®šä¸æƒ³å¬ä½ æŠŠé¡¹ç›®é‡Œçš„è®¾è®¡æ¨¡å¼åå­—æŠ¥ç»™ä»–,ä»–æƒ³å¬å¾—è‚¯å®šæ˜¯ä½ æ˜¯æ€ä¹ˆå»ç”¨è¿™äº›è®¾è®¡æ¨¡å¼çš„ å‚è€ƒç­”æ¡ˆ: MVC:è¿™ä¸ªè®¾è®¡æ¨¡å‹å¤§éƒ¨åˆ†åº”ç”¨åº”è¯¥éƒ½åœ¨ç”¨,ä»‹ç»ä¸‹MVCå°±å¥½ å•ä¾‹:å•ä¾‹åœ¨é¡¹ç›®ä¸­ç”¨çš„è¿˜æ˜¯è›®å¤šçš„,åƒç™»å½•ç•Œé¢,å¯¹ä¸€äº›ç¬¬ä¸‰æ–¹æ¡†æ¶äºŒæ¬¡å°è£…ç­‰ç­‰ KVC/KVO:è¿™ä¸ªç”¨çš„åº”è¯¥ä¹Ÿå¾ˆå¤š,KVCç”¨æ¥æ›¿æ¢æ‰ç³»ç»Ÿçš„tabbar,ç”¨KVOæ¥ç›‘å¬åç§»é‡æ¥å®Œæˆä¸‹æ‹‰åˆ·æ–°,æ”¹å˜å¯¼èˆªæ¡èƒŒæ™¯é¢œè‰²è¿™äº› å·¥å‚æ–¹æ³•:è¿™ä¸ªç”¨çš„æ›´å¤šäº†,è®¾ç½®ä¸€äº›è‡ªå®šä¹‰Viewè‚¯å®šè¦ç”¨åˆ°è¿™ä¸ªè®¾è®¡æ¨¡å¼ å¦‚ä½•å®ç°å•ä¾‹ï¼Œå•ä¾‹ä¼šæœ‰ä»€ä¹ˆå¼Šç«¯ï¼Ÿ è¿™ä¸ªé—®é¢˜è¿˜æ˜¯è›®ç®€å•çš„,è¯´ä¸‹å•ä¾‹æ˜¯æ€ä¹ˆå†™çš„,å•ä¾‹çš„ç¼ºç‚¹å°±å¥½ å‚è€ƒç­”æ¡ˆ: // OCç‰ˆ +(instancetype)sharedInstance { static id sharedInstance = nil; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ sharedInstance = [[self alloc] init]; }); return sharedInstance; } // Swiftç‰ˆ static let sharedInstance : &lt;#SingletonClass#&gt; = &lt;#SingletonClass#&gt;() å•ä¾‹çš„ç¼ºç‚¹ä¹Ÿå°±æ˜¯ä¼šä¸€ç›´å ç€è¿™å—å†…å­˜,ä¸ä¼šè¢«é‡Šæ”¾ å•ä¾‹ä¹¦å†™ ä¼ªå•ä¾‹ 1ã€ è·å–å•ä¾‹å¯¹è±¡çš„æ–¹æ³• + (DataHandle *)sharedDataHandle; // åˆ›å»ºå•ä¾‹å¯¹è±¡çš„æ–¹æ³•ã€‚ç±»æ–¹æ³• å‘½åè§„åˆ™ï¼š shared + ç±»å 2ã€ æ–¹æ³•çš„å®ç° // å› ä¸ºå®ä¾‹æ˜¯å…¨å±€çš„ å› æ­¤è¦å®šä¹‰ä¸ºå…¨å±€å˜é‡ï¼Œä¸”éœ€è¦å­˜å‚¨åœ¨é™æ€åŒºï¼Œä¸é‡Šæ”¾ã€‚ä¸èƒ½å­˜å‚¨åœ¨æ ˆåŒºã€‚ static DataHandle *handle = nil; // ä¼ªå•ä¾‹ å’Œ å®Œæ•´çš„å•ä¾‹ã€‚ ä»¥åŠçº¿ç¨‹çš„å®‰å…¨ã€‚ // ä¸€èˆ¬ä½¿ç”¨ä¼ªå•ä¾‹å°±è¶³å¤Ÿäº† æ¯æ¬¡éƒ½ç”¨ sharedDataHandle åˆ›å»ºå¯¹è±¡ã€‚ + (DataHandle *)sharedDataHandle { // æ·»åŠ åŒæ­¥é”ï¼Œä¸€æ¬¡åªèƒ½ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œç­‰å¾…ã€‚ä¸€ä¸ªè®¿é—®ç»“æŸåä¸‹ä¸€ä¸ªã€‚ @synchronized(self){ if (nil == handle) { handle = [[DataHadle alloc] init]; } } return handle; } å®Œæ•´å•ä¾‹ å®Œæ•´çš„å•ä¾‹ å®Œæ•´çš„å•ä¾‹è¦æ±‚æ¯”è¾ƒé«˜ï¼Œä¸ä»…è¦æ±‚æˆ‘ä»¬é€šè¿‡æ–¹æ³•è·å–çš„å¯¹è±¡æ˜¯å•ä¾‹ï¼Œå¦‚æœæœ‰ å¯¹è¯¥å¯¹è±¡è¿›è¡Œcopy mutableCopy copyWithZone ç­‰æ“ä½œæ—¶ï¼Œä¹Ÿæ˜¯åŒä¸€ä»½å¯¹è±¡ã€‚è¿™å°±è¦æ±‚æˆ‘ä»¬å¿…é¡»é‡å†™è¿™äº›æ–¹æ³•ï¼Œåœ¨è¿™äº›æ–¹æ³•å†…éƒ¨åšä¸€äº›æ“ä½œã€‚ å®Œæ•´çš„å•ä¾‹è¦åšåˆ°å››ä¸ªæ–¹é¢ï¼š ä¸ºå•ä¾‹å¯¹è±¡å®ç°ä¸€ä¸ªé™æ€å®ä¾‹,ç„¶åè®¾ç½®æˆnilï¼Œ æ„é€ æ–¹æ³•æ£€æŸ¥é™æ€å®ä¾‹æ˜¯å¦ä¸ºnilï¼Œæ˜¯åˆ™æ–°å»ºå¹¶è¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œ é‡å†™allocWithZoneæ–¹æ³•ï¼Œç”¨æ¥ä¿è¯å…¶ä»–äººç›´æ¥ä½¿ç”¨allocå’Œinitè¯•å›¾è·å¾—ä¸€ä¸ªæ–°å®ä¾‹çš„æ—¶å€™ä¸ä¼šäº§ç”Ÿä¸€ä¸ªæ–°å®ä¾‹ï¼Œ é€‚å½“å®ç°copyWithZoneï¼Œ,retain,retainCount,releaseå’Œautorelease ç­‰æ–¹æ³• 1ã€ è·å–å•ä¾‹å¯¹è±¡çš„æ–¹æ³• + (DataHandle *)sharedDataHandle; // åˆ›å»ºå•ä¾‹å¯¹è±¡çš„æ–¹æ³•ã€‚ç±»æ–¹æ³• å‘½åè§„åˆ™ï¼š shared + ç±»å 2ã€ æ–¹æ³•çš„å®ç° @synchronized(self){ if (nil == handle) { handle = [[super allocWithZone:nil] init]; // é¿å…æ­»å¾ªç¯ // å¦‚æœ åœ¨å•ä¾‹ç±»é‡Œé¢é‡å†™äº† allocWithZone æ–¹æ³• ï¼Œåœ¨åˆ›å»ºå•ä¾‹å¯¹è±¡æ—¶ ä½¿ç”¨ [[DataHandle alloc] init] åˆ›å»ºï¼Œä¼šæ­»å¾ªç¯ã€‚ } } return handle; 3ã€ é‡å†™ allocWithZone copy mutableCopy copyWithZone é˜²æ­¢å¤–ç•Œæ‹·è´é€ æˆå¤šä¸ªå®ä¾‹ï¼Œ ä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§ã€‚ æ³¨æ„ï¼šå¦‚æœè‡ªå·±é‡å†™äº† allocWithZone å°±ä¸è¦å†è°ƒç”¨è‡ªèº«çš„ alloc æ–¹æ³•ï¼Œå¦åˆ™ä¼šå‡ºç°æ­»å¾ªç¯ã€‚ + (instancetype)allocWithZone:(struct _NSZone *)zone { return [DataHandle sharedDataHandle]; } - (id)copy { return self; } - (id)mutableCopy { return self; } + (id)copyWithZone:(struct _NSZone *)zone { return self; } 4ã€ é‡å†™ alloc retain release autorelease retainCount + (instancetype)alloc { return [DataHandle sharedDataHandle]; } // å› ä¸ºåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œ ä¸€ç›´ä¸é‡Šæ”¾ï¼Œæ‰€ä»¥ä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚æ— æ„ä¹‰ã€‚ - (instancetype)retain { return self; } - (oneway void)release { // nothing } - (instancetype)autorelease { return self; } - (NSUInteger)retainCount { return NSUIntegerMax; // è¿”å›æ•´å½¢æœ€å¤§å€¼ã€‚ }]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜18--å¤šåª’ä½“]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9818-%E5%A4%9A%E5%AA%92%E4%BD%93%2F</url>
    <content type="text"><![CDATA[iPhone OSä¸»è¦æä¾›äº†å‡ ç§æ’­æ”¾éŸ³é¢‘çš„æ–¹æ³•ï¼ŸSystemSound Services AVAudioPlayer ç±» Audio Queue Services OpenAL ä½¿ç”¨AVAudioPlayerç±»è°ƒç”¨å“ªä¸ªæ¡†æ¶ã€ä½¿ç”¨æ­¥éª¤ï¼ŸAVFoundation.framework æ­¥éª¤ï¼šé…ç½® AVAudioPlayer å¯¹è±¡ï¼› å®ç° AVAudioPlayer ç±»çš„å§”æ‰˜æ–¹æ³•ï¼› æ§åˆ¶ AVAudioPlayer ç±»çš„å¯¹è±¡ï¼› ç›‘æ§éŸ³é‡æ°´å¹³ï¼› å›æ”¾è¿›åº¦å’Œæ‹–æ‹½æ’­æ”¾ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜17--å¤šçº¿ç¨‹]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9817-%E5%A4%9A%E7%BA%BF%E7%A8%8B%2F</url>
    <content type="text"><![CDATA[ä½ ä»¬é¡¹ç›®ä¸­ä¸ºä»€ä¹ˆå¤šçº¿ç¨‹ç”¨GCDè€Œä¸ç”¨NSOperationå‘¢? ä½ æœ‰æ²¡æœ‰å‘ç°å›½å¤–çš„å¤§ç‰›ä»–ä»¬å¤šçº¿ç¨‹éƒ½æ˜¯ç”¨NSOperation? ä½ èƒ½å‘Šè¯‰æˆ‘ä»–ä»¬è¿™æ ·åšçš„ç†ç”±å—?å…³ç³»: â‘ :å…ˆææ¸…ä¸¤è€…çš„å…³ç³»,NSOpertaionQueueç”¨GCDæ„å»ºå°è£…çš„ï¼Œæ˜¯GCDçš„é«˜çº§æŠ½è±¡! â‘¡:GCDä»…ä»…æ”¯æŒFIFOé˜Ÿåˆ—ï¼Œè€ŒNSOperationQueueä¸­çš„é˜Ÿåˆ—å¯ä»¥è¢«é‡æ–°è®¾ç½®ä¼˜å…ˆçº§ï¼Œä»è€Œå®ç°ä¸åŒæ“ä½œçš„æ‰§è¡Œé¡ºåºè°ƒæ•´ã€‚GCDä¸æ”¯æŒå¼‚æ­¥æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»è®¾ç½®ã€‚å¦‚æœæŸä¸ªæ“ä½œçš„ä¾èµ–å¦ä¸€ä¸ªæ“ä½œçš„æ•°æ®ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼‰ï¼Œä½¿ç”¨NSOperationQueueèƒ½å¤ŸæŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ‰§è¡Œæ“ä½œã€‚GCDåˆ™æ²¡æœ‰å†…å»ºçš„ä¾èµ–å…³ç³»æ”¯æŒã€‚ â‘¢:NSOperationQueueæ”¯æŒKVOï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚ äº†è§£ä»¥ä¸Šä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹è§’åº¦æ¥å›ç­” æ€§èƒ½:â‘ :GCDæ›´æ¥è¿‘åº•å±‚ï¼Œè€ŒNSOperationQueueåˆ™æ›´é«˜çº§æŠ½è±¡ï¼Œæ‰€ä»¥GCDåœ¨è¿½æ±‚æ€§èƒ½çš„åº•å±‚æ“ä½œæ¥è¯´ï¼Œæ˜¯é€Ÿåº¦æœ€å¿«çš„ã€‚è¿™å–å†³äºä½¿ç”¨Instrumentsè¿›è¡Œä»£ç æ€§èƒ½åˆ†æï¼Œå¦‚æœ‰å¿…è¦çš„è¯ â‘¡:ä»å¼‚æ­¥æ“ä½œä¹‹é—´çš„äº‹åŠ¡æ€§ï¼Œé¡ºåºè¡Œï¼Œä¾èµ–å…³ç³»ã€‚GCDéœ€è¦è‡ªå·±å†™æ›´å¤šçš„ä»£ç æ¥å®ç°ï¼Œè€ŒNSOperationQueueå·²ç»å†…å»ºäº†è¿™äº›æ”¯æŒ â‘¢:å¦‚æœå¼‚æ­¥æ“ä½œçš„è¿‡ç¨‹éœ€è¦æ›´å¤šçš„è¢«äº¤äº’å’ŒUIå‘ˆç°å‡ºæ¥ï¼ŒNSOperationQueueä¼šæ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ã€‚åº•å±‚ä»£ç ä¸­ï¼Œä»»åŠ¡ä¹‹é—´ä¸å¤ªäº’ç›¸ä¾èµ–ï¼Œè€Œéœ€è¦æ›´é«˜çš„å¹¶å‘èƒ½åŠ›ï¼ŒGCDåˆ™æ›´æœ‰ä¼˜åŠ¿ æœ€åçš„ä¸€å¥è¯:åˆ«å¿˜äº†é«˜å¾·çº³çš„æ•™è¯²ï¼šâ€œåœ¨å¤§æ¦‚97%çš„æ—¶é—´é‡Œï¼Œæˆ‘ä»¬åº”è¯¥å¿˜è®°å¾®å°çš„æ€§èƒ½æå‡ã€‚è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºã€‚â€åªæœ‰Instrumentsæ˜¾ç¤ºæœ‰çœŸæ­£çš„æ€§èƒ½æå‡æ—¶æ‰æœ‰å¿…è¦ç”¨ä½çº§çš„GCDã€‚ è¯¦è§£GCDæ­»é”unixä¸Šè¿›ç¨‹æ€ä¹ˆé€šä¿¡ï¼Ÿ UNIXä¸»è¦æ”¯æŒä¸‰ç§é€šä¿¡æ–¹å¼ï¼š åŸºæœ¬é€šä¿¡ï¼šä¸»è¦ç”¨æ¥åè°ƒè¿›ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥ é”æ–‡ä»¶é€šä¿¡:é€šä¿¡çš„åŒæ–¹é€šè¿‡æŸ¥æ‰¾ç‰¹å®šç›®å½•ä¸‹ç‰¹å®šç±»å‹çš„æ–‡ä»¶(ç§°é”æ–‡ä»¶)æ¥å®Œæˆè¿›ç¨‹é—´ å¯¹ä¸´ç•Œèµ„æºè®¿é—®æ—¶çš„äº’æ–¥ï¼›ä¾‹å¦‚è¿›ç¨‹p1è®¿é—®ä¸€ä¸ªä¸´ç•Œèµ„æºï¼Œé¦–å…ˆæŸ¥çœ‹æ˜¯å¦æœ‰ä¸€ä¸ªç‰¹å®šç±»å‹æ–‡ä»¶ï¼Œè‹¥æœ‰ï¼Œåˆ™ç­‰å¾…ä¸€æ®µæ—¶é—´å†æŸ¥æ‰¾é”æ–‡ä»¶ã€‚ è®°å½•é”æ–‡ä»¶ ç®¡é“é€šä¿¡ï¼šé€‚åº”å¤§æ‰¹é‡çš„æ•°æ®ä¼ é€’ IPC ï¼šé€‚åº”å¤§æ‰¹é‡çš„æ•°æ®ä¼ é€’ åˆ—ä¸¾å‡ ç§è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶ã€è¿›ç¨‹çš„é€šä¿¡é€”å¾„ã€æ­»é”åŠæ­»é”çš„å¤„ç†æ–¹æ³•ã€‚ è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶åŸå­æ“ä½œ ä¿¡å·é‡æœºåˆ¶ è‡ªæ—‹é” ç®¡ç¨‹ï¼Œä¼šåˆï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿ è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„é€”å¾„ï¼šå…±äº«å­˜å‚¨ç³»ç»Ÿæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿç®¡é“ï¼šä»¥æ–‡ä»¶ç³»ç»Ÿä¸ºåŸºç¡€ è¿›ç¨‹æ­»é”çš„åŸå› ï¼šèµ„æºç«äº‰åŠè¿›ç¨‹æ¨è¿›é¡ºåºéæ³• æ­»é”çš„4ä¸ªå¿…è¦æ¡ä»¶ï¼šäº’æ–¥ã€è¯·æ±‚ä¿æŒã€ä¸å¯å‰¥å¤ºã€ç¯è·¯ æ­»é”çš„å¤„ç†ï¼šé¸µé¸Ÿç­–ç•¥ã€é¢„é˜²ç­–ç•¥ã€é¿å…ç­–ç•¥ã€æ£€æµ‹ä¸è§£é™¤æ­»é” çº¿ç¨‹ä¸è¿›ç¨‹çš„åŒºåˆ«å’Œè”ç³»? çº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬å•ä½ã€‚ è¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯ç”±æ“ä½œç³»ç»Ÿæ‰€äº§ç”Ÿçš„ç¨‹åºè¿è¡Œçš„åŸºæœ¬å•å…ƒ,ç³»ç»Ÿåˆ©ç”¨è¯¥åŸºæœ¬å•å…ƒå®ç°ç³»ç»Ÿå¯¹åº”ç”¨çš„å¹¶å‘æ€§ã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„ä¸»è¦å·®åˆ«åœ¨äºå®ƒä»¬æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿèµ„æºç®¡ç†æ–¹å¼ã€‚ è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´,ä¸€ä¸ªè¿›ç¨‹å´©æºƒå,åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ã€‚ çº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„ã€‚ çº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡,ä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´,ä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰,æ‰€ä»¥å¤šè¿›ç¨‹çš„ç¨‹åºè¦æ¯”å¤šçº¿ç¨‹çš„ç¨‹åºå¥å£®,ä½†åœ¨è¿›ç¨‹åˆ‡æ¢æ—¶,è€—è´¹èµ„æºè¾ƒå¤§,æ•ˆç‡è¦å·®ä¸€äº›ã€‚ ä½†å¯¹äºä¸€äº›è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”åˆè¦å…±äº«æŸäº›å˜é‡çš„å¹¶å‘æ“ä½œ,åªèƒ½ç”¨çº¿ç¨‹,ä¸èƒ½ç”¨è¿›ç¨‹ã€‚ iOSçº¿ç¨‹é—´æ€ä¹ˆé€šä¿¡ï¼Ÿ performSelector:onThread:withObject:waitUntilDone: NSMachPort (åŸºæœ¬æœºåˆ¶ï¼šAçº¿ç¨‹ï¼ˆçˆ¶çº¿ç¨‹ï¼‰åˆ›å»ºNSMachPortå¯¹è±¡ï¼Œå¹¶åŠ å…¥Açº¿ç¨‹çš„runloopã€‚å½“åˆ›å»ºBçº¿ç¨‹ï¼ˆè¾…åŠ©çº¿ç¨‹ï¼‰æ—¶ï¼Œå°†åˆ›å»ºçš„NSMachPortå¯¹è±¡ä¼ é€’åˆ°ä¸»ä½“å…¥å£ç‚¹ï¼ŒBçº¿ç¨‹ï¼ˆè¾…åŠ©çº¿ç¨‹ï¼‰å°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç«¯å£å¯¹è±¡å°†æ¶ˆæ¯ä¼ å›Açº¿ç¨‹ï¼ˆçˆ¶çº¿ç¨‹ï¼‰ã€‚) iOSå¤šçº¿ç¨‹çš„åº•å±‚å®ç°ï¼Ÿ é¦–å…ˆææ¸…æ¥šä»€ä¹ˆæ˜¯çº¿ç¨‹ã€ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ Machæ˜¯ç¬¬ä¸€ä¸ªä»¥å¤šçº¿ç¨‹æ–¹å¼å¤„ç†ä»»åŠ¡çš„ç³»ç»Ÿï¼Œå› æ­¤å¤šçº¿ç¨‹çš„åº•å±‚å®ç°æœºåˆ¶æ˜¯åŸºäºMachçš„çº¿ç¨‹ å¼€å‘ä¸­å¾ˆå°‘ç”¨Machçº§çš„çº¿ç¨‹ï¼Œå› ä¸ºMachçº§çš„çº¿ç¨‹æ²¡æœ‰æä¾›å¤šçº¿ç¨‹çš„åŸºæœ¬ç‰¹å¾ï¼Œçº¿ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ å¼€å‘ä¸­å®ç°å¤šçº¿ç¨‹çš„æ–¹æ¡ˆ Cè¯­è¨€çš„POSIXæ¥å£ï¼š#include &lt;pthread.h&gt; OCçš„NSThread Cè¯­è¨€çš„GCDæ¥å£ï¼ˆæ€§èƒ½æœ€å¥½ï¼Œä»£ç æ›´ç²¾ç®€ï¼‰ OCçš„NSOperationå’ŒNSOperationQueueï¼ˆåŸºäºGCDï¼‰ è°ˆè°ˆå¤šçº¿ç¨‹å®‰å…¨é—®é¢˜çš„å‡ ç§è§£å†³æ–¹æ¡ˆ?ä½•ä¸ºçº¿ç¨‹åŒæ­¥,å¦‚ä½•å®ç°çš„?åˆ†çº¿ç¨‹å›è°ƒä¸»çº¿ç¨‹æ–¹æ³•æ˜¯ä»€ä¹ˆ,æœ‰ä»€ä¹ˆä½œç”¨? è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨é”: é”æ˜¯çº¿ç¨‹ç¼–ç¨‹åŒæ­¥å·¥å…·çš„åŸºç¡€ã€‚é”å¯ä»¥è®©ä½ å¾ˆå®¹æ˜“ä¿æŠ¤ä»£ç ä¸­ä¸€å¤§å—åŒºåŸŸä»¥ä¾¿ä½ å¯ä»¥ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§ã€‚ ä½¿ç”¨POSIXäº’æ–¥é”; ä½¿ç”¨NSLockç±»; ä½¿ç”¨@synchronizedæŒ‡ä»¤ç­‰ã€‚ å›åˆ°ä¸»çº¿ç¨‹çš„æ–¹æ³•: dispatch_async(dispatch_get_main_queue(), ^{ }); ä½œç”¨: ä¸»çº¿ç¨‹æ˜¯æ˜¾ç¤ºUIç•Œé¢,å­çº¿ç¨‹å¤šæ•°æ˜¯è¿›è¡Œæ•°æ®å¤„ç† ä½¿ç”¨atomicä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸æ˜¯çš„ã€‚ atomicåŸå­æ“ä½œï¼Œç³»ç»Ÿä¼šä¸ºsetteræ–¹æ³•åŠ é”ã€‚ å…·ä½“ä½¿ç”¨ @synchronized(self){//code } nonatomicä¸ä¼šä¸ºsetteræ–¹æ³•åŠ é”ã€‚ atomicï¼šçº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦æ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºæ¥ä¸ºå±æ€§åŠ é” nonatomicï¼šéçº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå†…å­˜è¾ƒå°çš„ç§»åŠ¨è®¾å¤‡ ä½¿ç”¨atomicå¹¶ä¸èƒ½ä¿è¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œå¯¹äºè¦ç»å¯¹ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œè¿˜éœ€è¦ä½¿ç”¨æ›´é«˜çº§çš„æ–¹å¼æ¥å¤„ç†ï¼Œæ¯”å¦‚NSSpinLockã€@syncronizedç­‰ è°ˆè°ˆä½ å¯¹å¤šçº¿ç¨‹å¼€å‘çš„ç†è§£(å¤šçº¿ç¨‹çš„å¥½å¤„ï¼Œå¤šçº¿ç¨‹çš„ä½œç”¨)ï¼Ÿiosä¸­æœ‰å‡ ç§å®ç°å¤šçº¿ç¨‹çš„æ–¹æ³•ï¼Ÿ å¥½å¤„ï¼š ä½¿ç”¨çº¿ç¨‹å¯ä»¥æŠŠå æ®æ—¶é—´é•¿çš„ç¨‹åºä¸­çš„ä»»åŠ¡æ”¾åˆ°åå°å»å¤„ç† ç”¨æˆ·ç•Œé¢å¯ä»¥æ›´åŠ å¸å¼•äººï¼Œè¿™æ ·æ¯”å¦‚ç”¨æˆ·ç‚¹å‡»äº†ä¸€ä¸ªæŒ‰é’®å»è§¦å‘æŸäº›äº‹ä»¶çš„å¤„ç†ï¼Œå¯ä»¥å¼¹å‡ºä¸€ä¸ªè¿›åº¦æ¡æ¥æ˜¾ç¤ºå¤„ç†çš„è¿›åº¦ ç¨‹åºçš„è¿è¡Œæ•ˆç‡å¯èƒ½æé«˜ åœ¨ä¸€äº›ç­‰å¾…çš„ä»»åŠ¡å®ç°ä¸Šå¦‚ç”¨æˆ·è¾“å…¥ã€æ–‡ä»¶è¯»å†™å’Œç½‘ç»œæ”¶å‘æ•°æ®ç­‰ï¼Œçº¿ç¨‹å°±æ¯”è¾ƒæœ‰ç”¨äº†ã€‚ ç¼ºç‚¹ï¼š å¦‚æœæœ‰å¤§é‡çš„çº¿ç¨‹,ä¼šå½±å“æ€§èƒ½,å› ä¸ºæ“ä½œç³»ç»Ÿéœ€è¦åœ¨å®ƒä»¬ä¹‹é—´åˆ‡æ¢ã€‚ æ›´å¤šçš„çº¿ç¨‹éœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚ çº¿ç¨‹çš„ä¸­æ­¢éœ€è¦è€ƒè™‘å…¶å¯¹ç¨‹åºè¿è¡Œçš„å½±å“ã€‚ é€šå¸¸å—æ¨¡å‹æ•°æ®æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«çš„ï¼Œéœ€è¦é˜²æ­¢çº¿ç¨‹æ­»é”æƒ…å†µçš„å‘ç”Ÿã€‚ å®ç°å¤šçº¿ç¨‹çš„æ–¹æ³•ï¼š NSObjectçš„ç±»æ–¹æ³• // -(void)performSelectornBackground/OnMainThread:(SEL)aSelector withObject:(id)arg NSThread NSOperation GCD OCä¸­å¼‚æ­¥ä½¿ç”¨çš„å“ªç§äº‹ä»¶æ¨¡å‹,iOSä¸­å¼‚æ­¥å®ç°æœºåˆ¶ å¼‚æ­¥éé˜»å¡ I/Oï¼ˆAIOï¼‰ è¯¦ç»†è°ˆè°ˆGCD æ¨å‡ºçš„æ—¶é—´ iOS4 ç›®çš„æ˜¯ç”¨æ¥å–ä»£NSThreadï¼ˆios2.0æ¨å‡ºï¼‰çš„ï¼Œæ˜¯ Cè¯­è¨€æ¡†æ¶ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨åˆ©ç”¨æ›´å¤šCPUçš„æ ¸æ•°ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚ CGDçš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šä»»åŠ¡ï¼Œ é˜Ÿåˆ— ä»»åŠ¡ï¼šè®°ä¸ºåœ¨blockä¸­æ‰§è¡Œçš„ä»£ç ã€‚ é˜Ÿåˆ—ï¼šç”¨æ¥å­˜æ”¾ä»»åŠ¡çš„ã€‚ æ³¨æ„äº‹é¡¹ï¼š é˜Ÿåˆ— != çº¿ç¨‹ã€‚é˜Ÿåˆ—ä¸­å­˜æ”¾çš„ä»»åŠ¡æœ€åéƒ½è¦ç”±çº¿ç¨‹æ¥æ‰§è¡Œ!ã€‚é˜Ÿåˆ—çš„åŸåˆ™:å…ˆè¿›å…ˆå‡º,åè¿›åå‡º(FIFO/ First In First Out) é˜Ÿåˆ—åˆåˆ†ä¸ºå››ç§ç§ï¼š1 ä¸²è¡Œé˜Ÿåˆ— 2 å¹¶å‘é˜Ÿåˆ— 3 ä¸»é˜Ÿåˆ— 4 å…¨å±€é˜Ÿåˆ— ä¸²è¡Œé˜Ÿåˆ—ï¼š ä»»åŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„æ‰§è¡Œã€‚ å¹¶å‘é˜Ÿåˆ—ï¼š é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å¹¶å‘æ‰§è¡Œã€‚ ä¸»é˜Ÿåˆ—ï¼š è·Ÿä¸»çº¿ç¨‹ç›¸å…³çš„é˜Ÿåˆ—ï¼Œä¸»é˜Ÿåˆ—é‡Œé¢çš„å†…å®¹éƒ½ä¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹ä¸­åˆ·æ–°UIï¼‰ã€‚ å…¨å±€é˜Ÿåˆ—ï¼š ä¸€ä¸ªç‰¹æ®Šçš„å¹¶å‘é˜Ÿåˆ—ã€‚ å¹¶å‘é˜Ÿåˆ—ä¸å…¨å±€é˜Ÿåˆ—çš„åŒºåˆ«ï¼š å¹¶å‘é˜Ÿåˆ—æœ‰åç§°,å¯ä»¥è·Ÿè¸ªé”™è¯¯ã€‚å…¨å±€é˜Ÿåˆ—æ²¡æœ‰ åœ¨ARCä¸­ä¸¤ä¸ªé˜Ÿåˆ—ä¸éœ€è¦è€ƒè™‘é‡Šæ”¾å†…å­˜,ä½†æ˜¯åœ¨MRCä¸­å¹¶å‘é˜Ÿåˆ—æ˜¯åˆ›å»ºå‡ºæ¥çš„éœ€è¦releaseæ“ä½œï¼Œè€Œå…¨å±€é˜Ÿåˆ—åªæœ‰ä¸€ä¸ªä¸éœ€è¦ã€‚ ä¸€èˆ¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨å…¨å±€é˜Ÿåˆ—ã€‚ æ‰§è¡Œä»»åŠ¡çš„ä¸¤ä¸ªå‡½æ•° â€˜åŒæ­¥â€™æ‰§è¡Œä»»åŠ¡:dispatch_sync(&lt;#dispatch_queue_t queue#&gt;, &lt;#^(void)block#&gt;) â€˜å¼‚æ­¥â€™æ‰§è¡Œä»»åŠ¡:dispatch_async(dispatch_queue_t queue, &lt;#^(void)block#&gt;) â€œåŒæ­¥â€å’Œâ€å¼‚æ­¥â€çš„åŒºåˆ«: â€œåŒæ­¥â€: åªèƒ½åœ¨â€™å½“å‰â€™çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡,ä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›. â€œå¼‚æ­¥â€: å¯ä»¥åœ¨â€™æ–°â€™çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡,å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›. å„ä¸ªé˜Ÿåˆ—çš„æ‰§è¡Œæ•ˆæœï¼š ä¸²è¡Œé˜Ÿåˆ—åŒæ­¥æ‰§è¡Œï¼Œæ—¢åœ¨å½“å‰çº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œ ä¸²è¡Œé˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œï¼Œå¼€è¾Ÿä¸€æ¡æ–°çš„çº¿ç¨‹ï¼Œåœ¨è¯¥çº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œ å¹¶è¡Œé˜Ÿåˆ—åŒæ­¥æ‰§è¡Œï¼Œä¸å¼€è¾Ÿçº¿ç¨‹ï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸­é¡ºåºæ‰§è¡Œ å¹¶è¡Œé˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œï¼Œå¼€è¾Ÿå¤šä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹ä¼šé‡ç”¨ï¼Œæ— åºæ‰§è¡Œ ä¸»é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œï¼Œä¸å¼€è¾Ÿæ–°çš„çº¿ç¨‹ï¼Œé¡ºåºæ‰§è¡Œ ä¸»é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œï¼Œä¼šé€ æˆæ­»é”ï¼ˆâ€™ä¸»çº¿ç¨‹â€™å’Œâ€™ä¸»é˜Ÿåˆ—â€™ç›¸äº’ç­‰å¾…,å¡ä½ä¸»çº¿ç¨‹ï¼‰ çº¿ç¨‹é—´é€šè®¯ï¼šç»å…¸æ¡ˆä¾‹ï¼šå­çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œï¼ˆä¾‹å¦‚ä¸‹è½½æ›´æ–°ç­‰ï¼‰ä¸»çº¿ç¨‹è¿›è¡ŒUIåˆ·æ–°ã€‚ ç»å…¸ç”¨æ³•(å­çº¿ç¨‹ä¸‹è½½(è€—æ—¶æ“ä½œ),ä¸»çº¿ç¨‹åˆ·æ–°UI): dispatch_async(dispatch_get_global_queue(0, 0), ^{ // æ‰§è¡Œè€—æ—¶çš„å¼‚æ­¥æ“ä½œ... dispatch_async(dispatch_get_main_queue(), ^{ // å›åˆ°ä¸»çº¿ç¨‹ï¼Œæ‰§è¡ŒUIåˆ·æ–°æ“ä½œ å»¶è¿Ÿæ“ä½œ è°ƒç”¨ NSObject æ–¹æ³•:[self performSelector:@selector(run) withObject:nil afterDelay:2.0]; // 2ç§’åå†è°ƒç”¨selfçš„runæ–¹æ³• GCDå‡½æ•°å®ç°å»¶æ—¶æ‰§è¡Œ:dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{ // 2ç§’åæ‰§è¡Œè¿™é‡Œçš„ä»£ç â€¦ åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œè·Ÿé˜Ÿåˆ—ç±»å‹æœ‰å…³ é˜Ÿåˆ—ç»„çš„ä½¿ç”¨ï¼š é¡¹ç›®éœ€æ±‚:é¦–å…ˆ:åˆ†åˆ«å¼‚æ­¥æ‰§è¡Œä¸¤ä¸ªè€—æ—¶æ“ä½œ;å…¶æ¬¡:ç­‰ä¸¤æ¬¡è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•å,å†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ.ä½¿ç”¨é˜Ÿåˆ—ç»„(dispatch_group_t)å¿«é€Ÿ,é«˜æ•ˆçš„å®ç°ä¸Šè¿°éœ€æ±‚. dispatch_group_t group = dispatch_group_create(); // é˜Ÿåˆ—ç»„ dispatch_queue_t queue = dispatch_get_global_queue(0, 0); // å…¨å±€å¹¶å‘é˜Ÿåˆ— dispatch_group_async(group, queue, ^{// å¼‚æ­¥æ‰§è¡Œæ“ä½œ1 // longTime1 }); dispatch_group_async(group, queue, ^{ // å¼‚æ­¥æ‰§è¡Œæ“ä½œ2 // longTime2 }); dispatch_group_notify(group, dispatch_get_main_queue(), ^{ // åœ¨ä¸»çº¿ç¨‹åˆ·æ–°æ•°æ® // reload Data }); GCDå†…éƒ¨æ€ä¹ˆå®ç°çš„ iOSå’ŒOS Xçš„æ ¸å¿ƒæ˜¯XNUå†…æ ¸ï¼ŒGCDæ˜¯åŸºäºXNUå†…æ ¸å®ç°çš„ GCDçš„APIå…¨éƒ¨åœ¨libdispatchåº“ä¸­ GCDçš„åº•å±‚å®ç°ä¸»è¦æœ‰Dispatch Queueå’ŒDispatch Source Dispatch Queue ï¼šç®¡ç†block(æ“ä½œ) Dispatch Source ï¼šå¤„ç†äº‹ä»¶(MACHç«¯å£å‘é€,MACHç«¯å£æ¥æ”¶,æ£€æµ‹ä¸è¿›ç¨‹ç›¸å…³äº‹ä»¶ç­‰10ç§äº‹ä»¶) GCDçš„queueã€main queueä¸­æ‰§è¡Œçš„ä»£ç ä¸€å®šæ˜¯åœ¨main threadä¹ˆï¼Ÿâ€¢ å¯¹äºqueueä¸­æ‰€æ‰§è¡Œçš„ä»£ç ä¸ä¸€å®šåœ¨main threadä¸­ã€‚å¦‚æœqueueæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºçš„ï¼Œé‚£ä¹ˆæ‰€æ‰§è¡Œçš„ä»£ç å°±æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚å¦‚æœæ˜¯åœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºçš„ï¼Œé‚£ä¹ˆå°±ä¸ä¼šåœ¨main threadä¸­æ‰§è¡Œã€‚ â€¢ å¯¹äºmain queueå°±æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­çš„ï¼Œå› æ­¤ä¸€å®šä¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è·å–main queueå°±å¯ä»¥äº†ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ›å»ºï¼Œè·å–æ–¹å¼é€šè¿‡è°ƒç”¨æ–¹æ³•dispatchgetmain_queueæ¥è·å–ã€‚ å¦‚ä½•ç”¨GCDåŒæ­¥è‹¥å¹²ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Ÿï¼ˆå¦‚æ ¹æ®è‹¥å¹²ä¸ªurlå¼‚æ­¥åŠ è½½å¤šå¼ å›¾ç‰‡ï¼Œç„¶ååœ¨éƒ½ä¸‹è½½å®Œæˆååˆæˆä¸€å¼ æ•´å›¾ï¼‰ä½¿ç”¨Dispatch Groupè¿½åŠ blockåˆ°Global Group Queue,è¿™äº›blockå¦‚æœå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šæ‰§è¡ŒMain Dispatch Queueä¸­çš„ç»“æŸå¤„ç†çš„blockã€‚ dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, ); dispatch_group_t group = dispatch_group_create(); dispatch_group_async(group, queue, ^{ /*åŠ è½½å›¾ç‰‡1 */ }); dispatch_group_async(group, queue, ^{ /*åŠ è½½å›¾ç‰‡2 */ }); dispatch_group_async(group, queue, ^{ /*åŠ è½½å›¾ç‰‡3 */ }); dispatch_group_notify(group, dispatch_get_main_queue(), ^{ // åˆå¹¶å›¾ç‰‡ }); æœ‰aã€bã€cã€d 4ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå¦‚ä½•åˆ¤æ–­aã€bã€cã€déƒ½å®Œæˆæ‰§è¡Œï¼Ÿå¦‚æœéœ€è¦aã€bã€cã€dé¡ºåºæ‰§è¡Œï¼Œè¯¥å¦‚ä½•å®ç°ï¼Ÿ1. å¯¹äºè¿™å››ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œè¦åˆ¤æ–­éƒ½æ‰§è¡Œå®Œæˆæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡GCDçš„groupæ¥å®ç°ï¼š 2. dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); 3. dispatch_group_t group = dispatch_group_create(); 4. dispatch_group_async(group, queue, ^{ /*ä»»åŠ¡a */ }); 5. dispatch_group_async(group, queue, ^{ /*ä»»åŠ¡b */ }); 6. dispatch_group_async(group, queue, ^{ /*ä»»åŠ¡c */ }); 7. dispatch_group_async(group, queue, ^{ /*ä»»åŠ¡d */ }); 8. 9. dispatch_group_notify(group, dispatch_get_main_queue(), ^{ 10. // åœ¨aã€bã€cã€då¼‚æ­¥æ‰§è¡Œå®Œæˆåï¼Œä¼šå›è°ƒè¿™é‡Œ 11. }); å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨éå¸¸è€å¥—çš„æ–¹æ³•æ¥å¤„ç†ï¼Œé€šè¿‡å››ä¸ªå˜é‡æ¥æ ‡è¯†aã€bã€cã€då››ä¸ªä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œç„¶ååœ¨runloopä¸­è®©å…¶ç­‰å¾…ï¼Œå½“å®Œæˆæ—¶æ‰é€€å‡ºrun loopã€‚ä½†æ˜¯è¿™æ ·åšä¼šè®©åé¢çš„ä»£ç å¾—ä¸åˆ°æ‰§è¡Œï¼Œç›´åˆ°Run loopæ‰§è¡Œå®Œæ¯•ã€‚ è¦æ±‚é¡ºåºæ‰§è¡Œï¼Œé‚£ä¹ˆå¯ä»¥å°†ä»»åŠ¡æ”¾åˆ°ä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œè‡ªç„¶å°±æ˜¯æŒ‰é¡ºåºæ¥å¼‚æ­¥æ‰§è¡Œäº† å‘é€10ä¸ªç½‘ç»œè¯·æ±‚ï¼Œç„¶åå†æ¥æ”¶åˆ°æ‰€æœ‰å›åº”ä¹‹åæ‰§è¡Œåç»­æ“ä½œï¼Œå¦‚ä½•å®ç°ï¼Ÿä»é¢˜ç›®åˆ†æå¯çŸ¥ï¼Œ10ä¸ªè¯·æ±‚è¦å…¨éƒ¨å®Œæˆåï¼Œæ‰æ‰§è¡ŒæŸä¸€åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä¸‹è½½10å›¾ç‰‡ååˆæˆä¸€å¼ å¤§å›¾ï¼Œå°±éœ€è¦å¼‚æ­¥å…¨éƒ¨ä¸‹è½½å®Œæˆåï¼Œæ‰èƒ½åˆå¹¶æˆå¤§å›¾ã€‚ åšæ³•ï¼šé€šè¿‡dispatch_group_tæ¥å®ç°ï¼Œå°†æ¯ä¸ªè¯·æ±‚æ”¾å…¥åˆ°Groupä¸­ï¼Œå°†åˆå¹¶æˆå¤§å›¾çš„æ“ä½œæ”¾åœ¨dispatch_group_notifyä¸­å®ç°ã€‚ dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_group_t group = dispatch_group_create(); dispatch_group_async(group, queue, ^{ /*åŠ è½½å›¾ç‰‡1 */ }); dispatch_group_async(group, queue, ^{ /*åŠ è½½å›¾ç‰‡2 */ }); dispatch_group_async(group, queue, ^{ /*åŠ è½½å›¾ç‰‡3 */ }); dispatch_group_notify(group, dispatch_get_main_queue(), ^{ // åˆå¹¶å›¾ç‰‡ }); è‹¹æœä¸ºä»€ä¹ˆè¦åºŸå¼ƒdispatch_get_current_queueï¼Ÿ dispatch_get_current_queueå®¹æ˜“é€ æˆæ­»é”ã€‚è¯¦æƒ…ç‚¹å‡»è¯¥APIæŸ¥çœ‹å®˜æ–¹æ³¨é‡Šã€‚ å¦‚æœè®©ä½ æ¥å®ç° dispatch_onceï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ http://www.dreamingwish.com/article/gcd-guide-dispatch-once-2.htmlï¼ˆè¶…çº§è¯¦ç»†è§£æï¼‰ ä¸ªäººè§‰å¾—è¯´å‡ºå®ç°çš„æ€è·¯å³å¯ï¼Œæ— é”çš„çº¿ç¨‹åŒæ­¥ç¼–ç¨‹ï¼Œæ¯ä¸€å¤„çš„çº¿ç¨‹ç«äº‰éƒ½è€ƒè™‘åˆ°å¹¶å¦¥å–„å¤„ç† çº¿ç¨‹Aæ‰§è¡ŒBlockæ—¶ï¼Œä»»ä½•å…¶å®ƒçº¿ç¨‹éƒ½éœ€è¦ç­‰å¾…ã€‚ çº¿ç¨‹Aæ‰§è¡Œå®ŒBlockåº”è¯¥ç«‹å³æ ‡è®°ä»»åŠ¡å®ŒæˆçŠ¶æ€ï¼Œç„¶åéå†ä¿¡å·é‡é“¾æ¥å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ã€‚ çº¿ç¨‹Aéå†ä¿¡å·é‡é“¾æ¥signalæ—¶ï¼Œä»»ä½•å…¶ä»–æ–°è¿›å…¥å‡½æ•°çš„çº¿ç¨‹éƒ½åº”è¯¥ç›´æ¥è¿”å›è€Œæ— éœ€ç­‰å¾…ã€‚ çº¿ç¨‹Aéå†ä¿¡å·é‡é“¾æ¥signalæ—¶ï¼Œè‹¥æœ‰å…¶å®ƒç­‰å¾…çº¿ç¨‹Bä»åœ¨æ›´æ–°æˆ–è¯•å›¾æ›´æ–°ä¿¡å·é‡é“¾ï¼Œåº”è¯¥ä¿è¯æ­¤çº¿ç¨‹Bèƒ½æ­£ç¡®å®Œæˆå…¶ä»»åŠ¡ï¼ša.ç›´æ¥è¿”å› b.ç­‰å¾…åœ¨ä¿¡å·é‡ä¸Šå¹¶å¾ˆå¿«åˆè¢«å”¤é†’ã€‚ çº¿ç¨‹Bæ„é€ ä¿¡å·é‡æ—¶ï¼Œåº”è¯¥è€ƒè™‘çº¿ç¨‹Aéšæ—¶å¯èƒ½æ”¹å˜çŠ¶æ€ï¼ˆâ€œç­‰å¾…â€ã€â€œå®Œæˆâ€ã€â€œéå†ä¿¡å·é‡é“¾â€ï¼‰ã€‚ çº¿ç¨‹Bæ„é€ ä¿¡å·é‡æ—¶ï¼Œåº”è¯¥è€ƒè™‘åˆ°å¦ä¸€ä¸ªçº¿ç¨‹Cä¹Ÿå¯èƒ½æ­£åœ¨æ›´æ–°æˆ–è¯•å›¾æ›´æ–°ä¿¡å·é‡é“¾ï¼Œåº”è¯¥ä¿è¯Bã€Céƒ½èƒ½æ­£å¸¸å®Œæˆå…¶ä»»åŠ¡ï¼ša.å¢åŠ é“¾èŠ‚å¹¶ç­‰å¾…åœ¨ä¿¡å·é‡ä¸Š b.å‘ç°çº¿ç¨‹Aå·²ç»æ ‡è®°â€œå®Œæˆâ€ç„¶åç›´æ¥é”€æ¯ä¿¡å·é‡å¹¶é€€å‡ºå‡½æ•°ã€‚ å…³äºNSOperation: NSOperation: æŠ½è±¡ç±»,ä¸èƒ½ç›´æ¥ä½¿ç”¨,éœ€è¦ä½¿ç”¨å…¶å­ç±».(ç±»ä¼¼çš„ç±»è¿˜æœ‰æ ¸å¿ƒåŠ¨ç”») ä¸¤ä¸ªå¸¸ç”¨å­ç±»: NSInvocationOperation(è°ƒç”¨) å’Œ NSBlockOperation(å—); ä¸¤è€…æ²¡æœ‰æœ¬è´¨åŒºåˆ«,åè€…ä½¿ç”¨ Block çš„å½¢å¼ç»„ç»‡ä»£ç ,ä½¿ç”¨ç›¸å¯¹æ–¹ä¾¿. NSInvocationOperationåœ¨è°ƒç”¨startæ–¹æ³•åï¼Œä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹åªä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ NSBlockOperation åœ¨è°ƒç”¨startæ–¹æ³•åï¼Œå¦‚æœå°è£…çš„æ“ä½œæ•°&gt;1ä¼šå¼€è¾Ÿå¤šæ¡çº¿ç¨‹æ‰§è¡Œ =1 åªä¼šåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ. NSOperationQueue åˆ›å»ºçš„æ“ä½œé˜Ÿåˆ—é»˜è®¤ä¸ºå…¨å±€é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­çš„æ“ä½œæ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œå¦‚æœéœ€è¦è®©å®ƒæœ‰åºæ‰§è¡Œéœ€è¦æ·»åŠ ä¾èµ–å…³ç³»ã€‚ // æ“ä½œop3ä¾èµ–äºæ“ä½œop2 [op3 addDependency:op2]; // æ“ä½œop2ä¾èµ–äºæ“ä½œop1 [op2 addDependency:op1]; åŒæ—¶å¯ä»¥è®¾ç½®æœ€å¤§å¹¶å‘æ•° NSOperationQueue NSOperationæ”¯æŒ å–æ¶ˆæš‚åœçš„æ“ä½œ ä½†æ˜¯æ­£åœ¨è¿›è¡Œçš„çš„æ“ä½œå¹¶ä¸èƒ½å–æ¶ˆï¼Œè¿™ä¸€æ—¦å–æ¶ˆä¸å¯æ¢å¤. NSOperationQueueæ”¯æŒKVOï¼Œå¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ï¼Œæ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰ NSOperation queue? å­˜æ”¾NSOperationçš„é›†åˆç±»ã€‚ä¸èƒ½è¯´é˜Ÿåˆ—ï¼Œä¸æ˜¯ä¸¥æ ¼çš„å…ˆè¿›å…ˆå‡º NSOperationä¸GCDçš„åŒºåˆ« GCD GCDæ˜¯iOS4.0æ¨å‡ºçš„ï¼Œä¸»è¦é’ˆå¯¹å¤šæ ¸cpuåšäº†ä¼˜åŒ–ï¼Œæ˜¯çº¯cè¯­è¨€çš„æŠ€æœ¯ã€‚ GCDæ˜¯å°†ä»»åŠ¡ï¼ˆblockï¼‰æ·»åŠ åˆ°é˜Ÿåˆ—ï¼ˆä¸²è¡Œã€å¹¶è¡Œã€å…¨å±€ã€ä¸»é˜Ÿåˆ—ï¼‰ï¼Œå¹¶ä¸”ä»¥åŒæ­¥/å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œä»»åŠ¡çš„å‡½æ•°ã€‚ GCDæä¾›äº†ä¸€äº›NSOperationä¸å…·å¤‡çš„åŠŸèƒ½ ä¸€æ¬¡æ€§æ‰§è¡Œ å»¶è¿Ÿæ‰§è¡Œ è°ƒåº¦ç»„ GCD æ˜¯ä¸¥æ ¼çš„é˜Ÿåˆ—ï¼Œå…ˆè¿›å…ˆå‡º FIFOï¼› NSOperation NSOperationæ˜¯iOS2.0æ¨å‡ºçš„ï¼ŒiOS4.0ä»¥ååˆé‡å†™äº†NSOperation NSOperationæ˜¯å°†æ“ä½œï¼ˆå¼‚æ­¥çš„ä»»åŠ¡ï¼‰æ·»åŠ åˆ°é˜Ÿåˆ—ï¼ˆå¹¶å‘é˜Ÿåˆ—ï¼‰ï¼Œå°±ä¼šæ‰§è¡ŒæŒ‡å®šçš„å‡½æ•° NSOperationæä¾›çš„æ–¹ä¾¿æ“ä½œ æœ€å¤§å¹¶å‘æ•° é˜Ÿåˆ—çš„æš‚åœå’Œç»§ç»­ å–æ¶ˆæ‰€æœ‰çš„æ“ä½œ æŒ‡å®šæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ä¾èµ–å…³ç³»ï¼Œå¯ä»¥è®©å¼‚æ­¥ä»»åŠ¡åŒæ­¥æ‰§è¡Œ. å°†KVOç”¨äºNSOperationä¸­ï¼Œç›‘å¬ä¸€ä¸ªoperationæ˜¯å¦å®Œæˆã€‚ èƒ½å¤Ÿè®¾ç½®NSOperationçš„ä¼˜å…ˆçº§ï¼Œèƒ½å¤Ÿä½¿åŒä¸€ä¸ªå¹¶è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡åŒºåˆ†å…ˆååœ°æ‰§è¡Œ å¯¹NSOperationè¿›è¡Œç»§æ‰¿ï¼Œåœ¨è¿™ä¹‹ä¸Šæ·»åŠ æˆå‘˜å˜é‡ä¸æˆå‘˜æ–¹æ³•ï¼Œæé«˜æ•´ä¸ªä»£ç çš„å¤ç”¨åº¦ GCDä¸NSThreadçš„åŒºåˆ« NSThread é€šè¿‡ @selector æŒ‡å®šè¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œä»£ç åˆ†æ•£ GCD é€šè¿‡ block æŒ‡å®šè¦æ‰§è¡Œçš„ä»£ç ï¼Œä»£ç é›†ä¸­, æ‰€æœ‰çš„ä»£ç å†™åœ¨ä¸€èµ·çš„ï¼Œè®©ä»£ç æ›´åŠ ç®€å•ï¼Œæ˜“äºé˜…è¯»å’Œç»´æŠ¤ ä½¿ç”¨ GCD ä¸éœ€è¦ç®¡ç†çº¿ç¨‹çš„åˆ›å»º/é”€æ¯/å¤ç”¨çš„è¿‡ç¨‹ï¼ç¨‹åºå‘˜ä¸ç”¨å…³å¿ƒçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ å¦‚æœè¦å¼€å¤šä¸ªçº¿ç¨‹ NSThread å¿…é¡»å®ä¾‹åŒ–å¤šä¸ªçº¿ç¨‹å¯¹è±¡ NSThread é  NSObject çš„åˆ†ç±»æ–¹æ³•å®ç°çš„çº¿ç¨‹é—´é€šè®¯ï¼Œ ä¸ºä»€ä¹ˆè¦å–æ¶ˆ/æ¢å¤é˜Ÿåˆ—å‘¢ï¼Ÿ ä¸€èˆ¬åœ¨å†…å­˜è­¦å‘Šåå–æ¶ˆé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚ ä¸ºäº†ä¿è¯scorllViewåœ¨æ»šåŠ¨çš„æ—¶å€™æµç•… é€šå¸¸åœ¨æ»šåŠ¨å¼€å§‹æ—¶ï¼Œæš‚åœé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œæ»šåŠ¨ç»“æŸåï¼Œæ¢å¤æ“ä½œã€‚ Object Cä¸­åˆ›å»ºçº¿ç¨‹çš„æ–¹æ³•æ˜¯ä»€ä¹ˆ?å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œä»£ç ï¼Œæ–¹æ³•æ˜¯ä»€ä¹ˆ?å¦‚æœæƒ³å»¶æ—¶æ‰§è¡Œä»£ç ã€æ–¹æ³•åˆæ˜¯ä»€ä¹ˆ?çº¿ç¨‹åˆ›å»ºæœ‰ä¸‰ç§æ–¹æ³•ï¼šä½¿ç”¨NSThreadåˆ›å»ºã€ä½¿ç”¨GCDçš„dispatchã€ä½¿ç”¨å­ç±»åŒ–çš„NSOperation,ç„¶åå°†å…¶åŠ å…¥NSOperationQueue; NSThreadåˆ›å»ºçº¿ç¨‹çš„ä¸‰ç§æ–¹æ³•ï¼š NSThread *thread = [[NSThread alloc]initWithTarget:self selector:@selector(run:) object:@&quot;nil&quot;]; [NSThread detachNewThreadSelector:@selector(run:) toTarget:self withObject:@&quot;æˆ‘æ˜¯åˆ†ç¦»å‡ºæ¥çš„å­çº¿ç¨‹&quot;]; [self performSelectorInBackground:@selector(run:) withObject:@&quot;æˆ‘æ˜¯åå°çº¿ç¨‹&quot;]; åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä»£ç ï¼Œå°±è°ƒç”¨performSelectorOnMainThreadæ–¹æ³•ã€‚ å¦‚æœæƒ³å»¶æ—¶æ‰§è¡Œä»£ç å¯ä»¥è°ƒç”¨performSelector:onThread:withObject:waitUntilDone:æ–¹æ³•ï¼› GCDï¼š åˆ©ç”¨å¼‚æ­¥å‡½æ•°dispatch_async()åˆ›å»ºå­çº¿ç¨‹ã€‚ åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä»£ç ï¼Œdispatch_async(dispatch_get_main_queue(), ^{}); å»¶è¿Ÿæ‰§è¡Œä»£ç ï¼ˆå»¶è¿ŸÂ·å¯ä»¥æ§åˆ¶ä»£ç åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰ï¼š dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{}); NSOperationQueueï¼š ä½¿ç”¨NSOperationçš„å­ç±»å°è£…æ“ä½œï¼Œå†å°†æ“ä½œæ·»åŠ åˆ°NSOperationQueueåˆ›å»ºçš„é˜Ÿåˆ—ä¸­ï¼Œå®ç°å¤šçº¿ç¨‹ã€‚ åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œä»£ç ï¼Œåªè¦å°†å°è£…ä»£ç çš„NSOperationå¯¹è±¡æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—å°±å¯ä»¥äº†ã€‚ ä¸‹é¢å…³äºçº¿ç¨‹ç®¡ç†é”™è¯¯çš„æ˜¯A. GCDæ‰€ç”¨çš„å¼€é”€è¦æ¯”NSThreadå¤§ B. å¯ä»¥åœ¨å­çº¿ç¨‹ä¸­ä¿®æ”¹UIå…ƒç´  C. NSOperationQueueæ˜¯æ¯”NSthreadæ›´é«˜å±‚çš„å°è£… D. GCDå¯ä»¥æ ¹æ®ä¸åŒä¼˜å…ˆçº§åˆ†é…çº¿ç¨‹ å‚è€ƒç­”æ¡ˆï¼šB ç†ç”±ï¼šé¦–å…ˆï¼ŒUIå…ƒç´ çš„æ›´æ–°å¿…é¡»åœ¨ä¸»çº¿ç¨‹ã€‚GCDä¸Blocké…åˆä½¿ç”¨ï¼Œblockéœ€è¦è‡ªåŠ¨æ•è·ä¸Šä¸‹æ–‡å˜é‡ä¿¡æ¯ç­‰ï¼Œå› æ­¤éœ€è¦æ›´å¤šçš„èµ„æºï¼Œæ•…æ¯”NSThreadå¼€é”€è¦å¤§ä¸€äº›ã€‚NSOperationQueueä¸NSOperationé…åˆä½¿ç”¨ï¼Œæ¯”NSThreadæ›´æ˜“äºæ“ä½œçº¿ç¨‹ã€‚GCDæä¾›äº†å¤šä¸ªä¼˜å…ˆçº§ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è®¾ç½®ä¼˜å…ˆçº§ï¼Œè®©å…¶è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ†é…çº¿ç¨‹ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜16--WebViewä¸JSäº¤äº’]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9816-WebView%E4%B8%8EJS%E4%BA%A4%E4%BA%92%2F</url>
    <content type="text"><![CDATA[iOSä¸­è°ƒç”¨HTML 1. åŠ è½½ç½‘é¡µ NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;index&quot; withExtension:@&quot;html&quot;]; NSURLRequest *request = [NSURLRequest requestWithURL:url]; [self.webView loadRequest:request]; 2. åˆ é™¤ NSString *str1 = @&quot;var word = document.getElementById(&#39;word&#39;);&quot;; NSString *str2 = @&quot;word.remove();&quot;; [webView stringByEvaluatingJavaScriptFromString:str1]; [webView stringByEvaluatingJavaScriptFromString:str2]; 3. æ›´æ”¹ NSString *str3 = @&quot;var change = document.getElementsByClassName(&#39;change&#39;)[0];&quot; &quot;change.innerHTML = &#39;å¥½ä½ çš„å“¦!&#39;;&quot;; [webView stringByEvaluatingJavaScriptFromString:str3]; 4. æ’å…¥ NSString *str4 =@&quot;var img = document.createElement(&#39;img&#39;);&quot; &quot;img.src = &#39;img_01.jpg&#39;;&quot; &quot;img.width = &#39;160&#39;;&quot; &quot;img.height = &#39;80&#39;;&quot; &quot;document.body.appendChild(img);&quot;; [webView stringByEvaluatingJavaScriptFromString:str4]; 5. æ”¹å˜æ ‡é¢˜ NSString *str1 = @&quot;var h1 = document.getElementsByTagName(&#39;h1&#39;)[0];&quot; &quot;h1.innerHTML=&#39;ç®€ä¹¦å•Šå•Šå•Šå•Š&#39;;&quot;; [webView stringByEvaluatingJavaScriptFromString:str1]; 6. åˆ é™¤å°¾éƒ¨ NSString *str2 =@&quot;document.getElementById(&#39;footer&#39;).remove();&quot;; [webView stringByEvaluatingJavaScriptFromString:str2]; 7. æ‹¿å‡ºæ‰€æœ‰çš„ç½‘é¡µå†…å®¹ NSString *str3 = @&quot;document.body.outerHTML&quot;; NSString *html = [webView stringByEvaluatingJavaScriptFromString:str3]; NSLog(@&quot;%@&quot;, html); åœ¨HTMLä¸­è°ƒç”¨OC-(BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType{ NSString *str = request.URL.absoluteString; NSRange range = [str rangeOfString:@&quot;ZJY://&quot;]; if (range.location != NSNotFound) { NSString *method = [str substringFromIndex:range.location + range.length]; SEL sel = NSSelectorFromString(method); [self performSelector:sel]; } return YES; } // è®¿é—®ç›¸å†Œ - (void)getImage{ UIImagePickerController *pickerImg = [[UIImagePickerController alloc]init]; pickerImg.sourceType = UIImagePickerControllerSourceTypePhotoLibrary; [self presentViewController:pickerImg animated:YES completion:nil]; } JavaScriptCore ä½¿ç”¨ JavaScriptCoreæ˜¯webkitçš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸»è¦æ˜¯å¯¹JSè¿›è¡Œè§£æå’Œæä¾›æ‰§è¡Œç¯å¢ƒã€‚iOS7åè‹¹æœåœ¨iPhoneå¹³å°æ¨å‡ºï¼Œæå¤§çš„æ–¹ä¾¿äº†æˆ‘ä»¬å¯¹jsçš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥è„±ç¦»webviewç›´æ¥è¿è¡Œæˆ‘ä»¬çš„jsã€‚iOS7ä»¥å‰æˆ‘ä»¬å¯¹JSçš„æ“ä½œåªæœ‰webviewé‡Œé¢ä¸€ä¸ªå‡½æ•°stringByEvaluatingJavaScriptFromStringï¼ŒJSå¯¹OCçš„å›è°ƒéƒ½æ˜¯åŸºäºURLçš„æ‹¦æˆªè¿›è¡Œçš„æ“ä½œã€‚å¤§å®¶ç”¨å¾—æ¯”è¾ƒå¤šçš„æ˜¯WebViewJavascriptBridgeå’ŒEasyJSWebViewè¿™ä¸¤ä¸ªå¼€æºåº“ï¼Œå¾ˆå¤šæ··åˆéƒ½é‡‡ç”¨çš„è¿™ç§æ–¹å¼ã€‚ #import &quot;JSContext.h&quot; #import &quot;JSValue.h&quot; #import &quot;JSManagedValue.h&quot; #import &quot;JSVirtualMachine.h&quot; #import &quot;JSExport.h&quot; JSContext:JSæ‰§è¡Œçš„ç¯å¢ƒï¼ŒåŒæ—¶ä¹Ÿé€šè¿‡JSVirtualMachineç®¡ç†ç€æ‰€æœ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ¯ä¸ªJSValueéƒ½å’ŒJSContextç›¸å…³è”å¹¶ä¸”å¼ºå¼•ç”¨contextã€‚ JSValue:JSå¯¹è±¡åœ¨JSVirtualMachineä¸­çš„ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå…¶å®å°±æ˜¯Hybirdå¯¹è±¡ã€‚æˆ‘ä»¬å¯¹JSçš„æ“ä½œéƒ½æ˜¯é€šè¿‡å®ƒã€‚å¹¶ä¸”æ¯ä¸ªJSValueéƒ½æ˜¯å¼ºå¼•ç”¨ä¸€ä¸ªcontextã€‚åŒæ—¶ï¼ŒOCå’ŒJSå¯¹è±¡ä¹‹é—´çš„è½¬æ¢ä¹Ÿæ˜¯é€šè¿‡å®ƒï¼Œç›¸åº”çš„ç±»å‹è½¬æ¢å¦‚ä¸‹ï¼š Objective-C type JavaScript type nil undefined NSNull null NSString string NSNumber number, boolean NSDictionary Object object NSArray Array object NSDate Date object NSBlock (1) Function object (1) id (2) Wrapper object (2) Class (3) Constructor object (3) JSManagedValue:JSå’ŒOCå¯¹è±¡çš„å†…å­˜ç®¡ç†è¾…åŠ©å¯¹è±¡ã€‚ç”±äºJSå†…å­˜ç®¡ç†æ˜¯åƒåœ¾å›æ”¶ï¼Œå¹¶ä¸”JSä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒOCæ˜¯å¼•ç”¨è®¡æ•°ã€‚å¦‚æœåŒæ–¹ç›¸äº’å¼•ç”¨ï¼ŒåŠ¿å¿…ä¼šé€ æˆå¾ªç¯å¼•ç”¨ï¼Œè€Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚æˆ‘ä»¬å¯ä»¥ç”¨JSManagedValueä¿å­˜JSValueæ¥é¿å…ã€‚ JSVirtualMachine:JSè¿è¡Œçš„è™šæ‹Ÿæœºï¼Œæœ‰ç‹¬ç«‹çš„å †ç©ºé—´å’Œåƒåœ¾å›æ”¶æœºåˆ¶ã€‚ JSExport:ä¸€ä¸ªåè®®ï¼Œå¦‚æœJSå¯¹è±¡æƒ³ç›´æ¥è°ƒç”¨OCå¯¹è±¡é‡Œé¢çš„æ–¹æ³•å’Œå±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªOCå¯¹è±¡åªè¦å®ç°è¿™ä¸ªJSExportåè®®å°±å¯ä»¥äº†ã€‚ Objective-C -&gt; JavaScript self.context = [[JSContext alloc] init]; NSString *js = @&quot;function add(a,b) {return a+b}&quot;; [self.context evaluateScript:js]; JSValue *n = [self.context[@&quot;add&quot;] callWithArguments:@[@2, @3]]; NSLog(@&quot;---%@&quot;, @([n toInt32]));//---5 JavaScript -&gt; Objective-C.JSè°ƒç”¨OCæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šblockå’ŒJSExport protocolã€‚ block(JS function): self.context = [[JSContext alloc] init]; self.context[@&quot;add&quot;] = ^(NSInteger a, NSInteger b) { NSLog(@&quot;---%@&quot;, @(a + b)); }; [self.context evaluateScript:@&quot;add(2,3)&quot;]; æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªblockï¼Œç„¶åä¿å­˜åˆ°contexté‡Œé¢ï¼Œå…¶å®å°±æ˜¯è½¬æ¢æˆäº†JSçš„functionã€‚ç„¶åæˆ‘ä»¬ç›´æ¥æ‰§è¡Œè¿™ä¸ªfunctionï¼Œè°ƒç”¨çš„å°±æ˜¯æˆ‘ä»¬çš„blocké‡Œé¢çš„å†…å®¹äº†ã€‚ JSExport protocol: //å®šä¹‰ä¸€ä¸ªJSExport protocol @protocol JSExportTest &lt;JSExport&gt; - (NSInteger)add:(NSInteger)a b:(NSInteger)b; @property (nonatomic, assign) NSInteger sum; @end //å»ºä¸€ä¸ªå¯¹è±¡å»å®ç°è¿™ä¸ªåè®®ï¼š @interface JSProtocolObj : NSObject&lt;JSExportTest&gt; @end @implementation JSProtocolObj @synthesize sum = _sum; //å®ç°åè®®æ–¹æ³• - (NSInteger)add:(NSInteger)a b:(NSInteger)b { return a+b; } //é‡å†™setteræ–¹æ³•æ–¹ä¾¿æ‰“å°ä¿¡æ¯ï¼Œ - (void)setSum:(NSInteger)sum { NSLog(@&quot;--%@&quot;, @(sum)); _sum = sum; } @end //åœ¨VCä¸­è¿›è¡Œæµ‹è¯• @interface ViewController () &lt;JSExportTest&gt; @property (nonatomic, strong) JSProtocolObj *obj; @property (nonatomic, strong) JSContext *context; @end @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; //åˆ›å»ºcontext self.context = [[JSContext alloc] init]; //è®¾ç½®å¼‚å¸¸å¤„ç† self.context.exceptionHandler = ^(JSContext *context, JSValue *exception) { [JSContext currentContext].exception = exception; NSLog(@&quot;exception:%@&quot;,exception); }; //å°†objæ·»åŠ åˆ°contextä¸­ self.context[@&quot;OCObj&quot;] = self.obj; //JSé‡Œé¢è°ƒç”¨Objæ–¹æ³•ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Objçš„sumå±æ€§ [self.context evaluateScript:@&quot;OCObj.sum = OCObj.addB(2,3)&quot;]; } demoå¾ˆç®€å•ï¼Œè¿˜æ˜¯å®šä¹‰äº†ä¸€ä¸ªä¸¤ä¸ªæ•°ç›¸åŠ çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªä¿å­˜ç»“æœçš„å˜é‡ã€‚åœ¨JSä¸­è¿›è¡Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶å°†ç»“æœèµ‹å€¼sumã€‚å”¯ä¸€è¦æ³¨æ„çš„æ˜¯OCçš„å‡½æ•°å‘½åå’ŒJSå‡½æ•°å‘½åè§„åˆ™é—®é¢˜ã€‚åè®®ä¸­å®šä¹‰çš„æ˜¯add: b:ï¼Œä½†æ˜¯JSé‡Œé¢æ–¹æ³•åå­—æ˜¯addB(a,b)ã€‚å¯ä»¥é€šè¿‡JSExportAsè¿™ä¸ªå®è½¬æ¢æˆJSçš„å‡½æ•°åå­—ã€‚ å†…å­˜ç®¡ç†:ç°åœ¨æ¥è¯´è¯´å†…å­˜ç®¡ç†çš„æ³¨æ„ç‚¹ï¼ŒOCä½¿ç”¨çš„ARCï¼ŒJSä½¿ç”¨çš„æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å¼•ç”¨æ˜¯éƒ½å¼ºå¼•ç”¨ï¼Œä¸è¿‡JSçš„å¾ªç¯å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶ä¼šå¸®å®ƒä»¬æ‰“ç ´ã€‚JavaScriptCoreé‡Œé¢æä¾›çš„APIï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼ŒOCå’ŒJSå¯¹è±¡ä¹‹é—´å†…å­˜ç®¡ç†éƒ½æ— éœ€æˆ‘ä»¬å»å…³å¿ƒã€‚ä¸è¿‡è¿˜æ˜¯æœ‰å‡ ä¸ªæ³¨æ„ç‚¹éœ€è¦æˆ‘ä»¬å»ç•™æ„ä¸‹ã€‚ 1ã€ä¸è¦åœ¨blocké‡Œé¢ç›´æ¥ä½¿ç”¨contextï¼Œæˆ–è€…ä½¿ç”¨å¤–éƒ¨çš„JSValueå¯¹è±¡ã€‚ //é”™è¯¯ä»£ç ï¼š self.context[@&quot;block&quot;] = ^(){ JSValue *value = [JSValue valueWithObject:@&quot;aaa&quot; inContext:self.context]; }; è¿™ä¸ªä»£ç ï¼Œä¸ç”¨è‡ªå·±çœ‹äº†ï¼Œç¼–è¯‘å™¨éƒ½ä¼šæç¤ºä½ çš„ã€‚è¿™ä¸ªblocké‡Œé¢ä½¿ç”¨selfï¼Œå¾ˆå®¹æ˜“å°±çœ‹å‡ºæ¥äº†ã€‚ //ä¸€ä¸ªæ¯”è¾ƒéšè”½çš„ JSValue *value = [JSValue valueWithObject:@&quot;ssss&quot; inContext:self.context]; self.context[@&quot;log&quot;] = ^(){ NSLog(@&quot;%@&quot;,value); }; è¿™ä¸ªæ˜¯blocké‡Œé¢ä½¿ç”¨äº†å¤–éƒ¨çš„valueï¼Œvalueå¯¹contextå’Œå®ƒç®¡ç†çš„JSå¯¹è±¡éƒ½æ˜¯å¼ºå¼•ç”¨ã€‚è¿™ä¸ªvalueè¢«blockæ‰€æ•è·ï¼Œè¿™è¾¹åŒæ ·ä¹Ÿä¼šå†…å­˜æ³„éœ²ï¼Œcontextæ˜¯é”€æ¯ä¸æ‰çš„ã€‚ //æ­£ç¡®çš„åšæ³•ï¼Œstrå¯¹è±¡æ˜¯JSé‚£è¾¹ä¼ é€’è¿‡æ¥ã€‚ self.context[@&quot;log&quot;] = ^(NSString *str){ NSLog(@&quot;%@&quot;,str); }; 2ã€OCå¯¹è±¡ä¸è¦ç”¨å±æ€§ç›´æ¥ä¿å­˜JSValueå¯¹è±¡ï¼Œå› ä¸ºè¿™æ ·å¤ªå®¹æ˜“å¾ªç¯å¼•ç”¨äº†ã€‚ çœ‹ä¸ªdemoï¼ŒæŠŠä¸Šé¢çš„ç¤ºä¾‹æ”¹ä¸‹ï¼š //å®šä¹‰ä¸€ä¸ªJSExport protocol @protocol JSExportTest &lt;JSExport&gt; //ç”¨æ¥ä¿å­˜JSçš„å¯¹è±¡ @property (nonatomic, strong) JSvalue *jsValue; @end //å»ºä¸€ä¸ªå¯¹è±¡å»å®ç°è¿™ä¸ªåè®®ï¼š @interface JSProtocolObj : NSObject&lt;JSExportTest&gt; @end @implementation JSProtocolObj @synthesize jsValue = _jsValue; @end //åœ¨VCä¸­è¿›è¡Œæµ‹è¯• @interface ViewController () &lt;JSExportTest&gt; @property (nonatomic, strong) JSProtocolObj *obj; @property (nonatomic, strong) JSContext *context; @end @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; //åˆ›å»ºcontext self.context = [[JSContext alloc] init]; //è®¾ç½®å¼‚å¸¸å¤„ç† self.context.exceptionHandler = ^(JSContext *context, JSValue *exception) { [JSContext currentContext].exception = exception; NSLog(@&quot;exception:%@&quot;,exception); }; //åŠ è½½JSä»£ç åˆ°contextä¸­ [self.context evaluateScript: @&quot;function callback (){}; function setObj(obj) { this.obj = obj; obj.jsValue=callback; }&quot;]; //è°ƒç”¨JSæ–¹æ³• [self.context[@&quot;setObj&quot;] callWithArguments:@[self.obj]]; } ä¸Šé¢çš„ä¾‹å­å¾ˆç®€å•ï¼Œè°ƒç”¨JSæ–¹æ³•ï¼Œè¿›è¡Œèµ‹å€¼ï¼ŒJSå¯¹è±¡ä¿ç•™äº†ä¼ è¿›æ¥çš„objï¼Œæœ€åï¼ŒJSå°†è‡ªå·±çš„å›è°ƒcallbackèµ‹å€¼ç»™äº†objï¼Œæ–¹ä¾¿objä¸‹æ¬¡å›è°ƒç»™JSï¼›ç”±äºJSé‚£è¾¹ä¿å­˜äº†objï¼Œè€Œä¸”objè¿™è¾¹ä¹Ÿä¿ç•™äº†JSçš„å›è°ƒã€‚è¿™æ ·å°±å½¢æˆäº†å¾ªç¯å¼•ç”¨ã€‚ æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæˆ‘ä»¬åªéœ€è¦æ‰“ç ´objå¯¹JSValueå¯¹è±¡çš„å¼•ç”¨å³å¯ã€‚å½“ç„¶ï¼Œä¸æ˜¯æˆ‘ä»¬OCä¸­çš„weakã€‚è€Œæ˜¯ä¹‹å‰è¯´çš„å†…å­˜ç®¡ç†è¾…åŠ©å¯¹è±¡JSManagedValueã€‚ JSManagedValue æœ¬èº«å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å¼±å¼•ç”¨ã€‚ç”¨å®˜æ–¹çš„è¯æ¥è¯´å«garbage collection weak referenceã€‚ä½†æ˜¯å®ƒå¸®åŠ©æˆ‘ä»¬æŒæœ‰JSValueå¯¹è±¡å¿…é¡»åŒæ—¶æ»¡è¶³ä¸€ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼ˆä¸ç¿»è¯‘äº†ï¼Œç¿»è¯‘äº†æ€ªæ€ªçš„ï¼ï¼‰ï¼š The JSManagedValue&#39;s JavaScript value is reachable from JavaScript The owner of the managed reference is reachable in Objective-C. Manually adding or removing the managed reference in the JSVirtualMachine determines reachability. æ„æ€å¾ˆç®€å•ï¼ŒJSManagedValue å¸®åŠ©æˆ‘ä»¬ä¿å­˜JSValueï¼Œé‚£é‡Œé¢ä¿å­˜çš„JSå¯¹è±¡å¿…é¡»åœ¨JSä¸­å­˜åœ¨ï¼ŒåŒæ—¶ JSManagedValue çš„owneråœ¨OCä¸­ä¹Ÿå­˜åœ¨ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæä¾›çš„ä¸¤ä¸ªæ–¹æ³•``` + (JSManagedValue )managedValueWithValue:(JSValue )value; (JSManagedValue )managedValueWithValue:(JSValue )value andOwner:(id)owneråˆ›å»ºJSManagedValueå¯¹è±¡ã€‚é€šè¿‡JSVirtualMachineçš„æ–¹æ³•- (void)addManagedReference:(id)object withOwner:(id)owneræ¥å»ºç«‹è¿™ä¸ªå¼±å¼•ç”¨å…³ç³»ã€‚é€šè¿‡- (void)removeManagedReference:(id)object withOwner:(id)owner``` æ¥æ‰‹åŠ¨ç§»é™¤ä»–ä»¬ä¹‹é—´çš„è”ç³»ã€‚ æŠŠåˆšåˆšçš„ä»£ç æ”¹ä¸‹ï¼š //å®šä¹‰ä¸€ä¸ªJSExport protocol @protocol JSExportTest &lt;JSExport&gt; //ç”¨æ¥ä¿å­˜JSçš„å¯¹è±¡ @property (nonatomic, strong) JSValue *jsValue; @end //å»ºä¸€ä¸ªå¯¹è±¡å»å®ç°è¿™ä¸ªåè®®ï¼š @interface JSProtocolObj : NSObject&lt;JSExportTest&gt; //æ·»åŠ ä¸€ä¸ªJSManagedValueç”¨æ¥ä¿å­˜JSValue @property (nonatomic, strong) JSManagedValue *managedValue; @end @implementation JSProtocolObj @synthesize jsValue = _jsValue; //é‡å†™setteræ–¹æ³• - (void)setJsValue:(JSValue *)jsValue { _managedValue = [JSManagedValue managedValueWithValue:jsValue]; [[[JSContext currentContext] virtualMachine] addManagedReference:_managedValue withOwner:self]; } @end //åœ¨VCä¸­è¿›è¡Œæµ‹è¯• @interface ViewController () &lt;JSExportTest&gt; @property (nonatomic, strong) JSProtocolObj *obj; @property (nonatomic, strong) JSContext *context; @end @implementation ViewController - (void)viewDidLoad { [super viewDidLoad]; //åˆ›å»ºcontext self.context = [[JSContext alloc] init]; //è®¾ç½®å¼‚å¸¸å¤„ç† self.context.exceptionHandler = ^(JSContext *context, JSValue *exception) { [JSContext currentContext].exception = exception; NSLog(@&quot;exception:%@&quot;,exception); }; //åŠ è½½JSä»£ç åˆ°contextä¸­ [self.context evaluateScript: @&quot;function callback (){}; function setObj(obj) { this.obj = obj; obj.jsValue=callback; }&quot;]; //è°ƒç”¨JSæ–¹æ³• [self.context[@&quot;setObj&quot;] callWithArguments:@[self.obj]]; } æ³¨ï¼šä»¥ä¸Šä»£ç åªæ˜¯ä¸ºäº†çªå‡ºç”¨ JSManagedValueæ¥ä¿å­˜ JSValueï¼Œæ‰€ä»¥é‡å†™äº† setter æ–¹æ³•ã€‚å®é™…ä¸ä¼šå†™è¿™ä¹ˆæ“çš„å§¿åŠ¿ã€‚ã€‚ã€‚åº”è¯¥æ ¹æ®å›è°ƒæ–¹æ³•ä¼ è¿›æ¥å‚æ•°ï¼Œè¿›è¡Œä¿å­˜ JSValueã€‚ 3ã€ä¸è¦åœ¨ä¸åŒçš„ JSVirtualMachine ä¹‹é—´è¿›è¡Œä¼ é€’JSå¯¹è±¡ã€‚ ä¸€ä¸ª JSVirtualMachineå¯ä»¥è¿è¡Œå¤šä¸ªcontextï¼Œç”±äºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå †å†…å­˜å’ŒåŒä¸€ä¸ªåƒåœ¾å›æ”¶ä¸‹ï¼Œæ‰€ä»¥ç›¸äº’ä¹‹é—´ä¼ å€¼æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯å¦‚æœåœ¨ä¸åŒçš„ JSVirtualMachineä¼ å€¼ï¼Œåƒåœ¾å›æ”¶å°±ä¸çŸ¥é“ä»–ä»¬ä¹‹é—´çš„å…³ç³»äº†ï¼Œå¯èƒ½ä¼šå¼•èµ·å¼‚å¸¸ã€‚ çº¿ç¨‹:JavaScriptCore çº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼Œæ¯ä¸ªcontextè¿è¡Œçš„æ—¶å€™é€šè¿‡lockå…³è”çš„JSVirtualMachineã€‚å¦‚æœè¦è¿›è¡Œå¹¶å‘æ“ä½œï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªJSVirtualMachineå®ä¾‹è¿›è¡Œæ“ä½œã€‚ ä¸UIWebViewçš„æ“ä½œ é€šè¿‡ä¸Šé¢çš„demoï¼Œåº”è¯¥å·®ä¸å¤šäº†è§£OCå¦‚ä½•å’ŒJSè¿›è¡Œé€šä¿¡ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¯¹ UIWebView è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬ä¸å†é€šè¿‡URLæ‹¦æˆªï¼Œæˆ‘ä»¬ç›´æ¥å– UIWebView çš„ contextï¼Œç„¶åè¿›è¡Œå¯¹JSæ“ä½œã€‚ åœ¨UIWebViewçš„finishçš„å›è°ƒä¸­è¿›è¡Œè·å– - (void)webViewDidFinishLoad:(UIWebView *)webView { self.context = [webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;]; } ä¸Šé¢ç”¨äº†ç§æœ‰å±æ€§ï¼Œå¯èƒ½ä¼šè¢«è‹¹æœç»™æ‹’äº†ã€‚è¿™è¾¹è¦æ³¨æ„çš„æ˜¯æ¯ä¸ªé¡µé¢åŠ è½½å®Œéƒ½æ˜¯ä¸€ä¸ªæ–°çš„contextï¼Œä½†æ˜¯éƒ½æ˜¯åŒä¸€ä¸ªJSVirtualMachineã€‚å¦‚æœJSè°ƒç”¨OCæ–¹æ³•è¿›è¡Œæ“ä½œUIçš„æ—¶å€™ï¼Œè¯·æ³¨æ„çº¿ç¨‹æ˜¯ä¸æ˜¯ä¸»çº¿ç¨‹ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜15--ç½‘ç»œ]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9815-%E7%BD%91%E7%BB%9C%2F</url>
    <content type="text"><![CDATA[httpè¯·æ±‚æ–¹å¼ï¼Ÿé€šå¸¸ï¼ŒHTTPçš„è¯·æ±‚æ–¹å¼æœ‰3ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šPOSTã€GETã€HEADã€‚POSTå’ŒGETæ–¹æ³•æ˜¯ç”¨äºæ•°æ®å‘é€çš„ã€‚ POSTï¼šå®ƒå°†è¦å‘é€çš„æ•°æ®å•ç‹¬æ”¾åœ¨ä¸€ä¸ªæµä¸­è¿›è¡Œå‘é€ï¼Œè€Œä¸æ˜¯é™„åŠ åœ¨URLåœ°å€åé¢ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯è¿™äº›æ•°æ®ä¸ä¼šå‡ºç°åœ¨URLåœ°å€ä¸­ã€‚ GETï¼šå®ƒå°†è¦å‘é€çš„æ•°æ®ç›´æ¥æ·»åŠ åœ¨URLåé¢ï¼Œå¦‚ï¼šwww.sina.com.cn?username=â€œâ€&amp;password=â€â€ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¯ä»¥ç›´æ¥å°†æ•°æ®åŠ åœ¨URLåï¼Œè€Œä¸éœ€åœ¨ç”¨å¦å¤–çš„æµæ¥å‘é€è¿™äº›æ•°æ®ï¼Œä½†æ˜¯ç¼ºç‚¹ä¹Ÿæ˜¾è€Œæ˜“è§ï¼Œå®ƒå°†ç”¨æˆ·çš„ä¿¡æ¯æ˜¾ç¤ºå‡ºæ¥äº†ã€‚ HEADï¼šå®ƒæ˜¯è¯·æ±‚èµ„æºçš„å…ƒæ•°æ®æ–¹æ³•ã€‚åœ¨å…·ä½“çš„åº”ç”¨ä¸­ï¼Œæˆ‘æš‚æ—¶è¿˜æ²¡é‡åˆ°è¿‡ï¼Œä¹Ÿä¸å»å¯¹å®ƒè¿›è¡Œç ”ç©¶ï¼Œéœ€è¦æ˜¯åœ¨å­¦ä¹ ã€‚ Httpå®šä¹‰äº†ä¸æœåŠ¡å™¨äº¤äº’çš„ä¸åŒæ–¹æ³•ï¼Œæœ€åŸºæœ¬çš„æ–¹æ³•æœ‰ï¼Ÿ URLå…¨ç§°æ˜¯èµ„æºæè¿°ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¤ä¸ºï¼šä¸€ä¸ªURLåœ°å€ï¼Œå®ƒç”¨äºæè¿°ä¸€ä¸ªç½‘ç»œä¸Šçš„èµ„æºï¼Œè€ŒHTTPä¸­çš„GETï¼ŒPOSTï¼ŒPUTï¼ŒDELETEå°±å¯¹åº”ç€å¯¹è¿™ä¸ªèµ„æºçš„æŸ¥ï¼Œæ”¹ï¼Œå¢ï¼Œåˆ 4ä¸ªæ“ä½œã€‚ GETä¸€èˆ¬ç”¨äºè·å–/æŸ¥è¯¢èµ„æºä¿¡æ¯ï¼Œè€ŒPOSTä¸€èˆ¬ç”¨äºæ›´æ–°èµ„æºä¿¡æ¯ã€‚ socketç¼–ç¨‹ç®€è¿°å®ƒæ˜¯åŸºäºTCP/IPåè®®ï¼ŒSocketå°±æ˜¯ä¸€ä¸ªå¯ä»¥è¿é€šç½‘ç»œä¸Šä¸åŒè®¡ç®—æœºç¨‹åºä¹‹é—´çš„ç®¡é“ï¼ŒæŠŠä¸€å †æ•°æ®ä»ç®¡é“çš„Aç«¯æ‰”è¿›å»ï¼Œåˆ™ä¼šä»ç®¡é“çš„Bç«¯ï¼ˆä¹Ÿè®¸åŒæ—¶è¿˜å¯ä»¥ä»Cã€Dã€Eã€Fâ€¦â€¦ç«¯å†’å‡ºæ¥ï¼‰ã€‚ç®¡é“çš„ç«¯å£ç”±ä¸¤ä¸ªå› ç´ æ¥å”¯ä¸€ç¡®è®¤ï¼Œå³æœºå™¨çš„IPåœ°å€å’Œç¨‹åºæ‰€ä½¿ç”¨çš„ç«¯å£å·ã€‚ Socketå¯ä»¥æ”¯æŒæ•°æ®çš„å‘é€å’Œæ¥æ”¶ï¼Œå®ƒä¼šå®šä¹‰ä¸€ç§ç§°ä¸ºå¥—æ¥å­—çš„å˜é‡ï¼Œå‘é€æ•°æ®æ—¶é¦–å…ˆåˆ›å»ºå¥—æ¥å­—ï¼Œç„¶åä½¿ç”¨è¯¥å¥—æ¥å­—çš„sendtoç­‰æ–¹æ³•å¯¹å‡†æŸä¸ªIP/ç«¯å£è¿›è¡Œæ•°æ®å‘é€ï¼›æ¥æ”¶ç«¯ä¹Ÿé¦–å…ˆåˆ›å»ºå¥—æ¥å­—ï¼Œç„¶åå°†è¯¥å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ªIP/ç«¯å£ä¸Šï¼Œæ‰€æœ‰å‘å‘æ­¤ç«¯å£çš„æ•°æ®ä¼šè¢«è¯¥å¥—æ¥å­—çš„recvç­‰å‡½æ•°è¯»å‡ºã€‚å¦‚åŒè¯»å‡ºæ–‡ä»¶ä¸­çš„æ•°æ®ä¸€æ ·ã€‚ TCP/IPçš„socketæä¾›ä¸‹åˆ—ä¸‰ç§ç±»å‹å¥—æ¥å­—ã€‚ æµå¼å¥—æ¥å­—ã€æ•°æ®æŠ¥å¼å¥—æ¥å­—ã€åŸå§‹å¼å¥—æ¥å­—ã€‚ å®¢æˆ·ç«¯ç¼–ç¨‹æ­¥éª¤ï¼š 1ï¼šåŠ è½½å¥—æ¥å­—åº“ï¼Œåˆ›å»ºå¥—æ¥å­—(WSAStartup()/socket())ï¼› 2ï¼šå‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚(connect())ï¼› 3ï¼šå’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡(send()/recv())ï¼› 4ï¼šå…³é—­å¥—æ¥å­—ï¼Œå…³é—­åŠ è½½çš„å¥—æ¥å­—åº“(closesocket()/WSACleanup())ã€‚ å¸¸ç”¨ç¬¬ä¸‰æ–¹åº“ï¼š1ï¼ŒAsyncsocketåº“ asihttpä»£ç åŸç†ï¼Œå¼‚æ­¥è¯·æ±‚çš„åŸç†ï¼Œå¼‚æ­¥è¯·æ±‚æœ€å¤§æ•°ç›®ï¼Œä¸ºä»€ä¹ˆåªèƒ½è¿™ä¹ˆå¤šï¼Ÿ ASIHTTPRequestæ˜¯ä¸€ä¸ªç®€æ˜“ä½¿ç”¨çš„ç±»åº“,é€šè¿‡åŒ…è£…CFNetwork API æ¥ç®€åŒ– å’ŒæœåŠ¡å™¨ç«¯çš„é€šè®¯. å®ƒç¼–å†™çš„è¯­è¨€æ˜¯Objective-C èƒ½å¤Ÿåº”ç”¨äºMac OS X and iPhone å¹³å°çš„åº”ç”¨ç¨‹åº. å¼‚æ­¥: è¯·æ±‚é€šè¿‡äº‹ä»¶è§¦å‘-&gt;æœåŠ¡å™¨å¤„ç†ï¼ˆè¿™æ˜¯æµè§ˆå™¨ä»ç„¶å¯ä»¥ä½œå…¶ä»–äº‹æƒ…ï¼‰-&gt;å¤„ç†å®Œæ¯•è¿™ä¸ªæ•°é‡æ˜¯è·Ÿcpuæœ‰å…³çš„,å¹¶å‘æ€§å–å†³äºcpuæ ¸æ•°,æ¯ä¸ªæ ¸åªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªä»»åŠ¡.4æ ¸cpuç†è®ºä¸Šå¯ä»¥å¹¶å‘å¤„ç†4ä¸ªä»»åŠ¡,å¦‚æœæŒ‰httpæ¥ç®—å°±æ˜¯4ä¸ªè¯·æ±‚,ä½†æ˜¯cpuæ˜¯æŠ¢å å¼èµ„æº,æ‰€ä»¥ä¸€èˆ¬æ¥è¯´å¹¶å‘é‡æ˜¯è¦æ ¹æ®ä»»åŠ¡çš„è€—æ—¶å’Œcpuçš„ç¹å¿™åº¦æ¥è®¡ç®—4ä¸ªå·¦å³åªæ˜¯ä¸ªç»éªŒå€¼ä½ å¼€10ä¸ªçŸ­è€—æ—¶çš„ä»»åŠ¡å’Œå‡ ä¸ªé•¿è€—æ—¶ä»»åŠ¡çš„æ•ˆç‡æ˜¯ä¸åŒçš„ã€‚ JSONKitã€SBJsonã€TouchJSONå’ŒåŸç”Ÿçš„åŒºåˆ«?JSONKitã€SBJsonã€TouchJSONï¼ˆæ€§èƒ½ä»å·¦åˆ°å³ï¼Œè¶Šå³è¶Šå·®,ä¸»è¦å°±æ˜¯æ€§èƒ½ä¸Šçš„å·®åˆ«ï¼‰ Appéœ€è¦åŠ è½½è¶…å¤§é‡çš„æ•°æ®ï¼Œç»™æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨å¡ä½äº†å¦‚ä½•è§£å†³ï¼Ÿ1&gt; è®¾ç½®è¯·æ±‚è¶…æ—¶ 2&gt; ç»™ç”¨æˆ·æç¤ºè¯·æ±‚è¶…æ—¶ 3&gt; æ ¹æ®ç”¨æˆ·æ“ä½œå†æ¬¡è¯·æ±‚æ•°æ® HTTPçš„é€šä¿¡çš„ å‘é€è¯·æ±‚ã€æ¥æ”¶å“åº” åŒ…å«å“ªäº›å†…å®¹ï¼ŸOCä¸­æ˜¯æ€æ ·å®ç°çš„ï¼Ÿ è¯·æ±‚ï¼šä¸€ä¸ªè¯·æ±‚åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š è¯·æ±‚è¡Œï¼šåŒ…å«äº†è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚èµ„æºè·¯å¾„ã€HTTPåè®®ç‰ˆæœ¬ GET /XXServer/resources/images/1.jpg HTTP/1.1 è¯·æ±‚å¤´ï¼šåŒ…å«äº†å¯¹å®¢æˆ·ç«¯çš„ç¯å¢ƒæè¿°ã€å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸»æœºåœ°å€ç­‰ä¿¡æ¯ Host: 192.168.1.105:8080 // å®¢æˆ·ç«¯æƒ³è®¿é—®çš„æœåŠ¡å™¨ä¸»æœºåœ°å€ User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9) Firefox/30.0 // å®¢æˆ·ç«¯çš„ç±»å‹ï¼Œå®¢æˆ·ç«¯çš„è½¯ä»¶ç¯å¢ƒ Accept: text/html, / // å®¢æˆ·ç«¯æ‰€èƒ½æ¥æ”¶çš„æ•°æ®ç±»å‹ Accept-Language: zh-cn // å®¢æˆ·ç«¯çš„è¯­è¨€ç¯å¢ƒ Accept-Encoding: gzip // å®¢æˆ·ç«¯æ”¯æŒçš„æ•°æ®å‹ç¼©æ ¼å¼ è¯·æ±‚ä½“ï¼šå®¢æˆ·ç«¯å‘ç»™æœåŠ¡å™¨çš„å…·ä½“æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶æ•°æ® OCä¸­è¯·æ±‚NSURLRequest å‘é€ç»™æœåŠ¡å™¨çš„è¯·æ±‚åŒ…å«ï¼š è¯·æ±‚è¡Œï¼š åŒ…å«äº†è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚èµ„æºè·¯å¾„ã€HTTPåè®®ç‰ˆæœ¬ è¯·æ±‚å¤´ï¼š å¯¹å®¢æˆ·ç«¯çš„ç¯å¢ƒæè¿°ã€å®¢æˆ·ç«¯è¯·æ±‚çš„ä¸»æœºåœ°å€ç­‰ä¿¡æ¯ è¯·æ±‚ä½“ï¼š å®¢æˆ·ç«¯å‘ç»™æœåŠ¡å™¨çš„å…·ä½“æ•°æ® é»˜è®¤è¶…æ—¶æ—¶å¸¸ï¼š60s å“åº”ï¼š ä¸€ä¸ªå“åº”åŒ…æ‹¬ï¼š çŠ¶æ€è¡Œï¼šåŒ…å«äº†HTTPåè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€è‹±æ–‡åç§° HTTP/1.1 200 OK å“åº”å¤´ï¼šåŒ…å«äº†å¯¹æœåŠ¡å™¨çš„æè¿°ã€å¯¹è¿”å›æ•°æ®çš„æè¿° Server: Apache-Coyote/1.1 // æœåŠ¡å™¨çš„ç±»å‹ Content-Type: image/jpeg // è¿”å›æ•°æ®çš„ç±»å‹ Content-Length: 56811 // è¿”å›æ•°æ®çš„é•¿åº¦ Date: Mon, 23 Jun 2014 12:54:52 GMT // å“åº”çš„æ—¶é—´ å®ä½“å†…å®¹ï¼šæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å…·ä½“æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶æ•°æ® OCä¸­å“åº”ç”¨NSURLResposeï¼šè¿”å›ç»™å®¢æˆ·ç«¯çš„å›åº”åŒ…å«ï¼š çŠ¶æ€è¡Œ ï¼š åŒ…å«äº†HTTPåè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€è‹±æ–‡åç§° å“åº”å¤´ ï¼š åŒ…å«äº†å¯¹æœåŠ¡å™¨çš„æè¿°ã€å¯¹è¿”å›æ•°æ®çš„æè¿° å®ä½“å†…å®¹ï¼šæœåŠ¡å™¨è¿”å›ç»™å®¢æˆ·ç«¯çš„å…·ä½“äºŒè¿›åˆ¶æ•°æ® å¸¸ç”¨å±æ€§ï¼š expectedContentLength ï¼ˆä¸‹è½½æ—¶è¿”å›æ–‡ä»¶çš„é•¿åº¦ï¼‰ suggestedFilenameï¼ˆå»ºè®®ä¿å­˜çš„æ–‡ä»¶åï¼‰ http çš„postä¸getåŒºåˆ«ä¸è”ç³»ï¼Œå®è·µä¸­å¦‚ä½•é€‰æ‹©å®ƒä»¬ï¼Ÿ GET POST ç”¨é€” ä»æœåŠ¡å™¨ä¸Šè·å–æ•°æ® å‘æœåŠ¡å™¨ä¼ é€æ•°æ®æäº¤æ–¹å¼ æœåŠ¡å™¨è§£æ Request.QueryStringè·å–å˜é‡çš„å€¼ Request.Formè·å–æäº¤çš„æ•°æ® æ•°æ®å¤§å° æœ€å¤§1024å­—èŠ‚ æ— é™åˆ¶ å®‰å…¨æ€§ URLä¸­èƒ½çœ‹åˆ°æäº¤çš„æ•°æ® éšè—åœ¨è¯·æ±‚å¤´ä¸­ çŸ¥é“TCP/UDPå—ï¼Ÿè¯´è¯´å…³äºUDP/TCPçš„åŒºåˆ«ï¼Ÿ UDP: æ˜¯ç”¨æˆ·æ•°æ®æŠ¥åè®®: ä¸»è¦ç”¨åœ¨å®æ—¶æ€§è¦æ±‚é«˜ä»¥åŠå¯¹è´¨é‡ç›¸å¯¹è¾ƒå¼±çš„åœ°æ–¹,ä½†é¢å¯¹ç°åœ¨é«˜è´¨é‡çš„çº¿è·¯ä¸æ˜¯å®¹æ˜“ä¸¢åŒ…é™¤éæ˜¯ä¸€äº›æ‹¥å¡æ¡ä»¶ä¸‹, å¦‚æµåª’ä½“ TCP: æ˜¯ä¼ è¾“æ§åˆ¶åè®®:æ˜¯é¢è¿æ¥çš„,é‚£ä¹ˆè¿è¡Œç¯å¢ƒå¿…ç„¶è¦æ±‚å…¶å¯é æ€§ä¸å¯ä¸¢åŒ…æœ‰è‰¯å¥½çš„æ‹¥å¡æ§åˆ¶æœºåˆ¶å¦‚http ftp telnet ç­‰ TCP UDP å‘é€ä¸æ¥æ”¶ å®‰å…¨é€è¾¾ åªç®¡å‘é€ å»ºç«‹è¿æ¥ æ˜¯ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ å¦ï¼ˆæœ‰æ•°æ®åŒ…ï¼Œæ— éœ€è¿æ¥ï¼‰ æ•°æ®å¤§å° æ— é™åˆ¶ æ¯ä¸ªæ•°æ®æŠ¥64k å¯é æ€§ å¯é  ä¸å¯é  é€Ÿåº¦ æ…¢ï¼ˆä¸‰æ¬¡æ¡æ‰‹æ‰èƒ½å®Œæˆè¿æ¥ å¿«ï¼ˆæ— éœ€è¿æ¥ï¼‰ åº”ç”¨ æµåª’ä½“ qq ä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹ï¼Ÿ ä¸‰æ¬¡æ¡æ‰‹å®ç°çš„è¿‡ç¨‹ï¼š ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€åŒæ­¥åºåˆ—ç¼–å·åˆ°æœåŠ¡å™¨ï¼Œå¹¶è¿›å…¥å‘é€çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨ç¡®è®¤ ç¬¬äºŒæ¬¡ï¼šæœåŠ¡å™¨æ”¶åˆ°åŒæ­¥åºåˆ—ç¼–å·ï¼Œç¡®è®¤å¹¶åŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªåŒæ­¥åºåˆ—ç¼–å·+ç¡®è®¤æ ‡å¿—ï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥æ¥æ”¶çŠ¶æ€ ç¬¬ä¸‰æ¬¡ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„åŒ…ï¼Œå¹¶å‘æœåŠ¡å™¨å‘é€ç¡®è®¤æ ‡å¿—ï¼Œéšåé“¾æ¥æˆåŠŸã€‚ æ³¨æ„ï¼šæ˜¯åœ¨é“¾æ¥æˆåŠŸååœ¨è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ å››æ¬¡æŒ¥æ‰‹ï¼š ç¬¬ä¸€æ¬¡ï¼š å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªå¸¦æœ‰ç»“æŸæ ‡è®°çš„æŠ¥æ–‡ã€‚ ç¬¬äºŒæ¬¡ï¼šæœåŠ¡å™¨æ”¶åˆ°æŠ¥æ–‡åï¼Œå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç¡®è®¤åºå·ï¼ŒåŒæ—¶é€šçŸ¥è‡ªå·±ç›¸åº”çš„åº”ç”¨ç¨‹åºï¼šå¯¹æ–¹è¦æ±‚å…³é—­è¿æ¥ ç¬¬ä¸‰æ¬¡ï¼š æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰ç»“æŸæ ‡è®°çš„æŠ¥æ–‡ã€‚ ç¬¬å››æ¬¡ï¼š å®¢æˆ·ç«¯æ”¶åˆ°æŠ¥æ–‡åï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç¡®è®¤åºå·ã€‚é“¾æ¥å…³é—­ã€‚ åˆ†æjsonã€xmlçš„åŒºåˆ«?jsonã€xmlè§£ææ–¹å¼çš„åº•å±‚æ˜¯å¦‚ä½•å¤„ç†çš„? Jsonä¸xmlçš„åŒºåˆ«: å¯è¯»æ€§æ–¹é¢:åŸºæœ¬ç›¸åŒ,xmlçš„å¯è¯»æ€§æ¯”è¾ƒå¥½ å¯æ‰©å±•æ€§æ–¹é¢:éƒ½å…·æœ‰å¾ˆå¥½çš„æ‰©å±•æ€§ ç¼–ç éš¾åº¦æ–¹é¢:ç›¸å¯¹è€Œè¨€:JSONçš„ç¼–ç æ¯”è¾ƒå®¹æ˜“ è§£ç éš¾åº¦:jsonçš„è§£ç éš¾åº¦åŸºæœ¬ä¸ºé›¶,xmléœ€è¦è€ƒè™‘å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹ æ•°æ®ä½“ç§¯æ–¹é¢:jsonç›¸å¯¹äºxmlæ¥è®²,æ•°æ®ä½“ç§¯å°,ä¼ é€’çš„é€Ÿåº¦è·Ÿå¿«äº› æ•°æ®äº¤äº’æ–¹é¢:jsonä¸JavaScriptçš„äº¤äº’æ›´åŠ æ–¹é¢,æ›´å®¹æ˜“è§£æå¤„ç†,æ›´å¥½çš„æ•°æ®äº¤äº’ æ•°æ®æè¿°æ–¹é¢:xmlå¯¹æ•°æ®æè¿°æ€§æ¯”è¾ƒå¥½ ä¼ è¾“é€Ÿåº¦æ–¹é¢:jsonçš„é€Ÿåº¦è¿œè¿œå¿«äºxml JSONåº•å±‚åŸç†: éå†å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦,æœ€ç»ˆæ ¹æ®æ ¼å¼è§„å®šçš„ç‰¹æ®Šå­—ç¬¦,æ¯”å¦‚{}å·,[]å·, : å· ç­‰è¿›è¡ŒåŒºåˆ†,{}å·æ˜¯ä¸€ä¸ªå­—å…¸ çš„å¼€å§‹,[]å·æ˜¯ä¸€ä¸ªæ•°ç»„çš„å¼€å§‹, : å·æ˜¯å­—å…¸çš„é”®å’Œå€¼çš„åˆ†æ°´å²­,æœ€ç»ˆä¹ƒæ˜¯å°†jsonæ•°æ®è½¬åŒ–ä¸ºå­—å…¸,å­—å…¸ä¸­å€¼å¯èƒ½æ˜¯å­—å…¸,æ•°ç»„,æˆ–å­—ç¬¦ä¸²è€Œå·²ã€‚ XMLåº•å±‚åŸç†: XMLè§£æå¸¸ç”¨çš„è§£ææ–¹æ³•æœ‰ä¸¤ç§:DOMè§£æå’ŒSAXè§£æã€‚ DOM é‡‡ç”¨å»ºç«‹æ ‘å½¢ç»“æ„çš„æ–¹å¼è®¿é—® XML æ–‡æ¡£,è€Œ SAX é‡‡ç”¨çš„äº‹ä»¶æ¨¡å‹ã€‚ DOM è§£ææŠŠ XML æ–‡æ¡£è½¬åŒ–ä¸ºä¸€ä¸ªåŒ…å«å…¶å†…å®¹çš„æ ‘,å¹¶å¯ä»¥å¯¹æ ‘è¿›è¡Œéå†ã€‚ ä½¿ç”¨ DOM è§£æå™¨çš„æ—¶å€™éœ€ è¦å¤„ç†æ•´ä¸ª XML æ–‡æ¡£,æ‰€ä»¥å¯¹æ€§èƒ½å’Œå†…å­˜çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚ SAXåœ¨è§£æ XML æ–‡æ¡£çš„æ—¶å€™å¯ä»¥è§¦å‘ä¸€ç³»åˆ—çš„äº‹ä»¶,å½“å‘ç°ç»™å®šçš„tagçš„æ—¶å€™,å®ƒå¯ä»¥æ¿€æ´»ä¸€ä¸ªå›è°ƒæ–¹æ³•,å‘Šè¯‰è¯¥æ–¹æ³•åˆ¶å®šçš„æ ‡ç­¾å·²ç»æ‰¾åˆ°ã€‚ SAX å¯¹å†…å­˜çš„è¦æ±‚é€šå¸¸ä¼šæ¯”è¾ƒä½,å› ä¸ºå®ƒè®©å¼€å‘äººå‘˜è‡ªå·±æ¥å†³å®šæ‰€è¦å¤„ç†çš„tagã€‚ç‰¹åˆ«æ˜¯å½“å¼€å‘äººå‘˜åªéœ€è¦å¤„ç†æ–‡æ¡£ä¸­æ‰€åŒ…å«çš„éƒ¨åˆ†æ•°æ®æ—¶,SAX è¿™ç§æ‰©å±•èƒ½åŠ›å¾—åˆ°äº†æ›´å¥½çš„ä½“ç°ã€‚ (è¡¥å……)å…¶ä»–è§£ææ–¹å¼æœ‰è‡ªå®šä¹‰äºŒè¿›åˆ¶è§£æï¼Œå°±æ˜¯æŒ‰å­—èŠ‚å»è§£æï¼Œç”µè¯ä¼šè°ˆå°±æ˜¯å¦‚æ­¤ï¼Œè¿˜å¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹‹é—´ç”¨ç‰¹æ®Šç¬¦å·è¿æ¥çš„æ•°æ®ï¼Œå°†æ­¤æ•°æ®ç”¨ç‰¹æ®Šç¬¦å·å¯ä»¥åˆ†å‰²æˆæ‰€ç”¨æ•°æ®ã€‚ httpå’Œscoketé€šä¿¡çš„åŒºåˆ«?socketè¿æ¥ç›¸å…³åº“,TCP,UDPçš„è¿æ¥æ–¹æ³•,HTTPçš„å‡ ç§å¸¸ç”¨æ–¹å¼? httpå’Œscoketé€šä¿¡çš„åŒºåˆ«: httpæ˜¯å®¢æˆ·ç«¯ç”¨httpåè®®è¿›è¡Œè¯·æ±‚,å‘é€è¯·æ±‚æ—¶å€™éœ€è¦å°è£…httpè¯·æ±‚å¤´,å¹¶ç»‘å®šè¯·æ±‚çš„æ•°æ®,æœåŠ¡å™¨ä¸€èˆ¬æœ‰webæœåŠ¡å™¨é…åˆ(å½“ç„¶ä¹Ÿéç»å¯¹)ã€‚ httpè¯·æ±‚æ–¹å¼ä¸ºå®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚,æœåŠ¡å™¨æ‰èƒ½ç»™å“åº”,ä¸€æ¬¡è¯·æ±‚å®Œæ¯•ååˆ™æ–­å¼€è¿æ¥,ä»¥èŠ‚çœèµ„æºã€‚æœåŠ¡å™¨ä¸èƒ½ä¸»åŠ¨ç»™å®¢æˆ·ç«¯å“åº”(é™¤éé‡‡å–httpé•¿è¿æ¥æŠ€æœ¯)ã€‚iphoneä¸»è¦ä½¿ç”¨ç±»æ˜¯NSUrlConnectionã€‚ scoketæ˜¯å®¢æˆ·ç«¯è·ŸæœåŠ¡å™¨ç›´æ¥ä½¿ç”¨socketâ€œå¥—æ¥å­—â€è¿›è¡Œè¿æ¥,å¹¶æ²¡æœ‰è§„å®šè¿æ¥åæ–­å¼€,æ‰€ä»¥å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ä¿æŒè¿æ¥é€šé“,åŒæ–¹éƒ½å¯ä»¥ä¸»åŠ¨å‘é€æ•°æ®ã€‚ä¸€èˆ¬åœ¨æ¸¸æˆå¼€å‘æˆ–è‚¡ç¥¨å¼€å‘è¿™ç§è¦æ±‚å³æ—¶æ€§å¾ˆå¼ºå¹¶ä¸”ä¿æŒå‘é€æ•°æ®é‡æ¯”è¾ƒå¤§çš„åœºåˆä½¿ç”¨ã€‚ä¸»è¦ä½¿ç”¨ç±»æ˜¯CFSocketRefã€‚ é€šä¿¡åº•å±‚åŸç†ï¼ˆOSIä¸ƒå±‚æ¨¡å‹ï¼‰ OSIç®€ä»‹ï¼šOSIé‡‡ç”¨äº†åˆ†å±‚çš„ç»“æ„åŒ–æŠ€æœ¯ï¼Œå…±åˆ†ä¸ƒå±‚ï¼Œç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚ã€‚ ç‰©ç†å±‚ï¼šä¸»è¦å®šä¹‰ç‰©ç†è®¾å¤‡æ ‡å‡†ï¼Œå¦‚ç½‘çº¿çš„æ¥å£ç±»å‹ã€å…‰çº¤çš„æ¥å£ç±»å‹ã€å„ç§ä¼ è¾“ä»‹è´¨çš„ä¼ è¾“é€Ÿç‡ç­‰ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¼ è¾“æ¯”ç‰¹æµï¼ˆå°±æ˜¯ç”±1ã€0è½¬åŒ–ä¸ºç”µæµå¼ºå¼±æ¥è¿›è¡Œä¼ è¾“,åˆ°è¾¾ç›®çš„åœ°ååœ¨è½¬åŒ–ä¸º1ã€0ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„æ•°æ¨¡è½¬æ¢ä¸æ¨¡æ•°è½¬æ¢ï¼‰ã€‚è¿™ä¸€å±‚çš„æ•°æ®å«åšæ¯”ç‰¹ã€‚ æ•°æ®é“¾è·¯å±‚ï¼šå®šä¹‰äº†å¦‚ä½•è®©æ ¼å¼åŒ–æ•°æ®ä»¥è¿›è¡Œä¼ è¾“ï¼Œä»¥åŠå¦‚ä½•è®©æ§åˆ¶å¯¹ç‰©ç†ä»‹è´¨çš„è®¿é—®ã€‚è¿™ä¸€å±‚é€šå¸¸è¿˜æä¾›é”™è¯¯æ£€æµ‹å’Œçº æ­£ï¼Œä»¥ç¡®ä¿æ•°æ®çš„å¯é ä¼ è¾“ã€‚ ç½‘ç»œå±‚ï¼šï¼šåœ¨ä½äºä¸åŒåœ°ç†ä½ç½®çš„ç½‘ç»œä¸­çš„ä¸¤ä¸ªä¸»æœºç³»ç»Ÿä¹‹é—´æä¾›è¿æ¥å’Œè·¯å¾„é€‰æ‹©ã€‚Internetçš„å‘å±•ä½¿å¾—ä»ä¸–ç•Œå„ç«™ç‚¹è®¿é—®ä¿¡æ¯çš„ç”¨æˆ·æ•°å¤§å¤§å¢åŠ ï¼Œè€Œç½‘ç»œå±‚æ­£æ˜¯ç®¡ç†è¿™ç§è¿æ¥çš„å±‚ã€‚ ä¼ è¾“å±‚ï¼šå®šä¹‰äº†ä¸€äº›ä¼ è¾“æ•°æ®çš„åè®®å’Œç«¯å£å·ï¼ˆWWWç«¯å£80ç­‰ï¼‰ï¼Œå¦‚ï¼šTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼Œä¼ è¾“æ•ˆç‡ä½ï¼Œå¯é æ€§å¼ºï¼Œç”¨äºä¼ è¾“å¯é æ€§è¦æ±‚é«˜ï¼Œæ•°æ®é‡å¤§çš„æ•°æ®ï¼‰ï¼ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œä¸TCPç‰¹æ€§æ°æ°ç›¸åï¼Œç”¨äºä¼ è¾“å¯é æ€§è¦æ±‚ä¸é«˜ï¼Œæ•°æ®é‡å°çš„æ•°æ®ï¼Œå¦‚QQèŠå¤©æ•°æ®å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼ä¼ è¾“çš„ï¼‰ã€‚ ä¸»è¦æ˜¯å°†ä»ä¸‹å±‚æ¥æ”¶çš„æ•°æ®è¿›è¡Œåˆ†æ®µå’Œä¼ è¾“ï¼Œåˆ°è¾¾ç›®çš„åœ°å€åå†è¿›è¡Œé‡ç»„ã€‚å¸¸å¸¸æŠŠè¿™ä¸€å±‚æ•°æ®å«åšæ®µã€‚ ä¼šè¯å±‚ï¼šé€šè¿‡ä¼ è¾“å±‚ï¼ˆç«¯å£å·ï¼šä¼ è¾“ç«¯å£ä¸æ¥æ”¶ç«¯å£ï¼‰å»ºç«‹æ•°æ®ä¼ è¾“çš„é€šè·¯ã€‚ä¸»è¦åœ¨ä½ çš„ç³»ç»Ÿä¹‹é—´å‘èµ·ä¼šè¯æˆ–è€…æ¥å—ä¼šè¯è¯·æ±‚ï¼ˆè®¾å¤‡ä¹‹é—´éœ€è¦äº’ç›¸è®¤è¯†å¯ä»¥æ˜¯IPä¹Ÿå¯ä»¥æ˜¯MACæˆ–è€…æ˜¯ä¸»æœºåï¼‰ è¡¨ç¤ºå±‚ï¼šï¼šå¯ç¡®ä¿ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚æ‰€å‘é€çš„ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚è¯»å–ã€‚ä¾‹å¦‚ï¼ŒPCç¨‹åºä¸å¦ä¸€å°è®¡ç®—æœºè¿›è¡Œé€šä¿¡ï¼Œå…¶ä¸­ä¸€å°è®¡ç®—æœºä½¿ç”¨æ‰©å±•äºŒä¸€åè¿›åˆ¶äº¤æ¢ç ï¼ˆEBCDICï¼‰ï¼Œè€Œå¦ä¸€å°åˆ™ä½¿ç”¨ç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ç ï¼ˆASCIIï¼‰æ¥è¡¨ç¤ºç›¸åŒçš„å­—ç¬¦ã€‚å¦‚æœ‰å¿…è¦ï¼Œè¡¨ç¤ºå±‚ä¼šé€šè¿‡ä½¿ç”¨ä¸€ç§é€šæ ¼å¼æ¥å®ç°å¤šç§æ•°æ®æ ¼å¼ä¹‹é—´çš„è½¬æ¢ã€‚ åº”ç”¨å±‚ï¼šæ˜¯æœ€é è¿‘ç”¨æˆ·çš„OSIå±‚ã€‚è¿™ä¸€å±‚ä¸ºç”¨æˆ·çš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ç”µå­é‚®ä»¶ã€æ–‡ä»¶ä¼ è¾“å’Œç»ˆç«¯ä»¿çœŸï¼‰æä¾›ç½‘ç»œæœåŠ¡ã€‚ all people seem to need date processingè¿™ä¸€å¥è¯çš„æ„æ€æ˜¯æ‰€æœ‰çš„äººä¼¼ä¹éƒ½éœ€è¦å¤„ç†æ•°æ® Application all Presentation people Session seem Transport to Network need Data date Physical processing è®¾è®¡ä¸€å¥—å¤§æ–‡ä»¶ï¼ˆå¦‚ä¸Šç™¾Mçš„è§†é¢‘ï¼‰ä¸‹è½½æ–¹æ¡ˆ NSURLSession æ”¯æŒæ–­ç‚¹ä¸‹è½½ï¼Œè‡ªåŠ¨è®°å½•åœæ­¢ä¸‹è½½æ—¶æ–­ç‚¹çš„ä½ç½® éµå®ˆNSURLSessionDownloadDelegateåè®® ä½¿ç”¨NSURLSessionä¸‹è½½å¤§æ–‡ä»¶ï¼Œè¢«ä¸‹è½½æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨å†™å…¥æ²™ç›’çš„ä¸´æ—¶æ–‡ä»¶å¤¹tmpä¸­ ä¸‹è½½å®Œæ¯•ï¼Œé€šå¸¸éœ€è¦å°†å·²ä¸‹è½½æ–‡ä»¶ç§»åŠ¨å…¶ä»–ä½ç½®ï¼ˆtmpæ–‡ä»¶å¤¹ä¸­çš„æ•°æ®è¢«å®šæ—¶åˆ é™¤ï¼‰ï¼Œé€šå¸¸æ˜¯cacheæ–‡ä»¶å¤¹ä¸­ ä¸‹è½½æ­¥éª¤ï¼š è®¾ç½®ä¸‹è½½ä»»åŠ¡taskçš„ä¸ºæˆå‘˜å˜é‡ @property (nonatomic, strong) NSURLSessionDownloadTask *task; è·å–NSURLSessionå¯¹è±¡ NSURLSession *session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[[NSOperationQueue alloc] init]]; åˆå§‹åŒ–ä¸‹è½½ä»»åŠ¡ä»»åŠ¡ self.task = [session downloadTaskWithURL:ï¼ˆæ­¤å¤„ä¸ºä¸‹è½½æ–‡ä»¶è·¯å¾„URLï¼‰]; å®ç°ä»£ç†æ–¹æ³• /**æ¯å½“å†™å…¥æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œé€šå¸¸åœ¨è¯¥æ–¹æ³•ä¸­è·å–ä¸‹è½½è¿›åº¦*/ -(void)URLSession:(NSURLSession *)session downloadTask: (NSURLSessionDownloadTask *)downloadTask didWriteData:(int64_t)bytesWritten totalBytesWritten:(int64_t)totalBytesWritten totalBytesExpectedToWrite:(int64_t)totalBytesExpectedToWrite { // è®¡ç®—ä¸‹è½½è¿›åº¦ CGFloat progress = 1.0 * totalBytesWritten / totalBytesExpectedToWrite; } /**ä»»åŠ¡ç»ˆæ­¢æ—¶è°ƒç”¨çš„æ–¹æ³•ï¼Œé€šå¸¸ç”¨äºæ–­ç‚¹ä¸‹è½½*/ -(void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didResumeAtOffset:(int64_t)fileOffset expectedTotalBytes:(int64_t)expectedTotalBytes { //fileOffsetï¼šä¸‹è½½ä»»åŠ¡ä¸­æ­¢æ—¶çš„åç§»é‡ } /**é‡åˆ°é”™è¯¯çš„æ—¶å€™è°ƒç”¨ï¼Œerrorå‚æ•°åªèƒ½ä¼ é€’å®¢æˆ·ç«¯çš„é”™è¯¯*/ -(void)URLSession:(NSURLSession *)session task:(NSURLSessionTask *)task didCompleteWithError:(NSError *)error { } /**ä¸‹è½½å®Œæˆçš„æ—¶å€™è°ƒç”¨ï¼Œéœ€è¦å°†æ–‡ä»¶å‰ªåˆ‡åˆ°å¯ä»¥é•¿æœŸä¿å­˜çš„æ–‡ä»¶å¤¹ä¸­*/ -(void)URLSession:(NSURLSession *)session downloadTask:(NSURLSessionDownloadTask *)downloadTask didFinishDownloadingToURL:(NSURL *)location { //ç”Ÿæˆæ–‡ä»¶é•¿æœŸä¿å­˜çš„è·¯å¾„ NSString *file = [[NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject] stringByAppendingPathComponent:downloadTask.response.suggestedFilename]; //è·å–æ–‡ä»¶å¥æŸ„ NSFileManager *fileManager = [NSFileManager defaultManager]; //é€šè¿‡æ–‡ä»¶å¥æŸ„ï¼Œå°†æ–‡ä»¶å‰ªåˆ‡åˆ°æ–‡ä»¶é•¿æœŸä¿å­˜çš„è·¯å¾„ [fileManager moveItemAtURL:location toURL:[NSURL fileURLWithPath:file] error:nil]; } æ“ä½œä»»åŠ¡çŠ¶æ€ /**å¼€å§‹/ç»§ç»­ä¸‹è½½ä»»åŠ¡*/ [self.task resume]; /**æš‚åœä¸‹è½½ä»»åŠ¡*/ [self.task suspend]; HTTPåè®®çš„ç‰¹ç‚¹ï¼Œå…³äºHTTPè¯·æ±‚GETå’ŒPOSTçš„åŒºåˆ«?HTTPåè®®çš„ç‰¹ç‚¹: - HTTPè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯çŸ­è¿æ¥ï¼Œæ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨åšå‡ºå“åº”ï¼ŒæœåŠ¡å™¨å“åº”ä¹‹åï¼Œé“¾æ¥æ–­å¼€ã€‚HTTPæ˜¯ä¸€ä¸ªå±äºåº”ç”¨å±‚é¢å‘å¯¹è±¡çš„åè®®ï¼ŒHTTPæœ‰ä¸¤ç±»æŠ¥æ–‡ï¼šè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚ - HTTPè¯·æ±‚æŠ¥æ–‡ï¼šä¸€ä¸ªHTTPè¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´éƒ¨ã€ç©ºè¡Œå’Œè¯·æ±‚æ•°æ®4éƒ¨åˆ†ç»„æˆã€‚ - HTTPå“åº”æŠ¥æ–‡ï¼šç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€è¡Œã€æ¶ˆæ¯æŠ¥å¤´ã€å“åº”æ­£æ–‡ã€‚ å³æ—¶èŠå¤©Appä¸ä¼šé‡‡ç”¨çš„ç½‘ç»œä¼ è¾“æ–¹å¼A UDP B TCP C HTTP D FTP å‚è€ƒç­”æ¡ˆï¼šD ç†ç”±ï¼šFTPæ˜¯æ–‡ä»¶ä¼ è¾“åè®®ï¼Œæ˜¯File Transfer Protocolçš„ç®€ç§°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç”¨äºæ§åˆ¶äº’è”ç½‘ä¸Šæ–‡ä»¶çš„åŒå‘ä¼ è¾“ï¼Œå› æ­¤ä¸€å®šä¸ä¼šæ˜¯å³æ—¶èŠå¤©ä½¿ç”¨çš„ï¼›UDPæ˜¯é¢å‘æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®ï¼Œæ•°æ®ä¼ è¾“æ˜¯ä¸å¯é çš„ï¼Œå®ƒåªç®¡å‘ï¼Œä¸ç®¡æ”¶ä¸æ”¶å¾—åˆ°ï¼›TCPæ˜¯é¢å‘è¿æ¥çš„ï¼Œå¯é çš„ä¼ è¾“å±‚åè®®ï¼›HTTPæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œå¯¹åº”äºåº”ç”¨å±‚ï¼Œè€ŒHTTPæ˜¯åŸºäºTCPçš„ã€‚ åœ¨Appä¸­æ··åˆHTML5å¼€å‘Appå¦‚ä½•å®ç°çš„ã€‚åœ¨Appä¸­ä½¿ç”¨HTML5çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿåœ¨iOSä¸­ï¼Œé€šå¸¸æ˜¯ç”¨UIWebViewæ¥å®ç°ï¼Œå½“ç„¶åœ¨iOS8ä»¥åå¯ä»¥ä½¿ç”¨WKWebViewæ¥å®ç°.æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹æ³•ï¼š é€šè¿‡å®ç°UIWebViewçš„ä»£ç†æ–¹æ³•æ¥æ‹¦æˆªï¼Œåˆ¤æ–­schemeæ˜¯å¦æ˜¯çº¦å®šå¥½çš„ï¼Œç„¶åiOSè°ƒç”¨æœ¬åœ°ç›¸å…³APIæ¥å®ç°ï¼š - (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType; åœ¨iOS7ä»¥åï¼Œå¯ä»¥ç›´æ¥é€šè¿‡JavaScripteCoreè¿™ä¸ªåº“æ¥å®ç°ï¼Œé€šè¿‡å¾€JS DOMæ³¨å…¥å¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡å¯¹åº”äºæˆ‘ä»¬iOSçš„æŸä¸ªç±»çš„å®ä¾‹ã€‚æ›´è¯¦ç»†è¯·é˜…è¯»ï¼š OC JavaScriptCoreä¸jsäº¤äº’ WKWebViewæ–°ç‰¹æ€§åŠJSäº¤äº’ Swift JavaScriptCoreä¸JSäº¤äº’ å¯ä»¥é€šè¿‡WebViewJavascriptBridgeæ¥å®ç°ã€‚å…·ä½“å¦‚ä½•ä½¿ç”¨ï¼Œè¯·å¤§å®¶å»å…¶å®ƒåšå®¢æœç´¢å§ï¼ ä¼˜ç¼ºç‚¹ï¼š iOSåŠ å…¥H5å“åº”æ¯”åŸç”Ÿè¦æ…¢å¾ˆå¤šï¼Œä½“éªŒä¸å¤ªå¥½ï¼Œè¿™æ˜¯ç¼ºç‚¹ã€‚ iOSåŠ å…¥H5å¯ä»¥å®ç°åµŒå…¥åˆ«çš„åŠŸèƒ½å…¥å£ï¼Œå¯éšæ—¶æ›´æ”¹ï¼Œä¸ç”¨æ›´æ–°ç‰ˆæœ¬å°±å¯ä»¥ä¸Šçº¿ï¼Œè¿™æ˜¯æœ€å¤§çš„ä¼˜ç‚¹ã€‚ ä»‹ç»ä¸€ä¸‹XMPP?æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹å—?XMPP(Extensible Messaging and Presence Protocol,å‰ç§°)æ˜¯ä¸€ç§ä»¥XMLä¸ºåŸºç¡€çš„å¼€æ”¾å¼å®æ—¶é€šä¿¡åè®®,æ˜¯ ç»ç”±äº’è”ç½‘å·¥ç¨‹å·¥ä½œå°ç»„(IETF)é€šè¿‡çš„äº’è”ç½‘æ ‡å‡†ã€‚ç®€å•çš„è¯´,XMPPå°±æ˜¯ä¸€ç§åè®®,ä¸€ç§è§„å®šã€‚å°±æ˜¯è¯´,åœ¨ç½‘ç»œä¸Šä¼  ä¸œè¥¿,è¦å»ºç«‹è¿æ¥,TCP/IPè¿æ¥,å»ºç«‹åå†ä¼ ä¸œè¥¿,è€ŒXMPPå°±æ˜¯è§„å®šä½ ä¼ çš„ä¸œè¥¿çš„æ ¼å¼ã€‚XMPPæ˜¯åŸºäºXMLçš„åè®®ã€‚ ä¼˜ç‚¹ å¼€æ”¾: XMPPåè®®æ˜¯è‡ªç”±ã€å¼€æ”¾ã€å…¬å¼€çš„,å¹¶ä¸”æ˜“äºäº†è§£ã€‚ è€Œä¸”åœ¨å®¢æˆ·ç«¯ ã€ æœåŠ¡å™¨ ã€ ç»„ä»¶ ã€ æºç åº“ç­‰æ–¹é¢,éƒ½å·²ç»å„è‡ªæœ‰å¤šç§å®ç°ã€‚ æ ‡å‡†: äº’è”ç½‘å·¥ç¨‹å·¥ä½œå°ç»„( IETF )å·²ç»å°†Jabberçš„æ ¸å¿ƒXMLæµåè®®ä»¥XMPPä¹‹å,æ­£å¼åˆ—ä¸ºè®¤å¯çš„å®æ—¶é€šä¿¡åŠPresenceæŠ€æœ¯ã€‚ è€ŒXMPPçš„æŠ€æœ¯è§„æ ¼å·²è¢«å®šä¹‰åœ¨RFC 3920åŠRFC 3921 ã€‚ ä»»ä½•IMä¾›åº”å•†åœ¨éµå¾ªXMPPåè®®ä¸‹,éƒ½å¯ä¸Google Talkå®ç°è¿æ¥ã€‚ è¯å®å¯ç”¨: ç¬¬ä¸€ä¸ªJabber(ç°åœ¨XMPP)æŠ€æœ¯æ˜¯Jeremie Milleråœ¨1998å¹´å¼€å‘çš„,ç°åœ¨å·²ç»ç›¸å½“ç¨³å®š;æ•°ä»¥ç™¾è®¡çš„å¼€å‘è€…ä¸ºXMPPæŠ€æœ¯è€ŒåŠª åŠ›ã€‚ ä»Šæ—¥çš„äº’è”ç½‘ä¸Šæœ‰æ•°ä»¥ä¸‡è®¡çš„XMPPæœåŠ¡å™¨è¿ä½œç€,å¹¶æœ‰æ•°ä»¥ç™¾ä¸‡è®¡çš„äººä»¬ä½¿ç”¨XMPPå®æ—¶ä¼ è®¯è½¯ä»¶ã€‚ åˆ†æ•£å¼: XMPPç½‘ç»œçš„æ¶æ„å’Œç”µå­é‚®ä»¶ååˆ†ç›¸åƒ;XMPPæ ¸å¿ƒåè®®é€šä¿¡æ–¹å¼æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªstream,XMPPä»¥TCPä¼ é€’XMLæ•°æ®æµ,æ²¡æœ‰ ä¸­å¤®ä¸»æœåŠ¡å™¨ã€‚ ä»»ä½•äººéƒ½å¯ä»¥è¿è¡Œè‡ªå·±çš„XMPPæœåŠ¡å™¨,ä½¿ä¸ªäººåŠç»„ç»‡èƒ½å¤ŸæŒæ§ä»–ä»¬çš„å®æ—¶ä¼ è®¯ä½“éªŒã€‚ å®‰å…¨: ä»»ä½•XMPPåè®®çš„æœåŠ¡å™¨å¯ä»¥ç‹¬ç«‹äºå…¬ä¼—XMPPç½‘ç»œ(ä¾‹å¦‚åœ¨ä¼ä¸šå†…éƒ¨ç½‘ç»œä¸­),è€Œä½¿ç”¨SASLåŠTLSç­‰æŠ€æœ¯çš„å¯é å®‰å…¨æ€§,å·²è‡ª å¸¦äºæ ¸å¿ƒXMPPæŠ€æœ¯è§„æ ¼ä¸­ã€‚ å¯æ‰©å±•: XML å‘½åç©ºé—´çš„å¨åŠ›å¯ä½¿ä»»ä½•äººåœ¨æ ¸å¿ƒåè®®çš„åŸºç¡€ä¸Šå»ºé€ å®šåˆ¶åŒ–çš„åŠŸèƒ½;ä¸ºäº†ç»´æŒé€šé€æ€§,å¸¸è§çš„æ‰©å±•ç”±XMPPæ ‡å‡†åŸºé‡‘ä¼š ã€‚ å¼¹æ€§ä½³: XMPPé™¤äº†å¯ç”¨åœ¨å®æ—¶é€šä¿¡çš„åº”ç”¨ç¨‹åº,è¿˜èƒ½ç”¨åœ¨ç½‘ç»œç®¡ç†ã€å†…å®¹ä¾›ç¨¿ã€ååŒå·¥å…·ã€æ–‡ä»¶å…±äº«ã€æ¸¸æˆã€è¿œç¨‹ç³»ç»Ÿç›‘æ§ç­‰ã€‚ å¤šæ ·æ€§: ç”¨XMPPåè®®æ¥å»ºé€ åŠå¸ƒç½²å®æ—¶åº”ç”¨ç¨‹åºåŠæœåŠ¡çš„å…¬å¸åŠå¼€æ”¾æºä»£ç è®¡åˆ’åˆ†å¸ƒåœ¨å„ç§é¢†åŸŸ;ç”¨XMPPæŠ€æœ¯å¼€å‘è½¯ä»¶,èµ„æºåŠæ”¯æŒçš„ æ¥æºæ˜¯å¤šæ ·çš„,ä½¿å¾—ä½¿ä½ ä¸ä¼šé™·äºè¢«â€œç»‘æ¶â€çš„å›°å¢ƒã€‚ ç¼ºç‚¹ æ•°æ®è´Ÿè½½å¤ªé‡: éšç€é€šå¸¸è¶…è¿‡70%çš„XMPPåè®®çš„æœåŠ¡å™¨çš„æ•°æ®æµé‡çš„å­˜åœ¨å’Œè¿‘60%çš„è¢«é‡å¤è½¬å‘,XMPPåè®®ç›®å‰æ‹¥æœ‰ä¸€ä¸ªå¤§å‹æ¶ç©ºä¸­å­˜åœ¨çš„ æ•°æ®æä¾›ç»™å¤šä¸ªæ”¶ä»¶äººã€‚ æ–°çš„è®®å®šä¹¦æ­£åœ¨ç ”ç©¶,ä»¥å‡è½»è¿™ä¸€é—®é¢˜ã€‚ æ²¡æœ‰äºŒè¿›åˆ¶æ•°æ®: XMPPåè®®çš„æ–¹å¼è¢«ç¼–ç ä¸ºä¸€ä¸ªå•ä¸€çš„é•¿çš„XMLæ–‡ä»¶,å› æ­¤æ— æ³•æä¾›ä¿®æ”¹äºŒè¿›åˆ¶æ•°æ®ã€‚ å› æ­¤, æ–‡ä»¶ä¼ è¾“åè®®ä¸€æ ·ä½¿ç”¨å¤–éƒ¨çš„ HTTPã€‚ å¦‚æœä¸å¯é¿å…,XMPPåè®®è¿˜æä¾›äº†å¸¦ç¼–ç çš„æ–‡ä»¶ä¼ è¾“çš„æ‰€æœ‰æ•°æ®ä½¿ç”¨çš„Base64 ã€‚ è‡³äºå…¶ä»–äºŒè¿›åˆ¶æ•°æ®åŠ å¯†ä¼šè¯ (encrypted conversations)æˆ–å›¾å½¢å›¾æ ‡(graphic icons)ä»¥åµŒå…¥å¼ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ã€‚ NSURLConnectionçš„å‡ ä¸ªå¸¸ç”¨çš„ä»£ç†? NSURLConnectionDownloadDelegate :èƒ½å¤Ÿå®ç°ç›‘å¬ä¸‹è½½è¿›åº¦!ä½†æ˜¯ä¸‹è½½ä¹‹å,æ‰¾ä¸åˆ°ä¸‹è½½å¥½çš„æ–‡ä»¶! NSURLConnectionDataDelegate æ˜¯é’ˆå¯¹æ•°æ®ä¸‹è½½æä¾›çš„æ–¹æ³•!éœ€è¦æ³¨æ„çš„æ˜¯,éœ€è¦è‡ªå·±å®ç°ç›‘å¬è¿›åº¦çš„ä¸šåŠ¡é€»è¾‘! åˆ©ç”¨ NSURLConnection çš„å¼‚æ­¥å›è°ƒè¿›è¡Œæ–‡ä»¶ä¸‹è½½: å¦‚æœæ˜¯å°æ–‡ä»¶ä¸‹è½½,é—®é¢˜ä¸å¤§! å¯ä»¥ç›´æ¥ä½¿ç”¨å¼‚æ­¥å›è°ƒè¿›è¡Œä¸‹è½½ å¦‚æœä½¿ç”¨å¼‚æ­¥å›è°ƒçš„æ–¹æ³•è¿›è¡Œå¤§æ–‡ä»¶ä¸‹è½½,åˆ™ä¼šå‡ºç°å†…å­˜æš´æ¶¨çš„æƒ…å†µ! å†…å­˜æš´æ¶¨çš„åŸå› : å¤§æ–‡ä»¶ä¸‹è½½ä¹‹å,é»˜è®¤æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„,æ‰€ä»¥ä¸‹è½½çš„æ–‡ä»¶è¶Šå¤§,è¶Šè€—è´¹å†…å­˜. å­˜åœ¨çš„ç¼ºç‚¹: ä½¿ç”¨å¼‚æ­¥å›è°ƒå®ç°æ–‡ä»¶,æ— æ³•ç›‘å¬ä¸‹è½½è¿›åº¦!å¹¶ä¸”å¯¹äºå¤§æ–‡ä»¶ä¸‹è½½,ä¼šé€ æˆå†…å­˜æš´æ¶¨! åŸºäºä»¥ä¸Šä¸¤ç‚¹,ä¸€èˆ¬,åœ¨è¿›è¡Œæ–‡ä»¶ä¸‹è½½çš„æ—¶å€™,ä½¿ç”¨ä»£ç†å›è°ƒç›‘å¬ä¸‹è½½è¿›åº¦!å¹¶ä¸”åœ¨ä¸‹è½½æ–‡ä»¶çš„æ—¶å€™,æ‰‹åŠ¨ç®¡ç†å†…å­˜! NSURLConnection&amp;NSURLSessionçš„åŒºåˆ«? è™½ç„¶ NSURLConnection åœ¨ iOS 9.0 ä¸­å·²ç»è¢«åºŸå¼ƒï¼Œä½†æ˜¯ä½œä¸ºèµ„æ·±çš„ iOS ç¨‹åºå‘˜ï¼Œå¿…é¡»è¦äº†è§£ NSURLConnection çš„ç»†èŠ‚, NSURLSession: ç”¨äºæ›¿ä»£ NSURLConnection æ”¯æŒåå°è¿è¡Œçš„ç½‘ç»œä»»åŠ¡ æš‚åœã€åœæ­¢ã€é‡å¯ç½‘ç»œä»»åŠ¡ï¼Œä¸å†éœ€è¦ NSOperation å°è£… è¯·æ±‚å¯ä»¥ä½¿ç”¨åŒæ ·çš„é…ç½®å®¹å™¨ ä¸åŒçš„ session å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç§æœ‰å­˜å‚¨ block å’Œä»£ç†å¯ä»¥åŒæ—¶èµ·ä½œç”¨ ç›´æ¥ä»æ–‡ä»¶ç³»ç»Ÿä¸Šä¼ ã€ä¸‹è½½ XMLæ˜¯ä»€ä¹ˆ? XMLä¸HTMLçš„åŒºåˆ«? XMLçš„ç®€å•ä½¿å…¶æ˜“äºåœ¨ä»»ä½•åº”ç”¨ç¨‹åºä¸­è¯»å†™æ•°æ®ï¼Œè¿™ä½¿XMLå¾ˆå¿«æˆä¸ºæ•°æ®äº¤æ¢çš„å”¯ä¸€å…¬å…±è¯­è¨€ï¼Œè™½ç„¶ä¸åŒçš„åº”ç”¨è½¯ä»¶ä¹Ÿæ”¯æŒå…¶å®ƒçš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œä½†ä¸ä¹…ä¹‹åä»–ä»¬éƒ½å°†æ”¯æŒXMLï¼Œé‚£å°±æ„å‘³ç€ç¨‹åºå¯ä»¥æ›´å®¹æ˜“çš„ä¸Windows,Mac OS,Linuxä»¥åŠå…¶ä»–å¹³å°ä¸‹äº§ç”Ÿçš„ä¿¡æ¯ç»“åˆï¼Œç„¶åå¯ä»¥å¾ˆå®¹æ˜“åŠ è½½XMLæ•°æ®åˆ°ç¨‹åºä¸­å¹¶åˆ†æä»–ï¼Œå¹¶ä»¥XMLæ ¼å¼è¾“å‡ºç»“æœã€‚ XMLå»æ‰äº†ä¹‹å‰ä»¤è®¸å¤šå¼€å‘äººå‘˜å¤´ç–¼çš„SGMLï¼ˆæ ‡å‡†é€šç”¨æ ‡è®°è¯­è¨€ï¼‰çš„éšæ„è¯­æ³•ã€‚åœ¨XMLä¸­ï¼Œé‡‡ç”¨äº†å¦‚ä¸‹çš„è¯­æ³•ï¼š ä»»ä½•çš„èµ·å§‹æ ‡ç­¾éƒ½å¿…é¡»æœ‰ä¸€ä¸ªç»“æŸæ ‡ç­¾ã€‚ å¯ä»¥é‡‡ç”¨å¦ä¸€ç§ç®€åŒ–è¯­æ³•ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ ‡ç­¾ä¸­åŒæ—¶è¡¨ç¤ºèµ·å§‹å’Œç»“æŸæ ‡ç­¾ã€‚è¿™ç§è¯­æ³•æ˜¯åœ¨å¤§äºç¬¦å·ä¹‹å‰ç´§è·Ÿä¸€ä¸ªæ–œçº¿ï¼ˆ/ï¼‰ï¼Œä¾‹å¦‚&lt;tag/ &gt;ã€‚XMLè§£æå™¨ä¼šå°†å…¶ç¿»è¯‘æˆã€‚ æ ‡ç­¾å¿…é¡»æŒ‰åˆé€‚çš„é¡ºåºè¿›è¡ŒåµŒå¥—ï¼Œæ‰€ä»¥ç»“æŸæ ‡ç­¾å¿…é¡»æŒ‰é•œåƒé¡ºåºåŒ¹é…èµ·å§‹æ ‡ç­¾ï¼Œä¾‹å¦‚this is asamplestringã€‚è¿™å¥½æ¯”æ˜¯å°†èµ·å§‹å’Œç»“æŸæ ‡ç­¾çœ‹ä½œæ˜¯æ•°å­¦ä¸­çš„å·¦å³æ‹¬å·ï¼šåœ¨æ²¡æœ‰å…³é—­æ‰€æœ‰çš„å†…éƒ¨æ‹¬å·ä¹‹å‰ï¼Œæ˜¯ä¸èƒ½å…³é—­å¤–é¢çš„æ‹¬å·çš„ã€‚ æ‰€æœ‰çš„ç‰¹æ€§éƒ½å¿…é¡»æœ‰å€¼ã€‚ æ‰€æœ‰çš„ç‰¹æ€§éƒ½å¿…é¡»åœ¨å€¼çš„å‘¨å›´åŠ ä¸ŠåŒå¼•å·ã€‚ XMLä¸HTMLçš„è®¾è®¡åŒºåˆ«æ˜¯ï¼šXMLçš„æ ¸å¿ƒæ˜¯æ•°æ®ï¼Œå…¶é‡ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ã€‚è€ŒHTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå…¶é‡ç‚¹æ˜¯æ•°æ®çš„æ˜¾ç¤ºã€‚ XMLå’ŒHTMLè¯­æ³•åŒºåˆ«ï¼šHTMLçš„æ ‡è®°ä¸æ˜¯æ‰€æœ‰çš„éƒ½éœ€è¦æˆå¯¹å‡ºç°ï¼ŒXMLåˆ™è¦æ±‚æ‰€æœ‰çš„æ ‡è®°å¿…é¡»æˆå¯¹å‡ºç°ï¼›HTMLæ ‡è®°ä¸åŒºåˆ†å¤§å°å†™ï¼ŒXMLåˆ™ å¤§å°æ•æ„Ÿ,å³åŒºåˆ†å¤§å°å†™ã€‚ ç½‘ç»œå›¾ç‰‡å¤„ç†é—®é¢˜ä¸­æ€ä¹ˆè§£å†³ä¸€ä¸ªç›¸åŒçš„ç½‘ç»œåœ°å€é‡å¤è¯·æ±‚çš„é—®é¢˜ï¼Ÿåˆ©ç”¨å­—å…¸ï¼ˆå›¾ç‰‡åœ°å€ä¸ºkeyï¼Œä¸‹è½½æ“ä½œä¸ºvalueï¼‰ sipæ˜¯ä»€ä¹ˆï¼Ÿ1&gt; SIPï¼ˆSession Initiation Protocolï¼‰ï¼Œä¼šè¯å‘èµ·åè®® 2&gt; SIPæ˜¯å»ºç«‹VOIPè¿æ¥çš„ IETF æ ‡å‡†ï¼ŒIETFæ˜¯å…¨çƒäº’è”ç½‘æœ€å…·æƒå¨çš„æŠ€æœ¯æ ‡å‡†åŒ–ç»„ç»‡ 3&gt; æ‰€è°“VOIPï¼Œå°±æ˜¯ç½‘ç»œç”µè¯ï¼Œç›´æ¥ç”¨äº’è”ç½‘æ‰“ç”µè¯ï¼Œä¸ç”¨è€—æ‰‹æœºè¯è´¹ TCP/IPå››å±‚æ¨¡å‹ TCP/IPæ˜¯ä¸€ç»„åè®®çš„ä»£åè¯ï¼Œå®ƒè¿˜åŒ…æ‹¬è®¸å¤šåè®®ï¼Œç»„æˆäº†TCP/IPåè®®ç°‡ã€‚TCP/IPåè®®ç°‡åˆ†ä¸ºå››å±‚ï¼ŒIPä½äºåè®®ç°‡çš„ç¬¬äºŒå±‚(å¯¹åº”OSIçš„ç¬¬ä¸‰å±‚)ï¼ŒTCPä½äºåè®®ç°‡çš„ç¬¬ä¸‰å±‚(å¯¹åº”OSIçš„ç¬¬å››å±‚)ã€‚ åº”ç”¨å±‚ï¼šåº”ç”¨ç¨‹åºé—´æ²Ÿé€šçš„å±‚ï¼Œå¦‚ç®€å•ç”µå­é‚®ä»¶ä¼ è¾“ï¼ˆSMTPï¼‰ã€æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆFTPï¼‰ã€ç½‘ç»œè¿œç¨‹è®¿é—®åè®®ï¼ˆTelnetï¼‰ç­‰ã€‚ ä¼ è¾“å±‚ï¼šåœ¨æ­¤å±‚ä¸­ï¼Œå®ƒæä¾›äº†èŠ‚ç‚¹é—´çš„æ•°æ®ä¼ é€æœåŠ¡ï¼Œå¦‚ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTCPï¼‰ã€ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ˆUDPï¼‰ç­‰ï¼ŒTCPå’ŒUDPç»™æ•°æ®åŒ…åŠ å…¥ä¼ è¾“æ•°æ®å¹¶æŠŠå®ƒä¼ è¾“åˆ°ä¸‹ä¸€å±‚ä¸­ï¼Œè¿™ä¸€å±‚è´Ÿè´£ä¼ é€æ•°æ®ï¼Œå¹¶ä¸”ç¡®å®šæ•°æ®å·²è¢«é€è¾¾å¹¶æ¥æ”¶ã€‚ äº’è¿ç½‘ç»œå±‚ï¼šè´Ÿè´£æä¾›åŸºæœ¬çš„æ•°æ®å°åŒ…ä¼ é€åŠŸèƒ½ï¼Œè®©æ¯ä¸€å—æ•°æ®åŒ…éƒ½èƒ½å¤Ÿåˆ°è¾¾ç›®çš„ä¸»æœºï¼ˆä½†ä¸æ£€æŸ¥æ˜¯å¦è¢«æ­£ç¡®æ¥æ”¶ï¼‰ï¼Œå¦‚ç½‘é™…åè®®ï¼ˆIPï¼‰ã€‚ ç½‘ç»œæ¥å£å±‚ï¼šå¯¹å®é™…çš„ç½‘ç»œåª’ä½“çš„ç®¡ç†ï¼Œå®šä¹‰å¦‚ä½•ä½¿ç”¨å®é™…ç½‘ç»œï¼ˆå¦‚Ethernetã€Serial Lineç­‰ï¼‰æ¥ä¼ é€æ•°æ®ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜14--Runloop]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9814-Runloop%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯ Runloopï¼Ÿ ä»å­—é¢ä¸Šè®²å°±æ˜¯è¿è¡Œå¾ªç¯ã€‚ å®ƒå†…éƒ¨å°±æ˜¯do-whileå¾ªç¯ï¼Œåœ¨è¿™ä¸ªå¾ªç¯å†…éƒ¨ä¸æ–­åœ°å¤„ç†å„ç§ä»»åŠ¡ã€‚ ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªRunLoopï¼Œä¸»çº¿ç¨‹çš„RunLoopé»˜è®¤å·²ç»å¯åŠ¨ï¼Œå­çº¿ç¨‹çš„RunLoopå¾—æ‰‹åŠ¨å¯åŠ¨ï¼ˆè°ƒç”¨runæ–¹æ³•ï¼‰ RunLoopåªèƒ½é€‰æ‹©ä¸€ä¸ªModeå¯åŠ¨ï¼Œå¦‚æœå½“å‰Modeä¸­æ²¡æœ‰ä»»ä½•Source(Sources0ã€Sources1)ã€Timerï¼Œé‚£ä¹ˆå°±ç›´æ¥é€€å‡ºRunLoop åŸºæœ¬çš„ä½œç”¨å°±æ˜¯ä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œï¼Œå¤„ç†appä¸­çš„å„ç§äº‹ä»¶ã€‚é€šè¿‡runloopï¼Œæœ‰äº‹è¿è¡Œï¼Œæ²¡äº‹å°±ä¼‘æ¯ï¼Œå¯ä»¥èŠ‚çœcpuèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚ Runloopå¯¹è±¡iOSä¸­æœ‰2å¥—APIæ¥è®¿é—®å’Œä½¿ç”¨RunLoop Foundationï¼šNSRunLoop Core Foundationï¼šCFRunLoopRef NSRunLoopå’ŒCFRunLoopReféƒ½ä»£è¡¨ç€RunLoopå¯¹è±¡ NSRunLoopæ˜¯åŸºäºCFRunLoopRefçš„ä¸€å±‚OCåŒ…è£…ï¼Œæ‰€ä»¥è¦äº†è§£RunLoopå†…éƒ¨ç»“æ„ï¼Œéœ€è¦å¤šç ”ç©¶CFRunLoopRefå±‚é¢çš„APIã€‚ Runloopä¸çº¿ç¨‹ æ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„RunLoopå¯¹è±¡ ä¸»çº¿ç¨‹çš„RunLoopå·²ç»è‡ªåŠ¨åˆ›å»ºå¥½äº†ï¼Œå­çº¿ç¨‹çš„RunLoopéœ€è¦ä¸»åŠ¨åˆ›å»º RunLoopåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯ è·å¾—RunLoopå¯¹è±¡ Foundation [NSRunLoop currentRunLoop]; // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡ [NSRunLoop mainRunLoop]; // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ Core Foundation CFRunLoopGetCurrent(); // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡ CFRunLoopGetMain(); // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ RunLoopç›¸å…³ç±»Core Foundationä¸­å…³äºRunLoopçš„5ä¸ªç±» CFRunLoopRef CFRunLoopModeRef CFRunLoopSourceRef CFRunLoopTimerRef CFRunLoopObserverRef CFRunLoopModeRefCFRunLoopModeRefä»£è¡¨RunLoopçš„è¿è¡Œæ¨¡å¼ã€‚ ä¸€ä¸ªRunLoopåŒ…å«è‹¥å¹²ä¸ªModeï¼Œæ¯ä¸ªModeåˆåŒ…å«è‹¥å¹²ä¸ª(set)Source/(array)Timer/(array)Observer æ¯æ¬¡RunLoopå¯åŠ¨æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Modeï¼Œè¿™ä¸ªModeè¢«ç§°ä½œCurrentMode å¦‚æœéœ€è¦åˆ‡æ¢Modeï¼Œåªèƒ½é€€å‡ºLoopï¼Œå†é‡æ–°æŒ‡å®šä¸€ä¸ªModeè¿›å…¥ è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„Source/Timer/Observerï¼Œè®©å…¶äº’ä¸å½±å“ modeä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šäº‹ä»¶åœ¨è¿è¡Œå¾ªç¯ä¸­çš„ä¼˜å…ˆçº§çš„ï¼Œåˆ†ä¸ºï¼š â€¢ NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰ï¼šé»˜è®¤ï¼Œç©ºé—²çŠ¶æ€ â€¢ UITrackingRunLoopModeï¼šScrollViewæ»‘åŠ¨æ—¶ä¼šåˆ‡æ¢åˆ°è¯¥Mode â€¢ UIInitializationRunLoopModeï¼šrun loopå¯åŠ¨æ—¶ï¼Œä¼šåˆ‡æ¢åˆ°è¯¥mode â€¢ NSRunLoopCommonModesï¼ˆkCFRunLoopCommonModesï¼‰ï¼šModeé›†åˆ è‹¹æœå…¬å¼€æä¾›çš„Modeæœ‰ä¸¤ä¸ªï¼š â€¢ NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰ â€¢ NSRunLoopCommonModesï¼ˆkCFRunLoopCommonModesï¼‰ CFRunLoopTimerRef CFRunLoopTimerRefæ˜¯åŸºäºæ—¶é—´çš„è§¦å‘å™¨ CFRunLoopTimerRefåŸºæœ¬ä¸Šè¯´çš„å°±æ˜¯NSTimerï¼Œå®ƒå—RunLoopçš„Modeå½±å“ GCDçš„å®šæ—¶å™¨ä¸å—RunLoopçš„Modeå½±å“ CFRunLoopSourceRefCFRunLoopSourceRefæ˜¯äº‹ä»¶æºï¼ˆè¾“å…¥æºï¼‰ æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼ŒSourceçš„åˆ†ç±» Port-Based Sources Custom Input Sources Cocoa Perform Selector Sources æŒ‰ç…§å‡½æ•°è°ƒç”¨æ ˆï¼ŒSourceçš„åˆ†ç±» Source0ï¼šéåŸºäºPortçš„ Source1ï¼šåŸºäºPortçš„ï¼Œé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹é€šä¿¡ï¼Œæ¥æ”¶ã€åˆ†å‘ç³»ç»Ÿäº‹ä»¶ CFRunLoopObserverRef CFRunLoopObserverRefæ˜¯è§‚å¯Ÿè€…ï¼Œèƒ½å¤Ÿç›‘å¬RunLoopçš„çŠ¶æ€æ”¹å˜ å¯ä»¥ç›‘å¬çš„æ—¶é—´ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ª kcfRunLoopEntry(å³å°†è¿›å…¥loop)//1 kcfRunLoopBeforeTimers(å³å°†å¤„ç†timer)//2 kcfRunLoopBeforeSources(å³å°†å¤„ç†source)//4 kcfRunLoopBeforeWaiting(å³å°†è¿›å…¥ä¼‘çœ )//32 kcfRunLoopAfterWaiting(åˆšä»ä¼‘çœ ä¸­å”¤é†’)//64 kcfRunLoopExit(å³å°†é€€å‡ºloop)//128 æ·»åŠ Observer CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(), kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) { NSLog(@&quot;----ç›‘å¬åˆ°RunLoopçŠ¶æ€å‘ç”Ÿæ”¹å˜---%zd&quot;, activity); }); // æ·»åŠ è§‚å¯Ÿè€…ï¼šç›‘å¬RunLoopçš„çŠ¶æ€ CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode); // é‡Šæ”¾Observer CFRelease(observer); RunLoopå¤„ç†é€»è¾‘ é€šçŸ¥Observer:å³å°†è¿›å…¥Loopï¼ˆ1ï¼‰ é€šçŸ¥Observerï¼šå°†è¦å¤„ç†Timerï¼ˆ2ï¼‰ é€šçŸ¥Observerï¼šå°†è¦å¤„ç†Source0ï¼ˆ3ï¼‰ å¤„ç†Source0ï¼ˆ4ï¼‰ å¦‚æœæœ‰Source0ï¼Œè·³åˆ°ç¬¬9æ­¥ï¼ˆ5ï¼‰ é€šçŸ¥Observerï¼šçº¿ç¨‹å³å°†ä¼‘çœ ï¼ˆ6ï¼‰ ä¼‘çœ ï¼Œç­‰å¾…å”¤é†’ï¼šï¼ˆ7ï¼‰ Source0(port)ã€‚ timerå¯åŠ¨ RunLoopè®¾ç½®çš„timerå·²ç»è¶…æ—¶ Runloopè¢«å¤–éƒ¨æ‰‹åŠ¨å”¤é†’ é€šçŸ¥Observerï¼šçº¿ç¨‹å°†è¢«å”¤é†’ï¼ˆ8ï¼‰ å¤„ç†æœªå¤„ç†çš„æ—¶é—´ï¼ˆ9ï¼‰ å¦‚æœç”¨æˆ·å®šä¹‰çš„å®šæ—¶å™¨å¯åŠ¨ï¼Œå¤„ç†å®šæ—¶å™¨äº‹ä»¶å¹¶é‡å¯Runloopã€‚è¿›å…¥æ­¥éª¤2. å¦‚æœè¾“å…¥æºå¯åŠ¨ï¼Œä¼ é€’ç›¸åº”çš„æ¶ˆæ¯ã€‚ å¦‚æœRunLoppè¢«æ˜¾å¼å”¤é†’è€Œä¸”æ—¶é—´è¿˜æ²¡è¶…æ—¶ï¼Œé‡å¯RunLoopï¼Œè¿›å…¥æ­¥éª¤2. é€šçŸ¥Observerï¼šå³å°†é€€å‡ºLoop Runloopçš„åº”ç”¨ NSTimer ImageViewæ˜¾ç¤º PerformSelector å¸¸é©»çº¿ç¨‹ è‡ªåŠ¨é‡Šæ”¾æ±  runloopå®šæ—¶æºå’Œè¾“å…¥æº image Runloopå¤„ç†çš„è¾“å…¥äº‹ä»¶æœ‰ä¸¤ç§ä¸åŒçš„æ¥æºï¼šè¾“å…¥æºï¼ˆinput sourceï¼‰å’Œå®šæ—¶æºï¼ˆtimer sourceï¼‰ è¾“å…¥æºä¼ é€’å¼‚æ­¥æ¶ˆæ¯ï¼Œé€šå¸¸æ¥è‡ªäºå…¶ä»–çº¿ç¨‹æˆ–è€…ç¨‹åºã€‚ å®šæ—¶æºåˆ™ä¼ é€’åŒæ­¥æ¶ˆæ¯ï¼Œåœ¨ç‰¹å®šæ—¶é—´æˆ–è€…ä¸€å®šçš„æ—¶é—´é—´éš”å‘ç”Ÿ NSRunLoopçš„å®ç°æœºåˆ¶,åŠåœ¨å¤šçº¿ç¨‹ä¸­å¦‚ä½•ä½¿ç”¨- å®ç°æœºåˆ¶ï¼šå›ç­”runloopçš„åŸºæœ¬ä½œç”¨ï¼Œå¤„ç†é€»è¾‘ï¼Œå‰é¢éƒ½æœ‰ã€‚ - ç¨‹åºåˆ›å»ºå­çº¿ç¨‹çš„æ—¶å€™ï¼Œæ‰éœ€è¦æ‰‹åŠ¨å¯åŠ¨runloopã€‚ä¸»çº¿ç¨‹çš„runloopå·²ç»é»˜è®¤å¯åŠ¨ã€‚ - åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä½ éœ€è¦åˆ¤æ–­æ˜¯å¦éœ€è¦runloopã€‚å¦‚æœéœ€è¦runloopï¼Œé‚£ä¹ˆä½ è¦è´Ÿè´£é…ç½®runloopå¹¶å¯åŠ¨ã€‚ä½ ä¸éœ€è¦åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½å»å¯åŠ¨runloopã€‚æ¯”å¦‚ï¼Œä½ ä½¿ç”¨çº¿ç¨‹å»å¤„ç†ä¸€ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„è€—æ—¶æé•¿çš„ä»»åŠ¡æ—¶ï¼Œä½ å°±å¯ä»¥æ— éœ€å¯åŠ¨runloopã€‚Runloopåªåœ¨ä½ è¦å’Œçº¿ç¨‹æœ‰äº¤äº’æ—¶æ‰éœ€è¦ runloopå’Œçº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ- ä¸»çº¿ç¨‹çš„run loopé»˜è®¤æ˜¯å¯åŠ¨çš„ã€‚ iOSçš„åº”ç”¨ç¨‹åºé‡Œé¢ï¼Œç¨‹åºå¯åŠ¨åä¼šæœ‰ä¸€ä¸ªå¦‚ä¸‹çš„main()å‡½æ•° ( argc, * argv[]) { @autoreleasepool { return UIApplicationMain(argc, argv, , NSStringFromClass([AppDelegate class])); } } é‡ç‚¹æ˜¯UIApplicationMain()å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¸ºmain threadè®¾ç½®ä¸€ä¸ªNSRunLoopå¯¹è±¡ï¼Œè¿™å°±è§£é‡Šäº†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬çš„åº”ç”¨å¯ä»¥åœ¨æ— äººæ“ä½œçš„æ—¶å€™ä¼‘æ¯ï¼Œéœ€è¦è®©å®ƒå¹²æ´»çš„æ—¶å€™åˆèƒ½ç«‹é©¬å“åº”ã€‚ - å¯¹å…¶å®ƒçº¿ç¨‹æ¥è¯´ï¼Œrunloopé»˜è®¤æ˜¯æ²¡æœ‰å¯åŠ¨çš„ï¼Œrunloopåªåœ¨ä½ è¦å’Œçº¿ç¨‹æœ‰äº¤äº’æ—¶æ‰éœ€è¦ã€‚ - åœ¨ä»»ä½•ä¸€ä¸ª Cocoa ç¨‹åºçš„çº¿ç¨‹ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥è·å–åˆ°å½“å‰çº¿ç¨‹çš„ run loop ã€‚ NSRunLoop *runloop = [NSRunLoop currentRunLoop]; autorelease å¯¹è±¡åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«é‡Šæ”¾ï¼Ÿ åˆ†ä¸¤ç§æƒ…å†µï¼šæ‰‹åŠ¨å¹²é¢„é‡Šæ”¾å’Œç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾å°±æ˜¯æŒ‡å®šautoreleasepool,å½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸå°±ç«‹å³é‡Šæ”¾ ç³»ç»Ÿè‡ªåŠ¨å»é‡Šæ”¾:ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepool,Autoreleaseå¯¹è±¡ä¼šåœ¨å½“å‰çš„ runloop è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ kCFRunLoopEntry(1):ç¬¬ä¸€æ¬¡è¿›å…¥ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªautorelease kCFRunLoopBeforeWaiting(32):è¿›å…¥ä¼‘çœ çŠ¶æ€å‰ä¼šè‡ªåŠ¨é”€æ¯ä¸€ä¸ªautorelease,ç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„autorelease kCFRunLoopExit(128):é€€å‡ºrunloopæ—¶ä¼šè‡ªåŠ¨é”€æ¯æœ€åä¸€ä¸ªåˆ›å»ºçš„autorelease å¯¹äºrunloopçš„ç†è§£ä¸æ­£ç¡®çš„æ˜¯A æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰å…¶å¯¹åº”çš„RunLoop B é»˜è®¤éä¸»çº¿ç¨‹çš„RunLoopæ˜¯æ²¡æœ‰è¿è¡Œçš„ C åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ²¡æœ‰å¿…è¦å»å¯ç”¨RunLoop D å¯ä»¥å°†NSTimeræ·»åŠ åˆ°runloopä¸­ å‚è€ƒç­”æ¡ˆï¼šC ç†ç”±ï¼šè¯´åˆ°RunLoopï¼Œå®ƒå¯æ˜¯å¤šçº¿ç¨‹çš„æ³•å®šã€‚é€šå¸¸æ¥è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä»»åŠ¡åå°±ä¼šé€€å‡ºçº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸»çº¿ç¨‹æ˜¯ä¸èƒ½é€€å‡ºçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è®©ä¸»çº¿ç¨‹å³æ—¶ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå¯ä»¥ç»§ç»­ç­‰å¾…æ˜¯æ¥æ”¶äº‹ä»¶è€Œä¸é€€å‡ºï¼Œé‚£ä¹ˆRunLoopå°±æ˜¯å…³é”®æ³•å®äº†ã€‚ä½†æ˜¯éä¸»çº¿ç¨‹é€šå¸¸æ¥è¯´å°±æ˜¯ä¸ºäº†æ‰§è¡ŒæŸä¸€ä»»åŠ¡çš„ï¼Œæ‰§è¡Œå®Œæ¯•å°±éœ€è¦å½’è¿˜èµ„æºï¼Œå› æ­¤é»˜è®¤æ˜¯ä¸è¿è¡ŒRunLoopçš„ã€‚NSRunLoopæä¾›äº†ä¸€ä¸ªæ·»åŠ NSTimerçš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨åº”ç”¨æ­£å¸¸çŠ¶æ€ä¸‹ä¼šå›è°ƒã€‚ runloopçš„modeä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿmodeä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šäº‹ä»¶åœ¨è¿è¡Œå¾ªç¯ä¸­çš„ä¼˜å…ˆçº§çš„ï¼Œåˆ†ä¸ºï¼š â€¢ NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰ï¼šé»˜è®¤ï¼Œç©ºé—²çŠ¶æ€ â€¢ UITrackingRunLoopModeï¼šScrollViewæ»‘åŠ¨æ—¶ä¼šåˆ‡æ¢åˆ°è¯¥Mode â€¢ UIInitializationRunLoopModeï¼šrun loopå¯åŠ¨æ—¶ï¼Œä¼šåˆ‡æ¢åˆ°è¯¥mode â€¢ NSRunLoopCommonModesï¼ˆkCFRunLoopCommonModesï¼‰ï¼šModeé›†åˆ è‹¹æœå…¬å¼€æä¾›çš„Modeæœ‰ä¸¤ä¸ªï¼š â€¢ NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰ â€¢ NSRunLoopCommonModesï¼ˆkCFRunLoopCommonModesï¼‰ å¦‚æœæˆ‘ä»¬æŠŠä¸€ä¸ªNSTimerå¯¹è±¡ä»¥NSDefaultRunLoopModeï¼ˆkCFRunLoopDefaultModeï¼‰æ·»åŠ åˆ°ä¸»è¿è¡Œå¾ªç¯ä¸­çš„æ—¶å€™, ScrollViewæ»šåŠ¨è¿‡ç¨‹ä¸­ä¼šå› ä¸ºmodeçš„åˆ‡æ¢ï¼Œè€Œå¯¼è‡´NSTimerå°†ä¸å†è¢«è°ƒåº¦ã€‚å½“æˆ‘ä»¬æ»šåŠ¨çš„æ—¶å€™ï¼Œä¹Ÿå¸Œæœ›ä¸è°ƒåº¦ï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨é»˜è®¤æ¨¡å¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¸Œæœ›åœ¨æ»šåŠ¨æ—¶ï¼Œå®šæ—¶å™¨ä¹Ÿè¦å›è°ƒï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨common modeã€‚ è¯·å†™å‡ºNSTimerä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹ï¼ˆä¸¤é¡¹å³å¯ï¼‰æ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œå¦‚æœæƒ³è¦é”€æ¯timerï¼Œåˆ™å¿…é¡»å…ˆå°†timerç½®ä¸ºå¤±æ•ˆï¼Œå¦åˆ™timerå°±ä¸€ç›´å ç”¨å†…å­˜è€Œä¸ä¼šé‡Šæ”¾ã€‚é€ æˆé€»è¾‘ä¸Šçš„å†…å­˜æ³„æ¼ã€‚è¯¥æ³„æ¼ä¸èƒ½ç”¨xcodeåŠinstrumentsæµ‹å‡ºæ¥ã€‚ å¦å¤–å¯¹äºè¦æ±‚å¿…é¡»é”€æ¯timerçš„é€»è¾‘å¤„ç†ï¼Œæœªå°†timerç½®ä¸ºå¤±æ•ˆï¼Œè‹¥æ¯æ¬¡éƒ½åˆ›å»ºä¸€æ¬¡ï¼Œåˆ™ä¹‹å‰çš„ä¸èƒ½å¾—åˆ°é‡Šæ”¾ï¼Œåˆ™ä¼šåŒæ—¶å­˜åœ¨å¤šä¸ªtimerçš„å®ä¾‹åœ¨å†…å­˜ä¸­ã€‚ å‚è€ƒç­”æ¡ˆï¼š â€¢ æ³¨æ„timeræ·»åŠ åˆ°runloopæ—¶åº”è¯¥è®¾ç½®ä¸ºä»€ä¹ˆmode â€¢ æ³¨æ„timeråœ¨ä¸éœ€è¦æ—¶ï¼Œä¸€å®šè¦è°ƒç”¨invalidateæ–¹æ³•ä½¿å®šæ—¶å™¨å¤±æ•ˆï¼Œå¦åˆ™å¾—ä¸åˆ°é‡Šæ”¾ UITableViewCellä¸Šæœ‰ä¸ªUILabelï¼Œæ˜¾ç¤ºNSTimerå®ç°çš„ç§’è¡¨æ—¶é—´ï¼Œæ‰‹æŒ‡æ»šåŠ¨cellè¿‡ç¨‹ä¸­ï¼Œlabelæ˜¯å¦åˆ·æ–°ï¼Œä¸ºä»€ä¹ˆï¼Ÿå’Œä¸Šä¸€é¢˜ä¸€æ ·çš„æ€è·¯ï¼Œå¦‚æœè¦cellæ»šåŠ¨è¿‡ç¨‹ä¸­å®šæ—¶å™¨æ­£å¸¸å›è°ƒï¼ŒUIæ­£å¸¸åˆ·æ–°ï¼Œé‚£ä¹ˆè¦å°†timeræ”¾å…¥åˆ°CommonModesä¸‹ï¼Œå› ä¸ºæ˜¯NSDefaultRunLoopModeï¼Œåªæœ‰åœ¨ç©ºé—²çŠ¶æ€ä¸‹æ‰ä¼šå›è°ƒã€‚ ä¸ºä»€ä¹ˆ UIScrollView çš„æ»šåŠ¨ä¼šå¯¼è‡´ NSTimer å¤±æ•ˆï¼Ÿ æ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œè§£å†³åŠæ³•æœ‰2ä¸ª,ä¸€ä¸ªæ˜¯æ›´æ”¹modeä¸ºNSRunLoopCommonModes(æ— è®ºrunloopè¿è¡Œåœ¨å“ªä¸ªmode,éƒ½èƒ½è¿è¡Œ),è¿˜æœ‰ç§åŠæ³•æ˜¯åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹æ¥æ›´æ–°UIç•Œé¢çš„åˆ·æ–° //å°†timeræ·»åŠ åˆ°NSDefaultRunLoopModeä¸­ [NSTimer scheduledTimerWithTimeInterval: target: selector:@selector(timerTick:) userInfo: repeats:]; //ç„¶åå†æ·»åŠ åˆ°NSRunLoopCommonModesé‡Œ NSTimer *timer = [NSTimer timerWithTimeInterval: target: selector:@selector(timerTick:) userInfo: repeats:]; [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; åœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚å®šå›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ æ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ · åœ¨å¼€å‘ä¸­å¦‚ä½•ä½¿ç”¨RunLoopï¼Ÿä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ å¼€å¯ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼ˆè®©ä¸€ä¸ªå­çº¿ç¨‹ä¸è¿›å…¥æ¶ˆäº¡çŠ¶æ€ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å‘æ¥æ¶ˆæ¯ï¼Œå¤„ç†å…¶ä»–äº‹ä»¶ï¼‰ åœ¨å­çº¿ç¨‹ä¸­å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œä¸€äº›é•¿æœŸç›‘æ§ å¯ä»¥æ§åˆ¶å®šæ—¶å™¨åœ¨ç‰¹å®šæ¨¡å¼ä¸‹æ‰§è¡Œ å¯ä»¥è®©æŸäº›äº‹ä»¶ï¼ˆè¡Œä¸ºã€ä»»åŠ¡ï¼‰åœ¨ç‰¹å®šæ¨¡å¼ä¸‹æ‰§è¡Œ å¯ä»¥æ·»åŠ Observerç›‘å¬RunLoopçš„çŠ¶æ€ï¼Œæ¯”å¦‚ç›‘å¬ç‚¹å‡»äº‹ä»¶çš„å¤„ç†ï¼ˆåœ¨æ‰€æœ‰ç‚¹å‡»äº‹ä»¶ä¹‹å‰åšä¸€äº›äº‹æƒ…ï¼‰]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜13--æ•°æ®å­˜å‚¨]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9813-%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%2F</url>
    <content type="text"><![CDATA[sqliteä¸­æ’å…¥ç‰¹æ®Šå­—ç¬¦çš„æ–¹æ³•å’Œæ¥æ”¶åˆ°å¤„ç†æ–¹æ³•ã€‚é™¤â€™å…¶ä»–çš„éƒ½æ˜¯åœ¨ç‰¹æ®Šå­—ç¬¦å‰é¢åŠ â€œ/â€ï¼Œè€Œ â€˜ -&gt; â€˜â€™ ã€‚æ–¹æ³•ï¼škeyWord = keyWord.replace(â€œ/â€œ,â€//â€œ); ä»€ä¹ˆæ˜¯NSManagedObjectæ¨¡å‹ï¼ŸNSManagedObjcetæ˜¯NSObjectçš„å­ç±»ï¼ŒCore Dateçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æ˜¯ä¸€ä¸ªé€šç”¨ç±»ï¼Œå®ç°äº†Core Dateæ¨¡å‹å±‚æ‰€éœ€çš„åŸºæœ¬åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡NSManagedObjcetå»ºç«‹è‡ªå·±çš„æ•°æ®æ¨¡å‹ã€‚ ä½ å®ç°è¿‡å¤šçº¿ç¨‹çš„Core Dataä¹ˆï¼ŸNSPersistentStoreCoordinatorï¼ŒNSManagedObjectContextå’ŒNSManagedObjectä¸­çš„å“ªäº›éœ€è¦åœ¨çº¿ç¨‹ä¸­åˆ›å»ºæˆ–è€…ä¼ é€’ï¼Ÿä½ æ˜¯ç”¨ä»€ä¹ˆæ ·çš„ç­–ç•¥æ¥å®ç°çš„ï¼Ÿ1&gt; CoreDataæ˜¯å¯¹SQLiteæ•°æ®åº“çš„å°è£… 2&gt; coreDataä¸­æœ‰ä¸‰ä¸ªå¯¹è±¡æ˜¯å¿…é¡»æŒæ¡çš„, NSManagedObject :åªè¦å®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿äºè¯¥ç±»å°±ä¼šåˆ›å»ºä¸€å¼ ä¸ä¹‹å¯¹åº”çš„è¡¨, ä¹Ÿå°±æ˜¯ä¸€ä¸ªç»§æ‰¿äºè¯¥ç±»çš„ç±»å°±å¯¹åº”ä¸€å¼ è¡¨. æ¯ä¸€ä¸ªé€šè¿‡ç»§æ‰¿è¯¥ç±»åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡,éƒ½æ˜¯è¯¥ç±»å¯¹åº”çš„è¡¨ä¸­çš„ä¸€æ¡æ•°æ® NSManagedObjectContext: ç”¨äºæ“ä½œæ•°æ®åº“, åªè¦æœ‰ç±»å®ƒå°±èƒ½å¯¹æ•°æ®åº“çš„è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥ NSPersistentStoreCoordinator: å†³å®šæ•°æ®å­˜å‚¨çš„ä½ç½® (SQLite/XML/å…¶å®ƒæ–‡ä»¶ä¸­) 3&gt; Core dataæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„æ¶æ„æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸­å®ç°Core dataä¼šæœ‰é—®é¢˜.é—®é¢˜åœ¨äº &gt;2.1 CoreDataä¸­çš„NSManagedObjectContextåœ¨å¤šçº¿ç¨‹ä¸­ä¸å®‰å…¨ &gt;2.2å¦‚æœæƒ³è¦å¤šçº¿ç¨‹è®¿é—®CoreDataçš„è¯ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªNSManagedObjectContext &gt;2.3æ¯ä¸ªNSManagedObjectContextå¯¹è±¡å®ä¾‹éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªNSPersistentStoreCoordinatorå®ä¾‹ï¼Œè¿™æ˜¯å› ä¸ºNSManagedObjectContextä¼šåœ¨ä¾¿ç”¨NSPersistentStoreCoordinatorå‰ä¸Šé” ç®€å•æè¿°ä¸‹å®¢æˆ·ç«¯çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ ç¼“å­˜å¯ä»¥åˆ†ä¸ºï¼šå†…å­˜æ•°æ®ç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ã€æ–‡ä»¶ç¼“å­˜ æ¯æ¬¡æƒ³è·å–æ•°æ®çš„æ—¶å€™ å…ˆæ£€æµ‹å†…å­˜ä¸­æœ‰æ— ç¼“å­˜ å†æ£€æµ‹æœ¬åœ°æœ‰æ— ç¼“å­˜(æ•°æ®åº“\æ–‡ä»¶) æœ€ç»ˆå‘é€ç½‘ç»œè¯·æ±‚ å°†æœåŠ¡å™¨è¿”å›çš„ç½‘ç»œæ•°æ®è¿›è¡Œç¼“å­˜ï¼ˆå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶ï¼‰ï¼Œ ä»¥ä¾¿ä¸‹æ¬¡è¯»å– ä»€ä¹ˆæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç”¨æ¥åšä»€ä¹ˆ åºåˆ—åŒ–æŠŠå¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚åºåˆ—çš„è¿‡ç¨‹ ååºåˆ—åŒ–æŠŠç›´æ¥åºåˆ—æ¢å¤æˆå¯¹è±¡ æŠŠå¯¹è±¡å†™åˆ°æ–‡ä»¶æˆ–è€…æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”è¯»å–å‡ºæ¥ OCä¸­å®ç°å¤æ‚å¯¹è±¡çš„å­˜å‚¨ éµå¾ªNSCodingåè®®ï¼Œå®ç°å¤æ‚å¯¹è±¡çš„å­˜å‚¨ï¼Œå®ç°è¯¥åè®®åå¯ä»¥å¯¹å…¶è¿›è¡Œæ‰“åŒ…æˆ–è€…è§£åŒ…ï¼Œè½¬åŒ–ä¸ºNSDate iOSä¸­å¸¸ç”¨çš„æ•°æ®å­˜å‚¨æ–¹å¼æœ‰å“ªäº›ï¼Ÿ æ•°æ®å­˜å‚¨æœ‰å››ç§æ–¹æ¡ˆï¼ŒNSUserDefault,KeyChain,File,DB. å…¶ä¸­Fileæœ‰ä¸‰ç§æ–¹å¼ï¼šplist,Archiver,Stream DBåŒ…æ‹¬core Dataå’ŒFMDB è¯´ä¸€è¯´ä½ å¯¹SQLiteçš„è®¤è¯† SQLiteæ˜¯ç›®å‰ä¸»æµçš„åµŒå…¥å¼å…³ç³»å‹æ•°æ®åº“ï¼Œå…¶æœ€ä¸»è¦çš„ç‰¹ç‚¹å°±æ˜¯è½»é‡çº§ã€è·¨å¹³å°ï¼Œå½“å‰å¾ˆå¤šåµŒå…¥å¼æ“ä½œç³»ç»Ÿéƒ½å°†å…¶ä½œä¸ºæ•°æ®åº“é¦–é€‰ã€‚ è™½ç„¶SQLiteæ˜¯ä¸€æ¬¾è½»å‹æ•°æ®åº“ï¼Œä½†æ˜¯å…¶åŠŸèƒ½ä¹Ÿç»ä¸äºšäºå¾ˆå¤šå¤§å‹å…³ç³»æ•°æ®åº“ã€‚ å­¦ä¹ æ•°æ®åº“å°±è¦å­¦ä¹ å…¶ç›¸å…³çš„å®šä¹‰ã€æ“ä½œã€æŸ¥è¯¢è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶æ—¥å¸¸è¯´å¾—SQLè¯­å¥ã€‚å’Œå…¶ä»–æ•°æ®åº“ç›¸æ¯”ï¼ŒSQLiteä¸­çš„SQLè¯­æ³•å¹¶æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ï¼Œå› æ­¤è¿™é‡Œå¯¹äºSQLè¯­å¥çš„å†…å®¹ä¸ä¼šè¿‡å¤šèµ˜è¿°ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒSQLiteä¸­å…¶ä»–SQLç›¸å…³çš„å†…å®¹ï¼Œè¿™é‡Œè¿˜æ˜¯é‡ç‚¹è®²è§£iOSä¸­å¦‚ä½•ä½¿ç”¨SQLiteæ„å»ºåº”ç”¨ç¨‹åºã€‚å…ˆçœ‹ä¸€ä¸‹SQLiteæ•°æ®åº“çš„å‡ ä¸ªç‰¹ç‚¹ï¼š åŸºäºCè¯­è¨€å¼€å‘çš„è½»å‹æ•°æ®åº“ åœ¨iOSä¸­éœ€è¦ä½¿ç”¨Cè¯­è¨€è¯­æ³•è¿›è¡Œæ•°æ®åº“æ“ä½œã€è®¿é—®ï¼ˆæ— æ³•ä½¿ç”¨ObjCç›´æ¥è®¿é—®ï¼Œå› ä¸ºlibqlite3æ¡†æ¶åŸºäºCè¯­è¨€ç¼–å†™ï¼‰ SQLiteä¸­é‡‡ç”¨çš„æ˜¯åŠ¨æ€æ•°æ®ç±»å‹ï¼Œå³ä½¿åˆ›å»ºæ—¶å®šä¹‰äº†ä¸€ç§ç±»å‹ï¼Œåœ¨å®é™…æ“ä½œæ—¶ä¹Ÿå¯ä»¥å­˜å‚¨å…¶ä»–ç±»å‹ï¼Œä½†æ˜¯æ¨èå»ºåº“æ—¶ä½¿ç”¨åˆé€‚çš„ç±»å‹ï¼ˆç‰¹åˆ«æ˜¯åº”ç”¨éœ€è¦è€ƒè™‘è·¨å¹³å°çš„æƒ…å†µæ—¶ï¼‰ å»ºç«‹è¿æ¥åé€šå¸¸ä¸éœ€è¦å…³é—­è¿æ¥ï¼ˆå°½ç®¡å¯ä»¥æ‰‹åŠ¨å…³é—­ï¼‰ åœ¨iOSä¸­æ“ä½œSQLiteæ•°æ®åº“å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼ˆæ³¨æ„å…ˆåœ¨é¡¹ç›®ä¸­å¯¼å…¥libsqlite3æ¡†æ¶ï¼‰ï¼š æ‰“å¼€æ•°æ®åº“ï¼Œåˆ©ç”¨sqlite3_open()æ‰“å¼€æ•°æ®åº“ä¼šæŒ‡å®šä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€ï¼Œå¦åˆ™åˆ›å»ºå¹¶æ‰“å¼€ã€‚æ‰“å¼€æ•°æ®åº“ä¼šå¾—åˆ°ä¸€ä¸ªsqlite3ç±»å‹çš„å¯¹è±¡ï¼Œåé¢éœ€è¦å€ŸåŠ©è¿™ä¸ªå¯¹è±¡è¿›è¡Œå…¶ä»–æ“ä½œã€‚ æ‰§è¡ŒSQLè¯­å¥ï¼Œæ‰§è¡ŒSQLè¯­å¥åˆåŒ…æ‹¬æœ‰è¿”å›å€¼çš„è¯­å¥å’Œæ— è¿”å›å€¼è¯­å¥ã€‚ å¯¹äºæ— è¿”å›å€¼çš„è¯­å¥ï¼ˆå¦‚å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰ï¼‰ç›´æ¥é€šè¿‡sqlite3_exec()å‡½æ•°æ‰§è¡Œï¼› å¯¹äºæœ‰è¿”å›å€¼çš„è¯­å¥åˆ™é¦–å…ˆé€šè¿‡sqlite3_prepare_v2()è¿›è¡Œsqlè¯­å¥è¯„ä¼°ï¼ˆè¯­æ³•æ£€æµ‹ï¼‰ï¼Œç„¶åé€šè¿‡sqlite3_step()ä¾æ¬¡å–å‡ºæŸ¥è¯¢ç»“æœçš„æ¯ä¸€è¡Œæ•°æ®ï¼Œå¯¹äºæ¯è¡Œæ•°æ®éƒ½å¯ä»¥é€šè¿‡å¯¹åº”çš„sqlite3_column_ç±»å‹()æ–¹æ³•è·å¾—å¯¹åº”åˆ—çš„æ•°æ®ï¼Œå¦‚æ­¤åå¤å¾ªç¯ç›´åˆ°éå†å®Œæˆã€‚å½“ç„¶ï¼Œæœ€åéœ€è¦é‡Šæ”¾å¥æŸ„ã€‚ è¯´ä¸€è¯´ä½ å¯¹FMDBçš„è®¤è¯† FMDBæ˜¯ä¸€ä¸ªå¤„ç†æ•°æ®å­˜å‚¨çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Œæ¡†æ¶æ˜¯å¯¹sqliteçš„å°è£…ï¼Œæ•´ä¸ªæ¡†æ¶éå¸¸è½»é‡çº§ä½†åˆä¸å¤±çµæ´»æ€§ï¼Œè€Œä¸”æ›´åŠ é¢å‘å¯¹è±¡ã€‚FMDBæœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š FMDBæ—¢ç„¶æ˜¯å¯¹äºlibsqlite3æ¡†æ¶çš„å°è£…ï¼Œè‡ªç„¶ä½¿ç”¨èµ·æ¥ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œä½¿ç”¨å‰ä¹Ÿè¦æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªæ•°æ®åº“æ–‡ä»¶å­˜åœ¨åˆ™ç›´æ¥æ‰“å¼€å¦åˆ™ä¼šåˆ›å»ºå¹¶æ‰“å¼€ã€‚è¿™é‡ŒFMDBå¼•å…¥äº†ä¸€ä¸ªMFDatabaseå¯¹è±¡æ¥è¡¨ç¤ºæ•°æ®åº“ï¼Œæ‰“å¼€æ•°æ®åº“å’Œåé¢çš„æ•°æ®åº“æ“ä½œå…¨éƒ¨ä¾èµ–æ­¤å¯¹è±¡ã€‚ å¯¹äºæ•°æ®åº“çš„æ“ä½œè·Ÿå‰é¢KCDbManagerçš„å°è£…æ˜¯ç±»ä¼¼çš„ï¼Œåœ¨FMDBä¸­FMDatabaseç±»æä¾›äº†ä¸¤ä¸ªæ–¹æ³•executeUpdate:å’ŒexecuteQuery:åˆ†åˆ«ç”¨äºæ‰§è¡Œæ— è¿”å›ç»“æœçš„æŸ¥è¯¢å’Œæœ‰è¿”å›ç»“æœçš„æŸ¥è¯¢ã€‚å½“ç„¶è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰å¾ˆå¤šçš„é‡è½½è¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šäº†ã€‚å”¯ä¸€éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œå¦‚æœè°ƒç”¨æœ‰æ ¼å¼åŒ–å‚æ•°çš„sqlè¯­å¥æ—¶ï¼Œæ ¼å¼åŒ–ç¬¦å·ä½¿ç”¨â€œ?â€è€Œä¸æ˜¯â€œ%@â€ã€ç­‰ã€‚ æˆ‘ä»¬çŸ¥é“ç›´æ¥ä½¿ç”¨libsqlite3è¿›è¡Œæ•°æ®åº“æ“ä½œå…¶å®æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¦‚æœé‡åˆ°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªè¡¨çš„æ—¶å€™å¯èƒ½ä¼šå‘ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å»ºè®®åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨FMDatabaseQueueå¯¹è±¡ï¼Œç›¸æ¯”FMDatabaseè€Œè¨€ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å°†äº‹åŠ¡æ”¾åˆ°FMDBä¸­å»è¯´å¹¶ä¸æ˜¯å› ä¸ºåªæœ‰FMDBæ‰æ”¯æŒäº‹åŠ¡ï¼Œè€Œæ˜¯å› ä¸ºFMDBå°†å…¶å°è£…æˆäº†å‡ ä¸ªæ–¹æ³•æ¥è°ƒç”¨ï¼Œä¸ç”¨è‡ªå·±å†™å¯¹åº”çš„sqlè€Œå·²ã€‚å…¶å®åœ¨åœ¨ä½¿ç”¨libsqlite3æ“ä½œæ•°æ®åº“æ—¶ä¹Ÿæ˜¯åŸç”Ÿæ”¯æŒäº‹åŠ¡çš„ï¼ˆå› ä¸ºè¿™é‡Œçš„äº‹åŠ¡æ˜¯åŸºäºæ•°æ®åº“çš„ï¼ŒFMDBè¿˜æ˜¯ä½¿ç”¨çš„SQLiteæ•°æ®åº“ï¼‰ï¼Œåªè¦åœ¨æ‰§è¡Œsqlè¯­å¥å‰åŠ ä¸Šâ€œbegin transaction;â€æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œâ€œcommit transaction;â€æˆ–è€…â€œrollback transaction;â€è¿›è¡Œæäº¤æˆ–å›æ»šå³å¯ã€‚å¦å¤–åœ¨Core Dataä¸­å¤§å®¶ä¹Ÿå¯ä»¥å‘ç°ï¼Œæ‰€æœ‰çš„å¢ã€åˆ ã€æ”¹æ“ä½œä¹‹åå¿…é¡»è°ƒç”¨ä¸Šä¸‹æ–‡çš„ä¿å­˜æ–¹æ³•ï¼Œå…¶å®æœ¬èº«å°±æä¾›äº†äº‹åŠ¡çš„æ”¯æŒï¼Œåªè¦ä¸è°ƒç”¨ä¿å­˜æ–¹æ³•ï¼Œä¹‹å‰æ‰€æœ‰çš„æ“ä½œæ˜¯ä¸ä¼šæäº¤çš„ã€‚åœ¨FMDBä¸­FMDatabaseæœ‰beginTransactionã€commitã€rollbackä¸‰ä¸ªæ–¹æ³•è¿›è¡Œå¼€å¯äº‹åŠ¡ã€æäº¤äº‹åŠ¡å’Œå›æ»šäº‹åŠ¡ã€‚ è¯´ä¸€è¯´ä½ å¯¹Core Dataçš„è®¤è¯†Core Dataä½¿ç”¨èµ·æ¥ç›¸å¯¹ç›´æ¥ä½¿ç”¨SQLite3çš„APIè€Œè¨€æ›´åŠ çš„é¢å‘å¯¹è±¡ï¼Œæ“ä½œè¿‡ç¨‹é€šå¸¸åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆ›å»ºç®¡ç†ä¸Šä¸‹æ–‡ åˆ›å»ºç®¡ç†ä¸Šä¸‹å¯ä»¥ç»†åˆ†ä¸ºï¼šåŠ è½½æ¨¡å‹æ–‡ä»¶-&gt;æŒ‡å®šæ•°æ®å­˜å‚¨è·¯å¾„-&gt;åˆ›å»ºå¯¹åº”æ•°æ®ç±»å‹çš„å­˜å‚¨-&gt;åˆ›å»ºç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–¹å¹¶æŒ‡å®šå­˜å‚¨ã€‚ ç»è¿‡è¿™å‡ ä¸ªæ­¥éª¤ä¹‹åå¯ä»¥å¾—åˆ°ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡NSManagedObjectContextï¼Œä»¥åæ‰€æœ‰çš„æ•°æ®æ“ä½œéƒ½ç”±æ­¤å¯¹è±¡è´Ÿè´£ã€‚åŒæ—¶å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºä¸Šä¸‹æ–‡ï¼ŒCore Dataä¼šè‡ªåŠ¨åˆ›å»ºå­˜å‚¨æ–‡ä»¶ï¼ˆä¾‹å¦‚è¿™é‡Œä½¿ç”¨SQLite3å­˜å‚¨ï¼‰ï¼Œå¹¶ä¸”æ ¹æ®æ¨¡å‹å¯¹è±¡åˆ›å»ºå¯¹åº”çš„è¡¨ç»“æ„ã€‚ æŸ¥è¯¢æ•°æ® å¯¹äºæœ‰æ¡ä»¶çš„æŸ¥è¯¢ï¼Œåœ¨Core Dataä¸­æ˜¯é€šè¿‡è°“è¯æ¥å®ç°çš„ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œç„¶åè®¾ç½®è¯·æ±‚æ¡ä»¶ï¼Œæœ€åè°ƒç”¨ä¸Šä¸‹æ–‡æ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•ã€‚ æ’å…¥æ•°æ® æ’å…¥æ•°æ®éœ€è¦è°ƒç”¨å®ä½“æè¿°å¯¹è±¡NSEntityDescriptionè¿”å›ä¸€ä¸ªå®ä½“å¯¹è±¡ï¼Œç„¶åè®¾ç½®å¯¹è±¡å±æ€§ï¼Œæœ€åä¿å­˜å½“å‰ä¸Šä¸‹æ–‡å³å¯ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¢ã€åˆ ã€æ”¹æ“ä½œå®Œæœ€åå¿…é¡»è°ƒç”¨ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„ä¿å­˜æ–¹æ³•ï¼Œå¦åˆ™æ“ä½œä¸ä¼šæ‰§è¡Œã€‚ åˆ é™¤æ•°æ® åˆ é™¤æ•°æ®å¯ä»¥ç›´æ¥è°ƒç”¨ç®¡ç†å¯¹è±¡ä¸Šä¸‹æ–‡çš„deleteObjectæ–¹æ³•ï¼Œåˆ é™¤å®Œä¿å­˜ä¸Šä¸‹æ–‡å³å¯ã€‚æ³¨æ„ï¼Œåˆ é™¤æ•°æ®å‰å¿…é¡»å…ˆæŸ¥è¯¢åˆ°å¯¹åº”å¯¹è±¡ã€‚ ä¿®æ”¹æ•°æ® ä¿®æ”¹æ•°æ®é¦–å…ˆä¹Ÿæ˜¯å–å‡ºå¯¹åº”çš„å®ä½“å¯¹è±¡ï¼Œç„¶åé€šè¿‡ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œæœ€åä¿å­˜ä¸Šä¸‹æ–‡ã€‚ OCä¸­æœ‰å“ªäº›æ•°æ®å­˜å‚¨æ–¹å¼,å„æœ‰ä»€ä¹ˆåŒºåˆ«? OCä¸­æœ‰å››ç§æ•°æ®å­˜å‚¨æ–¹å¼: NSUserDefaults,ç”¨äºå­˜å‚¨é…ç½®ä¿¡æ¯ SQLite,ç”¨äºå­˜å‚¨æŸ¥è¯¢éœ€æ±‚è¾ƒå¤šçš„æ•°æ® CoreData,ç”¨äºè§„åˆ’åº”ç”¨ä¸­çš„å¯¹è±¡ ä½¿ç”¨åŸºæœ¬å¯¹è±¡ç±»å‹å®šåˆ¶çš„ä¸ªæ€§åŒ–ç¼“å­˜æ–¹æ¡ˆ. NSUserDefaults:å¯¹è±¡ä¸­å‚¨å­˜äº†ç³»ç»Ÿä¸­ç”¨æˆ·çš„é…ç½®ä¿¡æ¯,å¼€å‘è€…å¯ä»¥é€šè¿‡è¿™ä¸ªå®ä¾‹å¯¹è±¡å¯¹è¿™äº›å·²æœ‰çš„ä¿¡æ¯è¿›è¡Œä¿®æ”¹,ä¹Ÿ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚åˆ›å»ºæ–°çš„é…ç½®é¡¹ã€‚ SQLiteæ“…é•¿å¤„ç†çš„æ•°æ®ç±»å‹å…¶å®ä¸NSUserDefaultså·®ä¸å¤š,ä¹Ÿæ˜¯åŸºç¡€ç±»å‹çš„å°æ•°æ®,åªæ˜¯ä»ç»„ç»‡å½¢å¼ä¸Šä¸åŒã€‚å¼€å‘è€…å¯ä»¥ä»¥å…³ç³»å‹æ•°æ®åº“çš„æ–¹å¼ç»„ç»‡æ•°æ®,ä½¿ç”¨SQL DMLæ¥ç®¡ç†æ•°æ®ã€‚ä¸€èˆ¬æ¥è¯´åº”ç”¨ä¸­çš„æ ¼å¼åŒ–çš„æ–‡æœ¬ç±»æ•°æ®å¯ä»¥å­˜æ”¾åœ¨æ•°æ®åº“ ä¸­,å°¤å…¶æ˜¯ç±»ä¼¼èŠå¤©è®°å½•ã€Timelineç­‰è¿™äº›å…·æœ‰æ¡ä»¶æŸ¥è¯¢å’Œæ’åºéœ€æ±‚çš„æ•°æ®ã€‚ CoreDataæ˜¯ä¸€ä¸ªç®¡ç†æ–¹æ¡ˆ,å®ƒçš„æŒä¹…åŒ–å¯ä»¥é€šè¿‡SQLiteã€XMLæˆ–äºŒè¿›åˆ¶æ–‡ä»¶å‚¨å­˜ã€‚å®ƒå¯ä»¥æŠŠæ•´ä¸ªåº”ç”¨ä¸­çš„å¯¹è±¡å»ºæ¨¡å¹¶è¿›è¡Œè‡ªåŠ¨åŒ–çš„ç®¡ç†ã€‚ä»å½’æ¡£æ–‡ä»¶è¿˜åŸæ¨¡å‹æ—¶CoreDataå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§æŠŠæ•´ä¸ªæ¨¡å‹ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è½½å…¥å†…å­˜,è€Œæ˜¯æ ¹æ®è¿è¡Œæ—¶çŠ¶æ€,æŠŠè¢«è°ƒç”¨åˆ°çš„å¯¹è±¡å®ä¾‹è½½å…¥å†…å­˜ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨æ§åˆ¶è¿™ä¸ªè¿‡ç¨‹,ä»è€Œè¾¾åˆ°æ§åˆ¶å†…å­˜æ¶ˆè€—,é¿å…æµªè´¹ã€‚ æ— è®ºä»è®¾è®¡åŸç†è¿˜æ˜¯ä½¿ç”¨æ–¹æ³•ä¸Šçœ‹,CoreDataéƒ½æ¯”è¾ƒå¤æ‚ã€‚å› æ­¤,å¦‚æœä»…ä»…æ˜¯è€ƒè™‘ç¼“å­˜æ•°æ®è¿™ä¸ªéœ€æ±‚,CoreDataç»å¯¹ä¸æ˜¯ä¸€ä¸ªä¼˜é€‰æ–¹æ¡ˆã€‚ CoreDataçš„ä½¿ç”¨åœºæ™¯åœ¨äº:æ•´ä¸ªåº”ç”¨ä½¿ç”¨CoreDataè§„åˆ’,æŠŠåº”ç”¨å†…çš„æ•°æ®é€šè¿‡CoreDataå»ºæ¨¡,å®Œå…¨åŸºäºCoreDataæ¶æ„åº”ç”¨ã€‚ ä½¿ç”¨åŸºæœ¬å¯¹è±¡ç±»å‹å®šåˆ¶çš„ä¸ªæ€§åŒ–ç¼“å­˜æ–¹æ¡ˆ:ä»éœ€æ±‚å‡ºå‘åˆ†æç¼“å­˜æ•°æ®æœ‰å“ªäº›è¦æ±‚:æŒ‰KeyæŸ¥æ‰¾,å¿«é€Ÿè¯»å–,å†™å…¥ä¸å½±å“æ­£å¸¸æ“ä½œ,ä¸æµªè´¹å†…å­˜,æ”¯æŒå½’æ¡£ã€‚è¿™äº›éƒ½æ˜¯åŸºæœ¬éœ€æ±‚,é‚£ä¹ˆå†è¿›ä¸€æ­¥æˆ–è®¸è¿˜éœ€è¦å›ºå®šç¼“å­˜é¡¹æ•°é‡,æ”¯æŒé˜Ÿåˆ—ç¼“å­˜,ç¼“å­˜è¿‡æœŸç­‰ã€‚ æ•°æ®å­˜å‚¨è¿™ä¸€å—, é¢è¯•å¸¸é—®, ä½ å¸¸ç”¨å“ªä¸€ç§æ•°æ®å­˜å‚¨? ä»€ä¹ˆæ˜¯åºåˆ—åŒ–? sqliteæ˜¯ç›´æ¥ç”¨å®ƒè¿˜æ˜¯ç”¨å°è£…äº†å®ƒçš„ç¬¬ä¸‰æ–¹åº“? å°¤å…¶æ˜¯ä¼šé—®sqliteå’Œcore dataçš„åŒºåˆ«? iOSå¹³å°æ€ä¹ˆåšæ•°æ®çš„æŒä¹…åŒ–?coredataå’Œsqliteæœ‰æ— å¿…ç„¶è”ç³»?coredataæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å—? iOSä¸­å¯ä»¥æœ‰å››ç§æŒä¹…åŒ–æ•°æ®çš„æ–¹å¼: å±æ€§åˆ—è¡¨ã€å¯¹è±¡å½’æ¡£ã€SQLite3å’ŒCore Data coredataå¯ä»¥ä½¿ä½ ä»¥å›¾å½¢ç•Œé¢çš„æ–¹å¼å¿«é€Ÿçš„å®šä¹‰appçš„æ•°æ®æ¨¡å‹,åŒæ—¶åœ¨ä½ çš„ä»£ç ä¸­å®¹æ˜“è·å–åˆ°å®ƒã€‚ coredataæä¾›äº†åŸºç¡€ç»“æ„å»å¤„ç†å¸¸ç”¨çš„åŠŸèƒ½,ä¾‹å¦‚ä¿å­˜,æ¢å¤,æ’¤é”€å’Œé‡åš,å…è®¸ä½ åœ¨appä¸­ç»§ç»­åˆ›å»ºæ–°çš„ä»»åŠ¡ã€‚ åœ¨ä½¿ç”¨coredataçš„æ—¶å€™,ä½ ä¸ç”¨å®‰è£…é¢å¤–çš„æ•°æ®åº“ç³»ç»Ÿ,å› ä¸ºcoredataä½¿ç”¨å†…ç½®çš„sqliteæ•°æ®åº“ã€‚ coredataå°†ä½ appçš„æ¨¡å‹å±‚æ”¾å…¥åˆ°ä¸€ç»„å®šä¹‰åœ¨å†…å­˜ä¸­çš„æ•°æ®å¯¹è±¡ã€‚ coredataä¼š è¿½è¸ªè¿™äº›å¯¹è±¡çš„æ”¹å˜,åŒæ—¶å¯ä»¥æ ¹æ®éœ€è¦åšç›¸åº”çš„æ”¹å˜,ä¾‹å¦‚ç”¨æˆ·æ‰§è¡Œæ’¤é”€å‘½ä»¤ã€‚ å½“coredataåœ¨å¯¹ä½ appæ•°æ®çš„æ”¹å˜è¿›è¡Œä¿å­˜çš„æ—¶ å€™,core dataä¼šæŠŠè¿™äº›æ•°æ®å½’æ¡£,å¹¶æ°¸ä¹…æ€§ä¿å­˜ã€‚ mac os xä¸­sqliteåº“,å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§åŠŸèƒ½å¼ºå¤§çš„å…³ç³»æ•°æ®å¼•æ“,ä¹Ÿå¾ˆå®¹æ˜“åµŒå…¥åˆ°åº”ç”¨ç¨‹åºã€‚å¯ä»¥åœ¨å¤šä¸ªå¹³å°ä½¿ç”¨,sqliteæ˜¯ä¸€ä¸ªè½» é‡çº§çš„åµŒå…¥å¼sqlæ•°æ®åº“ç¼–ç¨‹ã€‚ ä¸coredataæ¡†æ¶ä¸åŒçš„æ˜¯,sqliteæ˜¯ä½¿ç”¨ç¨‹åºå¼çš„,sqlçš„ä¸»è¦çš„APIæ¥ç›´æ¥æ“ä½œæ•°æ®è¡¨ã€‚ Core Dataä¸æ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“,ä¹Ÿä¸æ˜¯å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(RDBMS)ã€‚ è™½ç„¶Core Dtaæ”¯æŒSQLiteä½œä¸ºä¸€ç§å­˜å‚¨ç±»å‹, ä½†å®ƒä¸èƒ½ä½¿ç”¨ä»»æ„çš„SQLiteæ•°æ®åº“ã€‚ Core Dataåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ç§è‡ªå·±åˆ›å»ºè¿™ä¸ªæ•°æ®åº“ã€‚Core Dataæ”¯æŒå¯¹ä¸€ã€å¯¹å¤šçš„å…³ç³»ã€‚ å¦‚æœåæœŸéœ€è¦å¢åŠ æ•°æ®åº“ä¸­çš„å­—æ®µæ€ä¹ˆå®ç°ï¼Œå¦‚æœä¸ä½¿ç”¨CoreDataå‘¢ï¼Ÿ ç¼–å†™SQLè¯­å¥æ¥æ“ä½œåŸæ¥è¡¨ä¸­çš„å­—æ®µ å¢åŠ è¡¨å­—æ®µï¼šALTER TABLE è¡¨å ADD COLUMN å­—æ®µå å­—æ®µç±»å‹; åˆ é™¤è¡¨å­—æ®µï¼šALTER TABLE è¡¨å DROP COLUMN å­—æ®µå; ä¿®æ”¹è¡¨å­—æ®µï¼šALTER TABLE è¡¨å RENAME COLUMN æ—§å­—æ®µå TO æ–°å­—æ®µå; SQLiteæ•°æ®å­˜å‚¨æ˜¯æ€ä¹ˆç”¨ï¼Ÿ æ·»åŠ SQLiteåŠ¨æ€åº“ï¼šå¯¼å…¥ä¸»å¤´æ–‡ä»¶ï¼š#import &lt;sqlite3.h&gt; åˆ©ç”¨Cè¯­è¨€å‡½æ•°åˆ›å»º\æ‰“å¼€æ•°æ®åº“ï¼Œç¼–å†™SQLè¯­å¥ ç®€å•æè¿°ä¸‹å®¢æˆ·ç«¯çš„ç¼“å­˜æœºåˆ¶ï¼Ÿ ç¼“å­˜å¯ä»¥åˆ†ä¸ºï¼šå†…å­˜æ•°æ®ç¼“å­˜ã€æ•°æ®åº“ç¼“å­˜ã€æ–‡ä»¶ç¼“å­˜ æ¯æ¬¡æƒ³è·å–æ•°æ®çš„æ—¶å€™ å…ˆæ£€æµ‹å†…å­˜ä¸­æœ‰æ— ç¼“å­˜ å†æ£€æµ‹æœ¬åœ°æœ‰æ— ç¼“å­˜(æ•°æ®åº“\æ–‡ä»¶) æœ€ç»ˆå‘é€ç½‘ç»œè¯·æ±‚ å°†æœåŠ¡å™¨è¿”å›çš„ç½‘ç»œæ•°æ®è¿›è¡Œç¼“å­˜ï¼ˆå†…å­˜ã€æ•°æ®åº“ã€æ–‡ä»¶ï¼‰ä»¥ä¾¿ä¸‹æ¬¡è¯»å– ä½ å®ç°è¿‡å¤šçº¿ç¨‹çš„Core Dataä¹ˆï¼ŸNSPersistentStoreCoordinatorï¼ŒNSManagedObjectContextå’ŒNSManagedObjectä¸­çš„å“ªäº›éœ€è¦åœ¨çº¿ç¨‹ä¸­åˆ›å»ºæˆ–è€…ä¼ é€’ï¼Ÿä½ æ˜¯ç”¨ä»€ä¹ˆæ ·çš„ç­–ç•¥æ¥å®ç°çš„ï¼Ÿ CoreDataæ˜¯å¯¹SQLiteæ•°æ®åº“çš„å°è£… CoreDataä¸­çš„NSManagedObjectContextåœ¨å¤šçº¿ç¨‹ä¸­ä¸å®‰å…¨ å¦‚æœæƒ³è¦å¤šçº¿ç¨‹è®¿é—®CoreDataçš„è¯ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸€ä¸ªNSManagedObjectContext æ¯ä¸ªNSManagedObjectContextå¯¹è±¡å®ä¾‹éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªNSPersistentStoreCoordinatorå®ä¾‹ï¼Œè¿™æ˜¯å› ä¸ºNSManagedObjectContextä¼šåœ¨ä¾¿ç”¨NSPersistentStoreCoordinatorå‰ä¸Šé” Core Dataæ•°æ®è¿ç§»åšå®¢åœ°å€: http://blog.csdn.net/jasonblog/article/details/17842535 FMDBçš„ä½¿ç”¨å’Œå¯¹å¤šå¼ è¡¨çš„å¤„ç†åšå®¢åœ°å€: http://blog.csdn.net/wscqqlucy/article/details/8464398 è¯´è¯´æ•°æ®åº“çš„å·¦è¿æ¥å’Œå³è¿æ¥çš„åŒºåˆ« æ•°æ®åº“å·¦è¿æ¥å’Œå³è¿æ¥çš„åŒºåˆ«ï¼šä¸»è¡¨ä¸ä¸€æ ·é€šè¿‡å·¦è¿æ¥å’Œå³è¿æ¥ï¼Œæœ€å°æ¡æ•°ä¸º3ï¼ˆè®°å½•æ¡æ•°è¾ƒå°çš„è®°å½•æ•°ï¼‰ï¼Œæœ€å¤§æ¡æ•°ä¸º12ï¼ˆ3Ã—4ï¼‰ æŠ€æœ¯åšå®¢çš„åœ°å€ : http://www.2cto.com/database/201407/317367.html iOS çš„æ²™ç›’ç›®å½•ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ App Bundle é‡Œé¢éƒ½æœ‰ä»€ä¹ˆï¼Ÿ æ²™ç›’ç»“æ„ Applicationï¼šå­˜æ”¾ç¨‹åºæºæ–‡ä»¶ï¼Œä¸Šæ¶å‰ç»è¿‡æ•°å­—ç­¾åï¼Œä¸Šæ¶åä¸å¯ä¿®æ”¹ Documentsï¼šå¸¸ç”¨ç›®å½•ï¼ŒiCloudå¤‡ä»½ç›®å½•ï¼Œå­˜æ”¾æ•°æ®,è¿™é‡Œä¸èƒ½å­˜ç¼“å­˜æ–‡ä»¶,å¦åˆ™ä¸Šæ¶ä¸è¢«é€šè¿‡ Library Cachesï¼šå­˜æ”¾ä½“ç§¯å¤§åˆä¸éœ€è¦å¤‡ä»½çš„æ•°æ®,SDWebImageç¼“å­˜è·¯å¾„å°±æ˜¯è¿™ä¸ª Preferenceï¼šè®¾ç½®ç›®å½•ï¼ŒiCloudä¼šå¤‡ä»½è®¾ç½®ä¿¡æ¯ tmpï¼šå­˜æ”¾ä¸´æ—¶æ–‡ä»¶ï¼Œä¸ä¼šè¢«å¤‡ä»½ï¼Œè€Œä¸”è¿™ä¸ªæ–‡ä»¶ä¸‹çš„æ•°æ®æœ‰å¯èƒ½éšæ—¶è¢«æ¸…é™¤çš„å¯èƒ½ App Bundle é‡Œé¢æœ‰ä»€ä¹ˆ Info.plist:æ­¤æ–‡ä»¶åŒ…å«äº†åº”ç”¨ç¨‹åºçš„é…ç½®ä¿¡æ¯.ç³»ç»Ÿä¾èµ–æ­¤æ–‡ä»¶ä»¥è·å–åº”ç”¨ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ å¯æ‰§è¡Œæ–‡ä»¶:æ­¤æ–‡ä»¶åŒ…å«åº”ç”¨ç¨‹åºçš„å…¥å£å’Œé€šè¿‡é™æ€è¿æ¥åˆ°åº”ç”¨ç¨‹åºtargetçš„ä»£ç  èµ„æºæ–‡ä»¶:å›¾ç‰‡,å£°éŸ³æ–‡ä»¶ä¸€ç±»çš„ å…¶ä»–:å¯ä»¥åµŒå…¥å®šåˆ¶çš„æ•°æ®èµ„æº ä½ ä¼šå¦‚ä½•å­˜å‚¨ç”¨æˆ·çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ç™»å½•çš„ tokenä½¿ç”¨keychainæ¥å­˜å‚¨,ä¹Ÿå°±æ˜¯é’¥åŒ™ä¸²,ä½¿ç”¨keychainéœ€è¦å¯¼å…¥Securityæ¡†æ¶ è‡ªå®šä¹‰ä¸€ä¸ªkeychainçš„ç±» #import &lt;Security/Security.h&gt; @implementation YCKKeyChain +(NSMutableDictionary *)getKeychainQuery:(NSString *)service { return [NSMutableDictionary dictionaryWithObjectsAndKeys: (__bridge_transfer id)kSecClassGenericPassword,(__bridge_transfer id)kSecClass, service, (__bridge_transfer id)kSecAttrService, service, (__bridge_transfer id)kSecAttrAccount, (__bridge_transfer id)kSecAttrAccessibleAfterFirstUnlock, (__bridge_transfer id)kSecAttrAccessible, nil]; } +(void)save:(NSString *)service data:(id)data { // è·å¾—æœç´¢å­—å…¸ NSMutableDictionary *keychainQuery = [self getKeychainQuery:service]; // æ·»åŠ æ–°çš„åˆ é™¤æ—§çš„ SecItemDelete((__bridge_retained CFDictionaryRef)keychainQuery); // æ·»åŠ æ–°çš„å¯¹è±¡åˆ°å­—ç¬¦ä¸² [keychainQuery setObject:[NSKeyedArchiver archivedDataWithRootObject:data] forKey:(__bridge_transfer id)kSecValueData]; // æŸ¥è¯¢é’¥åŒ™ä¸² SecItemAdd((__bridge_retained CFDictionaryRef)keychainQuery, NULL); } +(id)load:(NSString *)service { id ret = nil; NSMutableDictionary *keychainQuery = [self getKeychainQuery:service]; // é…ç½®æœç´¢è®¾ç½® [keychainQuery setObject:(id)kCFBooleanTrue forKey:(__bridge_transfer id)kSecReturnData]; [keychainQuery setObject:(__bridge_transfer id)kSecMatchLimitOne forKey: (__bridge_transfer id)kSecMatchLimit]; CFDataRef keyData = NULL; if (SecItemCopyMatching((__bridge_retained CFDictionaryRef)keychainQuery, (CFTypeRef *)&amp;keyData) == noErr) { @try { ret = [NSKeyedUnarchiver unarchiveObjectWithData:(__bridge_transfer NSData *)keyData]; } @catch (NSException *e) { NSLog(@&quot;Unarchive of %@ failed: %@&quot;, service, e); } @finally { } } return ret; } +(void)delete:(NSString *)service { NSMutableDictionary *keychainQuery = [self getKeychainQuery:service]; SecItemDelete((__bridge_retained CFDictionaryRef)keychainQuery); } åœ¨åˆ«çš„ç±»å®ç°å­˜å‚¨,åŠ è½½,åˆ é™¤æ•æ„Ÿä¿¡æ¯æ–¹æ³• // ç”¨æ¥æ ‡è¯†è¿™ä¸ªé’¥åŒ™ä¸² static NSString const KEY_IN_KEYCHAIN = @â€com.yck.app.allinfoâ€; // ç”¨æ¥æ ‡è¯†å¯†ç  static NSString const KEY_PASSWORD = @â€com.yck.app.passwordâ€; +(void)savePassWord:(NSString *)password { NSMutableDictionary *passwordDict = [NSMutableDictionary dictionary]; [passwordDict setObject:password forKey:KEY_PASSWORD]; [YCKKeyChain save:KEY_IN_KEYCHAIN data:passwordDict]; } +(id)readPassWord { NSMutableDictionary *passwordDict = (NSMutableDictionary *)[YCKKeyChain load:KEY_IN_KEYCHAIN]; return [passwordDict objectForKey:KEY_PASSWORD]; } +(void)deletePassWord { [YCKKeyChain delete:KEY_IN_KEYCHAIN]; } ä½¿ç”¨ NSUserDefaults æ—¶ï¼Œå¦‚ä½•å¤„ç†å¸ƒå°”çš„é»˜è®¤å€¼ï¼Ÿ(æ¯”å¦‚è¿”å› NOï¼Œä¸çŸ¥é“æ˜¯çœŸçš„ NO è¿˜æ˜¯æ²¡æœ‰è®¾ç½®è¿‡)if([[NSUserDefaults standardUserDefaults] objectForKey:ID] == nil){ NSLog(@&quot;æ²¡æœ‰è®¾ç½®&quot;); } MD5å’ŒBase64çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œå„è‡ªä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿåšè¿‡åŠ å¯†ç›¸å…³çš„åŠŸèƒ½çš„ï¼Œå‡ ä¹éƒ½ä¼šä½¿ç”¨åˆ°MD5å’ŒBase64ï¼Œå®ƒä»¬ä¸¤è€…åœ¨å®é™…å¼€å‘ä¸­æ˜¯æœ€å¸¸ç”¨çš„ã€‚ â€¢ MD5ï¼šæ˜¯ä¸€ç§ä¸å¯é€†çš„æ‘˜è¦ç®—æ³•ï¼Œç”¨äºç”Ÿæˆæ‘˜è¦ï¼Œæ— æ³•é€†ç€ç ´è§£å¾—åˆ°åŸæ–‡ã€‚å¸¸ç”¨çš„æ˜¯ç”Ÿæˆ32ä½æ‘˜è¦ï¼Œç”¨äºéªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚æ¯”å¦‚ï¼Œåœ¨ç½‘ç»œè¯·æ±‚æ¥å£ä¸­ï¼Œé€šè¿‡å°†æ‰€æœ‰çš„å‚æ•°ç”Ÿæˆæ‘˜è¦ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯é‡‡ç”¨åŒæ ·çš„è§„åˆ™ç”Ÿæˆæ‘˜è¦ï¼Œè¿™æ ·å¯ä»¥é˜²ç¯¡æ”¹ã€‚åˆå¦‚ï¼Œä¸‹è½½æ–‡ä»¶æ—¶ï¼Œé€šè¿‡ç”Ÿæˆæ–‡ä»¶çš„æ‘˜è¦ï¼Œç”¨äºéªŒè¯æ–‡ä»¶æ˜¯å¦æŸåã€‚ â€¢ Base64ï¼šå±äºåŠ å¯†ç®—æ³•ï¼Œæ˜¯å¯é€†çš„ï¼Œç»è¿‡encodeåï¼Œå¯ä»¥decodeå¾—åˆ°åŸæ–‡ã€‚åœ¨å¼€å‘ä¸­ï¼Œæœ‰çš„å…¬å¸ä¸Šä¼ å›¾ç‰‡é‡‡ç”¨çš„æ˜¯å°†å›¾ç‰‡è½¬æ¢æˆbase64å­—ç¬¦ä¸²ï¼Œå†ä¸Šä¼ ã€‚åœ¨åšåŠ å¯†ç›¸å…³çš„åŠŸèƒ½æ—¶ï¼Œé€šå¸¸ä¼šå°†æ•°æ®è¿›è¡Œbase64åŠ å¯†/è§£å¯†ã€‚ plistæ–‡ä»¶æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ã€‚ä¸€èˆ¬ç”¨å®ƒæ¥å¤„ç†ä¸€äº›ä»€ä¹ˆæ–¹é¢çš„é—®é¢˜ã€‚ plistæ˜¯iOSç³»ç»Ÿä¸­ç‰¹æœ‰çš„æ–‡ä»¶æ ¼å¼ã€‚æˆ‘ä»¬å¸¸ç”¨çš„NSUserDefaultsåå¥½è®¾ç½®å®è´¨ä¸Šå°±æ˜¯plistæ–‡ä»¶æ“ä½œã€‚plistæ–‡ä»¶æ˜¯ç”¨æ¥æŒä¹…åŒ–å­˜å‚¨æ•°æ®çš„ã€‚ æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å®ƒæ¥å­˜å‚¨åå¥½è®¾ç½®ï¼Œä»¥åŠé‚£äº›å°‘é‡çš„ã€æ•°ç»„ç»“æ„æ¯”è¾ƒå¤æ‚çš„ä¸é€‚åˆå­˜å‚¨æ•°æ®åº“çš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦å­˜å‚¨å…¨å›½åŸå¸‚åç§°å’Œidï¼Œé‚£ä¹ˆæˆ‘ä»¬è¦ä¼˜å…ˆé€‰æ‹©plistç›´æ¥æŒä¹…åŒ–å­˜å‚¨ï¼Œå› ä¸ºæ›´ç®€å•ã€‚ å½“å­˜å‚¨å¤§å—æ•°æ®æ˜¯æ€ä¹ˆåšï¼Ÿ ä½ æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œæ¯”å¦‚ï¼š ä½¿ç”¨NSUerDefaults ä½¿ç”¨XML, JSON, æˆ–è€… plist ä½¿ç”¨NSCodingå­˜æ¡£ ä½¿ç”¨ç±»ä¼¼SQLiteçš„æœ¬åœ°SQLæ•°æ®åº“ ä½¿ç”¨ Core Data NSUserDefaultsçš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿè™½ç„¶å®ƒå¾ˆniceä¹Ÿå¾ˆä¾¿æ·ï¼Œä½†æ˜¯å®ƒåªé€‚ç”¨äºå°æ•°æ®ï¼Œæ¯”å¦‚ä¸€äº›ç®€å•çš„å¸ƒå°”å‹çš„è®¾ç½®é€‰é¡¹ï¼Œå†å¤§ç‚¹ä½ å°±è¦è€ƒè™‘å…¶å®ƒæ–¹å¼äº† XMLè¿™ç§ç»“æ„åŒ–æ¡£æ¡ˆå‘¢ï¼Ÿæ€»ä½“æ¥è¯´ï¼Œä½ éœ€è¦è¯»å–æ•´ä¸ªæ–‡ä»¶åˆ°å†…å­˜é‡Œå»è§£æï¼Œè¿™æ ·æ˜¯å¾ˆä¸ç»æµçš„ã€‚ä½¿ç”¨SAXåˆæ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„äº‹æƒ…ã€‚ NSCodingï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¹Ÿéœ€è¦è¯»å†™æ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿæœ‰ä»¥ä¸Šé—®é¢˜ã€‚ åœ¨è¿™ç§åº”ç”¨åœºæ™¯ä¸‹ï¼Œä½¿ç”¨SQLite æˆ–è€… Core Dataæ¯”è¾ƒå¥½ã€‚ä½¿ç”¨è¿™äº›æŠ€æœ¯ä½ ç”¨ç‰¹å®šçš„æŸ¥è¯¢è¯­å¥å°±èƒ½åªåŠ è½½ä½ éœ€è¦çš„å¯¹è±¡ã€‚åœ¨æ€§èƒ½å±‚é¢æ¥è®²ï¼ŒSQLiteå’ŒCore Dataæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚ä»–ä»¬çš„ä¸åŒåœ¨äºå…·ä½“ä½¿ç”¨æ–¹æ³•ã€‚Core Dataä»£è¡¨ä¸€ä¸ªå¯¹è±¡çš„graph modelï¼Œä½†SQLiteå°±æ˜¯ä¸€ä¸ªDBMSã€‚Appleåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å»ºè®®ä½¿ç”¨Core Dataï¼Œä½†æ˜¯å¦‚æœä½ æœ‰ç†ç”±ä¸ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆå°±å»ä½¿ç”¨æ›´åŠ åº•å±‚çš„SQLiteå§ã€‚å¦‚æœä½ ä½¿ç”¨SQLiteï¼Œä½ å¯ä»¥ç”¨FMDB(https://GitHub.com/ccgus/fmdb)è¿™ä¸ªåº“æ¥ç®€åŒ–SQLiteçš„æ“ä½œï¼Œè¿™æ ·ä½ å°±ä¸ç”¨èŠ±å¾ˆå¤šç»å†äº†è§£SQLiteçš„C APIäº† æ€ä¹ˆè§£å†³sqliteé”å®šçš„é—®é¢˜1&gt; è®¾ç½®æ•°æ®åº“é”å®šçš„å¤„ç†å‡½æ•° int sqlite3_busy_handler(sqlite3*, int(*)(void*,int), void*); å‡½æ•°å¯ä»¥å®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å‡ºç°æ•°æ®åº“å¿™æ—¶ï¼Œsqliteä¼šè°ƒç”¨è¯¥å‡½æ•° å½“å›è°ƒå‡½æ•°ä¸ºï¼®ï¼µï¼¬ï¼¬æ—¶ï¼Œæ¸…é™¤busy handleï¼Œç”³è¯·ä¸åˆ°é”ç›´æ¥è¿”å› å›è°ƒå‡½æ•°çš„ç¬¬äºŒä¸ªå‡½æ•°ä¼šè¢«ä¼ é€’ä¸ºè¯¥ç”±æ­¤æ¬¡å¿™äº‹ä»¶è°ƒç”¨è¯¥å‡½æ•°çš„æ¬¡æ•° å›è°ƒå‡½æ•°è¿”å›éï¼,æ•°æ®åº“ä¼šé‡è¯•å½“å‰æ“ä½œï¼Œè¿”å›ï¼åˆ™å½“å‰æ“ä½œè¿”å›SQLITE_BUSY 2&gt; è®¾å®šé”å®šæ—¶çš„ç­‰å¾…æ—¶é—´ int sqlite3_busy_timeout(sqlite3*, 60); å®šä¹‰ä¸€ä¸ªæ¯«ç§’æ•°ï¼Œå½“æœªåˆ°è¾¾è¯¥æ¯«ç§’æ•°æ—¶ï¼Œsqliteä¼šsleepå¹¶é‡è¯•å½“å‰æ“ä½œ å¦‚æœè¶…è¿‡msæ¯«ç§’ï¼Œä»ç„¶ç”³è¯·ä¸åˆ°éœ€è¦çš„é”ï¼Œå½“å‰æ“ä½œè¿”å›sqlite_BUSY å½“ms&lt;=0æ—¶ï¼Œæ¸…é™¤busy handleï¼Œç”³è¯·ä¸åˆ°é”ç›´æ¥è¿”å›]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜12--ç»˜å›¾ä¸åŠ¨ç”»]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9812-%E7%BB%98%E5%9B%BE%E4%B8%8E%E5%8A%A8%E7%94%BB%2F</url>
    <content type="text"><![CDATA[CAAnimationçš„å±‚çº§ç»“æ„ CAPropertyAnimationæ˜¯CAAnimationçš„å­ç±»ï¼Œä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¦æƒ³åˆ›å»ºåŠ¨ç”»å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨å®ƒçš„ä¸¤ä¸ªå­ç±»ï¼šCABasicAnimationå’ŒCAKeyframeAnimation å±æ€§è§£æï¼škeyPathï¼šé€šè¿‡æŒ‡å®šCALayerçš„ä¸€ä¸ªå±æ€§åç§°ä¸ºkeyPath(NSStringç±»å‹)ï¼Œå¹¶ä¸”å¯¹CALayerçš„è¿™ä¸ªå±æ€§çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°ç›¸åº”çš„åŠ¨ç”»æ•ˆæœã€‚æ¯”å¦‚ï¼ŒæŒ‡å®š@â€positionâ€ä¸ºkeyPathï¼Œå°±ä¿®æ”¹CALayerçš„positionå±æ€§çš„å€¼ï¼Œä»¥è¾¾åˆ°å¹³ç§»çš„åŠ¨ç”»æ•ˆæœ CABasicAnimationï¼ŒCAPropertyAnimationçš„å­ç±» å±æ€§è§£æ: fromValueï¼škeyPathç›¸åº”å±æ€§çš„åˆå§‹å€¼ toValueï¼škeyPathç›¸åº”å±æ€§çš„ç»“æŸå€¼ éšç€åŠ¨ç”»çš„è¿›è¡Œï¼Œåœ¨é•¿åº¦ä¸ºdurationçš„æŒç»­æ—¶é—´å†…ï¼ŒkeyPathç›¸åº”å±æ€§çš„å€¼ä»fromValueæ¸æ¸åœ°å˜ä¸ºtoValueã€‚å¦‚æœfillMode=kCAFillModeForwardså’ŒremovedOnComletion=NOï¼Œé‚£ä¹ˆåœ¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾å±‚ä¼šä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ã€‚ä½†åœ¨å®è´¨ä¸Šï¼Œå›¾å±‚çš„å±æ€§å€¼è¿˜æ˜¯åŠ¨ç”»æ‰§è¡Œå‰çš„åˆå§‹å€¼ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è¢«æ”¹å˜ã€‚æ¯”å¦‚ï¼ŒCALayerçš„positionåˆå§‹å€¼ä¸º(0,0)ï¼ŒCABasicAnimationçš„fromValueä¸º(10,10)ï¼ŒtoValueä¸º(100,100)ï¼Œè™½ç„¶åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå›¾å±‚ä¿æŒåœ¨(100,100)è¿™ä¸ªä½ç½®ï¼Œå®è´¨ä¸Šå›¾å±‚çš„positionè¿˜æ˜¯ä¸º(0,0) CAKeyframeAnimationï¼ŒCApropertyAnimationçš„å­ç±»ï¼Œè·ŸCABasicAnimationçš„åŒºåˆ«æ˜¯ï¼šCABasicAnimationåªèƒ½ä»ä¸€ä¸ªæ•°å€¼(fromValue)å˜åˆ°å¦ä¸€ä¸ªæ•°å€¼(toValue)ï¼Œè€ŒCAKeyframeAnimationä¼šä½¿ç”¨ä¸€ä¸ªNSArrayä¿å­˜è¿™äº›æ•°å€¼ å±æ€§è§£æï¼š valuesï¼šå°±æ˜¯ä¸Šè¿°çš„NSArrayå¯¹è±¡ã€‚é‡Œé¢çš„å…ƒç´ ç§°ä¸ºâ€å…³é”®å¸§â€(keyframe)ã€‚åŠ¨ç”»å¯¹è±¡ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´(duration)å†…ï¼Œä¾æ¬¡æ˜¾ç¤ºvaluesæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…³é”®å¸§ pathï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªCGPathRef\CGMutablePathRef,è®©å±‚è·Ÿç€è·¯å¾„ç§»åŠ¨ã€‚pathåªå¯¹CALayerçš„anchorPointå’Œpositionèµ·ä½œç”¨ã€‚å¦‚æœä½ è®¾ç½®äº†pathï¼Œé‚£ä¹ˆvalueså°†è¢«å¿½ç•¥ keyTimesï¼šå¯ä»¥ä¸ºå¯¹åº”çš„å…³é”®å¸§æŒ‡å®šå¯¹åº”çš„æ—¶é—´ç‚¹,å…¶å–å€¼èŒƒå›´ä¸º0åˆ°1.0,keyTimesä¸­çš„æ¯ä¸€ä¸ªæ—¶é—´å€¼éƒ½å¯¹åº”valuesä¸­çš„æ¯ä¸€å¸§.å½“keyTimesæ²¡æœ‰è®¾ç½®çš„æ—¶å€™,å„ä¸ªå…³é”®å¸§çš„æ—¶é—´æ˜¯å¹³åˆ†çš„ CABasicAnimationå¯çœ‹åšæ˜¯æœ€å¤šåªæœ‰2ä¸ªå…³é”®å¸§çš„CAKeyframeAnimation CAAnimationGroupï¼ŒCAAnimationçš„å­ç±»ï¼Œå¯ä»¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡ï¼Œå°†CAAnimationGroupå¯¹è±¡åŠ å…¥å±‚åï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»å¯¹è±¡å¯ä»¥åŒæ—¶å¹¶å‘è¿è¡Œ å±æ€§è§£æï¼š animationsï¼šç”¨æ¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡çš„NSArray é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ç»„åŠ¨ç”»å¯¹è±¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®åŠ¨ç”»å¯¹è±¡çš„beginTimeå±æ€§æ¥æ›´æ”¹åŠ¨ç”»çš„å¼€å§‹æ—¶é—´ CATransitionï¼ŒCAAnimationçš„å­ç±»ï¼Œç”¨äºåšè½¬åœºåŠ¨ç”»ï¼Œèƒ½å¤Ÿä¸ºå±‚æä¾›ç§»å‡ºå±å¹•å’Œç§»å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚iOSæ¯”Mac OS Xçš„è½¬åœºåŠ¨ç”»æ•ˆæœå°‘ä¸€ç‚¹ UINavigationControllerå°±æ˜¯é€šè¿‡CATransitionå®ç°äº†å°†æ§åˆ¶å™¨çš„è§†å›¾æ¨å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœ å±æ€§è§£æ: typeï¼šåŠ¨ç”»è¿‡æ¸¡ç±»å‹ subtypeï¼šåŠ¨ç”»è¿‡æ¸¡æ–¹å‘ startProgressï¼šåŠ¨ç”»èµ·ç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”) endProgressï¼šåŠ¨ç”»ç»ˆç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”) UIViewåŠ¨ç”» UIKitç›´æ¥å°†åŠ¨ç”»é›†æˆåˆ°UIViewç±»ä¸­ï¼Œå½“å†…éƒ¨çš„ä¸€äº›å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒUIViewå°†ä¸ºè¿™äº›æ”¹å˜æä¾›åŠ¨ç”»æ”¯æŒ æ‰§è¡ŒåŠ¨ç”»æ‰€éœ€è¦çš„å·¥ä½œç”±UIViewç±»è‡ªåŠ¨å®Œæˆï¼Œä½†ä»è¦åœ¨å¸Œæœ›æ‰§è¡ŒåŠ¨ç”»æ—¶é€šçŸ¥è§†å›¾ï¼Œä¸ºæ­¤éœ€è¦å°†æ”¹å˜å±æ€§çš„ä»£ç æ”¾åœ¨[UIView beginAnimations:nil context:nil]å’Œ[UIView commitAnimations]ä¹‹é—´ BlockåŠ¨ç”» å¸§åŠ¨ç”» PNG è°ˆè°ˆä½ å¯¹Core Graphic ç»˜å›¾çš„äº†è§£? Core Graphicsæ˜¯åŸºäºCçš„APIï¼Œå¯ä»¥ç”¨äºä¸€åˆ‡ç»˜å›¾æ“ä½œ Core Graphics å’ŒQuartz 2Dçš„åŒºåˆ« quartzæ˜¯ä¸€ä¸ªé€šç”¨çš„æœ¯è¯­ï¼Œç”¨äºæè¿°åœ¨IOSå’ŒMAC OS X ZHONG æ•´ä¸ªåª’ä½“å±‚ç”¨åˆ°çš„å¤šç§æŠ€æœ¯ åŒ…æ‹¬å›¾å½¢ã€åŠ¨ç”»ã€éŸ³é¢‘ã€é€‚é…ã€‚ Quart 2D æ˜¯ä¸€ç»„äºŒä½ç»˜å›¾å’Œæ¸²æŸ“APIï¼ŒCore Graphicä¼šä½¿ç”¨åˆ°è¿™ç»„API Quartz Core ä¸“æŒ‡Core Animationç”¨åˆ°çš„åŠ¨ç”»ç›¸å…³çš„åº“ã€APIå’Œç±» Core Graphicsæ˜¯é«˜åº¦é›†æˆäºUIViewå’Œå…¶ä»–UIKitéƒ¨åˆ†çš„ã€‚ Core Graphicsæ•°æ®ç»“æ„å’Œå‡½æ•°å¯ä»¥é€šè¿‡å‰ç¼€CGæ¥è¯†åˆ«ã€‚ ç³»ç»Ÿæ‹¥æœ‰åæ ‡ç³»ï¼Œå¦‚320 480 ç¡¬ä»¶æœ‰retainå±å¹•å’Œéretainå±ï¼šå¦‚320 480ã€640 960 Core Graphics ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿçš„åæ ‡ç³»æ¥ç»˜åˆ¶å›¾ç‰‡ã€‚åœ¨åˆ†è¾¨ç‡ä¸º640 960æ‰‹æœºä¸Šç»˜åˆ¶å›¾ç‰‡æ—¶ï¼Œå®é™…ä¸ŠCore Graphics çš„åæ ‡æ˜¯320*480ã€‚è¿™ä¸ªæ—¶å€™æ¯ä¸ªåæ ‡ç³»ä¸Šçš„ç‚¹ï¼Œå®é™…ä¸Šæ‹¥æœ‰ä¸¤ä¸ªåƒç´ ã€‚ è§†å›¾å¯ä»¥é€šè¿‡å­è§†å›¾ã€å›¾å±‚æˆ–å®ç°drawRectï¼šæ–¹æ³•æ¥è¡¨ç°å†…å®¹ï¼Œå¦‚æœè¯´å®ç°äº†drawRectï¼šæ–¹æ³•ï¼Œé‚£ä¹ˆæœ€å¥½å°±ä¸è¦æ··ç”¨å…¶ä»–æ–¹æ³•äº†ï¼Œå¦‚å›¾å±‚å’Œå­è§†å›¾ã€‚è‡ªå®šä¹‰ç»˜å›¾å¤§éƒ¨åˆ†æ˜¯ç”±UIKitæˆ–è€…Core Graphicsæ¥å®ç°çš„ã€‚ Core Graphicsçš„ä¼˜ç‚¹ï¼šå¿«é€Ÿã€é«˜æ•ˆï¼Œå‡å°åº”ç”¨çš„æ–‡ä»¶å¤§å°ã€‚åŒæ—¶å¯ä»¥è‡ªç”±åœ°ä½¿ç”¨åŠ¨æ€çš„ã€é«˜è´¨é‡çš„å›¾å½¢å›¾åƒã€‚ ä½¿ç”¨Core Graphicsï¼Œå¯ä»¥åˆ›å»ºç›´çº¿ã€è·¯å¾„ã€æ¸å˜ã€æ–‡å­—ä¸å›¾åƒç­‰å†…å®¹ï¼Œå¹¶å¯ä»¥åšå˜å½¢å¤„ç† 2Dç»˜å›¾ä¸€èˆ¬å¯ä»¥æ‹†åˆ†æˆä»¥ä¸‹å‡ ä¸ªæ“ä½œ: çº¿æ¡ , è·¯å¾„ , æ–‡æœ¬ , å›¾ç‰‡ , æ¸å˜ ç”±äºåƒç´ æ˜¯ä¾èµ–äºç›®æ ‡çš„ï¼Œæ‰€ä»¥2Dç»˜å›¾å¹¶ä¸èƒ½æ“ä½œå•ç‹¬çš„åƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰è¯»å–å®ƒã€‚ ç»˜å›¾å°±å¥½æ¯”åœ¨ç”»å¸ƒä¸Šæ‹¿ç€ç”»ç¬”æœºæ¢°çš„è¿›è¡Œç”»ç”»ï¼Œé€šè¿‡åˆ¶å®šä¸åŒçš„å‚æ•°æ¥è¿›è¡Œä¸åŒçš„ç»˜åˆ¶ã€‚ http://www.tuicool.com/articles/jIJzMf http://blog.csdn.net/mangosnow/article/details/37054765 Core Animation(æ ¸å¿ƒåŠ¨ç”»)? CoreAnimationä¹Ÿå°±æ˜¯æ ¸å¿ƒåŠ¨ç”», æ˜¯ä¸€ç»„éå¸¸å¼ºå¤§çš„åŠ¨ç”»å¤„ç†API, å¯ä»¥ä½¿ç”¨å°‘é‡çš„ä»£ç åšå‡ºç»šä¸½çš„æ•ˆæœ, æ˜¯ç›´æ¥ä½œç”¨åœ¨CALayerä¸Šçš„, å¹¶éUIView, å¹¶ä¸”Core Animationçš„åŠ¨ç”»æ‰§è¡Œè¿‡ç¨‹éƒ½æ˜¯åœ¨åå°æ“ä½œ, ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹. æ‰€æœ‰åŠ¨ç”»éƒ½æ˜¯ä½œç”¨åœ¨CALayerä¸Šçš„, å½“æŠŠåŠ¨ç”»æ·»åŠ åˆ°Layerä¸Š, æ˜¯ä¸ç›´æ¥ä¿®æ”¹å®ƒçš„å±æ€§, Core Animationç»´æŠ¤äº†ä¸¤ä¸ªå¹³è¡Œlayerçš„å±‚æ¬¡ç»“æ„, æ¨¡å‹å±‚æ ‘å¯ä»¥çœ‹åˆ°Layerçš„çŠ¶æ€, è¡¨ç¤ºå±‚æ ‘åˆ™æ˜¯åŠ¨ç”»æ­£åœ¨è¡¨ç°çš„å€¼çš„è¿‘ä¼¼ã€‚ Core Animationçš„ä½¿ç”¨æ­¥éª¤: ä½¿ç”¨å®ƒéœ€è¦å…ˆæ·»åŠ QuartzCore.frameworkæ¡†æ¶å’Œå¼•å…¥ä¸»å¤´æ–‡ä»¶&lt;QuartzCore/QuartzCore.h&gt;(iOS7.0+ ä¸éœ€è¦) åˆå§‹åŒ–ä¸€ä¸ªCAAnimationå¯¹è±¡ï¼Œå¹¶è®¾ç½®ä¸€äº›åŠ¨ç”»ç›¸å…³å±æ€§ é€šè¿‡è°ƒç”¨CALayerçš„addAnimation:forKey:æ–¹æ³•å¢åŠ CAAnimationå¯¹è±¡åˆ°CALayerä¸­ï¼Œè¿™æ ·å°±èƒ½å¼€å§‹æ‰§è¡ŒåŠ¨ç”»äº† é€šè¿‡è°ƒç”¨CALayerçš„removeAnimationForKey:æ–¹æ³•å¯ä»¥åœæ­¢CALayerä¸­çš„åŠ¨ç”» è½¬åœºåŠ¨ç”»? CATransition-è½¬åœºåŠ¨ç”», ä½œä¸ºCAAnimationçš„å­ç±»ï¼Œç”¨äºåšè½¬åœºåŠ¨ç”»ï¼Œèƒ½å¤Ÿä¸ºå±‚æä¾›ç§»å‡ºå±å¹•å’Œç§»å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚iOSæ¯”Mac OS Xçš„è½¬åœºåŠ¨ç”»æ•ˆæœå°‘ä¸€ç‚¹. UINavigationControllerå°±æ˜¯é€šCATransitionå®ç°äº†å°†æ§åˆ¶å™¨çš„è§†å›¾æ¨å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœ. Cocoa Touchæä¾›äº†å“ªå‡ ç§Core Animationè¿‡æ¸¡ç±»å‹ï¼Ÿ Cocoa Touch æä¾›äº† 4 ç§ Core Animation è¿‡æ¸¡ç±»å‹ï¼Œåˆ†åˆ«ä¸ºï¼šäº¤å‰æ·¡åŒ–ã€æ¨æŒ¤ã€æ˜¾ç¤ºå’Œè¦†ç›–ã€‚ ä½¿ç”¨UIViewçš„åŠ¨ç”»å‡½æ•°, å®ç°è½¬åœºåŠ¨ç”» å•è§†å›¾: +(void)transitionWithView:(UIView* )view duration:(NSTimeInterval)duration options:(UIViewAnimationOptions)options animations:(void (^)(void))animations completion:(void (^)(BOOL finished))completion; åŒè§†å›¾: +(void)transitionFromView:(UIView )fromView toView:(UIView)toView duration:(NSTimeInterval)duration options:(UIViewAnimationOptions)options completion:(void (^)(BOOL finished))completion; ä¸€ä¸ªåŠ¨ç”»æ€ä¹ˆå®ç°? ä»¥è½¬åœºåŠ¨ç”»ä¸ºä¾‹: åˆ›å»ºCATransitionå¯¹è±¡ CATransition *animation = [CATransition animation]; è®¾ç½®è¿åŠ¨æ—¶é—´(å³åŠ¨ç”»æ—¶é—´) animation.duration = DURATION; è®¾ç½®è¿åŠ¨type(ç±»å‹) animation.type = type; if (subtype != nil) { //è®¾ç½®å­ç±» (å’Œtypeé…åˆä½¿ç”¨, æŒ‡å®šè¿åŠ¨çš„æ–¹å‘) animation.subtype = subtype;} è®¾ç½®è¿åŠ¨é€Ÿåº¦(åŠ¨ç”»çš„è¿åŠ¨è½¨è¿¹ï¼Œç”¨äºå˜åŒ–èµ·ç‚¹å’Œç»ˆç‚¹ä¹‹é—´çš„æ’å€¼è®¡ç®—,å½¢è±¡ç‚¹è¯´å®ƒå†³å®šäº†åŠ¨ç”»è¿è¡Œçš„èŠ‚å¥,æ¯”å¦‚æ˜¯å‡åŒ€å˜åŒ–(ç›¸åŒæ—¶é—´å˜åŒ–é‡ç›¸åŒ)è¿˜æ˜¯å…ˆå¿«åæ…¢,å…ˆæ…¢åå¿«è¿˜æ˜¯å…ˆæ…¢å†å¿«å†æ…¢) animation.timingFunction = UIViewAnimationOptionCurveEaseInOut; å°†åŠ¨ç”»æ·»åŠ åˆ°viewçš„Layerå±‚ [view.layer addAnimation:animation forKey:@â€animationâ€]; åŠ¨ç”»ç±»å‹å¦‚ä¸‹: typedef enum : NSUInteger { Push, //æ¨æŒ¤ Cube, //ç«‹æ–¹ä½“ } AnimationType; è¯´è¯´Core Animationæ˜¯å¦‚ä½•å¼€å§‹å’Œç»“æŸåŠ¨ç”»çš„ä¸æ˜¯å¾ˆæ¸…æ¥šé¢˜ç›®çš„çœŸæ­£è¦æ±‚ï¼Œæ˜¯æƒ³çŸ¥é“æ ¸å¿ƒåŠ¨ç”»çš„å“ªäº›çŸ¥è¯†ç‚¹ã€‚å¦‚ä½•å¼€å§‹å’Œç»“æŸåŠ¨ç”»ï¼Œè¿™æ ¸å¿ƒåŠ¨ç”»æœ‰å¾ˆå¤šç§ï¼Œæ¯ç§åŠ¨ç”»è¿˜æœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚ å‚è€ƒç­”æ¡ˆï¼š åŠ¨ç”»çš„å¼€å§‹å’Œç»“æŸéƒ½å¯ä»¥é€šè¿‡CAMediaTimingåè®®æ¥å¤„ç†ï¼Œæ ¸å¿ƒåŠ¨ç”»çš„åŸºç±»æ˜¯éµå®ˆäº†CAMediaTimingåè®®çš„ï¼Œå¯ä»¥æŒ‡å®šåŠ¨ç”»å¼€å§‹æ—¶é—´ã€åŠ¨ç”»æ—¶é•¿ã€åŠ¨ç”»æ’­æ”¾é€Ÿåº¦ã€åŠ¨ç”»åœ¨å®Œæˆæ—¶çš„è¡Œä¸ºï¼ˆåœç•™åœ¨ç»“æŸå¤„ã€åŠ¨ç”»å›åˆ°å¼€å§‹å¤„ã€åŠ¨ç”»å®Œæˆæ—¶ç§»é™¤åŠ¨ç”»ï¼‰ã€‚ åŠ¨ç”»æœ‰åŸºæœ¬ç±»å‹æœ‰å“ªå‡ ç§ï¼›è¡¨è§†å›¾æœ‰å“ªå‡ ç§åŸºæœ¬æ ·å¼ã€‚ åŠ¨ç”»æœ‰ä¸¤ç§åŸºæœ¬ç±»å‹ï¼šä¸€ç§ä¸ºUIViewåŠ¨ç”»,åˆç§°éšå¼åŠ¨ç”»,åŠ¨ç”»åframeçš„æ•°å€¼å‘ç”Ÿäº†å˜åŒ–.å¦ä¸€ç§æ˜¯CALayeråŠ¨ç”»,åˆç§°æ˜¾ç¤ºåŠ¨ç”»,åŠ¨ç”»åæ¨¡å‹å±‚çš„æ•°æ®ä¸ä¼šå‘ç”Ÿå˜åŒ–,å›¾å½¢å›åˆ°åŸæ¥çš„ä½ç½®ã€‚ UITableViewStylePlainï¼šæ™®é€šæ ·å¼ UITableViewStyleGrouped:åˆ†ç»„æ ·å¼ UITableViewCellStyleDefault:Defaultæ ·å¼ï¼šå·¦è¾¹ä¸€ä¸ªæ˜¾ç¤ºå›¾ç‰‡çš„imageViewï¼Œä¸€ä¸ªæ ‡é¢˜textLabelï¼Œæ²¡æœ‰detailTextLabelã€‚ UITableViewCellStyleSubtitle:Subtitleæ ·å¼ï¼šå·¦è¾¹ä¸€ä¸ªæ˜¾ç¤ºå›¾ç‰‡çš„imageViewï¼Œä¸Šè¾¹ä¸€ä¸ªä¸»æ ‡é¢˜textLabelï¼Œä¸€ä¸ªå‰¯æ ‡é¢˜detailTextLabelã€‚ä¸»æ ‡é¢˜å­—ä½“å¤§ä¸”åŠ é»‘ï¼Œå‰¯æ ‡é¢˜å­—ä½“å°åœ¨ä¸»æ ‡é¢˜ä¸‹è¾¹ã€‚ UITableViewCellStyleValue1:Value1æ ·å¼ï¼šå·¦è¾¹ä¸€ä¸ªæ˜¾ç¤ºå›¾ç‰‡çš„imageViewï¼Œå·¦è¾¹ä¸€ä¸ªä¸»æ ‡é¢˜textLabelï¼Œå³è¾¹ä¸€ä¸ªå‰¯æ ‡é¢˜detailTextLabelï¼Œä¸»æ ‡é¢˜å­—ä½“æ¯”è¾ƒé»‘ã€‚ UITableViewCellStyleValue2:Value2æ ·å¼ï¼šå·¦è¾¹ä¸€ä¸ªä¸»æ ‡é¢˜textLabelå­—ä½“åå°ï¼ŒæŒ¨ç€å³è¾¹ä¸€ä¸ªå‰¯æ ‡é¢˜detailTextLabelï¼Œå­—ä½“å¤§ä¸”åŠ é»‘ã€‚ CADisplayLink CADisplayLinkæ˜¯ä¸€ç§ä»¥å±å¹•åˆ·æ–°é¢‘ç‡è§¦å‘çš„æ—¶é’Ÿæœºåˆ¶ï¼Œæ¯ç§’é’Ÿæ‰§è¡Œå¤§çº¦60æ¬¡å·¦å³ CADisplayLinkæ˜¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œå¯ä»¥ä½¿ç»˜å›¾ä»£ç ä¸è§†å›¾çš„åˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œè€ŒNSTimeræ— æ³•ç¡®ä¿è®¡æ—¶å™¨å®é™…è¢«è§¦å‘çš„å‡†ç¡®æ—¶é—´ ä½¿ç”¨æ–¹æ³•ï¼š å®šä¹‰CADisplayLinkå¹¶åˆ¶å®šè§¦å‘è°ƒç”¨æ–¹æ³• å°†æ˜¾ç¤ºé“¾æ¥æ·»åŠ åˆ°ä¸»è¿è¡Œå¾ªç¯é˜Ÿåˆ— Quatrz 2Dçš„ç»˜å›¾åŠŸèƒ½çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆå¹¶ç®€è¿°å…¶ä½œç”¨ã€‚ä¸Šä¸‹æ–‡ï¼šä¸»è¦ç”¨äºæè¿°å›¾å½¢å†™å…¥å“ªé‡Œï¼› è·¯å¾„ï¼šæ˜¯åœ¨å›¾å±‚ä¸Šç»˜åˆ¶çš„å†…å®¹ï¼› çŠ¶æ€ï¼šç”¨äºä¿å­˜é…ç½®å˜æ¢çš„å€¼ã€å¡«å……å’Œè½®å»“ï¼Œ alpha å€¼ç­‰ã€‚ æ–‡ç« å¦‚æœ‰é—®é¢˜ï¼Œè¯·ç•™è¨€ï¼Œæˆ‘å°†åŠæ—¶æ›´æ­£ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜11--ç¬¬ä¸‰æ–¹æ¡†æ¶åŠå…¶ç®¡ç†]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9811-%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6%E5%8F%8A%E5%85%B6%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[ä½¿ç”¨è¿‡CocoaPodså—ï¼Ÿå®ƒæ˜¯ä»€ä¹ˆï¼ŸCocoaPodsçš„åŸç†? CocoaPodæ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“çš„ç®¡ç†å·¥å…·ï¼Œç”¨æ¥ç®¡ç†é¡¹ç›®ä¸­çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ã€‚ åœ¨ç»ˆç«¯ä¸­è¿›å…¥ï¼ˆcdå‘½ä»¤ï¼‰ä½ é¡¹ç›®æ‰€åœ¨ç›®å½•ï¼Œç„¶ååœ¨å½“å‰ç›®å½•ä¸‹ï¼Œåˆ©ç”¨vimåˆ›å»ºPodfileï¼Œè¿è¡Œï¼š $ vim Podfile ç„¶ååœ¨Podfileæ–‡ä»¶ä¸­è¾“å…¥ä»¥ä¸‹æ–‡å­—ï¼š platform :ios, â€˜9.3â€™ pod â€œAFNetworkingâ€, â€œ~&gt; 2.0â€ ç„¶åä¿å­˜é€€å‡ºã€‚vimç¯å¢ƒä¸‹ï¼Œä¿å­˜é€€å‡ºå‘½ä»¤æ˜¯ :wq è¿™æ—¶å€™ï¼Œä½ ä¼šå‘ç°ä½ çš„é¡¹ç›®ç›®å½•ä¸­ï¼Œå‡ºç°ä¸€ä¸ªåå­—ä¸ºPodfileçš„æ–‡ä»¶ï¼Œè€Œä¸”æ–‡ä»¶å†…å®¹å°±æ˜¯ä½ åˆšåˆšè¾“å…¥çš„å†…å®¹ã€‚ è¿™æ—¶å€™ï¼Œä½ å°±å¯ä»¥åˆ©ç”¨CocoPodsä¸‹è½½AFNetworkingç±»åº“äº†,è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š$ pod install ç”¨cocoapodsç®¡ç†ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æ—¶å€™æˆ‘æƒ³æ”¹ç‰ˆæœ¬ï¼Œæ€ä¹ˆåŠåˆ°ï¼Ÿ å¯ä»¥ç›´æ¥æˆ–è€…ç»ˆç«¯æ‰“å¼€Podfile, ä¿®æ”¹Podfileæ–‡ä»¶ä¸­ç¬¬ä¸‰æ–¹æ¡†æ¶çš„ç‰ˆæœ¬ é›†æˆä¸‰æ–¹æ¡†æ¶æœ‰å“ªäº›æ–¹æ³• cocoapods framework ç›´æ¥ä¸‹è½½æºç æ‹–è¿›é¡¹ç›®ç”¨ SDWebImageçš„åŸç†å®ç°æœºåˆ¶ï¼Œå¦‚ä½•è§£å†³TableViewå¡çš„é—®é¢˜?SDWebImageå†…éƒ¨å®ç°è¿‡ç¨‹ï¼ˆå»ºè®®ç”»å›¾è®°ä½ï¼‰ image å…¥å£ setImageWithURL:placeholderImage:options: ä¼šå…ˆæŠŠ placeholderImage æ˜¾ç¤ºï¼Œç„¶å SDWebImageManager æ ¹æ® URL å¼€å§‹å¤„ç†å›¾ç‰‡ã€‚ è¿›å…¥ SDWebImageManager-downloadWithURL:delegate:options:userInfo:ï¼Œäº¤ç»™ SDImageCache ä»ç¼“å­˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ä¸‹è½½ queryDiskCacheForKey:delegate:userInfo:. å…ˆä»å†…å­˜å›¾ç‰‡ç¼“å­˜æŸ¥æ‰¾æ˜¯å¦æœ‰å›¾ç‰‡ï¼Œå¦‚æœå†…å­˜ä¸­å·²ç»æœ‰å›¾ç‰‡ç¼“å­˜ï¼ŒSDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo: åˆ° SDWebImageManagerã€‚ SDWebImageManagerDelegate å›è°ƒ webImageManager:didFinishWithImage: åˆ° UIImageView+WebCache ç­‰å‰ç«¯å±•ç¤ºå›¾ç‰‡ã€‚ å¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œç”Ÿæˆ NSInvocationOperation æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä»ç¡¬ç›˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ç¼“å­˜ã€‚ æ ¹æ® URLKey åœ¨ç¡¬ç›˜ç¼“å­˜ç›®å½•ä¸‹å°è¯•è¯»å–å›¾ç‰‡æ–‡ä»¶ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨ NSOperation è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å›ä¸»çº¿ç¨‹è¿›è¡Œç»“æœå›è°ƒ notifyDelegate:ã€‚ å¦‚æœä¸Šä¸€æ“ä½œä»ç¡¬ç›˜è¯»å–åˆ°äº†å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼ˆå¦‚æœç©ºé—²å†…å­˜è¿‡å°ï¼Œä¼šå…ˆæ¸…ç©ºå†…å­˜ç¼“å­˜ï¼‰ã€‚SDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo:ã€‚è¿›è€Œå›è°ƒå±•ç¤ºå›¾ç‰‡ã€‚ å¦‚æœä»ç¡¬ç›˜ç¼“å­˜ç›®å½•è¯»å–ä¸åˆ°å›¾ç‰‡ï¼Œè¯´æ˜æ‰€æœ‰ç¼“å­˜éƒ½ä¸å­˜åœ¨è¯¥å›¾ç‰‡ï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡, å›è°ƒ imageCache:didNotFindImageForKey:userInfo:ã€‚ å…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨ SDWebImageDownloader å¼€å§‹ä¸‹è½½å›¾ç‰‡ã€‚ å›¾ç‰‡ä¸‹è½½ç”± NSURLConnection æ¥åšï¼Œå®ç°ç›¸å…³ delegate æ¥åˆ¤æ–­å›¾ç‰‡ä¸‹è½½ä¸­ã€ä¸‹è½½å®Œæˆå’Œä¸‹è½½å¤±è´¥ã€‚ connection:didReceiveData: ä¸­åˆ©ç”¨ ImageIO åšäº†æŒ‰å›¾ç‰‡ä¸‹è½½è¿›åº¦åŠ è½½æ•ˆæœã€‚ connectionDidFinishLoading: æ•°æ®ä¸‹è½½å®Œæˆåäº¤ç»™ SDWebImageDecoder åšå›¾ç‰‡è§£ç å¤„ç†ã€‚ å›¾ç‰‡è§£ç å¤„ç†åœ¨ä¸€ä¸ª NSOperationQueue å®Œæˆï¼Œä¸ä¼šæ‹–æ…¢ä¸»çº¿ç¨‹ UIã€‚å¦‚æœæœ‰éœ€è¦å¯¹ä¸‹è½½çš„å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œæœ€å¥½ä¹Ÿåœ¨è¿™é‡Œå®Œæˆï¼Œæ•ˆç‡ä¼šå¥½å¾ˆå¤šã€‚ åœ¨ä¸»çº¿ç¨‹ notifyDelegateOnMainThreadWithInfo: å®£å‘Šè§£ç å®Œæˆï¼ŒimageDecoder:didFinishDecodingImage:userInfo: å›è°ƒç»™ SDWebImageDownloaderã€‚ imageDownloader:didFinishWithImage: å›è°ƒç»™ SDWebImageManager å‘ŠçŸ¥å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚ é€šçŸ¥æ‰€æœ‰çš„ downloadDelegates ä¸‹è½½å®Œæˆï¼Œå›è°ƒç»™éœ€è¦çš„åœ°æ–¹å±•ç¤ºå›¾ç‰‡ã€‚ å°†å›¾ç‰‡ä¿å­˜åˆ° SDImageCache ä¸­ï¼Œå†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜åŒæ—¶ä¿å­˜ã€‚å†™æ–‡ä»¶åˆ°ç¡¬ç›˜ä¹Ÿåœ¨ä»¥å•ç‹¬ NSInvocationOperation å®Œæˆï¼Œé¿å…æ‹–æ…¢ä¸»çº¿ç¨‹ã€‚ SDImageCache åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œä¸€äº›æ¶ˆæ¯é€šçŸ¥ï¼Œåœ¨å†…å­˜è­¦å‘Šæˆ–é€€åˆ°åå°çš„æ—¶å€™æ¸…ç†å†…å­˜å›¾ç‰‡ç¼“å­˜ï¼Œåº”ç”¨ç»“æŸçš„æ—¶å€™æ¸…ç†è¿‡æœŸå›¾ç‰‡ã€‚ SDWI ä¹Ÿæä¾›äº† UIButton+WebCache å’Œ MKAnnotationView+WebCacheï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚ SDWebImagePrefetcher å¯ä»¥é¢„å…ˆä¸‹è½½å›¾ç‰‡ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚ å¦‚ä½•è§£å†³tableViewå¡é¡¿é—®é¢˜ï¼Œå‰é¢ä¹Ÿæäº†å¾ˆå¤šæ–¹æ¡ˆã€‚é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ•°, è®¾ç½®å½“å‰é¡µçš„cell, è€Œä¸æ˜¯æŠŠæ‰€æœ‰cellä¸€æ¬¡æ€§è®¾ç½®å®Œ, ä»¥åŠæ•°æ®å›¾ç‰‡çš„ä¸‰çº§ç¼“å­˜, ç›´æ¥ä¿å­˜åœ¨å†…å­˜ä¸­å’Œæ²™ç›’ç¼“å­˜ä¸­è¿›è¡Œè¯»å–. é™ä½ç½‘ç»œè¯·æ±‚çš„æ¬¡æ•°, ä¸ä»…èŠ‚çº¦ç”¨æˆ·æµé‡. ä¹Ÿä¼šä¿è¯tableViewæ»‘åŠ¨çš„æµç•…æ€§ SDWebImageæ€æ ·å®ç°å›¾ç‰‡çš„ç¼“å­˜æœºåˆ¶çš„ï¼Ÿ å›¾ç‰‡çš„ç¼“å­˜, å†…å­˜ç¼“å­˜, æ²™ç›’ç¼“å­˜, æ“ä½œç¼“å­˜, ä»¥tableViewControllerä¸ºä¾‹: æ¯æ¬¡celléœ€è¦æ˜¾ç¤º,éƒ½éœ€è¦é‡æ–°è°ƒç”¨- (UITableViewCell )tableView:(UITableView )tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { }æ–¹æ³• æ¯æ¬¡è°ƒç”¨tableViewæ˜¾ç¤ºè¡Œçš„æ•°æ®æºæ–¹æ³•æ—¶, å¦‚æœéœ€è¦ä»ç½‘ç»œåŠ è½½å›¾ç‰‡, å°±éœ€è¦å°†åŠ è½½å›¾ç‰‡è¿™æ ·çš„è€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸Šæ‰§è¡Œ, ä»ç½‘ç»œä¸Šä¸‹è½½çš„å›¾ç‰‡å¯ä»¥ä»¥é”®å€¼å¯¹çš„å½¢å¼ä¿å­˜åœ¨å®šä¹‰çš„å¯å˜å­—å…¸ä¸­,å°†æ¯å¼ å›¾ç‰‡çš„å”¯ä¸€çš„è·¯å¾„ä½œä¸ºé”®,å°†ä»ç½‘ç»œä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡ä½œä¸ºå€¼, ä¿å­˜åœ¨å†…å­˜ç¼“å­˜ä¸­, è¿™æ ·æ¯æ¬¡æ»‘åŠ¨tableView cellé‡ç”¨æ—¶å°±ç›´æ¥åˆ¤æ–­å†…å­˜ç¼“å­˜ä¸­æœ‰æ²¡æœ‰éœ€è¦çš„å›¾ç‰‡, å¦‚æœæœ‰å°±ä¸éœ€è¦å†æ¬¡ä¸‹è½½,åœ¨æ²¡æœ‰å‡ºç°å†…å­˜è­¦å‘Šæˆ–è€…ç¨‹åºå‘˜æ‰‹åŠ¨æ¸…ç†å†…å­˜ç¼“å­˜æ—¶, å°±ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è·å–å›¾ç‰‡. ä¸ºäº†æ¯æ¬¡é€€å‡ºç¨‹åº,å†æ¬¡è¿›å…¥ç¨‹åºæ—¶,ä¸æµªè´¹ç”¨æˆ·çš„æµé‡, éœ€è¦å°†ç¬¬ä¸€æ¬¡è¿›å…¥ç¨‹åºæ—¶åŠ è½½çš„å›¾ç‰‡ä¿å­˜åœ¨æœ¬åœ°æ²™ç›’ç¼“å­˜æ–‡ä»¶ä¸­, åœ¨æ²™ç›’ä¸­ä¿å­˜çš„å›¾ç‰‡æ•°æ®æ²¡æœ‰è¢«æ”¹å˜ä¹‹å‰,ä¸‹æ¬¡å¼€å¯ç¨‹åºå°±ç›´æ¥ä»æ²™ç›’çš„ç¼“å­˜æ–‡ä»¶ä¸­è¯»å–éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡, å¹¶å°†æ²™ç›’ç¼“å­˜æ–‡ä»¶å¤¹(Cache)ä¸­ä¿å­˜çš„å›¾ç‰‡ä¿å­˜åˆ°å†…å­˜ç¼“å­˜ä¸­, è¿™æ ·ç”¨æˆ·æ¯æ¬¡æ»‘åŠ¨tableView cellé‡ç”¨æ—¶ç›´æ¥ä»å†…å­˜ç¼“å­˜ä¸­è¯»å–è€Œä¸æ˜¯ä»æ²™ç›’ä¸­è¯»å–, èŠ‚çº¦æ—¶é—´. ä½ ç”¨è¿‡å“ªäº›ç¬¬ä¸‰æ–¹æ¡†æ¶ï¼Ÿ ä½¿ç”¨è¿‡ä¸€äº›ç¬¬ä¸‰æ–¹æ¡†æ¶, ä¾‹å¦‚AFN,SDWebimage,FMDB, MBProgressHUD, Masonryã€‚ ä½¿ç”¨ AFNetworkingåšè¿‡æ–­ç‚¹ç»­ä¼ å—ï¼Ÿ æ–­ç‚¹ç»­ä¼ çš„ä¸»è¦æ€è·¯: æ£€æŸ¥æœåŠ¡å™¨æ–‡ä»¶ä¿¡æ¯ æ£€æŸ¥æœ¬åœ°æ–‡ä»¶ å¦‚æœæ¯”æœåŠ¡å™¨æ–‡ä»¶å°, æ–­ç‚¹ç»­ä¼ , åˆ©ç”¨ HTTP è¯·æ±‚å¤´çš„ Range å®ç°æ–­ç‚¹ç»­ä¼  å¦‚æœæ¯”æœåŠ¡å™¨æ–‡ä»¶å¤§ï¼Œé‡æ–°ä¸‹è½½ å¦‚æœå’ŒæœåŠ¡å™¨æ–‡ä»¶ä¸€æ ·ï¼Œä¸‹è½½å®Œæˆ ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æ—¶å€™æœ‰æ²¡æœ‰ä»”ç»†ç ”è¯»è¿‡å®ƒä»¬çš„æºç (AFNetworking)ï¼ŸAFNåº•å±‚åŸç†åˆ†æã€‚ AFNetworkingä¸»è¦æ˜¯å¯¹NSURLSessionå’ŒNSURLCollectionï¼ˆiOS9.0åºŸå¼ƒï¼‰çš„å°è£…,å…¶ä¸­ä¸»è¦æœ‰ä»¥ä¸‹ç±»: AFHTTPRequestOperationManager :å†…éƒ¨å°è£…çš„æ˜¯ NSUrlConnection,è´Ÿè´£å‘é€ç½‘ç»œè¯·æ±‚,ä½¿ç”¨æœ€å¤šçš„ä¸€ä¸ªç±».ï¼ˆ3.0åºŸå¼ƒï¼‰ AFHTTPSessionManager :å†…éƒ¨å°è£…æ˜¯ NSUrlSession ,è´Ÿè´£å‘é€ç½‘ç»œè¯·æ±‚,ä½¿ç”¨æœ€å¤šçš„ä¸€ä¸ªç±». AFHTTPRequestOperationManager å’Œ AFHTTPSessionManager :å®šä¹‰çš„ API(æ–¹æ³•åç§°)æ˜¯ä¸€æ¨¡ä¸€æ ·,æ²¡æœ‰ä»»ä½•åŒºåˆ«. AFNetworkReachabilityManager :å®æ—¶ç›‘æµ‹ç½‘ç»œçŠ¶æ€çš„å·¥å…·ç±».å½“å‰çš„ç½‘ç»œç¯å¢ƒå‘ç”Ÿæ”¹å˜ä¹‹å,è¿™ä¸ªå·¥å…·ç±»å°±å¯ä»¥æ£€æµ‹åˆ°. AFSecurityPolicy :ç½‘ç»œå®‰å…¨çš„å·¥å…·ç±», ä¸»è¦æ˜¯é’ˆå¯¹ HTTPS æœåŠ¡. AFURLRequestSerialization :åºåˆ—åŒ–å·¥å…·ç±»,åŸºç±».ä¸Šä¼ çš„æ•°æ®è½¬æ¢æˆJSONæ ¼å¼(AFJSONRequestSerializer).ä½¿ç”¨ä¸å¤š. AFURLResponseSerialization :ååºåˆ—åŒ–å·¥å…·ç±»;åŸºç±».ä½¿ç”¨æ¯”è¾ƒå¤š: AFJSONResponseSerializer; JSONè§£æå™¨,é»˜è®¤çš„è§£æå™¨. AFHTTPResponseSerializer; ä¸‡èƒ½è§£æå™¨; JSONå’ŒXMLä¹‹å¤–çš„æ•°æ®ç±»å‹,ç›´æ¥è¿”å›äºŒè¿›åˆ¶æ•°æ®.å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®ä¸åšä»»ä½•å¤„ç†. AFXMLParserResponseSerializer; XMLè§£æå™¨; AFNé»˜è®¤è¶…æ—¶æ—¶é•¿æ˜¯å¤šå°‘å•Š? AFNçš„é»˜è®¤è¶…æ—¶æ—¶é•¿æ˜¯60s. ä¸¾å‡º5ä¸ªä»¥ä¸Šä½ æ‰€ç†Ÿæ‚‰çš„iOS sdkåº“æœ‰å“ªäº›å’Œç¬¬ä¸‰æ–¹åº“æœ‰å“ªäº›?1&gt; iOS-sdk: Foundation.framework, CoreGraphics.framework, UIKit.framework, MediaPlayer.framework, CoreAudio.framework 2&gt; ç¬¬ä¸‰æ–¹åº“: 1.AFNetWoring 2.SDWebImage 3.masonry 4.MBProgressHUD 3&gt; æ¡†æ¶åˆ†ç±»: éŸ³é¢‘å’Œè§†é¢‘ Core Audio OpenAL Media Library AVFoundation æ•°æ®ç®¡ç† Core Data SQLite å›¾ç‰‡å’ŒåŠ¨ç”» Core Animation OpenGL ES Quartz 2D ç½‘ç»œ Bonjour WebKit BSD Sockets ç”¨æˆ·åº”ç”¨ Address Book Core Location Map Kit Store Kit ç¬¬ä¸‰æ–¹APIæ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ å¤§å…¬å¸çš„å¼€æ”¾API,githubä¸Šé¢åˆ«äººå‘å¸ƒçš„æ¡†æ¶ç”¨ç¬¬ä¸‰æ–¹API, åœ¨å®˜æ–¹æ–‡æ¡£éƒ½æœ‰è¯´æ˜ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„ä¸€æ­¥ä¸€æ­¥åšå‚è€ƒå®˜æ–¹æä¾›çš„ç¤ºä¾‹ç¨‹åºã€‚å…ˆè‡ªå·±åˆ›å»ºä¸€ä¸ªå·¥ç¨‹è¯•è¯•ï¼Œç­‰ç†Ÿæ‚‰äº†ï¼Œåœ¨ä½¿ç”¨åˆ°é¡¹ç›®ä¸­ å®ç°è¿‡æ¡†æ¶æˆ–è€…åº“ä»¥ä¾›ä»–äººä½¿ç”¨ä¹ˆï¼Ÿå¦‚æœæœ‰ï¼Œè¯·è°ˆä¸€è°ˆæ„å»ºæ¡†æ¶æˆ–è€…åº“æ—¶å€™çš„ç»éªŒï¼›å¦‚æœæ²¡æœ‰ï¼Œè¯·è®¾æƒ³å’Œè®¾è®¡æ¡†æ¶çš„publicçš„APIï¼Œå¹¶æŒ‡å‡ºå¤§æ¦‚éœ€è¦å¦‚ä½•åšã€éœ€è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Œä»¥ä½¿äººäººæ›´å®¹æ˜“åœ°ä½¿ç”¨ä½ çš„æ¡†æ¶ã€‚ä»ä»¥ä¸‹è§’åº¦å‡ºå‘æ¥æ€è€ƒå’Œè®¾è®¡å…¬å…±æ¡†æ¶ï¼š â€¢ ç¡®ä¿å¤–éƒ¨è°ƒç”¨ç®€å•ï¼Œä¸”ä¿è¯æœ‰è¯¦ç»†çš„å¤´æ–‡ä»¶æ³¨é‡Šè¯´æ˜ã€‚ â€¢ ç¡®ä¿APIç¼–ç è§„èŒƒï¼Œä¿è¯é£æ ¼ç»Ÿä¸€ã€‚ â€¢ ç¡®ä¿APIæ˜“æ‰©å±•ï¼Œå¯ä»¥è€ƒè™‘é¢„ç•™å‚æ•° â€¢ ç¡®ä¿æ²¡æœ‰å¤–éƒ¨ä¾èµ–æˆ–è€…ä¾èµ–è¦å°½å¯èƒ½çš„å°‘ï¼Œä»¥ä¿è¯å…¬å…±åº“çš„çº¯æ´ï¼ˆåŸåˆ™ä¸Šä¸èƒ½æœ‰å¤–éƒ¨ä¾èµ–ï¼‰ â€¢ ç¡®ä¿æ˜“ç»´æŠ¤ï¼Œä¸å­˜åœ¨å†—ä½™API ç®€è¿°ä¸‹è‹¹æœçš„å¼€å‘æ¡†æ¶ï¼ŸFoundation æä¾›OCçš„åŸºç¡€ç±»ï¼ˆåƒNSObjectï¼‰ã€åŸºæœ¬æ•°æ®ç±»å‹ç­‰ UIKit åˆ›å»ºå’Œç®¡ç†åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ QuartzCore æä¾›åŠ¨ç”»ç‰¹æ•ˆä»¥åŠé€šè¿‡ç¡¬ä»¶è¿›è¡Œæ¸²æŸ“çš„èƒ½åŠ› CoreGraphics æä¾›2Dç»˜åˆ¶çš„åŸºäºCçš„API SystemConfiguration æ£€æµ‹å½“å‰ç½‘ç»œæ˜¯å¦å¯ç”¨å’Œç¡¬ä»¶è®¾å¤‡çŠ¶æ€ AVFoundation æä¾›éŸ³é¢‘å½•åˆ¶å’Œå›æ”¾çš„åº•å±‚APIï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£ç®¡ç†éŸ³é¢‘ç¡¬ä»¶ CFNetwork è®¿é—®å’Œé…ç½®ç½‘ç»œï¼ŒåƒHTTPã€FTPå’ŒBonjour Services CoreFoundation æä¾›æŠ½è±¡çš„å¸¸ç”¨æ•°æ®ç±»å‹ï¼Œå¦‚Unicode stringsã€XMLã€URLç­‰ CoreLocation ä½¿ç”¨GPSå’ŒWIFIè·å–ä½ç½®ä¿¡æ¯]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜10--æŠ¥é”™è­¦å‘Šè°ƒè¯•]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%9810-%E6%8A%A5%E9%94%99%E8%AD%A6%E5%91%8A%E8%B0%83%E8%AF%95%2F</url>
    <content type="text"><![CDATA[ä½ åœ¨å®é™…å¼€å‘ä¸­ï¼Œæœ‰å“ªäº›æ‰‹æœºæ¶æ„ä¸æ€§èƒ½è°ƒè¯•ç»éªŒ åˆšæ¥æ‰‹å…¬å¸çš„æ—§é¡¹ç›®æ—¶ï¼Œæ¨¡å—ç‰¹åˆ«å¤šï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰çš„ä»£ç éƒ½å†™åœ¨æ§åˆ¶å™¨é‡Œé¢ï¼Œæ¯”å¦‚UIæ§ä»¶ä»£ç ã€ç½‘ç»œè¯·æ±‚ä»£ç ã€æ•°æ®å­˜å‚¨ä»£ç  æ¥ä¸‹æ¥é‡‡å–MVCæ¨¡å¼è¿›è¡Œå°è£…ã€é‡æ„ è‡ªå®šä¹‰UIæ§ä»¶å°è£…å†…éƒ¨çš„ä¸šåŠ¡é€»è¾‘ å°è£…ç½‘ç»œè¯·æ±‚å·¥å…·ç±»(é™ä½è€¦åˆ) å°è£…æ•°æ®å­˜å‚¨å·¥å…·ç±» BAD_ACCESSåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°ï¼Ÿè¿™ç§é—®é¢˜æ˜¯ç»å¸¸é‡åˆ°çš„ï¼Œåœ¨å¼€å‘æ—¶ç»å¸¸ä¼šå‡ºç°BAD_ACCESSã€‚åŸå› æ˜¯è®¿é—®äº†é‡æŒ‡é’ˆï¼Œæ¯”å¦‚è®¿é—®å·²ç»é‡Šæ”¾å¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–è€…å‘æ¶ˆæ¯ã€æ­»å¾ªç¯ç­‰ã€‚ å¦‚ä½•è°ƒè¯•BAD_ACCESSé”™è¯¯ï¼Ÿå‡ºç°BAD_ACCESSé”™è¯¯ï¼Œé€šå¸¸æ˜¯è®¿é—®äº†é‡æŒ‡é’ˆï¼Œæ¯”å¦‚è®¿é—®äº†å·²ç»é‡Šæ”¾äº†çš„å¯¹è±¡ã€‚å¿«é€Ÿå®šä½é—®é¢˜çš„æ­¥éª¤æœ‰ï¼š 1. é‡å†™å¯¹è±¡çš„respondsToSelectoræ–¹æ³•ï¼Œå…ˆæ‰¾åˆ°å‡ºç°EXECBADACCESSå‰è®¿é—®çš„æœ€åä¸€ä¸ªobject 2. è®¾ç½®Enable Zombie Objects 3. è®¾ç½®å…¨å±€æ–­ç‚¹å¿«é€Ÿå®šä½é—®é¢˜ä»£ç æ‰€åœ¨è¡Œï¼Œæ¥æ”¶æ‰€æœ‰çš„å¼‚å¸¸ 4. Xcode7å·²ç»é›†æˆäº†BAD_ACCESSæ•è·åŠŸèƒ½ï¼šAddress Sanitizerï¼Œä¸æ­¥éª¤2ä¸€æ ·è®¾ç½® 5. analyzeä¹Ÿè¡Œï¼ˆä¸ä¸€å®šç®¡ç”¨ï¼‰ ä»€ä¹ˆæ—¶å€™ä¼šæŠ¥ unrecognized selector å¼‚å¸¸ï¼Ÿ å½“è°ƒç”¨å¯¹è±¡ï¼ˆå­ç±»ï¼Œå„çº§çˆ¶ç±»ï¼‰ä¸­ä¸å«æœ‰å¯¹åº”æ–¹æ³•çš„æ—¶å€™ï¼Œå¹¶ä¸”ä¾æ—§æ²¡æœ‰ç»™å‡ºâ€œæ¶ˆæ¯è½¬å‘â€çš„å…·ä½“æ–¹æ¡ˆçš„æ—¶å€™ï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šcrashå¹¶æŠ›å‡º unrecognized selector å¼‚å¸¸ objective-c ä¸­çš„æ¯ä¸ªæ–¹æ³•åœ¨è¿è¡Œæ—¶ä¼šè¢«è½¬ä¸ºæ¶ˆæ¯å‘é€objc_msgSend(reciver, selector) ä¾‹å¦‚ [person say]å°±ä¼šè¢«è½¬åŒ–ä¸º objc_msgSend(person, @selector(say)) è¿è¡Œæ—¶ä¼šæ ¹æ®å¯¹è±¡(reciever) çš„isa æŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„ç±»ï¼Œç„¶åä¼šä¾æ¬¡åœ¨å¯¹åº”çš„ç±»ï¼Œçˆ¶ç±»ï¼Œçˆ·çˆ·ç±»ï¼Œæ ¹ç±»ä¸­æ‰¾å¯¹åº”çš„æ–¹æ³• ä¸‹é¢åªè®²è¿°å¯¹è±¡æ–¹æ³•çš„è§£æè¿‡ç¨‹ï¼š ç¬¬ä¸€æ­¥ï¼š+ (BOOL)resolveInstanceMethod:(SEL)selå®ç°æ–¹æ³•ï¼ŒæŒ‡å®šæ˜¯å¦åŠ¨æ€æ·»åŠ æ–¹æ³•ã€‚è‹¥è¿”å›NOï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ï¼Œè‹¥è¿”å›YESï¼Œåˆ™é€šè¿‡class_addMethodå‡½æ•°åŠ¨æ€åœ°æ·»åŠ æ–¹æ³•ï¼Œæ¶ˆæ¯å¾—åˆ°å¤„ç†ï¼Œæ­¤æµç¨‹å®Œæ¯•ã€‚ ç¬¬äºŒæ­¥ï¼šåœ¨ç¬¬ä¸€æ­¥è¿”å›çš„æ˜¯NOæ—¶ï¼Œå°±ä¼šè¿›å…¥- (id)forwardingTargetForSelector:(SEL)aSelectoræ–¹æ³•ï¼Œè¿™æ˜¯è¿è¡Œæ—¶ç»™æˆ‘ä»¬çš„ç¬¬äºŒæ¬¡æœºä¼šï¼Œç”¨äºæŒ‡å®šå“ªä¸ªå¯¹è±¡å“åº”è¿™ä¸ªselectorã€‚ä¸èƒ½æŒ‡å®šä¸ºselfã€‚è‹¥è¿”å›nilï¼Œè¡¨ç¤ºæ²¡æœ‰å“åº”è€…ï¼Œåˆ™ä¼šè¿›å…¥ç¬¬ä¸‰æ­¥ã€‚è‹¥è¿”å›æŸä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ã€‚ ç¬¬ä¸‰æ­¥ï¼šè‹¥ç¬¬äºŒæ­¥è¿”å›çš„æ˜¯nilï¼Œåˆ™æˆ‘ä»¬é¦–å…ˆè¦é€šè¿‡- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelectoræŒ‡å®šæ–¹æ³•ç­¾åï¼Œè‹¥è¿”å›nilï¼Œåˆ™è¡¨ç¤ºä¸å¤„ç†ã€‚è‹¥è¿”å›æ–¹æ³•ç­¾åï¼Œåˆ™ä¼šè¿›å…¥ä¸‹ä¸€æ­¥ã€‚ ç¬¬å››æ­¥ï¼šå½“ç¬¬ä¸‰æ­¥è¿”å›æ–¹æ³•æ–¹æ³•ç­¾ååï¼Œå°±ä¼šè°ƒç”¨- (void)forwardInvocation:(NSInvocation *)anInvocationæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡anInvocationå¯¹è±¡åšå¾ˆå¤šå¤„ç†ï¼Œæ¯”å¦‚ä¿®æ”¹å®ç°æ–¹æ³•ï¼Œä¿®æ”¹å“åº”å¯¹è±¡ç­‰ ç¬¬äº”æ­¥ï¼šè‹¥æ²¡æœ‰å®ç°- (void)forwardInvocation:(NSInvocation *)anInvocationæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šè¿›å…¥- (void)doesNotRecognizeSelector:(SEL)aSelectoræ–¹æ³•ã€‚è‹¥æˆ‘ä»¬æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šcrashï¼Œç„¶åæç¤ºæ‰“ä¸åˆ°å“åº”çš„æ–¹æ³•ã€‚åˆ°æ­¤ï¼ŒåŠ¨æ€è§£æçš„æµç¨‹å°±ç»“æŸäº†ã€‚ æœ‰å“ªäº›å¸¸è§çš„ Crash åœºæ™¯ï¼Ÿ è®¿é—®äº†åƒµå°¸å¯¹è±¡ è®¿é—®äº†ä¸å­˜åœ¨çš„æ–¹æ³• æ•°ç»„è¶Šç•Œ åœ¨å®šæ—¶å™¨ä¸‹ä¸€æ¬¡å›è°ƒå‰å°†å®šæ—¶å™¨é‡Šæ”¾,ä¼šCrash lldbï¼ˆgdbï¼‰å¸¸ç”¨çš„è°ƒè¯•å‘½ä»¤ï¼Ÿâ€¢ p è¾“å‡ºåŸºæœ¬ç±»å‹//p (int)[[[self view] subviews] count] â€¢ po ç”¨äºè¾“å‡º Objective-C å¯¹è±¡//po [self view] â€¢ expr å¯ä»¥åœ¨è°ƒè¯•æ—¶åŠ¨æ€æ‰§è¡ŒæŒ‡å®šè¡¨è¾¾å¼ï¼Œå¹¶å°†ç»“æœæ‰“å°å‡ºæ¥ã€‚å¸¸ç”¨äºåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ä¿®æ”¹å˜é‡çš„å€¼ã€‚//æºä»£ç ä¸­ a = 1 ï¼›expr a=2 è¾“å‡ºç»“æœï¼š(int) $0 = 2 å¦‚æœä¸€ä¸ªå‡½æ•°10æ¬¡ä¸­æœ‰7æ¬¡æ­£ç¡®ï¼Œ3æ¬¡é”™è¯¯ï¼Œé—®é¢˜å¯èƒ½å‡ºç°åœ¨å“ªé‡Œï¼Ÿè¿™æ ·çš„é—®é¢˜é€šè¿‡åº”è˜è€…çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“åº”è˜è€…çš„åŠŸåº•å¦‚ä½•ã€‚å¾ˆå¤šäººçš„å›ç­”ä¼šæ˜¯å¾ˆç®€å•çš„ï¼Œæ²¡æœ‰ä»å¤šæ–¹é¢å»åˆ†æã€‚è¿™æ ·çš„é—®é¢˜ä¹Ÿæ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œåœ¨é¡¹ç›®å¼€å‘ä¸­æ‰€äº§ç”Ÿçš„bugï¼Œæœ‰çš„æ—¶å€™ä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œè€Œä»£ç é‡æ¯”è¾ƒå¤§ä¸”ä¸šåŠ¡æ¯”è¾ƒå¤æ‚æ—¶ï¼Œé€šè¿‡å…¶ä»–å·¥å…·å¹¶ä¸èƒ½åˆ†æå‡ºæ¥æ˜¯ä»€ä¹ˆbugï¼Œä½†æ˜¯æˆ‘ä»¬å´å¯ä»¥æ ¹æ®å‡ºç°çš„é¢‘ç‡æ¨æµ‹ã€‚ç¬”è€…æŠŠè¿™ä¸ªé—®é¢˜å½“ä½œæµ‹è¯•éƒ¨åé¦ˆè¿‡æ¥çš„bugæè¿°é—®é¢˜æ¥åˆ†æä¸€ä¸‹ã€‚ å‚è€ƒç­”æ¡ˆï¼š ä»é—®é¢˜æè¿°å¯çŸ¥ï¼Œbugä¸ä¼šå¿…ç°çš„ï¼Œå› æ­¤æ— æ³•ç›´æ¥å®šä½å‡ºé”™ä¹‹å¤„ã€‚ä»ä»¥ä¸‹è§’åº¦å‡ºç°æ¥åˆ†æå¯èƒ½å‡ºé”™ä¹‹å¤„ï¼š 1. å› å‡ºé”™å¹¶ä¸æ˜¯å´©æºƒï¼Œå› æ­¤æ²¡æœ‰é”™è¯¯æ—¥å¿—å¯çœ‹ã€‚ç¬¬ä¸€æ­¥å°±æ˜¯åˆ†æå‡½æ•°ä¸­çš„æ‰€æœ‰åˆ†æ”¯ï¼Œæ˜¯å¦åœ¨è¯­æ³•ä¸Šå­˜åœ¨å¯èƒ½ç¼ºå°‘æ¡ä»¶çš„é—®é¢˜ã€‚æ‰€ä»¥ï¼Œæ£€æŸ¥æ‰€æœ‰çš„åˆ†æ”¯ï¼Œç¡®ä¿æ¯ä¸ªåˆ†æ”¯æ‰§è¡Œçš„ç»“æœçš„æ­£ç¡®çš„ 2. æ£€æµ‹å‡½æ•°çš„å‚æ•°ï¼Œä¿è¯å¿…ä¼ å‚æ•°ä¸èƒ½ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚å› æ­¤ï¼Œç”¨æ–­è¨€æ£€æµ‹å‚æ•°çš„æ­£ç¡®æ€§æ˜¯å¾ˆé‡è¦çš„ã€‚ 3. æ£€æµ‹å‡½æ•°ä¸­æ¯ä¸ªåˆ†æ”¯æ‰€è°ƒç”¨çš„å‡½æ•°è¿”å›ç»“æœæ˜¯æ­£ç¡®çš„ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼ˆæ­¥éª¤1ã€2ï¼‰ ä½ ä¸€èˆ¬æ˜¯å¦‚ä½•è°ƒè¯•Bugçš„ï¼Ÿè¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥å¾ˆç¬¼ç»Ÿï¼Œä½†åˆä¸€é’ˆè§è¡€ã€‚é€šè¿‡åº”è˜è€…çš„å›ç­”ï¼Œå¯å¾ˆç›´è§‚åœ°çœ‹å‡ºè¿™ä¸ªåº”è˜è€…çš„å¤„ç†bugçš„èƒ½åŠ›ï¼Œä»¥åŠå…¶è§£å†³é—®é¢˜çš„æ€ç»´ã€‚ å‚è€ƒç­”æ¡ˆï¼š Bugåˆ†ä¸ºæµ‹è¯•ä¸­çš„Bugå’Œçº¿ä¸Šçš„Bugï¼š â€¢ çº¿ä¸ŠBugï¼šé¡¹ç›®ä½¿ç”¨äº†å‹ç›Ÿç»Ÿè®¡ï¼Œå› æ­¤ä¼šæœ‰å´©æºƒæ—¥å¿—ï¼Œé€šè¿‡è§£ædYSMå¯ä»¥ç›´æ¥å®šä½åˆ°å¤§éƒ¨åˆ†bugå´©æºƒä¹‹å¤„ã€‚è§£å†³çº¿ä¸Šbugéœ€è¦ä»ä¸»å¹²æ‹‰ä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œè§£å†³bugå¹¶æµ‹è¯•é€šè¿‡åï¼Œå†åˆå¹¶åˆ°ä¸»å¹²ï¼Œç„¶åä¸Šçº¿ã€‚è‹¥æ˜¯å¤šå›¢é˜Ÿå¼€å‘ï¼Œå¯ä»¥å°†fix bugåˆ†æ”¯ä¸å…¶ä»–å›¢é˜Ÿæœ€è¿‘è¦ä¸Šçº¿çš„åˆ†æ”¯é›†æˆï¼Œç„¶åé›†æˆæµ‹è¯•å†ä¸Šçº¿ã€‚ â€¢ æµ‹è¯•Bugï¼šæ ¹æ®æµ‹è¯•æ‰€åé¦ˆçš„bugæè¿°ï¼Œè‹¥è¯­ä¹‰ä¸æ¸…æ™°ï¼Œåˆ™ç›´æ¥æ‰¾åˆ°æbugäººï¼Œæ“ä½œç»™å¼€å‘äººå‘˜çœ‹ï¼Œæœ€å¥½æ˜¯å¯ä»¥bugå¤ç°ã€‚è§£å†³bugæ—¶ï¼Œè‹¥èƒ½æ ¹æ®æè¿°ç›´æ¥å®šä½bugå‡ºé”™ä¹‹å¤„ï¼Œåˆ™å¥½å¤„ç†ï¼›è‹¥æ— æ³•ç›´è§‚å®šä½ï¼Œåˆ™æ ¹æ®bugç±»å‹åˆ†å‡ ç§å¤„ç†æ–¹å¼ï¼Œæ¯”å¦‚å´©æºƒçš„bugå¯ä»¥é€šè¿‡instrumentsæ¥æ£€æµ‹ã€æ•°æ®æ˜¾ç¤ºé”™è¯¯çš„bugï¼Œåˆ™éœ€è¦é˜…è¯»ä»£ç ä¸€æ­¥æ­¥æŸ¥çœ‹é€»è¾‘å“ªé‡Œå†™é”™ã€‚ å¯¹äºå¼€å‘ä¸­å‡ºç°çš„å´©æºƒæˆ–è€…æ•°æ®æ˜¾ç¤ºä¸æ­£å¸¸ï¼Œé‚£å°±éœ€è¦æ ¹æ®ç»éªŒæˆ–è€…ç›¸å…³å·¥å…·æ¥æ£€æµ‹å¯èƒ½å‡ºé”™ä¹‹å¤„ã€‚å½“ç„¶ï¼Œå›¢é˜Ÿå†…æ²Ÿé€šè§£å†³æ˜¯æœ€å¥½çš„ã€‚ è·å–ä¸€å°è®¾å¤‡å”¯ä¸€æ ‡è¯†çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ ç°åœ¨å¸¸ç”¨çš„æ˜¯ç”¨UUID + keychainç»“åˆæ¥å®ç°è¿™ä¸ªéœ€æ±‚ã€‚ UUIDæ˜¯Universally Unique Identifierçš„ç¼©å†™ï¼Œä¸­æ–‡æ„æ€æ˜¯é€šç”¨å”¯ä¸€è¯†åˆ«ç ã€‚å®ƒæ˜¯è®©åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œéƒ½èƒ½æœ‰å”¯ä¸€çš„è¾¨è¯†èµ„è®¯ï¼Œè€Œä¸éœ€è¦é€è¿‡ä¸­å¤®æ§åˆ¶ç«¯æ¥åšè¾¨è¯†èµ„è®¯çš„æŒ‡å®šã€‚è¿™æ ·ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥å»ºç«‹ä¸ä¸å…¶å®ƒäººå†²çªçš„ UUIDã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå°±ä¸éœ€è€ƒè™‘æ•°æ®åº“å»ºç«‹æ—¶çš„åç§°é‡å¤é—®é¢˜ã€‚è‹¹æœå…¬å¸å»ºè®®ä½¿ç”¨UUIDä¸ºåº”ç”¨ç”Ÿæˆå”¯ä¸€æ ‡è¯†å­—ç¬¦ä¸²ã€‚ //è·å–ä¸€ä¸ªUUID - (NSString*)uuid { CFUUIDRef uuid = CFUUIDCreate( nil ); CFStringRef uuidString = CFUUIDCreateString( nil, uuid ); NSString * result = (NSString *)CFBridgingRelease(CFStringCreateCopy( NULL, uuidString)); CFRelease(uuid); CFRelease(uuidString); return result; } ç°åœ¨æˆ‘ä»¬è·å–åˆ°äº†ä¸€ä¸ªUUIDï¼Œè™½ç„¶è¿™ä¸ªæ ‡è¯†æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¿™æ ·è¿˜æ˜¯æ— æ³•ä¿è¯æ¯ä¸€æ¬¡çš„å”¯ä¸€æ€§ï¼Œå› ä¸ºå½“ä½ æ¯æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æˆ–è€…æŠŠåº”ç”¨å¸è½½äº†ï¼ŒUUIDä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªä¸åŒçš„ã€‚è¿™ä¸ªæ—¶å€™keychainå°±èµ·åˆ°äº†ä½œç”¨ã€‚ æ‰€ä»¥æ•´ä¸ªé€»è¾‘æ˜¯è¿™æ ·çš„ï¼šå…ˆä»keychainå–UUIDï¼Œå¦‚æœèƒ½å–åˆ°ï¼Œå°±ç”¨è¿™ä¸ªæ¯”å¯¹ï¼Œå¦‚æœå–ä¸åˆ°å°±é‡æ–°ç”Ÿæˆä¸€ä¸ªä¿å­˜èµ·æ¥ã€‚keychainç‹¬ç«‹åœ¨Appä¹‹å¤–ï¼Œæ˜¯å’Œç³»ç»Ÿç»Ÿä¸€ç­‰çº§çš„ï¼Œæ‰€ä»¥ä½ ä¸ç”¨æ‹…å¿ƒå®ƒæŒ‚æ‰ã€‚ keychainæ˜¯è‹¹æœå…¬å¸Mac OSä¸­çš„å¯†ç ç®¡ç†ç³»ç»Ÿã€‚å®ƒåœ¨Mac OS 8.6ä¸­è¢«å¯¼å…¥ï¼Œå¹¶ä¸”åŒ…æ‹¬åœ¨äº†æ‰€æœ‰åç»­çš„Mac OSç‰ˆæœ¬ä¸­ï¼ŒåŒ…æ‹¬Mac OS Xã€‚ä¸€ä¸ªé’¥åŒ™ä¸²å¯ä»¥åŒ…å«å¤šç§ç±»å‹çš„æ•°æ®ï¼šå¯†ç ï¼ˆåŒ…æ‹¬ç½‘ç«™ï¼ŒFTPæœåŠ¡å™¨ï¼ŒSSHå¸æˆ·ï¼Œç½‘ç»œå…±äº«ï¼Œæ— çº¿ç½‘ç»œï¼Œç¾¤ç»„è½¯ä»¶ï¼ŒåŠ å¯†ç£ç›˜é•œåƒç­‰ï¼‰ï¼Œç§é’¥ï¼Œç”µå­è¯ä¹¦å’ŒåŠ å¯†ç¬”è®°ç­‰ã€‚iOSç«¯åŒæ ·æœ‰ä¸ªkeychainå¸®åŠ©æˆ‘ä»¬ç®¡ç†è¿™äº›æ•æ„Ÿä¿¡æ¯ã€‚ ä½¿ç”¨è¿‡keychainä¿å­˜è¿‡è´¦å·å¯†ç çš„ç«¥é‹åº”è¯¥å¯¹è¿™ä¸ªå·¥å…·éå¸¸äº†è§£ï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šã€‚ä½¿ç”¨keychainéœ€è¦å¯¼å…¥Security.frameworkå’ŒKeychainItemWrapper.h/.mï¼ŒKeychainItemWrapper.h/.mæœä¸€ä¸‹å¯ä»¥ä¸‹è½½ä¸‹æ¥ï¼Œæ‹–å…¥å·¥ç¨‹ä¸­ã€‚ä¿å­˜UUIDä»£ç å¦‚ä¸‹ï¼š - (void)saveUuidWithKeyChain { KeychainItemWrapper *keychainItem = [[KeychainItemWrapper alloc] initWithIdentifier:@"UUID" accessGroup:@"com.xxx.www"]; NSString *strUUID = [keychainItem objectForKey:(id)kSecValueData]; if (strUUID == nil || [strUUID isEqualToString:@""]) { [keychainItem setObject:[self uuid] forKey:(id)kSecValueData]; } } æ³¨ï¼šè¿™ä¸ªæ–¹æ³•ä¸­accessGroup:è¿™ä¸ªå‚æ•°å¦‚æœä¸€äº›Appè®¾ç½®ç›¸åŒçš„è¯ï¼Œæ˜¯å¯ä»¥å…±äº«çš„ã€‚ ä»keychainè·å–UUIDçš„æ–¹æ³•å¦‚ä¸‹ï¼š - (NSString *)getKeychain { KeychainItemWrapper *keychainItem = [[KeychainItemWrapper alloc] initWithIdentifier:@"UUID" accessGroup:@"com.xxx.www"]; NSString *strUUID = [keychainItem objectForKey:(id)kSecValueData]; return strUUID; } è‡³æ­¤ï¼ŒåŸºæœ¬ä¸Šå”¯ä¸€æ ‡è¯†çš„å‡ ä¸ªæ–¹æ³•ç®—æ˜¯å†™å®Œäº†ï¼Œå¤§å®¶å¯ä»¥æµ‹è¯•ä¸€ä¸‹ï¼Œå¸è½½åº”ç”¨å†é‡æ–°è£…ï¼Œä»keychainè¯»å–çš„UUIDè¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ã€‚ ä½†è¿™é‡Œæœ‰ä¸ªä¸ç¡®å®šå› ç´ ï¼Œå°±æ˜¯æ‰‹æœºç³»ç»Ÿæ¢å¤å‡ºå‚è®¾ç½®æˆ–è€…æŠ¹æ‰æ‰€æœ‰æ•°æ®çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿå¯èƒ½ä¸èµ·ä½œç”¨äº†ï¼Œå› ä¸ºå®ƒæ˜¯ä¾é é’¥åŒ™ä¸²åœ¨ç”Ÿå­˜ï¼Œé’¥åŒ™ä¸²æŒ‚æ‰çš„è¯å®ƒä¹Ÿå°±å¤±æ•ˆäº†ã€‚ ä½ ä¸€èˆ¬æ˜¯æ€ä¹ˆç”¨ Instruments çš„ï¼Ÿ è¿™ä¸ªé—®é¢˜ä¹Ÿå°±æ˜¯è€ƒå¯Ÿä¸‹ä½ ç»éªŒå¦‚ä½•äº†, Instrumentsé‡Œé¢å·¥å…·å¾ˆå¤š,ä¹Ÿæ²¡å¿…è¦é€ä¸€è¯´æ˜,æŒ‘å‡ ä¸ªå¸¸ç”¨çš„è¯´ä¸‹å°±å¥½ å‚è€ƒç­”æ¡ˆ: Time Profiler:æ€§èƒ½åˆ†æ Zombies:æ£€æŸ¥æ˜¯å¦è®¿é—®äº†åƒµå°¸å¯¹è±¡,ä½†æ˜¯è¿™ä¸ªå·¥å…·åªèƒ½ä»ä¸Šå¾€ä¸‹æ£€æŸ¥,ä¸æ™ºèƒ½ Allocations:ç”¨æ¥æ£€æŸ¥å†…å­˜,å†™ç®—æ³•çš„é‚£æ‰¹äººä¹Ÿç”¨è¿™ä¸ªæ¥æ£€æŸ¥ Leaks:æ£€æŸ¥å†…å­˜,çœ‹æ˜¯å¦æœ‰å†…å­˜æ³„éœ² ä½ ä¸€èˆ¬æ˜¯å¦‚ä½•è°ƒè¯• Bug çš„ï¼Ÿ æŸ¥çœ‹å¼‚å¸¸æŠ¥å‘Š é…ç½®ç›¸å…³ç¯å¢ƒï¼Œé‡ç°bug ä»£ç æ£€æŸ¥ ç”¨æµ‹è¯•æ¡ˆä¾‹æ¥æ•è·bug å¯ä»¥è¯·åŒäº‹ä¸€åŒæ¥å®¡æŸ¥é—®é¢˜ï¼Œæœ‰äº›æ—¶å€™å½“å±€è€…è¿·ï¼Œæ—è§‚è€…æ¸…ã€‚ å¦‚ä½•å¯¹iOSè®¾å¤‡è¿›è¡Œæ€§èƒ½æµ‹è¯•?Profile-&gt; Instruments -&gt;Time Profiler è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼ æµ‹è¯•iOSç‰ˆçš„ App æ³¨æ„äº‹é¡¹åˆ†äº«ä»¥ä¸‹å‡ ç‚¹ï¼š 1.appä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ¥å¬ç”µè¯ã€‚å¯ä»¥æµ‹è¯•ä¸åŒçš„é€šè¯æ—¶é—´çš„é•¿çŸ­ï¼Œå¯¹äºé€šè¯ç»“æŸåï¼ŒåŸå…ˆæ‰“å¼€çš„appçš„å“åº”ï¼Œæ¯”å¦‚æ˜¯å¦åœç•™åœ¨åŸå…ˆç•Œé¢ï¼Œç»§ç»­æ“ä½œæ—¶çš„ç›¸åº”é€Ÿåº¦ç­‰ã€‚ 2.appä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰æ¨é€æ¶ˆæ¯æ—¶ï¼Œå¯¹appçš„ä½¿ç”¨å½±å“ 3.è®¾å¤‡åœ¨å……ç”µæ—¶ï¼Œappçš„å“åº”ä»¥åŠæ“ä½œæµç•…åº¦ 4.è®¾å¤‡åœ¨ä¸åŒç”µé‡æ—¶(ä½äº10%ï¼Œ50%ï¼Œ95%)ï¼Œappçš„å“åº”ä»¥åŠæ“ä½œæµç•…åº¦ 5.æ„å¤–æ–­ç”µæ—¶ï¼Œappæ•°æ®ä¸¢å¤±æƒ…å†µ 6.ç½‘ç»œç¯å¢ƒå˜åŒ–æ—¶ï¼Œappçš„åº”å¯¹æƒ…å†µå¦‚ä½•ï¼šæ˜¯å¦æœ‰é€‚å½“æç¤º?ä»æœ‰ç½‘ç»œç¯å¢ƒåˆ°æ— ç½‘ç»œç¯å¢ƒæ—¶ï¼Œappçš„åé¦ˆå¦‚ä½•?ä»æ— ç½‘ç»œç¯å¢ƒå›åˆ°æœ‰ç½‘ç»œç¯å¢ƒæ—¶ï¼Œæ˜¯å¦èƒ½è‡ªåŠ¨åŠ è½½æ•°æ®ï¼Œå¤šä¹…æ‰èƒ½å¼€å§‹åŠ è½½æ•°æ® 7.å¤šç‚¹è§¦æ‘¸çš„æƒ…å†µ 8.è·Ÿå…¶ä»–appä¹‹é—´äº’ç›¸åˆ‡æ¢æ—¶çš„å“åº” 9.è¿›ç¨‹å…³é—­å†é‡æ–°æ‰“å¼€çš„åé¦ˆ 10.IOSç³»ç»Ÿè¯­è¨€ç¯å¢ƒå˜åŒ–æ—¶]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜9--UI]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%989-UI%2F</url>
    <content type="text"><![CDATA[viewcontrollerçš„ä¸€äº›æ–¹æ³•çš„è¯´æ˜viewDidLoad,viewWillDisappear, viewWillAppearæ–¹æ³•çš„ é¡ºåºå’Œä½œç”¨ï¼ŸviewWillAppear:è§†å›¾å³å°†å¯è§æ—¶è°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸æ‰§è¡Œä»»ä½•æ“ä½œ viewDidAppear:è§†å›¾å·²å®Œå…¨è¿‡æ¸¡åˆ°å±å¹•ä¸Šæ—¶è°ƒç”¨ viewWillDisappear:è§†å›¾è¢«é©³å›æ—¶è°ƒç”¨ï¼Œè¦†ç›–æˆ–ä»¥å…¶ä»–æ–¹å¼éšè—ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸æ‰§è¡Œä»»ä½•æ“ä½œ viewDidDisappear:è§†å›¾è¢«é©³å›åè°ƒç”¨ï¼Œè¦†ç›–æˆ–ä»¥å…¶ä»–æ–¹å¼éšè—ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸æ‰§è¡Œä»»ä½•æ“ä½œloadView; .è¿™æ˜¯å½“ä»–ä»¬æ²¡æœ‰æ­£åœ¨ä½¿ç”¨nibè§†å›¾é¡µé¢ï¼Œå­ç±»å°†ä¼šåˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰è§†å›¾å±‚ã€‚ç»ä¸èƒ½ç›´æ¥è°ƒç”¨ã€‚ viewDidLoad:åœ¨è§†å›¾åŠ è½½åè¢«è°ƒç”¨ï¼Œå¦‚æœæ˜¯åœ¨ä»£ç ä¸­åˆ›å»ºçš„è§†å›¾åŠ è½½å™¨ï¼Œä»–å°†ä¼šåœ¨loadViewæ–¹æ³•åè¢«è°ƒç”¨ï¼Œå¦‚æœæ˜¯ä»nibè§†å›¾é¡µé¢è¾“å‡ºï¼Œä»–å°†ä¼šåœ¨è§†å›¾è®¾ç½®å¥½ååè¢«è°ƒç”¨ã€‚ ã€ŒinitWithNibName: bundle:ã€è½½å…¥nibæ¡£æ¡ˆæ¥åˆå§‹åŒ–ã€ŒloadViewã€è½½å…¥è§†å›¾ã€ŒviewDidLoadã€åœ¨è½½å…¥è§†å›¾è‡³å†…å­˜åä¼šå‘¼å«çš„æ–¹æ³•ã€ŒviewDidUnloadã€åœ¨è§†å›¾ä»å†…å­˜ä¸­é‡Šæ”¾åä¼šå‘¼å«çš„æ–¹æ³• (å½“å†…å­˜è¿‡ä½ï¼Œé‡Šæ”¾ä¸€äº›ä¸éœ€è¦çš„è§†å›¾æ—¶è°ƒç”¨) ã€ŒviewWillAppearã€å½“æ”¶åˆ°è§†å›¾åœ¨è§†çª—å°†å¯è§æ—¶çš„é€šçŸ¥ä¼šå‘¼å«çš„æ–¹æ³• ã€ŒviewDidAppearã€å½“æ”¶åˆ°è§†å›¾åœ¨è§†çª—å·²å¯è§æ—¶çš„é€šçŸ¥ä¼šå‘¼å«çš„æ–¹æ³• ã€ŒviewWillDisappearã€å½“æ”¶åˆ°è§†å›¾å°†å»é™¤ã€è¢«è¦†ç›–æˆ–éšè—äºè§†çª—æ—¶çš„é€šçŸ¥ä¼šå‘¼å«çš„æ–¹æ³• ã€ŒviewDidDisappearã€å½“æ”¶åˆ°è§†å›¾å·²å»é™¤ã€è¢«è¦†ç›–æˆ–éšè—äºè§†çª—æ—¶çš„é€šçŸ¥ä¼šå‘¼å«çš„æ–¹æ³• ã€ŒdidReceiveMemoryWarningã€æ”¶åˆ°ç³»ç»Ÿä¼ æ¥çš„å†…å­˜è­¦å‘Šé€šçŸ¥åä¼šæ‰§è¡Œçš„æ–¹æ³• ã€ŒshouldAutorotateToInterfaceOrientationã€æ˜¯å¦æ”¯æŒä¸åŒæ–¹å‘çš„æ—‹è½¬è§†å›¾ ã€ŒwillAnimateRotationToInterfaceOrientationã€åœ¨è¿›è¡Œæ—‹è½¬è§†å›¾å‰çš„ä¼šæ‰§è¡Œçš„æ–¹æ³•ï¼ˆç”¨äºè°ƒæ•´æ—‹è½¬è§†å›¾ä¹‹ç”¨ï¼‰ ä»£ç çš„æ‰§è¡Œé¡ºåº 1ã€ alloc åˆ›å»ºå¯¹è±¡ï¼Œåˆ†é…ç©ºé—´ 2ã€init (initWithNibName) åˆå§‹åŒ–å¯¹è±¡ï¼Œåˆå§‹åŒ–æ•°æ® 3ã€loadView ä»nibè½½å…¥è§†å›¾ ï¼Œé€šå¸¸è¿™ä¸€æ­¥ä¸éœ€è¦å»å¹²æ¶‰ã€‚é™¤éä½ æ²¡æœ‰ä½¿ç”¨xibæ–‡ä»¶åˆ›å»ºè§†å›¾ 4ã€viewDidLoad è½½å…¥å®Œæˆï¼Œå¯ä»¥è¿›è¡Œè‡ªå®šä¹‰æ•°æ®ä»¥åŠåŠ¨æ€åˆ›å»ºå…¶ä»–æ§ä»¶ 5ã€viewWillAppear è§†å›¾å°†å‡ºç°åœ¨å±å¹•ä¹‹å‰ï¼Œé©¬ä¸Šè¿™ä¸ªè§†å›¾å°±ä¼šè¢«å±•ç°åœ¨å±å¹•ä¸Šäº† 6ã€viewDidAppear è§†å›¾å·²åœ¨å±å¹•ä¸Šæ¸²æŸ“å®Œæˆå½“ä¸€ä¸ªè§†å›¾è¢«ç§»é™¤å±å¹•å¹¶ä¸”é”€æ¯çš„æ—¶å€™çš„æ‰§è¡Œé¡ºåºï¼Œè¿™ä¸ªé¡ºåºå·®ä¸å¤šå’Œä¸Šé¢çš„ç›¸å 1ã€viewWillDisappear è§†å›¾å°†è¢«ä»å±å¹•ä¸Šç§»é™¤ä¹‹å‰æ‰§è¡Œ 2ã€viewDidDisappear è§†å›¾å·²ç»è¢«ä»å±å¹•ä¸Šç§»é™¤ï¼Œç”¨æˆ·çœ‹ä¸åˆ°è¿™ä¸ªè§†å›¾äº† 3ã€dealloc è§†å›¾è¢«é”€æ¯ï¼Œæ­¤å¤„éœ€è¦å¯¹ä½ åœ¨initå’ŒviewDidLoadä¸­åˆ›å»ºçš„å¯¹è±¡è¿›è¡Œé‡Šæ”¾ ä»€ä¹ˆæ˜¯key windowï¼Ÿ ä¸€ä¸ªçª—å£å½“å‰èƒ½æ¥å—é”®ç›˜å’Œéè§¦æ‘¸äº‹ä»¶æ—¶ï¼Œä¾¿è¢«è®¤ä¸ºæ˜¯ä¸»çª—å£ã€‚è€Œè§¦æ‘¸äº‹ä»¶åˆ™è¢«æŠ•é€’åˆ°è§¦æ‘¸å‘ç”Ÿçš„çª—å£ï¼Œæ²¡æœ‰ç›¸åº”åæ ‡å€¼çš„äº‹ä»¶è¢«æŠ•é€’åˆ°ä¸»çª—å£ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçª—å£æ˜¯ä¸»çª—å£ã€‚ è°ˆä¸€è°ˆä½ æ˜¯æ€ä¹ˆå°è£…viewçš„- å…ˆæ·»åŠ æ‰€éœ€å­æ§ä»¶ - å†æ¥æ”¶æ¨¡å‹æ•°æ®æ ¹æ®æ¨¡å‹æ•°æ®è®¾ç½®å­æ§ä»¶æ•°æ®å’Œä½ç½® - ç®€è€Œè¨€ä¹‹, è‡ªå·±çš„äº‹æƒ…è‡ªå·±åš, æŠŠä¸éœ€è¦æš´éœ²å‡ºå»çš„å°è£…èµ·æ¥ ç®€å•è¯´ä¸€ä¸‹APPçš„å¯åŠ¨è¿‡ç¨‹,ä»mainæ–‡ä»¶å¼€å§‹è¯´èµ·ç¨‹åºå¯åŠ¨åˆ†ä¸ºä¸¤ç±»:1.æœ‰storyboard 2.æ²¡æœ‰storyboard æœ‰storyboardæƒ…å†µä¸‹: 1.mainå‡½æ•° 2.UIApplicationMain * åˆ›å»ºUIApplicationå¯¹è±¡ * åˆ›å»ºUIApplicationçš„delegateå¯¹è±¡ 3.æ ¹æ®Info.plistè·å¾—Main.storyboardçš„æ–‡ä»¶å,åŠ è½½Main.storyboard(æœ‰storyboard) * åˆ›å»ºUIWindow * åˆ›å»ºå’Œè®¾ç½®UIWindowçš„rootViewController * æ˜¾ç¤ºçª—å£ æ²¡æœ‰storyboardæƒ…å†µä¸‹: 1.mainå‡½æ•° 2.UIApplicationMain * åˆ›å»ºUIApplicationå¯¹è±¡ * åˆ›å»ºUIApplicationçš„delegateå¯¹è±¡ 3.delegateå¯¹è±¡å¼€å§‹å¤„ç†(ç›‘å¬)ç³»ç»Ÿäº‹ä»¶(æ²¡æœ‰storyboard) * ç¨‹åºå¯åŠ¨å®Œæ¯•çš„æ—¶å€™, å°±ä¼šè°ƒç”¨ä»£ç†çš„application:didFinishLaunchingWithOptions:æ–¹æ³• * åœ¨application:didFinishLaunchingWithOptions:ä¸­åˆ›å»ºUIWindow * åˆ›å»ºå’Œè®¾ç½®UIWindowçš„rootViewController * æ˜¾ç¤ºçª—å£ æ€ä¹ˆè§£å†³ç¼“å­˜æ± æ»¡çš„é—®é¢˜(cell)iOSä¸­ä¸å­˜åœ¨ç¼“å­˜æ± æ»¡çš„æƒ…å†µï¼Œå› ä¸ºé€šå¸¸æˆ‘ä»¬iosä¸­å¼€å‘ï¼Œå¯¹è±¡éƒ½æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šåˆ›å»ºï¼Œæœ‰ç§å¸¸ç”¨çš„è¯´è¯å«åšæ‡’åŠ è½½ï¼Œè¿˜æœ‰åœ¨UITableViewä¸­ä¸€èˆ¬åªä¼šåˆ›å»ºåˆšå¼€å§‹å‡ºç°åœ¨å±å¹•ä¸­çš„cellï¼Œä¹‹åéƒ½æ˜¯ä»ç¼“å­˜æ± é‡Œå–ï¼Œä¸ä¼šåœ¨åˆ›å»ºæ–°å¯¹è±¡ã€‚ç¼“å­˜æ± é‡Œæœ€å¤šä¹Ÿå°±ä¸€ä¸¤ä¸ªå¯¹è±¡ï¼Œç¼“å­˜æ± æ»¡çš„è¿™ç§æƒ…å†µä¸€èˆ¬åœ¨å¼€å‘javaä¸­æ¯”è¾ƒå¸¸è§ï¼Œjavaä¸­ä¸€èˆ¬æŠŠæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å¯¹è±¡å…ˆé‡Šæ”¾ã€‚ UIButtonä¸UITableViewçš„å±‚çº§ç»“æ„ ç»§æ‰¿ç»“æ„ï¼Œå±äºå†…éƒ¨çš„å­æ§ä»¶ç»“æ„ UIButtonä¸ºï¼šUIButton &gt; UIControl &gt; UIView &gt; UIResponder &gt; NSObject UITableViewä¸ºï¼šUITableView &gt; UIScrollView &gt; UIView &gt; UIResponder &gt; NSObject è®¾ç½®scroll viewçš„contensizeèƒ½åœ¨Viewdidloadé‡Œè®¾ç½®ä¹ˆ,ä¸ºä»€ä¹ˆ ä¸€èˆ¬æƒ…å†µä¸‹å¯ä»¥è®¾ç½®åœ¨viewDidLoadä¸­ï¼Œä½†åœ¨autolayoutä¸‹ï¼Œç³»ç»Ÿä¼šåœ¨viewDidAppearä¹‹å‰æ ¹æ®subviewçš„constrainté‡æ–°è®¡ç®—scrollviewçš„contentsizeã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨viewdidloadé‡Œé¢æ‰‹åŠ¨è®¾ç½®äº†contentsizeæ²¡ç”¨ã€‚å› ä¸ºåœ¨åé¢ï¼Œä¼šå†é‡æ–°è®¡ç®—ä¸€æ¬¡ï¼Œå‰é¢æ‰‹åŠ¨è®¾ç½®çš„å€¼ä¼šè¢«è¦†ç›–æ‰ã€‚ è§£å†³åŠæ³•å°±æ˜¯ï¼š å»é™¤autolayouté€‰é¡¹ï¼Œè‡ªå·±æ‰‹åŠ¨è®¾ç½®contentsize å¦‚æœè¦ä½¿ç”¨autolayoutï¼Œè¦ä¹ˆè‡ªå·±è®¾ç½®å®Œsubviewçš„constraintï¼Œç„¶åè®©ç³»ç»Ÿè‡ªåŠ¨æ ¹æ®constraintè®¡ç®—å‡ºcontentsizeã€‚è¦ä¹ˆå°±åœ¨viewDidAppearé‡Œé¢è‡ªå·±æ‰‹åŠ¨è®¾ç½®contentsizeã€‚ ç®€è¿°ä½ å¯¹UIViewã€UIWindowå’ŒCALayerçš„ç†è§£ UIView: å±äºUIkit.frameworkæ¡†æ¶,è´Ÿè´£æ¸²æŸ“çŸ©å½¢åŒºåŸŸçš„å†…å®¹,ä¸ºçŸ©å½¢åŒºåŸŸæ·»åŠ åŠ¨ç”»,å“åº”åŒºåŸŸçš„è§¦æ‘¸äº‹ä»¶,å¸ƒå±€å’Œç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªå­è§†å›¾ UIWindow:å±äºUIKit.frameworkæ¡†æ¶,æ˜¯ä¸€ç§ç‰¹æ®Šçš„UIView,é€šå¸¸åœ¨ä¸€ä¸ªç¨‹åºä¸­åªä¼šæœ‰ä¸€ä¸ªUIWindow,ä½†å¯ä»¥æ‰‹åŠ¨åˆ›å»ºå¤šä¸ªUIWindow,åŒæ—¶åŠ åˆ°ç¨‹åºé‡Œé¢ã€‚UIWindowåœ¨ç¨‹åºä¸­ä¸»è¦èµ·åˆ°ä¸‰ä¸ªä½œç”¨: ä½œä¸ºå®¹å™¨,åŒ…å«appæ‰€è¦æ˜¾ç¤ºçš„æ‰€æœ‰è§†å›¾ ä¼ é€’è§¦æ‘¸æ¶ˆæ¯åˆ°ç¨‹åºä¸­viewå’Œå…¶ä»–å¯¹è±¡ ä¸UIViewControllerååŒå·¥ä½œ,æ–¹ä¾¿å®Œæˆè®¾å¤‡æ–¹å‘æ—‹è½¬çš„æ”¯æŒ CAlayer:å±äºQuartzCore.framework,æ˜¯ç”¨æ¥ç»˜åˆ¶å†…å®¹çš„,å¯¹å†…å®¹è¿›è¡ŒåŠ¨ç”»å¤„ç†ä¾èµ–ä¸UIViewæ¥è¿›è¡Œæ˜¾ç¤º,ä¸èƒ½å¤„ç†ç”¨æˆ·äº‹ä»¶ã€‚ UIViewå’ŒCALayeræ˜¯ç›¸äº’ä¾èµ–çš„,UIViewä¾èµ–CALayeræä¾›å†…å®¹,CALayerä¾èµ–UIViewçš„å®¹å™¨æ˜¾ç¤ºç»˜åˆ¶å†…å®¹ã€‚ (è¡¥å……)UIViewController:æ¯ä¸ªè§†å›¾æ§åˆ¶å™¨éƒ½æœ‰ä¸€ä¸ªè‡ªå¸¦çš„è§†å›¾,å¹¶ä¸”è´Ÿè´£è¿™ä¸ªè§†å›¾ç›¸å…³çš„ä¸€åˆ‡äº‹åŠ¡ã€‚æ–¹ä¾¿ç®¡ç†è§†å›¾ä¸­çš„å­è§†å›¾,è´Ÿè´£modelä¸viewçš„é€šä¿¡;æ£€æµ‹è®¾å¤‡æ—‹è½¬ä»¥åŠå†…å­˜è­¦å‘Š;æ˜¯æ‰€æœ‰è§†å›¾æ§åˆ¶ç±»çš„ç§¯ç´¯,å®šä¹‰äº†æ§åˆ¶å™¨çš„åŸºæœ¬åŠŸèƒ½ã€‚ frameå’Œboundsæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ(Difference between frame and bounds?) frameæŒ‡çš„æ˜¯ï¼šè¯¥viewåœ¨çˆ¶viewåæ ‡ç³»ç»Ÿä¸­çš„ä½ç½®å’Œå¤§å°ï¼ˆå‚ç…§ç‚¹æ˜¯çˆ¶äº²çš„åæ ‡ç³»ç»Ÿï¼‰ boundsæŒ‡çš„æ˜¯ï¼šè¯¥viewåœ¨æœ¬èº«åæ ‡ç³»ç»Ÿä¸­çš„ä½ç½®å’Œå¤§å°ï¼ˆå‚ç…§ç‚¹æ˜¯æœ¬èº«åæ ‡ç³»ç»Ÿï¼‰ å…³äºé¡µé¢é—´ä¼ å€¼çš„é—®é¢˜?å±æ€§ä¼ å€¼ï¼šAé¡µé¢è®¾ç½®å±æ€§ NSString *paramStringï¼Œåœ¨è·³è½¬Bé¡µé¢çš„æ—¶å€™åˆå§‹åŒ–paramStringã€‚ //Aé¡µé¢.hæ–‡ä»¶ @property (nonatomic, copy)NSString *paramString; //Aé¡µé¢.mæ–‡ä»¶ NextViewController *nextVC = [[NextViewController alloc] init]; nextVC.paramString = @"å‚æ•°ä¼ è´¨"; [self presentViewController:nextVC animated:YES completion:nil]; å§”æ‰˜delegateä¼ å€¼ï¼šåœ¨Bé¡µé¢å®šä¹‰delegateï¼Œå¹¶ä¸”è®¾ç½®delegateå±æ€§ï¼Œåœ¨Aé¡µé¢å®ç°delegateåè®® é€šçŸ¥notificationä¼ å€¼ï¼šåœ¨Bé¡µé¢ä¸­å‘é€é€šçŸ¥ï¼Œåœ¨Aé¡µé¢æ³¨å†Œè§‚å¯Ÿè€…å¹¶ä¸”åœ¨ä¸ç”¨çš„æ—¶å€™ç§»é™¤è§‚å¯Ÿè€…ã€‚ //Bé¡µé¢å‘é€é€šçŸ¥ [[NSNotificationCenter defaultCenter] postNotificationName:@"ChangeNameNotification" object:self userInfo:@{@"name":self.nameTextField.text}]; [self dismissViewControllerAnimated:YES completion:nil]; //Aé¡µé¢æ³¨å†Œè§‚å¯Ÿè€… [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(ChangeNameNotification:) name:@"ChangeNameNotification" object:nil]; } //è§‚å¯Ÿåˆ°é€šçŸ¥æ—¶å€™çš„å¤„ç†æ–¹æ³• -(void)ChangeNameNotification:(NSNotification*)notification{ NSDictionary *nameDictionary = [notification userInfo]; self.nameLabel.text = [nameDictionary objectForKey:@"name"]; } //é€šçŸ¥ä¸ä½¿ç”¨çš„æ—¶å€™ç§»é™¤è§‚å¯Ÿè€… [[NSNotificationCenter defaultCenter] removeObserver:self]; blockä¼ å€¼ï¼šåœ¨Bé¡µé¢å®šä¹‰ä¸€ä¸ªblockç±»å‹çš„å˜é‡ï¼Œåœ¨Bé¡µé¢è·³è½¬Açš„æ—¶å€™è°ƒç”¨è¿™ä¸ªblockã€‚åœ¨Aé¡µé¢è·³è½¬åˆ°Bé¡µé¢çš„æ—¶å€™å¯¹Bé¡µé¢çš„blockèµ‹å€¼ã€‚ //Bé¡µé¢å®šä¹‰blockï¼Œå¹¶è®¾ç½®blockç±»å‹çš„å˜é‡ typedef void (^ablock)(NSString *str); @property (nonatomic, copy) ablock block; //Bé¡µé¢è·³è½¬åˆ°Aé¡µé¢è°ƒç”¨è¿™ä¸ªblock self.block(self.nameTextField.text); [self dismissViewControllerAnimated:YES completion:nil]; //Aé¡µé¢è·³è½¬åˆ°Bé¡µé¢çš„æ—¶å€™å¯¹Bé¡µé¢çš„blockèµ‹å€¼ï¼Œè¿™æ ·åœ¨Bé¡µé¢è·³è½¬çš„æ—¶å€™å°±ä¼šå›è°ƒè¿™ä¸ªblockå‡½æ•° [self presentViewController:second animated:YES completion:nil]; second.block = ^(NSString *str){ self.nameLabel.text = str; }; kvoä¼ å€¼ï¼šåœ¨Aé¡µé¢è®¾ç½®Bé¡µé¢çš„å˜é‡secondï¼Œå¹¶ä¸”å¯¹è¿™ä¸ªå˜é‡è¿›è¡Œè§‚å¯Ÿ - (void)addObserver:(NSObject * _Nonnull)anObserver forKeyPath:(NSString * _Nonnull)keyPath options:(NSKeyValueObservingOptions)options context:(void * _Nullable)context å¹¶åœ¨Aé¡µé¢å®ç° - (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)contextæ–¹æ³•ã€‚ åœ¨Bé¡µé¢å¯¹å˜é‡keyPathè¿›è¡Œè®¾ç½®ï¼Œåœ¨Aé¡µé¢éƒ½ä¼šè§‚å¯Ÿçš„åˆ°ã€‚ @property (nonatomic, strong) SecondViewController *second; //åœ¨Aè§†å›¾è·³è½¬åˆ°Bè§†å›¾çš„åœ°æ–¹æ·»åŠ å¦‚ä¸‹ä»£ç  self.second = [[SecondViewController alloc] initWithNibName:@"SecondViewController" bundle:nil]; [self.second addObserver:self forKeyPath:@"userName" options:NSKeyValueObservingOptionNew context:nil]; [self presentViewController:self.second animated:YES completion:nil]; //å®ç°è¿™ä¸ªè§‚å¯Ÿå¯¹è±¡çš„æ–¹æ³• -(void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context //åœ¨Bé¡µé¢å¯¹userNameè¿›è¡Œè®¾ç½®ï¼Œåœ¨Aé¡µé¢éƒ½å¯ä»¥é—´å¬åˆ° å•ä¾‹æ¨¡å¼ä¼ å€¼ï¼šé€šè¿‡å…¨å±€çš„æ–¹å¼ä¿å­˜ å¯¹äºé€šçŸ¥ä»£ç†é¢è¯•å¸¸é—®, ä»£ç†å’Œé€šçŸ¥åˆ†åˆ«åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨? åŒºåˆ«? å„è‡ªä¼˜ç‚¹? å…³äºè§†å›¾çš„ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ é¦–å…ˆåˆ¤æ–­æ§åˆ¶å™¨æ˜¯å¦æœ‰è§†å›¾ï¼Œå¦‚æœæ²¡æœ‰å°±è°ƒç”¨loadViewæ–¹æ³•åˆ›å»ºï¼šé€šè¿‡storyboardæˆ–è€…ä»£ç ï¼› éšåè°ƒç”¨viewDidLoadï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„åˆå§‹åŒ–æ“ä½œï¼›åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼› åœ¨è§†å›¾æ˜¾ç¤ºä¹‹å‰è°ƒç”¨viewWillAppearï¼›è¯¥å‡½æ•°å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼› è§†å›¾viewDidAppear åœ¨è§†å›¾æ˜¾ç¤ºä¹‹å‰è°ƒç”¨viewWillDisappearï¼›è¯¥å‡½æ•°å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼›å¦‚éœ€è¦ï¼‰ï¼› åœ¨å¸ƒå±€å˜åŒ–å‰åï¼Œè°ƒç”¨viewWill/DidLayoutSubviewså¤„ç†ç›¸å…³ä¿¡æ¯ï¼› è§†å›¾ç”Ÿå‘½å‘¨æœŸå›¾ å“åº”è€…é“¾æ¡? (What is responder chain?) äº‹ä»¶å“åº”é“¾ã€‚åŒ…æ‹¬ç‚¹å‡»äº‹ä»¶ï¼Œç”»é¢åˆ·æ–°äº‹ä»¶ç­‰ã€‚åœ¨è§†å›¾æ ˆå†…ä»ä¸Šè‡³ä¸‹ï¼Œæˆ–è€…ä»ä¸‹ä¹‹ä¸Šä¼ æ’­. å¯ä»¥è¯´ç‚¹äº‹ä»¶çš„åˆ†å‘ï¼Œä¼ é€’ä»¥åŠå¤„ç†ã€‚å…·ä½“å¯ä»¥å»çœ‹ä¸‹touchäº‹ä»¶è¿™å—ã€‚ é¦–å…ˆè§£é‡Šå“åº”è€…é“¾çš„æ¦‚å¿µ UIResponderç±»ï¼Œæ˜¯UIKITä¸­ä¸€ä¸ªç”¨äºå¤„ç†äº‹ä»¶å“åº”çš„åŸºç±»ã€‚çª—å£ä¸Šçš„æ‰€æœ‰äº‹ä»¶è§¦å‘ï¼Œéƒ½ç”±è¯¥ç±»å“åº”ï¼ˆå³äº‹ä»¶å¤„ç†å…¥å£ï¼‰ã€‚æ‰€ä»¥ï¼Œçª—å£ä¸Šçš„ViewåŠæ§åˆ¶å™¨éƒ½æ˜¯æ´¾ç”Ÿäºè¯¥ç±»çš„ï¼Œä¾‹å¦‚UIViewã€UIViewControllerç­‰ã€‚ è°ƒç”¨UIResponderç±»æä¾›çš„æ–¹æ³•æˆ–å±æ€§ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ•æ‰åˆ°çª—å£ä¸Šçš„æ‰€æœ‰å“åº”äº‹ä»¶ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ å“åº”è€…é“¾æ¡æ˜¯ç”±å¤šä¸ªå“åº”è€…å¯¹è±¡è¿æ¥èµ·æ¥çš„é“¾æ¡ï¼Œå…¶ä¸­å“åº”è€…å¯¹è±¡æ˜¯èƒ½å¤„ç†äº‹ä»¶çš„å¯¹è±¡ï¼Œæ‰€æœ‰çš„Viewå’ŒViewControlleréƒ½æ˜¯å“åº”è€…å¯¹è±¡ï¼Œåˆ©ç”¨å“åº”è€…é“¾æ¡èƒ½è®©å¤šä¸ªæ§ä»¶å¤„ç†åŒä¸€ä¸ªè§¦æ‘¸äº‹ä»¶. äº‹ä»¶ä¼ é€’æœºåˆ¶ image å¦‚æœå½“å‰viewä¸èƒ½å¤„ç†å½“å‰äº‹ä»¶ï¼Œé‚£ä¹ˆäº‹ä»¶å°†ä¼šæ²¿ç€å“åº”è€…é“¾(Responder Chain)è¿›è¡Œä¼ é€’ï¼ŒçŸ¥é“é‡åˆ°èƒ½å¤„ç†è¯¥äº‹ä»¶çš„å“åº”è€…(Responsder Object)ã€‚ - æ¥æ”¶äº‹ä»¶çš„initial viewå¦‚æœä¸èƒ½å¤„ç†è¯¥äº‹ä»¶å¹¶ä¸”å¥¹ä¸æ˜¯é¡¶å±‚çš„Viewï¼Œåˆ™äº‹ä»¶ä¼šå¾€å®ƒçš„çˆ¶Viewè¿›è¡Œä¼ é€’ã€‚ - initial viewçš„çˆ¶Viewè·å–äº‹ä»¶åå¦‚æœä»ä¸èƒ½å¤„ç†ï¼Œåˆ™ç»§ç»­å¾€ä¸Šä¼ é€’ï¼Œå¾ªç¯è¿™ä¸ªè¿‡ç¨‹ã€‚å¦‚æœé¡¶å±‚çš„Viewè¿˜æ˜¯ä¸èƒ½å¤„ç†è¿™ä¸ªäº‹ä»¶çš„è¯ï¼Œåˆ™ä¼šå°†äº‹ä»¶ä¼ é€’ç»™å®ƒä»¬çš„ViewControllerï¼Œ - å¦‚æœViewControllerä¹Ÿä¸èƒ½å¤„ç†ï¼Œåˆ™ä¼ é€’ç»™Window(UIWindow)ï¼Œæ­¤æ—¶Windowä¸èƒ½å¤„ç†çš„è¯å°±å°†äº‹ä»¶ä¼ é€’UIApplicationï¼Œæœ€åå¦‚æœè¿Applicationä¹Ÿä¸èƒ½å¤„ç†ï¼Œåˆ™åºŸå¼ƒè¯¥äº‹ä»¶ ViewControllerçš„loadView,viewDidLoad,viewDidUnloadåˆ†åˆ«æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿåœ¨è‡ªå®šä¹‰ViewControllerçš„æ—¶å€™è¿™å‡ ä¸ªå‡½æ•°é‡Œé¢åº”è¯¥åšä»€ä¹ˆå·¥ä½œï¼Ÿ viewDidLoadåœ¨viewä»nibæ–‡ä»¶åˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œ loadViewåœ¨controllerçš„viewä¸ºnilæ—¶è°ƒç”¨ã€‚ æ­¤æ–¹æ³•åœ¨ç¼–ç¨‹å®ç°viewæ—¶è°ƒç”¨, viewæ§åˆ¶å™¨é»˜è®¤ä¼šæ³¨å†Œmemory warning notification,å½“viewcontrollerçš„ä»»ä½•viewæ²¡æœ‰ç”¨çš„æ—¶å€™ï¼ŒviewDidUnloadä¼šè¢«è°ƒç”¨ï¼Œåœ¨è¿™é‡Œå®ç°å°†retainçš„view release,å¦‚æœæ˜¯retainçš„IBOutlet viewå±æ€§åˆ™ä¸è¦åœ¨è¿™é‡Œrelease,IBOutletä¼šè´Ÿè´£releaseã€‚ UITableViewçš„é‡ç”¨æœºåˆ¶?(æˆ–è€…å¦‚ä½•åœ¨ä¸€ä¸ªviewä¸Šæ˜¾ç¤ºå¤šä¸ªtableView,tableViewè¦æ±‚ä¸åŒçš„æ•°æ®æºä»¥åŠä¸åŒçš„æ ·å¼ (è¦æ±‚è‡ªå®šä¹‰cell), å¦‚ä½•ç»„ç»‡å„ä¸ªtableViewçš„delegateå’ŒdataSource?è¯·è¯´è¯´å®ç°æ€è·¯?) æŸ¥çœ‹UITableViewå¤´æ–‡ä»¶,ä¼šæ‰¾åˆ°NSMutableArray visiableCells,å’ŒNSMutableArray reusableTableCellsä¸¤ä¸ªç»“æ„ã€‚ visiableCellså†…ä¿å­˜å½“å‰æ˜¾ç¤ºçš„cells,reusableTableCellsä¿å­˜å¯é‡ç”¨çš„cellsã€‚ TableViewæ˜¾ç¤ºä¹‹åˆ,reusableTableCellsä¸ºç©º,é‚£ä¹ˆ [tableView dequeueReusableCellWithIdentifier:CellIdentifier]è¿”å›nilã€‚ å¼€å§‹çš„celléƒ½æ˜¯é€šè¿‡ [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier] æ¥åˆ›å»º,è€Œä¸”cellForRowAtIndexPathåªæ˜¯è°ƒç”¨æœ€å¤§æ˜¾ç¤ºcellæ•°çš„æ¬¡æ•°ã€‚ æ¯”å¦‚:æœ‰100æ¡æ•°æ®,iPhoneä¸€å±æœ€å¤šæ˜¾ç¤º10ä¸ªcellã€‚ ç¨‹åºæœ€å¼€å§‹æ˜¾ç¤ºTableViewçš„æƒ…å†µæ˜¯: ç”¨[[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier]åˆ›å»º10æ¬¡cell,å¹¶ç»™cellæŒ‡å®šåŒæ ·çš„é‡ç”¨æ ‡è¯†(å½“ç„¶,å¯ä»¥ä¸ºä¸åŒæ˜¾ç¤ºç±»å‹çš„cellæŒ‡å®šä¸åŒçš„æ ‡è¯†)ã€‚å¹¶ä¸”10ä¸ªcellå…¨éƒ¨éƒ½åŠ å…¥åˆ°visiableCellsæ•°ç»„,reusableTableCellsä¸ºç©ºã€‚ å‘ä¸‹æ‹–åŠ¨tableView,å½“cell1å®Œå…¨ç§»å‡ºå±å¹•,å¹¶ä¸”cell11(å®ƒä¹Ÿæ˜¯allocå‡ºæ¥çš„,åŸå› åŒä¸Š)å®Œå…¨æ˜¾ç¤ºå‡ºæ¥çš„æ—¶å€™ã€‚cell11åŠ å…¥åˆ°visiableCells,cell1ç§»å‡ºvisiableCells,cell1åŠ å…¥åˆ°reusableTableCellsã€‚ æ¥ç€å‘ä¸‹æ‹–åŠ¨tableView,å› ä¸ºreusableTableCellsä¸­å·²ç»æœ‰å€¼,æ‰€ä»¥,å½“éœ€è¦æ˜¾ç¤ºæ–°çš„cell, cellForRowAtIndexPathå†æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™,[tableView dequeueReusableCellWithIdentifier:CellIdentifier],è¿”å›cell1ã€‚ cell1åŠ å…¥åˆ°visiableCells,cell1 ç§»å‡ºreusableTableCells;cell2ç§»å‡º visiableCells,cell2åŠ å…¥åˆ°reusableTableCellsã€‚ä¹‹åå†éœ€è¦æ˜¾ç¤ºçš„Cellå°±å¯ ä»¥æ­£å¸¸é‡ç”¨äº†. æ³¨æ„ï¼šé…ç½®Cellçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ï¼Œå¯¹å–å‡ºçš„é‡ç”¨çš„cellåšé‡æ–°èµ‹å€¼ï¼Œä¸è¦é—ç•™è€æ•°æ®ã€‚ åœ¨ä¸€ä¸ªtableViewä¸­éœ€è¦è‡ªå®šä¹‰å¤šç§æ ·å¼çš„cell(ä¸¤ç§æˆ–ä¸‰ç§),é€šå¸¸ä½ å¦‚ä½•å®ç°,è¯´è¯´æ€è·¯å³å¯? åŒä¸Šï¼ UITableViewçš„æ€§èƒ½ä¼˜åŒ–? æ»‘åŠ¨çš„æ—¶å€™æœ‰ç§å¡çš„æ„Ÿè§‰æ˜¯ä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº”ç”¨æ—¶ï¼Œå´ç»å¸¸é‡åˆ°æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼Œæ™®éè¡¨ç°åœ¨æ»šåŠ¨æ—¶æ¯”è¾ƒå¡ï¼Œç‰¹åˆ«æ˜¯cellä¸­åŒ…å«å›¾ç‰‡çš„æƒ…å†µæ—¶ã€‚ å®é™…ä¸Šé’ˆå¯¹æ€§åœ°ä¼˜åŒ–ä¸€ä¸‹å°±å¯ä»¥è§£å†³tableViewæ»‘åŠ¨çš„æ—¶å€™å¡é¡¿çš„é—®é¢˜: ä½¿ç”¨ä¸é€æ˜è§†å›¾ã€‚ä¸é€æ˜çš„è§†å›¾å¯ä»¥æé«˜æ¸²æŸ“çš„é€Ÿåº¦ã€‚å¯ä»¥å°†cellåŠå…¶å­è§†å›¾çš„opaqueå±æ€§è®¾ä¸ºYESï¼ˆé»˜è®¤å€¼ï¼‰ã€‚ ä¸è¦é‡å¤åˆ›å»ºä¸å¿…è¦çš„cellã€‚UITableViewåªéœ€è¦ä¸€å±å¹•çš„UITableViewCellå¯¹è±¡å³å¯ã€‚å› æ­¤åœ¨cellä¸å¯è§æ—¶ï¼Œå¯ä»¥å°†å…¶ç¼“å­˜èµ·æ¥ï¼Œè€Œåœ¨éœ€è¦æ—¶ç»§ç»­ä½¿ç”¨å®ƒå³å¯ã€‚æ³¨æ„ï¼šcellè¢«é‡ç”¨æ—¶ï¼Œéœ€è¦è°ƒç”¨setNeedsDisplayInRect:æˆ–setNeedsDisplayæ–¹æ³•é‡ç»˜cellã€‚ å‡å°‘åŠ¨ç”»æ•ˆæœçš„ä½¿ç”¨ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨insertRowsAtIndexPaths:withRowAnimation:æ–¹æ³•ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨reloadDataæ–¹æ³•ã€‚ å‡å°‘è§†å›¾çš„æ•°ç›®ã€‚CellåŒ…å«äº†textLabelã€detailTextLabelå’ŒimageViewç­‰viewï¼Œè€Œä½ è¿˜å¯ä»¥è‡ªå®šä¹‰ä¸€äº›è§†å›¾æ”¾åœ¨å®ƒçš„contentViewé‡Œï¼Œåˆ›å»ºå®ƒä¼šæ¶ˆè€—è¾ƒå¤šèµ„æºï¼Œå¹¶ä¸”ä¹Ÿå½±å“æ¸²æŸ“çš„æ€§èƒ½ã€‚ cellåŒ…å«å›¾ç‰‡ï¼Œä¸”æ•°ç›®è¾ƒå¤šï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„cellé€Ÿåº¦ä¼šæ¯”ä½¿ç”¨é»˜è®¤çš„è¦å¿«ã€‚ç»§æ‰¿UITableViewCellï¼Œé‡å†™drawRectæ–¹æ³•ï¼š- (void)drawRect:(CGRect)rect { if (image) { [image drawAtPoint:imagePoint]; self.image = nil; } else { [placeHolder drawAtPoint:imagePoint]; } [text drawInRect:textRect withFont:font lineBreakMode:UILineBreakModeTailTruncation]; } ä¸è¿‡è¿™æ ·ä¸€æ¥ï¼Œä½ ä¼šå‘ç°é€‰ä¸­ä¸€è¡Œåï¼Œè¿™ä¸ªcellå°±å˜è“äº†ï¼Œå…¶ä¸­çš„å†…å®¹å°±è¢«æŒ¡ä½äº†ã€‚æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†cellçš„selectionStyleå±æ€§è®¾ä¸ºUITableViewCellSelectionStyleNoneï¼Œè¿™æ ·å°±ä¸ä¼šè¢«é«˜äº®äº†ã€‚ -ä¸éœ€è¦ä¸ç”¨æˆ·äº¤äº’æ—¶ï¼Œä½¿ç”¨CALayerï¼Œå°†å†…å®¹ç»˜åˆ¶åˆ°layerä¸Šï¼Œç„¶åå¯¹cellçš„contentView.layerè°ƒç”¨addSublayer:æ–¹æ³•ã€‚è¿™ä¸ªä¾‹å­ä¸­ï¼Œlayerå¹¶ä¸ä¼šæ˜¾è‘—å½±å“æ€§èƒ½ï¼Œä½†å¦‚æœlayeré€æ˜ï¼Œæˆ–è€…æœ‰åœ†è§’ã€å˜å½¢ç­‰æ•ˆæœï¼Œå°±ä¼šå½±å“åˆ°ç»˜åˆ¶é€Ÿåº¦äº†ã€‚è§£å†³åŠæ³•å¯å‚è§åé¢çš„é¢„æ¸²æŸ“å›¾åƒã€‚ ä¸è¦åšå¤šä½™çš„ç»˜åˆ¶å·¥ä½œã€‚åœ¨å®ç°drawRect:çš„æ—¶å€™ï¼Œå®ƒçš„rectå‚æ•°å°±æ˜¯éœ€è¦ç»˜åˆ¶çš„åŒºåŸŸï¼Œè¿™ä¸ªåŒºåŸŸä¹‹å¤–çš„ä¸éœ€è¦è¿›è¡Œç»˜åˆ¶ã€‚ é¢„æ¸²æŸ“å›¾åƒã€‚ä½ ä¼šå‘ç°å³ä½¿åšåˆ°äº†ä¸Šè¿°å‡ ç‚¹ï¼Œå½“æ–°çš„å›¾åƒå‡ºç°æ—¶ï¼Œä»ç„¶ä¼šæœ‰çŸ­æš‚çš„åœé¡¿ç°è±¡ã€‚è§£å†³çš„åŠæ³•å°±æ˜¯åœ¨å›¾å½¢ä¸Šä¸‹æ–‡ä¸­ç”»ï¼Œå¯¼å‡ºæˆUIImageå¯¹è±¡ï¼Œç„¶åå†ç»˜åˆ¶åˆ°å±å¹•ã€‚ï¼ˆå¤´åƒåœ†è§’ï¼Œæˆ–è€…å…¶ä»–å˜å½¢çš„æ—¶å€™ï¼Œç”¨å›¾å½¢ä¸Šä¸‹æ–‡èƒ½æé«˜æ€§èƒ½ã€‚ï¼‰å¼‚æ­¥ç»˜åˆ¶ ä¸è¦é˜»å¡ä¸»çº¿ç¨‹ã€‚tableviewåœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œæ•´ä¸ªç•Œé¢å¡ä½ä¸åŠ¨ï¼Œå®Œå…¨ä¸å“åº”ç”¨æˆ·è¯·æ±‚ã€‚å¸¸è§çš„æ˜¯ç½‘ç»œè¯·æ±‚ï¼Œç­‰å¾…æ—¶é—´é•¿å¾…æ•°ç§’ã€‚ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨å¤šçº¿ç¨‹ï¼Œè®©å­çº¿ç¨‹å»æ‰§è¡Œè¿™äº›å‡½æ•°æˆ–æ–¹æ³•ã€‚ æ³¨æ„ï¼šå½“ä¸‹è½½çº¿ç¨‹æ•°è¶…è¿‡2æ—¶ï¼Œä¼šæ˜¾è‘—å½±å“ä¸»çº¿ç¨‹çš„æ€§èƒ½ã€‚æ‰€ä»¥åœ¨ä¸éœ€è¦å“åº”ç”¨æˆ·è¯·æ±‚æ—¶ï¼Œä¸‹è½½çº¿ç¨‹æ•°å¯ä»¥å¢åŠ åˆ°5ï¼Œä¸å»ºè®®å†åŠ äº†ï¼Œä»¥åŠ å¿«ä¸‹è½½é€Ÿåº¦ã€‚å¦‚æœç”¨æˆ·æ­£åœ¨äº¤äº’ï¼Œåº”æŠŠçº¿ç¨‹æ•°é‡æ§åˆ¶åœ¨2ä¸ªä»¥å†…ã€‚ æå‰è®¡ç®—å¹¶ç¼“å­˜å¥½é«˜åº¦ï¼Œå› ä¸ºheightforrowatindexpathè°ƒç”¨éå¸¸é¢‘ç¹ é€‰æ‹©æ­£ç¡®çš„æ•°æ®ç»“æ„ï¼šå­¦ä¼šé€‰æ‹©å¯¹ä¸šåŠ¡åœºæ™¯æœ€åˆé€‚çš„æ•°ç»„ç»“æ„æ˜¯å†™å‡ºé«˜æ•ˆä»£ç çš„åŸºç¡€ã€‚æ¯”å¦‚ï¼Œæ•°ç»„: æœ‰åºçš„ä¸€ç»„å€¼ã€‚ä½¿ç”¨ç´¢å¼•æ¥æŸ¥è¯¢å¾ˆå¿«ï¼Œä½¿ç”¨å€¼æŸ¥è¯¢å¾ˆæ…¢ï¼Œæ’å…¥/åˆ é™¤å¾ˆæ…¢ã€‚å­—å…¸: å­˜å‚¨é”®å€¼å¯¹ï¼Œç”¨é”®æ¥æŸ¥æ‰¾æ¯”è¾ƒå¿«ã€‚é›†åˆ: æ— åºçš„ä¸€ç»„å€¼ï¼Œç”¨å€¼æ¥æŸ¥æ‰¾å¾ˆå¿«ï¼Œæ’å…¥/åˆ é™¤å¾ˆå¿«ã€‚ gzip/zipå‹ç¼©ï¼šå½“ä»æœåŠ¡ç«¯ä¸‹è½½ç›¸å…³é™„ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡gzip/zipå‹ç¼©åå†ä¸‹è½½ï¼Œä½¿å¾—å†…å­˜æ›´å°ï¼Œä¸‹è½½é€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚ tableviewçš„cellé‡Œå¦‚ä½•åµŒå¥—collection viewï¼Ÿæ€è·¯åŒç½‘æ˜“æ–°é—»ç±»ä¼¼,ç”¨è‡ªå®šä¹‰çš„ç»§æ‰¿è‡ªUITableViewCellçš„ç±»,åœ¨initWithFrameçš„æ„é€ æ–¹æ³•ä¸­, åˆå§‹åŒ–è‡ªå®šä¹‰çš„ç»§æ‰¿è‡ªUICollectionViewçš„ç±» ä¸‹æ‹‰å’Œä¸Šæ‹‰çš„åŸç†? ä»¥tableViewçš„ä¸Šæ‹‰åˆ·æ–°ä¸ºä¾‹: ä¸ºäº†è¿›è¡Œæ— ç¼é˜…è¯», é€šè¿‡tableViewçš„ä»£ç†æ–¹æ³•, willDisplayCellåˆ¤æ–­æ˜¯å¦æ˜¯æœ€åä¸€è¡Œ, å¦‚æœæ˜¯æœ€åä¸€è¡Œ, åœ¨æ˜¾ç¤ºæœ€åä¸€è¡Œçš„åŒæ—¶, åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨ä¸Šæ‹‰åˆ·æ–° å¦‚æœå½“å‰æ²¡æœ‰ä¸Šæ‹‰åˆ·æ–°, å°±è¿›è¡ŒåŠ è½½æ•°æ®, å¯åŠ¨å°èŠèŠ±è½¬å•Šè½¬ã€‚ ä»¥tableViewçš„ä¸‹æ‹‰åˆ·æ–°ä¸ºä¾‹: åˆ¤æ–­å½“å‰çš„ä¸Šæ‹‰åˆ·æ–°è§†å›¾æ˜¯å¦åŠ¨ç”» å¦‚æœæ²¡æœ‰åŠ¨ç”», å°±ä¸æ˜¯ä¸Šæ‹‰åˆ·æ–° ç„¶åä¸‹æ‹‰åˆ·æ–°åŠ è½½æ•°æ® åŠ è½½å®Œæ¯•æ•°æ®å…³é—­åˆ·æ–° å¦‚ä½•å®ç°cellçš„åŠ¨æ€çš„è¡Œé«˜ï¼Ÿ å¦‚æœå¸Œæœ›æ¯æ¡æ•°æ®æ˜¾ç¤ºè‡ªèº«çš„è¡Œé«˜, å¿…é¡»è®¾ç½®ä¸¤ä¸ªå±æ€§, 1.é¢„ä¼°è¡Œé«˜, 2.è‡ªå®šä¹‰è¡Œé«˜ è®¾ç½®é¢„ä¼°è¡Œé«˜ tableView.estimatedRowHeight = 200 è®¾ç½®å®šä¹‰è¡Œé«˜ tableView.rowHeight = UITableViewAutomaticDimension å¦‚æœè¦è®©è‡ªå®šä¹‰è¡Œé«˜æœ‰æ•ˆ, å¿…é¡»è®©å®¹å™¨è§†å›¾æœ‰ä¸€ä¸ªè‡ªä¸‹è€Œä¸Šçš„çº¦æŸ è°ˆè°ˆwebView iOSå¼€å‘ä¸­webviewå’Œnative codeçš„é…åˆä¸Šçš„ä¸€äº›ç»éªŒå’ŒæŠ€å·§ã€‚ webviewä¸è¿ç»´æˆæœ¬ä½ï¼Œæ›´æ–°å‡ ä¹ä¸ä¾èµ–Appçš„ç‰ˆæœ¬ï¼›ä½†åœ¨äº¤äº’å’Œæ€§èƒ½ä¸Šä¸è·Ÿnative codeæœ‰å¾ˆå¤§å·®è·ã€‚ native codeä¸ä¹‹å¯¹åº”ã€‚ HTML5ç¡®å®ç»™webå¸¦å…¥äº†ä¸€ä¸ªæ–°æ—¶ä»£ã€‚è¿™ä¸ªæ—¶ä»£æ˜¯ä»€ä¹ˆï¼Œweb appã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰è„±ç¦»nativeçš„è¿™ä¸ªå‰æï¼Œåœ¨æµè§ˆå™¨çš„ç¯å¢ƒä¸‹ï¼ŒHTML5çš„æ„ä¹‰æ‰èƒ½æ˜¾ç°ï¼Œè€Œæˆ‘ä»¬è®¨è®ºiOS Appçš„æ—¶å€™ï¼ŒHTML5æ˜¾ç„¶æ²¡ä»€ä¹ˆæ„ä¹‰ã€‚ ä¸ç®¡æ˜¯ç”¨webviewè¿˜æ˜¯native codeï¼Œä¸¤ä¸ªåŸåˆ™ï¼š ç”¨æˆ·ä½“éªŒä¸æ‰“æŠ˜ è¿ç»´æˆæœ¬ä½ ä¸ºä»€ä¹ˆä¸æå¼€å‘æˆæœ¬ã€‚å› ä¸ºåšwebå¼€å‘å’ŒiOSå¼€å‘æ ¹æœ¬å°±æ˜¯ä¸¤å›äº‹ã€‚å½“ç„¶ï¼Œwebå¼€å‘å‘å±•äº†è¿™ä¹ˆå¤šå¹´ï¼Œå¯¹äºæŸäº›åŠŸèƒ½å®ç°æ˜¯è¦æ¯”native appå¿«ã€‚ä½†å¤šæ•°æƒ…å†µï¼ŒåŒä¸€ä¸ªåŠŸèƒ½ï¼Œå¯¹äºiOSå¼€å‘è€…å’Œwebå¼€å‘è€…ï¼Œç”¨å„è‡ªæ“…é•¿çš„æ–¹å¼å¼€å‘æˆæœ¬éƒ½æœ€ä½ï¼Œæ‰€ä»¥è¯´æŸä¸ªåŠŸèƒ½å¼€å‘æˆæœ¬ä½ï¼Œå¾€å¾€æ˜¯ä¸€ä¸ªä¼ªå‘½é¢˜ã€‚ åˆšåˆšè¯´äº†ï¼Œwebviewçš„ä¼˜åŠ¿åœ¨äºæ›´æ–°ä¸ä¾èµ–ç‰ˆæœ¬ï¼Œé‚£ä¹ˆåœ¨ä¸€æ¬¾Appä¸­ï¼Œåªæœ‰ä¼šé¢‘ç¹æ›´æ–°çš„ç•Œé¢è€ƒè™‘webviewæ‰æœ‰æ„ä¹‰ã€‚é‚£ä¹ˆå“ªäº›ç•Œé¢ä¼šé¢‘ç¹æ›´æ–°ï¼Œè¿™å°±è¦å› Appè€Œå¼‚äº†ã€‚ é¦–é¡µã€‚é¦–é¡µèµ„æºå¯è°“å¿…äº‰ä¹‹åœ°ï¼Œå†…å®¹ä¸€å¤©ä¸€æ¢æ˜¯æ­£å¸¸ç°è±¡ï¼Œä¸€å¤©å‡ æ¢ä¹Ÿä¸ç¨€å¥‡ã€‚è€Œå¦‚æœä»…ä»…æ˜¯å†…å®¹çš„æ›´æ¢ï¼Œéè¦ä¸Šä¸ªwebviewå°±æ˜¾å¾—æœ‰äº›æ¿€è¿›äº†ã€‚è€Œäº‹å®ä¸Šé¦–é¡µçš„å˜åŒ–åƒå¥‡ç™¾æ€ªï¼Œé€¢å¹´è¿‡èŠ‚å˜ä¸ªè„¸ï¼Œç‰¹æ®Šæƒ…å†µæŒ‚ä¸ªå…¬å‘Šï¼Œå¶å°”è¿˜è¦ç‰¹æ‰¹å¼ºæ¨ä¸€æŠŠæŸä¸ªä¸šåŠ¡ï¼Œç­‰ç­‰ã€‚æ­¤å‰ï¼Œæˆ‘åœ¨è®¾è®¡Appé¦–é¡µçš„æ—¶å€™ï¼ŒæŠŠé¦–é¡µé…ç½®è®¾è®¡çš„éå¸¸å¤æ‚ã€‚Appç«¯è¦å¤„ç†nç§æƒ…å†µï¼Œnå„å‚æ•°ï¼Œserverç«¯è¦è®°ä½nç§è§„åˆ™ï¼Œç›´åˆ°ä¸€å¤©ï¼Œæˆ‘å´©æºƒäº†ï¼ŒæŠŠé¦–é¡µå®Œå…¨æ¢æˆwebviewï¼Œæ‰è±ç„¶å¼€æœ—ã€‚ æ´»åŠ¨é¡µã€‚åšäº’è”ç½‘éƒ½çŸ¥é“ï¼Œæ´»åŠ¨ï¼Œæ˜¯ä¸€ä¸ªæœ€å¸¸è§çš„è¿è¥æ‰‹æ®µã€‚ç‰¹ç‚¹æ˜¯ï¼Œå‘¨æœŸçŸ­ï¼ŒåŠŸèƒ½å°‘ï¼Œä½†åŸºæœ¬ä¸èƒ½å¤ç”¨ã€‚è¿™äº›ç‰¹ç‚¹éƒ½æ ‡è¯†äº†æ´»åŠ¨ä¸é€‚åˆåšnativeï¼Œè¦ç”¨webviewå®ç°ã€‚å³ä½¿æœ‰äººå‘Šè¯‰ä½ è¯´ï¼Œæˆ‘çš„æ´»åŠ¨æ˜¯ä¸€ä¸ªé•¿æœŸæ´»åŠ¨è€Œä¸”å½¢å¼ä¸å˜ï¼Œä¹Ÿä¸è¦ç›¸ä¿¡ä»–ã€‚å› ä¸ºåœ¨ç¬¬äºŒæœŸï¼Œç¬¬ä¸‰æœŸï¼Œç¬¬å››æœŸä»–ä¼šåˆ†åˆ«åŠ ä¸Šä¸€äº›éå¸¸è¯¡å¼‚ï¼Œå´æœ‰å¾ˆåˆç†çš„å°å˜æ›´ï¼Œè€Œè¿™äº›å˜æ›´æ˜¯ä½ åœ¨é‚£ä¸ªç‰ˆæœ¬æ ¹æœ¬æ— æ³•å®ç°çš„ã€‚ è¯•æ°´çš„æ–°åŠŸèƒ½ã€‚è¿™ç§ç•Œé¢ï¼Œå¾€å¾€è®¾è®¡ä¸æˆç†Ÿï¼Œéœ€è¦åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸æ–­æ”¶é›†ç”¨æˆ·åé¦ˆï¼Œæ›´æ–°å‡çº§ï¼Œç”šè‡³å†³å®šå»ç•™ã€‚æ‰€ä»¥ï¼Œåªæœ‰webviewæ‰èƒ½holdä½å¦‚æ­¤ä¸ç¨³å®šçš„åŠŸèƒ½ã€‚åˆ‡è®°åœ¨ä¸€ä¸ªåŠŸèƒ½è¿˜æ²¡æœ‰ç¡®å®šä¹‹å‰ï¼Œä¸è¦å¤§å¼ æ——é¼“å•ä½å¼€å‘native codeï¼Œè¦çŸ¥é“ï¼Œä½ å†™çš„è¿™äº›ä»£ç ï¼Œä¸‰å¤©åå°±è¦æ”¹ä¸€éï¼Œè€Œä¸”è¦å‘å¸ƒä¸Šçº¿ã€‚ å¯Œæ–‡æœ¬å†…å®¹ã€‚è¿™ä¸ªä¸ç”¨å¤šè¯´äº†å§ï¼ŒæŒ‰ç…§HTMLçš„å¸¸ç”¨æ ‡ç­¾åšä¸€ä¸ªwebtextå¯ä¸æ˜¯å°å·¥ç¨‹ã€‚è€Œä¸”å¯Œæ–‡æœ¬çš„å˜åŒ–å¤ªå¤šäº†ï¼Œä¸€ç‚¹æ— æ³•åŒ¹é…ï¼Œéƒ½ä¼šå¯¼è‡´æ•´ä¸ªç•Œé¢å·¨ä¸‘ã€‚ OKï¼Œä¸Šè¾¹è¯´äº†æˆ‘è®¤ä¸ºæœ€è¯¥ä½¿ç”¨webviewçš„4ä¸ªç•Œé¢ï¼Œåˆ†åˆ«å¸¦æœ‰ä¸åŒçš„ç‰¹ç‚¹ï¼Œä½†webviewçš„äº¤äº’æ˜¯ä¸ªçŸ­æ¿ï¼Œå› æ­¤webviewåœ¨ä¸€ä¸ªAppä¸­ï¼Œåªèƒ½ä½œä¸ºç•Œé¢ï¼Œä¸å…è®¸åœ¨ç•Œé¢ä¸­å‡ºç°åŠ¨ä½œã€‚è€Œä¸€ä¸ªwebviewçš„ç•Œé¢å¦‚ä½•è·Ÿnative codeç»“åˆèµ·æ¥å‘¢ï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯ï¼Œè¶…é“¾æ¥ã€‚åœ¨webviewä¸Šç‚¹å‡»è¶…é“¾æ¥ï¼Œä¼šè°ƒç”¨webview delegateçš„shouldloadæ–¹æ³•ï¼Œè‡ªè¿™é‡Œæ‹¦æˆªè¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†ã€‚ç”±äºwebviewçš„é“¾æ¥éƒ½æ˜¯URLï¼Œå› æ­¤æˆ‘å»ºè®®ï¼ŒæŠŠæ•´ä¸ªAppçš„ç•Œé¢éƒ½ç”¨URLç®¡ç†èµ·æ¥ã€‚ é•¿ç›¸é—®é¢˜ï¼Œwebviewå¾ˆéš¾é•¿æˆnativeçš„viewã€‚æ–¹æ¡ˆï¼šé•¿ä¸æˆä¹Ÿè¦è£…æˆã€‚åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œç¦ç”¨webviewæ»šåŠ¨ï¼Œä½¿ç”¨æ»šåŠ¨æ¡†æ¶ï¼ˆiScrollä¸é”™ï¼‰å»å®ç°ã€‚webviewä¸Šä¸‹ç•™å‡º200pixelçš„ç©ºç™½èƒŒæ™¯ï¼Œyä»-200å¼€å§‹ã€‚å¦åˆ™å¤§å®¶çŸ¥é“ï¼Œwebviewä¸Šä¸‹ä¼šæœ‰é˜´å½±çš„èƒŒæ™¯ï¼Œä¸è—èµ·æ¥ä¼šå¾ˆä¸‘ã€‚ç­‰ç­‰ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ–¹æ³•å»ä¼ªè£…webviewï¼Œæ˜¯è¦è§†æƒ…æ™¯è€Œç”¨ã€‚ cellä¸­åµŒå¥—webviewï¼Œåœ¨ocä¸­è°ƒç”¨jsè·å–webçš„é«˜åº¦ï¼Œ CGFloat height = [[self.webView stringByEvaluatingJavaScriptFromString:@â€document.body.offsetHeightâ€] floatValue];åœ¨é€šè¿‡webViewDidFinishLoadé‡Œé¢æ›´æ–°è¡Œé«˜ã€‚ awakeFromNibä¸viewdidloadåŒºåˆ« awakefromnibï¼šå½“.nibæ–‡ä»¶è¢«åŠ è½½çš„æ—¶å€™ï¼Œä¼šå‘é€ä¸€ä¸ªawakefromnibæ¶ˆæ¯åˆ°.nibæ–‡ä»¶ä¸­çš„æ¯ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å®šä¹‰è‡ªå·±çš„awakefromnibå‡½æ•°æ¥å“åº”è¿™ä¸ªæ¶ˆæ¯ï¼Œæ‰§è¡Œå¿…è¦æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ é€šè¿‡.nibæ–‡ä»¶åˆ›å»ºviewå¯¹è±¡æ‰§è¡Œawakefromnib viewdidloadï¼šå½“viewå¯¹è±¡è¢«åŠ è½½åˆ°å†…å­˜å°±ä¼šæ‰§è¡Œviewdidloadï¼Œä¸ç®¡æ˜¯é€šè¿‡nibè¿˜æ˜¯ä»£ç å½¢å¼ï¼Œåˆ›å»ºå¯¹è±¡å°±ä¼šæ‰§è¡Œviewdidload layoutSubviewä½•æ—¶è°ƒç”¨? åˆå§‹åŒ–initæ–¹æ³•æ—¶ä¸ä¼šè§¦å‘ æ»šåŠ¨uiscrollviewè§¦å‘ æ—‹è½¬å±å¹•è§¦å‘ æ”¹å˜viewçš„å€¼è§¦å‘ï¼Œå‰ææ˜¯frameæ”¹å˜äº† æ”¹å˜uiviewçš„å¤§å°è§¦å‘ viewcontrollerçš„didreceivememorywaringåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨ é»˜è®¤æ“ä½œæ˜¯ä»€ä¹ˆ åº”ç”¨ç¨‹åºæ”¶åˆ°æ¥è‡ªç³»ç»Ÿçš„å†…å­˜è­¦å‘Šæ—¶ï¼Œè°ƒç”¨didreceivememorywaringæ–¹æ³• é»˜è®¤åšæ³•ï¼šæ§åˆ¶å™¨ä¸Šçš„viewä¸å†çª—å£ä¸Šæ˜¾ç¤ºæ—¶ï¼Œè°ƒç”¨viewWillUnloadï¼Œç›´æ¥é”€æ¯viewï¼Œå¹¶è°ƒç”¨viewdidunload UIWindowå’ŒUIViewå’Œ CALayer çš„è”ç³»å’ŒåŒºåˆ«? UIViewæ˜¯è§†å›¾çš„åŸºç±»ï¼ŒUIViewControlleræ˜¯è§†å›¾æ§åˆ¶å™¨çš„åŸºç±»ï¼ŒUIResponderæ˜¯è¡¨ç¤ºä¸€ä¸ªå¯ä»¥åœ¨å±å¹•ä¸Šå“åº”è§¦æ‘¸äº‹ä»¶çš„å¯¹è±¡ï¼› UIwindowæ˜¯UIViewçš„å­ç±»ï¼ŒUIWindowçš„ä¸»è¦ä½œç”¨ï¼šä¸€æ˜¯æä¾›ä¸€ä¸ªåŒºåŸŸæ¥æ˜¾ç¤ºUIViewï¼ŒäºŒæ˜¯å°†äº‹ä»¶ï¼ˆeventï¼‰çš„åˆ†å‘ç»™UIViewï¼Œä¸€ä¸ªåº”ç”¨åŸºæœ¬ä¸Šåªæœ‰ä¸€ä¸ªUIWindow. å›¾å±‚ä¸ä¼šç›´æ¥æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼ŒUIViewæ˜¯iOSç³»ç»Ÿä¸­ç•Œé¢å…ƒç´ çš„åŸºç¡€ï¼Œæ‰€æœ‰çš„ç•Œé¢å…ƒç´ éƒ½æ˜¯ç»§æ‰¿è‡ªå®ƒã€‚å®ƒæœ¬èº«å®Œå…¨æ˜¯ç”±CoreAnimationæ¥å®ç°çš„ã€‚å®ƒçœŸæ­£çš„ç»˜å›¾éƒ¨åˆ†ï¼Œæ˜¯ç”±ä¸€ä¸ªCALayerç±»æ¥ç®¡ç†ã€‚UIViewæœ¬èº«æ›´åƒæ˜¯ä¸€ä¸ªCALayerçš„ç®¡ç†å™¨ã€‚ä¸€ä¸ªUIViewä¸Šå¯ä»¥æœ‰nä¸ªCALayerï¼Œæ¯ä¸ªlayeræ˜¾ç¤ºä¸€ç§ä¸œè¥¿ï¼Œå¢å¼ºUIViewçš„å±•ç°èƒ½åŠ›ã€‚ éƒ½å¯ä»¥æ˜¾ç¤ºå±å¹•æ•ˆæœ å¦‚æœéœ€è¦ç”¨æˆ·äº¤äº’å°±è¦ç”¨UIVIew,å…¶å¯æ¥æ”¶è§¦æ‘¸äº‹ä»¶(ç»§æ‰¿UIResponder),è€ŒCALayerä¸èƒ½æ¥æ”¶è§¦æ‘¸äº‹ä»¶ å¦‚æœæ²¡æœ‰ç”¨æˆ·äº¤äº’å¯é€‰ç”¨CALayer,å› ä¸ºå…¶æ‰€åœ¨åº“è¾ƒå°,å ç”¨çš„èµ„æºè¾ƒå°‘ UIScrollView contentsize å†…å®¹è§†å›¾çš„å°ºå¯¸ contentoffset å†…å®¹è§†å›¾å½“å‰ä½ç½®ç›¸å¯¹æ»šåŠ¨è§†å›¾frameçš„åç§»é‡ contentinset å†…å®¹è§†å›¾ç›¸å¯¹æ»šåŠ¨è§†å›¾frameçš„å±•ç¤ºåŸç‚¹ å¦‚ä½•å®ç°ç€‘å¸ƒæµ,æµæ°´å¸ƒå±€ ä½¿ç”¨UICollectionView ä½¿ç”¨è‡ªå®šä¹‰çš„FlowLayout éœ€è¦åœ¨layoutAttributesForElementsInRectä¸­è®¾ç½®è‡ªå®šä¹‰çš„å¸ƒå±€(itemçš„frame) åœ¨ prepareLayoutä¸­è®¡ç®—å¸ƒå±€ éå†æ•°æ®å†…å®¹,æ ¹æ®ç´¢å¼•å–å‡ºå¯¹åº”çš„attributes(ä½¿ç”¨layoutAttributesForCellWithIndexPath),æ ¹æ®ä¹å®«æ ¼ç®—æ³•è®¾ç½®å¸ƒå±€ ç»†èŠ‚1: å®æ—¶å¸ƒå±€,é‡å†™shouldInvalidateLayoutForBoundsChange(boundsæ”¹å˜é‡æ–°å¸ƒå±€,scrollviewçš„contentoffset&gt;bounds) ç»†èŠ‚2: è®¡ç®—è®¾ç½®itemsize(ä¿è¯å†…å®¹æ˜¾ç¤ºå®Œæ•´,uicollectionviewçš„content sizeæ˜¯æ ¹æ®itemizeè®¡ç®—çš„),æ ¹æ®åˆ—æœ€å¤§é«˜åº¦/å¯¹åº”åˆ—æ•°é‡æ±‚å‡º,æœ€å¤§é«˜åº¦ç´¯åŠ å¾—åˆ° ç»†èŠ‚3: è¿½åŠ itemåˆ°æœ€çŸ­åˆ—,é¿å…åº•éƒ¨å‚å·®ä¸é½. UIImageæœ‰å“ªå‡ ç§åŠ è½½æ–¹å¼ äºŒè¿›åˆ¶ imageWithData Bundle imageWithName æœ¬åœ°è·¯å¾„ imageWithContentOfFile æè¿°ä¹å®«æ ¼ç®—æ³• NSInteger col = x;//å®šä¹‰åˆ—æ•° NSInteger index = self.shopsView.subviews.count;//è·å–ä¸‹æ ‡ CGFloat margin = (self.shopsView.frame.size.width - col*viewW) / (col - 1);//å®šä¹‰é—´éš” CGFloat viewX = (index % col ) * (viewW + margin); CGFloat viewY = (index / col ) * (viewH + 10); å®ç°å›¾ç‰‡è½®æ’­å›¾ ScrollViewåªéœ€è¦è®¾ç½®ä¸‰ä¸ªImageViewå³å¯ï¼Œå¹¶ä¸”é»˜è®¤æ˜¾ç¤ºä¸­é—´çš„ImageView æ ¹æ®ScrollViewçš„ç§»åŠ¨æƒ…å†µï¼Œè¿…é€Ÿå˜åŒ–ä¸‰ä¸ªImageViewä¸­å›¾ç‰‡æ•°æ® ImageViewæ›´æ–°å®Œæ¯•åï¼Œå·å·æŠŠScrollViewæ‹‰å›åˆ°ä¸­é—´çš„ImageViewä½ç½®ï¼Œè¿™æ ·è§†è§‰æ•ˆæœä¸Šå°±å®ç°äº†æ— é™å¾ªç¯çš„æ•ˆæœ åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ -(BOOL)application:(UIApplication )application willFinishLaunchingWithOptions:(NSDictionary )launchOptions å‘Šè¯‰ä»£ç†è¿›ç¨‹å¯åŠ¨ä½†è¿˜æ²¡è¿›å…¥çŠ¶æ€ä¿å­˜ -(BOOL)application:(UIApplication )application didFinishLaunchingWithOptions:(NSDictionary )launchOptions å‘Šè¯‰ä»£ç†å¯åŠ¨åŸºæœ¬å®Œæˆç¨‹åºå‡†å¤‡å¼€å§‹è¿è¡Œ -(void)applicationWillResignActive:(UIApplication *)application å½“åº”ç”¨ç¨‹åºå°†è¦å…¥éæ´»åŠ¨çŠ¶æ€æ‰§è¡Œï¼Œåœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºä¸æ¥æ”¶æ¶ˆæ¯æˆ–äº‹ä»¶ï¼Œæ¯”å¦‚æ¥ç”µè¯äº† -(void)applicationDidBecomeActive:(UIApplication *)application å½“åº”ç”¨ç¨‹åºå…¥æ´»åŠ¨çŠ¶æ€æ‰§è¡Œï¼Œè¿™ä¸ªåˆšå¥½è·Ÿä¸Šé¢é‚£ä¸ªæ–¹æ³•ç›¸å -(void)applicationDidEnterBackground:(UIApplication *)application å½“ç¨‹åºè¢«æ¨é€åˆ°åå°çš„æ—¶å€™è°ƒç”¨ã€‚æ‰€ä»¥è¦è®¾ç½®åå°ç»§ç»­è¿è¡Œï¼Œåˆ™åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢è®¾ç½®å³å¯ -(void)applicationWillEnterForeground:(UIApplication *)application å½“ç¨‹åºä»åå°å°†è¦é‡æ–°å›åˆ°å‰å°æ—¶å€™è°ƒç”¨ï¼Œè¿™ä¸ªåˆšå¥½è·Ÿä¸Šé¢çš„é‚£ä¸ªæ–¹æ³•ç›¸åã€‚ -(void)applicationWillTerminate:(UIApplication *)application å½“ç¨‹åºå°†è¦é€€å‡ºæ˜¯è¢«è°ƒç”¨ï¼Œé€šå¸¸æ˜¯ç”¨æ¥ä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œã€‚ load initializeæ–¹æ³•çš„åŒºåˆ« +(void)load; å½“ç±»å¯¹è±¡è¢«å¼•å…¥é¡¹ç›®æ—¶, runtime ä¼šå‘æ¯ä¸€ä¸ªç±»å¯¹è±¡å‘é€ load æ¶ˆæ¯ load æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªç±»ç”šè‡³åˆ†ç±»è¢«å¼•å…¥æ—¶ä»…è°ƒç”¨ä¸€æ¬¡,è°ƒç”¨çš„é¡ºåºï¼šçˆ¶ç±»ä¼˜å…ˆäºå­ç±», å­ç±»ä¼˜å…ˆäºåˆ†ç±» load æ–¹æ³•ä¸ä¼šè¢«ç±»è‡ªåŠ¨ç»§æ‰¿ +(void)initialize; ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªç±»çš„æ—¶å€™ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³• UIScrollView å¤§æ¦‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå®ƒæ˜¯å¦‚ä½•æ•æ‰ã€å“åº”æ‰‹åŠ¿çš„ï¼Ÿ æˆ‘å¯¹UIScrollViewçš„ç†è§£æ˜¯frameå°±æ˜¯ä»–çš„contentSize,boundså°±æ˜¯ä»–çš„å¯è§†èŒƒå›´,é€šè¿‡æ”¹å˜boundsä»è€Œè¾¾åˆ°è®©ç”¨æˆ·è¯¯ä»¥ä¸ºåœ¨æ»šåŠ¨,ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„UIScrollViewå®ç° ç¬¬äºŒä¸ªé—®é¢˜ä¸ªäººç†è§£æ˜¯è§£å†³æ‰‹åŠ¿å†²çª,å¯¹è‡ªå·±æ·»åŠ çš„æ‰‹åŠ¿è¿›è¡Œæ•è·å’Œå“åº” // è®©UIScrollViewéµå®ˆUIGestureRecognizerDelegateåè®®,å®ç°è¿™ä¸ªæ–¹æ³•,åœ¨è¿™é‡Œæ–¹æ³•é‡Œå¯¹æ·»åŠ çš„æ‰‹åŠ¿è¿›è¡Œå¤„ç†å°±å¯ä»¥è§£å†³å†²çª (BOOL)gestureRecognizer:(UIGestureRecognizer )gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer:(UIGestureRecognizer )otherGestureRecognizer +[UIView animateWithDuration:animations:completion:] å†…éƒ¨å¤§æ¦‚æ˜¯å¦‚ä½•å®ç°çš„ï¼ŸanimateWithDuration:è¿™å°±ç­‰äºåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ animations:è¿™æ˜¯åˆ›å»ºå®šæ—¶å™¨éœ€è¦å®ç°çš„SEL completion:æ˜¯å®šæ—¶å™¨ç»“æŸä»¥åçš„ä¸€ä¸ªå›è°ƒblock ä»€ä¹ˆæ—¶å€™ä¼šå‘ç”Ÿã€Œéšå¼åŠ¨ç”»ã€ï¼Ÿ å½“æ”¹å˜CALayerçš„ä¸€ä¸ªå¯åšåŠ¨ç”»çš„å±æ€§ï¼Œå®ƒå¹¶ä¸èƒ½ç«‹åˆ»åœ¨å±å¹•ä¸Šä½“ç°å‡ºæ¥.ç›¸åï¼Œå®ƒæ˜¯ä»å…ˆå‰çš„å€¼å¹³æ»‘è¿‡æ¸¡åˆ°æ–°çš„å€¼ã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯é»˜è®¤çš„è¡Œä¸ºï¼Œä½ ä¸éœ€è¦åšé¢å¤–çš„æ“ä½œ,è¿™å°±æ˜¯éšå¼åŠ¨ç”» å¦‚ä½•æŠŠä¸€å¼ å¤§å›¾ç¼©å°ä¸º1/4å¤§å°çš„ç¼©ç•¥å›¾ï¼ŸimgData = UIImageJPEGRepresentation(image, 0.6f) å½“TableViewçš„Cellæ”¹å˜æ—¶ï¼Œå¦‚ä½•è®©è¿™äº›æ”¹å˜ä»¥åŠ¨ç”»çš„å½¢å¼å‘ˆç°ï¼Ÿ[tableView deselectRowAtIndexPath:indexPath animated:TRUE]; // é‡ç‚¹æ˜¯è¿™2å¥ä»£ç å®ç°çš„åŠŸèƒ½ [tableView beginUpdates]; [tableView endUpdates]; ä¸ºä»€ä¹ˆå½“ Core Animation å®Œæˆæ—¶ï¼Œlayer åˆä¼šæ¢å¤åˆ°åŸå…ˆçš„çŠ¶æ€ï¼Ÿ å› ä¸ºè¿™äº›äº§ç”Ÿçš„åŠ¨ç”»åªæ˜¯å‡è±¡,å¹¶æ²¡æœ‰å¯¹layerè¿›è¡Œæ”¹å˜.é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢,è¿™é‡Œè¦è®²ä¸€ä¸‹å›¾å±‚æ ‘é‡Œçš„å‘ˆç°æ ‘.å‘ˆç°æ ‘å®é™…ä¸Šæ˜¯æ¨¡å‹å›¾å±‚çš„å¤åˆ¶,ä½†æ˜¯å®ƒçš„å±æ€§å€¼è¡¨ç¤ºäº†å½“å‰å¤–è§‚æ•ˆæœ,åŠ¨ç”»çš„è¿‡ç¨‹å®é™…ä¸Šåªæ˜¯ä¿®æ”¹äº†å‘ˆç°æ ‘,å¹¶æ²¡æœ‰å¯¹å›¾å±‚çš„å±æ€§è¿›è¡Œæ”¹å˜,æ‰€ä»¥åœ¨åŠ¨ç”»ç»“æŸä»¥åå›¾å±‚ä¼šæ¢å¤åˆ°åŸå…ˆçŠ¶æ€ è®¾è®¡ä¸€ä¸ªè¿›åº¦æ¡ã€‚ è‡ªå®šä¹‰ä¸€ä¸ªUIViewçš„å­ç±» //æä¾›ä¸€ä¸ªæˆå‘˜å±æ€§ï¼Œæ¥æ”¶ä¸‹è½½è¿›åº¦å€¼ @property (nonatomic, assign) CGFloat progress; é‡å†™æˆå‘˜å±æ€§progressçš„setter //æ¯æ¬¡æ”¹å˜æˆå‘˜å±æ€§progressçš„å€¼ï¼Œå°±ä¼šè°ƒç”¨å®ƒçš„setter -(void)setProgress:(CGFloat)progress { _progress = progress; //å½“ä¸‹è½½è¿›åº¦æ”¹å˜æ—¶ï¼Œæ‰‹åŠ¨è°ƒç”¨é‡ç»˜æ–¹æ³• [self setNeedsDisplay]; } é‡å†™ -(void)drawRect:(CGRect)rectï¼ˆæ ¸å¿ƒï¼‰ -(void)drawRect:(CGRect)rect { //è®¾ç½®åœ†å¼§çš„åŠå¾„ CGFloat radius = rect.size.width * 0.5; //è®¾ç½®åœ†å¼§çš„åœ†å¿ƒ CGPoint center = CGPointMake(radius, radius); //è®¾ç½®åœ†å¼§çš„å¼€å§‹çš„è§’åº¦ï¼ˆå¼§åº¦åˆ¶ï¼‰ CGFloat startAngle = - M_PI_2; //è®¾ç½®åœ†å¼§çš„ç»ˆæ­¢è§’åº¦ CGFloat endAngle = - M_PI_2 + 2 * M_PI * self.progress; //ä½¿ç”¨UIBezierPathç±»ç»˜åˆ¶åœ†å¼§ UIBezierPath *path = [UIBezierPath bezierPathWithArcCenter:center radius:radius - 5 startAngle:startAngle endAngle:endAngle clockwise:YES]; //å°†ç»˜åˆ¶çš„åœ†å¼§æ¸²æŸ“åˆ°å›¾å±‚ä¸Šï¼ˆå³æ˜¾ç¤ºå‡ºæ¥ï¼‰ [path stroke]; } å¦‚ä½•æ’­æ”¾ GIF å›¾ç‰‡ï¼Œæœ‰ä»€ä¹ˆä¼˜åŒ–æ–¹æ¡ˆä¹ˆï¼Ÿ UIImageViewç”¨æ¥æ˜¾ç¤ºå›¾ç‰‡ï¼Œ ä½¿ç”¨UIImageViewä¸­çš„åŠ¨ç”»æ•°ç»„æ¥å®ç°å›¾ç‰‡çš„åŠ¨ç”»æ•ˆæœ ç”¨UIWebViewæ¥æ˜¾ç¤ºåŠ¨æ€å›¾ç‰‡ ç¬¬ä¸‰æ–¹æ˜¾ç¤ºæ¡†æ¶ é€šè¿‡UIImageViewæ˜¾ç¤ºåŠ¨ç”»æ•ˆæœï¼Œå®é™…ä¸Šæ˜¯æŠŠåŠ¨æ€çš„å›¾æ‹†æˆäº†ä¸€ç»„é™æ€çš„å›¾ï¼Œæ”¾åˆ°æ•°ç»„ä¸­ï¼Œæ’­æ”¾çš„æ—¶å€™ä¾æ¬¡ä»æ•°ç»„ä¸­å–å‡ºã€‚å¦‚æœæ’­æ”¾çš„å›¾ç‰‡æ¯”è¾ƒå°‘å å¾—å†…å­˜æ¯”è¾ƒå°æˆ–è€…æ¯”è¾ƒå¸¸ç”¨ï¼ˆæ¯”å¦‚å·¥å…·æ¡ä¸Šä¸€ç›´æ˜¾ç¤ºçš„åŠ¨æ€å°å›¾æ ‡ï¼‰ï¼Œå¯ä»¥é€‰æ‹©ç”¨imageNamedï¼šæ–¹å¼è·å–å›¾ç‰‡ï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼åŠ åˆ°å†…å­˜ä¸­ï¼Œä½¿ç”¨ç»“æŸï¼Œä¸ä¼šè‡ªå·±é‡Šæ”¾ï¼Œå¤šæ¬¡æ’­æ”¾åŠ¨ç”»ä¼šé€ æˆå†…å­˜æº¢å‡ºé—®é¢˜ã€‚å› æ­¤ï¼Œå¯¹äºå¤§å›¾æˆ–ç»å¸¸æ›´æ¢çš„å›¾ï¼Œåœ¨å–å›¾ç‰‡çš„æ—¶å€™å¯ä»¥é€‰æ‹©imageWithContentsOfFile:æ–¹å¼è·å–å›¾ç‰‡ï¼Œä¼˜åŒ–å†…å­˜ã€‚ ä½¿ç”¨UIWebViewæ˜¾ç¤ºå›¾ç‰‡éœ€è¦æ³¨æ„æ˜¾ç¤ºå›¾ç‰‡çš„å°ºå¯¸ä¸UIWebViewå°ºå¯¸çš„è®¾ç½®ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†æ˜¾ç¤ºåŠ¨æ€å›¾ç‰‡ï¼Œå¯ä»¥ç¦æ­¢UIWebViewæ»šåŠ¨ã€‚åœ¨æ˜¾ç¤ºåŠ¨æ€å›¾ç‰‡çš„æ—¶å€™ï¼Œå³ä½¿æ˜¯åŠ¨å›¾çš„èƒŒæ™¯å¤„ä¸ºé€æ˜ï¼Œé»˜è®¤æ˜¾ç¤ºå‡ºæ¥æ˜¯ç™½è‰²èƒŒæ™¯ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ‰‹åŠ¨è®¾ç½®UIWebViewçš„é€æ˜æ‰èƒ½è¾¾åˆ°æ˜¾ç¤ºåŠ¨å›¾èƒŒæ™¯é€æ˜çš„æ•ˆæœã€‚ æœ‰å“ªå‡ ç§æ–¹å¼å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾ï¼Œä½¿ç”¨ CoreGraphics ç¼©æ”¾æ—¶æœ‰ä»€ä¹ˆæ³¨æ„äº‹é¡¹ï¼Ÿ UIImageViewæ•´ä½“æ‹‰ä¼¸ UIImageå±€éƒ¨æ‹‰ä¼¸ UIImageä¿®æ”¹å¤§å° images.xcassetsï¼šå¤šäºäº†Xcodeä¸­Asset Catalogçš„sliceå’Œdiceï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»£ç ä¹Ÿèƒ½æ‹‰ä¼¸å›¾ç‰‡ã€‚é¦–å…ˆåœ¨Xcodeä¸­é€‰ä¸­å›¾ç‰‡ï¼Œç„¶åç‚¹å‡»å³ä¸‹è§’çš„Show Slicingï¼š å›¾å½¢ä¸Šä¸‹æ–‡ç­‰æ¯”ä¾‹ç¼©æ”¾ XIBä¸Storyboardsçš„ä¼˜ç¼ºç‚¹?- XIBï¼šåœ¨ç¼–è¯‘å‰å°±æä¾›äº†å¯è§†åŒ–ç•Œé¢ï¼Œå¯ä»¥ç›´æ¥æ‹–æ§ä»¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç»™æ§ä»¶æ·»åŠ çº¦æŸï¼Œæ›´ç›´è§‚ä¸€äº›ï¼Œè€Œä¸”ç±»æ–‡ä»¶ä¸­å°±å°‘äº†åˆ›å»ºæ§ä»¶çš„ä»£ç ï¼Œç¡®å®ç®€åŒ–ä¸å°‘ï¼Œé€šå¸¸æ¯ä¸ªXIBå¯¹åº”ä¸€ä¸ªç±»ã€‚ - Storyboardï¼šåœ¨ç¼–è¯‘å‰æä¾›äº†å¯è§†åŒ–ç•Œé¢ï¼Œå¯æ‹–æ§ä»¶ï¼Œå¯åŠ çº¦æŸï¼Œåœ¨å¼€å‘æ—¶æ¯”è¾ƒç›´è§‚ï¼Œè€Œä¸”ä¸€ä¸ªstoryboardå¯ä»¥æœ‰å¾ˆå¤šçš„ç•Œé¢ï¼Œæ¯ä¸ªç•Œé¢å¯¹åº”ä¸€ä¸ªç±»æ–‡ä»¶ï¼Œé€šè¿‡storybardï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹å‡ºæ•´ä¸ªAppçš„ç»“æ„ã€‚ - XIBï¼šéœ€æ±‚å˜åŠ¨æ—¶ï¼Œéœ€è¦ä¿®æ”¹XIBå¾ˆå¤§ï¼Œæœ‰æ—¶å€™ç”šè‡³éœ€è¦é‡æ–°æ·»åŠ çº¦æŸï¼Œå¯¼è‡´å¼€å‘å‘¨æœŸå˜é•¿ã€‚XIBè½½å…¥ç›¸æ¯”çº¯ä»£ç è‡ªç„¶è¦æ…¢ä¸€äº›ã€‚å¯¹äºæ¯”è¾ƒå¤æ‚é€»è¾‘æ§åˆ¶ä¸åŒçŠ¶æ€ä¸‹æ˜¾ç¤ºä¸åŒå†…å®¹æ—¶ï¼Œä½¿ç”¨XIBæ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚å½“å¤šäººå›¢é˜Ÿæˆ–è€…å¤šå›¢é˜Ÿå¼€å‘æ—¶ï¼Œå¦‚æœXIBæ–‡ä»¶è¢«å‘åŠ¨ï¼Œææ˜“å¯¼è‡´å†²çªï¼Œè€Œä¸”è§£å†³å†²çªç›¸å¯¹è¦å›°éš¾å¾ˆå¤šã€‚ - Storyboardï¼šéœ€æ±‚å˜åŠ¨æ—¶ï¼Œéœ€è¦ä¿®æ”¹storyboardä¸Šå¯¹åº”çš„ç•Œé¢çš„çº¦æŸï¼Œä¸XIBä¸€æ ·å¯èƒ½è¦é‡æ–°æ·»åŠ çº¦æŸï¼Œæˆ–è€…æ·»åŠ çº¦æŸä¼šé€ æˆå¤§é‡çš„å†²çªï¼Œå°¤å…¶æ˜¯å¤šå›¢é˜Ÿå¼€å‘ã€‚å¯¹äºå¤æ‚é€»è¾‘æ§åˆ¶ä¸åŒæ˜¾ç¤ºå†…å®¹æ—¶ï¼Œæ¯”è¾ƒå›°éš¾ã€‚å½“å¤šäººå›¢é˜Ÿæˆ–è€…å¤šå›¢é˜Ÿå¼€å‘æ—¶ï¼Œå¤§å®¶ä¼šåŒæ—¶ä¿®æ”¹ä¸€ä¸ªstoryboardï¼Œå¯¼è‡´å¤§é‡å†²çªï¼Œè§£å†³èµ·æ¥ç›¸å½“å›°éš¾ã€‚ æ§åˆ¶å™¨Viewçš„åŠ è½½è¿‡ç¨‹ï¼Ÿå½“ç¨‹åºè®¿é—®äº†æ§åˆ¶å™¨çš„Viewå±æ€§æ—¶ä¼šå…ˆåˆ¤æ–­æ§åˆ¶å™¨çš„Viewæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±ç›´æ¥è¿”å›å·²ç»å­˜åœ¨çš„Viewï¼› å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šå…ˆè°ƒç”¨loadViewè¿™ä¸ªæ–¹æ³•ï¼›å¦‚æœæ§åˆ¶å™¨çš„loadViewæ–¹æ³•å®ç°äº†ï¼Œå°±ä¼šæŒ‰ç…§loadViewæ–¹æ³•åŠ è½½è‡ªå®šä¹‰çš„Viewï¼› å¦‚æœæ§åˆ¶å™¨çš„loadViewæ–¹æ³•æ²¡æœ‰å®ç°å°±ä¼šåˆ¤æ–­storyboardæ˜¯å¦å­˜åœ¨ï¼› å¦‚æœstoryboardå­˜åœ¨å°±ä¼šæŒ‰ç…§storyboardåŠ è½½æ§åˆ¶å™¨çš„Viewï¼›å¦‚æœstoryboardä¸å­˜åœ¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªç©ºè§†å›¾è¿”å›ã€‚ åº”ç”¨ç¨‹åºçš„å¯åŠ¨æµç¨‹ï¼Ÿ1.æ‰§è¡ŒMain 2.æ‰§è¡ŒUIApplicationMainå‡½æ•°. 3.åˆ›å»ºUIApplicationå¯¹è±¡,å¹¶è®¾ç½®UIApplicationMainå¯¹è±¡çš„ä»£ç†. UIApplicationçš„ç¬¬ä¸‰ä¸ªå‚æ•°å°±æ˜¯UIApplicationçš„åç§°,å¦‚æœæŒ‡å®šä¸ºnil,å®ƒä¼šé»˜è®¤ä¸ºUIApplication. UIApplicationçš„ç¬¬å››ä¸ªå‚æ•°ä¸ºUIApplicationçš„ä»£ç†. 4.å¼€å¯ä¸€ä¸ªä¸»è¿è¡Œå¾ªç¯.ä¿è¯åº”ç”¨ç¨‹åºä¸é€€å‡º. 5.åŠ è½½info.plist.åŠ è½½é…ç½®æ–‡ä»¶.åˆ¤æ–­ä¸€ä¸‹info.plistæ–‡ä»¶å½“ä¸­æœ‰æ²¡æœ‰Main storyboard file base nameé‡Œé¢æœ‰æ²¡æœ‰æŒ‡å®šstoryboardæ–‡ä»¶,å¦‚æœæœ‰å°±å»åŠ è½½info.plistæ–‡ä»¶,å¦‚æœæ²¡æœ‰,é‚£ä¹ˆåº”ç”¨ç¨‹åºåŠ è½½å®Œæ¯•. äº‹ä»¶ä¼ é€’ä¸å“åº”çš„å®Œæ•´è¿‡ç¨‹?åœ¨äº§ç”Ÿä¸€ä¸ªäº‹ä»¶æ—¶,ç³»ç»Ÿä¼šå°†è¯¥äº‹ä»¶åŠ å…¥åˆ°ä¸€ä¸ªç”±UIApplicationç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­, UIApplicationä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶,å°†å®ƒä¼ é€’ç»™å…ˆå‘é€äº‹ä»¶ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£. ä¸»çª—å£ä¼šè°ƒç”¨hitTestæ–¹æ³•å¯»æ‰¾æœ€é€‚åˆçš„è§†å›¾æ§ä»¶,æ‰¾åˆ°åå°±ä¼šè°ƒç”¨è§†å›¾æ§ä»¶çš„touchesæ–¹æ³•æ¥åšå…·ä½“çš„äº‹æƒ…. å½“è°ƒç”¨touchesæ–¹æ³•,å®ƒçš„é»˜è®¤åšæ³•, å°±ä¼šå°†äº‹ä»¶é¡ºç€å“åº”è€…é“¾æ¡å¾€ä¸Šä¼ é€’ï¼Œ ä¼ é€’ç»™ä¸Šä¸€ä¸ªå“åº”è€…,æ¥ç€å°±ä¼šè°ƒç”¨ä¸Šä¸€ä¸ªå“åº”è€…çš„touchesæ–¹æ³• ä¸‹åˆ—å›è°ƒæœºåˆ¶çš„ç†è§£ä¸æ­£ç¡®çš„æ˜¯A target-actionï¼šå½“ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æœ‰â½è¾ƒç´§å¯†çš„å…³ç³»æ—¶ï¼Œå¦‚è§†å›¾æ§åˆ¶å™¨ä¸å…¶ä¸‹çš„æŸä¸ªè§†å›¾ã€‚ B delegateï¼šå½“æŸä¸ªå¯¹è±¡æ”¶åˆ°å¤šä¸ªäº‹ä»¶ï¼Œå¹¶è¦æ±‚åŒä¸€ä¸ªå¯¹è±¡æ¥å¤„ç†æ‰€æœ‰äº‹ä»¶æ—¶ã€‚å§”æ‰˜æœºåˆ¶å¿…é¡»ä¾èµ–äºæŸä¸ªåè®®å®šä¹‰çš„â½…æ³•æ¥å‘é€æ¶ˆæ¯ã€‚ C NSNotificationï¼šå½“éœ€è¦å¤šä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªæ— å…³å¯¹è±¡å¤„ç†åŒä¸€ä¸ªäº‹ä»¶æ—¶ã€‚ D Blockï¼šé€‚â½¤äºå›è°ƒåªå‘â½£ç”Ÿä¸€æ¬¡çš„ç®€å•ä»»åŠ¡ã€‚ å‚è€ƒç­”æ¡ˆï¼šB ç»™UIImageViewæ·»åŠ åœ†è§’ æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨å¦‚ä¸‹å±æ€§è®¾ç½®ï¼š imgView.layer.cornerRadius = 10; // è¿™ä¸€è¡Œä»£ç æ˜¯å¾ˆæ¶ˆè€—æ€§èƒ½çš„ imgView.clipsToBounds = YES; å¥½å¤„æ˜¯ä½¿ç”¨ç®€å•ï¼Œæ“ä½œæ–¹ä¾¿ã€‚åå¤„æ˜¯ç¦»å±æ¸²æŸ“ï¼ˆoff-screen-renderingï¼‰éœ€è¦æ¶ˆè€—æ€§èƒ½ã€‚å¯¹äºå›¾ç‰‡æ¯”è¾ƒå¤šçš„è§†å›¾ä¸Šï¼Œä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥è®¾ç½®åœ†è§’ã€‚é€šå¸¸æ¥è¯´ï¼Œè®¡ç®—æœºç³»ç»Ÿä¸­CPUã€GPUã€æ˜¾ç¤ºå™¨æ˜¯ååŒå·¥ä½œçš„ã€‚CPUè®¡ç®—å¥½æ˜¾ç¤ºå†…å®¹æäº¤åˆ°GPUï¼ŒGPUæ¸²æŸ“å®Œæˆåå°†æ¸²æŸ“ç»“æœæ”¾å…¥å¸§ç¼“å†²åŒºã€‚ ç®€å•æ¥è¯´ï¼Œç¦»å±æ¸²æŸ“ï¼Œå¯¼è‡´æœ¬è¯¥GPUå¹²çš„æ´»ï¼Œç»“æœäº¤ç»™äº†CPUæ¥å¹²ï¼Œè€ŒCPUåˆä¸æ“…é•¿GPUå¹²çš„æ´»ï¼Œäºæ˜¯æ‹–æ…¢äº†UIå±‚çš„FPSï¼ˆæ•°æ®å¸§ç‡ï¼‰ï¼Œå¹¶ä¸”ç¦»å±éœ€è¦åˆ›å»ºæ–°çš„ç¼“å†²åŒºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› æ­¤æ¶ˆè€—è¾ƒå¤§çš„æ€§èƒ½ã€‚ ç»™UIImageæ·»åŠ ç”Ÿæˆåœ†è§’å›¾ç‰‡çš„æ‰©å±•APIï¼š - (UIImage *)hyb_imageWithCornerRadius:(CGFloat)radius { CGRect rect = (CGRect){0.f, 0.f, self.size}; UIGraphicsBeginImageContextWithOptions(self.size, NO, UIScreen.mainScreen.scale); CGContextAddPath(UIGraphicsGetCurrentContext(), [UIBezierPath bezierPathWithRoundedRect:rect cornerRadius:radius].CGPath); CGContextClip(UIGraphicsGetCurrentContext()); [self drawInRect:rect]; UIImage *image = UIGraphicsGetImageFromCurrentImageContext(); UIGraphicsEndImageContext(); return image; } ç„¶åè°ƒç”¨æ—¶å°±ç›´æ¥ä¼ ä¸€ä¸ªåœ†è§’æ¥å¤„ç†ï¼š imgView.image = [[UIImage imageNamed:@&quot;test&quot;] hyb_imageWithCornerRadius:4]; è¿™ä¹ˆåšå°±æ˜¯on-screen-renderingäº†ï¼Œé€šè¿‡æ¨¡æ‹Ÿå™¨-&gt;debug-&gt;Color Off-screen-renderingçœ‹åˆ°æ²¡æœ‰ç¦»å±æ¸²æŸ“äº†!ï¼ˆé»„è‰²çš„å°åœ†è§’æ²¡æœ‰æ˜¾ç¤ºäº†ï¼Œè¯´æ˜è¿™ä¸ªä¸æ˜¯ç¦»å±æ¸²æŸ“äº†ï¼‰ åœ¨ç”»ä¹‹å‰å…ˆé€šè¿‡UIBezierPathæ·»åŠ è£å‰ªï¼Œä½†æ˜¯è¿™ç§ä¸å®ç”¨ - (void)drawRect:(CGRect)rect { CGRect bounds = self.bounds; [[UIBezierPath bezierPathWithRoundedRect:rect cornerRadius:8.0] addClip]; [self.image drawInRect:bounds]; } é€šè¿‡maské®ç½©å®ç° ä¸€ä¸ªviewå·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œviewä¸Šé¢æ·»åŠ äº†nä¸ªbuttonï¼ˆå¯èƒ½ä½¿ç”¨å¾ªç¯åˆ›å»ºï¼‰ï¼Œé™¤ç”¨viewçš„tagä¹‹å¤–ï¼Œè¿˜å¯ä»¥é‡‡ç”¨ä»€ä¹ˆåŠæ³•æ¥æ‰¾åˆ°è‡ªå·±æƒ³è¦çš„buttonæ¥ä¿®æ”¹Buttonçš„å€¼è¿™ä¸ªé—®é¢˜æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œè€Œä¸”ä¸åŒçš„ä½¿ç”¨åœºæ™¯ä¹Ÿä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚è¯´ï¼š â€¢ ç¬¬ä¸€ç§ï¼šå¦‚æœæ˜¯ç‚¹å‡»æŸä¸ªæŒ‰é’®åï¼Œæ‰ä¼šåˆ·æ–°å®ƒçš„å€¼ï¼Œå…¶å®ƒä¸ç”¨ä¿®æ”¹ï¼Œé‚£ä¹ˆä¸ç”¨å¼•ç”¨ä»»ä½•æŒ‰é’®ï¼Œç›´æ¥åœ¨å›è°ƒæ—¶ï¼Œå°±å·²ç»å°†æ¥æ”¶å“åº”çš„æŒ‰é’®ç»™ä¼ è¿‡æ¥äº†ï¼Œç›´æ¥é€šè¿‡å®ƒä¿®æ”¹å³å¯ã€‚ â€¢ ç¬¬äºŒç§ï¼šç‚¹å‡»æŸä¸ªæŒ‰é’®åï¼Œæ‰€æœ‰ä¸ä¹‹åŒç±»å‹çš„æŒ‰é’®éƒ½è¦ä¿®æ”¹å€¼ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åœ¨åˆ›å»ºæŒ‰é’®æ—¶å°†æŒ‰é’®å­˜å…¥åˆ°æ•°ç»„ä¸­ï¼Œåœ¨éœ€è¦çš„æ—¶å€™éå†æŸ¥æ‰¾ã€‚ ä½¿ç”¨drawRectæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ drawRectæ–¹æ³•ä¾èµ–Core Graphicsæ¡†æ¶æ¥è¿›è¡Œè‡ªå®šä¹‰çš„ç»˜åˆ¶ï¼Œä½†è¿™ç§æ–¹æ³•ä¸»è¦çš„ç¼ºç‚¹å°±æ˜¯å®ƒå¤„ç†touchäº‹ä»¶çš„æ–¹å¼ï¼šæ¯æ¬¡æŒ‰é’®è¢«ç‚¹å‡»åï¼Œéƒ½ä¼šç”¨setNeddsDisplayè¿›è¡Œå¼ºåˆ¶é‡ç»˜ï¼›è€Œä¸”ä¸æ­¢ä¸€æ¬¡ï¼Œæ¯æ¬¡å•ç‚¹äº‹ä»¶è§¦å‘ä¸¤æ¬¡æ‰§è¡Œã€‚è¿™æ ·çš„è¯ä»æ€§èƒ½çš„è§’åº¦æ¥è¯´ï¼Œå¯¹CPUå’Œå†…å­˜æ¥è¯´éƒ½æ˜¯æ¬ ä½³çš„ã€‚ç‰¹åˆ«æ˜¯å¦‚æœåœ¨æˆ‘ä»¬çš„ç•Œé¢ä¸Šæœ‰å¤šä¸ªè¿™æ ·çš„UIButtonå®ä¾‹ã€‚ viewWillLayoutSubViewä½ æ€»æ˜¯çŸ¥é“çš„ã€‚controller layoutè§¦å‘çš„æ—¶å€™ï¼Œå¼€å‘è€…æœ‰æœºä¼šå»é‡æ–°layoutè‡ªå·±çš„å„ä¸ªsubviewã€‚ æ¨ªç«–å±åˆ‡æ¢çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šå“åº”ä¸€äº›å‡½æ•°ï¼Œå…¶ä¸­ viewWillLayoutSubviews å’Œ viewDidLayoutSubviewsã€‚ - (void)viewWillLayoutSubviews { [self _shouldRotateToOrientation:(UIDeviceOrientation)[UIApplication sharedApplication].statusBarOrientation]; } -(void)_shouldRotateToOrientation:(UIDeviceOrientation)orientation { if (orientation == UIDeviceOrientationPortrait ||orientation == UIDeviceOrientationPortraitUpsideDown) { // ç«–å± } else { // æ¨ªå± } } é€šè¿‡ä¸Šè¿°ä¸€ä¸ªå‡½æ•°å°±çŸ¥é“æ¨ªç«–å±åˆ‡æ¢çš„æ¥å£äº†ã€‚ æ³¨æ„ï¼šviewWillLayoutSubviewsåªèƒ½ç”¨åœ¨ViewControlleré‡Œé¢ï¼Œåœ¨viewé‡Œé¢æ²¡æœ‰å“åº”ã€‚ ä¸€ä¸ªtableViewæ˜¯å¦å¯ä»¥å…³è”ä¸¤ä¸ªä¸åŒçš„æ•°æ®æºï¼Ÿ å½“ç„¶æ˜¯å¯ä»¥å…³è”å¤šä¸ªä¸åŒçš„æ•°æ®æºï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶ä½¿ç”¨å¤šä¸ªæ•°æ®æºè€Œå·²ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªåˆ—è¡¨æœ‰ä¸¤ä¸ªç­›é€‰åŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯ç­›é€‰åŸå¸‚ï¼Œä¸€ä¸ªæ˜¯ç­›é€‰æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå°±æ˜¯ä¸¤ä¸ªæ•°æ®æºäº†ã€‚å½“ç­›é€‰åŸå¸‚æ—¶ï¼Œå°±ä¼šä½¿ç”¨åŸå¸‚æ•°æ®æºï¼›å½“ç­›é€‰æ—¶é—´æ—¶ï¼Œå°±ä¼šä½¿ç”¨æ—¶é—´æ•°æ®æºã€‚ å¦‚ä½•è‡ªåŠ¨è®¡ç®—cellçš„é«˜åº¦ï¼Ÿ å®ç°åŸç†ï¼šé€šè¿‡æ•°æ®æ¨¡å‹çš„idä½œä¸ºkeyï¼Œä»¥ç¡®ä¿å”¯ä¸€ï¼Œå¦‚ä½•æ‰èƒ½ä¿è¯å¤ç”¨cellæ—¶ä¸ä¼šå‡ºç°æ··ä¹±ã€‚åœ¨é…ç½®å®Œæ•°æ®åï¼Œé€šè¿‡æ›´æ–°çº¦æŸï¼Œå¾—åˆ°æœ€åä¸€ä¸ªæ§ä»¶çš„frameï¼Œå°±åªå¯ä»¥åˆ¤æ–­cellå®é™…éœ€è¦çš„é«˜åº¦ï¼Œå¹¶ä¸”ç¼“å­˜ä¸‹æ¥ï¼Œä¸‹æ¬¡å†è·å–æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨åˆ™ç›´æ¥è¿”å›ã€‚å› æ­¤ï¼Œåªä¼šè®¡ç®—ä¸€é UITableViewæ˜¯å¦‚ä½•è®¡ç®—å†…å®¹é«˜åº¦çš„ï¼Ÿä¸ºä»€ä¹ˆåˆå§‹åŒ–æ—¶é…ç½®æ•°æ®æ—¶ï¼Œè·å–è¡Œé«˜çš„ä»£ç†æ–¹æ³•ä¼šè°ƒç”¨æ•°æ®æ¡æ•°æ¬¡ï¼Ÿ UITableViewæ˜¯ç»§æ‰¿äºUIScrollViewçš„ï¼Œå› æ­¤ä¹Ÿæœ‰contentSizeã€‚è¦å¾—åˆ°tableviewçš„contentsizeï¼Œå°±éœ€è¦å¾—åˆ°æ‰€æœ‰cellçš„é«˜åº¦ï¼Œä»è€Œè®¡ç®—å‡ºæ€»é«˜åº¦ï¼Œæ‰èƒ½å¾—åˆ°contentsizeã€‚å› æ­¤ï¼Œåœ¨reloadDataæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¯¥ä»£ç†æ–¹æ³•æ•°æ®æ¡æ•°æ¬¡ã€‚ ä¸€ä¸ªtableViewæ˜¯å¦å¯ä»¥å…³è”ä¸¤ä¸ªä¸åŒçš„æ•°æ®æº?ä½ ä¼šæ€ä¹ˆå¤„ç†?ç­”ï¼šé¦–å…ˆæˆ‘ä»¬ä»ä»£ç æ¥çœ‹ï¼Œæ•°æ®æºå¦‚ä½•å…³è”ä¸Šçš„ï¼Œå…¶å®æ˜¯åœ¨æ•°æ®æºå…³è”çš„ä»£ç†æ–¹æ³•é‡Œå®ç°çš„ã€‚ å› æ­¤æˆ‘ä»¬å¹¶ä¸å…³å¿ƒå¦‚ä½•å»å…³è”ä»–ï¼Œä»–æ€ä¹ˆå…³è”ä¸Šï¼Œæ–¹æ³•åªæ˜¯è®©æˆ‘è¿”å›æ ¹æ®è‡ªå·±çš„éœ€è¦å»è®¾ç½®å¦‚ç›¸å…³çš„æ•°æ®æºã€‚ å› æ­¤ï¼Œæˆ‘è§‰å¾—å¯ä»¥è®¾ç½®å¤šä¸ªæ•°æ®æºå•Šï¼Œä½†æ˜¯æœ‰ä¸ªé—®é¢˜æ˜¯ï¼Œä½ è¿™æ˜¯æƒ³å¹²å˜›å‘¢?æƒ³è®©åˆ—è¡¨å¦‚ä½•æ˜¾ç¤ºï¼Œä¸åŒçš„æ•°æ®æºåˆ†åŒºå—æ˜¾ç¤º? ç»™å‡ºå§”æ‰˜æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶ä¸”è¯´å‡ºUITableVIewçš„Data Sourceæ–¹æ³•CocoaTouchæ¡†æ¶ä¸­ç”¨åˆ°äº†å¤§é‡å§”æ‰˜ï¼Œå…¶ä¸­UITableViewDelegateå°±æ˜¯å§”æ‰˜æœºåˆ¶çš„å…¸å‹åº”ç”¨ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨å§”æ‰˜æ¥å®ç°é€‚é…å™¨æ¨¡å¼ï¼Œå…¶ä¸­UITableViewDelegateåè®®æ˜¯ç›®æ ‡ï¼Œtableviewæ˜¯é€‚é…å™¨ï¼Œå®ç°UITableViewDelegateåè®®ï¼Œå¹¶å°†è‡ªèº«è®¾ç½®ä¸ºtalbeviewçš„delegateçš„å¯¹è±¡ï¼Œæ˜¯è¢«é€‚é…å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯¥å¯¹è±¡æ˜¯UITableViewControllerã€‚ UITableVIewçš„Data Sourceæ–¹æ³•æœ‰- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section; - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath; cocoa touchæ¡†æ¶ç­”ï¼šiPhone OS åº”ç”¨ç¨‹åºçš„åŸºç¡€ Cocoa Touch æ¡†æ¶é‡ç”¨äº†è®¸å¤š Mac ç³»ç»Ÿçš„æˆç†Ÿæ¨¡å¼ï¼Œä½†æ˜¯å®ƒæ›´å¤šåœ°ä¸“æ³¨äºè§¦æ‘¸çš„æ¥å£å’Œä¼˜åŒ–ã€‚ UIKit ä¸ºæ‚¨æä¾›äº†åœ¨ iPhone OS ä¸Šå®ç°å›¾å½¢ï¼Œäº‹ä»¶é©±åŠ¨ç¨‹åºçš„åŸºæœ¬å·¥å…·ï¼Œå…¶å»ºç«‹åœ¨å’Œ Mac OS X ä¸­ä¸€æ ·çš„ Foundation æ¡†æ¶ä¸Šï¼ŒåŒ…æ‹¬æ–‡ä»¶å¤„ç†ï¼Œç½‘ç»œï¼Œå­—ç¬¦ä¸²æ“ä½œç­‰ã€‚ Cocoa Touch å…·æœ‰å’Œ iPhone ç”¨æˆ·æ¥å£ä¸€è‡´çš„ç‰¹æ®Šè®¾è®¡ã€‚æœ‰äº† UIKitï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ iPhone OS ä¸Šçš„ç‹¬ç‰¹çš„å›¾å½¢æ¥å£æ§ä»¶ï¼ŒæŒ‰é’®ï¼Œä»¥åŠå…¨å±è§†å›¾çš„åŠŸèƒ½ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨åŠ é€Ÿä»ªå’Œå¤šç‚¹è§¦æ‘¸æ‰‹åŠ¿æ¥æ§åˆ¶æ‚¨çš„åº”ç”¨ã€‚ å„è‰²ä¿±å…¨çš„æ¡†æ¶ é™¤äº†UIKit å¤–ï¼ŒCocoa Touch åŒ…å«äº†åˆ›å»ºä¸–ç•Œä¸€æµ iPhone åº”ç”¨ç¨‹åºéœ€è¦çš„æ‰€æœ‰æ¡†æ¶ï¼Œä»ä¸‰ç»´å›¾å½¢ï¼Œåˆ°ä¸“ä¸šéŸ³æ•ˆï¼Œç”šè‡³æä¾›è®¾å¤‡è®¿é—® API ä»¥æ§åˆ¶æ‘„åƒå¤´ï¼Œæˆ–é€šè¿‡ GPS è·çŸ¥å½“å‰ä½ç½®ã€‚ Cocoa Touch æ—¢åŒ…å«åªéœ€è¦å‡ è¡Œä»£ç å°±å¯ä»¥å®Œæˆå…¨éƒ¨ä»»åŠ¡çš„å¼ºå¤§çš„ Objective-C æ¡†æ¶ï¼Œä¹Ÿåœ¨éœ€è¦æ—¶æä¾›åŸºç¡€çš„ C è¯­è¨€ API æ¥ç›´æ¥è®¿é—®ç³»ç»Ÿã€‚è¿™äº›æ¡†æ¶åŒ…æ‹¬ï¼š Core Animationï¼šé€šè¿‡ Core Animationï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡ä¸€ä¸ªåŸºäºç»„åˆç‹¬ç«‹å›¾å±‚çš„ç®€å•çš„ç¼–ç¨‹æ¨¡å‹æ¥åˆ›å»ºä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒã€‚ Core Audioï¼šCore Audio æ˜¯æ’­æ”¾ï¼Œå¤„ç†å’Œå½•åˆ¶éŸ³é¢‘çš„ä¸“ä¸šæŠ€æœ¯ï¼Œèƒ½å¤Ÿè½»æ¾ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ å¼ºå¤§çš„éŸ³é¢‘åŠŸèƒ½ã€‚ Core Dataï¼šæä¾›äº†ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ•°æ®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ˜“äºä½¿ç”¨å’Œç†è§£ï¼Œç”šè‡³å¯å¤„ç†ä»»ä½•åº”ç”¨æˆ–å¤§æˆ–å°çš„æ•°æ®æ¨¡å‹ã€‚ åŠŸèƒ½åˆ—è¡¨ï¼šæ¡†æ¶åˆ†ç±» ä¸‹é¢æ˜¯ Cocoa Touch ä¸­ä¸€å°éƒ¨åˆ†å¯ç”¨çš„æ¡†æ¶ï¼š éŸ³é¢‘å’Œè§†é¢‘ï¼šCore Audio ï¼ŒOpenAL ï¼ŒMedia Library ï¼ŒAV Foundation æ•°æ®ç®¡ç† ï¼šCore Data ï¼ŒSQLite å›¾å½¢å’ŒåŠ¨ç”» ï¼šCore Animation ï¼ŒOpenGL ES ï¼ŒQuartz 2D ç½‘ç»œï¼šBonjour ï¼ŒWebKit ï¼ŒBSD Sockets ç”¨æˆ·åº”ç”¨ï¼šAddress Book ï¼ŒCore Location ï¼ŒMap Kit ï¼ŒStore Kit xibæ–‡ä»¶çš„æ„æˆåˆ†ä¸ºå“ª3ä¸ªå›¾æ ‡ï¼Ÿéƒ½å…·æœ‰ä»€ä¹ˆåŠŸèƒ½ã€‚Fileâ€™s Owner æ˜¯æ‰€æœ‰ nib æ–‡ä»¶ä¸­çš„æ¯ä¸ªå›¾æ ‡ï¼Œå®ƒè¡¨ç¤ºä»ç£ç›˜åŠ è½½ nib æ–‡ä»¶çš„å¯¹è±¡ï¼› First Responder å°±æ˜¯ç”¨æˆ·å½“å‰æ­£åœ¨ä¸ä¹‹äº¤äº’çš„å¯¹è±¡ï¼› View æ˜¾ç¤ºç”¨æˆ·ç•Œé¢ï¼›å®Œæˆç”¨æˆ·äº¤äº’ï¼›æ˜¯ UIView ç±»æˆ–å…¶å­ç±»ã€‚ ç®€è¿°åº”ç”¨ç¨‹åºæŒ‰Homeé”®è¿›å…¥åå°æ—¶çš„ç”Ÿå‘½å‘¨æœŸ,å’Œä»åå°å›åˆ°å‰å°æ—¶çš„ç”Ÿå‘½å‘¨æœŸ? åº”ç”¨ç¨‹åº:-[AppDelegate application:willFinishLaunchingWithOptions:] -[AppDelegate application:didFinishLaunchingWithOptions:] -[AppDelegate applicationDidBecomeActive:] é€€åˆ°åå°: -[AppDelegate applicationWillResignActive:] -[AppDelegate applicationDidEnterBackground:] å›åˆ°å‰å°: -[AppDelegate applicationWillEnterForeground:] -[AppDelegate applicationDidBecomeActive:] ViewControllerä¹‹é—´ï¼Œ åŠ è½½é¡µé¢: -[mainViewController viewDidLoad] -[mainViewController viewWillAppear:] -[mainViewController viewWillLayoutSubviews] -[mainViewController viewDidLayoutSubviews] -[mainViewController viewDidAppear:] é€€å‡ºå½“å‰é¡µé¢: -[mainViewController viewWillDisappear:] -[mainViewController viewDidDisappear:] è¿”å›ä¹‹å‰é¡µé¢: -[mainViewController viewWillAppear:] -[mainViewController viewWillLayoutSubviews] -[mainViewController viewDidLayoutSubviews] -[mainViewController viewDidAppear:] æ˜¯å¦ä½¿ç”¨Core Textæˆ–è€…Core Imageç­‰ï¼Ÿå¦‚æœä½¿ç”¨è¿‡ï¼Œè¯·è°ˆè°ˆä½ ä½¿ç”¨Core Textæˆ–è€…Core Imageçš„ä½“éªŒã€‚CoreText â€¢ éšæ„ä¿®æ”¹æ–‡æœ¬çš„æ ·å¼ â€¢ å›¾æ–‡æ··æ’(çº¯Cè¯­è¨€) â€¢ å›½å¤–:Niumb Core Image(æ»¤é•œå¤„ç†) * èƒ½è°ƒèŠ‚å›¾ç‰‡çš„å„ç§å±æ€§(å¯¹æ¯”åº¦, è‰²æ¸©, è‰²å·®ç­‰) åˆ†æä¸€ä¸‹ä½¿ç”¨æ‰‹æœºè·å–éªŒè¯ç æ³¨å†Œè´¦å·çš„å®ç°é€»è¾‘(ç»™äº†ä¸€ä¸ªç¤ºä¾‹å›¾)ï¼Œå‘é€åˆ°æ‰‹æœºçš„éªŒè¯ç è¶…è¿‡60ç§’é’Ÿåé‡æ–°å‘é€ å®šä¹‰ä¸€ä¸ªlabelå±æ€§ï¼Œèµ‹å€¼ä¸º60ç§’ï¼Œå†å®šä¹‰ä¸€ä¸ªcount è®¾ç½®ä¸€ä¸ªtimer æ¯æ¬¡å‡å°‘ä¸€ç§’ æŠŠcountâ€“ å†æŠŠcountçš„å€¼æ‹¼æ¥åˆ°labelä¸Š å½“count == 0 çš„æ—¶å€™ å†æ˜¾ç¤ºé‡æ–°å‘é€ ä½ åšiphoneå¼€å‘æ—¶å€™,æœ‰å“ªäº›ä¼ å€¼æ–¹å¼,viewå’Œviewä¹‹é—´æ˜¯å¦‚ä½•ä¼ å€¼çš„?block, target-action ,ä»£ç†,å±æ€§ æœ‰å“ªå‡ ç§æ‰‹åŠ¿é€šçŸ¥æ–¹æ³•ã€å†™æ¸…æ¥šæ–¹æ³•åï¼Ÿ-(void)touchesBegan:(NSSet)touchedwithEvent:(UIEvent)event; -(void)touchesMoved:(NSSet)touched withEvent:(UIEvent)event; -(void)touchesEnded:(NSSet)touchedwithEvent:(UIEvent)event; -(void)touchesCanceled:(NSSet)touchedwithEvent:(UIEvent)event;]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜8--Swift]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%988-Swift%2F</url>
    <content type="text"><![CDATA[Swiftå’ŒObjective-Cçš„è”ç³» Swiftä¸Objective-Cå…±ç”¨åŒä¸€å¥—è¿è¡Œæ—¶ç¯å¢ƒ æˆ‘ä»¬ç¼–å†™ç¨‹åºï¼Œè®©ç¨‹åºè¿è¡Œèµ·æ¥ï¼Œè¢«æœºå™¨æ‰§è¡Œçš„ä»£ç å¹¶éå…¨éƒ¨æ˜¯ç”±æˆ‘ä»¬è‡ªå·±æ¥ç¼–å†™çš„ã€‚éœ€è¦åŒæ—¶è¿è¡Œå¾ˆå¤šé¢„å…ˆå†™å¥½çš„æ”¯æŒæ€§çš„ä»£ç ï¼Œæ‰èƒ½è®©æˆ‘ä»¬è‡ªå·±çš„ä»£ç è¿è¡Œèµ·æ¥ã€‚ç¨‹åºå¹¶éå•ç‹¬å­˜åœ¨çš„ï¼Œè¿è¡Œæ—¶å¤„åœ¨ä¸€å®šçš„ç¯å¢ƒå½“ä¸­ã€‚æˆ‘æ€»è”æƒ³åˆ°å¾ˆå¤šå°èš‚èšåœ¨æ³¥åœŸä¸Šé¢çˆ¬ï¼Œè€Œæˆ‘è‡ªå·±å†™çš„ç¨‹åºåªæ˜¯å…¶ä¸­çš„ä¸€åªã€‚ Swiftè·ŸObjective-Cç¼–è¯‘å‡ºçš„ç¨‹åºä»£ç è¿è¡Œåœ¨åŒä¸€å¥—è¿è¡Œç¯å¢ƒä¸Šé¢ã€‚Swiftçš„ç±»å‹å¯ä»¥æ¡¥æ¥åˆ°Objective-Cçš„ç±»å‹ï¼Œåä¹‹äº¦ç„¶ã€‚Swiftç¼–å†™çš„ä»£ç å¯ä»¥è°ƒç”¨Objective-Cç¼–å†™çš„ä»£ç ï¼Œåä¹‹ä¹Ÿä¸€æ ·ã€‚ Objective-Cä¹‹å‰ç§¯ç´¯ä¸‹æ¥çš„å¤§é‡ç±»åº“ï¼Œå®ç°ä¸ç”¨æ”¹å†™Swiftå°±å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚ åŒä¸€ä¸ªå·¥ç¨‹ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨Swiftå’ŒObjective-C Objective-Cåœ¨ä¸€ç«¯ï¼ŒSwiftåœ¨å¦ä¸€ç«¯ï¼Œä¸¤ç«¯ç»ä¸­é—´æ–‡ä»¶è¿›è¡Œæ¡¥æ¥ã€‚æ¡¥æ¥æ–‡ä»¶åŒ…å«Objective-Cçš„å¤´æ–‡ä»¶ï¼Œç¼–è¯‘æ—¶è‡ªåŠ¨è½¬æˆSwiftå¯ä»¥è¯†åˆ«çš„å½¢å¼ã€‚Swiftå°±å¯ä»¥ä½¿ç”¨Objective-Cçš„ç±»å’Œå®ƒçš„å‡½æ•°ã€‚ åœ¨Swiftçš„ç±»ä¸­ï¼ŒåŠ ä¸Š@objcï¼ˆç±»åï¼‰çš„å­—æ ·ï¼ŒObjective-Cä¹Ÿå¯ä»¥ä½¿ç”¨Swiftç¼–å†™çš„ç±»ã€‚ä½†Swiftè·ŸC++çš„ç›¸äº’è°ƒç”¨ï¼Œéœ€è¦Objective-Cæ¥å°è£…ã€‚ Swiftéª¨å­é‡Œå¤§å¤šä¸Objective-Cä¸€æ · Objective-Cå‡ºç°è¿‡çš„ç»å¤§å¤šæ•°æ¦‚å¿µï¼Œæ¯”å¦‚å¼•ç”¨è®°æ•°ã€ARCã€å±æ€§ã€åè®®ã€æ¥å£ã€åˆå§‹åŒ–ã€æ‰©å±•ç±»ã€å‘½åå‚æ•°ã€åŒ¿åå‡½æ•°ç­‰ï¼Œåœ¨Swiftä¸­ç»§ç»­æœ‰æ•ˆï¼ˆå¯èƒ½åªæ˜¯æ¢äº†ä¸ªæœ¯è¯­ï¼‰ã€‚æˆ‘è‡ªå·±å°†Swiftçœ‹æˆæ˜¯Objective-Cçš„ä¸€å—å¤§å¤§çš„è¯­æ³•ç³–ï¼Œå…¶ä»–äººå¯èƒ½æœ‰ä¸åŒæ„Ÿå—ã€‚ Swiftå¤§å¤šæ•°æ¦‚å¿µä¸Objective-Cä¸€æ ·ï¼Œä¹Ÿæœ‰äº›æ¦‚å¿µåœ¨Objective-Cæ‰¾ä¸åˆ°å¯¹åº”ï¼Œæ¯”å¦‚æ³›å‹ã€‚Swiftä¸­å°†é‚£ç§æ“ä½œå†™ä¸€æ¬¡å°±å¯ä»¥ä½œç”¨å¤šä¸ªç±»å‹çš„è¯­æ³•å«åšGenericsï¼ˆæ³›å‹ï¼‰ã€‚ Swiftæ¯”Objective-Cæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ Swift å®¹æ˜“é˜…è¯» ä¸å†éœ€è¦è¡Œå°¾çš„åˆ†å·ï¼Œä»¥åŠ if/else è¯­å¥ä¸­å›´ç»•æ¡ä»¶è¡¨è¾¾å¼çš„æ‹¬å¼§ã€‚å¦å¤–å°±æ˜¯æ–¹æ³•çš„è°ƒç”¨ä¸å†äº’ç›¸åµŒå¥—æˆä¸­æ‹¬å·[[[ ]]]ã€‚Swift ä¸­çš„æ–¹æ³•å’Œå‡½æ•°çš„è°ƒç”¨ä½¿ç”¨è¡Œä¸šå†…æ ‡å‡†çš„åœ¨ä¸€å¯¹æ‹¬å¼§å†…ä½¿ç”¨é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ã€‚è¿™æ ·åšçš„ç»“æœå°±æ˜¯ä¸€ç§å¸¦æœ‰ç®€åŒ–äº†å¥æ³•å’Œè¯­æ³•çš„æ›´åŠ å¹²å‡€æœ‰è¡¨ç°åŠ›çš„è¯­è¨€ã€‚ Swift æ›´æ˜“äºç»´æŠ¤ Swift ä¸¢æ‰äº†å¯¹ç€ä¸¤ä¸ªæ–‡ä»¶çš„è¦æ±‚ã€‚ Xcodeç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨è®¡ç®—å‡ºä»¥æ¥å¹¶æ‰§è¡Œå¢é‡æ„å»ºã€‚å¦‚æ­¤ï¼Œå°†å¤´æ–‡ä»¶ åŒå®ç°æ–‡ä»¶ç›¸åˆ†ç¦»ã€‚æŠŠ Objective-C å¤´æ–‡ä»¶(.h) å’Œå®ç°æ–‡ä»¶ (.m) åˆå¹¶æˆäº†ä¸€ä¸ªä»£ç æ–‡ä»¶ (.swift) Swift æ›´åŠ å®‰å…¨ Swiftä»£ç ä¸­çš„å¯é€‰ç±»å‹ä½¿å¾—ä¸€ä¸ªnilå¯é€‰å€¼çš„å¯èƒ½æ€§å˜å¾—éå¸¸çš„æ˜ç¡®, è¿™æ„å‘³å®ƒèƒ½åœ¨ä½ å†™ä¸‹ä¸€æ®µç³Ÿç³•çš„ä»£ç æ—¶ä¼šç”Ÿæˆä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯. è¿™å°±å»ºç«‹äº†ä¸€ç§çŸ­ç¨‹åé¦ˆçš„å¾ªç¯ï¼Œå¯ä»¥è®©ç¨‹åºå‘˜å¸¦ç€ç›®æ ‡å»å†™ä»£ç . é—®é¢˜åœ¨ä»£ç è¢«å†™å°±æ—¶å°±å¯ä»¥è¢«ä¿®å¤, è¿™å¤§å¤§èŠ‚çœäº†ä½ è¦åœ¨ä¿®å¤æœ‰å…³æ¥è‡ª Objective-C æŒ‡é’ˆé€»è¾‘çš„bugæ—¶éœ€è¦è€—è´¹çš„æ—¶é—´å’Œé‡‘é’±. Swift ä»£ç æ›´å°‘ Swift å‡å°‘äº†é‡å¤æ€§è¯­å¥å’Œå­—ç¬¦ä¸²æ“ä½œæ‰€éœ€è¦çš„ä»£ç é‡ã€‚åœ¨ Objective-C ä¸­, ä½¿ç”¨æ–‡æœ¬å­—ç¬¦ä¸²å°†ä¸¤å—ä¿¡æ¯ç»„åˆèµ·æ¥çš„æ“ä½œéå¸¸ç¹çã€‚Swift é‡‡ç”¨å½“ä»£ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ä½¿ç”¨â€œ+â€æ“ä½œç¬¦å°†ä¸¤ä¸ªå­—ç¬¦ä¸²åŠ åˆ°ä¸€èµ· Swiftä¸­çš„ç±»å‹ç³»ç»Ÿå‡å°‘äº†ä»£ç è¯­å¥çš„å¤æ‚æ€§â€“ä½œä¸ºç¼–è¯‘å™¨å¯ä»¥ç†è§£çš„ç±»å‹ã€‚æ¯”å¦‚ï¼ŒObjective-Cè¦æ±‚ç¨‹åºå‘˜è®°ä½ç‰¹æ®Šå­—ç¬¦æ ‡è®°ï¼ˆ%sï¼Œ%dï¼Œ%@ï¼‰å¹¶ä¸”æä¾›äº†ä¸€ä¸ªç”¨é€—å·åˆ†éš”çš„å˜é‡æ¥ä»£æ›¿æ¯ä¸ªæ ‡è®°ã€‚Swiftæ”¯æŒå­—ç¬¦ä¸²æ’å…¥ï¼Œè¿™å°±æ¶ˆé™¤äº†éœ€è¦è®°ä½çš„æ ‡è®°å’Œå…è®¸ç¨‹åºå‘˜ç›´æ¥æ’å…¥å˜é‡åˆ°é¢å‘ç”¨æˆ·çš„å­—ç¬¦ä¸²ä¸­ Swift é€Ÿåº¦æ›´å¿« åˆ é™¤é—ç•™ä¸‹æ¥çš„Cè¯­è¨€çº¦å®šå¤§å¤§æå‡äº†å¼•æ“ç›–ä¹‹ä¸‹Swiftçš„æ€§èƒ½, è¿›è¡Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡çš„æ€§èƒ½ä¸Šï¼ŒSwiftå·²ç»é€¼è¿‘C++çš„è¡¨ç°, å°†è¿‘æ˜¯OCè¿è¡Œé€Ÿåº¦çš„1.4å€. æ€»ç»“: ä½¿ç”¨ Swiftï¼Œç¨‹åºå‘˜åªè¦ç»´æŠ¤åŸæ¥ä¸€åŠé‡çš„ä»£ç æ–‡ä»¶ï¼Œæ‰‹åŠ¨çš„ä»£ç åŒæ­¥å·¥ä½œä¸ºé›¶ï¼Œæ ‡ç‚¹è¾“å…¥å‡ºé”™çš„æ¦‚ç‡ä¹Ÿè¿œè¿œä½äºä»¥å‰ â€“ è¿™æ ·å°±èƒ½è…¾å‡ºæ›´å¤šçš„æ—¶é—´å†™é«˜è´¨é‡çš„ä»£ç ã€‚é€šè¿‡ä½¿ç”¨å¯é€‰ç±»å‹ â€”â€” ä¸€ç§é’ˆå¯¹è¿”å›æˆ–ä¸è¿”å›å€¼çš„ç¼–è¯‘æ—¶å®‰å…¨æœºåˆ¶ï¼Œè€Œè¿”å›å€¼æ˜¯åŒæ­¥æ“ä½œã€ç½‘ç»œå¤±æ•ˆæ—¶æ— æ•ˆçš„ç”¨æˆ·è¾“å…¥ä»¥åŠæ•°æ®éªŒè¯é”™è¯¯å‘ç”Ÿæ—¶æ™®éä¼šé‡åˆ°çš„é—®é¢˜ã€‚ARC åœ¨ Swift ä¸­å¯¹è¿‡ç¨‹å¼ C é£æ ¼çš„ä»£ç ï¼Œè¿˜æœ‰è‹¹æœå…¬å¸ Cocoa æ¡†æ¶ä½¿ç”¨çš„é¢å‘å¯¹è±¡ä»£ç éƒ½è¿›è¡Œäº†ç»Ÿä¸€ã€‚ Swiftçš„å†…å­˜ç®¡ç†æ˜¯æ€æ ·çš„ï¼Ÿ Swift ä½¿ç”¨è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆAutomatic Reference Counting, ARCï¼‰æ¥ç®€åŒ–å†…å­˜ç®¡ç†, è¿™ç§å†…å­˜ç®¡ç†æ–¹å¼ç›¸æ¯”GCè€Œè¨€ï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚è¾ƒé«˜, å¹¶ä¸”ARCæ¯”GCæ›´å®¹æ˜“å¼•èµ·ç¼–ç¨‹é”™è¯¯ï¼Œä½†å´æ¯”GCå¿«ã€‚å°¤å…¶åœ¨æ€§èƒ½å¾ˆé‡è¦çš„åœºåˆã€‚ Swiftæ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å—ï¼Ÿ å®ƒé‡‡ç”¨äº† Objective-C çš„å‘½åå‚æ•°ä»¥åŠåŠ¨æ€å¯¹è±¡æ¨¡å‹ï¼Œå¯ä»¥æ— ç¼å¯¹æ¥åˆ°ç°æœ‰çš„ Cocoa æ¡†æ¶ï¼Œå¹¶ä¸”å¯ä»¥å…¼å®¹ Objective-C ä»£ç ï¼Œæ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚ ä¸¾ä¾‹è¯´æ˜Swifté‡Œé¢æœ‰å“ªäº›æ˜¯ Objective-Cä¸­æ²¡æœ‰çš„ï¼Ÿ Swiftå¼•å…¥äº†åœ¨Objective-Cä¸­æ²¡æœ‰çš„ä¸€äº›é«˜çº§æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚tuplesï¼ˆå…ƒç»„ï¼‰ï¼Œå¯ä»¥ä½¿ä½ åˆ›å»ºå’Œä¼ é€’ä¸€ç»„æ•°å€¼ã€‚ Swiftè¿˜å¼•å…¥äº†å¯é€‰é¡¹ç±»å‹ï¼ˆOptionalsï¼‰ï¼Œç”¨äºå¤„ç†å˜é‡å€¼ä¸å­˜åœ¨çš„æƒ…å†µã€‚å¯é€‰é¡¹çš„æ„æ€æœ‰ä¸¤ç§ï¼šä¸€æ˜¯å˜é‡æ˜¯å­˜åœ¨çš„ï¼Œä¾‹å¦‚ç­‰äºXï¼ŒäºŒæ˜¯å˜é‡å€¼æ ¹æœ¬ä¸å­˜åœ¨ã€‚Optionalsç±»ä¼¼äºObjective-Cä¸­æŒ‡å‘nilçš„æŒ‡é’ˆï¼Œä½†æ˜¯é€‚ç”¨äºæ‰€æœ‰çš„æ•°æ®ç±»å‹ï¼Œè€Œéä»…ä»…å±€é™äºç±»ï¼ŒOptionals ç›¸æ¯”äºObjective-Cä¸­nilæŒ‡é’ˆæ›´åŠ å®‰å…¨å’Œç®€æ˜ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯Swiftè¯¸å¤šæœ€å¼ºå¤§åŠŸèƒ½çš„æ ¸å¿ƒã€‚ Swift æ˜¯ä¸€é—¨å®‰å…¨è¯­è¨€å—ï¼Ÿ Swiftæ˜¯ä¸€é—¨ç±»å‹å®‰å…¨çš„è¯­è¨€ï¼ŒOptionalså°±æ˜¯ä»£è¡¨ã€‚Swiftèƒ½å¸®åŠ©ä½ åœ¨ç±»å‹å®‰å…¨çš„ç¯å¢ƒä¸‹å·¥ä½œï¼Œå¦‚æœä½ çš„ä»£ç ä¸­éœ€è¦ä½¿ç”¨Stringç±»å‹ï¼ŒSwiftçš„å®‰å…¨æœºåˆ¶èƒ½é˜»æ­¢ä½ é”™è¯¯çš„å°†Intå€¼ä¼ é€’è¿‡æ¥ï¼Œè¿™ä½¿ä½ åœ¨å¼€å‘é˜¶æ®µå°±èƒ½åŠæ—¶å‘ç°å¹¶ä¿®æ­£é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆè¦åœ¨å˜é‡ç±»å‹åé¢åŠ ä¸ªé—®å·ï¼Ÿ ç”¨æ¥æ ‡è®°è¿™ä¸ªå˜é‡çš„å€¼æ˜¯å¯é€‰çš„ï¼Œä¸€èˆ¬ç”¨â€œï¼â€å’Œâ€œï¼Ÿâ€å®šä¹‰å¯é€‰å˜é‡çš„åŒºåˆ«ï¼šç”¨â€œï¼â€å®šçš„å¯é€‰å˜é‡å¿…é¡»ä¿è¯è½¬æ¢èƒ½å¤ŸæˆåŠŸï¼Œå¦åˆ™æŠ¥é”™ï¼Œä½†å®šä¹‰çš„å˜é‡å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ä¼šå°è£…åœ¨optioné‡Œï¼›è€Œç”¨â€œï¼Ÿâ€å·å®šçš„å¯é€‰å˜é‡å³ä½¿è½¬æ¢ä¸æˆåŠŸæœ¬èº«ä¹Ÿä¸ä¼šå‡ºé”™ï¼Œå˜é‡å€¼ä¸ºnilï¼Œå¦‚æœè½¬æ¢æˆåŠŸï¼Œè¦ä½¿ç”¨è¯¥å˜é‡è¿›è¡Œè®¡ç®—æ—¶å˜é‡ååéœ€è¦åŠ â€œï¼â€ ä»€ä¹ˆæ˜¯æ³›å‹ï¼Œå®ƒä»¬åˆè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ æ³›å‹æ˜¯ç”¨æ¥ä½¿ä»£ç èƒ½å®‰å…¨å·¥ä½œã€‚åœ¨Swiftä¸­ï¼Œæ³›å‹å¯ä»¥åœ¨å‡½æ•°æ•°æ®ç±»å‹å’Œæ™®é€šæ•°æ®ç±»å‹ä¸­ä½¿ç”¨ï¼Œä¾‹å¦‚ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾ã€‚ æ³›å‹è§£å†³äº†ä»£ç å¤ç”¨çš„é—®é¢˜ã€‚æœ‰ä¸€ç§å¸¸è§çš„æƒ…å†µï¼Œä½ æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ªç±»å‹çš„å‚æ•°ï¼Œä½ ä¸ºäº†é€‚åº”å¦ä¸€ç§ç±»å‹çš„å‚æ•°è¿˜å¾—é‡æ–°å†å†™ä¸€éè¿™ä¸ªæ–¹æ³•ã€‚ æ¯”å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ç¬¬ä¸€ä¸ªæ–¹æ³•çš„â€œå…‹éš†ä½“â€ï¼š func areIntEqual(x: Int, _ y: Int) -> Bool { return x == y } func areStringsEqual(x: String, _ y: String) -> Bool { return x == y } areStringsEqual("ray", "ray") // true areIntEqual(1, 1) // true ä¸€ä¸ªObjective-Cå¼€å‘è€…å¯èƒ½ä¼šé‡‡ç”¨NSObjectæ¥è§£å†³é—®é¢˜ï¼š import Foundation func areTheyEqual(x: NSObject, _ y: NSObject) -> Bool { return x == y } areTheyEqual("ray", "ray") // true areTheyEqual(1, 1) // true è¿™æ®µä»£ç èƒ½è¾¾åˆ°äº†ç›®çš„ï¼Œä½†æ˜¯ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸å®‰å…¨ã€‚å®ƒå…è®¸ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ•´å‹æ•°æ®è¿›è¡Œæ¯”è¾ƒï¼š areTheyEqual(1, "ray") //ç¨‹åºå¯èƒ½ä¸ä¼šå´©æºƒï¼Œä½†æ˜¯å…è®¸ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ•´å‹æ•°æ®è¿›è¡Œæ¯”è¾ƒå¯èƒ½ä¸ä¼šå¾—åˆ°æƒ³è¦çš„ç»“æœã€‚ é‡‡ç”¨æ³›å‹çš„è¯ï¼Œä½ å¯ä»¥å°†ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•åˆå¹¶ä¸ºä¸€ä¸ªï¼Œå¹¶åŒæ—¶è¿˜ä¿è¯äº†æ•°æ®ç±»å‹å®‰å…¨ã€‚è¿™æ˜¯å®ç°ä»£ç ï¼š func areTheyEqual&lt;T: Equatable>(x: T, _ y: T) -> Bool { return x == y } areTheyEqual("ray", "ray") areTheyEqual(1, 1)]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜7--Block]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%987-Block%2F</url>
    <content type="text"><![CDATA[Blockåº•å±‚åŸç†å®ç° é¦–å…ˆæˆ‘ä»¬æ¥çœ‹å››ä¸ªå‡½æ•° void test1() { int a = 10; void (^block)() = ^{ NSLog(@"a is %d", a); }; a = 20; block(); // 10 } void test2() { __block int a = 10; void (^block)() = ^{ NSLog(@"a is %d", a); }; a = 20; block(); // 20 } void test3() { static int a = 10; void (^block)() = ^{ NSLog(@"a is %d", a); }; a = 20; block(); // 20 } int a = 10; void test4() { void (^block)() = ^{ NSLog(@"a is %d", a); }; a = 20; block();//20 } é€ æˆè¿™æ ·çš„åŸå› æ˜¯ï¼šä¼ å€¼å’Œä¼ å€ã€‚ä¸ºä»€ä¹ˆè¯´ä¼šæœ‰ä¼ å€¼å’Œä¼ å€ï¼ŒæŠŠ.mç¼–è¯‘æˆc++ä»£ç ã€‚å¾—åˆ°.cppæ–‡ä»¶ï¼Œæˆ‘ä»¬æ¥åˆ°æ–‡ä»¶çš„æœ€åï¼Œçœ‹åˆ°å¦‚ä¸‹ä»£ç  struct __test1_block_impl_0 { struct __block_impl impl; struct __test1_block_desc_0* Desc; int a; __test1_block_impl_0(void *fp,struct __test1_block_desc_0* Desc,int _a,int flag=0): a(_a){ impl.isa = &_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; } }; static void __test1_block_func_0(struct __test1_block_imp_0 *__cself) { int a = __cself->a; NSLog(a);//è¿™é‡Œå°±æ˜¯æ‰“å°açš„å€¼ï¼Œä»£ç å¤ªé•¿ï¼Œè€Œä¸”æ²¡æ„ä¹‰ï¼Œæˆ‘å°±ä¸æ•²å‡ºæ¥äº†ã€‚ } void test1() { int a = 10; void (*block)() = (void (*)())&__test1_block_impl_0((void *))__test1_block_func_0,&__test1_block_desc_0_DATA,a); a = 20; ((void (*)(__block_impl *))((__block_ipml *)block)->FuncPtr)((_block_impl *)block); } int main(int argc, const char * argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; test1(); } return 0; } static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; æˆ‘ä»¬çœ‹åˆ°void test1()ä¸­ï¼Œvoid (*block)() å³è¾¹æœ€åé¢ ï¼ŒæŠŠaä¼ è¿›å»äº†ï¼Œä¹Ÿå°±æ˜¯æŠŠ10è¿™ä¸ªå€¼ä¼ è¿›å»äº†. è€Œä¸”å¯¹void (*block)()ç®€åŒ–åˆ†æï¼Œvoid (* block)() = &amp;__test1_block_impl_0(); æ‰€ä»¥blockå°±æ˜¯æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆã€‚ 10ä¼ å…¥blockåï¼Œä»£ç æœ€ä¸Šé¢åˆ›å»ºçš„__test1_block_impl_0ç»“æ„ä½“ä¸­ï¼Œa = 10ï¼› å¯¹void test1()ä¸­æœ€ä¸‹é¢çš„å‡½æ•°è¿›è¡Œç®€åŒ–åˆ†æï¼Œå¾—åˆ°(block)-&gt;FuncPtr)(block)ï¼Œæˆ‘ä»¬åœ¨å›åˆ°åˆšæ‰__test1_block_impl_0è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œimpl.FuncPtr = fp;è€Œfpåˆæ˜¯ä¼ å…¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œåœ¨void (*block)()ä¸­ï¼Œä¼ å…¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º__test1_block_func_0ï¼Œä¹Ÿå°±æ˜¯è¯´(block)-&gt;FuncPtr)(block) =ã€‹__test1_block_func_0(block); ä¸Šä¸€æ­¥ç›¸å½“äºè°ƒç”¨__test1_block_func_0ï¼ˆï¼‰è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹è¿™ä¸ªå‡½æ•°ï¼Œæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼šint a = __cself-&gt;a;è®¿é—®blockä¸­çš„aå€¼ï¼Œä¼ é€’ç»™aï¼›æ‰€ä»¥æ˜¯10.è¿™ç§å°±æ˜¯ä¼ å€¼ï¼ï¼ï¼ ===== æˆ‘ä»¬å†æ¥çœ‹test2( );æ·»åŠ äº†__blockä¼šå‘é€ä»€ä¹ˆå˜åŒ–å‘¢ void test2() { __attribute__((_blocks__(byref))) __Block_byref_a_0 a = {(void*)0,(__Block_byref_a_0 *)&a,0,sizeof(__Block_byref_a_0),10}; void(*block)() = (void (*)())&__test2_block_impl_0((void *))__test2_block_func_0,&__test2_block_desc_0_DATA,(__Block_byref_a_0 *)&a,570425344); (a.__forwarding->a) = 20; ((void (*)(__block_impl *))((__block_ipml *)block)->FuncPtr)((_block_impl *)block); } int main(int argc, const char * argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; test2(); } return 0; } static struct IMAGE_INFO { unsigned version; unsigned flag; } _OBJC_IMAGE_INFO = { 0, 2 }; ä»£ç è™½ç„¶å¾ˆå¤šçœ‹ç€å¾ˆå¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦çœ‹æˆ‘ä»¬æƒ³è¦çŸ¥é“çš„ï¼Œçå¤§ä½ çš„çœ¼ç›ï¼Œçœ‹åˆ°void(*block)()è¿™ä¸ªå‡½æ•°çš„æœ€åé¢ï¼Œæœ‰ä¸ª&amp;a,å¤©å•Šï¼Œè¿™é‡Œä¼ çš„æ˜¯açš„åœ°å€ã€‚ä»test2åˆ°test4ï¼Œéƒ½æ˜¯ä¼ å€ï¼Œæ‰€ä»¥açš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œblockæ‰“å°å‡ºæ¥çš„æ˜¯açš„æœ€ç»ˆå€¼ã€‚ æ€»ç»“ï¼šåªæœ‰æ™®é€šå±€éƒ¨å˜é‡æ˜¯ä¼ å€¼ï¼Œå…¶ä»–æƒ…å†µéƒ½æ˜¯ä¼ å€ã€‚ blockçš„å®šä¹‰// æ— å‚æ— è¿”å› void(^block)(); // æ— å‚æœ‰è¿”å› int(^block1)(); // æœ‰å‚æœ‰è¿”å› int(^block1)(int number); ä¹Ÿå¯ä»¥ç›´æ¥æ‰“å…¥inlineæ¥è‡ªåŠ¨ç”Ÿæˆblockæ ¼å¼ &lt;#returnType#&gt;(^&lt;#blockName#&gt;)(&lt;#parameterTypes#&gt;) = ^(&lt;#parameters#&gt;) { &lt;#statements#&gt; }; blockçš„å†…å­˜ç®¡ç† æ— è®ºå½“å‰ç¯å¢ƒæ˜¯ARCè¿˜æ˜¯MRC,åªè¦blockæ²¡æœ‰è®¿é—®å¤–éƒ¨å˜é‡,blockå§‹ç»ˆåœ¨å…¨å±€åŒº MRCæƒ…å†µä¸‹ blockå¦‚æœè®¿é—®å¤–éƒ¨å˜é‡,blockåœ¨æ ˆé‡Œ ä¸èƒ½å¯¹blockä½¿ç”¨retain,å¦åˆ™ä¸èƒ½ä¿å­˜åœ¨å †é‡Œ åªæœ‰ä½¿ç”¨copy,æ‰èƒ½æ”¾åˆ°å †é‡Œ ARCæƒ…å†µä¸‹ blockå¦‚æœè®¿é—®å¤–éƒ¨å˜é‡,blockåœ¨å †é‡Œ blockå¯ä»¥ä½¿ç”¨copyå’Œstrong,å¹¶ä¸”blockæ˜¯ä¸€ä¸ªå¯¹è±¡ blockçš„å¾ªç¯å¼•ç”¨ å¦‚æœè¦åœ¨blockä¸­ç›´æ¥ä½¿ç”¨å¤–éƒ¨å¼ºæŒ‡é’ˆä¼šå‘ç”Ÿé”™è¯¯,ä½¿ç”¨ä»¥ä¸‹ä»£ç åœ¨blockå¤–éƒ¨å®ç°å¯ä»¥è§£å†³ __weak typeof(self) weakSelf = self; ä½†æ˜¯å¦‚æœåœ¨blockå†…éƒ¨ä½¿ç”¨å»¶æ—¶æ“ä½œè¿˜ä½¿ç”¨å¼±æŒ‡é’ˆçš„è¯ä¼šå–ä¸åˆ°è¯¥å¼±æŒ‡é’ˆ,éœ€è¦åœ¨blockå†…éƒ¨å†å°†å¼±æŒ‡é’ˆå¼ºå¼•ç”¨ä¸€ä¸‹ __strong typeof(self) strongSelf = weakSelf; æè¿°ä¸€ä¸ªä½ é‡åˆ°è¿‡çš„retain cycleä¾‹å­ã€‚blockä¸­çš„å¾ªç¯å¼•ç”¨ï¼šä¸€ä¸ªviewController @property (nonatomic,strong)HttpRequestHandler * handler; @property (nonatomic,strong)NSData *data; _handler = [httpRequestHandler sharedManager]; [ downloadData:^(id responseData){ _data = responseData; }]; self æ‹¥æœ‰_handler, _handler æ‹¥æœ‰block, blockæ‹¥æœ‰selfï¼ˆå› ä¸ºä½¿ç”¨äº†selfçš„_dataå±æ€§ï¼Œblockä¼šcopy ä¸€ä»½selfï¼‰ è§£å†³æ–¹æ³•ï¼š __weak typedof(self)weakSelf = self [ downloadData:^(id responseData){ weakSelf.data = responseData; blockä¸­çš„weak selfï¼Œæ˜¯ä»»ä½•æ—¶å€™éƒ½éœ€è¦åŠ çš„ä¹ˆï¼Ÿ ä¸æ˜¯ä»€ä¹ˆä»»ä½•æ—¶å€™éƒ½éœ€è¦æ·»åŠ çš„ï¼Œä¸è¿‡ä»»ä½•æ—¶å€™éƒ½æ·»åŠ ä¼¼ä¹æ€»æ˜¯å¥½çš„ã€‚åªè¦å‡ºç°åƒself-&gt;block-&gt;self.property/self-&gt;_ivarè¿™æ ·çš„ç»“æ„é“¾æ—¶ï¼Œæ‰ä¼šå‡ºç°å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚å¥½å¥½åˆ†æä¸€ä¸‹ï¼Œå°±å¯ä»¥æ¨æ–­å‡ºæ˜¯å¦ä¼šæœ‰å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚ é€šè¿‡blockæ¥ä¼ å€¼ åœ¨æ§åˆ¶å™¨é—´ä¼ å€¼å¯ä»¥ä½¿ç”¨ä»£ç†æˆ–è€…block,ä½¿ç”¨blockç›¸å¯¹æ¥è¯´ç®€æ´ åœ¨å‰ä¸€ä¸ªæ§åˆ¶å™¨çš„touchesBegan:æ–¹æ³•å†…å®ç°å¦‚ä¸‹ä»£ç  ModalViewController *modalVc = [[ModalViewController alloc] init]; modalVc.valueBlcok = ^(NSString *str){ NSLog(@"ViewControlleræ‹¿åˆ°%@",str); }; [self presentViewController:modalVc animated:YES completion:nil]; åœ¨ModalViewControlleræ§åˆ¶å™¨çš„.hæ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªblockå±æ€§ @property (nonatomic ,strong) void(^valueBlcok)(NSString *str); å¹¶åœ¨.mæ–‡ä»¶ä¸­å®ç°æ–¹æ³• - (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event { // ä¼ å€¼:è°ƒç”¨block if (_valueBlcok) { _valueBlcok(@"123"); } } è¿™æ ·åœ¨ModalViewControllerå›åˆ°ä¸Šä¸€ä¸ªæ§åˆ¶å™¨çš„æ—¶å€™,ä¸Šä¸€ä¸ªæ§åˆ¶å™¨çš„labelå°±èƒ½æ˜¾ç¤ºModalViewControllerä¼ è¿‡æ¥çš„å­—ç¬¦ä¸² blockä½œä¸ºä¸€ä¸ªå‚æ•°ä½¿ç”¨ æ–°å»ºä¸€ä¸ªç±»,åœ¨.hæ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªæ–¹æ³•- (void)calculator:(int(^)(int result))block; å¹¶åœ¨.mæ–‡ä»¶ä¸­å®ç°è¯¥æ–¹æ³• -(void)calculator:(int (^)(int))block { self.result = block(self.result); } åœ¨å…¶ä»–ç±»ä¸­è°ƒç”¨è¯¥æ–¹æ³• CalculatorManager *mgr = [[CalculatorManager alloc] init]; [mgr calculator:^(int result){ result += 5; return result; }]; blockä½œä¸ºè¿”å›å€¼ä½¿ç”¨ åœ¨masonryæ¡†æ¶ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç”¨æ³•make.top.equalTo(superview.mas_top).with.offset(padding.top); è¿™ä¸ªæ–¹æ³•å®ç°å°±æ˜¯å°†blockä½œä¸ºè¿”å›å€¼æ¥ä½¿ç”¨ æ¥åˆ†æä¸€ä¸‹è¿™æ®µä»£ç ï¼šå…¶å®å¯ä»¥å°†è¿™æ®µä»£ç çœ‹æˆmake.top,make.equalTo,make.with,make.offset,æ‰€ä»¥å¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºæ˜¯make.topè¿”å›äº†ä¸€ä¸ªmake,æ‰èƒ½å®ç°make.top.equalTo é‚£æ¥æ¨¡ä»¿ä¸€ä¸‹è¿™ç§åŠŸèƒ½çš„å®ç° æ–°å»ºä¸€ä¸ªç±»,åœ¨.hæ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªæ–¹æ³•- (CalculatorManager *(^)(int a))add; åœ¨.mæ–‡ä»¶ä¸­å®ç°æ–¹æ³•`objc (CalculatorManager * (^)(int a))add { return ^(int a){ _result += a; return self; };}` è¿™æ ·å°±å¯ä»¥åœ¨åˆ«çš„ç±»ä¸­å®ç°ä¸Šé¢ä»£ç çš„ç”¨æ³• mgr.add(1).add(2).add(3); blockçš„å˜é‡ä¼ é€’ å¦‚æœblockè®¿é—®çš„å¤–éƒ¨å˜é‡æ˜¯å±€éƒ¨å˜é‡,é‚£ä¹ˆå°±æ˜¯å€¼ä¼ é€’,å¤–ç•Œæ”¹äº†,ä¸ä¼šå½±å“é‡Œé¢ å¦‚æœblockè®¿é—®çš„å¤–éƒ¨å˜é‡æ˜¯__blockæˆ–è€…staticä¿®é¥°,æˆ–è€…æ˜¯å…¨å±€å˜é‡,é‚£ä¹ˆå°±æ˜¯æŒ‡é’ˆä¼ é€’,blocké‡Œé¢çš„å€¼å’Œå¤–ç•ŒåŒä¸€ä¸ªå˜é‡,å¤–ç•Œæ”¹å˜,é‡Œé¢ä¹Ÿä¼šæ”¹å˜ éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯è¿™æ · é€šè¿‡Clangæ¥å°†main.mæ–‡ä»¶ç¼–è¯‘ä¸ºC++ åœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤clang -rewrite-objc main.m void(*block)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_a_0 *)&amp;a, 570425344)); void(*block)() = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, a)); å¯ä»¥çœ‹åˆ°åœ¨ç¼–è¯‘åçš„ä»£ç æœ€åå¯ä»¥å‘ç°è¢«__blockä¿®é¥°è¿‡å¾—å˜é‡ä½¿ç”¨çš„æ˜¯&amp;a,è€Œå±€éƒ¨å˜é‡æ˜¯a blockçš„æ³¨æ„ç‚¹ åœ¨blockå†…éƒ¨ä½¿ç”¨å¤–éƒ¨æŒ‡é’ˆä¸”ä¼šé€ æˆå¾ªç¯å¼•ç”¨æƒ…å†µä¸‹,éœ€è¦ç”¨__weakä¿®é¥°å¤–éƒ¨æŒ‡é’ˆ __weak typeof(self) weakSelf = self; åœ¨blockå†…éƒ¨å¦‚æœè°ƒç”¨äº†å»¶æ—¶å‡½æ•°è¿˜ä½¿ç”¨å¼±æŒ‡é’ˆä¼šå–ä¸åˆ°è¯¥æŒ‡é’ˆ,å› ä¸ºå·²ç»è¢«é”€æ¯äº†,éœ€è¦åœ¨blockå†…éƒ¨å†å°†å¼±æŒ‡é’ˆé‡æ–°å¼ºå¼•ç”¨ä¸€ä¸‹ __strong typeof(self) strongSelf = weakSelf; å¦‚æœéœ€è¦åœ¨blockå†…éƒ¨æ”¹å˜å¤–éƒ¨å˜é‡çš„è¯,éœ€è¦åœ¨ç”¨__blockä¿®é¥°å¤–éƒ¨å˜é‡ ä½¿ç”¨blockæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä½¿ç”¨NSTimerå†™å‡ºä¸€ä¸ªä½¿ç”¨blockæ˜¾ç¤ºï¼ˆåœ¨UILabelä¸Šï¼‰ç§’è¡¨çš„ä»£ç ã€‚è¯´åˆ°blockçš„å¥½å¤„ï¼Œæœ€ç›´æ¥çš„å°±æ˜¯ä»£ç ç´§å‡‘ï¼Œä¼ å€¼ã€å›è°ƒéƒ½å¾ˆæ–¹ä¾¿ï¼Œçœå»äº†å†™ä»£ç†çš„å¾ˆå¤šä»£ç ã€‚ å¯¹äºè¿™é‡Œæ ¹æœ¬æ²¡æœ‰å¿…è¦ä½¿ç”¨blockæ¥åˆ·æ–°UILabelæ˜¾ç¤ºï¼Œå› ä¸ºéƒ½æ˜¯ç›´æ¥èµ‹å€¼ã€‚å½“ç„¶ï¼Œç¬”è€…è§‰å¾—è¿™æ˜¯åœ¨è€ƒéªŒåº”è˜è€…å¦‚ä½•å°†NSTimerå†™æˆä¸€ä¸ªé€šç”¨ç”¨çš„Blockç‰ˆæœ¬ã€‚ NSTimerå°è£…æˆBlockç‰ˆ: http://www.henishuo.com/nstimer-block/ ä½¿ç”¨èµ·æ¥åƒè¿™æ ·ï¼š NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:1.0 repeats:YES callback:^() { weakSelf.secondsLabel.text = ... } [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; blockè·Ÿå‡½æ•°å¾ˆåƒï¼š å¯ä»¥ä¿å­˜ä»£ç  æœ‰è¿”å›å€¼ æœ‰å½¢å‚ è°ƒç”¨æ–¹å¼ä¸€æ · ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block apiï¼ˆå¦‚UIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ï¼‰ï¼Œæ˜¯å¦ä¹Ÿè€ƒè™‘å¼•ç”¨å¾ªç¯é—®é¢˜ï¼Ÿç³»ç»Ÿçš„æŸäº›block apiä¸­ï¼ŒUIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ä¸éœ€è¦è€ƒè™‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›apiéœ€è¦è€ƒè™‘ã€‚æ‰€è°“â€œå¼•ç”¨å¾ªç¯â€æ˜¯æŒ‡åŒå‘çš„å¼ºå¼•ç”¨ï¼Œ æ‰€ä»¥é‚£äº›â€œå•å‘çš„å¼ºå¼•ç”¨â€ï¼ˆblock å¼ºå¼•ç”¨ self ï¼‰æ²¡æœ‰é—®é¢˜ï¼Œæ¯”å¦‚è¿™äº›ï¼š [UIView animateWithDuration:duration animations:^{ [self.superview layoutIfNeeded]; }]; [[NSOperationQueue mainQueue] addOperationWithBlock:^{ self.someProperty = xyz; }]; [[NSNotificationCenter defaultCenter] addObserverForName:@&quot;someNotification&quot; object:nil queue:[NSOperationQueue mainQueue] usingBlock:^(NSNotification * notification) { self.someProperty = xyz; }]; è¿™äº›æƒ…å†µä¸éœ€è¦è€ƒè™‘â€œå¼•ç”¨å¾ªç¯â€ã€‚ ä½†å¦‚æœä½ ä½¿ç”¨ä¸€äº›å‚æ•°ä¸­å¯èƒ½å«æœ‰æˆå‘˜å˜é‡çš„ç³»ç»Ÿapiï¼Œå¦‚GCDã€NSNotificationCenterå°±è¦å°å¿ƒä¸€ç‚¹ã€‚æ¯”å¦‚GCDå†…éƒ¨å¦‚æœå¼•ç”¨äº† selfï¼Œè€Œä¸”GCDçš„å…¶ä»–å‚æ•°æ˜¯æˆå‘˜å˜é‡ï¼Œåˆ™è¦è€ƒè™‘åˆ°å¾ªç¯å¼•ç”¨ï¼š __weak __typeof(self) weakSelf = self; dispatch_group_async(_operationsGroup, _operationsQueue, ^{ __typeof__(self) strongSelf = weakSelf; [strongSelf doSomething]; [strongSelf doSomethingElse]; }); ç±»ä¼¼çš„ï¼š __weak __typeof(self) weakSelf = self; _observer = [[NSNotificationCenter defaultCenter] addObserverForName:@&quot;testKey&quot; object:nil queue:nil usingBlock:^(NSNotification *note) { __typeof__(self) strongSelf = weakSelf; [strongSelf dismissModalViewControllerAnimated:YES]; }]; self â€“&gt; _observer â€“&gt; block â€“&gt; self æ˜¾ç„¶è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚ è°ˆè°ˆå¯¹Block çš„ç†è§£?å¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨Blockæ‰§è¡ŒUIVewåŠ¨ç”»? Blockæ˜¯å¯ä»¥è·å–å…¶ä»–å‡½æ•°å±€éƒ¨å˜é‡çš„åŒ¿åå‡½æ•°ï¼Œå…¶ä¸ä½†æ–¹ä¾¿å¼€å‘ï¼Œå¹¶ä¸”å¯ä»¥å¤§å¹…æé«˜åº”ç”¨çš„æ‰§è¡Œæ•ˆç‡(å¤šæ ¸å¿ƒCPUå¯ç›´æ¥å¤„ç†BlockæŒ‡ä»¤) [UIView transitionWithView:self.view duration:0.2 ptions:UIViewAnimationOptionTransitionFlipFromLeft animations:^{ [[blueViewController view] removeFromSuperview]; [[self view] insertSubview:yellowViewController.view atIndex:0]; } completion:NULL]; å†™å‡ºä¸Šé¢ä»£ç çš„Blockçš„å®šä¹‰ã€‚ typedef void(^animations) (void); typedef void(^completion) (BOOL finished); ä»€ä¹ˆæ˜¯block å¯¹äºé—­åŒ…(block),æœ‰å¾ˆå¤šå®šä¹‰ï¼Œå…¶ä¸­é—­åŒ…å°±æ˜¯è·å–å…¶å®ƒå‡½æ•°å±€éƒ¨å˜é‡çš„åŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªå®šä¹‰å³æ¥è¿‘æœ¬è´¨åˆè¾ƒå¥½ç†è§£ã€‚ å¯¹äºåˆšæ¥è§¦Blockçš„åŒå­¦ï¼Œä¼šè§‰å¾—æœ‰äº›ç»•ï¼Œå› ä¸ºæˆ‘ä»¬ä¹ æƒ¯å†™è¿™æ ·çš„ç¨‹åºmain(){ funA();} funA(){funB();} funB(){â€¦..}; å°±æ˜¯å‡½æ•°mainè°ƒç”¨å‡½æ•°Aï¼Œå‡½æ•°Aè°ƒç”¨å‡½æ•°Bâ€¦ å‡½æ•°ä»¬ä¾æ¬¡é¡ºåºæ‰§è¡Œï¼Œä½†ç°å®ä¸­ä¸å…¨æ˜¯è¿™æ ·çš„ï¼Œä¾‹å¦‚é¡¹ç›®ç»ç†Mï¼Œæ‰‹ä¸‹æœ‰3ä¸ªç¨‹åºå‘˜Aã€Bã€Cï¼Œå½“ä»–ç»™ç¨‹åºå‘˜Aå®‰æ’å®ç°åŠŸèƒ½F1æ—¶ï¼Œä»–å¹¶ä¸ç­‰ç€Aå®Œæˆä¹‹åï¼Œå†å»å®‰æ’Bå»å®ç°F2ï¼Œè€Œæ˜¯å®‰æ’ç»™AåŠŸèƒ½F1ï¼ŒBåŠŸèƒ½F2ï¼ŒCåŠŸèƒ½F3ï¼Œç„¶åå¯èƒ½å»å†™æŠ€æœ¯æ–‡æ¡£ï¼Œè€Œå½“Aé‡åˆ°é—®é¢˜æ—¶ï¼Œä»–ä¼šæ¥æ‰¾é¡¹ç›®ç»ç†Mï¼Œå½“Båšå®Œæ—¶ï¼Œä¼šé€šçŸ¥Mï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„ä¾‹å­ã€‚ åœ¨è¿™ç§æƒ…å½¢ä¸‹ï¼ŒBlockä¾¿å¯å¤§æ˜¾èº«æ‰‹ï¼Œå› ä¸ºåœ¨é¡¹ç›®ç»ç†Mï¼Œç»™Aå®‰æ’å·¥ä½œæ—¶ï¼ŒåŒæ—¶ä¼šå‘Šè¯‰Aè‹¥æœé‡åˆ°å›°éš¾ï¼Œå¦‚ä½•èƒ½æ‰¾åˆ°ä»–æŠ¥å‘Šé—®é¢˜(ä¾‹å¦‚æ‰“ä»–æ‰‹æœºå·)ï¼Œè¿™å°±æ˜¯é¡¹ç›®ç»ç†Mç»™Açš„ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œè¦å›æ‰çš„æ“ä½œï¼Œæ¯”å¦‚æ¥åˆ°ç”µè¯ï¼Œç™¾åº¦æŸ¥è¯¢åï¼Œè¿”å›ç½‘é¡µå†…å®¹ç»™Aï¼Œè¿™å°±æ˜¯ä¸€ä¸ªBlockï¼Œåœ¨Mäº¤å¾…å·¥ä½œæ—¶ï¼Œå·²ç»å®šä¹‰å¥½ï¼Œå¹¶ä¸”å–å¾—äº†F1çš„ä»»åŠ¡å·(å±€éƒ¨å˜é‡)ï¼Œå´æ˜¯åœ¨å½“Aé‡åˆ°é—®é¢˜æ—¶ï¼Œæ‰è°ƒç”¨æ‰§è¡Œï¼Œè·¨å‡½æ•°åœ¨é¡¹ç›®ç»ç†MæŸ¥è¯¢ç™¾åº¦ï¼Œè·å¾—ç»“æœåå›è°ƒè¯¥blockã€‚ block å®ç°åŸç† Objective-Cæ˜¯å¯¹Cè¯­è¨€çš„æ‰©å±•ï¼Œblockçš„å®ç°æ˜¯åŸºäºæŒ‡é’ˆå’Œå‡½æ•°æŒ‡é’ˆã€‚ ä»è®¡ç®—è¯­è¨€çš„å‘å±•ï¼Œæœ€æ—©çš„gotoï¼Œé«˜çº§è¯­è¨€çš„æŒ‡é’ˆï¼Œåˆ°é¢å‘å¯¹è±¡è¯­è¨€çš„blockï¼Œä»æœºå™¨çš„æ€ç»´ï¼Œä¸€æ­¥æ­¥æ¥è¿‘äººçš„æ€ç»´ï¼Œä»¥æ–¹ä¾¿å¼€å‘äººå‘˜æ›´ä¸ºé«˜æ•ˆã€ç›´æ¥çš„æè¿°å‡ºç°å®çš„é€»è¾‘(éœ€æ±‚)ã€‚ ä½¿ç”¨å®ä¾‹:cocoaTouchæ¡†æ¶ä¸‹åŠ¨ç”»æ•ˆæœçš„Blockçš„è°ƒç”¨ ä½¿ç”¨typedå£°æ˜block typedef void(^didFinishBlock) (NSObject *ob); è¿™å°±å£°æ˜äº†ä¸€ä¸ªdidFinishBlockç±»å‹çš„blockï¼Œ ç„¶åä¾¿å¯ç”¨ @property (nonatomic,copy) didFinishBlock finishBlock; å£°æ˜ä¸€ä¸ªblokcå¯¹è±¡ï¼Œæ³¨æ„å¯¹è±¡å±æ€§è®¾ç½®ä¸ºcopyï¼Œæ¥åˆ°block å‚æ•°æ—¶ï¼Œä¾¿ä¼šè‡ªåŠ¨å¤åˆ¶ä¸€ä»½ã€‚ __blockæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œ ä½¿ç”¨è¯¥å…³é”®å­—å£°æ˜çš„å±€éƒ¨å˜é‡ï¼Œå¯ä»¥è¢«blockæ‰€æ”¹å˜ï¼Œå¹¶ä¸”å…¶åœ¨åŸå‡½æ•°ä¸­çš„å€¼ä¼šè¢«æ”¹å˜ã€‚ å…³äºblock ç­”: é¢è¯•æ—¶ï¼Œé¢è¯•å®˜ä¼šå…ˆé—®ä¸€äº›ï¼Œæ˜¯å¦äº†è§£blockï¼Œæ˜¯å¦ä½¿ç”¨è¿‡blockï¼Œè¿™äº›é—®é¢˜ç›¸å½“äºå¼€åœºç™½ï¼Œå¾€å¾€æ˜¯ä¸‹é¢ä¸€ç³»åˆ—é—®é¢˜çš„å¼€å§‹ï¼Œæ‰€ä»¥ä¸€å®šè¦å¦‚å®æ ¹æ®è‡ªå·±çš„æƒ…å†µå›ç­”ã€‚ 1). ä½¿ç”¨blockå’Œä½¿ç”¨delegateå®Œæˆå§”æ‰˜æ¨¡å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹? é¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯å§”æ‰˜æ¨¡å¼ï¼Œå§”æ‰˜æ¨¡å¼åœ¨iOSä¸­å¤§é‡åº”ç”¨ï¼Œå…¶åœ¨è®¾è®¡æ¨¡å¼ä¸­æ˜¯é€‚é…å™¨æ¨¡å¼ä¸­çš„å¯¹è±¡é€‚é…å™¨ï¼ŒObjective-Cä¸­ä½¿ç”¨idç±»å‹æŒ‡å‘ä¸€åˆ‡å¯¹è±¡ï¼Œä½¿å§”æ‰˜æ¨¡å¼æ›´ä¸ºç®€æ´ã€‚äº†è§£å§”æ‰˜æ¨¡å¼çš„ç»†èŠ‚ï¼š iOSè®¾è®¡æ¨¡å¼â€”-å§”æ‰˜æ¨¡å¼ ä½¿ç”¨blockå®ç°å§”æ‰˜æ¨¡å¼ï¼Œå…¶ä¼˜ç‚¹æ˜¯å›è°ƒçš„blockä»£ç å—å®šä¹‰åœ¨å§”æ‰˜å¯¹è±¡å‡½æ•°å†…éƒ¨ï¼Œä½¿ä»£ç æ›´ä¸ºç´§å‡‘; é€‚é…å¯¹è±¡ä¸å†éœ€è¦å®ç°å…·ä½“æŸä¸ªprotocolï¼Œä»£ç æ›´ä¸ºç®€æ´ã€‚ 2). å¤šçº¿ç¨‹ä¸block GCDä¸Block ä½¿ç”¨ dispatch_async ç³»åˆ—æ–¹æ³•ï¼Œå¯ä»¥ä»¥æŒ‡å®šçš„æ–¹å¼æ‰§è¡Œblock GCDç¼–ç¨‹å®ä¾‹ dispatch_asyncçš„å®Œæ•´å®šä¹‰ void dispatch_async( dispatch_queue_t queue, dispatch_block_t block); åŠŸèƒ½ï¼šåœ¨æŒ‡å®šçš„é˜Ÿåˆ—é‡Œæäº¤ä¸€ä¸ªå¼‚æ­¥æ‰§è¡Œçš„blockï¼Œä¸é˜»å¡å½“å‰çº¿ç¨‹ é€šè¿‡queueæ¥æ§åˆ¶blockæ‰§è¡Œçš„çº¿ç¨‹ã€‚ä¸»çº¿ç¨‹æ‰§è¡Œå‰æ–‡å®šä¹‰çš„ finishBlockå¯¹è±¡ dispatch_async(dispatch_get_main_queue(),^(void){finishBlock();}); è§£é‡Šä»¥ä¸‹ä»£ç çš„å†…å­˜æ³„æ¼åŸå› - (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath { HJTestCell *cell = [tableView dequeueReusableCellWithIdentifier:@&quot;TestCell&quot; forIndexPath:indexPath]; [cell setTouchBlock:^(HJTestCell *cell) { [self refreshData]; }]; return cell; } åŸå› ï¼š [cell setTouchBlock:^(HJTestCell *cell) { [self refreshData]; }]; äº§ç”Ÿå†…å­˜æ³„éœ²çš„åŸå› æ˜¯å› ä¸ºå¾ªç¯å¼•ç”¨ åœ¨ç»™cellè®¾ç½®çš„TouchBlockä¸­ï¼Œä½¿ç”¨äº†__strongä¿®é¥°çš„selfï¼Œç”±äºBlockçš„åŸç†ï¼Œå½“touchBlockä»æ ˆå¤åˆ¶åˆ°å †ä¸­æ—¶ï¼Œselfä¼šä¸€åŒå¤åˆ¶åˆ°å †ä¸­ï¼Œretainä¸€æ¬¡ï¼Œè¢«touchBlockæŒæœ‰ï¼Œè€ŒtouchBlockåˆæ˜¯è¢«cellæŒæœ‰çš„ï¼Œcellåˆè¢«tableViewæŒæœ‰ï¼ŒtableViewåˆè¢«selfæŒæœ‰ï¼Œå› æ­¤å½¢æˆäº†å¾ªç¯å¼•ç”¨ï¼šselfé—´æ¥æŒæœ‰touchBlockï¼ŒtouchBlockæŒæœ‰self ä¸€æ—¦äº§ç”Ÿäº†å¾ªç¯å¼•ç”¨ï¼Œç”±äºä¸¤ä¸ªobjectéƒ½è¢«å¼ºå¼•ç”¨ï¼Œæ‰€ä»¥retainCountå§‹ç»ˆä¸èƒ½ä¸º0ï¼Œæ— å‘é‡Šæ”¾ï¼Œäº§ç”Ÿå†…å­˜æ³„æ¼ è§£å†³åŠæ³•ï¼š ä½¿ç”¨weakSelfè§£é™¤touchBlockå¯¹selfçš„å¼ºå¼•ç”¨ __weak __typeof__(self) weakSelf = self; [cell setTouchBlock:^(HJTestCell *cell) { [weakSelf refreshData]; }];]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜6--KVOå’ŒKVC]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%986-KVO%E5%92%8CKVC%2F</url>
    <content type="text"><![CDATA[KVCçš„åº•å±‚å®ç°ï¼Ÿå½“ä¸€ä¸ªå¯¹è±¡è°ƒç”¨setValueæ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨ä¼šåšä»¥ä¸‹æ“ä½œï¼š â‘ æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åº”keyçš„setæ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±è°ƒç”¨setæ–¹æ³• â‘¡å¦‚æœsetæ–¹æ³•ä¸å­˜åœ¨ï¼Œå°±ä¼šæŸ¥æ‰¾ä¸keyç›¸åŒåç§°å¹¶ä¸”å¸¦ä¸‹åˆ’çº¿çš„æˆå‘˜å±æ€§ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥ç»™æˆå‘˜å±æ€§èµ‹å€¼ â‘¢å¦‚æœæ²¡æœ‰æ‰¾åˆ°_key,å°±ä¼šæŸ¥æ‰¾ç›¸åŒåç§°çš„å±æ€§keyï¼Œå¦‚æœæœ‰å°±ç›´æ¥èµ‹å€¼ â‘£å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼Œåˆ™è°ƒç”¨valueForUndefinedKey:å’ŒsetValue:forUndefinedKey:æ–¹æ³•ã€‚ è¿™äº›æ–¹æ³•çš„é»˜è®¤å®ç°éƒ½æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦é‡å†™å®ƒä»¬ã€‚ KVOçš„åº•å±‚å®ç°ï¼Ÿ kvoåŸºäºruntimeæœºåˆ¶å®ç°ã€‚ ä½¿ç”¨äº†isa æ··å†™ï¼ˆisa-swizzlingï¼‰ï¼Œå½“ä¸€ä¸ªå¯¹è±¡(å‡è®¾æ˜¯personå¯¹è±¡ï¼Œpersonçš„ç±»æ˜¯MYPerson)çš„å±æ€§å€¼(å‡è®¾personçš„age)å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªç±»ï¼Œç»§æ‰¿è‡ªMYPerson ï¼šNSKVONotifying_MYPersonï¼Œåœ¨è¿™ä¸ªç±»çš„setAgeæ–¹æ³•é‡Œé¢ï¼Œè°ƒç”¨ [super setAge:age] [self willChangeValueForKey:@&quot;age&quot;] å’Œ [self didChangeValueForKey:@&quot;age&quot;] ,è€Œè¿™ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨ä¼šä¸»åŠ¨è°ƒç”¨ç›‘å¬è€…å†…éƒ¨çš„- (void)observeValueForKeyPathè¿™ä¸ªæ–¹æ³•ã€‚ æƒ³è¦çœ‹åˆ°NSKVONotifying_MYPersonå¾ˆç®€å•ï¼Œåœ¨self.person.age = 20; è¿™é‡Œæ‰“æ–­ç‚¹ï¼Œåœ¨è°ƒè¯•åŒºåŸŸå°±èƒ½çœ‹åˆ° _person-&gt;NSObject-&gt;isa=(Class)NSKVONotifying_MYPerson. åŒæ—¶æˆ‘ä»¬åœ¨ self.person = [[MYPerson alloc]init]; åé¢æ‰“æ–­ç‚¹ï¼Œçœ‹åˆ° _person-&gt;NSObject-&gt;isa=(Class)MYPerson ç”±æ­¤å¯è§ï¼Œåœ¨æ·»åŠ ç›‘å¬è€…ä¹‹åï¼Œpersonç±»å‹å·²ç»ç”±MYPersonè¢«æ”¹å˜æˆNSKVONotifying_MYPerson ä»€ä¹ˆæ˜¯KVOå’ŒKVC?ç­”ï¼šKVC:é”® â€“ å€¼ç¼–ç  ä½¿ç”¨å­—ç¬¦ä¸²ç›´æ¥è®¿é—®å¯¹è±¡çš„å±æ€§ã€‚ KVO:é”®å€¼è§‚å¯Ÿæœºåˆ¶ï¼Œå®ƒæä¾›äº†è§‚å¯ŸæŸä¸€å±æ€§å˜åŒ–çš„æ–¹æ³• KVOçš„ç¼ºé™·?KVOæ˜¯ä¸€ä¸ªå¯¹è±¡èƒ½å¤Ÿè§‚å¯Ÿå¦å¤–ä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„å€¼ï¼Œå¹¶ä¸”èƒ½å¤Ÿå‘ç°å€¼çš„å˜åŒ–ã€‚å‰é¢ä¸¤ç§æ¨¡å¼æ›´åŠ é€‚åˆä¸€ä¸ªcontrollerä¸ä»»ä½•å…¶ä»–çš„å¯¹è±¡è¿›è¡Œé€šä¿¡ï¼Œè€ŒKVOæ›´åŠ é€‚åˆä»»ä½•ç±»å‹çš„å¯¹è±¡ä¾¦å¬å¦å¤–ä¸€ä¸ªä»»æ„å¯¹è±¡çš„æ”¹å˜ï¼ˆè¿™é‡Œä¹Ÿå¯ä»¥æ˜¯controllerï¼Œä½†ä¸€èˆ¬ä¸æ˜¯controllerï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªå¯¹è±¡ä¸å¦å¤–ä¸€ä¸ªå¯¹è±¡ä¿æŒåŒæ­¥çš„ä¸€ç§æ–¹æ³•ï¼Œå³å½“å¦å¤–ä¸€ç§å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè§‚å¯Ÿå¯¹è±¡é©¬ä¸Šä½œå‡ºååº”ã€‚å®ƒåªèƒ½ç”¨æ¥å¯¹å±æ€§ä½œå‡ºååº”ï¼Œè€Œä¸ä¼šç”¨æ¥å¯¹æ–¹æ³•æˆ–è€…åŠ¨ä½œä½œå‡ºååº”ã€‚ ä¼˜ç‚¹ï¼š 1.èƒ½å¤Ÿæä¾›ä¸€ç§ç®€å•çš„æ–¹æ³•å®ç°ä¸¤ä¸ªå¯¹è±¡é—´çš„åŒæ­¥ã€‚ä¾‹å¦‚ï¼šmodelå’Œviewä¹‹é—´åŒæ­¥ï¼› 2.èƒ½å¤Ÿå¯¹éæˆ‘ä»¬åˆ›å»ºçš„å¯¹è±¡ï¼Œå³å†…éƒ¨å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ä½œå‡ºå“åº”ï¼Œè€Œä¸”ä¸éœ€è¦æ”¹å˜å†…éƒ¨å¯¹è±¡ï¼ˆSKDå¯¹è±¡ï¼‰çš„å®ç°ï¼› 3.èƒ½å¤Ÿæä¾›è§‚å¯Ÿçš„å±æ€§çš„æœ€æ–°å€¼ä»¥åŠå…ˆå‰å€¼ï¼› 4.ç”¨key pathsæ¥è§‚å¯Ÿå±æ€§ï¼Œå› æ­¤ä¹Ÿå¯ä»¥è§‚å¯ŸåµŒå¥—å¯¹è±¡ï¼› 5.å®Œæˆäº†å¯¹è§‚å¯Ÿå¯¹è±¡çš„æŠ½è±¡ï¼Œå› ä¸ºä¸éœ€è¦é¢å¤–çš„ä»£ç æ¥å…è®¸è§‚å¯Ÿå€¼èƒ½å¤Ÿè¢«è§‚å¯Ÿ ç¼ºç‚¹ï¼š 1.æˆ‘ä»¬è§‚å¯Ÿçš„å±æ€§å¿…é¡»ä½¿ç”¨stringsæ¥å®šä¹‰ã€‚å› æ­¤åœ¨ç¼–è¯‘å™¨ä¸ä¼šå‡ºç°è­¦å‘Šä»¥åŠæ£€æŸ¥ï¼› 2.å¯¹å±æ€§é‡æ„å°†å¯¼è‡´æˆ‘ä»¬çš„è§‚å¯Ÿä»£ç ä¸å†å¯ç”¨ï¼› 3.å¤æ‚çš„â€œIFâ€è¯­å¥è¦æ±‚å¯¹è±¡æ­£åœ¨è§‚å¯Ÿå¤šä¸ªå€¼,è¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„è§‚å¯Ÿä»£ç é€šè¿‡ä¸€ä¸ªæ–¹æ³•æ¥æŒ‡å‘ï¼› 4.å½“é‡Šæ”¾è§‚å¯Ÿè€…æ—¶éœ€è¦ç§»é™¤è§‚å¯Ÿè€…ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜5--å†…å­˜ç®¡ç†]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%985-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%2F</url>
    <content type="text"><![CDATA[ARCå¤„ç†åŸç†ARCæ˜¯Objective-Cç¼–è¯‘å™¨çš„ç‰¹æ€§ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶ç‰¹æ€§æˆ–è€…åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒARCæ‰€åšçš„åªä¸è¿‡æ˜¯åœ¨ä»£ç ç¼–è¯‘æ—¶ä¸ºä½ è‡ªåŠ¨åœ¨åˆé€‚çš„ä½ç½®æ’å…¥releaseæˆ–autoreleaseï¼Œåªè¦æ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘å¯¹è±¡ï¼Œå¯¹è±¡å°±ä¼šè¢«é‡Šæ”¾ã€‚ å‰ç«¯ç¼–è¯‘å™¨ å‰ç«¯ç¼–è¯‘å™¨ä¼šä¸ºâ€œæ‹¥æœ‰çš„â€æ¯ä¸€ä¸ªå¯¹è±¡æ’å…¥ç›¸åº”çš„releaseè¯­å¥ã€‚å¦‚æœå¯¹è±¡çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦æ˜¯__strongï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯è¢«æ‹¥æœ‰çš„ã€‚å¦‚æœåœ¨æŸä¸ªæ–¹æ³•å†…åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå‰ç«¯ç¼–è¯‘å™¨ä¼šåœ¨æ–¹æ³•æœ«å°¾è‡ªåŠ¨æ’å…¥releaseè¯­å¥ä»¥é”€æ¯å®ƒã€‚è€Œç±»æ‹¥æœ‰çš„å¯¹è±¡ï¼ˆå®ä¾‹å˜é‡/å±æ€§ï¼‰ä¼šåœ¨deallocæ–¹æ³•å†…è¢«é‡Šæ”¾ã€‚äº‹å®ä¸Šï¼Œä½ å¹¶ä¸éœ€è¦å†™deallocæ–¹æ³•æˆ–è°ƒç”¨çˆ¶ç±»çš„deallocæ–¹æ³•ï¼ŒARCä¼šè‡ªåŠ¨å¸®ä½ å®Œæˆä¸€åˆ‡ã€‚æ­¤å¤–ï¼Œç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç ç”šè‡³ä¼šæ¯”ä½ è‡ªå·±å†™çš„releaseè¯­å¥çš„æ€§èƒ½è¿˜è¦å¥½ï¼Œå› ä¸ºç¼–è¾‘å™¨å¯ä»¥ä½œå‡ºä¸€äº›å‡è®¾ã€‚åœ¨ARCä¸­ï¼Œæ²¡æœ‰ç±»å¯ä»¥è¦†ç›–releaseæ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰è°ƒç”¨å®ƒçš„å¿…è¦ã€‚ARCä¼šé€šè¿‡ç›´æ¥ä½¿ç”¨objc_releaseæ¥ä¼˜åŒ–è°ƒç”¨è¿‡ç¨‹ã€‚è€Œå¯¹äºretainä¹Ÿæ˜¯åŒæ ·çš„æ–¹æ³•ã€‚ARCä¼šè°ƒç”¨objc_retainæ¥å–ä»£ä¿ç•™æ¶ˆæ¯ã€‚ ARCä¼˜åŒ–å™¨ è™½ç„¶å‰ç«¯ç¼–è¯‘å™¨å¬èµ·æ¥å¾ˆå‰å®³çš„æ ·å­ï¼Œä½†ä»£ç ä¸­æœ‰æ—¶ä»ä¼šå‡ºç°å‡ ä¸ªå¯¹retainå’Œreleaseçš„é‡å¤è°ƒç”¨ã€‚ARCä¼˜åŒ–å™¨è´Ÿè´£ç§»é™¤å¤šä½™çš„retainå’Œreleaseè¯­å¥ï¼Œç¡®ä¿ç”Ÿæˆçš„ä»£ç è¿è¡Œé€Ÿåº¦é«˜äºæ‰‹åŠ¨å¼•ç”¨è®¡æ•°çš„ä»£ç ã€‚ ä¸‹é¢å…³äºObjective-Cå†…å­˜ç®¡ç†çš„æè¿°é”™è¯¯çš„æ˜¯A å½“ä½¿ç”¨ARCæ¥ç®¡ç†å†…å­˜æ—¶ï¼Œä»£ç ä¸­ä¸å¯ä»¥å‡ºç°autorelease B autoreleasepool åœ¨ drain çš„æ—¶å€™ä¼šé‡Šæ”¾åœ¨å…¶ä¸­åˆ†é…çš„å¯¹è±¡ C å½“ä½¿ç”¨ARCæ¥ç®¡ç†å†…å­˜æ—¶ï¼Œåœ¨çº¿ç¨‹ä¸­å¤§é‡åˆ†é…å¯¹è±¡è€Œä¸ç”¨autoreleasepoolåˆ™å¯èƒ½ä¼šé€ æˆå†…å­˜æ³„éœ² D åœ¨ä½¿ç”¨ARCçš„é¡¹ç›®ä¸­ä¸èƒ½ä½¿ç”¨NSZone å‚è€ƒç­”æ¡ˆï¼šA ç†ç”±ï¼šARCåªæ˜¯åœ¨å¤§å¤šæ—¶å€™ç¼–è¯‘è‡ªåŠ¨ä¸ºæˆ‘ä»¬æ·»åŠ ä¸Šå†…å­˜ç®¡ç†çš„ä»£ç ï¼Œåªæ˜¯æˆ‘ä»¬çš„æºä»£ç çœ‹ä¸åˆ°è€Œå·²ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šæ·»åŠ ä¸Šç›¸å…³å†…å­˜ç®¡ç†ä»£ç ã€‚å¯¹äºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œåœ¨drainæ—¶ä¼šå°†è‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œè‹¥å¼•ç”¨è®¡æ•°ä¸º0ï¼Œåˆ™ä¼šè‡ªåŠ¨é‡Šæ”¾æ‰å…¶å†…å­˜ã€‚å¦‚æœåœ¨çº¿ç¨‹ä¸­éœ€è¦å¤§é‡åˆ†é…å†…å­˜ï¼Œæˆ‘ä»¬ç†åº”æ·»åŠ ä¸Šè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä»¥é˜²å†…å­˜æ³„éœ²ã€‚æ¯”å¦‚åœ¨forå¾ªç¯ä¸­è¦åˆ†é…å¤§é‡çš„å†…å­˜å¤„ç†æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥åœ¨forå¾ªç¯å†…æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œåœ¨æ¯ä¸ªå¾ªç¯åå°±å°†å†…å­˜é‡Šæ”¾æ‰ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ã€‚åœ¨ARCé¡¹ç›®ä¸­ï¼Œè‡ªç„¶ä¸èƒ½æ‰‹åŠ¨ä½¿ç”¨NSZoneï¼Œä¹Ÿä¸èƒ½è°ƒç”¨çˆ¶ç±»çš„deallocã€‚ MRCæ–‡ä»¶åœ¨ARCå·¥ç¨‹æ··åˆç¼–è¯‘æ—¶ï¼Œéœ€è¦åœ¨æ–‡ä»¶çš„Compiler Flagsä¸Šæ·»åŠ ä»€ä¹ˆå‚æ•°A -shared B -fno-objc-arc C -fobjc-arc D -dynamic å‚è€ƒç­”æ¡ˆï¼šB ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Œç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ ä»€ä¹ˆæƒ…å†µä½¿ç”¨weakå…³é”®å­—? åœ¨ ARC ä¸­,åœ¨æœ‰å¯èƒ½å‡ºç°å¾ªç¯å¼•ç”¨çš„æ—¶å€™,å¾€å¾€è¦é€šè¿‡è®©å…¶ä¸­ä¸€ç«¯ä½¿ç”¨ weak æ¥è§£å†³,æ¯”å¦‚: delegate ä»£ç†å±æ€§ è‡ªèº«å·²ç»å¯¹å®ƒè¿›è¡Œä¸€æ¬¡å¼ºå¼•ç”¨,æ²¡æœ‰å¿…è¦å†å¼ºå¼•ç”¨ä¸€æ¬¡,æ­¤æ—¶ä¹Ÿä¼šä½¿ç”¨ weak,è‡ªå®šä¹‰ IBOutlet æ§ä»¶å±æ€§ä¸€èˆ¬ä¹Ÿä½¿ç”¨ weakï¼›å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨strongã€‚ weakä¸assignçš„ä¸åŒ? weak æ­¤ç‰¹è´¨è¡¨æ˜è¯¥å±æ€§å®šä¹‰äº†ä¸€ç§â€œéæ‹¥æœ‰å…³ç³»â€ (nonowning relationship)ã€‚ä¸ºè¿™ç§å±æ€§è®¾ç½®æ–°å€¼æ—¶ï¼Œè®¾ç½®æ–¹æ³•æ—¢ä¸ä¿ç•™æ–°å€¼ï¼Œä¹Ÿä¸é‡Šæ”¾æ—§å€¼ã€‚æ­¤ç‰¹è´¨åŒassignç±»ä¼¼ï¼Œ ç„¶è€Œåœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©º(nil out)ã€‚ è€Œ assign çš„â€œè®¾ç½®æ–¹æ³•â€åªä¼šæ‰§è¡Œé’ˆå¯¹â€œçº¯é‡ç±»å‹â€ (scalar typeï¼Œä¾‹å¦‚ CGFloat æˆ– NSlnteger ç­‰)çš„ç®€å•èµ‹å€¼æ“ä½œã€‚ assigin å¯ä»¥ç”¨é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ è°ƒç”¨å¯¹è±¡çš„release æ–¹æ³•ä¼šé”€æ¯å¯¹è±¡å—ï¼Ÿ ä¸ä¼šï¼Œè°ƒç”¨å¯¹è±¡çš„release æ–¹æ³•åªæ˜¯å°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨-1ï¼Œå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ä¸º0çš„æ—¶å€™ä¼šè°ƒç”¨äº†å¯¹è±¡çš„dealloc æ–¹æ³•æ‰èƒ½è¿›è¡Œé‡Šæ”¾å¯¹è±¡çš„å†…å­˜ã€‚ è‡ªåŠ¨é‡Šæ”¾æ± å¸¸è§é¢è¯•ä»£ç for (int i = 0; i < someLargeNumber; ++i) { NSString *string = @"Abc"; string = [string lowercaseString]; string = [string stringByAppendingString:@"xyz"]; NSLog(@"%@",string); } é—®ï¼šä»¥ä¸Šä»£ç å­˜åœ¨ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿå¦‚æœå¾ªç¯çš„æ¬¡æ•°éå¸¸å¤§æ—¶ï¼Œåº”è¯¥å¦‚ä½•ä¿®æ”¹ï¼Ÿ å­˜åœ¨é—®é¢˜ï¼šé—®é¢˜å¤„åœ¨æ¯æ‰§è¡Œä¸€æ¬¡å¾ªç¯ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªstringåŠ åˆ°å½“å‰runloopä¸­çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œåªæœ‰å½“è‡ªåŠ¨é‡Šæ”¾æ± è¢«releaseçš„æ—¶å€™ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„æ ‡ç¤ºäº†autoreleaseçš„è¿™äº›æ•°æ®æ‰€å ç”¨çš„å†…å­˜ç©ºé—´æ‰èƒ½è¢«é‡Šæ”¾æ‰ã€‚å‡è®¾ï¼Œå½“someLargeNumberå¤§åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå†…å­˜ç©ºé—´å°†è¢«è€—å°½è€Œæ²¡æœ‰è¢«é‡Šæ”¾æ‰ï¼Œæ‰€ä»¥å°±å‡ºç°äº†å†…å­˜æº¢å‡ºçš„ç°è±¡ã€‚ è§£å†³åŠæ³•1ï¼šå¦‚æœiæ¯”è¾ƒå¤§ï¼Œå¯ä»¥ç”¨@autoreleasepool {}è§£å†³ï¼Œæ”¾åœ¨forå¾ªç¯å¤–ï¼Œå¾ªç¯ç»“æŸåï¼Œé”€æ¯åˆ›å»ºçš„å¯¹è±¡ï¼Œè§£å†³å æ®æ ˆåŒºå†…å­˜çš„é—®é¢˜ è§£å†³æ–¹æ³•2ï¼šå¦‚æœiç©å‘½å¤§ï¼Œä¸€æ¬¡å¾ªç¯éƒ½ä¼šé€ æˆè‡ªåŠ¨é‡Šæ”¾æ± è¢«å¡«æ»¡ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± æ”¾åœ¨forå¾ªç¯å†…ï¼Œæ¯æ¬¡å¾ªç¯éƒ½å°†ä¸Šä¸€æ¬¡åˆ›å»ºçš„å¯¹è±¡release ä¿®æ”¹ä¹‹å: for(int i = 0; i&lt;1000;i++) { NSAutoreleasePool * pool1 = [[NSAutoreleasePool alloc] init]; NSString *string = @&quot;Abc&quot;; string = [string lowercaseString]; string = [string stringByAppendingString:@&quot;xyz&quot;]; NSLog(@&quot;%@&quot;,string); //é‡Šæ”¾æ±  [pool1 drain]; } objective-Cå¯¹è±¡çš„å†…å­˜å¸ƒå±€æ˜¯æ€æ ·çš„ï¼Ÿ ç”±äºObjective-Cä¸­æ²¡æœ‰å¤šç»§æ‰¿ï¼Œå› æ­¤å…¶å†…å­˜å¸ƒå±€è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯ï¼šæœ€å‰é¢æœ‰ä¸ªisaæŒ‡é’ˆï¼Œç„¶åçˆ¶ç±»çš„å®ä¾‹å˜é‡å­˜æ”¾åœ¨å­ç±»çš„æˆå‘˜å˜é‡ä¹‹å‰ çœ‹ä¸‹é¢çš„ç¨‹åº,ç¬¬ä¸€ä¸ªNSLogä¼šè¾“å‡ºä»€ä¹ˆ?è¿™æ—¶strçš„retainCountæ˜¯å¤šå°‘?ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‘¢? ä¸ºä»€ä¹ˆ?NSMutableArray* ary = [[NSMutableArray array] retain]; NSString *str = [NSString stringWithFormat:@"test"]; [str retain]; [aryaddObject:str]; NSLog(@â€%@%dâ€,str,[str retainCount]); [str retain]; [str release]; [str release]; NSLog(@â€%@%dâ€,str,[str retainCount]); [aryremoveAllObjects] NSLog(@â€%@%dâ€,str,[str retainCount]); strçš„retainCountåˆ›å»º+1ï¼Œretain+1ï¼ŒåŠ å…¥æ•°ç»„è‡ªåŠ¨+1 3 retain+1ï¼Œrelease-1ï¼Œrelease-1 2 æ•°ç»„åˆ é™¤æ‰€æœ‰å¯¹è±¡ï¼Œæ‰€æœ‰æ•°ç»„å†…çš„å¯¹è±¡è‡ªåŠ¨-1 1 å›ç­”personçš„retainCountå€¼,å¹¶è§£é‡Šä¸ºä»€ä¹ˆPerson *per = [[Person alloc] init]; æ­¤æ—¶person çš„retainCountçš„å€¼æ˜¯1 self.person = per; åœ¨self.person æ—¶,å¦‚æœæ˜¯assign,personçš„ retainCountçš„å€¼ä¸å˜,ä»ä¸º1 è‹¥æ˜¯:retain personçš„retainCountçš„å€¼åŠ 1,å˜ä¸º2 è‹¥æ˜¯:copy personçš„retainCountå€¼ä¸å˜,ä»ä¸º1 ä»€ä¹ˆæ—¶å€™éœ€è¦åœ¨ç¨‹åºä¸­åˆ›å»ºå†…å­˜æ± ? ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ•°æ®çº¿ç¨‹ï¼Œåˆ™éœ€è¦åˆ›å»ºè¯¥çº¿ç¨‹çš„å†…å­˜æ±  å¦‚æœæˆ‘ä»¬ä¸åˆ›å»ºå†…å­˜æ± ï¼Œæ˜¯å¦æœ‰å†…å­˜æ± æä¾›ç»™æˆ‘ä»¬? ç•Œé¢çº¿ç¨‹ç»´æŠ¤ç€è‡ªå·±çš„å†…å­˜æ± ï¼Œç”¨æˆ·è‡ªå·±åˆ›å»ºçš„æ•°æ®çº¿ç¨‹ï¼Œåˆ™éœ€è¦åˆ›å»ºè¯¥çº¿ç¨‹çš„å†…å­˜æ±  è‹¹æœæ˜¯å¦‚ä½•å®ç°autoreleasepoolçš„ï¼Ÿautoreleasepoolä»¥ä¸€ä¸ªé˜Ÿåˆ—æ•°ç»„çš„å½¢å¼å®ç°,ä¸»è¦é€šè¿‡ä¸‹åˆ—ä¸‰ä¸ªå‡½æ•°å®Œæˆ. â€¢ objc_autoreleasepoolPush â€¢ objc_autoreleasepoolPop â€¢ objc_autorelease çœ‹å‡½æ•°åå°±å¯ä»¥çŸ¥é“ï¼Œå¯¹autoreleaseåˆ†åˆ«æ‰§è¡Œpushã€popæ“ä½œã€‚é”€æ¯å¯¹è±¡æ—¶æ‰§è¡Œreleaseæ“ä½œã€‚ objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ é€šè¿‡å¼•ç”¨è®¡æ•°å™¨(retainCount)çš„æœºåˆ¶æ¥å†³å®šå¯¹è±¡æ˜¯å¦éœ€è¦é‡Šæ”¾ã€‚ æ¯æ¬¡runloopå®Œæˆä¸€ä¸ªå¾ªç¯çš„æ—¶å€™ï¼Œéƒ½ä¼šæ£€æŸ¥å¯¹è±¡çš„ retainCountï¼Œå¦‚æœretainCountä¸º0ï¼Œè¯´æ˜è¯¥å¯¹è±¡æ²¡æœ‰åœ°æ–¹éœ€è¦ç»§ç»­ä½¿ç”¨äº†ï¼Œå¯ä»¥é‡Šæ”¾æ‰äº†ã€‚ ä¸ºä»€ä¹ˆè¦è¿›è¡Œå†…å­˜ç®¡ç†? å› ä¸ºç§»åŠ¨è®¾å¤‡çš„å†…å­˜æå…¶æœ‰é™,å½“ä¸€ä¸ªç¨‹åºæ‰€å å†…å­˜è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œ ç³»ç»Ÿä¼šå‘å‡ºå†…å­˜è­¦å‘Š. å½“ç¨‹åºè¾¾åˆ°æ›´å¤§çš„å€¼æ—¶, ç¨‹åºä¼šé—ªé€€, å½±å“ç”¨æˆ·ä½“éªŒ. ä¸ºäº†ä¿è¯ç¨‹åºçš„è¿è¡Œæµç•…, å¿…é¡»è¿›è¡Œå†…å­˜ç®¡ç† å†…å­˜ç®¡ç†çš„èŒƒå›´? ç®¡ç†æ‰€æœ‰ç»§æ‰¿è‡ªNSObjectçš„å¯¹è±¡, å¯¹åŸºæœ¬æ•°æ®ç±»å‹æ— æ•ˆ.æ˜¯å› ä¸ºå¯¹è±¡å’Œå…¶ä»–æ•°æ®ç±»å‹åœ¨ç³»ç»Ÿä¸­å­˜å‚¨çš„ç©ºé—´ä¸ä¸€æ ·,å…¶ä»–å±€éƒ¨å˜é‡ä¸»è¦å­˜å‚¨åœ¨æ ˆåŒº(å› ä¸ºåŸºæœ¬æ•°æ®ç±»å‹å ç”¨çš„å­˜å‚¨ç©ºé—´æ˜¯å›ºå®šçš„,ä¸€èˆ¬å­˜æ”¾äºæ ˆåŒº),è€Œå¯¹è±¡å­˜å‚¨äºå †ä¸­,å½“ä»£ç å—ç»“æŸæ—¶,è¿™ä¸ªä»£ç å—æ‰€æ¶‰åŠåˆ°çš„æ‰€æœ‰å±€éƒ¨å˜é‡ä¼šè‡ªåŠ¨å¼¹æ ˆæ¸…ç©º,æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆä¹Ÿä¼šè¢«å›æ”¶,è¿™æ—¶å¯¹è±¡å°±æ²¡æœ‰æŒ‡é’ˆæŒ‡å‘,ä½†ä¾ç„¶å­˜åœ¨äºå †å†…å­˜ä¸­,é€ æˆå†…å­˜æ³„éœ². objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜(æˆ–è€…å†…å­˜ç®¡ç†æ–¹å¼æœ‰å“ªäº›)ï¼Ÿ(é‡ç‚¹) MRC(manual retain-release)æ‰‹åŠ¨å†…å­˜ç®¡ç† ARC(automatic reference counting)è‡ªåŠ¨å¼•ç”¨è®¡æ•° Garbage collection (åƒåœ¾å›æ”¶)ã€‚ä½†æ˜¯iOSä¸æ”¯æŒåƒåœ¾å›æ”¶, ARCä½œä¸ºLLVM3.0ç¼–è¯‘å™¨çš„ä¸€é¡¹ç‰¹æ€§, åœ¨iOS5.0 (Xcode4) ç‰ˆæœ¬åæ¨å‡ºçš„ã€‚ ARCçš„åˆ¤æ–­å‡†åˆ™, åªè¦æ²¡æœ‰å¼ºæŒ‡é’ˆæŒ‡å‘å¯¹è±¡, å¯¹è±¡å°±ä¼šè¢«é‡Šæ”¾. iOSæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿ è¿™ä¸ªé—®é¢˜çš„è¯ä¸Šä¸€ä¸ªé—®é¢˜ä¹Ÿæåˆ°è¿‡,è®²ä¸‹blockçš„å†…å­˜ç®¡ç†,ARCä¸‹çš„é»„é‡‘æ³•åˆ™å°±è¡Œã€‚ è¿™é‡Œè¯´ä¸‹swifté‡Œçš„å†…å­˜ç®¡ç†: delgateç…§æ ·weakä¿®é¥°,é—­åŒ…å‰é¢ç”¨[weak self],swifté‡Œçš„æ–°ä¸œè¥¿,unowned,ä¸¾ä¾‹,å¦‚æœselfåœ¨é—­åŒ…è¢«è°ƒç”¨çš„æ—¶å€™å¯èƒ½ä¸ºç©º,åˆ™ç”¨weak,åä¹‹äº¦ç„¶,å¦‚æœä¸ºç©ºæ—¶ä½¿ç”¨äº†unowned,ç¨‹åºä¼šå´©æºƒ,ç±»ä¼¼è®¿é—®äº†æ‚¬æŒ‚æŒ‡é’ˆ,åœ¨ocä¸­ç±»ä¼¼äºunsafe_unretained,ç±»ä¼¼assignä¿®é¥°äº†ocå¯¹è±¡,å¯¹è±¡è¢«é”€æ¯å,è¢«unownedä¿®é¥°çš„å¯¹è±¡ä¸ä¼šä¸ºç©º,ä½†æ˜¯unownedè®¿é—®é€Ÿåº¦æ›´å¿«,å› ä¸ºweakéœ€è¦unwarpåæ‰èƒ½ä½¿ç”¨ å†…å­˜ç®¡ç†çš„åŸåˆ™ åªè¦è¿˜æœ‰äººåœ¨ä½¿ç”¨è¿™ä¸ªå¯¹è±¡, é‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±ä¸ä¼šè¢«å›æ”¶ åªæœ‰ä½ æƒ³ä½¿ç”¨è¿™ä¸ªå¯¹è±¡, é‚£ä¹ˆå°±åº”è¯¥è®©è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨åŠ 1 å½“ä½ ä¸æƒ³ä½¿ç”¨è¿™ä¸ªå¯¹è±¡æ—¶, åº”è¯¥è®©å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨å‡1 è°åˆ›å»º, å°±ç”±è°æ¥release å¦‚æœä½ é€šè¿‡alloc, new, copy æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡, å½“ä½ ä¸æƒ³ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™å°±å¿…é¡»è°ƒç”¨release æˆ–è€…autorelease è®©å¼•ç”¨è®¡æ•°å™¨å‡1 ä¸æ˜¯ä½ åˆ›å»ºçš„å°±ä¸ç”¨ä½ è´Ÿè´£ release è°retain è°release åªè¦ä½ è°ƒç”¨äº†retain ,æ— è®ºè¿™ä¸ªå¯¹è±¡å¦‚ä½•ç”Ÿæˆ, éƒ½éœ€è¦è°ƒç”¨release æ€»ç»“: æœ‰åŠ å°±åº”è¯¥æœ‰å‡, æ›¾è®©æŸä¸ªè®¡æ•°å™¨åŠ 1, å°±åº”è¯¥è®©å…¶åœ¨æœ€åå‡1 å†…å­˜ç®¡ç†ç ”ç©¶çš„å¯¹è±¡: é‡æŒ‡é’ˆ:æŒ‡é’ˆå˜é‡æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–æˆ–æŒ‡å‘çš„ç©ºé—´å·²ç»è¢«é‡Šæ”¾ã€‚ ä½¿ç”¨é‡æŒ‡é’ˆè°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œä¼šæŠ¥å¼‚å¸¸ï¼Œç¨‹åºå´©æºƒã€‚ é€šå¸¸å†è°ƒç”¨å®Œreleaseæ–¹æ³•åï¼ŒæŠŠä¿å­˜å¯¹è±¡æŒ‡é’ˆçš„åœ°å€æ¸…ç©ºï¼Œèµ‹å€¼ä¸ºnilï¼Œæ‰¾ocä¸­æ²¡æœ‰ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ‰€ä»¥[nil retain]è°ƒç”¨æ–¹æ³•ä¸ä¼šæœ‰å¼‚å¸¸ã€‚ å†…å­˜æ³„éœ² å¦‚ Person * person = [Person new]; (å¯¹è±¡æå‰èµ‹å€¼nilæˆ–è€…æ¸…ç©º)åœ¨æ ˆåŒºçš„personå·²ç»è¢«é‡Šæ”¾, è€Œå †åŒºnewäº§ç”Ÿçš„å¯¹è±¡è¿˜æ²¡æœ‰é‡Šæ”¾, å°±ä¼šé€ æˆå†…å­˜æ³„éœ² åœ¨MRCæ‰‹åŠ¨å¼•ç”¨è®¡æ•°å™¨æ¨¡å¼ä¸‹, é€ æˆå†…å­˜æ³„éœ²çš„æƒ…å†µ æ²¡æœ‰é…å¯¹é‡Šæ”¾ï¼Œä¸ç¬¦åˆå†…å­˜ç®¡ç†åŸåˆ™ å¯¹è±¡æå‰èµ‹å€¼nilæˆ–è€…æ¸…ç©ºï¼Œå¯¼è‡´releaseä¸èµ·ä½œç”¨ã€‚ åƒµå°¸å¯¹è±¡ : å †ä¸­å·²ç»è¢«é‡Šæ”¾çš„å¯¹è±¡(retainCount = 0) ç©ºæŒ‡é’ˆ : æŒ‡é’ˆèµ‹å€¼ä¸ºç©º,nil å¦‚ä½•åˆ¤æ–­å¯¹è±¡å·²ç»è¢«é”€æ¯ é‡å†™deallocæ–¹æ³•ï¼Œå¯¹è±¡é”€æ¯æ—¶ï¼Œä¼šè°ƒç”¨ï¼Œé‡å†™æ—¶ä¸€å®šè¦[super dealloc] retainCount = 0ï¼Œä½¿ç”¨retainèƒ½å¦å¤æ´»å¯¹è±¡ å·²ç»è¢«é‡Šæ”¾çš„å¯¹è±¡æ— æ³•å¤æ´» å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´å­˜åœ¨çš„å…³ç³» ç»§æ‰¿å…³ç³» ç»„åˆå…³ç³»ï¼ˆæ˜¯ä¸€ç§å¼ºçƒˆçš„åŒ…å«å…³ç³»ï¼‰ ä¾èµ–å…³ç³»(å¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’) å¯¹è±¡çš„ç»„åˆå…³ç³»ä¸­ï¼Œç¡®ä¿æˆå‘˜å˜é‡ä¸è¢«æå‰é‡Šæ”¾ï¼Ÿ é‡å†™setæ–¹æ³•ï¼Œåœ¨setæ–¹æ³•ä¸­ï¼Œretainè¯¥å¯¹è±¡ã€‚ æˆå‘˜å˜é‡çš„å¯¹è±¡ï¼Œåœ¨å“ªé‡Œé…å¯¹é‡Šæ”¾ï¼Ÿ deallocä¸­é‡Šæ”¾ å¯¹è±¡ç»„åˆå…³ç³»ä¸­ï¼Œå†…å­˜æ³„éœ²æœ‰å“ªå‡ ç§æƒ…å†µï¼Ÿ setæ–¹æ³•æ²¡æœ‰retainå¯¹è±¡ æ²¡æœ‰releaseæ—§å¯¹è±¡ æ²¡æœ‰åˆ¤æ–­å‘setæ–¹æ³•ä¸­ä¼ å…¥çš„æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ æ­£ç¡®é‡å†™setæ–¹æ³• åˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€å¯¹è±¡ releaseæ—§å¯¹è±¡ retainæ–°å¯¹è±¡ åˆ†åˆ«æè¿°å†…å­˜ç®¡ç†è¦ç‚¹ã€autoreleaseã€releaseã€NSAutoreleasePool?å¹¶è¯´æ˜autoreleaseæ˜¯ä»€ä¹ˆæ—¶å€™è¢«releaseçš„?ç®€è¿°ä»€ä¹ˆæ—¶å€™ç”±ä½ è´Ÿè´£é‡Šæ”¾å¯¹è±¡,ä»€ä¹ˆæ—¶å€™ä¸ç”±ä½ é‡Šæ”¾?[NSAutoreleasePool release]å’Œ[NSAutoreleasePool drain]æœ‰ä»€ä¹ˆåŒºåˆ«? å†…å­˜ç®¡ç†è¦ç‚¹:Objective-C ä½¿ç”¨å¼•ç”¨è®¡æ•°æœºåˆ¶(retainCount)æ¥ç®¡ç†å†…å­˜ã€‚ å†…å­˜æ¯è¢«å¼•ç”¨ä¸€æ¬¡,è¯¥å†…å­˜çš„å¼•ç”¨è®¡æ•°+1,æ¯è¢«é‡Šæ”¾ä¸€æ¬¡å¼• ç”¨è®¡æ•°-1ã€‚ å½“å¼•ç”¨è®¡æ•° = 0 çš„æ—¶å€™,è°ƒç”¨è¯¥å¯¹è±¡çš„ dealloc æ–¹æ³•,æ¥å½»åº•ä»å†…å­˜ä¸­åˆ é™¤è¯¥å¯¹è±¡ã€‚ alloc,allocWithZone,new(å¸¦åˆå§‹åŒ–)æ—¶:è¯¥å¯¹è±¡å¼•ç”¨è®¡æ•° +1; retain:æ‰‹åŠ¨ä¸ºè¯¥å¯¹è±¡å¼•ç”¨è®¡æ•° +1; copy:å¯¹è±¡å¼•ç”¨è®¡æ•° +1;//æ³¨æ„copyçš„OCæ•°æ®ç±»å‹æ˜¯å¦æœ‰mutableï¼Œå¦‚æœ‰ä¸ºæ·±æ‹·è´ï¼Œæ–°å¯¹è±¡è®¡æ•°ä¸º1ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¸ºæµ…æ‹·è´ï¼Œè®¡æ•°+1 mutableCopy:ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡,æ–°å¯¹è±¡å¼•ç”¨è®¡æ•°ä¸º 1; release:æ‰‹åŠ¨ä¸ºè¯¥å¯¹è±¡å¼•ç”¨è®¡æ•° -1; autorelease:æŠŠè¯¥å¯¹è±¡æ”¾å…¥è‡ªåŠ¨é‡Šæ”¾æ± ,å½“è‡ªåŠ¨é‡Šæ”¾æ± é‡Šæ”¾æ—¶,å…¶å†…çš„å¯¹è±¡å¼•ç”¨è®¡æ•° -1ã€‚ NSAutoreleasePool: NSAutoreleasePoolæ˜¯é€šè¿‡æ¥æ”¶å¯¹è±¡å‘å®ƒå‘é€çš„autoreleaseæ¶ˆæ¯,è®°å½•è¯¥å¯¹è±¡çš„releaseæ¶ˆæ¯,å½“è‡ªåŠ¨é‡Šæ”¾æ± è¢«é”€æ¯æ—¶,ä¼šè‡ªåŠ¨å‘æ± ä¸­çš„å¯¹è±¡å‘é€releaseæ¶ˆæ¯ã€‚ autorelease æ˜¯åœ¨è‡ªåŠ¨é‡Šæ”¾æ± è¢«é”€æ¯,å‘æ± ä¸­çš„å¯¹è±¡å‘é€release åªèƒ½é‡Šæ”¾è‡ªå·±æ‹¥æœ‰çš„å¯¹è±¡ã€‚ åŒºåˆ«æ˜¯:åœ¨å¼•ç”¨è®¡æ•°ç¯å¢ƒä¸‹(åœ¨ä¸ä½¿ç”¨ARCæƒ…å†µä¸‹),ä¸¤è€…åŸºæœ¬ä¸€æ ·,åœ¨GC(åƒåœ¾å›æ”¶åˆ¶)ç¯å¢ƒä¸‹,release æ˜¯ä¸€ä¸ªno-op(æ— æ•ˆæ“ä½œ),æ‰€ä»¥æ— è®ºæ˜¯ä¸æ˜¯GCéƒ½ä½¿ç”¨drain é¢è¯•ä¸­å†…å­˜ç®¡ç†,releaseå’Œautoreleaseçš„å«ä¹‰?è¿™é‡Œå°¤å…¶è¦å¼ºè°ƒä¸‹autorelease,å®ƒå¼•ç”³å‡ºè‡ªåŠ¨é‡Šæ”¾æ± ,ä¹Ÿèƒ½å¼•ç”³å‡ºRun loop! è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä»€ä¹ˆ,å¦‚ä½•å·¥ä½œ ? ä»€ä¹ˆæ˜¯è‡ªåŠ¨é‡Šæ”¾æ± ï¼šç”¨æ¥å­˜å‚¨å¤šä¸ªå¯¹è±¡ç±»å‹çš„æŒ‡é’ˆå˜é‡ è‡ªåŠ¨é‡Šæ”¾æ± å¯¹æ± å†…å¯¹è±¡çš„ä½œç”¨ï¼šå­˜å…¥æ± å†…çš„å¯¹è±¡ï¼Œå½“è‡ªåŠ¨é‡Šæ”¾æ± è¢«é”€æ¯æ—¶ï¼Œä¼šå¯¹æ± å†…å¯¹è±¡å…¨éƒ¨åšä¸€æ¬¡releaseæ“ä½œ å¯¹è±¡å¦‚ä½•åŠ å…¥æ± ä¸­ï¼šè°ƒç”¨å¯¹è±¡çš„autoreleaseæ–¹æ³• è‡ªåŠ¨é‡Šæ”¾æ± èƒ½åµŒå¥—ä½¿ç”¨å—ï¼šèƒ½ è‡ªåŠ¨é‡Šæ”¾æ± ä½•æ—¶è¢«é”€æ¯ ï¼šç®€å•çš„çœ‹ï¼Œautoreleaseçš„â€}â€æ‰§è¡Œå®Œä»¥åã€‚è€Œå®é™…æƒ…å†µæ˜¯Autoreleaseå¯¹è±¡æ˜¯åœ¨å½“å‰çš„runloopè¿­ä»£ç»“æŸæ—¶é‡Šæ”¾çš„ï¼Œè€Œå®ƒèƒ½å¤Ÿé‡Šæ”¾çš„åŸå› æ˜¯ç³»ç»Ÿåœ¨æ¯ä¸ªrunloopè¿­ä»£ä¸­éƒ½åŠ å…¥äº†è‡ªåŠ¨é‡Šæ”¾æ± Pushå’ŒPop å¤šæ¬¡è°ƒç”¨å¯¹è±¡çš„autoreleaseæ–¹æ³•ä¼šå¯¼è‡´ï¼šé‡æŒ‡é’ˆå¼‚å¸¸ è‡ªåŠ¨é‡Šæ”¾æ± çš„ä½œç”¨ï¼šå°†å¯¹è±¡ä¸è‡ªåŠ¨é‡Šæ”¾æ± å»ºç«‹å…³ç³»ï¼Œæ± å­å†…è°ƒç”¨autoreleaseï¼Œåœ¨è‡ªåŠ¨é‡Šæ”¾æ± é”€æ¯æ—¶é”€æ¯å¯¹è±¡ï¼Œå»¶è¿Ÿreleaseé”€æ¯æ—¶é—´ è‡ªåŠ¨é‡Šæ”¾æ± ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼Ÿ é€šè¿‡Observerç›‘å¬RunLoopçš„çŠ¶æ€ï¼Œä¸€æ—¦ç›‘å¬åˆ°RunLoopå³å°†è¿›å…¥ç¡çœ ç­‰å¾…çŠ¶æ€ï¼Œå°±é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆkCFRunLoopBeforeWaitingï¼‰ iPhone OSæœ‰æ²¡æœ‰åƒåœ¾å›æ”¶?autorelease å’Œåƒåœ¾å›æ”¶åˆ¶(gc)æœ‰ä»€ä¹ˆå…³ç³»? iOS ä¸­æ²¡æœ‰åƒåœ¾å›æ”¶ã€‚autoreleaseåªæ˜¯å»¶è¿Ÿé‡Šæ”¾,gcæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´è¯¢é—®ç¨‹åº,çœ‹æ˜¯å¦æœ‰æ— æŒ‡é’ˆæŒ‡å‘çš„å¯¹è±¡,è‹¥æœ‰,å°±å°†å®ƒå›æ”¶ã€‚ä»–ä»¬ä¸¤è€…æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚ ARCé—®é¢˜ ä»€ä¹ˆæ˜¯arcæœºåˆ¶ï¼šè‡ªåŠ¨å¼•ç”¨è®¡æ•°. ç³»ç»Ÿåˆ¤æ–­å¯¹è±¡æ˜¯å¦é”€æ¯çš„ä¾æ®ï¼šæŒ‡å‘å¯¹è±¡çš„å¼ºæŒ‡é’ˆæ˜¯å¦è¢«é”€æ¯ arcçš„æœ¬è´¨ï¼šå¯¹retainCountè®¡ç®—ï¼Œåˆ›å»º+1 æ¸…ç©ºæŒ‡é’ˆ - 1 æˆ–è€…åˆ°è¾¾autoreleasepoolçš„å¤§æ‹¬å·-1 arcç›®çš„ï¼šä¸éœ€è¦ç¨‹åºå‘˜å…³å¿ƒretainå’Œreleaseæ“ä½œ. å¦‚ä½•è§£å†³arcæœºåˆ¶ä¸‹ç±»çš„ç›¸äº’å¼•ç”¨ï¼š.hæ–‡ä»¶ä¸­ä½¿ç”¨@classå…³é”®å­—å£°æ˜ä¸€ä¸ªç±»ï¼Œä¸¤ç«¯ä¸èƒ½éƒ½ç”¨å¼ºæŒ‡é’ˆï¼Œä¸€ç«¯ç”¨strongä¸€ç«¯ç”¨weak ARCé€šè¿‡ä»€ä¹ˆæ–¹å¼å¸®åŠ©å¼€å‘è€…ç®¡ç†å†…å­˜ï¼ŸARCç›¸å¯¹äºMRCï¼Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æ·»åŠ retain/release/autoreleaseè¿™ä¹ˆç®€å•ã€‚åº”è¯¥æ˜¯ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸä¸¤éƒ¨åˆ†å…±åŒå¸®åŠ©å¼€å‘è€…ç®¡ç†å†…å­˜ã€‚ åœ¨ç¼–è¯‘æœŸï¼ŒARCç”¨çš„æ˜¯æ›´åº•å±‚çš„Cæ¥å£å®ç°çš„retain/release/autoreleaseï¼Œè¿™æ ·åšæ€§èƒ½æ›´å¥½ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ARCç¯å¢ƒä¸‹æ‰‹åŠ¨retain/release/autoreleaseï¼ŒåŒæ—¶å¯¹åŒä¸€ä¸Šä¸‹æ–‡çš„åŒä¸€å¯¹è±¡çš„æˆå¯¹retain/releaseæ“ä½œè¿›è¡Œä¼˜åŒ–ï¼ˆå³å¿½ç•¥æ‰ä¸å¿…è¦çš„æ“ä½œï¼‰ ARCä¹ŸåŒ…å«è¿è¡ŒæœŸç»„ä»¶ï¼Œè¿™ä¸ªåœ°æ–¹åšçš„ä¼˜åŒ–æ¯”è¾ƒå¤æ‚ï¼Œä½†ä¹Ÿä¸èƒ½è¢«å¿½ç•¥ï¼Œæ‰‹åŠ¨å»åšæœªå¿…ä¼˜åŒ–å¾—å¥½ï¼Œå› æ­¤ç›´æ¥äº¤ç»™ç¼–è¯‘å™¨æ¥ä¼˜åŒ–ï¼Œç›¸ä¿¡è‹¹æœå§ï¼ å¼€å‘é¡¹ç›®æ—¶ä½ æ˜¯æ€ä¹ˆæ£€æŸ¥å†…å­˜æ³„éœ² é™æ€åˆ†æ analyze instrumentså·¥å…·é‡Œé¢æœ‰ä¸ªleak å¯ä»¥åŠ¨æ€åˆ†æ å¦‚æœåœ¨blockä¸­å¤šæ¬¡ä½¿ç”¨ weakSelfçš„è¯ï¼Œå¯ä»¥åœ¨blockä¸­å…ˆä½¿ç”¨strongSelfï¼Œé˜²æ­¢blockæ‰§è¡Œæ—¶weakSelfè¢«æ„å¤–é‡Šæ”¾ å¯¹äºéARCï¼Œå°† weak æ”¹ç”¨ä¸º block å³å¯ éº»çƒ¦ä½ è®¾è®¡ä¸ªç®€å•çš„å›¾ç‰‡å†…å­˜ç¼“å­˜å™¨ï¼ˆç§»é™¤ç­–ç•¥æ˜¯ä¸€å®šè¦è¯´çš„ï¼‰ å†…å­˜ç¼“å­˜æ˜¯ä¸ªé€šç”¨è¯é¢˜ï¼Œæ¯ä¸ªå¹³å°éƒ½ä¼šæ¶‰åŠåˆ°ã€‚cacheç®—æ³•ä¼šå½±å“åˆ°æ•´ä¸ªappçš„è¡¨ç°ã€‚å€™é€‰äººæœ€å¥½èƒ½è°ˆä¸‹è‡ªå·±éƒ½äº†è§£å“ªäº›cacheç­–ç•¥åŠå„è‡ªçš„ç‰¹ç‚¹ã€‚ å¸¸è§çš„æœ‰FIFO,LRU,LFUç­‰ç­‰ã€‚ç”±äºNSCacheçš„ç¼“å­˜ç­–ç•¥ä¸é€æ˜ï¼Œä¸€äº›appå¼€å‘è€…ä¼šé€‰æ‹©è‡ªå·±åšä¸€å¥—cacheæœºåˆ¶ï¼Œå…¶å®å¹¶ä¸éš¾ã€‚ FIFO : æ–°è®¿é—®çš„æ•°æ®æ’å…¥FIFOé˜Ÿåˆ—å°¾éƒ¨ï¼Œæ•°æ®åœ¨FIFOé˜Ÿåˆ—ä¸­é¡ºåºç§»åŠ¨ï¼›æ·˜æ±°FIFOé˜Ÿåˆ—å¤´éƒ¨çš„æ•°æ®ï¼› LRU : æ–°æ•°æ®æ’å…¥åˆ°é“¾è¡¨å¤´éƒ¨ï¼›æ¯å½“ç¼“å­˜æ•°æ®å‘½ä¸­ï¼Œåˆ™å°†æ•°æ®ç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼›å½“é“¾è¡¨æ»¡çš„æ—¶å€™ï¼Œå°†é“¾è¡¨å°¾éƒ¨çš„æ•°æ®ä¸¢å¼ƒï¼› LFU : æ–°åŠ å…¥æ•°æ®æ’å…¥åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼ˆå› ä¸ºå¼•ç”¨è®¡æ•°ä¸º1ï¼‰ï¼›é˜Ÿåˆ—ä¸­çš„æ•°æ®è¢«è®¿é—®åï¼Œå¼•ç”¨è®¡æ•°å¢åŠ ï¼Œé˜Ÿåˆ—é‡æ–°æ’åºï¼›å½“éœ€è¦æ·˜æ±°æ•°æ®æ—¶ï¼Œå°†å·²ç»æ’åºçš„åˆ—è¡¨æœ€åçš„æ•°æ®å—åˆ é™¤ï¼› å¸¸è§çš„å‡ºç°å†…å­˜å¾ªç¯å¼•ç”¨çš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ å®šæ—¶å™¨ï¼ˆNSTimerï¼‰ï¼š NSTimerç»å¸¸ä¼šè¢«ä½œä¸ºæŸä¸ªç±»çš„æˆå‘˜å˜é‡ï¼Œè€ŒNSTimeråˆå§‹åŒ–æ—¶è¦æŒ‡å®šselfä¸ºtargetï¼Œå®¹æ˜“é€ æˆå¾ªç¯å¼•ç”¨ï¼ˆself-&gt;timer-&gt;selfï¼‰ã€‚ å¦å¤–ï¼Œè‹¥timerä¸€ç›´å¤„äºvalidateçš„çŠ¶æ€ï¼Œåˆ™å…¶å¼•ç”¨è®¡æ•°å°†å§‹ç»ˆå¤§äº0ï¼Œå› æ­¤åœ¨ä¸å†ä½¿ç”¨å®šæ—¶å™¨ä»¥åï¼Œåº”è¯¥å…ˆè°ƒç”¨invalidateæ–¹æ³• blockçš„ä½¿ç”¨ï¼š blockåœ¨copyæ—¶éƒ½ä¼šå¯¹blockå†…éƒ¨ç”¨åˆ°çš„å¯¹è±¡è¿›è¡Œå¼ºå¼•ç”¨(ARC)æˆ–è€…retainCountå¢1(éARC)ã€‚åœ¨ARCä¸éARCç¯å¢ƒä¸‹å¯¹blockä½¿ç”¨ä¸å½“éƒ½ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œ ä¸€èˆ¬è¡¨ç°ä¸ºï¼ŒæŸä¸ªç±»å°†blockä½œä¸ºè‡ªå·±çš„å±æ€§å˜é‡ï¼Œç„¶åè¯¥ç±»åœ¨blockçš„æ–¹æ³•ä½“é‡Œé¢åˆä½¿ç”¨äº†è¯¥ç±»æœ¬èº«ï¼Œç®€å•è¯´å°±æ˜¯self.someBlock =Type var{[self dosomething];æˆ–è€…self.otherVar = XXX;æˆ–è€…_otherVar = â€¦};å‡ºç°å¾ªç¯çš„åŸå› æ˜¯ï¼šself-&gt;block-&gt;selfæˆ–è€…self-&gt;block-&gt;_ivarï¼ˆæˆå‘˜å˜é‡ï¼‰ ä»£ç†ï¼ˆdelegateï¼‰ï¼š åœ¨å§”æ‰˜é—®é¢˜ä¸Šå‡ºç°å¾ªç¯å¼•ç”¨é—®é¢˜å·²ç»æ˜¯è€ç”Ÿå¸¸è°ˆäº†ï¼Œè§„é¿è¯¥é—®é¢˜çš„æ€æ‰‹é”ä¹Ÿæ˜¯ç®€å•åˆ°å“­ï¼Œä¸€å­—è¯€ï¼šå£°æ˜delegateæ—¶è¯·ç”¨assign(MRC)æˆ–è€…weak(ARC)ï¼Œåƒä¸‡åˆ«æ‰‹è´±ç©ä¸€ä¸‹retainæˆ–è€…strongï¼Œæ¯•ç«Ÿè¿™åŸºæœ¬é€ƒä¸æ‰å¾ªç¯å¼•ç”¨äº†ï¼ å¯¹è±¡æ·»åŠ åˆ°é€šçŸ¥ä¸­å¿ƒä¸­ï¼Œå½“é€šçŸ¥ä¸­å¿ƒå‘é€šçŸ¥æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å´å·²ç»è¢«é‡Šæ”¾äº†ï¼Œå¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ å…¶å®è¿™ç§åªæ˜¯è€ƒæŸ¥å¯¹é€šçŸ¥çš„ç®€å•åº”ç”¨ã€‚é€šçŸ¥æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œä¸»è¦ä½¿ç”¨åœºæ™¯æ˜¯è·¨æ¨¡å—ä¼ å€¼ã€‚å½“æŸå¯¹è±¡åŠ å…¥åˆ°é€šçŸ¥ä¸­å¿ƒåï¼Œè‹¥åœ¨å¯¹è±¡è¢«é”€æ¯å‰ä¸å°†è¯¥å¯¹è±¡ä»é€šçŸ¥ä¸­å¿ƒä¸­ç§»é™¤ï¼Œå½“å‘é€é€šçŸ¥æ—¶ï¼Œå°±ä¼šé€ æˆå´©æºƒã€‚è¿™æ˜¯å¾ˆå¸¸è§çš„ã€‚æ‰€ä»¥ï¼Œåœ¨æ·»åŠ åˆ°é€šçŸ¥ä¸­å¿ƒåï¼Œä¸€å®šè¦åœ¨é‡Šæ”¾å‰ç§»é™¤ã€‚ ARCä¸‹ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶ï¼Œé»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹é»˜è®¤å…³é”®å­—æ˜¯ï¼šatomic,readwrite,assign å¯¹äºæ™®é€šçš„Objective-Cå¯¹è±¡ï¼šatomic,readwrite,strong å†™ä¸€ä¸ªä¾¿åˆ©æ„é€ å™¨+ (id)Person { Person *person=[Person alloc]init]; return [person autorelease]; å¤‡æ³¨:ARCæ—¶ä¸ç”¨ autorelease } å†™å‡ºä¸‹é¢ç¨‹åºæ®µçš„è¾“å‡ºç»“æœNSDictionary *dict = [NSDictionary dictionaryWithObject:@"a string value" forKey:@"akey"]; NSLog(@"%@", [dict objectForKey:@"akey"]); [dict release]; æ‰“å°è¾“å‡º a string value,ç„¶åå´©æºƒ----åŸå› :ä¾¿åˆ©æ„é€ å™¨åˆ›å»ºçš„å¯¹è±¡,ä¹‹åçš„release,ä¼šé€ æˆè¿‡åº¦é‡Šæ”¾ è¯·å†™å‡ºä»¥ä¸‹ä»£ç çš„æ‰§è¡Œç»“æœNSString * name = [ [ NSString alloc] init ]; name = @â€Habbâ€; [ name release]; æ‰“å°è¾“å‡ºç»“æœæ˜¯: Habb,åœ¨[name release]å‰åæ‰“å°å‡æœ‰è¾“å‡ºç»“æœ ---ä¼šé€ æˆå†…å­˜æ³„éœ²---åŸå…ˆæŒ‡å‘çš„åŒºåŸŸå˜æˆäº†é‡æŒ‡é’ˆ,ä¹‹åçš„é‡Šæ”¾,ä¸èƒ½é‡Šæ”¾ä¹‹å‰åˆ›å»ºçš„åŒºåŸŸ å†™å‡ºæ–¹æ³•è·å–iOSå†…å­˜ä½¿ç”¨æƒ…å†µï¼ŸiOSæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„ï¼Ÿæˆ‘ç›¸ä¿¡å¾ˆå¤šäººçš„å›ç­”æ˜¯å†…å­˜ç®¡ç†çš„é»„é‡‘æ³•åˆ™ï¼Œå…¶å®å¦‚æœæˆ‘æ˜¯é¢è¯•å®˜ï¼Œæˆ‘æƒ³è¦çš„ç­”æ¡ˆä¸æ˜¯è¿™æ ·çš„ã€‚æˆ‘å¸Œæœ›çš„å›ç­”æ˜¯å·¥ä½œä¸­å¦‚ä½•å¤„ç†å†…å­˜ç®¡ç†çš„ã€‚ å‚è€ƒç­”æ¡ˆï¼š Blockå†…å­˜ç®¡ç†ï¼šç”±äºä½¿ç”¨blockå¾ˆå®¹æ˜“é€ æˆå¾ªç¯å¼•ç”¨ï¼Œå› æ­¤ä¸€å®šè¦å°å¿ƒå†…å­˜ç®¡ç†é—®é¢˜ã€‚æœ€å¥½åœ¨åŸºç±»controllerä¸‹é‡å†™deallocï¼ŒåŠ ä¸€å¥æ‰“å°æ—¥å¿—ï¼Œè¡¨ç¤ºç±»å¯ä»¥å¾—åˆ°é‡Šæ”¾ã€‚å¦‚æœå‡ºç°æ— æ‰“å°ä¿¡æ¯ï¼Œè¯´æ˜è¿™ä¸ªç±»ä¸€ç›´å¾—ä¸åˆ°é‡Šæ”¾ï¼Œè¡¨æ˜å¾ˆæœ‰å¯èƒ½æ˜¯ä½¿ç”¨blockçš„åœ°æ–¹å‡ºç°å¾ªç¯å¼•ç”¨äº†ã€‚å¯¹äºblockä¸­éœ€è¦å¼•ç”¨å¤–éƒ¨controllerçš„å±æ€§æˆ–è€…æˆå‘˜å˜é‡æ—¶ï¼Œä¸€å®šè¦ä½¿ç”¨å¼±å¼•ç”¨ï¼Œç‰¹åˆ«æ˜¯æˆå‘˜å˜é‡åƒ_testIdè¿™æ ·çš„ï¼Œå¾ˆå¤šäººéƒ½æ²¡æœ‰ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜å¾—ä¸åˆ°é‡Šæ”¾ã€‚ å¯¹äºæ™®é€šæ‰€åˆ›å»ºçš„å¯¹è±¡ï¼Œå› ä¸ºç°åœ¨éƒ½æ˜¯ARCé¡¹ç›®ï¼Œæ‰€ä»¥è®°ä½å†…å­˜ç®¡ç†çš„é»„é‡‘æ³•åˆ™å°±å¯ä»¥è§£å†³ã€‚ å¾ˆå¤šå†…ç½®çš„ç±»ï¼Œå¦‚tableviewçš„delegateçš„å±æ€§æ˜¯assignä¸æ˜¯retainï¼Ÿ tableviewçš„ä»£ç†ä¸€èˆ¬éƒ½æ˜¯å®ƒæ‰€å±çš„æ§åˆ¶å™¨ï¼Œæ§åˆ¶å™¨ä¼šå¯¹å®ƒå†…éƒ¨çš„viewè¿›è¡Œä¸€æ¬¡retainæ“ä½œï¼Œè€Œtableviewå¯¹ä»£ç†æ§åˆ¶å™¨ä¹Ÿè¿›è¡Œä¸€æ¬¡retainæ“ä½œï¼Œå°±ä¼šå‡ºç°å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜4--Objective-C]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%984-Objective-C%2F</url>
    <content type="text"><![CDATA[é¢è¯•ç¬”è¯•éƒ½æ˜¯å¿…è€ƒè¯­æ³•çŸ¥è¯†çš„ã€‚è¯·è®¤çœŸå¤ä¹ å’Œæ·±å…¥ç ”ç©¶OCã€‚ æ–¹æ³•å’Œé€‰æ‹©å™¨æœ‰ä½•ä¸åŒï¼Ÿ(Difference between method and selector?) selectoræ˜¯ä¸€ä¸ªæ–¹æ³•çš„åå­—ï¼Œmethodæ˜¯ä¸€ä¸ªç»„åˆä½“ï¼ŒåŒ…å«äº†åå­—å’Œå®ç°. Core Foundationçš„å†…å­˜ç®¡ç† å‡¡æ˜¯å¸¦æœ‰Createã€Copyã€Retainç­‰å­—çœ¼çš„å‡½æ•°ï¼Œåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œéƒ½éœ€è¦åœ¨æœ€ååšä¸€æ¬¡release æ¯”å¦‚CFRunLoopObserverCreate releaseå‡½æ•°ï¼šCFRelease(å¯¹è±¡); mallocå’ŒNewçš„åŒºåˆ« new æ˜¯c++ä¸­çš„æ“ä½œç¬¦ï¼Œmallocæ˜¯c ä¸­çš„ä¸€ä¸ªå‡½æ•° new ä¸æ­¢æ˜¯åˆ†é…å†…å­˜ï¼Œè€Œä¸”ä¼šè°ƒç”¨ç±»çš„æ„é€ å‡½æ•°ï¼ŒåŒç†deleteä¼šè°ƒç”¨ç±»çš„ææ„å‡½æ•°ï¼Œè€Œmallocåˆ™åªåˆ†é…å†…å­˜ï¼Œä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ç±»æˆå‘˜çš„å·¥ä½œï¼ŒåŒæ ·freeä¹Ÿä¸ä¼šè°ƒç”¨ææ„å‡½æ•° å†…å­˜æ³„æ¼å¯¹äºmallocæˆ–è€…newéƒ½å¯ä»¥æ£€æŸ¥å‡ºæ¥çš„ï¼ŒåŒºåˆ«åœ¨äºnewå¯ä»¥æŒ‡æ˜æ˜¯é‚£ä¸ªæ–‡ä»¶çš„é‚£ä¸€è¡Œï¼Œ è€Œmallocæ²¡æœ‰è¿™äº›ä¿¡æ¯ã€‚ new å’Œ mallocæ•ˆç‡æ¯”è¾ƒ newå¯ä»¥è®¤ä¸ºæ˜¯mallocåŠ æ„é€ å‡½æ•°çš„æ‰§è¡Œã€‚ newå‡ºæ¥çš„æŒ‡é’ˆæ˜¯ç›´æ¥å¸¦ç±»å‹ä¿¡æ¯çš„ã€‚ ä½ æ˜¯å¦æ¥è§¦è¿‡OCä¸­çš„åå°„æœºåˆ¶ï¼Ÿç®€å•èŠä¸€ä¸‹æ¦‚å¿µå’Œä½¿ç”¨ classåå°„ é€šè¿‡ç±»åçš„å­—ç¬¦ä¸²å½¢å¼å®ä¾‹åŒ–å¯¹è±¡ Class class NSClassFromString@(@"student"); Student *stu = [[class alloc ]init]; å°†ç±»åå˜ä¸ºå­—ç¬¦ä¸² Class class =[Student class]; NSString *className = NSStringFromClass(class); SELçš„åå°„ é€šè¿‡æ–¹æ³•çš„å­—ç¬¦ä¸²å½¢å¼å®ä¾‹åŒ–æ–¹æ³• SEL selector = NSSelectorFromClass(@"setName"); [stu performSelector:selector withObject:@"Mike"]; å°†æ–¹æ³•å˜æˆå­—ç¬¦ä¸² NSStringFomrSelector(@selector*(setName:)) ä»€ä¹ˆæ˜¯SEL?å¦‚ä½•å£°æ˜ä¸€ä¸ªSEL?é€šè¿‡é‚£äº›æ–¹æ³•èƒ½å¤Ÿ,è°ƒç”¨SELåŒ…è£…èµ·æ¥çš„æ–¹æ³•? SELå°±æ˜¯å¯¹æ–¹æ³•çš„ä¸€ç§åŒ…è£…ã€‚åŒ…è£…çš„SELç±»å‹æ•°æ®å®ƒå¯¹åº”ç›¸åº”çš„æ–¹æ³•åœ°å€ï¼Œæ‰¾åˆ°æ–¹æ³•åœ°å€å°±å¯ä»¥è°ƒç”¨æ–¹æ³•ã€‚åœ¨å†…å­˜ä¸­æ¯ä¸ªç±»çš„æ–¹æ³•éƒ½å­˜å‚¨åœ¨ç±»å¯¹è±¡ä¸­ï¼Œæ¯ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„SELç±»å‹çš„æ•°æ®ï¼Œæ ¹æ®ä¸€ä¸ªSELæ•°æ®å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•åœ°å€ï¼Œè¿›è€Œè°ƒç”¨æ–¹æ³•ã€‚ SEL s1 = @selector(test1); // å°†test1æ–¹æ³•åŒ…è£…æˆSELå¯¹è±¡ SEL s2 = NSSelectorFromString(@"test1"); // å°†ä¸€ä¸ªå­—ç¬¦ä¸²æ–¹æ³•è½¬æ¢æˆä¸ºSELå¯¹è±¡ è°ƒç”¨æ–¹æ³•æœ‰ä¸¤ç§æ–¹å¼ï¼š 1.ç›´æ¥é€šè¿‡æ–¹æ³•åæ¥è°ƒç”¨ [person text] 2.é—´æ¥çš„é€šè¿‡SELæ•°æ®æ¥è°ƒç”¨ SEL aaa = @selector(text); [person performSelector:aaa]; åè®®ä¸­æ˜¯ä»€ä¹ˆæ„æ€?å­ç±»ç»§æ‰¿äº†çˆ¶ç±»,é‚£ä¹ˆå­ç±»ä¼šéµå®ˆçˆ¶ç±»ä¸­éµå®ˆçš„åè®®å—?åè®®ä¸­èƒ½å¤Ÿå®šä¹‰æˆå‘˜å˜é‡?å¦‚ä½•çº¦æŸä¸€ä¸ªå¯¹è±¡ç±»å‹çš„å˜é‡è¦å­˜å‚¨çš„åœ°å€æ˜¯éµå®ˆä¸€ä¸ªåè®®å¯¹è±¡? éµå®ˆNSObjectåè®® ä¼š èƒ½ï¼Œä½†æ˜¯åªåœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œç¼–è¯‘å™¨æ˜¯ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå®ä¾‹å˜é‡çš„ã€‚éœ€è¦è‡ªå·±å¤„ç†getterå’Œsetteræ–¹æ³• id NS/CF/CG/CA/UIè¿™äº›å‰ç¼€åˆ†åˆ«æ˜¯ä»€ä¹ˆå«ä¹‰ å‡½æ•°å½’å±äºå±äºcocoa Fundationæ¡†æ¶ å‡½æ•°å½’å±äºå±äºcore Fundationæ¡†æ¶ å‡½æ•°å½’å±äºå±äºCoreGraphics.frameworksæ¡†æ¶ å‡½æ•°å½’å±äºå±äºCoreAnimation.frameworksæ¡†æ¶ å‡½æ•°å½’å±äºå±äºUIkitæ¡†æ¶ é¢å‘å¯¹è±¡éƒ½æœ‰å“ªäº›ç‰¹å¾ä»¥åŠä½ å¯¹è¿™äº›ç‰¹å¾çš„ç†è§£ã€‚ ç»§æ‰¿ï¼šç»§æ‰¿æ˜¯ä»å·²æœ‰ç±»å¾—åˆ°ç»§æ‰¿ä¿¡æ¯åˆ›å»ºæ–°ç±»çš„è¿‡ç¨‹ã€‚æä¾›ç»§æ‰¿ä¿¡æ¯çš„ç±»è¢«ç§°ä¸ºçˆ¶ç±»ï¼ˆè¶…ç±»ã€åŸºç±»ï¼‰ï¼›å¾—åˆ°ç»§æ‰¿ä¿¡æ¯çš„ç±»è¢«ç§°ä¸ºå­ç±»ï¼ˆæ´¾ç”Ÿç±»ï¼‰ã€‚ ç»§æ‰¿è®©å˜åŒ–ä¸­çš„è½¯ä»¶ç³»ç»Ÿæœ‰äº†ä¸€å®šçš„å»¶ç»­æ€§ï¼ŒåŒæ—¶ç»§æ‰¿ä¹Ÿæ˜¯å°è£…ç¨‹åºä¸­å¯å˜å› ç´ çš„é‡è¦æ‰‹æ®µã€‚ å°è£…ï¼šå°è£…æ˜¯æŠŠæ•°æ®å’Œæ“ä½œæ•°æ®çš„æ–¹æ³•ç»‘å®šèµ·æ¥ï¼Œå¯¹æ•°æ®çš„è®¿é—®åªèƒ½é€šè¿‡å·²å®šä¹‰çš„æ¥å£ã€‚æˆ‘ä»¬åœ¨ç±»ä¸­ç¼–å†™çš„æ–¹æ³•å°±æ˜¯å¯¹å®ç°ç»†èŠ‚çš„ä¸€ç§å°è£…ï¼›æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç±»å°±æ˜¯å¯¹æ•°æ®å’Œæ•°æ®æ“ä½œçš„å°è£…ã€‚å¯ä»¥è¯´ï¼Œå°è£…å°±æ˜¯éšè—ä¸€åˆ‡å¯éšè—çš„ä¸œè¥¿ï¼Œåªå‘å¤–ç•Œæä¾›æœ€ç®€å•çš„ç¼–ç¨‹æ¥å£ã€‚ å¤šæ€æ€§ ï¼šå¤šæ€æ€§æ˜¯æŒ‡å…è®¸ä¸åŒå­ç±»å‹çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯ä½œå‡ºä¸åŒçš„å“åº”ã€‚ç®€å•çš„è¯´å°±æ˜¯ç”¨åŒæ ·çš„å¯¹è±¡å¼•ç”¨è°ƒç”¨åŒæ ·çš„æ–¹æ³•ä½†æ˜¯åšäº†ä¸åŒçš„äº‹æƒ…ã€‚å¤šæ€æ€§åˆ†ä¸ºç¼–è¯‘æ—¶çš„å¤šæ€æ€§å’Œè¿è¡Œæ—¶çš„å¤šæ€æ€§ã€‚æ–¹æ³•é‡è½½ï¼ˆoverloadï¼‰å®ç°çš„æ˜¯ç¼–è¯‘æ—¶çš„å¤šæ€æ€§ï¼ˆä¹Ÿç§°ä¸ºå‰ç»‘å®šï¼‰ï¼Œè€Œæ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰å®ç°çš„æ˜¯è¿è¡Œæ—¶çš„å¤šæ€æ€§ï¼ˆä¹Ÿç§°ä¸ºåç»‘å®šï¼‰ã€‚è¿è¡Œæ—¶çš„å¤šæ€æ˜¯é¢å‘å¯¹è±¡æœ€ç²¾é«“çš„ä¸œè¥¿ï¼Œè¦å®ç°å¤šæ€éœ€è¦åšä¸¤ä»¶äº‹ï¼š æ–¹æ³•é‡å†™ï¼ˆå­ç±»ç»§æ‰¿çˆ¶ç±»å¹¶é‡å†™çˆ¶ç±»ä¸­å·²æœ‰çš„æˆ–æŠ½è±¡çš„æ–¹æ³•ï¼‰ï¼› å¯¹è±¡é€ å‹ï¼ˆç”¨çˆ¶ç±»å‹å¼•ç”¨å¼•ç”¨å­ç±»å‹å¯¹è±¡ï¼Œè¿™æ ·åŒæ ·çš„å¼•ç”¨è°ƒç”¨åŒæ ·çš„æ–¹æ³•å°±ä¼šæ ¹æ®å­ç±»å¯¹è±¡çš„ä¸åŒè€Œè¡¨ç°å‡ºä¸åŒçš„è¡Œä¸ºï¼‰ã€‚ æŠ½è±¡ï¼šæŠ½è±¡æ˜¯å°†ä¸€ç±»å¯¹è±¡çš„å…±åŒç‰¹å¾æ€»ç»“å‡ºæ¥æ„é€ ç±»çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ•°æ®æŠ½è±¡å’Œè¡Œä¸ºæŠ½è±¡ä¸¤æ–¹é¢ã€‚æŠ½è±¡åªå…³æ³¨å¯¹è±¡æœ‰å“ªäº›å±æ€§å’Œè¡Œä¸ºï¼Œå¹¶ä¸å…³æ³¨è¿™äº›è¡Œä¸ºçš„ç»†èŠ‚æ˜¯ä»€ä¹ˆã€‚ æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€? (When we call objective c is runtime language what does it mean?) ä¸»è¦æ˜¯å°†æ•°æ®ç±»å‹çš„ç¡®å®šç”±ç¼–è¯‘æ—¶,æ¨è¿Ÿåˆ°äº†è¿è¡Œæ—¶ã€‚è¿™ä¸ªé—®é¢˜å…¶å®æµ…æ¶‰åŠåˆ°ä¸¤ä¸ªæ¦‚å¿µ,è¿è¡Œæ—¶å’Œå¤šæ€ã€‚ ç®€å•æ¥è¯´, è¿è¡Œæ—¶æœºåˆ¶ä½¿æˆ‘ä»¬ç›´åˆ°è¿è¡Œæ—¶æ‰å»å†³å®šä¸€ä¸ªå¯¹è±¡çš„ç±»åˆ«,ä»¥åŠè°ƒç”¨è¯¥ç±»åˆ«å¯¹è±¡æŒ‡å®šæ–¹æ³•ã€‚ å¤šæ€:ä¸åŒå¯¹è±¡ä»¥è‡ªå·±çš„æ–¹å¼å“åº”ç›¸åŒçš„æ¶ˆæ¯çš„èƒ½åŠ›å«åšå¤šæ€ã€‚ æ„æ€å°±æ˜¯å‡è®¾ç”Ÿç‰©ç±»(life)éƒ½æ‹¥æœ‰ä¸€ä¸ªç›¸åŒçš„æ–¹æ³•-eat;é‚£äººç±»å±äºç”Ÿç‰©,çŒªä¹Ÿå±äºç”Ÿç‰©,éƒ½ç»§æ‰¿äº†lifeå,å®ç°å„è‡ªçš„eat,ä½†æ˜¯è°ƒç”¨æ˜¯æˆ‘ä»¬åªéœ€è°ƒç”¨å„è‡ªçš„eatæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯ä¸åŒçš„å¯¹è±¡ä»¥è‡ªå·±çš„æ–¹å¼å“åº”äº†ç›¸åŒçš„æ¶ˆ æ¯(å“åº”äº†eatè¿™ä¸ªé€‰æ‹©å™¨)ã€‚å› æ­¤ä¹Ÿå¯ä»¥è¯´,è¿è¡Œæ—¶æœºåˆ¶æ˜¯å¤šæ€çš„åŸºç¡€. readwrite, readonly, assign, retain, copy, nonatomicå±æ€§çš„ä½œç”¨? readwrite æ˜¯å¯è¯»å¯å†™ç‰¹æ€§;éœ€è¦ç”Ÿæˆgetteræ–¹æ³•å’Œsetteræ–¹æ³•; readonly æ˜¯åªè¯»ç‰¹æ€§ åªä¼šç”Ÿæˆgetteræ–¹æ³• ä¸ä¼šç”Ÿæˆsetteræ–¹æ³• ,ä¸å¸Œæœ›å±æ€§åœ¨ç±»å¤–æ”¹å˜; assign æ˜¯èµ‹å€¼ç‰¹æ€§,setteræ–¹æ³•å°†ä¼ å…¥å‚æ•°èµ‹å€¼ç»™å®ä¾‹å˜é‡;ä»…è®¾ç½®å˜é‡æ—¶; assignç”¨äºç®€å•æ•°æ®ç±»å‹,å¦‚NSInteger,double,bool; retain è¡¨ç¤ºæŒæœ‰ç‰¹æ€§,setteræ–¹æ³•å°†ä¼ å…¥å‚æ•°å…ˆä¿ç•™,å†èµ‹å€¼,ä¼ å…¥å‚æ•°çš„å¼•ç”¨è®¡æ•°retaincountä¼š+1; copy è¡¨ç¤ºèµ‹å€¼ç‰¹æ€§,setteræ–¹æ³•å°†ä¼ å…¥å¯¹è±¡å¤åˆ¶ä¸€ä»½;éœ€è¦å®Œå…¨ä¸€ä»½æ–°çš„å˜é‡æ—¶; nonatomic éåŸå­æ“ä½œ,å†³å®šç¼–è¯‘å™¨ç”Ÿæˆçš„setter getteræ˜¯å¦æ˜¯åŸå­æ“ä½œ; atomic è¡¨ç¤ºå¤šçº¿ç¨‹å®‰å…¨,ä¸€èˆ¬ä½¿ç”¨ nonatomicã€‚ ç®€è¿°NotificationCenterã€KVCã€KVOã€Delegate?å¹¶è¯´æ˜å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«?(é‡ç‚¹) KVOï¼ˆKey-Value- Observingï¼‰ï¼šä¸€å¯¹å¤š, è§‚å¯Ÿè€…æ¨¡å¼,é”®å€¼è§‚å¯Ÿæœºåˆ¶ï¼Œå®ƒæä¾›äº†è§‚å¯ŸæŸä¸€å±æ€§å˜åŒ–çš„æ–¹æ³•ï¼Œæå¤§ç®€åŒ–äº†ä»£ç ã€‚ KVC (Key-Value-Coding)ï¼šæ˜¯é”®å€¼ç¼–ç , ä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨setValueçš„æ—¶å€™ï¼Œ æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç›¸åº”keyçš„setæ–¹æ³•ï¼Œå­˜åœ¨å°±è°ƒç”¨setæ–¹æ³•ã€‚ setæ–¹æ³•ä¸å­˜åœ¨ï¼Œå°±æŸ¥æ‰¾_keyçš„æˆå‘˜å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨å°±ç›´æ¥èµ‹å€¼ã€‚ å¦‚æœ_keyæ²¡æ‰¾åˆ°ï¼Œå°±æŸ¥æ‰¾ç›¸åŒåç§°çš„keyï¼Œå­˜åœ¨å°±èµ‹å€¼ã€‚ å¦‚æœæ²¡æœ‰å°±è°ƒç”¨valueForUndefinedkeyå’ŒsetValueï¼šforUndefinedKeyã€‚ Delegate: é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯ç›´æ¥çš„ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ ä»£ç†çš„ç›®çš„æ˜¯æ”¹å˜æˆ–ä¼ é€’æ§åˆ¶é“¾ã€‚å…è®¸ä¸€ä¸ªç±»åœ¨æŸäº›ç‰¹å®šæ—¶åˆ»é€šçŸ¥åˆ°å…¶ä»–ç±»ï¼Œè€Œä¸éœ€è¦è·å–åˆ°é‚£äº›ç±»çš„æŒ‡é’ˆã€‚ å¯ä»¥å‡å°‘æ¡†æ¶å¤æ‚åº¦ã€‚æ¶ˆæ¯çš„å‘é€è€…(sender)å‘ŠçŸ¥æ¥æ”¶è€…(receiver)æŸä¸ªäº‹ä»¶å°†è¦å‘ç”Ÿï¼ŒdelegateåŒæ„ç„¶ç„¶åå‘é€è€…å“åº”äº‹ä»¶ï¼Œdelegateæœºåˆ¶ä½¿å¾—æ¥æ”¶è€…å¯ä»¥æ”¹å˜å‘é€è€…çš„è¡Œä¸ºã€‚ Notification: è§‚å¯Ÿè€…æ¨¡å¼, é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯é—´æ¥çš„å¤šå¯¹å¤šå…³ç³»ã€‚ æ¶ˆæ¯çš„å‘é€è€…å‘ŠçŸ¥æ¥æ”¶è€…äº‹ä»¶å·²ç»å‘ç”Ÿæˆ–è€…å°†è¦å‘é€ï¼Œä»…æ­¤è€Œå·²ï¼Œæ¥æ”¶è€…å¹¶ä¸èƒ½åè¿‡æ¥å½±å“å‘é€è€…çš„è¡Œä¸ºã€‚ åŒºåˆ« æ•ˆç‡è‚¯å®šæ˜¯delegateæ¯”NSNotificationé«˜ã€‚ delegateæ–¹æ³•æ¯”notificationæ›´åŠ ç›´æ¥ï¼Œéœ€è¦å…³æ³¨è¿”å›å€¼ï¼Œæ‰€ä»¥delegateæ–¹æ³•å¾€å¾€åŒ…å«shouldè¿™ä¸ªå¾ˆä¼ ç¥çš„è¯ã€‚ç›¸åçš„ï¼Œnotificationæœ€å¤§çš„ç‰¹è‰²å°±æ˜¯ä¸å…³å¿ƒç»“æœã€‚æ‰€ä»¥notificationå¾€å¾€ç”¨didè¿™ä¸ªè¯æ±‡ã€‚ ä¸¤ä¸ªæ¨¡å—ä¹‹é—´è”ç³»ä¸æ˜¯å¾ˆç´§å¯†ï¼Œå°±ç”¨notificationä¼ å€¼ï¼Œä¾‹å¦‚å¤šçº¿ç¨‹ä¹‹é—´ä¼ å€¼ç”¨notificaitonã€‚ delegateåªæ˜¯ä¸€ç§è¾ƒä¸ºç®€å•çš„å›è°ƒï¼Œä¸”ä¸»è¦ç”¨åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä¾‹å¦‚åº•å±‚åŠŸèƒ½å®Œæˆäº†ï¼Œéœ€è¦æŠŠä¸€äº›å€¼ä¼ åˆ°ä¸Šå±‚å»ï¼Œå°±äº‹å…ˆæŠŠä¸Šå±‚çš„å‡½æ•°é€šè¿‡delegateä¼ åˆ°åº•å±‚ï¼Œç„¶ååœ¨åº•å±‚callè¿™ä¸ªdelegateï¼Œå®ƒä»¬éƒ½åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå®Œæˆä¸€ä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚è¯´ NavgationController ä» B ç•Œé¢åˆ°A ç‚¹è¿”å›æŒ‰é’® (è°ƒç”¨popViewControlleræ–¹æ³•) å¯ä»¥ç”¨delegateæ¯”è¾ƒå¥½ã€‚ æ‡’åŠ è½½(What is lazy loading ?) å°±æ˜¯æ‡’åŠ è½½,åªåœ¨ç”¨åˆ°çš„æ—¶å€™æ‰å»åˆå§‹åŒ–ã€‚ä¹Ÿå¯ä»¥ç†è§£æˆå»¶æ—¶åŠ è½½ã€‚æˆ‘è§‰å¾—æœ€å¥½ä¹Ÿæœ€ç®€å•çš„ä¸€ä¸ªåˆ—å­å°±æ˜¯tableViewä¸­å›¾ç‰‡çš„åŠ è½½æ˜¾ç¤ºäº†, ä¸€ä¸ªå»¶æ—¶åŠ è½½, é¿å…å†…å­˜è¿‡é«˜,ä¸€ä¸ªå¼‚æ­¥åŠ è½½,é¿å…çº¿ç¨‹å µå¡æé«˜ç”¨æˆ·ä½“éªŒ OCæœ‰å¤šç»§æ‰¿å—?æ²¡æœ‰çš„è¯å¯ä»¥ç”¨ä»€ä¹ˆæ–¹æ³•æ›¿ä»£? å¤šç»§æ‰¿å³ä¸€ä¸ªå­ç±»å¯ä»¥æœ‰å¤šä¸ªçˆ¶ç±»,å®ƒç»§æ‰¿äº†å¤šä¸ªçˆ¶ç±»çš„ç‰¹æ€§ã€‚ Object-cçš„ç±»æ²¡æœ‰å¤šç»§æ‰¿,åªæ”¯æŒå•ç»§æ‰¿,å¦‚æœè¦å®ç°å¤šç»§æ‰¿çš„è¯,å¯ä»¥é€šè¿‡ç±»åˆ«å’Œåè®®çš„æ–¹å¼æ¥å®ç°ã€‚ protocolï¼ˆåè®®ï¼‰å¯ä»¥å®ç°å¤šä¸ªæ¥å£,é€šè¿‡å®ç°å¤šä¸ªæ¥å£å¯ä»¥å®Œæˆå¤šç»§æ‰¿; Categoryï¼ˆç±»åˆ«ï¼‰ä¸€èˆ¬ä½¿ç”¨åˆ†ç±»,ç”¨Categoryå»é‡å†™ç±»çš„æ–¹æ³•,ä»…å¯¹æœ¬Categoryæœ‰æ•ˆ,ä¸ä¼šå½±å“åˆ°å…¶ä»–ç±»ä¸åŸæœ‰ç±»çš„å…³ç³»ã€‚ åˆ†åˆ«æè¿°ç±»åˆ«(categories)å’Œå»¶å±•(extensions)æ˜¯ä»€ä¹ˆ?ä»¥åŠä¸¤è€…çš„åŒºåˆ«?ç»§æ‰¿å’Œç±»åˆ«åœ¨å®ç°ä¸­æœ‰ä½•åŒºåˆ«?ä¸ºä»€ä¹ˆCategoryåªèƒ½ä¸ºå¯¹è±¡æ·»åŠ æ–¹æ³•,å´ä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡? ç±»åˆ«: åœ¨æ²¡æœ‰åŸç±».mæ–‡ä»¶çš„åŸºç¡€ä¸Š,ç»™è¯¥ç±»æ·»åŠ æ–¹æ³•; å»¶å±•:ä¸€ç§ç‰¹æ®Šå½¢å¼çš„ç±»åˆ«,ä¸»è¦åœ¨ä¸€ä¸ªç±»çš„.mæ–‡ä»¶é‡Œå£°æ˜å’Œå®ç°å»¶å±•çš„ä½œç”¨,å°±æ˜¯ç»™æŸç±»æ·»åŠ ç§æœ‰æ–¹æ³•æˆ–æ˜¯ç§æœ‰å˜é‡ã€‚ ä¸¤ä¸ªçš„åŒºåˆ«: å»¶å±•å¯ä»¥æ·»åŠ å±æ€§å¹¶ä¸”å®ƒæ·»åŠ çš„æ–¹æ³•æ˜¯å¿…é¡»è¦å®ç°çš„ã€‚å»¶å±•å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªç§æœ‰çš„ç±»ç›®ã€‚ ç±»åˆ«å¯ä»¥åœ¨ä¸çŸ¥é“,ä¸æ”¹å˜åŸæ¥ä»£ç çš„æƒ…å†µä¸‹å¾€é‡Œé¢æ·»åŠ æ–°çš„æ–¹æ³•,åªèƒ½æ·»åŠ ,ä¸èƒ½åˆ é™¤ä¿®æ”¹ã€‚ å¹¶ä¸”å¦‚æœç±»åˆ«å’ŒåŸæ¥ç±»ä¸­çš„æ–¹æ³•äº§ç”Ÿåç§°å†²çª,åˆ™ç±»åˆ«å°†è¦†ç›–åŸæ¥çš„æ–¹æ³•,å› ä¸ºç±»åˆ«å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ ç»§æ‰¿å¯ä»¥å¢åŠ ï¼Œä¿®æ”¹åˆ é™¤æ–¹æ³•ï¼Œæ·»åŠ å±æ€§ã€‚ Categoryåªèƒ½ä¸ºå¯¹è±¡æ·»åŠ æ–¹æ³•,å´ä¸èƒ½æ·»åŠ æˆå‘˜å˜é‡çš„åŸå› :å¦‚æœå¯ä»¥æ·»åŠ æˆå‘˜å˜é‡,æ·»åŠ çš„æˆå‘˜å˜é‡æ²¡æœ‰åŠæ³•åˆå§‹åŒ– Objective-Cæœ‰ç§æœ‰æ–¹æ³•ä¹ˆ?ç§æœ‰å˜é‡å‘¢?å¦‚å¤šæ²¡æœ‰çš„è¯,æœ‰æ²¡æœ‰ä»€ä¹ˆä»£æ›¿çš„æ–¹æ³•? objective-cç±»é‡Œé¢çš„æ–¹æ³•åªæœ‰ä¸¤ç§,é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•.ä½†æ˜¯å¯ä»¥é€šè¿‡æŠŠæ–¹æ³•çš„å£°æ˜å’Œå®šä¹‰éƒ½æ”¾åœ¨.mæ–‡ä»¶ä¸­æ¥å®ç°ä¸€ä¸ªè¡¨é¢ä¸Šçš„ç§æœ‰æ–¹æ³•ã€‚æœ‰ç§æœ‰å˜é‡,å¯ä»¥é€šè¿‡@privateæ¥ä¿®é¥°,æˆ–è€…æŠŠå£°æ˜æ”¾åˆ°.mæ–‡ä»¶ä¸­ã€‚åœ¨Objectiveâ€Cä¸­,æ‰€æœ‰å®ä¾‹å˜é‡é»˜è®¤éƒ½æ˜¯ç§æœ‰çš„, æ‰€æœ‰å®ä¾‹æ–¹æ³•é»˜è®¤éƒ½æ˜¯å…¬æœ‰çš„ #includeä¸#importçš„åŒºåˆ«? #importä¸ @classçš„åŒºåˆ«? #importæŒ‡ä»¤æ˜¯Object-Cé’ˆå¯¹#includeçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œ#importç¡®ä¿å¼•ç”¨çš„æ–‡ä»¶åªä¼šè¢«å¼•ç”¨ä¸€æ¬¡ï¼Œè¿™æ ·ä½ å°±ä¸ä¼šé™·å…¥é€’å½’åŒ…å«çš„é—®é¢˜ä¸­ã€‚ # imporä¸@classäºŒè€…çš„åŒºåˆ«åœ¨äºï¼š #importä¼šé“¾å…¥è¯¥å¤´æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ä¾‹å˜é‡å’Œæ–¹æ³•ç­‰ï¼›è€Œ@classåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå…¶åé¢å£°æ˜çš„åç§°æ˜¯ç±»çš„åç§°ï¼Œè‡³äºè¿™äº›ç±»æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Œæš‚æ—¶ä¸ç”¨è€ƒè™‘ã€‚ åœ¨å¤´æ–‡ä»¶ä¸­ä¸€èˆ¬ä½¿ç”¨@classæ¥å£°æ˜è¿™ä¸ªåç§°æ˜¯ç±»çš„åç§°,ä¸éœ€è¦çŸ¥é“å…¶å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•. è€Œåœ¨å®ç°ç±»é‡Œé¢ï¼Œå› ä¸ºä¼šç”¨åˆ°è¿™ä¸ªå¼•ç”¨ç±»çš„å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨#importæ¥åŒ…å«è¿™ä¸ªè¢«å¼•ç”¨ç±»çš„å¤´æ–‡ä»¶ã€‚ åœ¨ç¼–è¯‘æ•ˆç‡æ–¹é¢ï¼Œå¦‚æœä½ æœ‰100ä¸ªå¤´æ–‡ä»¶éƒ½#importäº†åŒä¸€ä¸ªå¤´æ–‡ä»¶ï¼Œæˆ–è€…è¿™äº›æ–‡ä»¶æ˜¯ä¾æ¬¡å¼•ç”¨çš„ï¼Œå¦‚Aâ€“&gt;B, Bâ€“&gt;C, Câ€“&gt;Dè¿™æ ·çš„å¼•ç”¨å…³ç³»ã€‚å½“æœ€å¼€å§‹çš„é‚£ä¸ªå¤´æ–‡ä»¶æœ‰å˜åŒ–çš„è¯ï¼Œåé¢æ‰€æœ‰å¼•ç”¨å®ƒçš„ç±»éƒ½éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œå¦‚æœä½ çš„ç±»æœ‰å¾ˆå¤šçš„è¯ï¼Œè¿™å°†è€—è´¹å¤§é‡çš„æ—¶é—´ã€‚è€Œæ˜¯ç”¨@classåˆ™ä¸ä¼šã€‚ å¦‚æœæœ‰å¾ªç¯ä¾èµ–å…³ç³»ï¼Œå¦‚:Aâ€“&gt;B, Bâ€“&gt;Aè¿™æ ·çš„ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå¦‚æœä½¿ç”¨#importæ¥ç›¸äº’åŒ…å«ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œå¦‚æœä½¿ç”¨@classåœ¨ä¸¤ä¸ªç±»çš„å¤´æ–‡ä»¶ä¸­ç›¸äº’å£°æ˜ï¼Œåˆ™ä¸ä¼šæœ‰ç¼–è¯‘é”™è¯¯å‡ºç°ã€‚ æµ…å¤åˆ¶(æ‹·è´)å’Œæ·±å¤åˆ¶çš„åŒºåˆ«? (Difference between shallow copy and deep copy?) æµ…å¤åˆ¶(copy)ï¼šåªå¤åˆ¶æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆï¼Œè€Œä¸å¤åˆ¶å¼•ç”¨å¯¹è±¡æœ¬èº«ã€‚ æ·±å¤åˆ¶(mutableCopy)ï¼šå¤åˆ¶å¼•ç”¨å¯¹è±¡æœ¬èº«ã€‚æ·±å¤åˆ¶å°±å¥½ç†è§£äº†,å†…å­˜ä¸­å­˜åœ¨äº†ä¸¤ä»½ç‹¬ç«‹å¯¹è±¡æœ¬èº«, å½“ä¿®æ”¹Aæ—¶,A_copyä¸å˜ã€‚ ç±»å˜é‡çš„@protected,@private,@public,@packageå£°æ˜å„æœ‰ä»€ä¹ˆå«ä¹‰?å˜é‡çš„ä½œç”¨åŸŸä¸åŒã€‚ @protected è¯¥ç±»å’Œå­ç±»ä¸­è®¿é—®ï¼Œæ˜¯é»˜è®¤çš„; @private åªèƒ½åœ¨æœ¬ç±»ä¸­è®¿é—®; @public ä»»ä½•åœ°æ–¹éƒ½èƒ½è®¿é—®; @package æœ¬åŒ…å†…ä½¿ç”¨ï¼Œè·¨åŒ…ä¸å¯ä»¥ Objective-Cä¸Cã€C+++ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«ï¼Ÿ Objective-Cå’ŒC++éƒ½æ˜¯Cçš„é¢å‘å¯¹è±¡çš„è¶…é›†ã€‚ Objectä¸C++çš„åŒºåˆ«ä¸»è¦ç‚¹ï¼šObjective-Cæ˜¯å®Œå…¨åŠ¨æ€çš„ï¼Œæ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€ç±»å‹å†³è®®(dynamic typing)ï¼ŒåŠ¨æ€ç»‘å®š(dynamic binding)ä»¥åŠåŠ¨æ€è£…è½½(dynamic loading)ï¼›è€ŒC++æ˜¯éƒ¨åˆ†åŠ¨æ€çš„ï¼Œç¼–è¯‘æ—¶é™æ€ç»‘å®šï¼Œé€šè¿‡åµŒå…¥ç±»(å¤šé‡ç»§æ‰¿)å’Œè™šå‡½æ•°(è™šè¡¨)æ¥æ¨¡æ‹Ÿå®ç°ã€‚ Objective-C åœ¨è¯­è¨€å±‚æ¬¡ä¸Šæ”¯æŒåŠ¨æ€æ¶ˆæ¯è½¬å‘ï¼Œå…¶æ¶ˆæ¯å‘é€è¯­æ³•ä¸º [object function]ï¼› è€Œä¸”C++ ä¸º object-&gt;function()ã€‚ ä¸¤è€…çš„è¯­ä¹‰ä¹Ÿä¸åŒï¼Œåœ¨ Objective-C é‡Œæ˜¯è¯´å‘é€æ¶ˆæ¯åˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œè‡³äºè¿™ä¸ªå¯¹è±¡èƒ½ä¸èƒ½å“åº”æ¶ˆæ¯ä»¥åŠæ˜¯å“åº”è¿˜æ˜¯è½¬å‘æ¶ˆæ¯éƒ½ä¸ä¼š crashï¼› è€Œåœ¨ C++ é‡Œæ˜¯è¯´å¯¹è±¡è¿›è¡Œäº†æŸä¸ªæ“ä½œï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰è¿™ä¸ªæ“ä½œçš„è¯ï¼Œè¦ä¹ˆç¼–è¯‘ä¼šæŠ¥é”™(é™æ€ç»‘å®š)ï¼Œè¦ä¹ˆç¨‹åºä¼š crash æ‰çš„(åŠ¨æ€ç»‘å®š)ã€‚ ç›®æ ‡-åŠ¨ä½œæœºåˆ¶ ç›®æ ‡æ˜¯åŠ¨ä½œæ¶ˆæ¯çš„æ¥æ”¶è€…ã€‚ä¸€ä¸ªæ§ä»¶ï¼Œæˆ–è€…æ›´ä¸ºå¸¸è§çš„æ˜¯å®ƒçš„å•å…ƒï¼Œä»¥æ’åº§å˜é‡çš„å½¢å¼ä¿æœ‰å…¶åŠ¨ä½œæ¶ˆæ¯çš„ç›®æ ‡ã€‚ åŠ¨ä½œæ˜¯æ§ä»¶å‘é€ç»™ç›®æ ‡çš„æ¶ˆæ¯ï¼Œæˆ–è€…ä»ç›®æ ‡çš„è§’åº¦çœ‹ï¼Œå®ƒæ˜¯ç›®æ ‡ä¸ºäº†å“åº”åŠ¨ä½œè€Œå®ç°çš„æ–¹æ³•. ç¨‹åºéœ€è¦æŸäº›æœºåˆ¶æ¥è¿›è¡Œäº‹ä»¶å’ŒæŒ‡ä»¤çš„ç¿»è¯‘ã€‚è¿™ä¸ªæœºåˆ¶å°±æ˜¯ç›®æ ‡-åŠ¨ä½œæœºåˆ¶ã€‚ Objective-Cä¼˜ç‚¹å’Œç¼ºç‚¹ ä¼˜ç‚¹:1.Cateogies 2.Posing 3.åŠ¨æ€è¯†åˆ« 4.æŒ‡æ ‡è®¡ç®— 5.å¼¹æ€§è®¯æ¯ä¼ é€’ 6.ä¸æ˜¯ä¸€ä¸ªè¿‡åº¦å¤æ‚çš„Cè¡ç”Ÿè¯­è¨€ 7.Objective-Cä¸C++å¯æ··åˆç¼–ç¨‹ ç¼ºç‚¹:1.ä¸æ”¯æŒå‘½åç©ºé–“ 2.ä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ 3.ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ 4.ä½¿ç”¨åŠ¨æ€è¿è¡Œæ—¶ç±»å‹,æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯å‡½æ•°è°ƒç”¨,æ‰€ä»¥å¾ˆå¤šç¼–è¯‘æ—¶ä¼˜åŒ–æ–¹æ³•éƒ½ç”¨ä¸åˆ°ã€‚(å¦‚å†…è”å‡½æ•°ç­‰),æ€§èƒ½ä½åŠ£ã€‚ Cè¯­è¨€çš„å‡½æ•°è°ƒç”¨å’Œocçš„æ¶ˆæ¯æœºåˆ¶æœ‰ä»€ä¹ˆåŒºåˆ«? å¯¹äºCè¯­è¨€ï¼Œå‡½æ•°çš„è°ƒç”¨åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚ç¼–è¯‘å®Œæˆä¹‹åç›´æ¥é¡ºåºæ‰§è¡Œã€‚ OCçš„å‡½æ•°è°ƒç”¨æˆä¸ºæ¶ˆæ¯å‘é€ã€‚å±äºåŠ¨æ€è°ƒç”¨è¿‡ç¨‹ã€‚åœ¨ç¼–è¯‘çš„æ—¶å€™å¹¶ä¸èƒ½å†³å®šçœŸæ­£è°ƒç”¨å“ªä¸ªå‡½æ•°ï¼ˆäº‹å®è¯æ˜ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ŒOCå¯ä»¥è°ƒç”¨ä»»ä½•å‡½æ•°ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°å¹¶æœªå®ç°ï¼Œåªè¦ç”³æ˜è¿‡å°±ä¸ä¼šæŠ¥é”™ã€‚è€ŒCè¯­è¨€åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠ¥é”™ï¼‰ã€‚åªæœ‰åœ¨çœŸæ­£è¿è¡Œçš„æ—¶å€™æ‰ä¼šæ ¹æ®å‡½æ•°çš„åç§°æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°æ¥è°ƒç”¨ã€‚ ä»€ä¹ˆæ˜¯è°“è¯è°“è¯å°±æ˜¯é€šè¿‡NSPredicateç»™å®šçš„é€»è¾‘æ¡ä»¶ä½œä¸ºçº¦æŸæ¡ä»¶ï¼Œå®Œæˆå¯¹æ•°æ®çš„ç­›é€‰ã€‚ å®šä¹‰è°“è¯å¯¹è±¡ï¼Œè°“è¯å¯¹è±¡ä¸­åŒ…å«äº†è¿‡æ»¤æ¡ä»¶ NSPredicate *predicate = [NSPredicate predicateWithFormat:@"age40"]; array = [persons filteredArrayUsingPredicate:predicate]; åŒ…å«è¯­å¥çš„ä½¿ç”¨ predicate = [NSPredicate predicateWithFormat:@"[self.name](https://link.jianshu.com?t=http://self.name) IN {'1','2','4'} || self.age IN{30,40}"]; æŒ‡å®šå­—ç¬¦å¼€å¤´å’ŒæŒ‡å®šå­—ç¬¦ç»“å°¾ï¼Œæ˜¯å¦åŒ…å«æŒ‡å®šå­—ç¬¦ nameä»¥aå¼€å¤´çš„ predicate = [NSPredicate predicateWithFormat:@"name BEGINSWITH 'a'"]; nameä»¥baç»“å°¾çš„ predicate = [NSPredicate predicateWithFormat:@"name ENDSWITH 'ba'"]; nameä¸­åŒ…å«å­—ç¬¦açš„ predicate = [NSPredicate predicateWithFormat:@"name CONTAINS 'a'"]; likeè¿›è¡ŒåŒ¹é…å¤šä¸ªå­—ç¬¦ nameä¸­åªè¦æœ‰så­—ç¬¦å°±æ»¡è¶³æ¡ä»¶ predicate = [NSPredicate predicateWithFormat:@"name like '*s*'"]; ?ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œä¸‹é¢çš„æŸ¥è¯¢æ¡ä»¶æ˜¯ï¼šnameä¸­ç¬¬äºŒä¸ªå­—ç¬¦æ˜¯sçš„ predicate = [NSPredicate predicateWithFormat:@"name like '?s'"]; Cä¸OCæ··ç”¨å¤„ç†.må¯ä»¥è¯†åˆ«cå’Œocï¼Œ.mmå¯ä»¥è¯†åˆ«c c++ oc ä½†æ˜¯cppåªèƒ½ç”¨c/c++ atomicå’Œnonatomicçš„åŒºåˆ« atomicæä¾›å¤šçº¿ç¨‹å®‰å…¨ï¼Œé˜²æ­¢è¯»å†™æœªå®Œæˆçš„æ—¶å€™è¢«å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¯»å†™ï¼Œé€ æˆæ•°æ®é”™è¯¯ã€‚ nonatomicåœ¨è‡ªå·±ç®¡ç†å†…å­˜çš„ç¯å¢ƒä¸­ï¼Œè§£æçš„è®¿é—®å™¨ä¿ç•™å¹¶è‡ªåŠ¨é‡Šæ”¾è¿”å›å€¼ï¼Œè‹¥æŒ‡å®šäº†nonatomicï¼Œé‚£ä¹ˆè®¿é—®å™¨åªæ˜¯ç®€å•çš„è¿”å›è¿™ä¸ªå€¼ã€‚ å¸¸è§çš„ocæ•°æ®ç±»å‹å“ªäº›ï¼Œå’Œcçš„åŸºæœ¬ç±»å‹æœ‰å•¥åŒºåˆ« å¸¸è§çš„ï¼šNSInteger CGFloat NSString NSNumber NSArray NSDate NSIntegeræ ¹æ®32æˆ–è€…64ä½ç³»ç»Ÿå†³å®šæœ¬èº«æ˜¯intè¿˜æ˜¯long CGFloatæ ¹æ®32æˆ–è€…64ä½ç³»ç»Ÿå†³å®šæœ¬èº«æ˜¯floatè¿˜æ˜¯double NSString NSNumber NSArray NSDateéƒ½æ˜¯æŒ‡é’ˆç±»å‹çš„å¯¹è±¡ï¼Œåœ¨å †ä¸­åˆ†é…å†…å­˜ï¼Œcè¯­è¨€ä¸­çš„char int ç­‰éƒ½æ˜¯åœ¨æ ˆä¸­åˆ†é…ç©ºé—´ idå’Œnilä»£è¡¨ä»€ä¹ˆ idç±»å‹çš„æŒ‡é’ˆå¯ä»¥æŒ‡å‘ä»»ä½•OCå¯¹è±¡ nilä»£è¡¨ç©ºå€¼ï¼ˆç©ºæŒ‡é’ˆçš„å€¼ï¼Œ0ï¼‰ nilå’ŒNULLçš„åŒºåˆ«ï¼Ÿ ä»ocçš„å®˜æ–¹è¯­æ³•ä¸Šçœ‹ï¼Œnilè¡¨ç¤ºå¯¹è±¡çš„æŒ‡é’ˆ å³å¯¹è±¡çš„å¼•ç”¨ä¸ºç©º nullè¡¨ç¤ºæŒ‡å‘åŸºç¡€æ•°æ®ç±»å‹å˜é‡ å³cè¯­è¨€å˜é‡çš„æŒ‡é’ˆä¸ºç©º åœ¨éarcä¸­ ä¸¤ä¸ªç©ºå¯ä»¥äº’æ¢ï¼Œä½†æ˜¯åœ¨arcä¸­ æ™®é€šæŒ‡é’ˆå’Œå¯¹è±¡å¼•ç”¨è¢«ä¸¥æ ¼é™åˆ¶ï¼Œä¸èƒ½äº’æ¢ nilã€Nilã€NULLå’ŒNSNullåŒºåˆ« nilå’ŒCè¯­è¨€çš„NULLç›¸åŒï¼Œåœ¨objc/objc.hä¸­å®šä¹‰ã€‚nilè¡¨ç¤ºObjective-Cå¯¹è±¡çš„å€¼ä¸ºç©ºã€‚åœ¨Cè¯­è¨€ä¸­ï¼ŒæŒ‡é’ˆçš„ç©ºå€¼ç”¨NULLè¡¨ç¤ºã€‚åœ¨Objective-Cä¸­ï¼Œnilå¯¹è±¡è°ƒç”¨ä»»ä½•æ–¹æ³•è¡¨ç¤ºä»€ä¹ˆä¹Ÿä¸æ‰§è¡Œï¼Œä¹Ÿä¸ä¼šå´©æºƒã€‚ Nil:é‚£ä¹ˆå¯¹äºæˆ‘ä»¬Objective-Cå¼€å‘æ¥è¯´ï¼ŒNilä¹Ÿå°±ä»£è¡¨((void *)0)ã€‚ä½†æ˜¯å®ƒæ˜¯ç”¨äºä»£è¡¨ç©ºç±»çš„. æ¯”å¦‚ï¼šClass myClass = Nil; NULL: åœ¨Cè¯­è¨€ä¸­ï¼ŒNULLæ˜¯æ— ç±»å‹çš„ï¼Œåªæ˜¯ä¸€ä¸ªå®ï¼Œå®ƒä»£è¡¨ç©º. è¿™å°±æ˜¯åœ¨C/C++ä¸­çš„ç©ºæŒ‡é’ˆã€‚å¯¹äºæˆ‘ä»¬Objective-Cå¼€å‘æ¥è¯´ï¼ŒNULLå°±è¡¨ç¤º((void*)0). NSNull:NSNullæ˜¯ç»§æ‰¿äºNSObjectçš„ç±»å‹ã€‚å®ƒæ˜¯å¾ˆç‰¹æ®Šçš„ç±»ï¼Œå®ƒè¡¨ç¤ºæ˜¯ç©ºï¼Œä»€ä¹ˆä¹Ÿä¸å­˜å‚¨ï¼Œä½†æ˜¯å®ƒå´æ˜¯å¯¹è±¡ï¼Œåªæ˜¯ä¸€ä¸ªå ä½å¯¹è±¡ã€‚ä½¿ç”¨åœºæ™¯å°±ä¸ä¸€æ ·äº†ï¼Œæ¯”å¦‚è¯´æœåŠ¡ç«¯æ¥å£ä¸­è®©æˆ‘ä»¬åœ¨å€¼ä¸ºç©ºæ—¶ï¼Œä¼ ç©ºã€‚NSDictionry *parameters = @{@â€arg1â€ : @â€value1â€,@â€arg2â€ : arg2.isEmpty ? [NSNull null] : arg2}; NULLã€nilã€Nilè¿™ä¸‰è€…å¯¹äºObjective-Cä¸­å€¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯(void *)0ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦åŒºåˆ†å‘¢ï¼Ÿåˆä¸NSNullä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š NULLæ˜¯å®ï¼Œæ˜¯å¯¹äºCè¯­è¨€æŒ‡é’ˆè€Œä½¿ç”¨çš„ï¼Œè¡¨ç¤ºç©ºæŒ‡é’ˆ nilæ˜¯å®ï¼Œæ˜¯å¯¹äºObjective-Cä¸­çš„å¯¹è±¡è€Œä½¿ç”¨çš„ï¼Œè¡¨ç¤ºå¯¹è±¡ä¸ºç©º Nilæ˜¯å®ï¼Œæ˜¯å¯¹äºObjective-Cä¸­çš„ç±»è€Œä½¿ç”¨çš„ï¼Œè¡¨ç¤ºç±»æŒ‡å‘ç©º NSNullæ˜¯ç±»ç±»å‹ï¼Œæ˜¯ç”¨äºè¡¨ç¤ºç©ºçš„å ä½å¯¹è±¡ï¼Œä¸JSæˆ–è€…æœåŠ¡ç«¯çš„nullç±»ä¼¼çš„å«æ„ å‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å‘nilå‘é€æ¶ˆæ¯æ˜¯å®Œå…¨æœ‰æ•ˆçš„â€”â€”åªæ˜¯åœ¨è¿è¡Œæ—¶ä¸ä¼šæœ‰ä»»ä½•ä½œç”¨ã€‚ å¦‚æœä¸€ä¸ªæ–¹æ³•è¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå‘é€ç»™nilçš„æ¶ˆæ¯å°†è¿”å›0(nil) å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸ºæŒ‡é’ˆç±»å‹ï¼Œå…¶æŒ‡é’ˆå¤§å°ä¸ºå°äºæˆ–è€…ç­‰äºsizeof(void*)ï¼Œfloatï¼Œdoubleï¼Œlong double æˆ–è€…long longçš„æ•´å‹æ ‡é‡ï¼Œå‘é€ç»™nilçš„æ¶ˆæ¯å°†è¿”å›0ã€‚ -å¦‚æœæ–¹æ³•è¿”å›å€¼ä¸ºç»“æ„ä½“ï¼Œæ­£å¦‚åœ¨ã€ŠMac OS X ABI å‡½æ•°è°ƒç”¨æŒ‡å—ã€‹ï¼Œå‘é€ç»™nilçš„æ¶ˆæ¯å°†è¿”å›0ã€‚ç»“æ„ä½“ä¸­å„ä¸ªå­—æ®µçš„å€¼å°†éƒ½æ˜¯0ã€‚å…¶ä»–çš„ç»“æ„ä½“æ•°æ®ç±»å‹å°†ä¸æ˜¯ç”¨0å¡«å……çš„ã€‚ å¦‚æœæ–¹æ³•çš„è¿”å›å€¼ä¸æ˜¯ä¸Šè¿°æåˆ°çš„å‡ ç§æƒ…å†µï¼Œé‚£ä¹ˆå‘é€ç»™nilçš„æ¶ˆæ¯çš„è¿”å›å€¼å°†æ˜¯æœªå®šä¹‰çš„ã€‚ self.å’Œself-&gt;çš„åŒºåˆ« self.æ˜¯è°ƒç”¨getæˆ–è€…setæ–¹æ³• selfæ˜¯å½“å‰æœ¬èº«ï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰å¯¹è±¡çš„æŒ‡é’ˆ self-&gt;æ˜¯ç›´æ¥è®¿é—®æˆå‘˜å˜é‡ ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•çš„æœ¬è´¨åŒºåˆ«å’Œè”ç³» ç±»æ–¹æ³• å®ä¾‹æ–¹æ³• å±äºç±»å¯¹è±¡ å±äºå®ä¾‹å¯¹è±¡ åªèƒ½ç±»å¯¹è±¡è°ƒç”¨ å®ä¾‹å¯¹è±¡è°ƒç”¨ selfæ˜¯ç±»å¯¹è±¡ selfæ˜¯å®ä¾‹å¯¹è±¡ ç±»æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–ç±»æ–¹æ³• å®ä¾‹æ–¹æ³•å¯ä»¥è°ƒç”¨å®ä¾‹æ–¹æ³• ç±»æ–¹æ³•ä¸èƒ½è®¿é—®æˆå‘˜å˜é‡ å®ä¾‹æ–¹æ³•å¯ä»¥è®¿é—®æˆå‘˜å˜é‡ ç±»æ–¹æ³•ä¸èƒ½ç›´æ¥è°ƒç”¨å¯¹è±¡æ–¹æ³• å®ä¾‹æ–¹æ³•å¯ä»¥è°ƒç”¨ç±»æ–¹æ³• _block/weakä¿®é¥°ç¬¦åŒºåˆ« _blockåœ¨arcå’Œmrcç¯å¢ƒä¸‹éƒ½èƒ½ç”¨ï¼Œå¯ä»¥ä¿®é¥°å¯¹è±¡ï¼Œä¹Ÿèƒ½ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹ _weakåªèƒ½åœ¨arcç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œåªèƒ½ä¿®é¥°å¯¹è±¡(NSString)ï¼Œä¸èƒ½ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹(int) _blockå¯¹è±¡å¯ä»¥åœ¨blockä¸­é‡æ–°èµ‹å€¼ï¼Œ_weakä¸è¡Œã€‚ å†™ä¸€ä¸ªNSStringç±»çš„å®ç°NSString *str = [[NSString alloc] initWithCString: nullTerminatedCString encoding:encoding]; ä¸ºä»€ä¹ˆæ ‡å‡†å¤´æ–‡ä»¶éƒ½æœ‰ç±»ä¼¼ä»¥ä¸‹çš„ç»“æ„ï¼Ÿ# ifndef __INCvxWorksh # define __INCvxWorksh # ifdef __cplusplus extern "C" { # endif # ifdef __cplusplus } # endif # endif æ˜¾ç„¶ï¼Œå¤´æ–‡ä»¶ä¸­çš„ç¼–è¯‘å® #ifndef __INCvxWorkshã€#define __INCvxWorkshã€#endif çš„ä½œç”¨æ˜¯é˜²æ­¢è¯¥å¤´æ–‡ä»¶è¢«é‡å¤å¼•ç”¨ initå’ŒinitwithobjectåŒºåˆ«ï¼ˆè¯­æ³•ï¼‰ï¼Ÿ åè€…ç»™å±æ€§èµ‹å€¼ @propertyçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setteræ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„ï¼Ÿ@propertyçš„æœ¬è´¨ï¼š @property = ivarï¼ˆå®ä¾‹å˜é‡ï¼‰ + getterï¼ˆå–æ–¹æ³•ï¼‰ + setterï¼ˆå­˜æ–¹æ³•ï¼‰ â€œå±æ€§â€ (property)æœ‰ä¸¤å¤§æ¦‚å¿µï¼šivarï¼ˆå®ä¾‹å˜é‡ï¼‰ã€å­˜å–æ–¹æ³•ï¼ˆaccess method ï¼ getter + setterï¼‰ ivarã€getterã€setterå¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°ç±»ä¸­ï¼š è¿™æ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨åˆæˆçš„ï¼Œé€šè¿‡@synthesizeå…³é”®å­—æŒ‡å®šï¼Œè‹¥ä¸æŒ‡å®šï¼Œé»˜è®¤ä¸º@synthesize propertyName = _propertyName;è‹¥æ‰‹åŠ¨å®ç°äº†getter/setteræ–¹æ³•ï¼Œåˆ™ä¸ä¼šè‡ªåŠ¨åˆæˆã€‚ ç°åœ¨ç¼–è¯‘å™¨å·²ç»é»˜è®¤ä¸ºæˆ‘ä»¬æ·»åŠ @synthesize propertyName = _propertyName;å› æ­¤ä¸å†éœ€è¦æ‰‹åŠ¨æ·»åŠ äº†ï¼Œé™¤éä½ çœŸçš„è¦æ”¹æˆå‘˜å˜é‡åã€‚ ç”Ÿæˆgetteræ–¹æ³•æ—¶ï¼Œä¼šåˆ¤æ–­å½“å‰å±æ€§åæ˜¯å¦æœ‰_ï¼Œæ¯”å¦‚å£°æ˜å±æ€§ä¸º@property (nonatomic, copy) NSString *_name;é‚£ä¹ˆæ‰€ç”Ÿæˆçš„æˆå‘˜å˜é‡åå°±ä¼šå˜æˆ__nameï¼Œå¦‚æœæˆ‘ä»¬è¦æ‰‹åŠ¨ç”Ÿæˆgetteræ–¹æ³•ï¼Œå°±è¦åˆ¤æ–­æ˜¯å¦ä»¥_å¼€å¤´äº†ã€‚ ä¸è¿‡ï¼Œå‘½åéƒ½è¦æœ‰è§„èŒƒï¼Œæ˜¯ä¸å…è®¸å£°æ˜å±æ€§æ˜¯ä½¿ç”¨_å¼€å¤´çš„ï¼Œä¸è§„èŒƒçš„å‘½åï¼Œåœ¨ä½¿ç”¨runtimeæ—¶ï¼Œä¼šå¸¦æ¥å¾ˆå¤šçš„ä¸æ–¹ä¾¿çš„ã€‚ è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼š@property (copy) NSMutableArray *array; æ²¡æœ‰æŒ‡æ˜ä¸ºnonatomicï¼Œå› æ­¤å°±æ˜¯atomicåŸå­æ“ä½œï¼Œä¼šå½±å“æ€§èƒ½ã€‚è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”ï¼Œä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åºï¼Œè¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œé€šè¿‡å£°æ˜nonatomicå¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€ã€‚åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå‡ ä¹éƒ½æ˜¯ä½¿ç”¨nonatomicæ¥å£°æ˜çš„ï¼Œå› ä¸ºä½¿ç”¨atomicå¹¶ä¸èƒ½ä¿è¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ï¼Œå¯¹äºè¦ç»å¯¹ä¿è¯çº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œè¿˜éœ€è¦ä½¿ç”¨æ›´é«˜çº§çš„æ–¹å¼æ¥å¤„ç†ï¼Œæ¯”å¦‚NSSpinLockã€@syncronizedç­‰ å› ä¸ºä½¿ç”¨çš„æ˜¯copyï¼Œæ‰€å¾—åˆ°çš„å®é™…æ˜¯NSArrayç±»å‹ï¼Œå®ƒæ˜¯ä¸å¯å˜çš„ï¼Œè‹¥åœ¨ä½¿ç”¨ä¸­ä½¿ç”¨äº†å¢ã€åˆ ã€æ”¹æ“ä½œï¼Œåˆ™ä¼šcrash @protocolå’Œcategoryä¸­å¦‚ä½•ä½¿ç”¨ @propertyâ€¢ åœ¨protocolä¸­ä½¿ç”¨@propertyåªä¼šç”Ÿæˆsetterå’Œgetteræ–¹æ³•å£°æ˜ï¼Œæˆ‘ä»¬ä½¿ç”¨å±æ€§çš„ç›®çš„æ˜¯å¸Œæœ›éµå®ˆæˆ‘åè®®çš„å¯¹è±¡èƒ½å®ç°è¯¥å±æ€§â€¢ categoryä½¿ç”¨@propertyä¹Ÿæ˜¯åªä¼šç”Ÿæˆsetterå’Œgetteræ–¹æ³•çš„å£°æ˜ï¼Œå¦‚æœæˆ‘ä»¬çœŸçš„éœ€è¦ç»™categoryå¢åŠ å±æ€§çš„å®ç°ï¼Œéœ€è¦å€ŸåŠ©äºè¿è¡Œæ—¶çš„ä¸¤ä¸ªå‡½æ•°ï¼šâ€¢ objc_setAssociatedObjectâ€¢ objc_getAssociatedObject @propertyä¸­æœ‰å“ªäº›å±æ€§å…³é”®å­—ï¼Ÿ1.åŸå­æ€§ ï¼ˆatomicï¼Œnonatomicï¼‰2.è¯»å†™ï¼ˆreadwrite, readonlyï¼‰3.å†…å­˜ç®¡ç†ï¼ˆassign, strong, weak, unsafe_unretained,copyï¼‰4.getterã€setter isaæŒ‡é’ˆé—®é¢˜ isaï¼šæ˜¯ä¸€ä¸ªClass ç±»å‹çš„æŒ‡é’ˆ. æ¯ä¸ªå®ä¾‹å¯¹è±¡æœ‰ä¸ªisaçš„æŒ‡é’ˆ,ä»–æŒ‡å‘å¯¹è±¡çš„ç±»ï¼Œè€ŒClassé‡Œä¹Ÿæœ‰ä¸ªisaçš„æŒ‡é’ˆ, æŒ‡å‘meteClass(å…ƒç±»)ã€‚å…ƒç±»ä¿å­˜äº†ç±»æ–¹æ³•çš„åˆ—è¡¨ã€‚å½“ç±»æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå…ˆä¼šä»æœ¬èº«æŸ¥æ‰¾ç±»æ–¹æ³•çš„å®ç°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå…ƒç±»ä¼šå‘ä»–çˆ¶ç±»æŸ¥æ‰¾è¯¥æ–¹æ³•ã€‚åŒæ—¶æ³¨æ„çš„æ˜¯ï¼šå…ƒç±»ï¼ˆmeteClassï¼‰ä¹Ÿæ˜¯ç±»ï¼Œå®ƒä¹Ÿæ˜¯å¯¹è±¡ã€‚å…ƒç±»ä¹Ÿæœ‰isaæŒ‡é’ˆ,å®ƒçš„isaæŒ‡é’ˆæœ€ç»ˆæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ ¹å…ƒç±»(root meteClass).æ ¹å…ƒç±»çš„isaæŒ‡é’ˆæŒ‡å‘æœ¬èº«ï¼Œè¿™æ ·å½¢æˆäº†ä¸€ä¸ªå°é—­çš„å†…å¾ªç¯ã€‚ å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ ä¸€ç§æ˜¯é€šè¿‡KVCè·å– é€šè¿‡runtimeè®¿é—®å¹¶ä¿®æ”¹ç§æœ‰å±æ€§ å¦‚ä½•ä¸º Class å®šä¹‰ä¸€ä¸ªå¯¹å¤–åªè¯»å¯¹å†…å¯è¯»å†™çš„å±æ€§?åœ¨å¤´æ–‡ä»¶ä¸­å°†å±æ€§å®šä¹‰ä¸ºreadonly,åœ¨.mæ–‡ä»¶ä¸­å°†å±æ€§é‡æ–°å®šä¹‰ä¸ºreadwrite Objective-C ä¸­ï¼Œmeta-class æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Ÿmeta-class æ˜¯ Class å¯¹è±¡çš„ç±»,ä¸ºè¿™ä¸ªClassç±»å­˜å‚¨ç±»æ–¹æ³•,å½“ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯æ—¶,å°±å»è¿™ä¸ªç±»å¯¹åº”çš„meta-classä¸­æŸ¥æ‰¾é‚£ä¸ªæ¶ˆæ¯,æ¯ä¸ªClasséƒ½æœ‰ä¸åŒçš„meta-class,æ‰€æœ‰çš„meta-classéƒ½ä½¿ç”¨åŸºç±»çš„meta-class(å‡å¦‚ç±»ç»§æ‰¿NSObject,é‚£ä¹ˆä»–æ‰€å¯¹åº”çš„meta-classä¹Ÿæ˜¯NSObject)ä½œä¸ºä»–ä»¬çš„ç±» Objective-C çš„classæ˜¯å¦‚ä½•å®ç°çš„ï¼ŸSelectoræ˜¯å¦‚ä½•è¢«è½¬åŒ–ä¸º C è¯­è¨€çš„å‡½æ•°è°ƒç”¨çš„ï¼Ÿ å½“ä¸€ä¸ªç±»è¢«æ­£ç¡®çš„ç¼–è¯‘è¿‡åï¼Œåœ¨è¿™ä¸ªç¼–è¯‘æˆåŠŸçš„ç±»é‡Œé¢ï¼Œå­˜åœ¨ä¸€ä¸ªå˜é‡ç”¨äºä¿å­˜è¿™ä¸ªç±»çš„ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡[NSClassFromString]æˆ–[obj class]ã€‚è¿™æ ·çš„æœºåˆ¶å…è®¸æˆ‘ä»¬åœ¨ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­ï¼Œå¯ä»¥Classæ¥å¾—åˆ°å¯¹è±¡çš„ç±»ï¼Œä¹Ÿå¯ä»¥åœ¨ç¨‹åºæ‰§è¡Œçš„é˜¶æ®µåŠ¨æ€çš„ç”Ÿæˆä¸€ä¸ªåœ¨ç¼–è¯‘é˜¶æ®µæ— æ³•ç¡®å®šçš„ä¸€ä¸ªå¯¹è±¡ã€‚ ï¼ˆisaæŒ‡é’ˆï¼‰ @selector()åŸºæœ¬å¯ä»¥ç­‰åŒCè¯­è¨€çš„ä¸­å‡½æ•°æŒ‡é’ˆ,åªä¸è¿‡Cè¯­è¨€ä¸­ï¼Œå¯ä»¥æŠŠå‡½æ•°åç›´æ¥èµ‹ç»™ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œè€ŒObject-Cçš„ç±»ä¸èƒ½ç›´æ¥åº”ç”¨å‡½æ•°æŒ‡é’ˆï¼Œè¿™æ ·åªèƒ½åšä¸€ä¸ª@selectorè¯­æ³•æ¥å–. @interface foo -(int)add:int val; @end SEL class_func ; //å®šä¹‰ä¸€ä¸ªç±»æ–¹æ³•æŒ‡é’ˆ class_func = @selector(add:int); @selectoræ˜¯æŸ¥æ‰¾å½“å‰ç±»çš„æ–¹æ³•ï¼Œè€Œ[object @selector(æ–¹æ³•å:æ–¹æ³•å‚æ•°..) ] ;æ˜¯å–objectå¯¹åº”ç±»çš„ç›¸åº”æ–¹æ³•. æŸ¥æ‰¾ç±»æ–¹æ³•æ—¶ï¼Œé™¤äº†æ–¹æ³•å,æ–¹æ³•å‚æ•°ä¹ŸæŸ¥è¯¢æ¡ä»¶ä¹‹ä¸€. å¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥æ‰¾æ–¹æ³• SEL å˜é‡å = NSSelectorFromString(æ–¹æ³•åå­—çš„å­—ç¬¦ä¸²); å¯ä»¥è¿è¡Œä¸­ç”¨SELå˜é‡åå‘æŸ¥å‡ºæ–¹æ³•åå­—å­—ç¬¦ä¸²ã€‚NSString *å˜é‡å = NSStringFromSelector(SELå‚æ•°); å–åˆ°selectorçš„å€¼ä»¥åï¼Œæ‰§è¡Œseletorã€‚ SELå˜é‡çš„æ‰§è¡Œ.ç”¨performSelecoræ–¹æ³•æ¥æ‰§è¡Œ. [å¯¹è±¡ performSelector:SELå˜é‡ withObject:å‚æ•°1 withObject:å‚æ•°2]; å¯¹äºè¯­å¥NSString *obj = [[NSData alloc] init]; ï¼Œç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶objåˆ†åˆ«æ˜¯ä»€ä¹ˆç±»å‹ï¼Ÿ ç¼–è¯‘æ—¶æ˜¯NSStringç±»å‹ ï¼Œè¿è¡Œæ—¶æ˜¯NSDataç±»å‹. @synthesizeå’Œ@dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿç­”: @propertyæœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯ï¼Œä¸€ä¸ªæ˜¯ @synthesizeï¼Œä¸€ä¸ªæ˜¯ @dynamicã€‚å¦‚æœ @synthesizeå’Œ @dynamicéƒ½æ²¡å†™ï¼Œé‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯@syntheszie var = _var; @synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ @dynamic å‘Šè¯‰ç¼–è¯‘å™¨ï¼šå±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆã€‚ï¼ˆå½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯ï¼‰ã€‚å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º @dynamic varï¼Œç„¶åä½ æ²¡æœ‰æä¾› @setteræ–¹æ³•å’Œ @getter æ–¹æ³•ï¼Œç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVarï¼Œç”±äºç¼º setter æ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼›æˆ–è€…å½“è¿è¡Œåˆ° someVar = var æ—¶ï¼Œç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ç¼–è¯‘æ—¶æ²¡é—®é¢˜ï¼Œè¿è¡Œæ—¶æ‰æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŠ¨æ€ç»‘å®šã€‚ NSString çš„æ—¶å€™ç”¨copyå’Œstrongçš„åŒºåˆ«ï¼ŸOCä¸­NSStringä¸ºä¸å¯å˜å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œç”¨copyå’Œstrongéƒ½æ˜¯åªåˆ†é…ä¸€æ¬¡å†…å­˜ï¼Œä½†æ˜¯å¦‚æœç”¨copyçš„æ—¶å€™ï¼Œéœ€è¦å…ˆåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æ˜¯ä¸å¯å˜å­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯ä¸å¯å˜å­—ç¬¦ä¸²ï¼Œå°±ä¸å†åˆ†é…ç©ºé—´ï¼Œå¦‚æœæ˜¯å¯å˜å­—ç¬¦ä¸²æ‰åˆ†é…ç©ºé—´ã€‚å¦‚æœç¨‹åºä¸­ç”¨åˆ°NSStringçš„åœ°æ–¹ç‰¹åˆ«å¤šï¼Œæ¯ä¸€æ¬¡éƒ½è¦å…ˆè¿›è¡Œåˆ¤æ–­å°±ä¼šè€—è´¹æ€§èƒ½ï¼Œå½±å“ç”¨æˆ·ä½“éªŒï¼Œç”¨strongå°±ä¸ä¼šå†è¿›è¡Œåˆ¤æ–­ï¼Œæ‰€ä»¥ï¼Œä¸å¯å˜å­—ç¬¦ä¸²å¯ä»¥ç›´æ¥ç”¨strongã€‚ NSArrayã€NSSetã€NSDictionaryä¸NSMutableArrayã€NSMutableSetã€NSMutableDictionaryçš„ç‰¹æ€§å’Œä½œç”¨ï¼ˆé‡åˆ°copyä¿®é¥°äº§ç”Ÿçš„å˜åŒ–ï¼‰ ç‰¹æ€§ï¼š NSArrayè¡¨ç¤ºä¸å¯å˜æ•°ç»„ï¼Œæ˜¯æœ‰åºå…ƒç´ é›†ï¼Œåªèƒ½å­˜å‚¨å¯¹è±¡ç±»å‹ï¼Œå¯é€šè¿‡ç´¢å¼•ç›´æ¥è®¿é—®å…ƒç´ ï¼Œè€Œä¸”å…ƒç´ ç±»å‹å¯ä»¥ä¸ä¸€æ ·ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œï¼›NSMutableArrayæ˜¯å¯å˜æ•°ç»„ï¼Œèƒ½è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œã€‚é€šè¿‡ç´¢å¼•æŸ¥è¯¢å€¼å¾ˆå¿«ï¼Œä½†æ˜¯æ’å…¥ã€åˆ é™¤ç­‰æ•ˆç‡å¾ˆä½ã€‚ NSSetè¡¨ç¤ºä¸å¯å˜é›†åˆï¼Œå…·æœ‰ç¡®å®šæ€§ã€äº’å¼‚æ€§ã€æ— åºæ€§çš„ç‰¹ç‚¹ï¼Œåªèƒ½è®¿é—®è€Œä¸èƒ½ä¿®æ”¹é›†åˆï¼›NSMutableSetè¡¨ç¤ºå¯å˜é›†åˆï¼Œå¯ä»¥å¯¹é›†åˆè¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œã€‚é›†åˆé€šè¿‡å€¼æŸ¥è¯¢å¾ˆå¿«ï¼Œæ’å…¥ã€åˆ é™¤æ“ä½œæå¿«ã€‚ NSDictionaryè¡¨ç¤ºä¸å¯å˜å­—å…¸ï¼Œå…·æœ‰æ— åºæ€§çš„ç‰¹ç‚¹ï¼Œæ¯ä¸ªkeyå¯¹åº”çš„å€¼æ˜¯å”¯ä¸€çš„ï¼Œå¯é€šè¿‡keyç›´æ¥è·å–å€¼ï¼›NSMutableDictionaryè¡¨ç¤ºå¯å˜å­—å…¸ï¼Œèƒ½å¯¹å­—å…¸è¿›è¡Œå¢ã€åˆ ã€æ”¹æ“ä½œã€‚é€šè¿‡keyæŸ¥è¯¢å€¼ã€æ’å…¥ã€åˆ é™¤å€¼éƒ½å¾ˆå¿«ã€‚ ä½œç”¨ï¼š æ•°ç»„ç”¨äºå¤„ç†ä¸€ç»„æœ‰åºçš„æ•°æ®é›†ï¼Œæ¯”å¦‚å¸¸ç”¨çš„åˆ—è¡¨çš„dataSourceè¦æ±‚æœ‰åºï¼Œå¯é€šè¿‡ç´¢å¼•ç›´æ¥è®¿é—®ï¼Œæ•ˆç‡é«˜ã€‚ é›†åˆè¦æ±‚å…·æœ‰ç¡®å®šæ€§ã€äº’å¼‚æ€§ã€æ— åºæ€§ï¼Œåœ¨iOSå¼€å‘ä¸­æ˜¯æ¯”è¾ƒå°‘ä½¿ç”¨åˆ°çš„ï¼Œç¬”è€…ä¹Ÿä¸æ¸…æ¥šå¦‚ä½•è¯´æ˜å…¶ä½œç”¨ å­—å…¸æ˜¯é”®å€¼å¯¹æ•°æ®é›†ï¼Œæ“ä½œå­—å…¸æ•ˆç‡æé«˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºå¸¸é‡ï¼Œä½†æ˜¯å€¼æ˜¯æ— åºçš„ã€‚åœ¨iosä¸­ï¼Œå¸¸è§çš„JSONè½¬å­—å…¸ï¼Œå­—å…¸è½¬æ¨¡å‹å°±æ˜¯å…¶ä¸­ä¸€ç§åº”ç”¨ã€‚ è¯·æŠŠå­—ç¬¦ä¸²2015-04-10æ ¼å¼åŒ–æ—¥æœŸè½¬ä¸ºNSDateç±»å‹NSString *timeStr = @"2015-04-10"; NSDateFormatter *formatter = [[NSDateFormatter alloc] init]; formatter.dateFormat = @"yyyy-MM-dd"; formatter.timeZone = [NSTimeZone defaultTimeZone]; NSDate *date = [formatter dateFromString:timeStr]; // 2015-04-09 16:00:00 +0000 NSLog(@"%@", date); åœ¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•é‡Œï¼š[self.name=@object] å’Œname=@objectæœ‰ä»€ä¹ˆä¸åŒ è¿™æ˜¯è€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ï¼Œå®è´¨ä¸Šå°±æ˜¯é—®setteræ–¹æ³•èµ‹å€¼ä¸æˆå‘˜å˜é‡èµ‹å€¼æœ‰ä»€ä¹ˆä¸åŒã€‚é€šè¿‡ç‚¹è¯­æ³•self.nameå®è´¨ä¸Šå°±æ˜¯ [self setName:@object];ã€‚è€Œnameè¿™é‡Œæ˜¯æˆå‘˜å˜é‡ï¼Œç›´æ¥èµ‹å€¼ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåœ¨å¯¹è±¡çš„æ–¹æ³•é‡Œæˆå‘˜å˜é‡å’Œæ–¹æ³•éƒ½æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šé‡å†™Setteræ–¹æ³•æ¥æ‰§è¡ŒæŸäº›é¢å¤–çš„å·¥ä½œã€‚æ¯”å¦‚è¯´ï¼Œå¤–éƒ¨ä¼ ä¸€ä¸ªæ¨¡å‹è¿‡æ¥ï¼Œé‚£ä¹ˆæˆ‘ä¼šç›´æ¥é‡å†™Setteræ–¹æ³•ï¼Œå½“æ¨¡å‹ä¼ è¿‡æ¥æ—¶ï¼Œä¹Ÿå°±æ˜¯æ„å‘³ç€æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆè§†å›¾ä¹Ÿéœ€è¦æ›´æ–°æ˜¾ç¤ºï¼Œåˆ™åœ¨èµ‹å€¼æ–°æ¨¡å‹çš„åŒæ—¶ä¹Ÿå»åˆ·æ–°UIã€‚è¿™æ ·ä¹Ÿä¸ç”¨å†é¢å¤–æä¾›å…¶ä»–æ–¹æ³•äº†ã€‚ æ€æ ·ä½¿ç”¨performSelectorä¼ å…¥3ä¸ªä»¥ä¸Šå‚æ•°ï¼Œå…¶ä¸­ä¸€ä¸ªä¸ºç»“æ„ä½“- (id)performSelector:(SEL)aSelector; - (id)performSelector:(SEL)aSelector withObject:(id)object; - (id)performSelector:(SEL)aSelector withObject:(id)object1 withObject:(id)object2; å› ä¸ºç³»ç»Ÿæä¾›çš„performSelectorçš„apiä¸­ï¼Œå¹¶æ²¡æœ‰æä¾›ä¸‰ä¸ªå‚æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªèƒ½ä¼ æ•°ç»„æˆ–è€…å­—å…¸ï¼Œä½†æ˜¯æ•°ç»„æˆ–è€…å­—å…¸åªæœ‰å­˜å…¥å¯¹è±¡ç±»å‹ï¼Œè€Œç»“æ„ä½“å¹¶ä¸æ˜¯å¯¹è±¡ç±»å‹ï¼Œé‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿ æ²¡æœ‰åŠæ³•ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡å¯¹è±¡æ”¾å…¥ç»“æ„ä½œä¸ºå±æ€§æ¥ä¼ è¿‡å»äº†ï¼š ypedef struct HYBStruct { int a; int b; } *my_struct; @interface HYBObject : NSObject @property (nonatomic, assign) my_struct arg3; @property (nonatomic, copy) NSString *arg1; @property (nonatomic, copy) NSString *arg2; @end @implementation HYBObject // åœ¨å †ä¸Šåˆ†é…çš„å†…å­˜ï¼Œæˆ‘ä»¬è¦æ‰‹åŠ¨é‡Šæ”¾æ‰ - (void)dealloc { free(self.arg3); } @end æµ‹è¯•ï¼š my_struct str = (my_struct)(malloc(sizeof(my_struct))); str->a = 1; str->b = 2; HYBObject *obj = [[HYBObject alloc] init]; obj.arg1 = @"arg1"; obj.arg2 = @"arg2"; obj.arg3 = str; [self performSelector:@selector(call:) withObject:obj]; // åœ¨å›è°ƒæ—¶å¾—åˆ°æ­£ç¡®çš„æ•°æ®çš„ - (void)call:(HYBObject *)obj { NSLog(@"%d %d", obj.arg3->a, obj.arg3->b); } objcä¸­å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯[obj foo]å’Œobjc_msgSend()å‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå®é™…ä¸Šï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šè½¬æ¢æˆobjc_msgSendï¼Œå¤§æ¦‚ä¼šåƒè¿™æ ·ï¼š ((void (*)(id, SEL))(void)objc_msgSend)((id)obj, sel_registerName("foo")); ä¹Ÿå°±æ˜¯è¯´ï¼Œ[obj foo];åœ¨objcåŠ¨æ€ç¼–è¯‘æ—¶ï¼Œä¼šè¢«è½¬æ¢ä¸ºï¼šobjc_msgSend(obj, @selector(foo));è¿™æ ·çš„å½¢å¼ï¼Œä½†æ˜¯éœ€è¦æ ¹æ®å…·ä½“çš„å‚æ•°ç±»å‹åŠè¿”å›å€¼ç±»å‹è¿›è¡Œç›¸åº”çš„ç±»å‹è½¬æ¢ã€‚ ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ@implementation Son : Father - (id)init { self = [super init]; if (self) { NSLog(@"%@", NSStringFromClass([self class])); NSLog(@"%@", NSStringFromClass([super class])); } return self; } @end // è¾“å‡º NSStringFromClass([self class]) = Son NSStringFromClass([super class]) = Son è¿™ä¸ªé¢˜ç›®ä¸»è¦æ˜¯è€ƒå¯Ÿå…³äºObjective-Cä¸­å¯¹selfå’Œsuperçš„ç†è§£ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼šselfæ˜¯ç±»çš„éšè—å‚æ•°ï¼ŒæŒ‡å‘å½“å‰è°ƒç”¨æ–¹æ³•çš„è¿™ä¸ªç±»çš„å®ä¾‹ã€‚é‚£superå‘¢ï¼Ÿå¾ˆå¤šäººä¼šæƒ³å½“ç„¶çš„è®¤ä¸ºâ€œsuperå’Œselfç±»ä¼¼ï¼Œåº”è¯¥æ˜¯æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆå§ï¼â€ã€‚è¿™æ˜¯å¾ˆæ™®éçš„ä¸€ä¸ªè¯¯åŒºã€‚å…¶å® superæ˜¯ä¸€ä¸ª Magic Keywordï¼Œå®ƒæœ¬è´¨æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ ‡ç¤ºç¬¦ï¼Œå’Œself æ˜¯æŒ‡å‘çš„åŒä¸€ä¸ªæ¶ˆæ¯æ¥å—è€…ï¼ä»–ä»¬ä¸¤ä¸ªçš„ä¸åŒç‚¹åœ¨äºï¼šsuperä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè°ƒç”¨class è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œè¦å»çˆ¶ç±»çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯æœ¬ç±»é‡Œçš„ã€‚ ä¸Šé¢çš„ä¾‹å­ä¸ç®¡è°ƒç”¨[self class]è¿˜æ˜¯[super class]ï¼Œæ¥å—æ¶ˆæ¯çš„å¯¹è±¡éƒ½æ˜¯å½“å‰ Son ï¼Šxxx è¿™ä¸ªå¯¹è±¡ã€‚å½“ä½¿ç”¨selfè°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šä»å½“å‰ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä»çˆ¶ç±»ä¸­å†æ‰¾ï¼›è€Œå½“ä½¿ç”¨superæ—¶ï¼Œåˆ™ä»çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ã€‚ç„¶åè°ƒç”¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ã€‚ è‹¥ä¸€ä¸ªç±»æœ‰å®ä¾‹å˜é‡NSString *_fooï¼Œè°ƒç”¨setValue:forKey:æ—¶ï¼Œå¯ä»¥ä»¥fooè¿˜æ˜¯_fooä½œä¸ºkeyï¼Ÿ ä¸¤è€…éƒ½å¯ä»¥ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSMutableArrayï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSArray? å½“æ•°ç»„åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œéœ€è¦ä¸æ–­å˜åŒ–çš„ï¼Œä½¿ç”¨NSMutableArrayï¼Œå½“æ•°ç»„åœ¨åˆå§‹åŒ–åï¼Œä¾¿ä¸å†æ”¹å˜çš„ï¼Œä½¿ç”¨NSArrayã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œä½¿ç”¨NSArrayåªè¡¨æ˜çš„æ˜¯è¯¥æ•°ç»„åœ¨è¿è¡Œæ—¶ä¸å‘ç”Ÿæ”¹å˜ï¼Œå³ä¸èƒ½å¾€NSAarryçš„æ•°ç»„é‡Œæ–°å¢å’Œåˆ é™¤å…ƒç´ ï¼Œä½†ä¸è¡¨æ˜å…¶æ•°ç»„å…§çš„å…ƒç´ çš„å†…å®¹ä¸èƒ½å‘ç”Ÿæ”¹å˜ã€‚NSArrayæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒNSMutableArrayä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¤šçº¿ç¨‹ä½¿ç”¨åˆ°NSMutableArrayéœ€è¦æ³¨æ„ã€‚ ç±»NSObjectçš„é‚£äº›æ–¹æ³•ç»å¸¸è¢«ä½¿ç”¨? NSObjectæ˜¯Objetive-Cçš„åŸºç±»ï¼Œå…¶ç”±NSObjectç±»åŠä¸€ç³»åˆ—åè®®æ„æˆã€‚ å…¶ä¸­ç±»æ–¹æ³•allocã€classã€ description å¯¹è±¡æ–¹æ³•initã€deallocã€â€“ performSelector:withObject:afterDelay:ç­‰ç»å¸¸è¢«ä½¿ç”¨ ä»€ä¹ˆæ˜¯ç®€ä¾¿æ„é€ æ–¹æ³•? ç®€ä¾¿æ„é€ æ–¹æ³•ä¸€èˆ¬ç”±CocoaTouchæ¡†æ¶æä¾›ï¼Œå¦‚NSNumberçš„`objc numberWithBool: numberWithChar: numberWithDouble: numberWithFloat: numberWithInt:` Foundationä¸‹å¤§éƒ¨åˆ†ç±»å‡æœ‰ç®€ä¾¿æ„é€ æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€ä¾¿æ„é€ æ–¹æ³•ï¼Œè·å¾—ç³»ç»Ÿç»™æˆ‘ä»¬åˆ›å»ºå¥½çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾ã€‚ ä»€ä¹ˆæ˜¯æ„é€ æ–¹æ³•ï¼Œä½¿ç”¨æ„é€ æ–¹æ³•æœ‰ä»€ä¹ˆæ³¨æ„ç‚¹ã€‚ä»€ä¹ˆæ˜¯æ„é€ æ–¹æ³•ï¼šæ„é€ æ–¹æ³•æ˜¯å¯¹è±¡åˆå§‹åŒ–å¹¶ä¸€ä¸ªå®ä¾‹çš„æ–¹æ³•ã€‚ æ„é€ æ–¹æ³•æœ‰ä»€ä¹ˆç”¨ï¼š ä¸€èˆ¬åœ¨æ„é€ æ–¹æ³•é‡Œ å¯¹ç±»è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ æ³¨æ„ç‚¹ï¼šæ–¹æ³•å¼€å¤´å¿…é¡»ä»¥initå¼€å¤´ï¼Œæ¥ä¸‹æ¥åç§°è¦å¤§å†™ ä¾‹å¦‚ initWithName ï¼ŒinitLayout åˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦ç»è¿‡é‚£ä¸‰ä¸ªæ­¥éª¤ï¼Ÿ å¼€è¾Ÿå†…å­˜ç©ºé—´ åˆå§‹åŒ–å‚æ•° è¿”å›å†…å­˜åœ°å€å€¼ Getæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŸGetæ–¹æ³•çš„ä½œç”¨ï¼šä¸ºè°ƒç”¨è€…è¿”å›å¯¹è±¡å†…éƒ¨çš„æˆå‘˜å˜é‡ Setæ–¹æ³•çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼ŸSetæ–¹æ³•çš„å¥½å¤„ï¼Ÿ Setæ–¹æ³•çš„ä½œç”¨ï¼šä¸ºå¤–ç•Œæä¾›ä¸€ä¸ªè®¾ç½®æˆå‘˜å˜é‡å€¼çš„æ–¹æ³•ã€‚ Setæ–¹æ³•çš„å¥½å¤„ï¼š ä¸è®©æ•°æ®æš´éœ²åœ¨å¤–ï¼Œä¿è¯äº†æ•°æ®çš„å®‰å…¨æ€§ å¯¹è®¾ç½®çš„æ•°æ®è¿›è¡Œè¿‡æ»¤ ç»“æ„ä½“å½“ä¸­èƒ½å®šä¹‰ocå¯¹è±¡å—ï¼Ÿä¸èƒ½, å› ä¸ºç»“æ„ä½“å½“ä¸­åªèƒ½æ˜¯ç±»å‹çš„å£°æ˜ä¸èƒ½è¿›è¡Œåˆ†é…ç©ºé—´ ç‚¹è¯­æ³•æœ¬è´¨æ˜¯ä»€ä¹ˆ,å†™ä¸€ä¸ªç‚¹è¯­æ³•çš„ä¾‹å­,å¹¶å†™ä¸Šæ³¨é‡Š ç‚¹è¯­æ³•çš„æœ¬è´¨æ˜¯æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œä¸æ˜¯è®¿é—®æˆå‘˜å˜é‡ï¼Œå½“ä½¿ç”¨ç‚¹è¯­æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å±•å¼€æˆç›¸åº”çš„æ–¹æ³•ã€‚åˆ‡è®°ç‚¹è¯­æ³•çš„æœ¬è´¨æ˜¯è½¬æ¢æˆç›¸åº”çš„setå’Œgetæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰setå’Œgetæ–¹æ³•ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ç‚¹è¯­æ³•ã€‚ ä¾‹å¦‚æœ‰ä¸€ä¸ªPersonç±» é€šè¿‡@propertyå®šä¹‰äº†nameå’Œageå±æ€§,å†æä¾›äº†ä¸€ä¸ªrunæ–¹æ³•ã€‚ Person *person = [Person new]; person.name=@â€sk666â€;//è°ƒç”¨äº†personçš„setNameæ–¹æ³• int age = person.age; // è°ƒç”¨äº†personçš„ageæ–¹æ³• person.run //è°ƒç”¨äº†personçš„runæ–¹æ³• idç±»å‹æ˜¯ä»€ä¹ˆï¼Œinstancetypeæ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ idç±»å‹ï¼šä¸‡èƒ½æŒ‡é’ˆï¼Œèƒ½ä½œä¸ºå‚æ•°ï¼Œæ–¹æ³•çš„è¿”å›ç±»å‹ã€‚ instancetypeï¼šåªèƒ½ä½œä¸ºæ–¹æ³•çš„èŒƒå›´ç±»å‹ï¼Œå¹¶ä¸”è¿”å›çš„ç±»å‹æ˜¯å½“å‰å®šä¹‰ç±»çš„ç±»ç±»å‹ã€‚ æˆå‘˜å˜é‡åçš„å‘½åä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„å¥½å¤„ï¼Ÿ ä¸getæ–¹æ³•çš„æ–¹æ³•ååŒºåˆ†å¼€æ¥ï¼› å¯ä»¥å’Œä¸€äº›å…¶ä»–çš„å±€éƒ¨å˜é‡åŒºåˆ†å¼€æ¥ï¼Œä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡ï¼Œé€šå¸¸éƒ½æ˜¯ç±»çš„æˆå‘˜å˜é‡ã€‚ è¿™æ®µä»£ç æœ‰ä»€ä¹ˆé—®é¢˜å—:@implementation Person - (void)setAge:(int)newAge { self.age = newAge; } @end ä¼šæ­»å¾ªç¯,ä¼šé‡å¤è°ƒç”¨è‡ªå·±!self.age æ”¹ä¸º_ageå³å¯; å¹¶ä¸”ä¹¦å†™ä¸è§„èŒƒ:setteræ–¹æ³•ä¸­çš„newAgeåº”è¯¥ä¸ºage æˆªå–å­—ç¬¦ä¸²â€20 | http://www.baidu.comâ€ ä¸­, â€|â€å­—ç¬¦å‰é¢å’Œåé¢çš„æ•°æ®,åˆ†åˆ«è¾“å‡ºå®ƒä»¬ã€‚NSString * str = @"20 | http://www.baidu.com"; NSArray *array = [str componentsSeparatedByString:@"|"]; //è¿™æ˜¯åˆ†åˆ«è¾“å‡ºçš„æˆªå–åçš„å­—ç¬¦ä¸² for (int i = 0; i]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜3--Cè¯­è¨€]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%983-C%E8%AF%AD%E8%A8%80%2F</url>
    <content type="text"><![CDATA[Cè¯­è¨€ï¼Œå¼€å‘çš„åŸºç¡€åŠŸåº•ï¼ŒiOSå¾ˆå¤šé«˜çº§åº”ç”¨éƒ½è¦å’ŒCè¯­è¨€æ‰“äº¤é“ï¼Œæ‰€ä»¥ï¼ŒCè¯­è¨€åœ¨iOSå¼€å‘ä¸­çš„é‡è¦æ€§ï¼Œä½ æ‡‚çš„ã€‚é‡Œé¢çš„ä¸€äº›é—®é¢˜å¯èƒ½å¹¶ä¸æ˜¯Cè¯­è¨€é—®é¢˜ï¼Œä½†æ˜¯å±äºè®¡ç®—æœºçš„ä¸€äº›åŸç†æ€§çš„çŸ¥è¯†ç‚¹ï¼Œæ‰€ä»¥æˆ‘å°±ä¸å†å¦å¤–å†™ä¸€ç¯‡æ–‡ç« äº†ï¼Œç›´æ¥å†™åœ¨è¿™é‡Œã€‚ å½“ä½ å†™ä¸‹é¢çš„ä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆäº‹ï¼Ÿ least = MIN(*p++, b); ç»“æœæ˜¯ï¼š((p++) &lt;= (b) ? (p++) : (*p++)) è¿™ä¸ªè¡¨è¾¾å¼ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼ŒæŒ‡é’ˆpä¼šä½œä¸‰æ¬¡++è‡ªå¢æ“ä½œã€‚ ç”¨é¢„å¤„ç†æŒ‡ä»¤#defineå£°æ˜ä¸€ä¸ªå¸¸æ•°ï¼Œç”¨ä»¥è¡¨æ˜1å¹´ä¸­æœ‰å¤šå°‘ç§’ï¼ˆå¿½ç•¥é—°å¹´é—®é¢˜ï¼‰#define SECONDS_PER_YEAR (60 * 60 * 24 * 365)UL(ULæ— ç¬¦å·é•¿æ•´å½¢) å†™ä¸€ä¸ªâ€æ ‡å‡†â€å®MIN ï¼Œè¿™ä¸ªå®è¾“å…¥ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›è¾ƒå°çš„ä¸€ä¸ªã€‚#define MIN(A,B) ï¼ˆï¼ˆAï¼‰ &lt;= (B) ? (A) : (B)) å†™ä¸€ä¸ªæ ‡å‡†å®Maxï¼Œå¹¶ç»™å‡ºä»¥ä¸‹ä»£ç çš„è¾“å‡ºint array[5] = {1, 2, 3, 4, 5}; int *p = &amp;array[0]; int max = Max(*p++, 1); printf("%d %d", max, *p); å‚è€ƒç­”æ¡ˆï¼š 1ï¼Œ2 #define Max(X, Y) ((X) > (Y) ? (X) : (Y)) å½“çœ‹åˆ°å®æ—¶ï¼Œå°±ä¼šæƒ³åˆ°å®å®šä¹‰æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚å¯¹äº++ã€â€“ï¼Œåœ¨å®å½“ä¸­ä½¿ç”¨æ˜¯æœ€å®¹æ˜“äº§ç”Ÿå‰¯ä½œç”¨çš„ï¼Œå› æ­¤è¦æ…ç”¨ã€‚ åˆ†æï¼š pæŒ‡é’ˆæŒ‡å‘äº†æ•°ç»„arrayçš„é¦–åœ°å€ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ å¯¹åº”çš„åœ°å€ï¼Œå…¶å€¼ä¸º1. å®å®šä¹‰æ—¶ä¸€å®šè¦æ³¨æ„æ¯ä¸ªåœ°æ–¹è¦åŠ ä¸Šåœ†æ‹¬å· *p++ç›¸å½“äº*p, p++,æ‰€ä»¥Max(*p++, 1)ç›¸å½“äºï¼š (*p++) > (1) ? (*p++) : (1) => (1) > (1) ? (*p++) : (1) => ç¬¬ä¸€ä¸ª*p++çš„ç»“æœæ˜¯ï¼Œpæ‰€æŒ‡å‘çš„å€¼å˜æˆäº†2ï¼Œä½†æ˜¯1 > 1ä¸ºå€¤ï¼Œæ‰€ä»¥æœ€ç»ˆmaxçš„å€¼å°±æ˜¯1ã€‚è€Œåé¢çš„(*p++)ä¹Ÿå°±ä¸ä¼šæ‰§è¡Œï¼Œå› æ­¤pæ‰€æŒ‡å‘çš„åœ°å€å¯¹åº”çš„å€¼å°±æ˜¯2ï¼Œè€Œä¸æ˜¯3. æ‰©å±•ï¼šå¦‚æœä¸Šé¢çš„*p++æ”¹æˆ*(++p)å¦‚ä½•ï¼Ÿ (*++p) > (1) ? (*++p) : (1) => (2) > (1) ? (*++p) : (1) => max = *++p; => *p = 3ï¼Œmax = 3; defineå®šä¹‰çš„å®å’Œconstå®šä¹‰çš„å¸¸é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸÎ» #defineå®šä¹‰å®çš„æŒ‡ä»¤ï¼Œç¨‹åºåœ¨é¢„å¤„ç†é˜¶æ®µå°†ç”¨#defineæ‰€å®šä¹‰çš„å†…å®¹åªæ˜¯è¿›è¡Œäº†æ›¿æ¢ã€‚å› æ­¤ç¨‹åºè¿è¡Œæ—¶ï¼Œå¸¸é‡è¡¨ä¸­å¹¶æ²¡æœ‰ç”¨#defineæ‰€å®šä¹‰çš„å®ï¼Œç³»ç»Ÿå¹¶ä¸ä¸ºå®ƒåˆ†é…å†…å­˜ï¼Œè€Œä¸”åœ¨ç¼–è¯‘æ—¶ä¸ä¼šæ£€æŸ¥æ•°æ®ç±»å‹ï¼Œå‡ºé”™çš„æ¦‚ç‡è¦å¤§ä¸€äº›ã€‚ Î» constå®šä¹‰çš„å¸¸é‡ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶æ˜¯å­˜æ”¾åœ¨å¸¸é‡è¡¨ä¸­ï¼Œç³»ç»Ÿä¼šä¸ºå®ƒåˆ†é…å†…å­˜ï¼Œè€Œä¸”åœ¨ç¼–è¯‘æ—¶ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ #defineå®šä¹‰è¡¨è¾¾å¼æ—¶è¦æ³¨æ„â€œè¾¹ç¼˜æ•ˆåº”â€ï¼Œä¾‹å¦‚å¦‚ä¸‹å®šä¹‰ï¼š #define N 2 + 3 // æˆ‘ä»¬é¢„æƒ³çš„Nå€¼æ˜¯5ï¼Œæˆ‘ä»¬è¿™æ ·ä½¿ç”¨N int a = N / 2; // æˆ‘ä»¬é¢„æƒ³çš„açš„å€¼æ˜¯2.5ï¼Œå¯å®é™…ä¸Šaçš„å€¼æ˜¯3.5 å…³é”®å­—volatileæœ‰ä»€ä¹ˆå«æ„?å¹¶ç»™å‡ºä¸‰ä¸ªä¸åŒçš„ä¾‹å­ ä¼˜åŒ–å™¨åœ¨ç”¨åˆ°è¿™ä¸ªå˜é‡æ—¶å¿…é¡»æ¯æ¬¡éƒ½å°å¿ƒåœ°é‡æ–°è¯»å–è¿™ä¸ªå˜é‡çš„å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ä¿å­˜åœ¨å¯„å­˜å™¨é‡Œçš„å¤‡ä»½ã€‚ä¸‹é¢æ˜¯volatileå˜é‡çš„å‡ ä¸ªä¾‹å­ï¼š å¹¶è¡Œè®¾å¤‡çš„ç¡¬ä»¶å¯„å­˜å™¨ï¼ˆå¦‚ï¼šçŠ¶æ€å¯„å­˜å™¨ï¼‰ ä¸€ä¸ªä¸­æ–­æœåŠ¡å­ç¨‹åºä¸­ä¼šè®¿é—®åˆ°çš„éè‡ªåŠ¨å˜é‡(Non-automatic variables) å¤šçº¿ç¨‹åº”ç”¨ä¸­è¢«å‡ ä¸ªä»»åŠ¡å…±äº«çš„å˜é‡ å®Œæˆå­—ç¬¦ä¸²æ‹·è´å¯ä»¥ä½¿ç”¨sprintfã€strcpyã€ä»¥åŠmemcpyå‡½æ•°ï¼Œè¯·é—®è¿™äº›å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«?ä½ å–œæ¬¢å“ªä¸€ä¸ªï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè¿™äº›å‡½æ•°çš„åŒºåˆ«åœ¨äºå®ç°åŠŸèƒ½ä»¥åŠæ“ä½œå¯¹è±¡ä¸åŒã€‚ strcpyï¼šå‡½æ•°æ“ä½œçš„å¯¹è±¡æ˜¯å­—ç¬¦ä¸²ï¼Œå®Œæˆä»æºå­—ç¬¦ä¸²åˆ°ç›®çš„å­—ç¬¦ä¸²çš„æ‹·è´åŠŸèƒ½ã€‚ sprintfï¼šè¿™ä¸ªå‡½æ•°ä¸»è¦ç”¨æ¥å®ç°ï¼ˆå­—ç¬¦ä¸²æˆ–åŸºæœ¬æ•°æ®ç±»å‹ï¼‰å‘å­—ç¬¦ä¸²çš„è½¬æ¢åŠŸèƒ½ã€‚å¦‚æœæºå¯¹è±¡æ˜¯å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æŒ‡å®š%sæ ¼å¼ç¬¦ï¼Œä¹Ÿå¯å®ç°å­—ç¬¦ä¸²æ‹·è´åŠŸèƒ½ã€‚ memcpyï¼šå‡½æ•°é¡¾åæ€ä¹‰å°±æ˜¯å†…å­˜æ‹·è´ï¼Œå®ç°å°†ä¸€ä¸ªå†…å­˜å—çš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªå†…å­˜å—è¿™ä¸€åŠŸèƒ½ã€‚å†…å­˜å—ç”±å…¶é¦–åœ°å€ä»¥åŠé•¿åº¦ç¡®å®šã€‚å› æ­¤ï¼Œmemcpy çš„æ“ä½œå¯¹è±¡é€‚ç”¨äºä»»æ„æ•°æ®ç±»å‹ï¼Œåªè¦èƒ½ç»™å‡ºå¯¹è±¡çš„èµ·å§‹åœ°å€å’Œå†…å­˜é•¿åº¦ä¿¡æ¯ã€å¹¶ä¸”å¯¹è±¡å…·æœ‰å¯æ“ä½œæ€§å³å¯ã€‚é‰´äºmemcpyå‡½æ•°ç­‰é•¿æ‹·è´çš„ç‰¹ç‚¹ä»¥åŠæ•°æ®ç±»å‹ä»£è¡¨çš„ç‰©ç†æ„ä¹‰ï¼Œmemcpyå‡½æ•°é€šå¸¸é™äºåŒç§ç±»å‹æ•°æ®æˆ–å¯¹è±¡ä¹‹é—´çš„æ‹·è´ï¼Œå…¶ä¸­å½“ç„¶ä¹ŸåŒ…æ‹¬å­—ç¬¦ä¸²æ‹·è´ä»¥åŠåŸºæœ¬æ•°æ®ç±»å‹çš„æ‹·è´ã€‚ å¯¹äºå­—ç¬¦ä¸²æ‹·è´æ¥è¯´ï¼Œç”¨ä¸Šè¿°ä¸‰ä¸ªå‡½æ•°éƒ½å¯ä»¥å®ç°ï¼Œä½†æ˜¯å…¶å®ç°çš„æ•ˆç‡å’Œä½¿ç”¨çš„æ–¹ä¾¿ç¨‹åº¦ä¸åŒï¼š strcpy æ— ç–‘æ˜¯æœ€åˆé€‚çš„é€‰æ‹©ï¼šæ•ˆç‡é«˜ä¸”è°ƒç”¨æ–¹ä¾¿ã€‚ snprintf è¦é¢å¤–æŒ‡å®šæ ¼å¼ç¬¦å¹¶ä¸”è¿›è¡Œæ ¼å¼è½¬åŒ–ï¼Œéº»çƒ¦ä¸”æ•ˆç‡ä¸é«˜ã€‚ memcpy è™½ç„¶é«˜æ•ˆï¼Œä½†æ˜¯éœ€è¦é¢å¤–æä¾›æ‹·è´çš„å†…å­˜é•¿åº¦è¿™ä¸€å‚æ•°ï¼Œæ˜“é”™ä¸”ä½¿ç”¨ä¸ä¾¿ï¼›å¹¶ä¸”å¦‚æœé•¿åº¦æŒ‡å®šè¿‡å¤§çš„è¯ï¼ˆæœ€ä¼˜é•¿åº¦æ˜¯æºå­—ç¬¦ä¸²é•¿åº¦ + 1ï¼‰ï¼Œè¿˜ä¼šå¸¦æ¥æ€§èƒ½çš„ä¸‹é™ã€‚å…¶å® strcpy å‡½æ•°ä¸€èˆ¬æ˜¯åœ¨å†…éƒ¨è°ƒç”¨ memcpyå‡½æ•°æˆ–è€…ç”¨æ±‡ç¼–ç›´æ¥å®ç°çš„ï¼Œä»¥è¾¾åˆ°é«˜æ•ˆçš„ç›®çš„ã€‚å› æ­¤ï¼Œä½¿ç”¨ memcpy å’Œ strcpy æ‹·è´å­—ç¬¦ä¸²åœ¨æ€§èƒ½ä¸Šåº”è¯¥æ²¡æœ‰ä»€ä¹ˆå¤§çš„å·®åˆ«ã€‚ å¯¹äºéå­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®çš„å¤åˆ¶æ¥è¯´ï¼Œstrcpyå’Œsnprintfä¸€èˆ¬å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œå¯æ˜¯å¯¹memcpyå´æ²¡æœ‰ä»€ä¹ˆå½±å“ã€‚ä½†æ˜¯ï¼Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹æ¥è¯´ï¼Œå°½ç®¡å¯ä»¥ç”¨ memcpy è¿›è¡Œæ‹·è´ï¼Œç”±äºæœ‰èµ‹å€¼è¿ç®—ç¬¦å¯ä»¥æ–¹ä¾¿ä¸”é«˜æ•ˆåœ°è¿›è¡ŒåŒç§æˆ–å…¼å®¹ç±»å‹çš„æ•°æ®ä¹‹é—´çš„æ‹·è´ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹memcpyå‡ ä¹ä¸è¢«ä½¿ç”¨ã€‚memcpyçš„é•¿å¤„æ˜¯ç”¨æ¥å®ç°ï¼ˆé€šå¸¸æ˜¯å†…éƒ¨å®ç°å±…å¤šï¼‰å¯¹ç»“æ„æˆ–è€…æ•°ç»„çš„æ‹·è´ï¼Œå…¶ç›®çš„æ˜¯æˆ–è€…é«˜æ•ˆï¼Œæˆ–è€…ä½¿ç”¨æ–¹ä¾¿ï¼Œç”šæˆ–ä¸¤è€…å…¼æœ‰ã€‚ sprintf,strcpy,memcpyä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆè¦æ³¨æ„çš„åœ°æ–¹ strcpyæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ‹·è´çš„å‡½æ•°ï¼Œå®ƒçš„å‡½æ•°åŸå‹ä¸ºstrcpy(char dst, const char src); å°†srcå¼€å§‹çš„ä¸€æ®µå­—ç¬¦ä¸²æ‹·è´åˆ°dstå¼€å§‹çš„å†…å­˜ä¸­å»ï¼Œç»“æŸçš„æ ‡å¿—ç¬¦å·ä¸º â€˜\0â€™ï¼Œç”±äºæ‹·è´çš„é•¿åº¦ä¸æ˜¯ç”±æˆ‘ä»¬è‡ªå·±æ§åˆ¶çš„ï¼Œæ‰€ä»¥è¿™ä¸ªå­—ç¬¦ä¸²æ‹·è´å¾ˆå®¹æ˜“å‡ºé”™ã€‚ å…·å¤‡å­—ç¬¦ä¸²æ‹·è´åŠŸèƒ½çš„å‡½æ•°æœ‰memcpyï¼Œè¿™æ˜¯ä¸€ä¸ªå†…å­˜æ‹·è´å‡½æ•°ï¼Œå®ƒçš„å‡½æ•°åŸå‹ä¸ºmemcpy(char dst, const char src, unsigned int len);å°†é•¿åº¦ä¸ºlençš„ä¸€æ®µå†…å­˜ï¼Œä»srcæ‹·è´åˆ°dstä¸­å»ï¼Œè¿™ä¸ªå‡½æ•°çš„é•¿åº¦å¯æ§ã€‚ä½†æ˜¯ä¼šæœ‰å†…å­˜è¯»å†™é”™è¯¯ã€‚(æ¯”å¦‚lençš„é•¿åº¦å¤§äºè¦æ‹·è´çš„ç©ºé—´æˆ–ç›®çš„ç©ºé—´) sprintfæ˜¯æ ¼å¼åŒ–å‡½æ•°ã€‚å°†ä¸€æ®µæ•°æ®é€šè¿‡ç‰¹å®šçš„æ ¼å¼ï¼Œæ ¼å¼åŒ–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ç¼“å†²åŒºä¸­å»ã€‚sprintfæ ¼å¼åŒ–çš„å‡½æ•°çš„é•¿åº¦ä¸å¯æ§ï¼Œæœ‰å¯èƒ½æ ¼å¼åŒ–åçš„å­—ç¬¦ä¸²ä¼šè¶…å‡ºç¼“å†²åŒºçš„å¤§å°ï¼Œé€ æˆæº¢å‡ºã€‚ staticå…³é”®å­—çš„ä½œç”¨ éšè—ã€‚ç¼–è¯‘å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œæ‰€æœ‰æœªåŠ staticå‰ç¼€çš„å…¨å±€å˜é‡å’Œå‡½æ•°éƒ½å…¨å±€å¯è§ã€‚ ä¿æŒå˜é‡å†…å®¹çš„æŒä¹…ã€‚å…¨å±€å˜é‡å’Œstaticå˜é‡éƒ½å­˜å‚¨åœ¨é™æ€å­˜å‚¨åŒºï¼Œç¨‹åºå¼€å§‹è¿è¡Œå°±åˆå§‹åŒ–ï¼Œåªåˆå§‹åŒ–ä¸€æ¬¡ã€‚staticæ§åˆ¶äº†å˜é‡çš„ä½œç”¨èŒƒå›´ã€‚ é»˜è®¤åˆå§‹åŒ–ä¸º0.åœ¨é™æ€æ•°æ®åŒºï¼Œå†…å­˜ä¸­çš„æ‰€æœ‰å­—èŠ‚éƒ½æ˜¯0x00ï¼Œå…¨å±€å˜é‡å’Œstaticå˜é‡éƒ½æ˜¯é»˜è®¤åˆå§‹åŒ–ä¸º0. staticå…³é”®å­—åŒºåˆ«ï¼š staticå…¨å±€å˜é‡ä¸æ™®é€šçš„å…¨å±€å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šstaticå…¨å±€å˜é‡åªåˆä½¿åŒ–ä¸€æ¬¡ï¼Œé˜²æ­¢åœ¨å…¶ä»–æ–‡ä»¶å•å…ƒä¸­è¢«å¼•ç”¨; staticå±€éƒ¨å˜é‡å’Œæ™®é€šå±€éƒ¨å˜é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šstaticå±€éƒ¨å˜é‡åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡ä¾æ®ä¸Šä¸€æ¬¡ç»“æœå€¼ï¼› staticå‡½æ•°ä¸æ™®é€šå‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼šstaticå‡½æ•°åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œæ™®é€šå‡½æ•°åœ¨æ¯ä¸ªè¢«è°ƒç”¨ä¸­ç»´æŒä¸€ä»½æ‹·è´ å…³é”®å­—const const int a;int const a; ä½œç”¨æ˜¯ä¸€æ ·ï¼ša æ˜¯ä¸€ä¸ªå¸¸æ•´å‹æ•° const int a;int const a; a æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸æ•´å‹æ•°çš„æŒ‡é’ˆ(æ•´å‹æ•°æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œä½†æŒ‡é’ˆå¯ä»¥) int * const a;a æ˜¯ä¸€ä¸ªæŒ‡å‘æ•´å‹æ•°çš„å¸¸æŒ‡é’ˆ(æŒ‡é’ˆæŒ‡å‘çš„æ•´å‹æ•°æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œä½†æŒ‡é’ˆæ˜¯ä¸å¯ä¿®æ”¹çš„) int const * const a;a æ˜¯ä¸€ä¸ªæŒ‡å‘å¸¸æ•´å‹æ•°çš„å¸¸æŒ‡é’ˆ(æŒ‡é’ˆæŒ‡å‘çš„æ•´å‹æ•°æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼ŒåŒæ—¶æŒ‡é’ˆä¹Ÿæ˜¯ä¸å¯ä¿®æ”¹çš„) å †æ ˆ ç®¡ç†æ–¹å¼ï¼šå¯¹äºæ ˆæ¥è®²ï¼Œæ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æˆ‘ä»¬æ‰‹å·¥æ§åˆ¶ï¼›å¯¹äºå †æ¥è¯´ï¼Œé‡Šæ”¾å·¥ä½œç”±ç¨‹åºå‘˜æ§åˆ¶ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜æ³„éœ² (memory leak)ã€‚ ç”³è¯·å¤§å°ï¼š æ ˆï¼šåœ¨Windowsä¸‹,æ ˆæ˜¯å‘ä½åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜çš„åŒºåŸŸã€‚è¿™å¥è¯çš„æ„æ€æ˜¯æ ˆé¡¶çš„åœ°å€å’Œæ ˆçš„æœ€å¤§å®¹é‡æ˜¯ç³»ç»Ÿé¢„å…ˆè§„å®šå¥½çš„ï¼Œåœ¨Windowsä¸‹ï¼Œæ ˆçš„å¤§å°æ˜¯2Mï¼ˆä¹Ÿæœ‰çš„è¯´æ˜¯1Mï¼Œæ€»ä¹‹æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å°±ç¡®å®šçš„å¸¸æ•°ï¼‰ï¼Œå¦‚æœç”³è¯·çš„ç©ºé—´è¶…è¿‡æ ˆçš„å‰©ä½™ç©ºé—´æ—¶ï¼Œå°†æç¤º overflowã€‚å› æ­¤ï¼Œèƒ½ä»æ ˆè·å¾—çš„ç©ºé—´è¾ƒå°ã€‚ å †ï¼šå †æ˜¯å‘é«˜åœ°å€æ‰©å±•çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸è¿ç»­çš„å†…å­˜åŒºåŸŸã€‚è¿™æ˜¯ç”±äºç³»ç»Ÿæ˜¯ç”¨é“¾è¡¨æ¥å­˜å‚¨çš„ç©ºé—²å†…å­˜åœ°å€çš„ï¼Œè‡ªç„¶æ˜¯ä¸è¿ç»­çš„ï¼Œè€Œé“¾è¡¨çš„éå†æ–¹å‘æ˜¯ç”±ä½åœ°å€å‘é«˜åœ°å€ã€‚å †çš„å¤§å°å—é™äºè®¡ç®—æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„è™šæ‹Ÿå†…å­˜ã€‚ç”±æ­¤å¯è§ï¼Œå †è·å¾—çš„ç©ºé—´æ¯”è¾ƒçµæ´»ï¼Œä¹Ÿæ¯”è¾ƒå¤§ã€‚ ç¢ç‰‡é—®é¢˜ï¼š å¯¹äºå †æ¥è®²ï¼Œé¢‘ç¹çš„new/deleteåŠ¿å¿…ä¼šé€ æˆå†…å­˜ç©ºé—´çš„ä¸è¿ç»­ï¼Œä»è€Œé€ æˆå¤§é‡çš„ç¢ç‰‡ï¼Œä½¿ç¨‹åºæ•ˆç‡é™ä½ã€‚å¯¹äºæ ˆæ¥è®²ï¼Œåˆ™ä¸ä¼šå­˜åœ¨è¿™ä¸ª é—®é¢˜ï¼Œå› ä¸ºæ ˆæ˜¯å…ˆè¿›åå‡ºçš„é˜Ÿåˆ—ï¼Œä»–ä»¬æ˜¯å¦‚æ­¤çš„ä¸€ä¸€å¯¹åº”ï¼Œä»¥è‡³äºæ°¸è¿œéƒ½ä¸å¯èƒ½æœ‰ä¸€ä¸ªå†…å­˜å—ä»æ ˆä¸­é—´å¼¹å‡º åˆ†é…æ–¹å¼ï¼š å †éƒ½æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Œæ²¡æœ‰é™æ€åˆ†é…çš„å †ã€‚æ ˆæœ‰2ç§åˆ†é…æ–¹å¼ï¼šé™æ€åˆ†é…å’ŒåŠ¨æ€åˆ†é…ã€‚é™æ€åˆ†é…æ˜¯ç¼–è¯‘å™¨å®Œæˆçš„ï¼Œæ¯”å¦‚å±€éƒ¨å˜é‡çš„åˆ†é…ã€‚åŠ¨æ€åˆ†é…ç”± allocå‡½æ•°è¿›è¡Œåˆ†é…ï¼Œä½†æ˜¯æ ˆçš„åŠ¨æ€åˆ†é…å’Œå †æ˜¯ä¸åŒçš„ï¼Œä»–çš„åŠ¨æ€åˆ†é…æ˜¯ç”±ç¼–è¯‘å™¨è¿›è¡Œé‡Šæ”¾ï¼Œæ— éœ€æˆ‘ä»¬æ‰‹å·¥å®ç°ã€‚ åˆ†é…æ•ˆç‡ï¼š æ ˆæ˜¯æœºå™¨ç³»ç»Ÿæä¾›çš„æ•°æ®ç»“æ„ï¼Œè®¡ç®—æœºä¼šåœ¨åº•å±‚å¯¹æ ˆæä¾›æ”¯æŒï¼šåˆ†é…ä¸“é—¨çš„å¯„å­˜å™¨å­˜æ”¾æ ˆçš„åœ°å€ï¼Œå‹æ ˆå‡ºæ ˆéƒ½æœ‰ä¸“é—¨çš„æŒ‡ä»¤æ‰§è¡Œï¼Œè¿™å°±å†³å®šäº†æ ˆçš„ æ•ˆç‡æ¯”è¾ƒé«˜ã€‚å †åˆ™æ˜¯C/C++å‡½æ•°åº“æä¾›çš„ï¼Œå®ƒçš„æœºåˆ¶æ˜¯å¾ˆå¤æ‚çš„ æ•°ç»„å’ŒæŒ‡é’ˆçš„åŒºåˆ« æ•°ç»„å¯ä»¥ç”³è¯·åœ¨æ ˆåŒºå’Œæ•°æ®åŒºï¼›æŒ‡é’ˆå¯ä»¥æŒ‡å‘ä»»æ„ç±»å‹çš„å†…å­˜å— sizeofä½œç”¨äºæ•°ç»„æ—¶ï¼Œå¾—åˆ°çš„æ˜¯æ•°ç»„æ‰€å çš„å†…å­˜å¤§å°ï¼›ä½œç”¨äºæŒ‡é’ˆæ—¶ï¼Œå¾—åˆ°çš„éƒ½æ˜¯4ä¸ªå­—èŠ‚çš„å¤§å° æ•°ç»„åè¡¨ç¤ºæ•°ç»„é¦–åœ°å€ï¼Œæ˜¯å¸¸é‡æŒ‡é’ˆï¼Œä¸å¯ä¿®æ”¹æŒ‡å‘ã€‚æ¯”å¦‚ä¸å¯ä»¥å°†ï¼‹ï¼‹ä½œç”¨äºæ•°ç»„åä¸Šï¼›æ™®é€šæŒ‡é’ˆçš„å€¼å¯ä»¥æ”¹å˜ï¼Œæ¯”å¦‚å¯å°†ï¼‹ï¼‹ä½œç”¨äºæŒ‡é’ˆä¸Š ç”¨å­—ç¬¦ä¸²åˆå§‹åŒ–å­—ç¬¦æ•°ç»„æ˜¯å°†å­—ç¬¦ä¸²çš„å†…å®¹æ‹·è´åˆ°å­—ç¬¦æ•°ç»„ä¸­ï¼›ç”¨å­—ç¬¦ä¸²åˆå§‹åŒ–å­—ç¬¦æŒ‡é’ˆæ˜¯å°†å­—ç¬¦ä¸²çš„é¦–åœ°å€èµ‹ç»™æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯æŒ‡é’ˆæŒ‡å‘äº†è¯¥å­—ç¬¦ä¸² å¼•ç”¨å’ŒæŒ‡é’ˆçš„åŒºåˆ« æŒ‡é’ˆæŒ‡å‘ä¸€å—å†…å­˜ï¼Œå†…å®¹å­˜å‚¨æ‰€æŒ‡å†…å­˜çš„åœ°å€ã€‚ å¼•ç”¨æ˜¯æŸå—å†…å­˜çš„åˆ«åã€‚ å¼•ç”¨ä½¿ç”¨æ—¶ä¸éœ€è¦è§£å¼•ç”¨ï¼ˆ*ï¼‰è€ŒæŒ‡é’ˆéœ€è¦ å¼•ç”¨åªåœ¨å®šä¹‰æ—¶è¢«åˆå§‹åŒ–ï¼Œä¹‹åä¸å¯å˜ï¼ŒæŒ‡é’ˆå¯å˜ã€‚ å¼•ç”¨æ²¡æœ‰const å¼•ç”¨ä¸èƒ½ä¸ºç©º sizeofå¼•ç”¨å¾—åˆ°çš„æ˜¯æ‰€æŒ‡å‘å˜é‡ï¼ˆå¯¹è±¡ï¼‰çš„å¤§å°ï¼ŒsizeofæŒ‡é’ˆæ˜¯æŒ‡é’ˆæœ¬èº«çš„å¤§å°ã€‚ æŒ‡é’ˆå’Œå¼•ç”¨çš„è‡ªå¢(++)è¿ç®—æ„ä¹‰ä¸ä¸€æ ·ï¼šå¼•ç”¨++ä¸ºå¼•ç”¨å¯¹è±¡è‡ªå·±++ï¼ŒæŒ‡é’ˆ++æ˜¯æŒ‡å‘å¯¹è±¡åé¢çš„å†…å­˜ ç¨‹åºéœ€è¦ä¸ºæŒ‡é’ˆåˆ†é…å†…å­˜åŒºåŸŸï¼Œå¼•ç”¨ä¸éœ€è¦ã€‚ ç”¨å˜é‡aç»™å‡ºä¸‹é¢çš„å®šä¹‰ ä¸€ä¸ªæ•´å‹æ•°ï¼ˆAn integerï¼‰ ä¸€ä¸ªæŒ‡å‘æ•´å‹æ•°çš„æŒ‡é’ˆï¼ˆ A pointer to an integerï¼‰ ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆçš„çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æŒ‡é’ˆæ˜¯æŒ‡å‘ä¸€ä¸ªæ•´å‹æ•°ï¼ˆ A pointer to a pointer to an integeï¼‰r ä¸€ä¸ªæœ‰10ä¸ªæ•´å‹æ•°çš„æ•°ç»„ï¼ˆ An array of 10 integersï¼‰ ä¸€ä¸ªæœ‰10ä¸ªæŒ‡é’ˆçš„æ•°ç»„ï¼Œè¯¥æŒ‡é’ˆæ˜¯æŒ‡å‘ä¸€ä¸ªæ•´å‹æ•°çš„ã€‚ï¼ˆAn array of 10 pointers to integersï¼‰ ä¸€ä¸ªæŒ‡å‘æœ‰10ä¸ªæ•´å‹æ•°æ•°ç»„çš„æŒ‡é’ˆï¼ˆ A pointer to an array of 10 integersï¼‰ ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¯¥å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ•´å‹æ•°ï¼ˆA pointer to a function that takes an integer as an argument and returns an integerï¼‰ ä¸€ä¸ªæœ‰10ä¸ªæŒ‡é’ˆçš„æ•°ç»„ï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ‰ä¸€ä¸ªæ•´å‹å‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ•´å‹æ•°ï¼ˆ An array of ten pointers to functions t hat take an integer argument and return an integer ï¼‰ ç­”æ¡ˆæ˜¯ï¼š int a; // An integer int *a; // A pointer to an integer int **a; // A pointer to a pointer to an integer int a[10]; // An array of 10 integers int *a[10]; // An array of 10 pointers to integers int (*a)[10]; // A pointer to an array of 10 integers int (*a)(int); // A pointer to a function a that takes an integer argument and returns an integer int (*a[10])(int); // An array of 10 pointers to functions that take an integer argument and return an integer è¯·å†™å‡ºä»¥ä¸‹ä»£ç è¾“å‡ºint a[5] = {1, 2, 3, 4, 5}; int *ptr = (int *)(&amp;a + 1); printf("%d, %d", *(a + 1), *(ptr + 1)); å‚è€ƒç­”æ¡ˆï¼š 2, éšæœºå€¼ è¿™ç§ç±»å‹é¢˜å¥½åƒæŒºå¸¸è§çš„ã€‚è€ƒçš„å°±æ˜¯Cè¯­è¨€ä¸Šçš„æŒ‡é’ˆçš„ç†è§£å’Œæ•°ç»„çš„ç†è§£ã€‚ åˆ†æï¼š aä»£è¡¨æœ‰5ä¸ªå…ƒç´ çš„æ•°ç»„çš„é¦–åœ°å€ï¼Œa[5]çš„å…ƒç´ åˆ†åˆ«æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ã€‚æ¥ä¸‹æ¥ï¼Œa + 1è¡¨ç¤ºæ•°æ®é¦–åœ°å€åŠ 1ï¼Œé‚£ä¹ˆå°±æ˜¯a[1]ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”äºå€¼ä¸º2.ä½†æ˜¯ï¼Œè¿™é‡Œæ˜¯&amp;a + 1ï¼Œå› ä¸ºaä»£è¡¨çš„æ˜¯æ•´ä¸ªæ•°ç»„ï¼Œå®ƒçš„ç©ºé—´å¤§å°ä¸º5 * sizeof(int)ï¼Œå› æ­¤&amp;a + 1å°±æ˜¯a+5ã€‚aæ˜¯ä¸ªå¸¸é‡æŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰æ•°ç»„çš„é¦–åœ°å€ï¼ŒæŒ‡é’ˆ+1å°±æ˜¯ç§»åŠ¨sizeof(int)ä¸ªå­—èŠ‚ã€‚ å› æ­¤ï¼Œptræ˜¯æŒ‡å‘int *ç±»å‹çš„æŒ‡é’ˆï¼Œè€ŒptræŒ‡å‘çš„å°±æ˜¯a + 5ï¼Œé‚£ä¹ˆptr + 1ä¹Ÿç›¸å½“äºa + 6ï¼Œæ‰€ä»¥æœ€åçš„*(ptr + 1)å°±æ˜¯ä¸€ä¸ªéšæœºå€¼äº†ã€‚è€Œ*(ptr â€“ 1)å°±ç›¸å½“äºa + 4ï¼Œå¯¹åº”çš„å€¼å°±æ˜¯5ã€‚ ç®€è¿°å†…å­˜åˆ†åŒºæƒ…å†µ ä»£ç åŒºï¼šå­˜æ”¾å‡½æ•°äºŒè¿›åˆ¶ä»£ç  æ•°æ®åŒºï¼šç³»ç»Ÿè¿è¡Œæ—¶ç”³è¯·å†…å­˜å¹¶åˆå§‹åŒ–ï¼Œç³»ç»Ÿé€€å‡ºæ—¶ç”±ç³»ç»Ÿé‡Šæ”¾ï¼Œå­˜æ”¾å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€å¸¸é‡ å †åŒºï¼šé€šè¿‡mallocç­‰å‡½æ•°æˆ–newç­‰æ“ä½œç¬¦åŠ¨æ€ç”³è¯·å¾—åˆ°ï¼Œéœ€ç¨‹åºå‘˜æ‰‹åŠ¨ç”³è¯·å’Œé‡Šæ”¾ æ ˆåŒºï¼šå‡½æ•°æ¨¡å—å†…ç”³è¯·ï¼Œå‡½æ•°ç»“æŸæ—¶ç”±ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ï¼Œå­˜æ”¾å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•° ç”¨NSLogå‡½æ•°è¾“å‡ºä¸€ä¸ªæµ®ç‚¹ç±»å‹ï¼Œç»“æœå››èˆäº”å…¥ï¼Œå¹¶ä¿ç•™ä¸€ä½å°æ•°float money = 1.011; NSLog(@"%.1f", money);]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜2--UNIXå¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%982-UNIX%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%2F</url>
    <content type="text"><![CDATA[åšå¼€å‘è¯´ç”¨ä¸åˆ°å‘½ä»¤è¡Œï¼Œé‚£è‚¯å®šæ˜¯ä¸å¯èƒ½çš„ã€‚æ‰€ä»¥è®°ä½å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤è¿˜æ˜¯å¾ˆæœ‰ç”¨ã€‚ cd æ”¹å˜å·¥ä½œç›®å½• pwd è¾“å‡ºå½“å‰å·¥ä½œç›®å½•çš„ç»å¯¹è·¯å¾„ åœ¨UNIXä¸­è¦æ‰§è¡Œä»€ä¹ˆå‘½ä»¤ï¼Œä¸€å®šè¦çŸ¥é“è‡ªå·±å½“å‰æ‰€åœ¨çš„å·¥ä½œç›®å½• ls æŸ¥çœ‹æ–‡ä»¶ $ ls æ˜¾ç¤ºæ–‡ä»¶ $ ls -a æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ $ ls -l åˆ—è¡¨æ˜¾ç¤ºæ–‡ä»¶ $ ls -la åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ touch ç”¨äºæ›´æ”¹æ–‡ä»¶è®¿é—®å’Œä¿®æ”¹æ—¶é—´çš„æ ‡å‡†UNIXç¨‹åºï¼Œä¹Ÿè¢«ç”¨äºåˆ›å»ºæ–°æ–‡ä»¶ $ touch test.txt æ³¨æ„ï¼štouchä¸ä¿®æ”¹test.txtå†…å®¹ï¼Œåªæ›´æ”¹å®ƒçš„è®¿é—®ã€ä¿®æ”¹æ—¶é—´ï¼Œå¦‚æœtest.txtä¸å­˜åœ¨ï¼Œå®ƒä¼šè¢«åˆ›å»º cat è¿ç»­æŸ¥çœ‹æ–‡ä»¶å†…å®¹ more åˆ†é¡µæŸ¥çœ‹æ–‡ä»¶å†…å®¹ æç¤ºï¼š 1&gt; å‘½ä»¤å’Œå‚æ•°ä¹‹é—´éœ€è¦æ·»åŠ ç©ºæ ¼ 2&gt; å¦‚æœè¦ä½¿ç”¨å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶åï¼Œè¾“å…¥åˆ°ä¸€åŠæ—¶ï¼ŒæŒ‰TABé”®èƒ½å¤Ÿè¡¥å…¨]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSé¢è¯•é¢˜1--ç‰ˆæœ¬æ§åˆ¶]]></title>
    <url>%2F2018%2F09%2F12%2FiOS%E9%9D%A2%E8%AF%95%E9%A2%981-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%2F</url>
    <content type="text"><![CDATA[é¢è¯•è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé—®åŠä¸€äº›å…³äºç‰ˆæœ¬æ§åˆ¶çš„é—®é¢˜ï¼Œç†è§£ä¸‹SVNå’ŒGitçš„åŸç†ï¼Œè®°ä½å¸¸ç”¨å‘½ä»¤å³å¯ã€‚ SVN SVN æ˜¯é›†ä¸­å¼æºä»£ç ç®¡ç†å·¥å…· æ¦‚å¿µï¼š 1&gt; Repository ä»£ç ä»“åº“ï¼Œä¿å­˜ä»£ç çš„ä»“åº“ 2&gt; Server æœåŠ¡å™¨ï¼Œä¿å­˜æ‰€æœ‰ç‰ˆæœ¬çš„ä»£ç ä»“åº“ 3&gt; Client å®¢æˆ·ç«¯ï¼Œåªä¿å­˜å½“å‰ç”¨æˆ·çš„ä»£ç ä»“åº“ 4&gt; ç”¨æˆ·å&amp;å¯†ç  è®¿é—®ä»£ç ä»“åº“éœ€è¦ä½¿ç”¨è‡ªå·±çš„&quot;ç”¨æˆ·åå’Œå¯†ç &quot;ï¼Œä»è€Œå¯ä»¥åŒºåˆ†å‡ºä¸åŒçš„äººå¯¹ä»£ç åšçš„ä¿®æ”¹ æ“ä½œï¼š 1&gt; checkout å°†æœåŠ¡å™¨ä¸Šæœ€æ–°çš„ä»£ç ä»“åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œ&quot;åªéœ€è¦åšä¸€æ¬¡&quot; 2&gt; update ä»æœåŠ¡å™¨ä¸Šå°†å…¶ä»–äººæ‰€åšçš„ä¿®æ”¹ä¸‹è½½åˆ°æœ¬åœ°ï¼Œ&quot;æ¯å¤©ä¸Šç­å¿…é¡»è¦åšçš„äº‹æƒ…&quot; 3&gt; commit å°†å·¥ä½œæäº¤åˆ°æœåŠ¡å™¨ï¼Œ&quot;æ¯å¤©ä¸‹ç­ä¹‹å‰è‡³å°‘åšä¸€æ¬¡&quot; SVNæœåŠ¡å™¨å®‰è£…(ç•¥) SVNå¸¸ç”¨å‘½ä»¤ åˆ‡æ¢å·¥ä½œç›®å½• $ cd å·¥ä½œç›®å½• checkoutæœåŠ¡å™¨ä¸Šçš„ä»£ç ä»“åº“ $ svn co http://xxx/svn/xxxx --username=manager --password=manager æç¤ºï¼šcheckout(co)ä¹‹åï¼Œå‘½ä»¤è¡Œä¼šè®°å½•ç”¨æˆ·åå’Œå¯†ç ï¼Œåç»­æ“ä½œä¸ç”¨å†å¦è¡ŒæŒ‡å®š æŸ¥çœ‹æœ¬åœ°ä»£ç åº“çŠ¶æ€ $ svn st é”™è¯¯æç¤ºï¼š&quot;is not a working copy&quot;ï¼Œå¿…é¡»åœ¨svnçš„å·¥ä½œç›®å½•ä¸‹æ‰èƒ½æ­£ç¡®ä½¿ç”¨svnçš„å‘½ä»¤ æŸ¥çœ‹svnæ—¥å¿— $ svn log æŸ¥çœ‹æŸä¸€ä¸ªæ–‡ä»¶çš„æ—¥å¿— $ svn log filename æŸ¥çœ‹æŸä¸€ä¸ªæ–‡ä»¶æŸä¸ªç‰ˆæœ¬çš„æ—¥å¿— $ svn log filename@1 åˆ›å»ºæ–‡ä»¶ $ touch main.c æ‰“å¼€å¹¶ç¼–å†™æ–‡ä»¶å†…å®¹ $ open main.c æŸ¥çœ‹å·¥ä½œç›®å½•çŠ¶æ€ $ svn st å°†æ–‡ä»¶æ·»åŠ åˆ°æœ¬åœ°ç‰ˆæœ¬åº“ä¸­ $ svn add main.c/main.* å°†æ–‡ä»¶æäº¤åˆ°æœåŠ¡å™¨çš„ç‰ˆæœ¬åº“ä¸­ $ svn ci -m &quot;å¤‡æ³¨ä¿¡æ¯&quot; æ³¨æ„ï¼šä¸€å®šè¦å…»æˆå†™æ³¨é‡Šçš„è‰¯å¥½ä¹ æƒ¯ åˆ é™¤æ–‡ä»¶ $ svn rm Person.h æäº¤åˆ é™¤ $ svn ci -m &quot;åˆ é™¤äº†æ–‡ä»¶&quot; æ³¨æ„ï¼šä¸è¦ä½¿ç”¨æ–‡ä»¶ç®¡ç†å™¨ç›´æ¥åˆ é™¤æ–‡ä»¶ æ’¤é”€ä¿®æ”¹ $ svn revert Person.m æ¢å¤åˆ°ä¹‹å‰çš„æŸä¸ªç‰ˆæœ¬ $ svn update -r 5 å†²çªè§£å†³ (p) postpone å¯¹æ¯” (mc) mine-conflict ä½¿ç”¨æˆ‘çš„ (tc) theirs-conflict ä½¿ç”¨å¯¹æ–¹çš„ svn st æ˜¾ç¤ºçš„æ–‡ä»¶çŠ¶æ€ &#39; &#39; æ²¡æœ‰ä¿®æ”¹ &#39;A&#39; è¢«æ·»åŠ åˆ°æœ¬åœ°ä»£ç ä»“åº“ &#39;C&#39; å†²çª &#39;D&#39; è¢«åˆ é™¤ &#39;I&#39; è¢«å¿½ç•¥ &#39;M&#39; è¢«ä¿®æ”¹ &#39;R&#39; è¢«æ›¿æ¢ &#39;X&#39; å¤–éƒ¨å®šä¹‰åˆ›å»ºçš„ç‰ˆæœ¬ç›®å½• &#39;?&#39; æ–‡ä»¶æ²¡æœ‰è¢«æ·»åŠ åˆ°æœ¬åœ°ç‰ˆæœ¬åº“å†… &#39;!&#39; æ–‡ä»¶ä¸¢å¤±æˆ–è€…ä¸å®Œæ•´ï¼ˆä¸æ˜¯é€šè¿‡svnå‘½ä»¤åˆ é™¤çš„æ–‡ä»¶ï¼‰ &#39;~&#39; å—æ§æ–‡ä»¶è¢«å…¶ä»–æ–‡ä»¶é˜»éš” Git gitæ˜¯ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶å·¥å…· $ git help æŸ¥çœ‹gitæ‰€æœ‰å‘½ä»¤çš„å¸®åŠ© $ git help å­å‘½ä»¤ è¦é€€å‡ºå¸®åŠ©ä¿¡æ¯ï¼ŒæŒ‰&quot;q&quot; ç¿»çœ‹ä¸‹é¡µï¼ŒæŒ‰&quot;ç©ºæ ¼&quot; ç¿»çœ‹ä¸Šé¡µï¼ŒæŒ‰&quot;CTRL+B&quot; è¦æœç´¢ç›¸å…³æ–‡å­—ï¼ŒæŒ‰&quot;/&quot;ç„¶åè¾“å…¥&quot;ç›¸å…³æ–‡å­—&quot; åˆ›å»ºä»£ç ä»“åº“ $ git init é…ç½®ç”¨æˆ·åå’Œé‚®ç®± $ git config user.name manager $ git config user.email manager@gmail.com ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤ä¼šå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨å½“å‰ä»£ç ä»“åº“ä¸­ å¦‚æœè¦ä¸€æ¬¡æ€§é…ç½®å®Œæˆå¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤ $ git config --global user.name manager $ git config --global user.email manager@gmail.com ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤ä¼šå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„ .gitconfig æ–‡ä»¶ä¸­ æŸ¥çœ‹å½“å‰æ‰€æœ‰é…ç½® $ git config -l åˆ›å»ºä»£ç ï¼Œå¼€å§‹å¼€å‘ $ touch main.c $ open main.c å°†ä»£ç æ·»åŠ åˆ°ä»£ç åº“ æŸ¥çœ‹å½“å‰ä»£ç åº“çŠ¶æ€ $ git status å°†æ–‡ä»¶æ·»åŠ åˆ°ä»£ç åº“ $ git add main.c å°†ä¿®æ”¹æäº¤åˆ°ä»£ç åº“ $ git commit -m &quot;æ·»åŠ äº†main.c&quot; åœ¨æ­¤ä¸€å®šè¦ä½¿ç”¨ -m å‚æ•°æŒ‡å®šä¿®æ”¹çš„å¤‡æ³¨ä¿¡æ¯ å¦åˆ™ä¼šè¿›å…¥ vim ç¼–è¾‘å™¨ï¼Œå¦‚æœå¯¹vimä¸ç†Ÿæ‚‰ï¼Œä¼šæ˜¯å¾ˆç³Ÿç³•çš„äº‹æƒ… å°†å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–°å»ºæˆ–ä¿®æ”¹çš„æ–‡ä»¶ä¸€æ¬¡æ€§æ·»åŠ åˆ°ä»£ç åº“ $ git add . æ·»åŠ å¤šä¸ªæ–‡ä»¶ $ touch Person.h Person.m $ git add . $ git commit -m &quot;æ·»åŠ äº†Personç±»&quot; $ open Person.h $ git add . $ git commit -m &quot;å¢åŠ Personç±»å±æ€§&quot; æ³¨æ„ ä½¿ç”¨gitæ—¶ï¼Œæ¯ä¸€æ¬¡ä¿®æ”¹éƒ½éœ€è¦æ·»åŠ å†æäº¤ï¼Œè¿™ä¸€ç‚¹æ˜¯ä¸svnä¸ä¸€æ ·çš„ æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬åº“æ—¥å¿— $ git log æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çš„ç‰ˆæœ¬åº“æ—¥å¿— $ git log æ–‡ä»¶å å›åˆ°å½“å‰ç‰ˆæœ¬ï¼Œæ”¾å¼ƒæ‰€æœ‰æ²¡æœ‰æäº¤çš„ä¿®æ”¹ $ git reset --hard HEAD å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ $ git reset --hard HEAD^ å›åˆ°ä¹‹å‰ç¬¬3ä¸ªä¿®è®¢ç‰ˆæœ¬ $ git reset --hard HEAD~3 å›åˆ°æŒ‡å®šç‰ˆæœ¬å·çš„ç‰ˆæœ¬ $ git reset --hard e695b67 æŸ¥çœ‹åˆ†æ”¯å¼•ç”¨è®°å½• $ git reflog ä¸ºä»€ä¹ˆè¦ç”¨æºä»£ç ç®¡ç†å·¥å…· èƒ½è¿½è¸ªä¸€ä¸ªé¡¹ç›®ä»è¯ç”Ÿä¸€ç›´åˆ°å®šæ¡ˆçš„è¿‡ç¨‹ è®°å½•ä¸€ä¸ªé¡¹ç›®çš„æ‰€æœ‰å†…å®¹å˜åŒ– æ–¹ä¾¿åœ°æŸ¥é˜…ç‰¹å®šç‰ˆæœ¬çš„ä¿®è®¢æƒ…å†µ æœ€å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·æ˜¯ä»€ä¹ˆï¼Œèƒ½å¤§æ¦‚è®²è®²åŸç†ä¹ˆï¼Ÿå‚è€ƒç­”æ¡ˆï¼š æœ€å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·æœ‰SourceTreeï¼ˆGITï¼‰å’ŒCornerStoneï¼ˆSVNï¼‰ï¼› åŸç†æåˆ°svnæ˜¯é›†ä¸­å¼ä»£ç ç®¡ç†ï¼Œè§£é‡Šä¸‹å…·ä½“æ„æ€ï¼Œgitä¹Ÿè¿™æ ·å›ç­”å°±è¡Œäº†ã€‚ é›†ä¸­å¼ä»£ç ç®¡ç†ï¼ˆSVNï¼‰çš„æ ¸å¿ƒæ˜¯æœåŠ¡å™¨ï¼Œæ‰€æœ‰å¼€å‘è€…åœ¨å¼€å§‹æ–°ä¸€å¤©çš„å·¥ä½œä¹‹å‰å¿…é¡»ä»æœåŠ¡å™¨è·å–ä»£ç ï¼Œç„¶åå¼€å‘ï¼Œæœ€åè§£å†³å†²çªï¼Œæäº¤ã€‚æ‰€æœ‰çš„ç‰ˆæœ¬ä¿¡æ¯éƒ½æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚å¦‚æœè„±ç¦»äº†æœåŠ¡å™¨ï¼Œå¼€å‘è€…åŸºæœ¬ä¸Šå¯ä»¥è¯´æ˜¯æ— æ³•å·¥ä½œçš„ã€‚ åˆ†å¸ƒå¼çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œåœ¨Gitä¸­å¹¶ä¸å­˜åœ¨ä¸»åº“è¿™æ ·çš„æ¦‚å¿µï¼Œæ¯ä¸€ä»½å‡ºçš„åº“éƒ½å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä»»ä½•ä¸¤ä¸ªåº“ä¹‹é—´çš„ä¸ä¸€è‡´ä¹‹å¤„éƒ½å¯ä»¥è¿›è¡Œåˆå¹¶ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[iOSä½“ç³»ç»“æ„å›¾]]></title>
    <url>%2F2018%2F09%2F11%2FiOS%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E5%9B%BE%2F</url>
    <content type="text"><![CDATA[è¿™å¼ å›¾æ˜¯githubä¸Šä¸€ä½å¤§ç‰›æ‰€åˆ¶ä½œã€‚å»ºè®®æ‰¾å·¥ä½œçš„åŒå­¦ï¼ŒæŠŠè¿™å¼ å›¾æ‰“å°å‡ºæ¥ï¼Œè‡ªå·±å¯¹ç€çœ‹ï¼Œæœ‰å“ªäº›çŸ¥è¯†ç‚¹é—å¿˜çš„ï¼Œèµ¶ç´§å»å¤ä¹ ï¼Œæ¯å¤©è¿‡ä¸€éï¼Œä¿è¯ä½ é¢è¯•çš„æ—¶å€™èƒ¸æœ‰æˆç«¹ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘å°†æ€»ç»“è¿™æ®µæ—¶é—´æ”¶é›†çš„å’Œé¢è¯•è®°å½•ä¸‹æ¥çš„å„ç±»é—®é¢˜ï¼ŒåŠ©å„ä½åŒå­¦é¢è¯•ä¸€è‡‚ä¹‹åŠ›ã€‚æ–‡ç« å¦‚æœ‰é—®é¢˜ï¼Œè¯·ç•™è¨€ï¼Œæˆ‘å°†åŠæ—¶æ›´æ­£ã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>iOSé¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é€Ÿå­¦blockåœ¨ARCå’ŒMRCä¸­çš„ä½¿ç”¨]]></title>
    <url>%2F2018%2F09%2F04%2F%E9%80%9F%E5%AD%A6block%E5%9C%A8ARC%E5%92%8CMRC%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8%2F</url>
    <content type="text"><![CDATA[1.ARCè½¬MRC MRCè½¬ARCé¦–å…ˆ, å…ˆè¦äº†è§£ä¸‹ARCè½¬MRCå’ŒMRCè½¬ARC.ARCé¡¹ç›®è½¬MRCåˆ›å»ºé¡¹ç›®, æ‰“å¼€Xcode, ç‚¹å‡»é¡¹ç›®, æ‰¾åˆ°Build Phasesä¸­çš„Compile Sources, å°†éœ€è¦è½¬ä¸ºMRCçš„ .mæ–‡ä»¶åŠ å…¥ç¼–è¯‘æ ‡è®° -fno-objc-arc MRCé¡¹ç›®è½¬ARCç»™MRCé¡¹ç›®ä¸­.mæ–‡ä»¶æ·»åŠ ARCæ ‡è®° -fobjc-arc 2.ç¤ºä¾‹æ¼”ç¤ºExample A void exampleA() { char a = 'A'; ^{ printf("%c\n", a); }(); } 1.ARCå’ŒMRCéƒ½æœ‰æ•ˆ ?2.åªæœ‰ARC æœ‰æ•ˆ?3.MRCæœ‰æ•ˆ ?4.éƒ½æ²¡æœ‰æ•ˆ? Example B void exampleB_addBlockToArray(NSMutableArray *array) { char b = 'B'; [array addObject:^{ printf("%c\n", b); }]; } void exampleB() { NSMutableArray *array = [NSMutableArray array]; exampleB_addBlockToArray(array); void (^block)(void) = [array objectAtIndex:0]; block(); //MRC æ–­ç‚¹æŸ¥çœ‹ä¸‹ __NSStackBlock__ NSLog(@"%@", [block class]);// ARC __NSMallocBlock__ } 1.ARCå’ŒMRCéƒ½æœ‰æ•ˆ ?2.åªæœ‰ARC æœ‰æ•ˆ?3.MRCæœ‰æ•ˆ ?4.éƒ½æ²¡æœ‰æ•ˆ? Example C void exampleC_addBlockToArray(NSMutableArray *array) { [array addObject:^{ printf("C\n"); }]; } void exampleC() { NSMutableArray *array = [NSMutableArray array]; exampleC_addBlockToArray(array); void (^block)(void) = [array objectAtIndex:0]; block(); NSLog(@"%@", [block class]); // __NSGlobalBlock__ } 1.ARCå’ŒMRCéƒ½æœ‰æ•ˆ ?2.åªæœ‰ARC æœ‰æ•ˆ?3.MRCæœ‰æ•ˆ ?4.éƒ½æ²¡æœ‰æ•ˆ? Example D typedef void (^dBlock)(void); dBlock exampleD_getBlock() { char d = 'D'; return ^{ printf("%c\n", d); } ; } void exampleD() { exampleD_getBlock()(); } 1.ARCå’ŒMRCéƒ½æœ‰æ•ˆ ?2.åªæœ‰ARC æœ‰æ•ˆ?3.MRCæœ‰æ•ˆ ?4.éƒ½æ²¡æœ‰æ•ˆ? Example E typedef void (^eBlock)(void); eBlock exampleE_getBlock() { char e = 'E'; void (^block)(void) = ^{ printf("%c\n", e); }; return block; } void exampleE() { eBlock block = exampleE_getBlock(); block(); //MRC æ–­ç‚¹æŸ¥çœ‹ä¸‹ __NSStackBlock__ NSLog(@"%@", [block class]); // ARC __NSMallocBlock__ } 1.ARCå’ŒMRCéƒ½æœ‰æ•ˆ ?2.åªæœ‰ARC æœ‰æ•ˆ?3.MRCæœ‰æ•ˆ ?4.éƒ½æ²¡æœ‰æ•ˆ? 3.è§£æExample A: ARCå’ŒMRCéƒ½æœ‰æ•ˆ ä¸ç®¡åœ¨ ARC è¿˜æ˜¯ MRC ä¸‹ï¼Œä¸è®º block å­˜æ”¾åœ¨ stack è¿˜æ˜¯ heap å†…å­˜ä¸­ï¼Œå½“example A è¢«è°ƒç”¨æ—¶ï¼Œblock ä»ç„¶æœ‰æ•ˆï¼Œéƒ½èƒ½æ­£å¸¸æ‰§è¡Œ. Example B: åªæœ‰ARC æœ‰æ•ˆ åœ¨ MRC ä¸‹ï¼ŒexampleB_addBlockToArray ä¸­çš„ block æ˜¯ NSStackBlock ç±»å‹ï¼Œå­˜æ”¾åœ¨stackå†…å­˜ä¸­ã€‚å½“æ‰§è¡Œ exampleB æ—¶ï¼Œstack å†…å­˜è¢«é‡Šæ”¾ï¼Œblock å¤±æ•ˆ. åœ¨ ARC ä¸‹ï¼Œblock æ˜¯ autoreleased NSMallocBlock ç±»å‹ï¼Œå­˜æ”¾åœ¨ heap å†…å­˜ä¸­ï¼Œæ‰€ä»¥ Exmaple B åªæœ‰ARC æœ‰æ•ˆ. Example C: ARCå’ŒMRCéƒ½æœ‰æ•ˆ å½“ block ä¸éœ€è¦ä»å¤–éƒ¨è·å–å˜é‡æ—¶ï¼Œå®ƒä¸éœ€è¦åœ¨ runtime è®¾ç½®ä»»ä½•çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œblock è¢«ç¼–è¯‘æˆ NSGlobalBlock ç±»å‹ï¼Œæ”¾åœ¨å†…å­˜ data æ®µï¼Œå°±åƒ C å‡½æ•°ä¸€æ ·ï¼Œå±äºä»£ç çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ ARCå’ŒMRCéƒ½æœ‰æ•ˆ. Example D: åªæœ‰ARC æœ‰æ•ˆ è¿™é¢˜æœ‰ç‚¹ç±»ä¼¼äº Example B. åœ¨ MRC ä¸‹ï¼ŒexampleD_getBlock ä¸­çš„block ä¼šè¢«åˆ›å»ºåœ¨ stack å†…å­˜ä¸­ï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œblocké©¬ä¸Šå¤±æ•ˆã€‚é‰´äºæœ¬é¢˜çš„é”™è¯¯å®åœ¨å¤ªæ˜æ˜¾ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ error: returning block that lives on the local stack. è€Œåœ¨ ARC ä¸‹ï¼Œblock ä¼šè¢«ç¼–è¯‘æˆ autoreleased NSMallocBlock ç±»å‹ï¼Œå­˜æ”¾äº heap å†…å­˜ä¸­ã€‚æ‰€ä»¥ åªæœ‰ARC æœ‰æ•ˆ. Example E: åªæœ‰ARC æœ‰æ•ˆ æœ¬é¢˜ç±»ä¼¼äº Example Dï¼ŒåŒºåˆ«åœ¨äºæœ¬é¢˜ä»£ç ä¸ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ‰ä¼šå´©æºƒã€‚æ›´æ§½ç³•çš„æ˜¯ï¼Œå¦‚æœä½ å…³é—­äº†ç¼–è¯‘å™¨ä¼˜åŒ–é€‰é¡¹ï¼Œä»£ç è¿è¡Œæ­£å¸¸ï¼Œè€Œæ— æ³•å‘ç°è¿™ä¸ªéšè—çš„bugã€‚ è€Œåœ¨ ARC ä¸‹ï¼Œblock ä¼šè¢«ç¼–è¯‘æˆ autoreleased NSMallocBlock ç±»å‹ï¼Œå­˜æ”¾äº heap å†…å­˜ä¸­ã€‚æ‰€ä»¥ åªæœ‰ARC æœ‰æ•ˆ. 4.æ€»ç»“æ€»ç»“1: MRC ä¸­block æ²¡æœ‰å¼•ç”¨å¤–éƒ¨å˜é‡, blockä¸º NSGlobalBlock ç±»å‹,å­˜å‚¨åœ¨å…¨å±€æ•°æ®åŒº.MRC ä¸­block å¼•ç”¨å¤–éƒ¨å˜é‡,blockä¸ºNSStackBlock ç±»å‹,å­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­.æ‰€ä»¥, åœ¨blockæ‰€å±çš„æ ˆä½œç”¨åŸŸå¤–ä½¿ç”¨blockæ—¶, éœ€è¦å°†è°ƒç”¨copyæ–¹æ³•å°†è¯¥blockå­˜å‚¨åœ¨å †åŒº. æ€»ç»“2: ARC ä¸­ æ²¡æœ‰å¼•ç”¨å¤–éƒ¨å˜é‡, blockä¸º NSGlobalBlock ç±»å‹,å­˜å‚¨åœ¨å…¨å±€æ•°æ®åŒº.ARC ä¸­ å¼•ç”¨å¤–éƒ¨å˜é‡, blockä¸º autoreleased NSMallocBlock ç±»å‹,å­˜å‚¨åœ¨å †å†…å­˜ä¸­. ä¾‹å¤–:åŒ¿åblock å¼•ç”¨å¤–éƒ¨å˜é‡ åœ¨ARCä¸‹å…¶å®å¾ˆå°‘è§åˆ° NSStackBlock ç±»çš„Blockï¼Œå¤§å¤šæ•°æƒ…å†µç¼–è¯‘å™¨éƒ½ä¿è¯äº†Blockæ˜¯åœ¨å †ä¸Šåˆ›å»ºçš„ int count = 11; NSLog(@"Stack Block:%@", [^{NSLog(@"Stack Block:%d",count);} class]); //æ‰“å°ï¼šStack Block:__NSStackBlock__ 5.ä»¥ä¸Šè¿™ä¹ˆå¤šä¾‹å­å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆï¼Ÿå‘Šè¯‰æˆ‘ä»¬è¦ä½¿ç”¨ARCï¼åœ¨ARCä¸‹ï¼Œblockæ€»èƒ½æ­£ç¡®è¿è¡Œã€‚å¦‚æœä½ ä¸ç”¨ARCï¼Œæœ€å¥½èƒ½ä¿è¯åœ¨ stack å†…å­˜ä¸­å£°æ˜å®šä¹‰çš„blockï¼Œèƒ½å¤Ÿæ‹·è´åˆ°heapå†…å­˜ï¼Œä¿è¯blockçš„æ­£å¸¸è¿è¡Œã€‚]]></content>
      <categories>
        <category>iOS</category>
      </categories>
      <tags>
        <tag>block</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[markdownè¯­æ³•]]></title>
    <url>%2F2018%2F08%2F30%2Fmarkdown%E8%AF%AD%E6%B3%95%2F</url>
    <content type="text"><![CDATA[æ¬¢è¿ä½¿ç”¨é©¬å…‹é£è±¡@(ç¤ºä¾‹ç¬”è®°æœ¬)[é©¬å…‹é£è±¡|å¸®åŠ©|Markdown] é©¬å…‹é£è±¡æ˜¯ä¸€æ¬¾ä¸“ä¸ºå°è±¡ç¬”è®°ï¼ˆEvernoteï¼‰æ‰“é€ çš„Markdownç¼–è¾‘å™¨ï¼Œé€šè¿‡ç²¾å¿ƒçš„è®¾è®¡ä¸æŠ€æœ¯å®ç°ï¼Œé…åˆå°è±¡ç¬”è®°å¼ºå¤§çš„å­˜å‚¨å’ŒåŒæ­¥åŠŸèƒ½ï¼Œå¸¦æ¥å‰æ‰€æœªæœ‰çš„ä¹¦å†™ä½“éªŒã€‚ç‰¹ç‚¹æ¦‚è¿°ï¼š åŠŸèƒ½ä¸°å¯Œ ï¼šæ”¯æŒé«˜äº®ä»£ç å—ã€LaTeX å…¬å¼ã€æµç¨‹å›¾ï¼Œæœ¬åœ°å›¾ç‰‡ä»¥åŠé™„ä»¶ä¸Šä¼ ï¼Œç”šè‡³æˆªå›¾ç²˜è´´ï¼Œå·¥ä½œå­¦ä¹ å¥½å¸®æ‰‹ï¼› å¾—å¿ƒåº”æ‰‹ ï¼šç®€æ´é«˜æ•ˆçš„ç¼–è¾‘å™¨ï¼Œæä¾›[æ¡Œé¢å®¢æˆ·ç«¯][1]ä»¥åŠ[ç¦»çº¿Chrome App][2]ï¼Œæ”¯æŒç§»åŠ¨ç«¯ Webï¼› æ·±åº¦æ•´åˆ ï¼šæ”¯æŒé€‰æ‹©ç¬”è®°æœ¬å’Œæ·»åŠ æ ‡ç­¾ï¼Œæ”¯æŒä»å°è±¡ç¬”è®°è·³è½¬ç¼–è¾‘ï¼Œè½»æ¾ç®¡ç†ã€‚ [TOC] (ä¸æ”¯æŒ) Markdownç®€ä»‹(hexoå¼•ç”¨ä¸ä¸€æ ·) Markdown æ˜¯ä¸€ç§è½»é‡çº§æ ‡è®°è¯­è¨€ï¼Œå®ƒå…è®¸äººä»¬ä½¿ç”¨æ˜“è¯»æ˜“å†™çš„çº¯æ–‡æœ¬æ ¼å¼ç¼–å†™æ–‡æ¡£ï¼Œç„¶åè½¬æ¢æˆæ ¼å¼ä¸°å¯Œçš„HTMLé¡µé¢ã€‚ â€”â€” ç»´åŸºç™¾ç§‘ æ­£å¦‚æ‚¨åœ¨é˜…è¯»çš„è¿™ä»½æ–‡æ¡£ï¼Œå®ƒä½¿ç”¨ç®€å•çš„ç¬¦å·æ ‡è¯†ä¸åŒçš„æ ‡é¢˜ï¼Œå°†æŸäº›æ–‡å­—æ ‡è®°ä¸ºç²—ä½“æˆ–è€…æ–œä½“ï¼Œåˆ›å»ºä¸€ä¸ªé“¾æ¥æˆ–ä¸€ä¸ªè„šæ³¨[^demo]ã€‚ä¸‹é¢åˆ—ä¸¾äº†å‡ ä¸ªé«˜çº§åŠŸèƒ½ï¼Œæ›´å¤šè¯­æ³•è¯·æŒ‰Cmd + /æŸ¥çœ‹å¸®åŠ©ã€‚ ä»£ç å—@requires_authorization def somefunc(param1='', param2=0): '''A docstring''' if param1 > param2: # interesting print 'Greater' return (param2 - param1 + 1) or None class SomeClass: pass >>> message = '''interpreter ... prompt''' LaTeX å…¬å¼ (hexoä¸æ”¯æŒæ­¤å†™æ³•)å¯ä»¥åˆ›å»ºè¡Œå†…å…¬å¼ï¼Œä¾‹å¦‚ $\Gamma(n) = (n-1)!\quad\forall n\in\mathbb N$ã€‚æˆ–è€…å—çº§å…¬å¼ï¼š $$ x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a} $$ è¡¨æ ¼ (ä¸ä¸€æ ·) Item Value Qty Computer 1600 USD 5 Phone 12 USD 12 Pipe 1 USD 234 æµç¨‹å›¾ (hexoä¸æ”¯æŒæ­¤å†™æ³•)st=>start: Start e=>end op=>operation: My Operation cond=>condition: Yes or No? st->op->cond cond(yes)->e cond(no)->op ä»¥åŠæ—¶åºå›¾: Alice->Bob: Hello Bob, how are you? Note right of Bob: Bob thinks Bob-->Alice: I am good thanks! æç¤ºï¼šæƒ³äº†è§£æ›´å¤šï¼Œè¯·æŸ¥çœ‹æµç¨‹å›¾[è¯­æ³•][3]ä»¥åŠæ—¶åºå›¾[è¯­æ³•][4]ã€‚ å¤é€‰æ¡†ä½¿ç”¨ - [ ] å’Œ - [x] è¯­æ³•å¯ä»¥åˆ›å»ºå¤é€‰æ¡†ï¼Œå®ç° todo-list ç­‰åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š å·²å®Œæˆäº‹é¡¹ å¾…åŠäº‹é¡¹1 å¾…åŠäº‹é¡¹2 æ³¨æ„ï¼šç›®å‰æ”¯æŒå°šä¸å®Œå…¨ï¼Œåœ¨å°è±¡ç¬”è®°ä¸­å‹¾é€‰å¤é€‰æ¡†æ˜¯æ— æ•ˆã€ä¸èƒ½åŒæ­¥çš„ï¼Œæ‰€ä»¥å¿…é¡»åœ¨é©¬å…‹é£è±¡ä¸­ä¿®æ”¹ Markdown åŸæ–‡æ‰å¯ç”Ÿæ•ˆã€‚ä¸‹ä¸ªç‰ˆæœ¬å°†ä¼šå…¨é¢æ”¯æŒã€‚ å°è±¡ç¬”è®°ç›¸å…³ç¬”è®°æœ¬å’Œæ ‡ç­¾é©¬å…‹é£è±¡å¢åŠ äº†@(ç¬”è®°æœ¬)[æ ‡ç­¾A|æ ‡ç­¾B]è¯­æ³•, ä»¥é€‰æ‹©ç¬”è®°æœ¬å’Œæ·»åŠ æ ‡ç­¾ã€‚ ç»‘å®šè´¦å·åï¼Œ è¾“å…¥(è‡ªåŠ¨ä¼šå‡ºç°ç¬”è®°æœ¬åˆ—è¡¨ï¼Œè¯·ä»ä¸­é€‰æ‹©ã€‚ ç¬”è®°æ ‡é¢˜é©¬å…‹é£è±¡ä¼šè‡ªåŠ¨ä½¿ç”¨æ–‡æ¡£å†…å‡ºç°çš„ç¬¬ä¸€ä¸ªæ ‡é¢˜ä½œä¸ºç¬”è®°æ ‡é¢˜ã€‚ä¾‹å¦‚æœ¬æ–‡ï¼Œå°±æ˜¯ç¬¬ä¸€è¡Œçš„ æ¬¢è¿ä½¿ç”¨é©¬å…‹é£è±¡ã€‚ å¿«æ·ç¼–è¾‘ä¿å­˜åœ¨å°è±¡ç¬”è®°ä¸­çš„ç¬”è®°ï¼Œå³ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªçº¢è‰²çš„ç¼–è¾‘æŒ‰é’®ï¼Œç‚¹å‡»åä¼šå›åˆ°é©¬å…‹é£è±¡ä¸­æ‰“å¼€å¹¶ç¼–è¾‘è¯¥ç¬”è®°ã€‚ æ³¨æ„ï¼šç›®å‰ç”¨æˆ·åœ¨å°è±¡ç¬”è®°ä¸­å•æ–¹é¢åšçš„ä»»ä½•ä¿®æ”¹ï¼Œé©¬å…‹é£è±¡æ˜¯æ— æ³•è‡ªåŠ¨æ„ŸçŸ¥å’Œæ›´æ–°çš„ã€‚æ‰€ä»¥è¯·åŠ¡å¿…å›åˆ°é©¬å…‹é£è±¡ç¼–è¾‘ã€‚ æ•°æ®åŒæ­¥é©¬å…‹é£è±¡é€šè¿‡å°†MarkdownåŸæ–‡ä»¥éšè—å†…å®¹ä¿å­˜åœ¨ç¬”è®°ä¸­çš„ç²¾å¦™è®¾è®¡ï¼Œå®ç°äº†å¯¹Markdownçš„å­˜å‚¨å’Œå†æ¬¡ç¼–è¾‘ã€‚æ—¢è§£å†³äº†å…¶ä»–äº§å“åªæ˜¯å•å‘å¯¼å‡ºHTMLçš„å•è–„ï¼Œåˆè§„é¿äº†æœåŠ¡ç«¯å­˜å‚¨Markdownå¸¦æ¥çš„éšç§å®‰å…¨é—®é¢˜ã€‚è¿™æ ·ï¼ŒæœåŠ¡ç«¯ä»…ä½œä¸ºå¯¹å°è±¡ç¬”è®° APIè°ƒç”¨å’Œæ•°æ®è½¬æ¢ä¹‹ç”¨ã€‚ éšç§å£°æ˜ï¼šç”¨æˆ·æ‰€æœ‰çš„ç¬”è®°æ•°æ®ï¼Œå‡ä¿å­˜åœ¨å°è±¡ç¬”è®°ä¸­ã€‚é©¬å…‹é£è±¡ä¸å­˜å‚¨ç”¨æˆ·çš„ä»»ä½•ç¬”è®°æ•°æ®ã€‚ ç¦»çº¿å­˜å‚¨é©¬å…‹é£è±¡ä½¿ç”¨æµè§ˆå™¨ç¦»çº¿å­˜å‚¨å°†å†…å®¹å®æ—¶ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸å¿…æ‹…å¿ƒç½‘ç»œæ–­æ‰æˆ–æµè§ˆå™¨å´©æºƒã€‚ä¸ºäº†èŠ‚çœç©ºé—´å’Œé¿å…å†²çªï¼Œå·²åŒæ­¥è‡³å°è±¡ç¬”è®°å¹¶ä¸”ä¸å†ä¿®æ”¹çš„ç¬”è®°å°†åˆ é™¤éƒ¨åˆ†æœ¬åœ°ç¼“å­˜ï¼Œä¸è¿‡ä¾ç„¶å¯ä»¥éšæ—¶é€šè¿‡æ–‡æ¡£ç®¡ç†æ‰“å¼€ã€‚ æ³¨æ„ï¼šè™½ç„¶æµè§ˆå™¨å­˜å‚¨å¤§éƒ¨åˆ†æ—¶å€™éƒ½æ¯”è¾ƒå¯é ï¼Œä½†å°è±¡ç¬”è®°ä½œä¸ºä¸“ä¸šäº‘å­˜å‚¨ï¼Œæ›´å€¼å¾—ä¿¡èµ–ã€‚ä»¥é˜²ä¸‡ä¸€ï¼Œè¯·åŠ¡å¿…ç»å¸¸åŠæ—¶åŒæ­¥åˆ°å°è±¡ç¬”è®°ã€‚ ç¼–è¾‘å™¨ç›¸å…³è®¾ç½®å³ä¾§ç³»ç»Ÿèœå•ï¼ˆå¿«æ·é”®Cmd + Mï¼‰çš„è®¾ç½®ä¸­ï¼Œæä¾›äº†ç•Œé¢å­—ä½“ã€å­—å·ã€è‡ªå®šä¹‰CSSã€vim/emacs é”®ç›˜æ¨¡å¼ç­‰é«˜çº§é€‰é¡¹ã€‚ å¿«æ·é”®å¸®åŠ© Cmd + /åŒæ­¥æ–‡æ¡£ Cmd + Såˆ›å»ºæ–‡æ¡£ Cmd + Opt + Næœ€å¤§åŒ–ç¼–è¾‘å™¨ Cmd + Enteré¢„è§ˆæ–‡æ¡£ Cmd + Opt + Enteræ–‡æ¡£ç®¡ç† Cmd + Oç³»ç»Ÿèœå• Cmd + M åŠ ç²— Cmd + Bæ’å…¥å›¾ç‰‡ Cmd + Gæ’å…¥é“¾æ¥ Cmd + Læå‡æ ‡é¢˜ Cmd + H å…³äºæ”¶è´¹é©¬å…‹é£è±¡ä¸ºæ–°ç”¨æˆ·æä¾› 10 å¤©çš„è¯•ç”¨æœŸï¼Œè¯•ç”¨æœŸè¿‡åéœ€è¦ç»­è´¹æ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚æœªè´­ä¹°æˆ–è€…æœªåŠæ—¶ç»­è´¹ï¼Œå°†ä¸èƒ½åŒæ­¥æ–°çš„ç¬”è®°ã€‚ä¹‹å‰ä¿å­˜è¿‡çš„ç¬”è®°ä¾ç„¶å¯ä»¥ç¼–è¾‘ã€‚ åé¦ˆä¸å»ºè®® å¾®åšï¼š@é©¬å…‹é£è±¡ï¼Œ@GGock é‚®ç®±ï¼š&#x68;&#x75;&#x73;&#x74;&#103;&#111;&#99;&#107;&#64;&#x67;&#109;&#97;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d; æ„Ÿè°¢é˜…è¯»è¿™ä»½å¸®åŠ©æ–‡æ¡£ã€‚è¯·ç‚¹å‡»å³ä¸Šè§’ï¼Œç»‘å®šå°è±¡ç¬”è®°è´¦å·ï¼Œå¼€å¯å…¨æ–°çš„è®°å½•ä¸åˆ†äº«ä½“éªŒå§ã€‚ [^demo] (hexoä¸æ”¯æŒ) [^demo]: è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è„šæ³¨ã€‚è¯·æŸ¥é˜… MultiMarkdown æ–‡æ¡£ å…³äºè„šæ³¨çš„è¯´æ˜ã€‚ é™åˆ¶ï¼š å°è±¡ç¬”è®°çš„ç¬”è®°å†…å®¹ä½¿ç”¨ [ENML][5] æ ¼å¼ï¼ŒåŸºäº HTMLï¼Œä½†æ˜¯ä¸æ”¯æŒæŸäº›æ ‡ç­¾å’Œå±æ€§ï¼Œä¾‹å¦‚idï¼Œè¿™å°±å¯¼è‡´è„šæ³¨å’ŒTOCæ— æ³•æ­£å¸¸ç‚¹å‡»ã€‚ (æ”¯æŒ) [1]: http://maxiang.info/client_zh [2]: https://chrome.google.com/webstore/detail/kidnkfckhbdkfgbicccmdggmpgogehop [3]: http://adrai.github.io/flowchart.js/ [4]: http://bramp.github.io/js-sequence-diagrams/ [5]: https://dev.yinxiang.com/doc/articles/enml.php]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[hexoè¯­æ³•ä½“éªŒ]]></title>
    <url>%2F2018%2F08%2F30%2Fhexo%E8%AF%AD%E6%B3%95%E4%BD%93%E9%AA%8C%2F</url>
    <content type="text"><![CDATA[Imageåœ¨æ–‡ç« ä¸­æ’å…¥æŒ‡å®šå¤§å°çš„å›¾ç‰‡ã€‚ æ ‡ç­¾æ’ä»¶ï¼ˆTag Pluginsï¼‰å¼•ç”¨å—åœ¨æ–‡ç« ä¸­æ’å…¥å¼•è¨€ï¼Œå¯åŒ…å«ä½œè€…ã€æ¥æºå’Œæ ‡é¢˜ã€‚ åˆ«å·ï¼š quotecontent [author[source]] [link] [source_link_title] æ ·ä¾‹æ²¡æœ‰æä¾›å‚æ•°ï¼Œåˆ™åªè¾“å‡ºæ™®é€šçš„ blockquote Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem. 111111 222222 333 ä»£ç å—åœ¨æ–‡ç« ä¸­æ’å…¥ä»£ç ã€‚ åˆ«åï¼š codecode snippet æ ·ä¾‹æ™®é€šçš„ä»£ç å—alert(&#39;Hello World!&#39;); alert(â€˜Hello World!â€™); æŒ‡å®šè¯­è¨€[rectangle setX: 10 y: 10 width: 20 height: 20]; [rectangle setX: 10 y: 10 width: 20 height: 20]; [rectangle setX: 10 y: 10 width: 20 height: 20]; é™„åŠ è¯´æ˜array.map(callback[, thisArg]) Array.maparray.map(callback[, thisArg]) é™„åŠ è¯´æ˜å’Œç½‘å€_.compact([0, 1, false, 2, &#39;&#39;, 3]); =&gt; [1, 2, 3] _.compactUnderscore.js_.compact([0, 1, false, 2, â€˜â€™, 3]);=&gt; [1, 2, 3] åå¼•å·ä»£ç å—å¦ä¸€ç§å½¢å¼çš„ä»£ç å—ï¼Œä¸åŒçš„æ˜¯å®ƒä½¿ç”¨ä¸‰ä¸ªåå¼•å·æ¥åŒ…è£¹ã€‚ [title] [url] [link text] code snippet Linkåœ¨æ–‡ç« ä¸­æ’å…¥é“¾æ¥ï¼Œå¹¶è‡ªåŠ¨ç»™å¤–éƒ¨é“¾æ¥æ·»åŠ  target=â€_blankâ€ å±æ€§ã€‚ text url [external] [title] Youtubeåœ¨æ–‡ç« ä¸­æ’å…¥ Youtube è§†é¢‘ã€‚ Vimeoåœ¨æ–‡ç« ä¸­æ’å…¥ Vimeo è§†é¢‘ã€‚ å¼•ç”¨æ–‡ç« å¼•ç”¨å…¶ä»–æ–‡ç« çš„é“¾æ¥ã€‚ å¼•ç”¨èµ„æºå¼•ç”¨æ–‡ç« çš„èµ„æºã€‚ window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"åˆ†äº«åˆ°ï¼š","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
      <tags>
        <tag>æŠ€å·§</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åšå®¢å¼€ç¯‡]]></title>
    <url>%2F2018%2F08%2F30%2F%E5%8D%9A%E5%AE%A2%E5%BC%80%E7%AF%87%2F</url>
    <content type="text"><![CDATA[ç»ˆäºä¸‹å†³å¿ƒè¦å¼€å§‹å†™åšå®¢äº†ï¼Œåšç¨‹åºå‘˜å¿«å››å¹´äº†ï¼Œå››å¹´çš„æ—¶é—´é‡Œï¼Œç”±ä¸€ä¸ªå«©å¤´é’ï¼Œæˆé•¿ä¸ºäº†ä¸€ä¸ªèƒ½åœ¨å…¬å¸é¡¹ç›®é‡Œç‹¬ç«‹å®Œæˆä¸€äº›ä¸šåŠ¡é€»è¾‘å¤æ‚çš„å¤§æ¨¡å—çš„ä¸­åšç¨‹åºå‘˜ã€‚é¦–å…ˆæˆ‘è¿˜æ˜¯æ¦‚æ‹¬ä¸‹è¿™å‡ å¹´çš„æˆé•¿å†ç¨‹å§ã€‚ ç”±äºæœ¬äººçš„è„¸é•¿å¾—æ¯”è¾ƒç¼“æ…¢ï¼Œåˆšå‡ºé“æ—¶è¿˜æ˜¯ä¸€å¼ å­©ç«¥è„¸ï¼Œç”¨æ—¶ä¸‹æµè¡Œçš„ä¸€ä¸ªè¯æ¥æè¿°é‚£å°±æ˜¯â€œèŒâ€ã€‚å› ä¸ºå¤ªèŒï¼Œåˆšå®‰æ’åˆ°å®¢æˆ·ç°åœºåšå¼€å‘æ—¶ï¼Œè¿˜è¢«å®¢æˆ·å¼€ç©ç¬‘è¯´ä½ ä»¬å…¬å¸è¿æ³•æ‹›æ”¶ç«¥å·¥ï¼Œæˆ‘ä¸€æ€’ä¹‹ä¸‹è“„äº†å‡ ä¸ªæœˆèƒ¡é¡»ï¼Œç•™äº†å‡ ä¸ªæœˆé£˜é€¸çš„é•¿å‘ï¼Œæƒ³è®©è‡ªå·±åœ¨å¤–è¡¨ä¸Šçœ‹ä¸Šå»æ›´è€æˆã€‚ä½†ä¸å·§çš„æ˜¯ï¼Œæ­¤æ—¶çš„æˆ‘åˆä¸é‚£æ—¶åˆšå‡ºé“çš„â€œçŠ€åˆ©å“¥â€é£æ ¼æä¸ºç±»ä¼¼ï¼Œåˆè¢«æˆç§°ä¸ºçŠ€åˆ©ç¨‹åºå“¥ï¼Œå†æ€’ä¹‹ä¸‹ï¼Œå¼€å§‹æ½œå¿ƒå·¥ä½œï¼Œä¸å†è¿½æ±‚è¡¨é¢çš„æµ®å¤¸ï¼Œåœ¨å·¥ä½œä¸­é€æ¸å±•éœ²å¤´è§’ï¼Œå®Œæˆäº†é¡¹ç›®ä¸­å‡ ä¸ªé‡è¦éœ€æ±‚çš„å¼€å‘ï¼Œåœ¨åæ¥çš„æ™®é€‰ä¸­å½“é€‰ä¸ºå…¬å¸å¹´åº¦ä¼˜ç§€å‘˜å·¥ä¹‹ä¸€ã€‚æœ€è¿‘1ï¼Œ2å¹´æ³¢æ¾œä¸æƒŠï¼Œå› ä¸ºè‡ªå­¦æ²¡æœ‰æ–­è¿‡ï¼ŒæŠ€æœ¯ä¹Ÿåœ¨é€æ­¥ç§¯ç´¯ã€‚ ä¸‹é¢è¿›å…¥ä¸»é¢˜ï¼Œå…³äºæˆ‘çš„åšå®¢ï¼Œæˆ‘ç”¨è‡ªé—®è‡ªç­”çš„æ–¹å¼æ¥ä»‹ç»ï¼š 1ã€æˆ‘ä¸ºä»€ä¹ˆè¦å†™åšå®¢ï¼Ÿ åšç¨‹åºå‘˜è¿™å‡ å¹´ï¼ŒæŠ€æœ¯ä¸æ–­ç§¯ç´¯ï¼Œæ€æƒ³ä¸æ–­åœ¨å‡åï¼Œæœ‰äº›æ€è€ƒå’Œæƒ³æ³•åœ¨ä¸åŒäº‹ã€æœ‹å‹çš„äº¤æµä¸­ä¼šè¿¸å‘å‡ºæ¥ã€‚åœ¨äº¤æµçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è§‰å¾—å¾ˆè¿‡ç˜¾ã€‚æœ‰äº›æ¨¡ç³Šä¸æ¸…çš„äº‹æƒ…ï¼Œé€šè¿‡äº¤æµæ˜ç¡®äº†ï¼Œæœ‰äº›ä»¥ä¸ºè‡ªå·±æŠŠæ¡çš„å¾ˆå‡†çš„äº‹æƒ…ï¼Œé€šè¿‡äº¤æµé¢ è¦†äº†ï¼Œè€Œæœ‰äº›è‡ªå·±å·²ç»æ˜ç™½çš„äº‹æƒ…ï¼Œåˆå¼€é˜”äº†æ–°çš„æ€è·¯ã€‚ä½†äº¤æµåªæ˜¯ç¬æ—¶çš„ã€å·²é€çš„ï¼Œæˆ‘ä»¬çš„è®¨è®ºä¸æ˜¯å›½å®¶æ”¿è¦æ¥è§å¤–å›½é¢†å¯¼ï¼Œæ²¡æœ‰äººæŠŠæˆ‘ä»¬çš„è°ˆè¯è®°å½•ä¸‹æ¥ã€‚å°±åƒåœ¨å†…å­˜é‡Œä¸€æ ·ï¼Œæ–­ç”µåæ¢å¤ä¸äº†ï¼Œäº‹åå¾ˆéš¾å›å¿†èµ·æ¥é‚£äº›æ›¾ç»é—ªå…‰çš„æ€æƒ³ã€‚æ‰€ä»¥æˆ‘è¦æŠŠæˆ‘åœ¨ç¨‹åºäººç”Ÿä¸­å¾—åˆ°çš„æ€æƒ³ç»™æŒä¹…åŒ–äº†ï¼Œç»™å›ºåŒ–ä¸‹æ¥ã€‚å†ä¸€ä¸ªå°±æ˜¯ï¼Œæˆ‘çš„åŒäº‹ã€æœ‹å‹å§‹ç»ˆæ˜¯æˆ‘èº«è¾¹ç†Ÿæ‚‰çš„äººï¼Œæˆ‘éœ€è¦ä¸€ä¸ªæ›´å¤§çš„ä¸–ç•Œï¼Œæ‰€ä»¥ï¼Œæˆ‘ä¹Ÿæƒ³é€šè¿‡åšå®¢ä¸å¤§å®¶äº¤æµï¼ 2ã€æˆ‘çš„åšå®¢å†™äº›ä»€ä¹ˆä¸œè¥¿ï¼Ÿ è¿™ä¸ªé—®é¢˜æˆ‘æƒ³äº†å¾ˆä¹…ï¼Œä»¥å‰æƒ³å†™äº›å…³äºiOSçš„ã€å…³äºå‰ç«¯åšæ–‡ã€‚æœ‰æ—¶å€™åœ¨è‰ç¨¿ä¸­å†™å¥½ä¸€æ®µæ–‡å­—ï¼Œæœ€åä¸€æœç´¢ï¼Œå…¨ä¸–ç•Œæ‹¥æœ‰åŒæ ·çŸ¥è¯†ç‚¹çš„ï¼ŒåŒæ ·è§£å†³æ–¹æ¡ˆçš„æ•°ä¸èƒœæ•°ï¼Œå¤ªå¤šäº†ã€‚ä½œä¸ºä¸€ä¸ªè®¨åŒé‡å¤çš„äººï¼Œæˆ‘ä¸èƒ½å†ç½—åˆ—è¿™äº›ç½‘ä¸Šä¸€æŠ“ä¸€å¤§æŠŠçš„æ™®ä¸–æŠ€æœ¯çŸ¥è¯†ç‚¹ï¼Œæ›´ä½•å†µä»¥æˆ‘ç°åœ¨çš„ç§¯ç´¯ï¼Œè¿˜ä¸èƒ½åšåˆ°éå¸¸å¥½ã€‚å½“ç„¶æˆ‘ä¸æ˜¯è¯´ç½—åˆ—æŠ€æœ¯ç‚¹æ²¡æœ‰æŠ€æœ¯å«é‡ï¼Œæ­£æ˜¯å› ä¸ºç½‘ä¸Šè¿™äº›åºå¤§çš„çŸ¥è¯†ï¼Œæˆ‘æ‰èƒ½å¾ˆå¿«çš„æ‰¾åˆ°æˆ‘æƒ³è¦çš„ï¼Œè§£å†³æˆ‘çš„é—®é¢˜ã€‚ç»¼ä¸Šï¼Œæˆ‘ä¸èƒ½åšé‡å¤çš„äº‹ï¼Œä¹Ÿä¸è¦å› ä¸ºè¯´çš„ä¸œè¥¿ä¸æ‰å®è€Œè¯¯å¯¼åˆ«äººã€‚å½“ç„¶äº†ï¼Œåœ¨æŸä¸ªæŠ€æœ¯é¢†åŸŸè¾¾åˆ°ä¸€å®šå¢ƒç•Œäº†ï¼Œæˆ‘ä¹Ÿä¼šå†™ç ”ç©¶æŠ€æœ¯ç»†èŠ‚çš„åšæ–‡ã€‚ é‚£æˆ‘å†™ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ˜¯ä¸é‡å¤çš„ï¼Ÿé‚£å¿…é¡»æ–©é’‰æˆªé“çš„è¯´é‚£å°±æ˜¯æˆ‘çš„æ€æƒ³ï¼Œä¸–ä¸Šæ²¡æœ‰ä»»ä½•ä¸€ä¸ªäººå’Œæˆ‘çš„äººç”Ÿè½¨è¿¹å®Œå…¨ä¸€æ ·ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šæ€è€ƒæˆ‘ä¼šæ€»ç»“ï¼Œæˆ‘è¦æŠŠæˆ‘çš„æ€æƒ³ç•™å­˜äºä¸–ï¼Œå³ä½¿æœ‰æ—¶å€™ä¼šæœ‰ç›¸åŒæ€æƒ³çš„ä¸œè¥¿åŒæ—¶å­˜åœ¨ï¼Œé‚£ä¹Ÿä¼šå› ä¸ºæ˜¯æˆ‘ä¸ªäººçš„æ€»ç»“å’Œåæ€è€Œæœ‰æ‰€ä¸åŒï¼ 3ã€å†™åšå®¢çš„è®¡åˆ’ï¼Ÿ ä¸è¿½æ±‚ä¸€ä¸ªæœˆä¸€å®šè¦å†™å‡ ç¯‡å‡ ç¯‡çš„ï¼Œå½“æˆ‘æœ‰æ·±åˆ»çš„æ„Ÿè§¦ï¼Œå¯¹äº‹ç‰©æœ‰ä¸åŒçš„ç†è§£ï¼Œæˆ‘å°±å†™ä¸€ç¯‡ï¼Œè®°å½•ä¸‹æ¥ï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œå‘å“è¶Šç¨‹åºå‘˜è¿ˆè¿›ï¼ å¤œç©ºéœ“è™¹ï¼Œéƒ½æ˜¯æˆ‘ä¸è¦çš„ç¹è£ï¼Œå®Œã€‚]]></content>
      <categories>
        <category>éšç¬”</category>
      </categories>
      <tags>
        <tag>å¿ƒæƒ…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[timeline]]></title>
    <url>%2Ftimeline%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[categories]]></title>
    <url>%2Fcategories%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[tags]]></title>
    <url>%2Ftags%2Findex.html</url>
    <content type="text"></content>
  </entry>
  <entry>
    <title><![CDATA[links]]></title>
    <url>%2Flinks%2Findex.html</url>
    <content type="text"></content>
  </entry>
</search>
